/* Function: FUN_00401000 */

int FUN_00401000(int param_1,undefined4 param_2,LPCWSTR param_3,undefined4 param_4)

{
  int iVar1;
  int local_8;
  
  HeapSetInformation((HANDLE)0x0,HeapEnableTerminationOnCorruption,(PVOID)0x0,0);
  local_8 = 0;
  iVar1 = FUN_00401bd3(param_1,param_3,param_4,&local_8);
  if (iVar1 < 0) {
    local_8 = iVar1;
  }
  return local_8;
}



/* Function: FUN_00401036 */

int FUN_00401036(LPCRITICAL_SECTION param_1)

{
  HANDLE pvVar1;
  int iVar2;
  uint *puVar3;
  uint local_8;
  
  local_8 = 0;
  param_1[0x2e].SpinCount = 0xffffffff;
  param_1[0x2e].OwningThread = (HANDLE)0x1;
  InitializeCriticalSection(param_1);
  InitializeCriticalSection((LPCRITICAL_SECTION)&param_1[8].LockSemaphore);
  FUN_0040f14d(&param_1[0x2f].LockCount);
  FUN_0040f14d(&param_1[0x30].LockCount);
  puVar3 = &local_8;
  pvVar1 = GetCurrentProcess();
  FUN_00431e0f(pvVar1,puVar3);
  param_1[0x2e].LockSemaphore = (HANDLE)(-(uint)(local_8 != 0) & 2);
  iVar2 = FUN_0040725f(&param_1[3].DebugInfo);
  if (iVar2 < 0) {
    FUN_00430a57(iVar2,"Failed to initialize engine section.");
  }
  return iVar2;
}



/* Function: FUN_004010c2 */

DWORD FUN_004010c2(uint param_1,int param_2)

{
  int iVar1;
  DWORD DVar2;
  
  DVar2 = 0;
  iVar1 = *(int *)(param_2 + 4);
  if (iVar1 == 0x9000) {
    DVar2 = FUN_00411061(param_1);
  }
  else if (iVar1 == 0x9001) {
    DVar2 = FUN_0041177f(param_1,*(uint *)(param_2 + 0xc));
  }
  else if (iVar1 == 0x9002) {
    DVar2 = FUN_004114d0(param_1,*(undefined4 *)(param_2 + 0xc));
  }
  else if (iVar1 == 0x9003) {
    DVar2 = FUN_00410c48(param_1,*(undefined4 *)(param_2 + 0xc));
  }
  else if (iVar1 == 0x9004) {
    DVar2 = FUN_00411bb1(param_1,*(int *)(param_2 + 8));
  }
  return DVar2;
}



/* Function: FUN_00401124 */

DWORD FUN_00401124(LPCSTR param_1,int param_2)

{
  LPVOID pvVar1;
  DWORD DVar2;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  DVar2 = 0;
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  if (DAT_00456f44 == 0) {
    DAT_00456f44 = 1;
    pvVar1 = TlsGetValue(*(DWORD *)(param_2 + 0x464));
    if ((pvVar1 == (LPVOID)0x0) || (pvVar1 == (LPVOID)0xffffffff)) {
      DVar2 = 0x800700e9;
    }
    else {
      DVar2 = FUN_004305e8((int *)&local_8,(int *)&local_c,param_1);
      if (-1 < (int)DVar2) {
        DVar2 = FUN_0040f882(pvVar1,0xf0000001,local_8,local_c,(undefined *)0x0,0,&local_10);
        if (-1 < (int)DVar2) {
          DVar2 = local_10;
        }
      }
    }
    if (local_8 != (LPVOID)0x0) {
      FUN_00431137(local_8);
    }
    DAT_00456f44 = 0;
  }
  return DVar2;
}



/* Function: FUN_004011bf */

void FUN_004011bf(void)

{
  HANDLE ProcessHandle;
  BOOL BVar1;
  DWORD DVar2;
  int iVar3;
  uint uVar4;
  uint uVar5;
  DWORD DVar6;
  HANDLE *TokenHandle;
  char *pcVar7;
  HANDLE local_1c;
  _TOKEN_PRIVILEGES local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_18.PrivilegeCount = 0;
  local_18.Privileges[0].Luid.LowPart = 0;
  local_18.Privileges[0].Luid.HighPart = 0;
  local_18.Privileges[0].Attributes = 0;
  TokenHandle = &local_1c;
  DVar6 = 0x20;
  local_1c = (HANDLE)0x0;
  ProcessHandle = GetCurrentProcess();
  BVar1 = OpenProcessToken(ProcessHandle,DVar6,TokenHandle);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    DVar6 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      DVar6 = DVar2;
    }
    if (-1 < (int)DVar6) {
      DVar6 = 0x80004005;
    }
    FUN_004300d9();
    pcVar7 = "Failed to get process token.";
  }
  else {
    local_18.PrivilegeCount = 1;
    local_18.Privileges[0].Attributes = 2;
    BVar1 = LookupPrivilegeValueW((LPCWSTR)0x0,L"SeShutdownPrivilege",&local_18.Privileges[0].Luid);
    if (BVar1 == 0) {
      DVar2 = GetLastError();
      DVar6 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        DVar6 = DVar2;
      }
      if (-1 < (int)DVar6) {
        DVar6 = 0x80004005;
      }
      FUN_004300d9();
      pcVar7 = "Failed to get shutdown privilege LUID.";
    }
    else {
      BVar1 = AdjustTokenPrivileges(local_1c,0,&local_18,0x10,(PTOKEN_PRIVILEGES)0x0,(PDWORD)0x0);
      uVar4 = 0;
      if (BVar1 == 0) {
        DVar2 = GetLastError();
        DVar6 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          DVar6 = DVar2;
        }
        if (-1 < (int)DVar6) {
          DVar6 = 0x80004005;
        }
        FUN_004300d9();
        pcVar7 = "Failed to adjust token to add shutdown privileges.";
      }
      else {
        do {
          Sleep(1000);
          iVar3 = (*DAT_00456f4c)(0,0,0,0,1,0x80040002);
          DVar6 = 0;
          if (iVar3 == 0) {
            DVar2 = GetLastError();
            DVar6 = DVar2 & 0xffff | 0x80070000;
            if ((int)DVar2 < 1) {
              DVar6 = DVar2;
            }
          }
          uVar5 = uVar4 + 1;
        } while ((uVar4 < 10) && ((uVar4 = uVar5, DVar6 == 0x800704f7 || (DVar6 == 0x80070015))));
        if (-1 < (int)DVar6) goto LAB_00401345;
        FUN_004300d9();
        pcVar7 = "Failed to schedule restart.";
      }
    }
  }
  FUN_00430a57(DVar6,pcVar7);
LAB_00401345:
  if (local_1c != (HANDLE)0x0) {
    CloseHandle(local_1c);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00401364 */

DWORD FUN_00401364(uint param_1,undefined4 *param_2)

{
  DWORD DVar1;
  BOOL BVar2;
  int iVar3;
  tagMSG *ptVar4;
  char *pcVar5;
  tagMSG local_24;
  int *local_8;
  
  ptVar4 = &local_24;
  for (iVar3 = 7; iVar3 != 0; iVar3 = iVar3 + -1) {
    ptVar4->hwnd = (HWND)0x0;
    ptVar4 = (tagMSG *)&ptVar4->message;
  }
  local_8 = (int *)0x0;
  PeekMessageW(&local_24,(HWND)0x0,0x400,0x400,0);
  DVar1 = GetCurrentThreadId();
  DVar1 = FUN_00418ad9(param_1,DVar1,&local_8);
  if ((int)DVar1 < 0) {
    pcVar5 = "Failed to create engine for UX.";
  }
  else {
    DVar1 = FUN_00408878(param_1 + 0xb8,local_8,param_1 + 0x1c);
    if (-1 < (int)DVar1) {
      DVar1 = (**(code **)(**(int **)(param_1 + 200) + 0xc))(*(int **)(param_1 + 200));
      if ((int)DVar1 < 0) {
        pcVar5 = "Failed to start bootstrapper application.";
LAB_004013f0:
        FUN_00430a57(DVar1,pcVar5);
      }
      else {
        while (BVar2 = GetMessageW(&local_24,(HWND)0x0,0,0), BVar2 != 0) {
          if (BVar2 == -1) {
            DVar1 = 0x8000ffff;
            FUN_004300d9();
            pcVar5 = "Unexpected return value from message pump.";
            goto LAB_004013f0;
          }
          FUN_004010c2(param_1,(int)&local_24);
        }
        *(WPARAM *)(param_1 + 0xf4) = local_24.wParam;
      }
      iVar3 = (**(code **)(**(int **)(param_1 + 200) + 0x10))(*(int **)(param_1 + 200));
      if (iVar3 == 0x66) {
        FUN_0040e33b(*(int *)(param_1 + 0x18));
        FUN_00402003(2,0x20000004);
        *(undefined4 *)(param_1 + 0x18) = 1;
      }
      else if (iVar3 == 0x68) {
        FUN_00402003(2,0x20000006);
        *param_2 = 1;
      }
      goto LAB_00401499;
    }
    pcVar5 = "Failed to load UX.";
  }
  FUN_00430a57(DVar1,pcVar5);
LAB_00401499:
  FUN_00408a85(param_1 + 0xb8);
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return DVar1;
}



/* Function: FUN_004014bb */

DWORD FUN_004014bb(undefined4 param_1,undefined4 param_2,int param_3)

{
  uint uVar1;
  DWORD DVar2;
  BOOL BVar3;
  char *pcVar4;
  int local_c;
  HANDLE local_8;
  
  local_8 = (HANDLE)0x0;
  local_c = 0;
  if (*(int *)(param_3 + 0x460) == 2) {
    uVar1 = FUN_0040f1d5((undefined4 *)(param_3 + 0x46c),(undefined4 *)(param_3 + 0x470));
    if ((int)uVar1 < 0) {
      pcVar4 = "Failed to create implicit elevated connection name and secret.";
    }
    else {
      uVar1 = FUN_0040f5e1(param_2,(WORD)*(undefined4 *)(param_3 + 0x2c));
      if (-1 < (int)uVar1) goto LAB_00401523;
      pcVar4 = "Failed to launch unelevated process.";
    }
  }
  else {
LAB_00401523:
    uVar1 = FUN_0040ef74(param_3 + 0x46c,1);
    if ((int)uVar1 < 0) {
      pcVar4 = "Failed to connect to unelevated process.";
    }
    else {
      DVar2 = TlsAlloc();
      *(DWORD *)(param_3 + 0x464) = DVar2;
      if (DVar2 == 0xffffffff) {
        DVar2 = GetLastError();
        uVar1 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar1 = DVar2;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        FUN_004300d9();
        pcVar4 = "Failed to allocate thread local storage for logging.";
      }
      else {
        BVar3 = TlsSetValue(DVar2,*(LPVOID *)(param_3 + 0x47c));
        if (BVar3 == 0) {
          DVar2 = GetLastError();
          uVar1 = DVar2 & 0xffff | 0x80070000;
          if ((int)DVar2 < 1) {
            uVar1 = DVar2;
          }
          if (-1 < (int)uVar1) {
            uVar1 = 0x80004005;
          }
          FUN_004300d9();
          pcVar4 = "Failed to set elevated pipe into thread local storage for logging.";
        }
        else {
          uVar1 = FUN_0041787a(param_1,param_3);
          if ((int)uVar1 < 0) {
            pcVar4 = "Failed to create the message window.";
          }
          else {
            FUN_004331e2(1);
            FUN_00430ea1(FUN_00401124,param_3);
            uVar1 = FUN_00416312(*(HANDLE *)(param_3 + 0x464),*(HANDLE *)(param_3 + 0x47c),
                                 *(undefined4 *)(param_3 + 0x480),param_3 + 0x290,param_3 + 0x2a8,
                                 param_3 + 0x2a0,param_3 + 0x88,param_3 + 0xf8,param_3 + 0xb8,
                                 &local_8,&local_c,(undefined4 *)(param_3 + 0xf4),
                                 (undefined4 *)(param_3 + 0x18));
            FUN_00430ea1(0,0);
            if (-1 < (int)uVar1) goto LAB_0040166b;
            pcVar4 = "Failed to pump messages from parent process.";
          }
        }
      }
    }
  }
  FUN_00430a57(uVar1,pcVar4);
LAB_0040166b:
  FUN_00430ea1(0,0);
  FUN_0041783b(param_3);
  if (local_c != 0) {
    FUN_00416439();
  }
  if (local_8 != (HANDLE)0x0) {
    ReleaseMutex(local_8);
    CloseHandle(local_8);
  }
  return uVar1;
}



/* Function: FUN_004016a6 */

DWORD FUN_004016a6(int param_1,uint param_2)

{
  DWORD DVar1;
  char *pcVar2;
  
  DVar1 = FUN_0040ef74(param_2 + 0x484,0);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to connect to parent of embedded process.";
  }
  else {
    DVar1 = FUN_004016ed(param_1,param_2);
    if (-1 < (int)DVar1) {
      return DVar1;
    }
    pcVar2 = "Failed to run bootstrapper application embedded.";
  }
  FUN_00430a57(DVar1,pcVar2);
  return DVar1;
}



/* Function: FUN_004016ed */

DWORD FUN_004016ed(int param_1,uint param_2)

{
  LPCRITICAL_SECTION p_Var1;
  short *psVar2;
  uint uVar3;
  DWORD DVar4;
  undefined4 uVar5;
  BOOL BVar6;
  char *pcVar7;
  int local_c;
  HANDLE local_8;
  
  uVar3 = param_2;
  local_8 = (HANDLE)0x0;
  p_Var1 = (LPCRITICAL_SECTION)(param_2 + 0x88);
  local_c = 1;
  DVar4 = FUN_0040e522((int *)(param_2 + 0x3bc),p_Var1,*(int *)(param_2 + 0x20),
                       *(LPCWSTR *)(param_2 + 0x158));
  if ((int)DVar4 < 0) {
    pcVar7 = "Failed to open log.";
  }
  else {
    DVar4 = FUN_00413ca0((int *)(uVar3 + 0xf8),p_Var1);
    if ((int)DVar4 < 0) {
      pcVar7 = "Failed to initialize internal cache functionality.";
    }
    else if (*(int *)(uVar3 + 0x460) == 1) {
      DVar4 = FUN_0040f31a(uVar3 + 0x46c,1,&local_8);
      if ((int)DVar4 < 0) {
        pcVar7 = "Failed to create pipes to connect to elevated parent process.";
      }
      else {
        DVar4 = FUN_0040f9dc(uVar3 + 0x46c);
        if (-1 < (int)DVar4) {
          if (local_8 != (HANDLE)0x0) {
            CloseHandle(local_8);
            local_8 = (HANDLE)0x0;
          }
          goto LAB_004017a7;
        }
        pcVar7 = "Failed to connect to elevated parent process.";
      }
    }
    else {
LAB_004017a7:
      DVar4 = FUN_00405a1b((uint)p_Var1,(int *)(uVar3 + 0xac),*(int *)(uVar3 + 0x20),
                           *(LPCWSTR *)(uVar3 + 0x158),(undefined4 *)(uVar3 + 0xf4),&local_c);
      if ((int)DVar4 < 0) {
        pcVar7 = "Failed to check global conditions";
      }
      else {
        if (local_c == 0) {
          FUN_00402003(2,0xe0000035);
          DVar4 = 0;
          goto LAB_004018bc;
        }
        if ((*(int *)(uVar3 + 0xb8) != 0) && (2 < *(int *)(uVar3 + 0x20))) {
          FUN_00417453(param_1,0,uVar3 + 0x34);
        }
        DVar4 = FUN_0041787a(param_1,uVar3);
        if ((int)DVar4 < 0) {
          pcVar7 = "Failed to create the message window.";
        }
        else {
          DVar4 = FUN_00411b03(uVar3);
          if ((int)DVar4 < 0) {
            pcVar7 = "Failed to query registration.";
          }
          else {
            DVar4 = FUN_0040de4d(*(int *)(uVar3 + 0x1c),p_Var1);
            if ((int)DVar4 < 0) {
              pcVar7 = "Failed to set action variables.";
            }
            else {
              DVar4 = FUN_0040b4cd(uVar3 + 0xf8,p_Var1);
              if ((int)DVar4 < 0) {
                pcVar7 = "Failed to set registration variables.";
              }
              else {
                psVar2 = *(short **)(uVar3 + 0x40);
                if (((psVar2 == (short *)0x0) || (*psVar2 == 0)) ||
                   (DVar4 = FUN_0040461f(p_Var1,L"WixBundleLayoutDirectory",(int)psVar2,0),
                   -1 < (int)DVar4)) {
                  do {
                    param_1 = 0;
                    DVar4 = FUN_00401364(uVar3,&param_1);
                    if ((int)DVar4 < 0) {
                      pcVar7 = "Failed while running ";
                      goto LAB_004018b4;
                    }
                  } while (param_1 != 0);
                  goto LAB_004018bc;
                }
                pcVar7 = 
                "Failed to set layout directory variable to value provided from command-line.";
              }
            }
          }
        }
      }
    }
  }
LAB_004018b4:
  FUN_00430a57(DVar4,pcVar7);
LAB_004018bc:
  FUN_0041783b(uVar3);
  FUN_004046bd(p_Var1);
  if (*(int *)(uVar3 + 0x47c) != -1) {
    if (*(int *)(uVar3 + 0x460) == 1) {
      uVar5 = *(undefined4 *)(uVar3 + 0x18);
    }
    else {
      uVar5 = 0;
    }
    FUN_0040f8e4(uVar3 + 0x46c,*(undefined4 *)(uVar3 + 0xf4),uVar5);
  }
  BVar6 = IsWindow(*(HWND *)(uVar3 + 0x34));
  if (BVar6 != 0) {
    PostMessageW(*(HWND *)(uVar3 + 0x34),0x10,0,0);
  }
  if (local_8 != (HANDLE)0x0) {
    CloseHandle(local_8);
  }
  return DVar4;
}



/* Function: FUN_00401928 */

DWORD FUN_00401928(LPCWSTR param_1,WORD param_2)

{
  WCHAR WVar1;
  DWORD DVar2;
  int iVar3;
  undefined2 *puVar4;
  uint uVar5;
  int iVar6;
  LPWSTR *hMem;
  int local_14;
  HANDLE local_10;
  LPCWSTR local_c;
  undefined2 *local_8;
  
  local_8 = (undefined2 *)0x0;
  local_c = (LPCWSTR)0x0;
  local_10 = (HANDLE)0x0;
  local_14 = 0;
  hMem = (LPWSTR *)0x0;
  if ((param_1 != (LPCWSTR)0x0) && (*param_1 != L'\0')) {
    hMem = CommandLineToArgvW(param_1,&local_14);
    if (hMem == (LPWSTR *)0x0) {
      DVar2 = GetLastError();
      uVar5 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar5 = DVar2;
      }
      if (-1 < (int)uVar5) {
        uVar5 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar5,"Failed to get command line.");
      goto LAB_00401a48;
    }
    iVar6 = 0;
    if (0 < local_14) {
      do {
        WVar1 = *hMem[iVar6];
        if ((WVar1 == L'-') || (WVar1 == L'/')) {
          iVar3 = CompareStringW(0x7f,1,hMem[iVar6] + 1,-1,L"burn.runonce",-1);
          if (iVar3 != 2) goto LAB_004019d9;
        }
        else {
LAB_004019d9:
          FUN_004312a7((int *)&local_8,hMem[iVar6]);
        }
        iVar6 = iVar6 + 1;
      } while (iVar6 < local_14);
    }
  }
  uVar5 = FUN_00431c19((int *)&local_c,(HMODULE)0x0);
  if ((int)uVar5 < 0) {
    FUN_00430a57(uVar5,"Failed to get current process path.");
  }
  else {
    puVar4 = &DAT_0043b580;
    if (local_8 != (undefined2 *)0x0) {
      puVar4 = local_8;
    }
    uVar5 = FUN_00431ece(local_c,puVar4,param_2,&local_10);
    if ((int)uVar5 < 0) {
      FUN_00430a57(uVar5,"Failed to re-launch bundle process after RunOnce: %ls");
    }
  }
  if (hMem != (LPWSTR *)0x0) {
    LocalFree(hMem);
  }
LAB_00401a48:
  if (local_10 != (HANDLE)0x0) {
    CloseHandle(local_10);
    local_10 = (HANDLE)0x0;
  }
  if (local_8 != (undefined2 *)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return uVar5;
}



/* Function: FUN_00401a7c */

void FUN_00401a7c(LPCRITICAL_SECTION param_1)

{
  if (param_1[0x31].OwningThread != (LPVOID)0x0) {
    FUN_004380ab(param_1[0x31].OwningThread);
  }
  FUN_0040f16a(&param_1[0x30].LockCount);
  FUN_0040f16a(&param_1[0x2f].LockCount);
  if (param_1[0x2f].DebugInfo != (PRTL_CRITICAL_SECTION_DEBUG)0x0) {
    FUN_004380ab(param_1[0x2f].DebugInfo);
  }
  if ((HANDLE)param_1[0x27].LockCount != (HANDLE)0x0) {
    CloseHandle((HANDLE)param_1[0x27].LockCount);
    param_1[0x27].LockCount = 0;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)&param_1[8].LockSemaphore);
  FUN_00408a55((uint *)&param_1[7].LockSemaphore);
  FUN_00409902((uint *)(param_1 + 0x1e));
  FUN_00404b0f((LPCRITICAL_SECTION)&param_1[5].LockSemaphore);
  FUN_004070c2(&param_1[7].RecursionCount);
  FUN_0040b5e1((uint *)&param_1[10].RecursionCount);
  FUN_00408422((int *)(param_1 + 0x1c));
  FUN_004097e5(&param_1[0x1c].RecursionCount);
  FUN_00407bc6((int *)&param_1[0x1b].LockSemaphore);
  FUN_00407a1f((uint *)(param_1 + 3));
  if (param_1[2].LockSemaphore != (HANDLE)0x0) {
    FUN_004380ab(param_1[2].LockSemaphore);
  }
  if (param_1[1].LockSemaphore != (HANDLE)0x0) {
    FUN_004380ab(param_1[1].LockSemaphore);
  }
  if (param_1[0x28].LockSemaphore != (LPVOID)0x0) {
    FUN_004380ab(param_1[0x28].LockSemaphore);
  }
  if (param_1[0x28].OwningThread != (LPVOID)0x0) {
    FUN_004380ab(param_1[0x28].OwningThread);
  }
  if ((LPVOID)param_1[0x28].RecursionCount != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x28].RecursionCount);
  }
  if (param_1[0x28].DebugInfo != (PRTL_CRITICAL_SECTION_DEBUG)0x0) {
    FUN_004380ab(param_1[0x28].DebugInfo);
  }
  if (param_1[0x2e].SpinCount != 0xffffffff) {
    TlsFree(param_1[0x2e].SpinCount);
  }
  DeleteCriticalSection(param_1);
  FUN_004267c0((uint *)param_1,0,0x4a8);
  return;
}



/* Function: FUN_00401bd3 */

void FUN_00401bd3(int param_1,LPCWSTR param_2,undefined4 param_3,undefined4 *param_4)

{
  int iVar1;
  uint uVar2;
  HMODULE pHVar3;
  BOOL BVar4;
  DWORD DVar5;
  int iVar6;
  char *pcVar7;
  _RTL_CRITICAL_SECTION local_5f0;
  int local_5d8;
  undefined4 local_5c4;
  int local_5b8;
  undefined1 local_538 [60];
  undefined4 local_4fc;
  short *local_4ec;
  int local_234;
  int local_198;
  int local_148;
  int local_144;
  int local_140;
  int local_13c;
  int local_138;
  int local_134;
  LPVOID local_130;
  int local_12c;
  undefined4 *local_128;
  _OSVERSIONINFOW local_124;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_138 = param_1;
  local_128 = param_4;
  local_12c = 0;
  local_140 = 0;
  local_148 = 0;
  local_144 = 0;
  local_13c = 0;
  FUN_004267c0(&local_124.dwOSVersionInfoSize,0,0x11c);
  local_130 = (LPVOID)0x0;
  local_134 = 0;
  FUN_004267c0((uint *)&local_5f0,0,0x4a8);
  uVar2 = FUN_00401036(&local_5f0);
  if ((int)uVar2 < 0) {
    pcVar7 = "Failed to initialize engine state.";
  }
  else {
    local_5c4 = param_3;
    FUN_00430eb8(3,0);
    FUN_00402019();
    uVar2 = CoInitializeEx((LPVOID)0x0,0);
    if ((int)uVar2 < 0) {
      pcVar7 = "Failed to initialize COM.";
    }
    else {
      local_12c = 1;
      pHVar3 = GetModuleHandleW((LPCWSTR)0x0);
      FUN_00430d08(pHVar3);
      local_140 = 1;
      uVar2 = FUN_00432369();
      if ((int)uVar2 < 0) {
        pcVar7 = "Failed to initialize Regutil.";
      }
      else {
        local_148 = local_12c;
        uVar2 = FUN_0043541a();
        if ((int)uVar2 < 0) {
          pcVar7 = "Failed to initialize Wiutil.";
        }
        else {
          local_144 = local_12c;
          uVar2 = FUN_00435dca();
          if ((int)uVar2 < 0) {
            pcVar7 = "Failed to initialize XML util.";
          }
          else {
            local_13c = local_12c;
            local_124.dwOSVersionInfoSize = 0x11c;
            BVar4 = GetVersionExW(&local_124);
            if (BVar4 == 0) {
              DVar5 = GetLastError();
              uVar2 = DVar5 & 0xffff | 0x80070000;
              if ((int)DVar5 < 1) {
                uVar2 = DVar5;
              }
              if (-1 < (int)uVar2) {
                uVar2 = 0x80004005;
              }
              FUN_004300d9();
              pcVar7 = "Failed to get OS info.";
            }
            else {
              FUN_00431c19((int *)&local_130,(HMODULE)0x0);
              FUN_00402003(2,0x20000001);
              if (local_130 != (LPVOID)0x0) {
                FUN_004380ab(local_130);
                local_130 = (LPVOID)0x0;
              }
              uVar2 = FUN_00411570(param_2,(int)&local_5f0);
              if ((int)uVar2 < 0) {
                pcVar7 = "Failed to initialize core.";
              }
              else if (local_198 == 0) {
                local_134 = local_12c;
                uVar2 = FUN_004016ed(local_138,(uint)&local_5f0);
                if (-1 < (int)uVar2) {
LAB_00401eb4:
                  *local_128 = local_4fc;
                  iVar6 = local_5d8;
                  goto LAB_00401ec8;
                }
                pcVar7 = "Failed to run per-user mode.";
              }
              else if (local_198 == 1) {
                uVar2 = FUN_004014bb(local_138,param_2,(int)&local_5f0);
                if (-1 < (int)uVar2) goto LAB_00401eb4;
                pcVar7 = "Failed to run per-machine mode.";
              }
              else if (local_198 == 2) {
                local_134 = local_12c;
                uVar2 = FUN_004016a6(local_138,(uint)&local_5f0);
                if (-1 < (int)uVar2) goto LAB_00401eb4;
                pcVar7 = "Failed to run embedded mode.";
              }
              else if (local_198 == 3) {
                uVar2 = FUN_00401928(param_2,(WORD)param_3);
                if (-1 < (int)uVar2) goto LAB_00401eb4;
                pcVar7 = "Failed to run RunOnce mode.";
              }
              else {
                uVar2 = 0x8000ffff;
                pcVar7 = "Invalid run mode.";
              }
            }
          }
        }
      }
    }
  }
  FUN_00430a57(uVar2,pcVar7);
  iVar6 = 0;
LAB_00401ec8:
  if (local_130 != (LPVOID)0x0) {
    FUN_004380ab(local_130);
  }
  if (((int)uVar2 < 0) && (local_234 == 0)) {
    FUN_00430d33((WCHAR *)0x0,L"Setup",L"_Failed",(short *)&DAT_0043b700,0,0,(int *)0x0);
  }
  FUN_004089d9((int)local_538);
  FUN_00413f69(local_4ec);
  if (((iVar6 != 0) && (local_5b8 != 0)) && (local_5b8 != 6)) {
    FUN_0040e82a(local_5b8);
    FUN_00402003(2,0xa0000008);
    iVar6 = 0;
  }
  FUN_00401a7c(&local_5f0);
  if (local_13c != 0) {
    FUN_004360cc();
  }
  if (local_144 != 0) {
    FUN_00435810();
  }
  if (local_148 != 0) {
    FUN_0043299b();
  }
  if (local_12c != 0) {
    CoUninitialize();
  }
  if (local_134 != 0) {
    FUN_0040e33b(iVar6);
    FUN_00402003(2,0x20000007);
    if (iVar6 != 0) {
      FUN_00402003(2,0xa0000005);
    }
  }
  iVar1 = local_140;
  if (local_140 != 0) {
    FUN_00430935(0);
  }
  if (iVar6 != 0) {
    FUN_004011bf();
  }
  if (iVar1 != 0) {
    FUN_00431001(0);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00402003 */

void __cdecl FUN_00402003(int param_1,DWORD param_2)

{
  FUN_00430cd0(param_1,param_2,(LPCVOID)0x0,&stack0x0000000c);
  return;
}



/* Function: FUN_00402019 */

void FUN_00402019(void)

{
  DAT_00456f4c = InitiateSystemShutdownExW_exref;
  return;
}



/* Function: FUN_00402024 */

DWORD FUN_00402024(int param_1,PCNZWCH param_2,undefined4 param_3,undefined4 param_4,
                  undefined4 param_5)

{
  DWORD DVar1;
  int iVar2;
  int local_8;
  
  local_8 = 0;
  DVar1 = FUN_004020a3(param_1,param_2,&local_8);
  iVar2 = local_8;
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to find variable value.");
  }
  else if ((DVar1 == 1) && (DVar1 = FUN_0040348a(param_1,param_2,local_8), (int)DVar1 < 0)) {
    FUN_00430a57(DVar1,"Failed to insert variable.");
  }
  else {
    iVar2 = iVar2 * 0x30 + *(int *)(param_1 + 0x20);
    *(undefined4 *)(iVar2 + 0x1c) = param_5;
    *(undefined4 *)(iVar2 + 0x24) = param_3;
    *(undefined4 *)(iVar2 + 0x20) = 1;
    *(undefined4 *)(iVar2 + 0x28) = param_4;
  }
  return DVar1;
}



/* Function: FUN_004020a3 */

DWORD FUN_004020a3(int param_1,PCNZWCH param_2,int *param_3)

{
  uint uVar1;
  uint uVar2;
  int iVar3;
  DWORD DVar4;
  int iVar5;
  
  iVar5 = 0;
  uVar2 = *(uint *)(param_1 + 0x1c);
  while( true ) {
    do {
      uVar1 = uVar2;
      if (uVar1 == 0) {
        *param_3 = iVar5;
        return 1;
      }
      uVar2 = uVar1 >> 1;
      iVar3 = CompareStringW(0x7f,0x1000,param_2,-1,
                             *(PCNZWCH *)((uVar2 + iVar5) * 0x30 + *(int *)(param_1 + 0x20)),-1);
    } while (iVar3 == 1);
    if (iVar3 == 2) break;
    if (iVar3 != 3) {
      DVar4 = GetLastError();
      uVar2 = DVar4 & 0xffff | 0x80070000;
      if ((int)DVar4 < 1) {
        uVar2 = DVar4;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar2,"Failed to compare strings.");
      return uVar2;
    }
    iVar5 = uVar2 + iVar5 + 1;
    uVar2 = uVar1 + (-1 - uVar2);
  }
  *param_3 = uVar2 + iVar5;
  return 0;
}



/* Function: FUN_00402162 */

DWORD FUN_00402162(LPCRITICAL_SECTION param_1,LPCWSTR param_2,int *param_3,uint *param_4,int param_5
                  )

{
  SIZE_T SVar1;
  short *psVar2;
  int iVar3;
  LPCWSTR pWVar4;
  ushort *puVar5;
  LPVOID pvVar6;
  int *piVar7;
  uint uVar8;
  uint uVar9;
  uint uVar10;
  wchar_t *pwVar11;
  char *pcVar12;
  int local_24;
  LPCWSTR local_20;
  int local_1c;
  LPVOID local_18;
  uint local_14;
  LPVOID local_10;
  PCNZWCH local_c;
  uint local_8;
  
  uVar10 = 0;
  local_18 = (LPVOID)0x0;
  local_c = (PCNZWCH)0x0;
  local_10 = (LPVOID)0x0;
  local_8 = 0;
  local_14 = 0;
  local_24 = 0;
  local_1c = 0;
  EnterCriticalSection(param_1);
  iVar3 = lstrlenW(param_2);
  pWVar4 = (LPCWSTR)FUN_00433bdf((int *)&local_18,iVar3 + 1);
  if ((int)pWVar4 < 0) {
    FUN_00430a57(pWVar4,"Failed to allocate buffer for format string.");
    uVar8 = 0;
    param_2 = pWVar4;
    goto LAB_00402603;
  }
  pWVar4 = (LPCWSTR)FUN_00426e94((ushort *)param_2,0x5b);
  while (pWVar4 != (LPCWSTR)0x0) {
    local_20 = pWVar4 + 1;
    puVar5 = FUN_00426e94((ushort *)local_20,0x5d);
    if (puVar5 == (ushort *)0x0) break;
    local_14 = ((int)puVar5 - (int)pWVar4 >> 1) - 1;
    if (local_14 == 0) {
      param_2 = (LPCWSTR)FUN_00433c35((int *)&local_18,param_2,((int)puVar5 - (int)param_2 >> 1) + 1
                                     );
      if ((int)param_2 < 0) goto LAB_00402213;
    }
    else {
      if ((param_2 < pWVar4) &&
         (param_2 = (LPCWSTR)FUN_00433c35((int *)&local_18,param_2,(int)pWVar4 - (int)param_2 >> 1),
         (int)param_2 < 0)) goto LAB_00402213;
      param_2 = (LPCWSTR)FUN_00433f88((int *)&local_c,local_20,local_14);
      uVar8 = local_8;
      if ((int)param_2 < 0) {
        pcVar12 = "Failed to get variable name.";
        goto LAB_00402219;
      }
      SVar1 = local_8 * 4 + 4;
      if (local_10 == (LPVOID)0x0) {
        pvVar6 = (LPVOID)FUN_00431078(SVar1,1);
        if (pvVar6 == (LPVOID)0x0) {
          local_10 = pvVar6;
          FUN_004300d9();
          pcVar12 = "Failed to allocate variable array.";
          goto LAB_004023f6;
        }
      }
      else {
        pvVar6 = (LPVOID)FUN_0043120c(local_10,SVar1,1);
        if (pvVar6 == (LPVOID)0x0) {
          FUN_004300d9();
          pcVar12 = "Failed to reallocate variable array.";
          goto LAB_004023f6;
        }
      }
      local_10 = pvVar6;
      if ((local_14 < 2) || (*local_20 != L'\\')) {
        if ((param_5 != 0) &&
           (param_2 = (LPCWSTR)FUN_00403619(param_1,local_c,&local_24), (int)param_2 < 0)) {
          FUN_00430a57(param_2,"Failed to determine variable visibility: \'%ls\'.");
          uVar8 = local_8;
          goto LAB_00402603;
        }
        piVar7 = (int *)((int)local_10 + uVar8 * 4);
        if (local_24 != 0) {
          uVar9 = 0;
          pwVar11 = L"*****";
          goto LAB_004022ec;
        }
        param_2 = (LPCWSTR)FUN_00403ac6(param_1,local_c,piVar7);
        if (param_2 == (LPCWSTR)0x80070490) {
          param_2 = (LPCWSTR)FUN_00433f88(piVar7,L"",0);
        }
      }
      else {
        pwVar11 = pWVar4 + 2;
        uVar9 = 1;
        piVar7 = (int *)((int)pvVar6 + uVar8 * 4);
LAB_004022ec:
        param_2 = (LPCWSTR)FUN_00433f88(piVar7,pwVar11,uVar9);
      }
      if ((int)param_2 < 0) {
        pcVar12 = "Failed to set variable value.";
        goto LAB_00402219;
      }
      local_8 = uVar8 + 1;
      param_2 = (LPCWSTR)FUN_00433cea((int *)&local_c,L"[%d]");
      if ((int)param_2 < 0) {
        pcVar12 = "Failed to format placeholder string.";
        goto LAB_00402219;
      }
      param_2 = (LPCWSTR)FUN_00433c35((int *)&local_18,local_c,0);
      if ((int)param_2 < 0) {
        pcVar12 = "Failed to append placeholder.";
        goto LAB_00402219;
      }
    }
    param_2 = (LPCWSTR)(puVar5 + 1);
    pWVar4 = (LPCWSTR)FUN_00426e94((ushort *)param_2,0x5b);
  }
  param_2 = (LPCWSTR)FUN_00433c35((int *)&local_18,param_2,0);
  uVar8 = local_8;
  if ((int)param_2 < 0) {
LAB_00402213:
    pcVar12 = "Failed to append string.";
  }
  else {
    local_1c = Ordinal_17(local_8);
    if (local_1c == 0) {
      FUN_004300d9();
      pcVar12 = "Failed to allocate record.";
LAB_004023f6:
      param_2 = (LPCWSTR)0x8007000e;
    }
    else {
      pWVar4 = (LPCWSTR)Ordinal_125(local_1c,0,local_18);
      if (pWVar4 != (LPCWSTR)0x0) {
        param_2 = (LPCWSTR)((uint)pWVar4 & 0xffff | 0x80070000);
        if ((int)pWVar4 < 1) {
          param_2 = pWVar4;
        }
        if (-1 < (int)param_2) {
          param_2 = (LPCWSTR)0x80004005;
        }
        FUN_004300d9();
        FUN_00430a57(param_2,"Failed to set record format string.");
        goto LAB_00402603;
      }
      uVar9 = 0;
      uVar8 = local_8;
      pvVar6 = local_10;
      if (local_8 != 0) {
        do {
          psVar2 = *(short **)((int)pvVar6 + uVar9 * 4);
          if ((*psVar2 != 0) &&
             (pWVar4 = (LPCWSTR)Ordinal_125(local_1c,uVar9 + 1,psVar2), uVar8 = local_8,
             pvVar6 = local_10, pWVar4 != (LPCWSTR)0x0)) {
            param_2 = (LPCWSTR)((uint)pWVar4 & 0xffff | 0x80070000);
            if ((int)pWVar4 < 1) {
              param_2 = pWVar4;
            }
            if (-1 < (int)param_2) {
              param_2 = (LPCWSTR)0x80004005;
            }
            FUN_004300d9();
            pcVar12 = "Failed to set record string.";
            goto LAB_00402219;
          }
          uVar9 = uVar9 + 1;
        } while (uVar9 < uVar8);
      }
      iVar3 = local_1c;
      local_14 = 0;
      pWVar4 = (LPCWSTR)Ordinal_171(0,local_1c,&DAT_0043b580,&local_14);
      if ((pWVar4 == (LPCWSTR)0xea) || (pWVar4 == (LPCWSTR)0x0)) {
        if (param_3 == (int *)0x0) {
LAB_004025f4:
          uVar8 = local_8;
          if (param_4 != (uint *)0x0) {
            *param_4 = local_14;
          }
          goto LAB_00402603;
        }
        local_14 = local_14 + 1;
        param_2 = (LPCWSTR)FUN_00433bdf((int *)&local_c,local_14);
        if ((int)param_2 < 0) {
          pcVar12 = "Failed to allocate string.";
        }
        else {
          pWVar4 = (LPCWSTR)Ordinal_171(0,iVar3,local_c,&local_14);
          if (pWVar4 == (LPCWSTR)0x0) {
            param_2 = (LPCWSTR)FUN_00433f88(param_3,local_c,0);
            if (-1 < (int)param_2) goto LAB_004025f4;
            pcVar12 = "Failed to copy string.";
          }
          else {
            param_2 = (LPCWSTR)((uint)pWVar4 & 0xffff | 0x80070000);
            if ((int)pWVar4 < 1) {
              param_2 = pWVar4;
            }
            if (-1 < (int)param_2) {
              param_2 = (LPCWSTR)0x80004005;
            }
            FUN_004300d9();
            pcVar12 = "Failed to format record.";
          }
        }
      }
      else {
        param_2 = (LPCWSTR)((uint)pWVar4 & 0xffff | 0x80070000);
        if ((int)pWVar4 < 1) {
          param_2 = pWVar4;
        }
        if (-1 < (int)param_2) {
          param_2 = (LPCWSTR)0x80004005;
        }
        FUN_004300d9();
        pcVar12 = "Failed to get formatted length.";
      }
    }
  }
LAB_00402219:
  FUN_00430a57(param_2,pcVar12);
  uVar8 = local_8;
LAB_00402603:
  LeaveCriticalSection(param_1);
  pvVar6 = local_10;
  if (local_10 != (LPVOID)0x0) {
    if (uVar8 != 0) {
      do {
        if (*(int *)((int)pvVar6 + uVar10 * 4) != 0) {
          FUN_004380ab(*(LPVOID *)((int)pvVar6 + uVar10 * 4));
        }
        uVar10 = uVar10 + 1;
      } while (uVar10 < uVar8);
    }
    FUN_00431137(local_10);
  }
  if (local_1c != 0) {
    Ordinal_8(local_1c);
  }
  if (local_18 != (LPVOID)0x0) {
    FUN_004380ab(local_18);
  }
  if (local_c != (PCNZWCH)0x0) {
    FUN_004380ab(local_c);
  }
  return (DWORD)param_2;
}



/* Function: FUN_0040266a */

uint FUN_0040266a(int param_1,int *param_2)

{
  uint uVar1;
  wchar_t *pwVar2;
  char *pcVar3;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  pwVar2 = L"CommonFilesDir";
  if (param_1 != 0x2b) {
    pwVar2 = L"ProgramFilesDir";
  }
  uVar1 = FUN_004324d5(0x80000002,L"SOFTWARE\\Microsoft\\Windows\\CurrentVersion",0x20119,&local_8);
  if ((int)uVar1 < 0) {
    pcVar3 = "Failed to open Windows folder key.";
  }
  else {
    uVar1 = FUN_00432602(local_8,pwVar2,param_2);
    if ((int)uVar1 < 0) {
      FUN_00430a57(uVar1,"Failed to read folder path for \'%ls\'.");
      goto LAB_004026e8;
    }
    uVar1 = FUN_0043124a(param_2);
    if (-1 < (int)uVar1) goto LAB_004026e8;
    pcVar3 = "Failed to ensure path was backslash terminated.";
  }
  FUN_00430a57(uVar1,pcVar3);
LAB_004026e8:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  return uVar1;
}



/* Function: FUN_004026ff */

DWORD FUN_004026ff(int param_1,PCNZWCH param_2,int *param_3)

{
  DWORD DVar1;
  int iVar2;
  int local_8;
  
  local_8 = 0;
  DVar1 = FUN_004020a3(param_1,param_2,&local_8);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to find variable value \'%ls\'.");
  }
  else if (DVar1 == 1) {
    DVar1 = 0x80070490;
  }
  else {
    iVar2 = local_8 * 0x30 + *(int *)(param_1 + 0x20);
    if (((*(int *)(iVar2 + 0x10) == 0) && (*(int *)(iVar2 + 0x20) != 0)) &&
       (DVar1 = (**(code **)(iVar2 + 0x24))(*(undefined4 *)(iVar2 + 0x28),iVar2 + 8), (int)DVar1 < 0
       )) {
      FUN_00430a57(DVar1,"Failed to initialize built-in variable value \'%ls\'.");
    }
    else {
      *param_3 = iVar2;
    }
  }
  return DVar1;
}



/* Function: FUN_00402785 */

int FUN_00402785(undefined4 param_1,int *param_2)

{
  LANGID LVar1;
  int iVar2;
  
  LVar1 = GetSystemDefaultLangID();
  iVar2 = FUN_00418d81(param_2,(uint)LVar1,0);
  if (iVar2 < 0) {
    FUN_00430a57(iVar2,"Failed to set variant value.");
  }
  return iVar2;
}



/* Function: FUN_004027b7 */

int FUN_004027b7(undefined4 param_1,int *param_2)

{
  LANGID LVar1;
  int iVar2;
  
  LVar1 = GetUserDefaultLangID();
  iVar2 = FUN_00418d81(param_2,(uint)LVar1,0);
  if (iVar2 < 0) {
    FUN_00430a57(iVar2,"Failed to set variant value.");
  }
  return iVar2;
}



/* Function: FUN_004027e9 */

uint FUN_004027e9(uint param_1,int *param_2)

{
  HANDLE pvVar1;
  uint uVar2;
  int *piVar3;
  char *pcVar4;
  int local_c;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  local_c = 0;
  piVar3 = &local_c;
  pvVar1 = GetCurrentProcess();
  FUN_00432058(pvVar1,piVar3);
  if (local_c == 0) {
    uVar2 = FUN_004363eb((int *)&local_8,param_1);
    if ((int)uVar2 < 0) {
      FUN_004300d9();
      pcVar4 = "Failed to get shell folder.";
    }
    else {
LAB_0040284c:
      uVar2 = FUN_00418dbd(param_2,local_8,0);
      if (-1 < (int)uVar2) goto LAB_0040286c;
      pcVar4 = "Failed to set variant value.";
    }
  }
  else {
    uVar2 = FUN_0040266a(param_1,(int *)&local_8);
    if (-1 < (int)uVar2) goto LAB_0040284c;
    pcVar4 = "Failed to get 64-bit folder.";
  }
  FUN_00430a57(uVar2,pcVar4);
LAB_0040286c:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar2;
}



/* Function: FUN_00402881 */

void FUN_00402881(undefined4 param_1,int *param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  int iVar3;
  uint uVar4;
  WCHAR *pWVar5;
  char *pcVar6;
  DWORD local_2c;
  WCHAR local_28 [16];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  pWVar5 = local_28;
  for (iVar3 = 8; iVar3 != 0; iVar3 = iVar3 + -1) {
    pWVar5[0] = L'\0';
    pWVar5[1] = L'\0';
    pWVar5 = pWVar5 + 2;
  }
  local_2c = 0x10;
  BVar1 = GetComputerNameW(local_28,&local_2c);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar6 = "Failed to get computer name.";
  }
  else {
    uVar4 = FUN_00418dbd(param_2,local_28,0);
    if (-1 < (int)uVar4) goto LAB_0040290d;
    pcVar6 = "Failed to set variant value.";
  }
  FUN_00430a57(uVar4,pcVar6);
LAB_0040290d:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0040291f */

int FUN_0040291f(uint param_1,int *param_2)

{
  int iVar1;
  char *pcVar2;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  iVar1 = FUN_004363eb((int *)&local_8,param_1);
  if (iVar1 < 0) {
    FUN_004300d9();
    pcVar2 = "Failed to get shell folder.";
  }
  else {
    iVar1 = FUN_00418dbd(param_2,local_8,0);
    if (-1 < iVar1) goto LAB_00402971;
    pcVar2 = "Failed to set variant value.";
  }
  FUN_00430a57(iVar1,pcVar2);
LAB_00402971:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_00402986 */

void FUN_00402986(undefined4 param_1,int *param_2)

{
  uint cchDate;
  DWORD DVar1;
  uint uVar2;
  int iVar3;
  char *pcVar4;
  LPWSTR local_1c;
  _SYSTEMTIME local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_18.wYear = 0;
  local_18.wMonth = 0;
  local_18.wDayOfWeek = 0;
  local_18.wDay = 0;
  local_18.wHour = 0;
  local_18.wMinute = 0;
  local_18.wSecond = 0;
  local_18.wMilliseconds = 0;
  local_1c = (LPWSTR)0x0;
  GetSystemTime(&local_18);
  cchDate = GetDateFormatW(0x400,1,&local_18,(LPCWSTR)0x0,(LPWSTR)0x0,0);
  if (cchDate == 0) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) goto LAB_00402a02;
    FUN_004300d9();
    pcVar4 = "Failed to get the required buffer length for the Date.";
  }
  else {
LAB_00402a02:
    uVar2 = FUN_00433bdf((int *)&local_1c,cchDate);
    if ((int)uVar2 < 0) {
      pcVar4 = "Failed to allocate the buffer for the Date.";
    }
    else {
      iVar3 = GetDateFormatW(0x400,1,&local_18,(LPCWSTR)0x0,local_1c,cchDate);
      if (iVar3 == 0) {
        DVar1 = GetLastError();
        uVar2 = DVar1 & 0xffff | 0x80070000;
        if ((int)DVar1 < 1) {
          uVar2 = DVar1;
        }
        if ((int)uVar2 < 0) {
          FUN_004300d9();
          pcVar4 = "Failed to get the Date.";
          goto LAB_00402a76;
        }
      }
      uVar2 = FUN_00418dbd(param_2,local_1c,cchDate);
      if (-1 < (int)uVar2) goto LAB_00402a7e;
      pcVar4 = "Failed to set variant value.";
    }
  }
LAB_00402a76:
  FUN_00430a57(uVar2,pcVar4);
LAB_00402a7e:
  if (local_1c != (LPWSTR)0x0) {
    FUN_004380ab(local_1c);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00402a9f */

int FUN_00402a9f(undefined4 param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_00418dbd(param_2,L"WiX Burn",0);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to set variant value.");
  }
  return iVar1;
}



/* Function: FUN_00402acc */

DWORD FUN_00402acc(undefined4 param_1,int *param_2)

{
  DWORD DVar1;
  char *pcVar2;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  DVar1 = FUN_00434004((int *)&local_8,"3.8.1128.0",0,0);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to copy the engine version.";
  }
  else {
    DVar1 = FUN_00418dbd(param_2,local_8,0);
    if (-1 < (int)DVar1) goto LAB_00402b13;
    pcVar2 = "Failed to set variant value.";
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_00402b13:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_00402b28 */

void FUN_00402b28(undefined4 param_1,int *param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  char *pcVar4;
  DWORD local_210;
  WCHAR local_20c [258];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_210 = 0x101;
  BVar1 = GetUserNameW(local_20c,&local_210);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) goto LAB_00402b91;
    FUN_004300d9();
    pcVar4 = "Failed to get the user name.";
  }
  else {
LAB_00402b91:
    uVar3 = FUN_00418dbd(param_2,local_20c,0);
    if (-1 < (int)uVar3) goto LAB_00402bb3;
    pcVar4 = "Failed to set variant value.";
  }
  FUN_00430a57(uVar3,pcVar4);
LAB_00402bb3:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00402bc5 */

int FUN_00402bc5(int param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_00418d81(param_2,param_1,0);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to set variant value.");
  }
  return iVar1;
}



/* Function: FUN_00402bf0 */

void FUN_00402bf0(undefined4 param_1,int *param_2)

{
  DWORDLONG dwlConditionMask;
  BOOL BVar1;
  DWORD DVar2;
  WORD WVar3;
  uint uVar4;
  undefined8 uVar5;
  char *pcVar6;
  uint local_134;
  int local_130;
  undefined4 local_12c;
  undefined4 uStack_128;
  _OSVERSIONINFOEXW local_124;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0(&local_124.dwOSVersionInfoSize,0,0x11c);
  local_134 = 0;
  local_130 = 0;
  local_12c = 0;
  uStack_128 = 0;
  local_124.dwOSVersionInfoSize = 0x11c;
  BVar1 = GetVersionExW((LPOSVERSIONINFOW)&local_124);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar6 = "Failed to get OS info.";
    goto LAB_00402d5d;
  }
  switch(param_1) {
  case 4:
    goto LAB_00402c99;
  case 5:
    WVar3 = 4;
    break;
  case 6:
    WVar3 = 0x80;
    break;
  case 7:
    WVar3 = 2;
    break;
  case 8:
    WVar3 = 0x200;
    break;
  case 9:
    local_134 = (uint)(local_124.wSuiteMask == 1);
    goto LAB_00402d38;
  case 10:
    WVar3 = 0x20;
    break;
  case 0xb:
    WVar3 = 0x400;
    break;
  case 0xc:
    uVar5 = VerSetConditionMask(0,0,2,1);
    uVar5 = VerSetConditionMask(uVar5,1,1);
    uVar5 = VerSetConditionMask(uVar5,0x20,1);
    dwlConditionMask = (DWORDLONG)VerSetConditionMask(uVar5,0x10,1);
    local_134 = VerifyVersionInfoW(&local_124,0x33,dwlConditionMask);
    goto LAB_00402d38;
  case 0xd:
    local_134 = 0;
    if (((local_124._280_4_ & 0x10) != 0) && ((local_124._280_4_ & 0x100) == 0)) {
      local_134 = 1;
    }
    goto LAB_00402d38;
  default:
    goto switchD_00402c8e_default;
  }
  local_124.wProductType = WVar3 == local_124.wSuiteMask;
LAB_00402c99:
  local_134 = (uint)local_124.wProductType;
LAB_00402d38:
  local_12c = 1;
  local_130 = (int)local_134 >> 0x1f;
switchD_00402c8e_default:
  uVar4 = FUN_00418be2((int *)&local_134,param_2);
  if ((int)uVar4 < 0) {
    pcVar6 = "Failed to set variant value.";
LAB_00402d5d:
    FUN_00430a57(uVar4,pcVar6);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00402da0 */

int FUN_00402da0(undefined4 param_1,int *param_2)

{
  int iVar1;
  char *pcVar2;
  BOOL local_8;
  
  local_8 = 0;
  iVar1 = FUN_004360f6(&local_8);
  if (iVar1 < 0) {
    pcVar2 = "Failed to check if process could run privileged.";
  }
  else {
    iVar1 = FUN_00418d81(param_2,local_8,local_8 >> 0x1f);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to set variant value.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_00402de7 */

int FUN_00402de7(undefined4 param_1,int *param_2)

{
  bool bVar1;
  HRESULT HVar2;
  int iVar3;
  uint local_8;
  
  bVar1 = false;
  local_8 = 0;
  HVar2 = CoInitialize((LPVOID)0x0);
  if ((-1 < HVar2) || (HVar2 == -0x7ffefefa)) {
    bVar1 = true;
    HVar2 = FUN_004364d4(&local_8);
    if (HVar2 < 0) {
      local_8 = 0;
    }
  }
  iVar3 = FUN_00418d81(param_2,local_8,(int)local_8 >> 0x1f);
  if (iVar3 < 0) {
    FUN_00430a57(iVar3,"Failed to set reboot pending variant value.");
  }
  if (bVar1) {
    CoUninitialize();
  }
  return iVar3;
}



/* Function: FUN_00402e54 */

uint FUN_00402e54(int param_1,int *param_2)

{
  HANDLE pvVar1;
  uint uVar2;
  int *piVar3;
  char *pcVar4;
  int local_c;
  LPCWSTR local_8;
  
  piVar3 = &local_c;
  uVar2 = 0;
  local_8 = (LPCWSTR)0x0;
  local_c = 0;
  pvVar1 = GetCurrentProcess();
  FUN_00432058(pvVar1,piVar3);
  if (local_c != 0) {
    uVar2 = FUN_0040266a(param_1,(int *)&local_8);
    if ((int)uVar2 < 0) {
      pcVar4 = "Failed to get 64-bit folder.";
    }
    else {
      uVar2 = FUN_00418dbd(param_2,local_8,0);
      if (-1 < (int)uVar2) goto LAB_00402eb0;
      pcVar4 = "Failed to set variant value.";
    }
    FUN_00430a57(uVar2,pcVar4);
  }
LAB_00402eb0:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar2;
}



/* Function: FUN_00402ec5 */

int FUN_00402ec5(LPCWSTR param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_00418dbd(param_2,param_1,0);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to set variant value.");
  }
  return iVar1;
}



/* Function: FUN_00402ef0 */

void FUN_00402ef0(int param_1,int *param_2)

{
  UINT UVar1;
  uint uVar2;
  DWORD DVar3;
  uint uVar4;
  char *pcVar5;
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0((uint *)local_210,0,0x208);
  if (param_1 == 0) {
    UVar1 = GetSystemDirectoryW(local_210,0x104);
    if (UVar1 != 0) goto LAB_00402fbf;
    DVar3 = GetLastError();
    uVar4 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar4 = DVar3;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar5 = "Failed to get 64-bit system folder.";
  }
  else {
    UVar1 = GetSystemWow64DirectoryW(local_210,0x104);
    if (UVar1 == 0) {
      uVar2 = GetLastError();
      if (uVar2 != 0x78) {
        uVar2 = 0;
      }
      if (uVar2 != 0) {
        uVar4 = uVar2 & 0xffff | 0x80070000;
        if ((int)uVar2 < 1) {
          uVar4 = uVar2;
        }
        if (-1 < (int)uVar4) {
          uVar4 = 0x80004005;
        }
        FUN_004300d9();
        pcVar5 = "Failed to get 32-bit system folder.";
        goto LAB_00402ffd;
      }
    }
LAB_00402fbf:
    if (local_210[0] != L'\0') {
      uVar4 = FUN_00431bd3(local_210,0x104);
      if ((int)uVar4 < 0) {
        pcVar5 = "Failed to backslash terminate system folder.";
        goto LAB_00402ffd;
      }
    }
    uVar4 = FUN_00418dbd(param_2,local_210,0);
    if (-1 < (int)uVar4) goto LAB_00403005;
    pcVar5 = "Failed to set system folder variant value.";
  }
LAB_00402ffd:
  FUN_00430a57(uVar4,pcVar5);
LAB_00403005:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00403017 */

void FUN_00403017(undefined4 param_1,int *param_2)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0((uint *)local_210,0,0x208);
  DVar1 = GetTempPathW(0x104,local_210);
  if (DVar1 == 0) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to get temp path.";
  }
  else {
    uVar2 = FUN_00418dbd(param_2,local_210,0);
    if (-1 < (int)uVar2) goto LAB_004030b1;
    pcVar3 = "Failed to set variant value.";
  }
  FUN_00430a57(uVar2,pcVar3);
LAB_004030b1:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004030c2 */

int FUN_004030c2(int param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_00418e16(param_2,param_1,0);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to set variant value.");
  }
  return iVar1;
}



/* Function: FUN_004030ed */

void FUN_004030ed(undefined4 param_1,int *param_2)

{
  HMODULE hModule;
  FARPROC pFVar1;
  DWORD DVar2;
  uint uVar3;
  char *pcVar4;
  undefined4 local_1c;
  undefined4 local_18;
  undefined4 local_14;
  undefined4 uStack_10;
  undefined4 uStack_c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_1c = 0;
  local_18 = 0;
  local_14 = 0;
  uStack_10 = 0;
  pcVar4 = "DllGetVersion";
  uStack_c = 0;
  hModule = GetModuleHandleW(L"msi");
  pFVar1 = GetProcAddress(hModule,pcVar4);
  if (pFVar1 == (FARPROC)0x0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    pcVar4 = "Failed to find DllGetVersion entry point in msi.dll.";
  }
  else {
    local_1c = 0x14;
    uVar3 = (*pFVar1)(&local_1c);
    if ((int)uVar3 < 0) {
      pcVar4 = "Failed to get msi.dll version info.";
    }
    else {
      uVar3 = FUN_00418e16(param_2,0,CONCAT22((undefined2)local_18,(undefined2)local_14));
      if (-1 < (int)uVar3) goto LAB_004031a1;
      pcVar4 = "Failed to set variant value.";
    }
  }
  FUN_00430a57(uVar3,pcVar4);
LAB_004031a1:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004031b4 */

void FUN_004031b4(int param_1,int *param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  FARPROC pFVar3;
  HANDLE pvVar4;
  uint uVar5;
  char *pcVar6;
  int *piVar7;
  uint local_13c;
  undefined4 local_138;
  undefined4 local_134;
  undefined4 uStack_130;
  int local_12c;
  HMODULE local_128;
  uint local_124;
  undefined2 local_120;
  undefined2 local_11c;
  ushort local_10;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_128 = (HMODULE)0x0;
  FUN_004267c0(&local_124,0,0x11c);
  local_13c = 0;
  local_138 = 0;
  local_134 = 0;
  uStack_130 = 0;
  BVar1 = GetModuleHandleExW(0,L"ntdll",&local_128);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar5 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar5 = DVar2;
    }
    if (-1 < (int)uVar5) {
      uVar5 = 0x80004005;
    }
    FUN_004300d9();
    pcVar6 = "Failed to locate NTDLL.";
  }
  else {
    pFVar3 = GetProcAddress(local_128,"RtlGetVersion");
    if (pFVar3 == (FARPROC)0x0) {
      DVar2 = GetLastError();
      uVar5 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar5 = DVar2;
      }
      if (-1 < (int)uVar5) {
        uVar5 = 0x80004005;
      }
      FUN_004300d9();
      pcVar6 = "Failed to locate RtlGetVersion.";
    }
    else {
      local_124 = 0x11c;
      uVar5 = (*pFVar3)(&local_124);
      if ((int)uVar5 < 0) {
        pcVar6 = "Failed to get OS info.";
      }
      else {
        if (param_1 == 1) {
LAB_0040330b:
          local_138 = CONCAT22(local_120,local_11c);
          local_13c = 0;
          local_134 = 3;
        }
        else if (param_1 == 2) {
          local_12c = 0;
          piVar7 = &local_12c;
          pvVar4 = GetCurrentProcess();
          FUN_00432058(pvVar4,piVar7);
          if (local_12c != 0) goto LAB_0040330b;
        }
        else if ((param_1 == 3) && (local_10 != 0)) {
          local_13c = (uint)local_10;
          local_138 = 0;
          local_134 = 1;
        }
        uVar5 = FUN_00418be2((int *)&local_13c,param_2);
        if (-1 < (int)uVar5) goto LAB_00403356;
        pcVar6 = "Failed to set variant value.";
      }
    }
  }
  FUN_00430a57(uVar5,pcVar6);
LAB_00403356:
  if (local_128 != (HMODULE)0x0) {
    FreeLibrary(local_128);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0040337e */

void FUN_0040337e(undefined4 param_1,int *param_2)

{
  UINT UVar1;
  DWORD DVar2;
  BOOL BVar3;
  uint uVar4;
  char *pcVar5;
  WCHAR local_418 [260];
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0((uint *)local_210,0,0x208);
  FUN_004267c0((uint *)local_418,0,0x208);
  UVar1 = GetWindowsDirectoryW(local_210,0x104);
  if (UVar1 == 0) {
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar5 = "Failed to get windows directory.";
  }
  else {
    BVar3 = GetVolumePathNameW(local_210,local_418,0x104);
    if (BVar3 == 0) {
      DVar2 = GetLastError();
      uVar4 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar4 = DVar2;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to get volume path name.";
    }
    else {
      uVar4 = FUN_00418dbd(param_2,local_418,0);
      if (-1 < (int)uVar4) goto LAB_00403478;
      pcVar5 = "Failed to set variant value.";
    }
  }
  FUN_00430a57(uVar4,pcVar5);
LAB_00403478:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0040348a */

int FUN_0040348a(int param_1,LPCWSTR param_2,int param_3)

{
  uint *puVar1;
  uint uVar2;
  int iVar3;
  undefined8 *puVar4;
  char *pcVar5;
  SIZE_T local_8;
  
  local_8 = 0;
  puVar1 = (uint *)(param_1 + 0x18);
  if (*(uint *)(param_1 + 0x1c) == *puVar1) {
    iVar3 = FUN_00430249(*puVar1,3,puVar1);
    if (iVar3 < 0) {
      FUN_004300d9();
      pcVar5 = "Overflow while growing variable array size";
      goto LAB_004035d4;
    }
    if (*(int *)(param_1 + 0x20) == 0) {
      iVar3 = FUN_00431078(*puVar1 * 0x30,1);
      *(int *)(param_1 + 0x20) = iVar3;
      if (iVar3 != 0) goto LAB_0040357e;
      FUN_004300d9();
      pcVar5 = "Failed to allocate room for variables.";
    }
    else {
      iVar3 = FUN_0043026c((int)((ulonglong)*puVar1 * 0x30),(int)((ulonglong)*puVar1 * 0x30 >> 0x20)
                           ,&local_8);
      if (iVar3 < 0) {
        FUN_004300d9();
        pcVar5 = "Overflow while calculating size of variable array buffer";
        goto LAB_004035d4;
      }
      iVar3 = FUN_0043120c(*(LPVOID *)(param_1 + 0x20),local_8,0);
      if (iVar3 != 0) {
        uVar2 = *(uint *)(param_1 + 0x1c);
        if (*puVar1 < uVar2) {
          iVar3 = -0x7ff8fdea;
          FUN_004300d9();
          pcVar5 = "Overflow while dealing with variable array buffer allocation";
          goto LAB_004035d4;
        }
        *(int *)(param_1 + 0x20) = iVar3;
        FUN_004267c0((uint *)(uVar2 * 0x30 + iVar3),0,(*puVar1 - uVar2) * 0x30);
        goto LAB_0040357e;
      }
      FUN_004300d9();
      pcVar5 = "Failed to allocate room for more variables.";
    }
    iVar3 = -0x7ff8fff2;
  }
  else {
LAB_0040357e:
    iVar3 = *(int *)(param_1 + 0x1c) - param_3;
    if (iVar3 != 0) {
      puVar4 = (undefined8 *)(*(int *)(param_1 + 0x20) + param_3 * 0x30);
      FUN_00426850(puVar4 + 6,puVar4,iVar3 * 0x30);
      FUN_004267c0((uint *)(*(int *)(param_1 + 0x20) + param_3 * 0x30),0,0x30);
    }
    *(int *)(param_1 + 0x1c) = *(int *)(param_1 + 0x1c) + 1;
    iVar3 = FUN_00433f88((int *)(param_3 * 0x30 + *(int *)(param_1 + 0x20)),param_2,0);
    if (-1 < iVar3) {
      return iVar3;
    }
    pcVar5 = "Failed to copy variable name.";
  }
LAB_004035d4:
  FUN_00430a57(iVar3,pcVar5);
  return iVar3;
}



/* Function: FUN_00403619 */

DWORD FUN_00403619(LPCRITICAL_SECTION param_1,PCNZWCH param_2,undefined4 *param_3)

{
  DWORD DVar1;
  int local_8;
  
  local_8 = 0;
  EnterCriticalSection(param_1);
  DVar1 = FUN_004026ff((int)param_1,param_2,&local_8);
  if (DVar1 == 0x80070490) {
    *param_3 = 0;
    DVar1 = 0;
  }
  else if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to get visibility of variable: %ls");
  }
  else {
    *param_3 = *(undefined4 *)(local_8 + 0x18);
  }
  LeaveCriticalSection(param_1);
  return DVar1;
}



/* Function: FUN_00403680 */

DWORD FUN_00403680(LPCRITICAL_SECTION param_1,PCNZWCH param_2,int *param_3,int param_4,int param_5)

{
  int iVar1;
  DWORD DVar2;
  char *pcVar3;
  int local_8;
  
  local_8 = 0;
  EnterCriticalSection(param_1);
  DVar2 = FUN_004020a3((int)param_1,param_2,&local_8);
  if ((int)DVar2 < 0) {
    pcVar3 = "Failed to find variable value \'%ls\'.";
  }
  else if (DVar2 == 1) {
    DVar2 = FUN_0040348a((int)param_1,param_2,local_8);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to insert variable \'%ls\'.";
    }
    else {
LAB_0040371f:
      if ((param_5 != 0) && (param_4 == 0)) {
        if (*(int *)(local_8 * 0x30 + 0x18 + param_1[1].RecursionCount) == 0) {
          iVar1 = param_3[2];
          if (iVar1 == 1) {
            FUN_00430f28(2,"Setting numeric variable \'%ls\' to value %lld");
          }
          else if (iVar1 == 2) {
            if (*param_3 == 0) {
              pcVar3 = "Unsetting variable \'%ls\'";
            }
            else {
              pcVar3 = "Setting string variable \'%ls\' to value \'%ls\'";
            }
            FUN_00430f28(2,pcVar3);
          }
          else if (iVar1 == 3) {
            FUN_00430f28(2,"Setting version variable \'%ls\' to value \'%hu.%hu.%hu.%hu\'");
          }
        }
        else {
          FUN_00430f28(2,"Setting hidden variable \'%ls\'");
        }
      }
      DVar2 = FUN_00418be2(param_3,(int *)(param_1[1].RecursionCount + 8 + local_8 * 0x30));
      if (-1 < (int)DVar2) goto LAB_004037f8;
      pcVar3 = "Failed to set value of variable: %ls";
    }
  }
  else {
    if (((*(int *)(local_8 * 0x30 + 0x20 + param_1[1].RecursionCount) == 0) || (param_4 == 1)) ||
       ((param_4 == 2 && (*(int *)(local_8 * 0x30 + 0x1c + param_1[1].RecursionCount) != 0))))
    goto LAB_0040371f;
    DVar2 = 0x80070057;
    FUN_004300d9();
    pcVar3 = "Attempt to set built-in variable value: %ls";
  }
  FUN_00430a57(DVar2,pcVar3);
LAB_004037f8:
  LeaveCriticalSection(param_1);
  if (((int)DVar2 < 0) && (param_5 != 0)) {
    FUN_00430f28(2,"Setting variable failed: ID \'%ls\', HRESULT 0x%x");
  }
  return DVar2;
}



/* Function: FUN_00403823 */

DWORD FUN_00403823(LPCRITICAL_SECTION param_1,int param_2,uint param_3,uint *param_4)

{
  uint *puVar1;
  DWORD DVar2;
  char *pcVar3;
  int local_20 [5];
  uint *local_c;
  PCNZWCH local_8;
  
  puVar1 = param_4;
  local_c = (uint *)0x0;
  local_8 = (PCNZWCH)0x0;
  local_20[4] = 0;
  local_20[0] = 0;
  local_20[1] = 0;
  local_20[2] = 0;
  local_20[3] = 0;
  EnterCriticalSection(param_1);
  DVar2 = FUN_004302f8(param_2,param_3,param_4,&local_c);
  if ((int)DVar2 < 0) {
    pcVar3 = "Failed to read variable count.";
LAB_00403968:
    FUN_00430a57(DVar2,pcVar3);
  }
  else {
    param_4 = (uint *)0x0;
    if (local_c != (uint *)0x0) {
      do {
        DVar2 = FUN_004302f8(param_2,param_3,puVar1,local_20 + 4);
        if ((int)DVar2 < 0) {
          pcVar3 = "Failed to read variable included flag.";
          goto LAB_00403968;
        }
        if (local_20[4] != 0) {
          DVar2 = FUN_00430351(param_2,param_3,puVar1,(int *)&local_8);
          if ((int)DVar2 < 0) {
            pcVar3 = "Failed to read variable name.";
            goto LAB_00403968;
          }
          DVar2 = FUN_004302f8(param_2,param_3,puVar1,local_20 + 2);
          if ((int)DVar2 < 0) {
            pcVar3 = "Failed to read variable value type.";
            goto LAB_00403968;
          }
          if (local_20[2] != 0) {
            if (local_20[2] != 1) {
              if (local_20[2] == 2) {
                DVar2 = FUN_00430351(param_2,param_3,puVar1,local_20);
                if (-1 < (int)DVar2) goto LAB_004038ec;
                pcVar3 = "Failed to read variable value as string.";
                goto LAB_00403968;
              }
              if (local_20[2] != 3) {
                DVar2 = 0x80070057;
                pcVar3 = "Unsupported variable type.";
                goto LAB_00403968;
              }
            }
            DVar2 = FUN_00430298(param_2,param_3,puVar1,local_20);
            if ((int)DVar2 < 0) {
              pcVar3 = "Failed to read variable value as number.";
              goto LAB_00403968;
            }
          }
LAB_004038ec:
          DVar2 = FUN_00403680(param_1,local_8,local_20,2,0);
          if ((int)DVar2 < 0) {
            pcVar3 = "Failed to set variable.";
            goto LAB_00403968;
          }
          FUN_00418e52(local_20);
        }
        param_4 = (uint *)((int)param_4 + 1);
      } while (param_4 < local_c);
    }
  }
  LeaveCriticalSection(param_1);
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  FUN_00418e52(local_20);
  return DVar2;
}



/* Function: FUN_00403999 */

int FUN_00403999(wchar_t *param_1,int *param_2)

{
  int iVar1;
  size_t sVar2;
  char *pcVar3;
  short *local_c;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  local_c = (short *)0x0;
  iVar1 = lstrlenW(param_1);
  iVar1 = FUN_00433bdf((int *)&local_8,iVar1 + 1);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to allocate buffer for escaped string.");
  }
  else {
    while( true ) {
      sVar2 = _wcscspn(param_1,L"[]{}");
      if ((sVar2 != 0) && (iVar1 = FUN_00433c35((int *)&local_8,param_1,sVar2), iVar1 < 0)) {
        pcVar3 = "Failed to append characters.";
        goto LAB_00403a65;
      }
      if (param_1[sVar2] == L'\0') {
        iVar1 = FUN_00433f88(param_2,local_8,0);
        if (-1 < iVar1) goto LAB_00403a6e;
        pcVar3 = "Failed to copy string.";
        goto LAB_00403a65;
      }
      iVar1 = FUN_00433cea((int *)&local_c,L"[\\%c]");
      if (iVar1 < 0) {
        pcVar3 = "Failed to format escape sequence.";
        goto LAB_00403a65;
      }
      iVar1 = FUN_00433c35((int *)&local_8,local_c,0);
      if (iVar1 < 0) break;
      param_1 = param_1 + sVar2 + 1;
    }
    pcVar3 = "Failed to append escape sequence.";
LAB_00403a65:
    FUN_00430a57(iVar1,pcVar3);
  }
LAB_00403a6e:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (short *)0x0) {
    FUN_004380ab(local_c);
  }
  return iVar1;
}



/* Function: FUN_00403a92 */

void FUN_00403a92(LPCRITICAL_SECTION param_1,LPCWSTR param_2,int *param_3,uint *param_4)

{
  FUN_00402162(param_1,param_2,param_3,param_4,0);
  return;
}



/* Function: FUN_00403aac */

void FUN_00403aac(LPCRITICAL_SECTION param_1,LPCWSTR param_2,int *param_3,uint *param_4)

{
  FUN_00402162(param_1,param_2,param_3,param_4,1);
  return;
}



/* Function: FUN_00403ac6 */

DWORD FUN_00403ac6(LPCRITICAL_SECTION param_1,PCNZWCH param_2,int *param_3)

{
  DWORD DVar1;
  char *pcVar2;
  int local_8;
  
  local_8 = 0;
  EnterCriticalSection(param_1);
  DVar1 = FUN_004026ff((int)param_1,param_2,&local_8);
  if (((int)DVar1 < 0) || (*(int *)(local_8 + 0x10) != 0)) {
    if (DVar1 != 0x80070490) {
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to get variable: %ls";
      }
      else {
        if ((*(int *)(local_8 + 0x10) == 2) && (*(int *)(local_8 + 0x20) == 0)) {
          DVar1 = FUN_00402162(param_1,*(LPCWSTR *)(local_8 + 8),param_3,(uint *)0x0,0);
          if ((int)DVar1 < 0) {
            FUN_00430a57(DVar1,"Failed to format value \'%ls\' of variable: %ls");
          }
          goto LAB_00403b71;
        }
        DVar1 = FUN_00418c97((undefined4 *)(local_8 + 8),param_3);
        if (-1 < (int)DVar1) goto LAB_00403b71;
        pcVar2 = "Failed to get value as string for variable: %ls";
      }
      FUN_00430a57(DVar1,pcVar2);
    }
  }
  else {
    DVar1 = 0x80070490;
  }
LAB_00403b71:
  LeaveCriticalSection(param_1);
  return DVar1;
}



/* Function: FUN_00403b82 */

DWORD FUN_00403b82(LPCRITICAL_SECTION param_1,PCNZWCH param_2,longlong *param_3)

{
  DWORD DVar1;
  char *pcVar2;
  int local_8;
  
  local_8 = 0;
  EnterCriticalSection(param_1);
  DVar1 = FUN_004026ff((int)param_1,param_2,&local_8);
  if (((int)DVar1 < 0) || (*(int *)(local_8 + 0x10) != 0)) {
    if (DVar1 != 0x80070490) {
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to get value of variable: %ls";
      }
      else {
        DVar1 = FUN_00418c4f((undefined4 *)(local_8 + 8),param_3);
        if (-1 < (int)DVar1) goto LAB_00403bf2;
        pcVar2 = "Failed to get value as numeric for variable: %ls";
      }
      FUN_00430a57(DVar1,pcVar2);
    }
  }
  else {
    DVar1 = 0x80070490;
  }
LAB_00403bf2:
  LeaveCriticalSection(param_1);
  return DVar1;
}



/* Function: FUN_00403c02 */

DWORD FUN_00403c02(LPCRITICAL_SECTION param_1,PCNZWCH param_2,int *param_3)

{
  DWORD DVar1;
  char *pcVar2;
  int local_8;
  
  local_8 = 0;
  EnterCriticalSection(param_1);
  DVar1 = FUN_004026ff((int)param_1,param_2,&local_8);
  if (((int)DVar1 < 0) || (*(int *)(local_8 + 0x10) != 0)) {
    if (DVar1 != 0x80070490) {
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to get value of variable: %ls";
      }
      else {
        DVar1 = FUN_00418c97((undefined4 *)(local_8 + 8),param_3);
        if (-1 < (int)DVar1) goto LAB_00403c72;
        pcVar2 = "Failed to get value as string for variable: %ls";
      }
      FUN_00430a57(DVar1,pcVar2);
    }
  }
  else {
    DVar1 = 0x80070490;
  }
LAB_00403c72:
  LeaveCriticalSection(param_1);
  return DVar1;
}



/* Function: FUN_00403c82 */

DWORD FUN_00403c82(LPCRITICAL_SECTION param_1,PCNZWCH param_2,int *param_3)

{
  DWORD DVar1;
  char *pcVar2;
  int local_8;
  
  local_8 = 0;
  EnterCriticalSection(param_1);
  DVar1 = FUN_004026ff((int)param_1,param_2,&local_8);
  if (DVar1 != 0x80070490) {
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to get value of variable: %ls";
    }
    else {
      DVar1 = FUN_00418be2((int *)(local_8 + 8),param_3);
      if (-1 < (int)DVar1) goto LAB_00403ce1;
      pcVar2 = "Failed to copy value of variable: %ls";
    }
    FUN_00430a57(DVar1,pcVar2);
  }
LAB_00403ce1:
  LeaveCriticalSection(param_1);
  return DVar1;
}



/* Function: FUN_00403cf1 */

DWORD FUN_00403cf1(LPCRITICAL_SECTION param_1,PCNZWCH param_2,uint *param_3)

{
  DWORD DVar1;
  char *pcVar2;
  int local_8;
  
  local_8 = 0;
  EnterCriticalSection(param_1);
  DVar1 = FUN_004026ff((int)param_1,param_2,&local_8);
  if (((int)DVar1 < 0) || (*(int *)(local_8 + 0x10) != 0)) {
    if (DVar1 != 0x80070490) {
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to get value of variable: %ls";
      }
      else {
        DVar1 = FUN_00418d39((uint *)(local_8 + 8),param_3);
        if (-1 < (int)DVar1) goto LAB_00403d61;
        pcVar2 = "Failed to get value as version for variable: %ls";
      }
      FUN_00430a57(DVar1,pcVar2);
    }
  }
  else {
    DVar1 = 0x80070490;
  }
LAB_00403d61:
  LeaveCriticalSection(param_1);
  return DVar1;
}



/* Function: FUN_00403d71 */

void FUN_00403d71(LPCRITICAL_SECTION param_1)

{
  DWORD DVar1;
  uint uVar2;
  wchar_t **ppwVar3;
  wchar_t *local_398 [5];
  code *local_384;
  undefined4 local_380;
  undefined4 local_37c;
  wchar_t *local_378;
  code *local_374;
  undefined4 local_370;
  undefined4 local_36c;
  wchar_t *local_368;
  code *local_364;
  undefined4 local_360;
  undefined4 local_35c;
  wchar_t *local_358;
  code *local_354;
  undefined4 local_350;
  undefined4 local_34c;
  wchar_t *local_348;
  code *local_344;
  undefined4 local_340;
  undefined4 local_33c;
  wchar_t *local_338;
  code *local_334;
  undefined4 local_330;
  undefined4 local_32c;
  wchar_t *local_328;
  code *local_324;
  undefined4 local_320;
  undefined4 local_31c;
  wchar_t *local_318;
  code *local_314;
  undefined4 local_310;
  undefined4 local_30c;
  wchar_t *local_308;
  code *local_304;
  undefined4 local_300;
  undefined4 local_2fc;
  wchar_t *local_2f8;
  code *local_2f4;
  undefined4 local_2f0;
  undefined4 local_2ec;
  wchar_t *local_2e8;
  code *local_2e4;
  undefined4 local_2e0;
  undefined4 local_2dc;
  wchar_t *local_2d8;
  code *local_2d4;
  undefined4 local_2d0;
  undefined4 local_2cc;
  wchar_t *local_2c8;
  code *local_2c4;
  undefined4 local_2c0;
  undefined4 local_2bc;
  wchar_t *local_2b8;
  code *local_2b4;
  undefined4 local_2b0;
  undefined4 local_2ac;
  wchar_t *local_2a8;
  code *local_2a4;
  undefined4 local_2a0;
  undefined4 local_29c;
  wchar_t *local_298;
  code *local_294;
  undefined4 local_290;
  undefined4 local_28c;
  wchar_t *local_288;
  code *local_284;
  undefined4 local_280;
  undefined4 local_27c;
  wchar_t *local_278;
  code *local_274;
  undefined4 local_270;
  undefined4 local_26c;
  wchar_t *local_268;
  code *local_264;
  undefined4 local_260;
  undefined4 local_25c;
  wchar_t *local_258;
  code *local_254;
  undefined4 local_250;
  undefined4 local_24c;
  wchar_t *local_248;
  code *local_244;
  undefined4 local_240;
  undefined4 local_23c;
  wchar_t *local_238;
  code *local_234;
  undefined4 local_230;
  undefined4 local_22c;
  wchar_t *local_228;
  code *local_224;
  undefined4 local_220;
  undefined4 local_21c;
  wchar_t *local_218;
  code *local_214;
  undefined4 local_210;
  undefined4 local_20c;
  wchar_t *local_208;
  code *local_204;
  undefined4 local_200;
  undefined4 local_1fc;
  wchar_t *local_1f8;
  code *local_1f4;
  undefined4 local_1f0;
  undefined4 local_1ec;
  wchar_t *local_1e8;
  code *local_1e4;
  undefined4 local_1e0;
  undefined4 local_1dc;
  wchar_t *local_1d8;
  code *local_1d4;
  undefined4 local_1d0;
  undefined4 local_1cc;
  wchar_t *local_1c8;
  code *local_1c4;
  undefined4 local_1c0;
  undefined4 local_1bc;
  wchar_t *local_1b8;
  code *local_1b4;
  undefined4 local_1b0;
  undefined4 local_1ac;
  wchar_t *local_1a8;
  code *local_1a4;
  undefined4 local_1a0;
  undefined4 local_19c;
  wchar_t *local_198;
  code *local_194;
  undefined4 local_190;
  undefined4 local_18c;
  wchar_t *local_188;
  code *local_184;
  undefined4 local_180;
  undefined4 local_17c;
  wchar_t *local_178;
  code *local_174;
  undefined4 local_170;
  undefined4 local_16c;
  wchar_t *local_168;
  code *local_164;
  undefined4 local_160;
  undefined4 local_15c;
  wchar_t *local_158;
  code *local_154;
  undefined4 local_150;
  undefined4 local_14c;
  wchar_t *local_148;
  code *local_144;
  undefined4 local_140;
  undefined4 local_13c;
  wchar_t *local_138;
  code *local_134;
  undefined4 local_130;
  undefined4 local_12c;
  wchar_t *local_128;
  code *local_124;
  undefined4 local_120;
  undefined4 local_11c;
  wchar_t *local_118;
  code *local_114;
  undefined4 local_110;
  undefined4 local_10c;
  wchar_t *local_108;
  code *local_104;
  undefined4 local_100;
  undefined4 local_fc;
  wchar_t *local_f8;
  code *local_f4;
  undefined4 local_f0;
  undefined4 local_ec;
  wchar_t *local_e8;
  code *local_e4;
  undefined4 local_e0;
  undefined4 local_dc;
  wchar_t *local_d8;
  code *local_d4;
  undefined4 local_d0;
  undefined4 local_cc;
  wchar_t *local_c8;
  code *local_c4;
  undefined4 local_c0;
  undefined4 local_bc;
  wchar_t *local_b8;
  code *local_b4;
  undefined4 local_b0;
  undefined4 local_ac;
  wchar_t *local_a8;
  code *local_a4;
  undefined4 local_a0;
  undefined4 local_9c;
  wchar_t *local_98;
  code *local_94;
  undefined4 local_90;
  undefined4 local_8c;
  wchar_t *local_88;
  code *local_84;
  undefined4 local_80;
  undefined4 local_7c;
  wchar_t *local_78;
  code *local_74;
  undefined4 local_70;
  undefined4 local_6c;
  wchar_t *local_68;
  code *local_64;
  undefined4 local_60;
  undefined4 local_5c;
  wchar_t *local_58;
  code *local_54;
  undefined4 local_50;
  undefined4 local_4c;
  wchar_t *local_48;
  code *local_44;
  undefined2 *local_40;
  undefined4 local_3c;
  wchar_t *local_38;
  code *local_34;
  undefined2 *local_30;
  undefined4 local_2c;
  wchar_t *local_28;
  code *local_24;
  undefined2 *local_20;
  undefined4 local_1c;
  wchar_t *local_18;
  code *local_14;
  undefined4 local_10;
  undefined4 local_c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  InitializeCriticalSection(param_1);
  uVar2 = 0;
  local_398[2] = (wchar_t *)0x30;
  local_398[3] = (wchar_t *)0x0;
  local_398[4] = L"AppDataFolder";
  local_384 = FUN_0040291f;
  local_380 = 0x1a;
  local_37c = 0;
  local_378 = L"CommonAppDataFolder";
  local_374 = FUN_0040291f;
  local_370 = 0x23;
  local_36c = 0;
  local_368 = L"CommonFiles64Folder";
  local_364 = FUN_00402e54;
  local_360 = 0x2b;
  local_35c = 0;
  local_358 = L"CommonFilesFolder";
  local_354 = FUN_0040291f;
  local_350 = 0x2b;
  local_34c = 0;
  local_348 = L"CommonFiles6432Folder";
  local_344 = FUN_004027e9;
  local_340 = 0x2b;
  local_33c = 0;
  local_338 = L"CompatibilityMode";
  local_334 = FUN_00402bf0;
  local_330 = 0xc;
  local_32c = 0;
  local_328 = L"Date";
  local_324 = FUN_00402986;
  local_320 = 0;
  local_31c = 0;
  local_318 = L"ComputerName";
  local_314 = FUN_00402881;
  local_310 = 0;
  local_30c = 0;
  local_308 = L"DesktopFolder";
  local_304 = FUN_0040291f;
  local_300 = 0;
  local_2fc = 0;
  local_2f8 = L"FavoritesFolder";
  local_2f4 = FUN_0040291f;
  local_2f0 = 6;
  local_2ec = 0;
  local_2e8 = L"FontsFolder";
  local_2e4 = FUN_0040291f;
  local_2e0 = 0x14;
  local_2dc = 0;
  local_2d8 = L"InstallerName";
  local_2d4 = FUN_00402a9f;
  local_2d0 = 0;
  local_2cc = 0;
  local_2c8 = L"InstallerVersion";
  local_2c4 = FUN_00402acc;
  local_2c0 = 0;
  local_2bc = 0;
  local_2b8 = L"LocalAppDataFolder";
  local_2b4 = FUN_0040291f;
  local_2b0 = 0x1c;
  local_2ac = 0;
  local_2a8 = L"LogonUser";
  local_2a4 = FUN_00402b28;
  local_2a0 = 0;
  local_29c = 0;
  local_298 = L"MyPicturesFolder";
  local_294 = FUN_0040291f;
  local_260 = 6;
  local_284 = FUN_00402bf0;
  local_274 = FUN_00402bf0;
  local_264 = FUN_00402bf0;
  local_254 = FUN_00402bf0;
  local_244 = FUN_00402bf0;
  local_234 = FUN_00402bf0;
  local_224 = FUN_00402bf0;
  local_214 = FUN_00402bf0;
  local_270 = 5;
  local_200 = 5;
  local_1e0 = 0x26;
  local_1d0 = 0x26;
  local_1c4 = FUN_004027e9;
  local_1c0 = 0x26;
  local_230 = 9;
  local_190 = 9;
  local_290 = 0x27;
  local_28c = 0;
  local_288 = L"NTProductType";
  local_280 = 4;
  local_27c = 0;
  local_278 = L"NTSuiteBackOffice";
  local_26c = 0;
  local_268 = L"NTSuiteDataCenter";
  local_25c = 0;
  local_258 = L"NTSuiteEnterprise";
  local_250 = 7;
  local_24c = 0;
  local_248 = L"NTSuitePersonal";
  local_240 = 8;
  local_23c = 0;
  local_238 = L"NTSuiteSmallBusiness";
  local_22c = 0;
  local_228 = L"NTSuiteSmallBusinessRestricted";
  local_220 = 10;
  local_21c = 0;
  local_218 = L"NTSuiteWebServer";
  local_210 = 0xb;
  local_20c = 0;
  local_208 = L"PersonalFolder";
  local_204 = FUN_0040291f;
  local_1fc = 0;
  local_1f8 = L"Privileged";
  local_1f4 = FUN_00402da0;
  local_1f0 = 0;
  local_1ec = 0;
  local_1e8 = L"ProgramFiles64Folder";
  local_1e4 = FUN_00402e54;
  local_1dc = 0;
  local_1d8 = L"ProgramFilesFolder";
  local_1d4 = FUN_0040291f;
  local_1cc = 0;
  local_1c8 = L"ProgramFiles6432Folder";
  local_1bc = 0;
  local_1b8 = L"ProgramMenuFolder";
  local_1b4 = FUN_0040291f;
  local_1b0 = 2;
  local_1ac = 0;
  local_1a8 = L"RebootPending";
  local_1a4 = FUN_00402de7;
  local_1a0 = 0;
  local_19c = 0;
  local_198 = L"SendToFolder";
  local_194 = FUN_0040291f;
  local_18c = 0;
  local_188 = L"ServicePackLevel";
  local_174 = FUN_0040291f;
  local_164 = FUN_0040291f;
  local_154 = FUN_00402ef0;
  local_144 = FUN_00402ef0;
  local_170 = 0xb;
  local_184 = FUN_004031b4;
  local_114 = FUN_0040291f;
  local_d4 = FUN_004031b4;
  local_c4 = FUN_004031b4;
  local_b4 = FUN_0040291f;
  local_180 = 3;
  local_17c = 0;
  local_178 = L"StartMenuFolder";
  local_16c = 0;
  local_168 = L"StartupFolder";
  local_160 = 7;
  local_15c = 0;
  local_158 = L"SystemFolder";
  local_150 = 0;
  local_14c = 0;
  local_148 = L"System64Folder";
  local_140 = 1;
  local_13c = 0;
  local_138 = L"SystemLanguageID";
  local_134 = FUN_00402785;
  local_130 = 0;
  local_12c = 0;
  local_128 = L"TempFolder";
  local_124 = FUN_00403017;
  local_120 = 0;
  local_11c = 0;
  local_118 = L"TemplateFolder";
  local_110 = 0x15;
  local_10c = 0;
  local_108 = L"TerminalServer";
  local_104 = FUN_00402bf0;
  local_100 = 0xd;
  local_fc = 0;
  local_f8 = L"UserLanguageID";
  local_f4 = FUN_004027b7;
  local_f0 = 0;
  local_ec = 0;
  local_e8 = L"VersionMsi";
  local_e4 = FUN_004030ed;
  local_e0 = 0;
  local_dc = 0;
  local_d8 = L"VersionNT";
  local_d0 = 1;
  local_cc = 0;
  local_c8 = L"VersionNT64";
  local_c0 = 2;
  local_bc = 0;
  local_b8 = L"WindowsFolder";
  local_b0 = 0x24;
  local_ac = 0;
  local_a8 = L"WindowsVolume";
  local_a4 = FUN_0040337e;
  local_a0 = 0;
  local_9c = 0;
  local_98 = L"WixBundleAction";
  local_94 = FUN_00402bc5;
  local_90 = 0;
  local_8c = 0;
  local_88 = L"WixBundleForcedRestartPackage";
  local_84 = FUN_00402ec5;
  local_80 = 0;
  local_7c = 1;
  local_78 = L"WixBundleInstalled";
  local_74 = FUN_00402bc5;
  local_70 = 0;
  local_6c = 0;
  local_68 = L"WixBundleElevated";
  local_64 = FUN_00402bc5;
  local_60 = 0;
  local_5c = 0;
  local_58 = L"WixBundleActiveParent";
  local_54 = FUN_00402ec5;
  local_50 = 0;
  local_4c = 0;
  local_48 = L"WixBundleProviderKey";
  local_44 = FUN_00402ec5;
  local_40 = &DAT_0043b580;
  local_3c = 0;
  local_38 = L"WixBundleManufacturer";
  local_34 = FUN_00402ec5;
  local_30 = &DAT_0043b580;
  local_2c = 0;
  local_28 = L"WixBundleTag";
  local_24 = FUN_00402ec5;
  local_20 = &DAT_0043b580;
  local_1c = 0;
  local_18 = L"WixBundleVersion";
  local_14 = FUN_004030c2;
  local_10 = 0;
  local_c = 0;
  ppwVar3 = local_398 + 2;
  do {
    DVar1 = FUN_00402024((int)param_1,ppwVar3[-2],ppwVar3[-1],*ppwVar3,ppwVar3[1]);
    if ((int)DVar1 < 0) {
      FUN_00430a57(DVar1,"Failed to add built-in variable: %ls.");
      break;
    }
    uVar2 = uVar2 + 1;
    ppwVar3 = ppwVar3 + 4;
  } while (uVar2 < 0x39);
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00404496 */

int FUN_00404496(LPCRITICAL_SECTION param_1,int param_2,int *param_3,int *param_4)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  undefined4 *puVar4;
  char *pcVar5;
  int local_c;
  uint local_8;
  
  EnterCriticalSection(param_1);
  iVar2 = FUN_0043055b(param_3,param_4,param_1[1].LockCount);
  if (iVar2 < 0) {
    FUN_00430a57(iVar2,"Failed to write variable count.");
  }
  else {
    local_8 = 0;
    if (param_1[1].LockCount != 0) {
      local_c = 0;
      do {
        puVar4 = (undefined4 *)(param_1[1].RecursionCount + local_c);
        if (param_2 == 0) {
          uVar3 = (uint)(puVar4[8] == 0);
        }
        else {
          uVar3 = puVar4[7];
        }
        iVar2 = FUN_0043055b(param_3,param_4,uVar3);
        if (iVar2 < 0) {
          pcVar5 = "Failed to write included flag.";
LAB_004045c7:
          FUN_00430a57(iVar2,pcVar5);
          break;
        }
        if (uVar3 != 0) {
          iVar2 = FUN_00430589(param_3,param_4,(LPCWSTR)*puVar4);
          if (iVar2 < 0) {
            pcVar5 = "Failed to write variable name.";
          }
          else {
            iVar2 = FUN_0043055b(param_3,param_4,puVar4[4]);
            if (iVar2 < 0) {
              pcVar5 = "Failed to write variable value type.";
            }
            else {
              iVar1 = puVar4[4];
              if (iVar1 == 0) goto LAB_0040456b;
              if (iVar1 == 1) {
LAB_00404554:
                iVar2 = FUN_00430526(param_3,param_4,puVar4[2],puVar4[3]);
                if (-1 < iVar2) goto LAB_0040456b;
                pcVar5 = "Failed to write variable value as number.";
              }
              else if (iVar1 == 2) {
                iVar2 = FUN_00430589(param_3,param_4,(LPCWSTR)puVar4[2]);
                if (-1 < iVar2) goto LAB_0040456b;
                pcVar5 = "Failed to write variable value as string.";
              }
              else {
                if (iVar1 == 3) goto LAB_00404554;
                iVar2 = -0x7ff8ffa9;
                pcVar5 = "Unsupported variable type.";
              }
            }
          }
          goto LAB_004045c7;
        }
LAB_0040456b:
        local_8 = local_8 + 1;
        local_c = local_c + 0x30;
      } while (local_8 < (uint)param_1[1].LockCount);
    }
  }
  LeaveCriticalSection(param_1);
  return iVar2;
}



/* Function: FUN_004045df */

void FUN_004045df(LPCRITICAL_SECTION param_1,PCNZWCH param_2,int param_3,undefined4 param_4,
                 int param_5)

{
  int local_14;
  undefined4 local_10;
  undefined4 local_c;
  undefined4 uStack_8;
  
  uStack_8 = 0;
  local_14 = param_3;
  local_10 = param_4;
  local_c = 1;
  FUN_00403680(param_1,param_2,&local_14,(uint)(param_5 != 0),1);
  return;
}



/* Function: FUN_0040461f */

void FUN_0040461f(LPCRITICAL_SECTION param_1,PCNZWCH param_2,int param_3,int param_4)

{
  int local_14 [4];
  
  local_14[1] = 0;
  local_14[3] = 0;
  local_14[0] = param_3;
  local_14[2] = 2;
  FUN_00403680(param_1,param_2,local_14,(uint)(param_4 != 0),1);
  return;
}



/* Function: FUN_0040465b */

void FUN_0040465b(LPCRITICAL_SECTION param_1,PCNZWCH param_2,int *param_3,int param_4)

{
  FUN_00403680(param_1,param_2,param_3,(uint)(param_4 != 0),1);
  return;
}



/* Function: FUN_0040467b */

void FUN_0040467b(LPCRITICAL_SECTION param_1,PCNZWCH param_2,int param_3,undefined4 param_4,
                 int param_5)

{
  int local_14;
  undefined4 local_10;
  undefined4 local_c;
  undefined4 uStack_8;
  
  uStack_8 = 0;
  local_14 = param_3;
  local_10 = param_4;
  local_c = 3;
  FUN_00403680(param_1,param_2,&local_14,(uint)(param_5 != 0),1);
  return;
}



/* Function: FUN_004046bd */

void FUN_004046bd(LPCRITICAL_SECTION param_1)

{
  LPCRITICAL_SECTION p_Var1;
  LPCWSTR pWVar2;
  int iVar3;
  DWORD DVar4;
  uint uVar5;
  int iVar6;
  LPCWSTR local_8;
  
  p_Var1 = param_1;
  pWVar2 = (LPCWSTR)0x0;
  uVar5 = 0;
  local_8 = (LPCWSTR)0x0;
  if (param_1[1].LockCount != 0) {
    param_1 = (LPCRITICAL_SECTION)0x0;
    do {
      iVar6 = (int)&param_1->DebugInfo + p_Var1[1].RecursionCount;
      if ((((iVar6 != 0) && (*(int *)(iVar6 + 0x10) != 0)) &&
          (iVar3 = FUN_00433cea((int *)&local_8,L"%ls = [%ls]"), pWVar2 = local_8, -1 < iVar3)) &&
         ((DVar4 = FUN_00402162(p_Var1,local_8,(int *)&local_8,(uint *)0x0,
                                (uint)(*(int *)(iVar6 + 0x18) != 0)), pWVar2 = local_8,
          -1 < (int)DVar4 && (FUN_00402003(3,0x2000019a), pWVar2 = local_8, local_8 != (LPCWSTR)0x0)
          ))) {
        FUN_004380ab(local_8);
        local_8 = (LPCWSTR)0x0;
        pWVar2 = local_8;
      }
      uVar5 = uVar5 + 1;
      param_1 = param_1 + 2;
    } while (uVar5 < (uint)p_Var1[1].LockCount);
    if (pWVar2 != (LPCWSTR)0x0) {
      FUN_004380ab(pWVar2);
    }
  }
  return;
}



/* Function: FUN_00404769 */

uint FUN_00404769(LPCRITICAL_SECTION param_1,int *param_2)

{
  LPCRITICAL_SECTION lpCriticalSection;
  uint uVar1;
  int iVar2;
  char *pcVar3;
  uint local_34 [5];
  LPCRITICAL_SECTION local_20;
  int local_1c;
  int *local_18;
  uint local_14;
  LPCWSTR local_10;
  int *local_c;
  PCNZWCH local_8;
  
  lpCriticalSection = param_1;
  local_34[0] = 0;
  local_34[1] = 0;
  local_34[2] = 0;
  local_18 = (int *)0x0;
  local_c = (int *)0x0;
  local_20 = (LPCRITICAL_SECTION)0x0;
  local_8 = (PCNZWCH)0x0;
  local_10 = (LPCWSTR)0x0;
  local_34[3] = 0;
  local_14 = 0;
  local_34[4] = 0;
  local_1c = 0;
  EnterCriticalSection(param_1);
  uVar1 = FUN_00435fbe(param_2,L"Variable",(int)&local_18);
  if ((int)uVar1 < 0) {
    pcVar3 = "Failed to select variable nodes.";
  }
  else {
    uVar1 = (**(code **)(*local_18 + 0x20))(local_18,&local_20);
    if (-1 < (int)uVar1) {
      param_1 = (LPCRITICAL_SECTION)0x0;
      if (local_20 != (LPCRITICAL_SECTION)0x0) {
        do {
          uVar1 = FUN_00435f1d(local_18,&local_c,(undefined4 *)0x0);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get next node.";
            goto LAB_00404ab8;
          }
          uVar1 = FUN_00435b5e(local_c,&DAT_0043c524,(int *)&local_8);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get @Id.";
            goto LAB_00404ab8;
          }
          uVar1 = FUN_00435d6c(local_c,L"Hidden",&local_14);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get @Hidden.";
            goto LAB_00404ab8;
          }
          uVar1 = FUN_00435d6c(local_c,L"Persisted",local_34 + 4);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get @Persisted.";
            goto LAB_00404ab8;
          }
          uVar1 = FUN_00435b5e(local_c,L"Value",(int *)&local_10);
          if (uVar1 == 0x80070490) {
            uVar1 = 0;
            goto LAB_0040495a;
          }
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get @Value.";
            goto LAB_00404ab8;
          }
          uVar1 = FUN_00418dbd((int *)local_34,local_10,0);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to set variant value.";
            goto LAB_00404ab8;
          }
          uVar1 = FUN_00435b5e(local_c,L"Type",(int *)&local_10);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get @Type.";
            goto LAB_00404ab8;
          }
          iVar2 = CompareStringW(0x7f,0,local_10,-1,L"numeric",-1);
          uVar1 = 2;
          if (iVar2 != 2) {
            iVar2 = CompareStringW(0x7f,0,local_10,-1,L"string",-1);
            if (iVar2 == 2) {
              if (local_14 == 0) {
                FUN_00430f28(2,"Initializing string variable \'%ls\' to value \'%ls\'");
                goto LAB_0040495a;
              }
              goto LAB_00404960;
            }
            iVar2 = CompareStringW(0x7f,0,local_10,-1,L"version",-1);
            if (iVar2 == 2) {
              if (local_14 == 0) {
                FUN_00430f28(2,"Initializing version variable \'%ls\' to value \'%ls\'");
              }
              uVar1 = 3;
              goto LAB_0040495a;
            }
            pcVar3 = "Invalid value for @Type: %ls";
LAB_00404a7f:
            uVar1 = 0x80070057;
            goto LAB_00404a80;
          }
          if (local_14 == 0) {
            FUN_00430f28(2,"Initializing numeric variable \'%ls\' to value \'%ls\'");
          }
          uVar1 = 1;
LAB_0040495a:
          if (local_14 != 0) {
LAB_00404960:
            FUN_00430f28(2,"Initializing hidden variable \'%ls\'");
          }
          uVar1 = FUN_00418b53(local_34,uVar1);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to change variant type.";
            goto LAB_00404ab8;
          }
          uVar1 = FUN_004020a3((int)lpCriticalSection,local_8,&local_1c);
          iVar2 = local_1c;
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to find variable value \'%ls\'.";
LAB_00404a80:
            FUN_00430a57(uVar1,pcVar3);
            break;
          }
          if (uVar1 == 1) {
            uVar1 = FUN_0040348a((int)lpCriticalSection,local_8,local_1c);
            if ((int)uVar1 < 0) {
              pcVar3 = "Failed to insert variable \'%ls\'.";
              goto LAB_00404a80;
            }
          }
          else if (*(int *)(local_1c * 0x30 + 0x20 + lpCriticalSection[1].RecursionCount) != 0) {
            FUN_004300d9();
            pcVar3 = "Attempt to set built-in variable value: %ls";
            goto LAB_00404a7f;
          }
          iVar2 = iVar2 * 0x30;
          *(uint *)(iVar2 + 0x18 + lpCriticalSection[1].RecursionCount) = local_14;
          *(uint *)(iVar2 + 0x1c + lpCriticalSection[1].RecursionCount) = local_34[4];
          uVar1 = FUN_00418be2((int *)local_34,
                               (int *)(lpCriticalSection[1].RecursionCount + 8 + iVar2));
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to set value of variable: %ls";
            goto LAB_00404a80;
          }
          if (local_c != (int *)0x0) {
            (**(code **)(*local_c + 8))(local_c);
            local_c = (int *)0x0;
          }
          param_1 = (LPCRITICAL_SECTION)((int)&param_1->DebugInfo + 1);
        } while (param_1 < local_20);
      }
      goto LAB_00404ac0;
    }
    pcVar3 = "Failed to get variable node count.";
  }
LAB_00404ab8:
  FUN_00430a57(uVar1,pcVar3);
LAB_00404ac0:
  LeaveCriticalSection(lpCriticalSection);
  if (local_18 != (int *)0x0) {
    (**(code **)(*local_18 + 8))(local_18);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  FUN_00418e52((int *)local_34);
  return uVar1;
}



/* Function: FUN_00404b0f */

void FUN_00404b0f(LPCRITICAL_SECTION param_1)

{
  LPCRITICAL_SECTION p_Var1;
  int *piVar2;
  uint uVar3;
  
  p_Var1 = param_1;
  DeleteCriticalSection(param_1);
  uVar3 = 0;
  if (param_1[1].RecursionCount != 0) {
    if (param_1[1].LockCount != 0) {
      param_1 = (LPCRITICAL_SECTION)0x0;
      do {
        piVar2 = (int *)((int)&param_1->DebugInfo + p_Var1[1].RecursionCount);
        if (piVar2 != (int *)0x0) {
          if (*piVar2 != 0) {
            FUN_004380ab((LPVOID)*piVar2);
          }
          FUN_00418e52(piVar2 + 2);
        }
        uVar3 = uVar3 + 1;
        param_1 = param_1 + 2;
      } while (uVar3 < (uint)p_Var1[1].LockCount);
    }
    FUN_00431137((LPVOID)p_Var1[1].RecursionCount);
  }
  return;
}



/* Function: FUN_00404b6a */

undefined4
FUN_00404b6a(int param_1,uint param_2,uint param_3,uint param_4,uint param_5,undefined4 *param_6)

{
  uint uVar1;
  undefined4 uVar2;
  bool bVar3;
  
  if (param_1 < 0x30006) {
    if (param_1 != 0x30005) {
      switch(param_1) {
      case 0x10005:
        break;
      case 0x10006:
        goto switchD_00404b8b_caseD_10006;
      case 0x10007:
        goto switchD_00404b8b_caseD_10007;
      case 0x10008:
        goto switchD_00404b8b_caseD_10008;
      case 0x10009:
        goto switchD_00404b8b_caseD_10009;
      case 0x1000a:
        goto switchD_00404b8b_caseD_1000a;
      case 0x1000b:
        goto switchD_00404b8b_caseD_1000b;
      case 0x1000c:
        goto switchD_00404b8b_caseD_1000c;
      case 0x1000d:
        goto switchD_00404b8b_caseD_1000d;
      default:
        goto LAB_00404c7e;
      }
    }
    if (((int)param_3 <= (int)param_5) && (((int)param_3 < (int)param_5 || (param_2 < param_4))))
    goto LAB_00404c71;
    goto LAB_00404bac;
  }
  switch(param_1) {
  case 0x30006:
switchD_00404b8b_caseD_10006:
    if (((int)param_3 < (int)param_5) || (((int)param_3 <= (int)param_5 && (param_2 <= param_4))))
    break;
    goto LAB_00404c71;
  case 0x30007:
switchD_00404b8b_caseD_10007:
    if (((int)param_3 <= (int)param_5) && (((int)param_3 < (int)param_5 || (param_2 <= param_4))))
    goto LAB_00404c71;
    break;
  case 0x30008:
switchD_00404b8b_caseD_10008:
    if (((int)param_5 <= (int)param_3) && (((int)param_5 < (int)param_3 || (param_4 <= param_2))))
    goto LAB_00404c71;
    break;
  case 0x30009:
switchD_00404b8b_caseD_10009:
    if (param_2 != param_4) break;
    bVar3 = param_3 == param_5;
    goto LAB_00404c6b;
  case 0x3000a:
switchD_00404b8b_caseD_1000a:
    if (param_2 != param_4) goto LAB_00404c71;
    bVar3 = param_3 == param_5;
    goto LAB_00404c2e;
  case 0x3000b:
switchD_00404b8b_caseD_1000b:
    bVar3 = (param_2 & param_4) == 0 && (param_3 & param_5) == 0;
LAB_00404c2e:
    if (!bVar3) {
LAB_00404c71:
      uVar2 = 1;
      goto LAB_00404bae;
    }
    break;
  case 0x3000c:
switchD_00404b8b_caseD_1000c:
    uVar1 = param_2 >> 0x10;
    goto LAB_00404c62;
  case 0x3000d:
switchD_00404b8b_caseD_1000d:
    uVar1 = param_2 & 0xffff;
LAB_00404c62:
    if (uVar1 != param_4) break;
    bVar3 = param_5 == 0;
LAB_00404c6b:
    if (!bVar3) break;
    goto LAB_00404c71;
  default:
LAB_00404c7e:
    return 0x80070057;
  }
LAB_00404bac:
  uVar2 = 0;
LAB_00404bae:
  *param_6 = uVar2;
  return 0;
}



/* Function: FUN_00404cca */

undefined4 FUN_00404cca(uint param_1,LPCWSTR param_2,LPCWSTR param_3,undefined4 *param_4)

{
  uint uVar1;
  int cchCount1;
  int cchCount2;
  int iVar2;
  int iVar3;
  undefined4 uVar4;
  bool bVar5;
  
  uVar1 = param_1 >> 0x11 & 1;
  cchCount1 = lstrlenW(param_2);
  cchCount2 = lstrlenW(param_3);
  iVar2 = cchCount2;
  if ((int)param_1 < 0x3000b) {
    if (0x30004 < (int)param_1) {
LAB_00404d32:
      uVar1 = CompareStringW(0x7f,uVar1,param_2,cchCount1,param_3,cchCount2);
      uVar4 = FUN_00404b6a(param_1,uVar1,(int)uVar1 >> 0x1f,2,0,param_4);
      return uVar4;
    }
    if ((int)param_1 < 0x10005) {
      return 0x80070057;
    }
    if ((int)param_1 < 0x1000b) goto LAB_00404d32;
    if (param_1 != 0x1000b) {
      if (param_1 != 0x1000c) {
        bVar5 = param_1 == 0x1000d;
        goto LAB_00404d69;
      }
      goto LAB_00404d8d;
    }
joined_r0x00404db9:
    while( true ) {
      if (cchCount1 < iVar2) {
        *param_4 = 0;
        return 0;
      }
      iVar3 = CompareStringW(0x7f,uVar1,param_2,cchCount2,param_3,cchCount2);
      if (iVar3 == 2) break;
      param_2 = param_2 + 1;
      iVar2 = iVar2 + 1;
    }
  }
  else {
    if (param_1 == 0x3000b) goto joined_r0x00404db9;
    if (param_1 != 0x3000c) {
      bVar5 = param_1 == 0x3000d;
LAB_00404d69:
      if (!bVar5) {
        return 0x80070057;
      }
      if (cchCount2 <= cchCount1) {
        param_2 = param_2 + (cchCount1 - cchCount2);
        goto LAB_00404d9a;
      }
LAB_00404d89:
      uVar4 = 0;
      goto LAB_00404dad;
    }
LAB_00404d8d:
    if (cchCount1 < cchCount2) goto LAB_00404d89;
LAB_00404d9a:
    iVar2 = CompareStringW(0x7f,uVar1,param_2,cchCount2,param_3,cchCount2);
    if (iVar2 != 2) goto LAB_00404d89;
  }
  uVar4 = 1;
LAB_00404dad:
  *param_4 = uVar4;
  return 0;
}



/* Function: FUN_00404df9 */

undefined4
FUN_00404df9(uint param_1,LPCWSTR param_2,uint param_3,int param_4,undefined4 param_5,
            LPCWSTR param_6,uint param_7,int param_8,undefined4 param_9,uint *param_10)

{
  undefined4 uVar1;
  int iVar2;
  LPCWSTR pWVar3;
  uint uVar4;
  LPCWSTR pWVar5;
  uint uVar6;
  undefined8 local_14;
  undefined8 local_c;
  
  local_c = 0;
  local_14 = 0;
  if (param_4 == 2) {
    if (param_8 == 2) {
      uVar1 = FUN_00404cca(param_1,param_2,param_6,param_10);
      return uVar1;
    }
    if (param_8 == 3) {
      iVar2 = FUN_00418d39((uint *)&param_2,(uint *)&local_14);
      if (-1 < iVar2) {
        pWVar3 = (LPCWSTR)local_14;
        uVar4 = local_14._4_4_;
        pWVar5 = param_6;
        uVar6 = param_7;
        goto LAB_00404e5d;
      }
    }
    else if ((param_8 == 1) && (iVar2 = FUN_004345da(param_2,0,&local_c), -1 < iVar2)) {
      pWVar3 = (LPCWSTR)local_c;
      uVar4 = local_c._4_4_;
      pWVar5 = param_6;
      uVar6 = param_7;
      goto LAB_00404e95;
    }
  }
  else {
    if (param_4 == 1) {
      pWVar3 = param_2;
      uVar4 = param_3;
      pWVar5 = param_6;
      uVar6 = param_7;
      if (param_8 != 1) {
        if ((param_8 != 2) || (iVar2 = FUN_004345da(param_6,0,&local_c), iVar2 < 0))
        goto LAB_00404f23;
        pWVar3 = param_2;
        uVar4 = param_3;
        pWVar5 = (LPCWSTR)local_c;
        uVar6 = local_c._4_4_;
      }
LAB_00404e95:
      uVar1 = FUN_00404b6a(param_1,(uint)pWVar3,uVar4,(uint)pWVar5,uVar6,param_10);
      return uVar1;
    }
    if (param_4 == 3) {
      pWVar3 = param_2;
      uVar4 = param_3;
      pWVar5 = param_6;
      uVar6 = param_7;
      if (param_8 != 3) {
        if ((param_8 != 2) || (iVar2 = FUN_00418d39((uint *)&param_6,(uint *)&local_14), iVar2 < 0))
        goto LAB_00404f23;
        pWVar3 = param_2;
        uVar4 = param_3;
        pWVar5 = (LPCWSTR)local_14;
        uVar6 = local_14._4_4_;
      }
LAB_00404e5d:
      uVar1 = FUN_00404f3b(param_1,(uint)pWVar3,uVar4,(uint)pWVar5,uVar6,param_10);
      return uVar1;
    }
  }
LAB_00404f23:
  *param_10 = (uint)(param_1 == 0x1000a);
  return 0;
}



/* Function: FUN_00404f3b */

undefined4
FUN_00404f3b(undefined4 param_1,uint param_2,uint param_3,uint param_4,uint param_5,
            undefined4 *param_6)

{
  uint uVar1;
  undefined4 uVar2;
  bool bVar3;
  
  switch(param_1) {
  case 0x10005:
    if ((param_5 < param_3) || ((param_5 <= param_3 && (param_4 <= param_2)))) break;
    goto LAB_0040501e;
  case 0x10006:
    if ((param_5 <= param_3) && ((param_5 < param_3 || (param_4 < param_2)))) goto LAB_0040501e;
    break;
  case 0x10007:
    if ((param_3 <= param_5) && ((param_3 < param_5 || (param_2 <= param_4)))) goto LAB_0040501e;
    break;
  case 0x10008:
    if ((param_5 <= param_3) && ((param_5 < param_3 || (param_4 <= param_2)))) goto LAB_0040501e;
    break;
  case 0x10009:
    if (param_2 != param_4) break;
    bVar3 = param_3 == param_5;
    goto LAB_00405018;
  case 0x1000a:
    if (param_2 != param_4) goto LAB_0040501e;
    bVar3 = param_3 == param_5;
    goto LAB_00404fdf;
  case 0x1000b:
    bVar3 = (param_2 & param_4) == 0 && (param_3 & param_5) == 0;
LAB_00404fdf:
    if (!bVar3) {
LAB_0040501e:
      uVar2 = 1;
      goto LAB_00404f74;
    }
    break;
  case 0x1000c:
    uVar1 = param_2 >> 0x10;
    goto LAB_0040500f;
  case 0x1000d:
    uVar1 = param_2 & 0xffff;
LAB_0040500f:
    if (uVar1 != param_4) break;
    bVar3 = param_5 == 0;
LAB_00405018:
    if (!bVar3) break;
    goto LAB_0040501e;
  default:
    return 0x80070057;
  }
  uVar2 = 0;
LAB_00404f74:
  *param_6 = uVar2;
  return 0;
}



/* Function: FUN_00405057 */

int FUN_00405057(int param_1,int param_2)

{
  int iVar1;
  
  if (*(int *)(param_1 + 0x10) == param_2) {
    iVar1 = FUN_004050ba(param_1);
    if (iVar1 < 0) {
      FUN_00430a57(iVar1,"Failed to read next symbol.");
    }
  }
  else {
    iVar1 = -0x7ff8fff3;
    *(undefined4 *)(param_1 + 0x28) = 1;
    FUN_004300d9();
    FUN_00430a57(0x8007000d,"Failed to parse condition \'%ls\' at position: %u");
  }
  return iVar1;
}



/* Function: FUN_004050ba */

int FUN_004050ba(int param_1)

{
  short sVar1;
  WCHAR WVar2;
  PCNZWCH lpString1;
  LPCWSTR pWVar3;
  int iVar4;
  int iVar5;
  LPCWSTR pWVar6;
  undefined4 *puVar7;
  uint uVar8;
  uint uVar9;
  uint uVar10;
  char *pcVar11;
  undefined8 local_14;
  int local_c;
  uint local_8;
  
  local_8 = 0;
  uVar8 = 0;
  FUN_00418e52((int *)(param_1 + 0x18));
  puVar7 = (undefined4 *)(param_1 + 0x10);
  for (iVar5 = 6; iVar5 != 0; iVar5 = iVar5 + -1) {
    *puVar7 = 0;
    puVar7 = puVar7 + 1;
  }
  uVar10 = 1;
  sVar1 = **(short **)(param_1 + 8);
  while ((sVar1 != 0 &&
         (GetStringTypeW(1,*(LPCWSTR *)(param_1 + 8),1,(LPWORD)&local_8), (local_8 & 0x40) != 0))) {
    *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + 2;
    sVar1 = **(short **)(param_1 + 8);
  }
  puVar7 = (undefined4 *)(param_1 + 0x10);
  pWVar6 = *(LPCWSTR *)(param_1 + 8);
  local_c = (int)pWVar6 - *(int *)(param_1 + 4) >> 1;
  WVar2 = *pWVar6;
  if ((ushort)WVar2 < 0x3d) {
    if (WVar2 != L'<') {
      iVar5 = 0;
      if (WVar2 == L'\0') {
        *puVar7 = 1;
        goto LAB_00405601;
      }
      local_14 = CONCAT44(0x22,(int)local_14);
      pWVar3 = pWVar6;
      if (WVar2 != L'\"') {
        if (WVar2 == L'(') {
          *puVar7 = 0xe;
        }
        else {
          if (WVar2 != L')') goto LAB_0040522b;
          *puVar7 = 0xf;
        }
        uVar8 = 1;
        goto LAB_00405601;
      }
      do {
        uVar10 = uVar8;
        WVar2 = pWVar3[1];
        if (WVar2 == L'\0') {
          *(undefined4 *)(param_1 + 0x28) = 1;
          FUN_004300d9();
          pcVar11 = "Failed to parse condition \"%ls\". Unterminated literal at position %d.";
          goto LAB_00405286;
        }
        pWVar3 = pWVar3 + 1;
        uVar8 = uVar10 + 1;
      } while (WVar2 != L'\"');
      uVar8 = uVar10 + 2;
      *puVar7 = 0x12;
      pWVar6 = pWVar6 + 1;
LAB_00405428:
      iVar5 = FUN_00418dbd((int *)(param_1 + 0x18),pWVar6,uVar10);
LAB_00405431:
      if (iVar5 < 0) {
        FUN_00430a57(iVar5,"Failed to set symbol value.");
        return iVar5;
      }
      goto LAB_00405601;
    }
    WVar2 = pWVar6[1];
    if (WVar2 == L'<') {
      *puVar7 = 0x1000c;
    }
    else if (WVar2 == L'=') {
      *puVar7 = 0x10007;
    }
    else {
      if (WVar2 != L'>') {
        *puVar7 = 0x10005;
        uVar8 = uVar10;
        goto LAB_004055bb;
      }
      *puVar7 = 0x1000a;
    }
LAB_004055ef:
    uVar8 = 2;
  }
  else if (WVar2 == L'=') {
    *puVar7 = 0x10009;
    uVar8 = uVar10;
  }
  else {
    if (WVar2 == L'>') {
      WVar2 = pWVar6[1];
      if (WVar2 == L'<') {
        *puVar7 = 0x1000b;
      }
      else if (WVar2 == L'=') {
        *puVar7 = 0x10008;
      }
      else {
        if (WVar2 != L'>') {
          *puVar7 = 0x10006;
          uVar8 = uVar10;
          goto LAB_004055bb;
        }
        *puVar7 = 0x1000d;
      }
      goto LAB_004055ef;
    }
    if (WVar2 != L'~') {
LAB_0040522b:
      if (((local_8 & 4) == 0) && (*pWVar6 != L'-')) {
        if (((local_8 & 0x100) == 0) && (*pWVar6 != L'_')) {
          *(undefined4 *)(param_1 + 0x28) = 1;
          FUN_004300d9();
          pcVar11 = "Failed to parse condition \"%ls\". Unexpected character at position %d.";
LAB_00405286:
          FUN_00430a57(0x8007000d,pcVar11);
          return -0x7ff8fff3;
        }
        GetStringTypeW(1,pWVar6 + 1,1,(LPWORD)&local_8);
        if ((**(short **)(param_1 + 8) == 0x76) && ((local_8 & 4) != 0)) {
          uVar10 = 1;
          do {
            while( true ) {
              uVar9 = uVar8;
              uVar8 = uVar9 + 1;
              pWVar6 = (LPCWSTR)(*(int *)(param_1 + 8) + uVar8 * 2);
              if (*pWVar6 != L'.') break;
              uVar10 = uVar10 + 1;
              if (4 < uVar10) {
                *(undefined4 *)(param_1 + 0x28) = 1;
                FUN_004300d9();
                pcVar11 = 
                "Failed to parse condition \"%ls\". Version can have a maximum of 4 parts, at position %d."
                ;
                goto LAB_00405286;
              }
            }
            GetStringTypeW(1,pWVar6,1,(LPWORD)&local_8);
          } while ((local_8 & 4) != 0);
          iVar5 = FUN_0043720f((LPCWSTR)(*(int *)(param_1 + 8) + 2),uVar9,(uint *)(param_1 + 0x18));
          if (-1 < iVar5) {
            *(undefined4 *)(param_1 + 0x20) = 3;
            *(undefined4 *)(param_1 + 0x10) = 0x13;
            goto LAB_00405601;
          }
          *(undefined4 *)(param_1 + 0x28) = 1;
          FUN_004300d9();
          pcVar11 = "Failed to parse condition \"%ls\". Invalid version format, at position %d.";
          goto LAB_00405286;
        }
        do {
          do {
            uVar8 = uVar8 + 1;
            GetStringTypeW(1,(LPCWSTR)(*(int *)(param_1 + 8) + uVar8 * 2),1,(LPWORD)&local_8);
          } while ((local_8 & 0x100) != 0);
        } while (((local_8 & 4) != 0) ||
                (lpString1 = *(PCNZWCH *)(param_1 + 8), lpString1[uVar8] == L'_'));
        iVar5 = 0;
        if (uVar8 == 2) {
          iVar4 = CompareStringW(0x7f,1,lpString1,2,L"OR",2);
          if (iVar4 == 2) {
            *(undefined4 *)(param_1 + 0x10) = 2;
            goto LAB_00405601;
          }
        }
        else if (uVar8 == 3) {
          iVar4 = CompareStringW(0x7f,1,lpString1,3,L"AND",3);
          if (iVar4 == 2) {
            *(undefined4 *)(param_1 + 0x10) = 3;
            goto LAB_00405601;
          }
          iVar4 = CompareStringW(0x7f,1,*(PCNZWCH *)(param_1 + 8),3,L"NOT",3);
          if (iVar4 == 2) {
            *(undefined4 *)(param_1 + 0x10) = 4;
            goto LAB_00405601;
          }
        }
        pWVar6 = *(LPCWSTR *)(param_1 + 8);
        *(undefined4 *)(param_1 + 0x10) = 0x11;
        uVar10 = uVar8;
        goto LAB_00405428;
      }
      do {
        uVar8 = uVar8 + 1;
        GetStringTypeW(1,pWVar6 + uVar8,1,(LPWORD)&local_8);
        if (((local_8 & 0x100) != 0) || (pWVar6 = *(LPCWSTR *)(param_1 + 8), pWVar6[uVar8] == L'_'))
        {
          *(undefined4 *)(param_1 + 0x28) = 1;
          FUN_004300d9();
          pcVar11 = 
          "Failed to parse condition \"%ls\". Identifier cannot start at a digit, at position %d.";
          goto LAB_00405286;
        }
      } while ((local_8 & 4) != 0);
      *(undefined4 *)(param_1 + 0x10) = 0x10;
      local_14 = 0;
      iVar5 = FUN_004345da(pWVar6,uVar8,&local_14);
      if (iVar5 < 0) {
        *(undefined4 *)(param_1 + 0x28) = 1;
        FUN_004300d9();
        pcVar11 = "Failed to parse condition \"%ls\". Constant too big, at position %d.";
        goto LAB_00405286;
      }
      iVar5 = FUN_00418d81((int *)(param_1 + 0x18),(int)local_14,local_14._4_4_);
      goto LAB_00405431;
    }
    WVar2 = pWVar6[1];
    if (WVar2 == L'<') {
      WVar2 = pWVar6[2];
      if (WVar2 == L'<') {
        *puVar7 = 0x3000c;
      }
      else {
        if (WVar2 != L'=') {
          if (WVar2 == L'>') {
            *puVar7 = 0x3000a;
LAB_004055a5:
            uVar8 = 3;
          }
          else {
            *puVar7 = 0x30005;
LAB_0040559b:
            uVar8 = 2;
          }
          iVar5 = 0;
          goto LAB_00405601;
        }
        *puVar7 = 0x30007;
      }
    }
    else {
      if (WVar2 == L'=') {
        *puVar7 = 0x30009;
        goto LAB_004055ef;
      }
      if (WVar2 != L'>') {
        *(undefined4 *)(param_1 + 0x28) = 1;
        FUN_004300d9();
        pcVar11 = "Failed to parse condition \"%ls\". Unexpected \'~\' operator at position %d.";
        goto LAB_00405286;
      }
      WVar2 = pWVar6[2];
      if (WVar2 == L'<') {
        *puVar7 = 0x3000b;
      }
      else {
        if (WVar2 != L'=') {
          if (WVar2 == L'>') {
            *puVar7 = 0x3000d;
            goto LAB_004055a5;
          }
          *puVar7 = 0x30006;
          goto LAB_0040559b;
        }
        *puVar7 = 0x30008;
      }
    }
    uVar8 = 3;
  }
LAB_004055bb:
  iVar5 = 0;
LAB_00405601:
  *(int *)(param_1 + 0x14) = local_c;
  *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + uVar8 * 2;
  return iVar5;
}



/* Function: FUN_00405616 */

DWORD FUN_00405616(undefined4 *param_1,uint *param_2)

{
  int *piVar1;
  undefined4 *puVar2;
  DWORD DVar3;
  uint uVar4;
  char *pcVar5;
  uint local_10;
  int local_c;
  uint local_8;
  
  puVar2 = param_1;
  piVar1 = param_1 + 4;
  local_10 = 0;
  local_c = 0;
  local_8 = 0;
  param_1 = (undefined4 *)0x1;
  if (*piVar1 == 4) {
    DVar3 = FUN_004050ba((int)puVar2);
    if (-1 < (int)DVar3) {
      local_c = 1;
      goto LAB_00405656;
    }
    pcVar5 = "Failed to read next symbol.";
  }
  else {
LAB_00405656:
    DVar3 = FUN_00405776(puVar2,&local_8);
    if (-1 < (int)DVar3) {
      uVar4 = local_8;
      if (local_c != 0) {
        uVar4 = (uint)(local_8 == 0);
      }
      goto LAB_00405686;
    }
    pcVar5 = "Failed to parse term.";
  }
  FUN_00430a57(DVar3,pcVar5);
  uVar4 = 0;
LAB_00405686:
  if ((int)DVar3 < 0) {
    pcVar5 = "Failed to parse boolean-factor.";
  }
  else {
    if (puVar2[4] != 3) {
      *param_2 = uVar4;
      return DVar3;
    }
    DVar3 = FUN_004050ba((int)puVar2);
    if ((int)DVar3 < 0) {
      pcVar5 = "Failed to read next symbol.";
    }
    else {
      DVar3 = FUN_00405616(puVar2,&local_10);
      if (-1 < (int)DVar3) {
        if ((uVar4 == 0) || (local_10 == 0)) {
          param_1 = (undefined4 *)0x0;
        }
        *param_2 = (uint)param_1;
        return DVar3;
      }
      pcVar5 = "Failed to parse boolean-term.";
    }
  }
  FUN_00430a57(DVar3,pcVar5);
  return DVar3;
}



/* Function: FUN_004056ef */

DWORD FUN_004056ef(undefined4 *param_1,uint *param_2)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  uint local_c;
  uint local_8;
  
  uVar2 = 0;
  local_8 = 0;
  local_c = 0;
  DVar1 = FUN_00405616(param_1,&local_8);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to parse boolean-term.";
  }
  else {
    if (param_1[4] != 2) {
      *param_2 = local_8;
      return DVar1;
    }
    DVar1 = FUN_004050ba((int)param_1);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to read next symbol.";
    }
    else {
      DVar1 = FUN_004056ef(param_1,&local_c);
      if (-1 < (int)DVar1) {
        if ((local_8 != 0) || (local_c != 0)) {
          uVar2 = 1;
        }
        *param_2 = uVar2;
        return DVar1;
      }
      pcVar3 = "Failed to parse expression.";
    }
  }
  FUN_00430a57(DVar1,pcVar3);
  return DVar1;
}



/* Function: FUN_00405776 */

DWORD FUN_00405776(undefined4 *param_1,uint *param_2)

{
  DWORD DVar1;
  uint uVar2;
  bool bVar3;
  char *pcVar4;
  LPCWSTR local_24;
  uint uStack_20;
  int iStack_1c;
  undefined4 uStack_18;
  LPCWSTR local_14;
  uint local_10;
  int local_c;
  undefined4 uStack_8;
  
  local_14 = (LPCWSTR)0x0;
  local_10 = 0;
  local_c = 0;
  uStack_8 = 0;
  local_24 = (LPCWSTR)0x0;
  uStack_20 = 0;
  iStack_1c = 0;
  uStack_18 = 0;
  if (param_1[4] == 0xe) {
    DVar1 = FUN_004050ba((int)param_1);
    if ((int)DVar1 < 0) {
LAB_00405802:
      pcVar4 = "Failed to read next symbol.";
    }
    else {
      DVar1 = FUN_004056ef(param_1,param_2);
      if ((int)DVar1 < 0) {
        pcVar4 = "Failed to parse expression.";
      }
      else {
        DVar1 = FUN_00405057((int)param_1,0xf);
        if (-1 < (int)DVar1) {
          DVar1 = 0;
          goto LAB_0040588d;
        }
        pcVar4 = "Failed to expect right parenthesis.";
      }
    }
  }
  else {
    DVar1 = FUN_004058a8(param_1,(int *)&local_14);
    if (-1 < (int)DVar1) {
      uVar2 = param_1[4];
      if ((uVar2 & 0x10000) == 0) {
        uVar2 = 0;
        if (local_c != 0) {
          if (local_c == 1) {
LAB_0040587b:
            if (local_14 == (LPCWSTR)0x0) {
              bVar3 = local_10 == 0;
              goto LAB_00405883;
            }
          }
          else {
            if (local_c != 2) {
              if (local_c != 3) {
                DVar1 = 0x8000ffff;
                goto LAB_0040588d;
              }
              goto LAB_0040587b;
            }
            if (local_14 == (LPCWSTR)0x0) goto LAB_00405888;
            bVar3 = *local_14 == L'\0';
LAB_00405883:
            if (bVar3) goto LAB_00405888;
          }
          uVar2 = 1;
        }
LAB_00405888:
        *param_2 = uVar2;
        goto LAB_0040588d;
      }
      DVar1 = FUN_004050ba((int)param_1);
      if ((int)DVar1 < 0) goto LAB_00405802;
      DVar1 = FUN_004058a8(param_1,(int *)&local_24);
      if (-1 < (int)DVar1) {
        DVar1 = FUN_00404df9(uVar2,local_14,local_10,local_c,uStack_8,local_24,uStack_20,iStack_1c,
                             uStack_18,param_2);
        if (-1 < (int)DVar1) goto LAB_0040588d;
        pcVar4 = "Failed to compare value.";
        goto LAB_0040584c;
      }
    }
    pcVar4 = "Failed to parse value.";
  }
LAB_0040584c:
  FUN_00430a57(DVar1,pcVar4);
LAB_0040588d:
  FUN_00418e52((int *)&local_14);
  FUN_00418e52((int *)&local_24);
  return DVar1;
}



/* Function: FUN_004058a8 */

DWORD FUN_004058a8(undefined4 *param_1,int *param_2)

{
  int iVar1;
  DWORD DVar2;
  char *pcVar3;
  
  iVar1 = param_1[4];
  if (iVar1 == 0x10) {
LAB_00405925:
    _memcpy_s(param_2,0x10,param_1 + 6,0x10);
    param_1[6] = 0;
    param_1[7] = 0;
    param_1[8] = 0;
    param_1[9] = 0;
  }
  else {
    if (iVar1 != 0x11) {
      if ((iVar1 != 0x12) && (iVar1 != 0x13)) {
        param_1[10] = 1;
        FUN_004300d9();
        FUN_00430a57(0x8007000d,"Failed to parse condition \'%ls\' at position: %u");
        return 0x8007000d;
      }
      goto LAB_00405925;
    }
    DVar2 = FUN_00403c82((LPCRITICAL_SECTION)*param_1,(PCNZWCH)param_1[6],param_2);
    if ((DVar2 != 0x80070490) && ((int)DVar2 < 0)) {
      FUN_004300d9();
      pcVar3 = "Failed to find variable.";
      goto LAB_00405951;
    }
  }
  DVar2 = FUN_004050ba((int)param_1);
  if (-1 < (int)DVar2) {
    return DVar2;
  }
  pcVar3 = "Failed to read next symbol.";
LAB_00405951:
  FUN_00430a57(DVar2,pcVar3);
  return DVar2;
}



/* Function: FUN_00405961 */

DWORD FUN_00405961(uint param_1,undefined4 param_2,uint *param_3)

{
  uint uVar1;
  DWORD DVar2;
  char *pcVar3;
  uint local_38;
  undefined4 local_34;
  undefined4 local_30;
  int local_10;
  uint local_8;
  
  FUN_004267c0(&local_38,0,0x30);
  local_38 = param_1;
  local_8 = 0;
  local_34 = param_2;
  local_30 = param_2;
  DVar2 = FUN_004050ba((int)&local_38);
  if ((int)DVar2 < 0) {
    pcVar3 = "Failed to read next symbol.";
  }
  else {
    DVar2 = FUN_004056ef(&local_38,&local_8);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to parse expression.";
    }
    else {
      DVar2 = FUN_00405057((int)&local_38,1);
      uVar1 = local_8;
      if (-1 < (int)DVar2) {
        FUN_0040ea26(local_8);
        FUN_00402003(3,0x20000034);
        *param_3 = uVar1;
        DVar2 = 0;
        goto LAB_004059fe;
      }
      pcVar3 = "Failed to expect end symbol.";
    }
  }
  FUN_00430a57(DVar2,pcVar3);
LAB_004059fe:
  if (local_10 != 0) {
    FUN_004309f9(DVar2,0xe0000033,(LPCVOID)0x0);
  }
  return DVar2;
}



/* Function: FUN_00405a1b */

DWORD FUN_00405a1b(uint param_1,int *param_2,int param_3,LPCWSTR param_4,undefined4 *param_5,
                  undefined4 *param_6)

{
  DWORD DVar1;
  undefined4 local_10;
  uint local_c;
  int local_8;
  
  local_8 = 0;
  local_10 = 0;
  local_c = 1;
  FUN_00436186(&local_8,&local_10);
  if (2 < local_8) {
    if (*param_2 == 0) {
      return 0;
    }
    DVar1 = FUN_00405961(param_1,*param_2,&local_c);
    if ((int)DVar1 < 0) {
      FUN_00430a57(DVar1,"Failed to evaluate condition: %ls");
      return DVar1;
    }
    if (local_c != 0) {
      return DVar1;
    }
  }
  DVar1 = FUN_00417551(param_3,param_4,0x8007047e);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to display error dialog");
  }
  else {
    *param_5 = 0x8007047e;
    *param_6 = 0;
  }
  return DVar1;
}



/* Function: FUN_00405ab1 */

int FUN_00405ab1(int *param_1,int *param_2)

{
  int iVar1;
  char *pcVar2;
  int *local_c;
  LPCWSTR local_8;
  
  local_c = (int *)0x0;
  local_8 = (LPCWSTR)0x0;
  iVar1 = FUN_00436045(param_2,L"Condition",(int)&local_c);
  if (iVar1 == 1) {
    iVar1 = 0;
  }
  else {
    if (iVar1 < 0) {
      pcVar2 = "Failed to select condition node.";
    }
    else {
      iVar1 = FUN_00435d59(local_c,&local_8);
      if (iVar1 < 0) {
        pcVar2 = "Failed to get Condition inner text.";
      }
      else {
        iVar1 = FUN_00433f88(param_1,local_8,0);
        if (-1 < iVar1) goto LAB_00405b1f;
        pcVar2 = "Failed to copy condition string from BSTR";
      }
    }
    FUN_00430a57(iVar1,pcVar2);
  }
LAB_00405b1f:
  if (local_8 != (LPCWSTR)0x0) {
    Ordinal_6(local_8);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  return iVar1;
}



/* Function: FUN_00405b42 */

DWORD FUN_00405b42(int param_1,LPCRITICAL_SECTION param_2)

{
  uint uVar1;
  DWORD DVar2;
  int iVar3;
  char *pcVar4;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  iVar3 = 0;
  uVar1 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x14),(int *)&local_8,(uint *)0x0);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to format variable string.";
  }
  else {
    DVar2 = GetFileAttributesW(local_8);
    if (DVar2 == 0xffffffff) {
      DVar2 = GetLastError();
      uVar1 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar1 = DVar2;
      }
      if ((uVar1 == 0x80070002) || (uVar1 == 0x80070003)) {
        uVar1 = 0;
      }
    }
    else if ((DVar2 & 0x10) != 0) {
      iVar3 = 1;
    }
    if ((int)uVar1 < 0) {
      FUN_00430a57(uVar1,"Failed while searching directory search: %ls, for path: %ls");
      goto LAB_00405beb;
    }
    uVar1 = FUN_004045df(param_2,*(PCNZWCH *)(param_1 + 4),iVar3,0,0);
    if (-1 < (int)uVar1) goto LAB_00405beb;
    pcVar4 = "Failed to set variable.";
  }
  FUN_00430a57(uVar1,pcVar4);
LAB_00405beb:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00405c02 */

DWORD FUN_00405c02(int param_1,LPCRITICAL_SECTION param_2)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  DVar1 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x14),(int *)&local_8,(uint *)0x0);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to format variable string.";
LAB_00405c70:
    FUN_00430a57(DVar1,pcVar3);
  }
  else {
    DVar1 = GetFileAttributesW(local_8);
    if (DVar1 == 0xffffffff) {
      DVar2 = GetLastError();
      DVar1 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        DVar1 = DVar2;
      }
    }
    else if ((DVar1 & 0x10) == 0) {
      DVar1 = 0x80070003;
    }
    else {
      DVar1 = FUN_0040461f(param_2,*(PCNZWCH *)(param_1 + 4),(int)local_8,0);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to set directory search path variable.";
        goto LAB_00405c70;
      }
    }
    if ((DVar1 == 0x80070002) || (DVar1 == 0x80070003)) {
      FUN_00430f28(2,"Directory search: %ls, did not find path: %ls, reason: 0x%x");
      DVar1 = 0;
    }
    else if ((int)DVar1 < 0) {
      FUN_00430a57(DVar1,"Failed while searching directory search: %ls, for path: %ls");
    }
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_00405cd5 */

DWORD FUN_00405cd5(int param_1,LPCRITICAL_SECTION param_2)

{
  uint uVar1;
  DWORD DVar2;
  int iVar3;
  char *pcVar4;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  iVar3 = 0;
  uVar1 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x14),(int *)&local_8,(uint *)0x0);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to format variable string.";
  }
  else {
    DVar2 = GetFileAttributesW(local_8);
    if (DVar2 == 0xffffffff) {
      DVar2 = GetLastError();
      if ((DVar2 == 2) || (DVar2 == 3)) {
        FUN_00430f28(2,"File search: %ls, did not find path: %ls");
      }
      else if (DVar2 != 0) {
        uVar1 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar1 = DVar2;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        FUN_004300d9();
        FUN_00430a57(uVar1,"Failed get to file attributes. \'%ls\'");
        goto LAB_00405da5;
      }
    }
    else if ((DVar2 & 0x10) == 0) {
      iVar3 = 1;
    }
    uVar1 = FUN_004045df(param_2,*(PCNZWCH *)(param_1 + 4),iVar3,0,0);
    if (-1 < (int)uVar1) goto LAB_00405da5;
    pcVar4 = "Failed to set variable.";
  }
  FUN_00430a57(uVar1,pcVar4);
LAB_00405da5:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00405dbc */

DWORD FUN_00405dbc(int param_1,LPCRITICAL_SECTION param_2)

{
  uint uVar1;
  DWORD DVar2;
  char *pcVar3;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  uVar1 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x14),(int *)&local_8,(uint *)0x0);
  if ((int)uVar1 < 0) {
    pcVar3 = "Failed to format variable string.";
LAB_00405e51:
    FUN_00430a57(uVar1,pcVar3);
    goto LAB_00405e71;
  }
  DVar2 = GetFileAttributesW(local_8);
  if (DVar2 == 0xffffffff) {
    DVar2 = GetLastError();
    uVar1 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar1 = DVar2;
    }
LAB_00405e09:
    if ((uVar1 != 0x80070002) && (uVar1 != 0x80070003)) {
      if ((int)uVar1 < 0) {
        FUN_00430a57(uVar1,"Failed while searching file search: %ls, for path: %ls");
      }
      goto LAB_00405e71;
    }
  }
  else if ((DVar2 & 0x10) == 0) {
    uVar1 = FUN_0040461f(param_2,*(PCNZWCH *)(param_1 + 4),(int)local_8,0);
    if ((int)uVar1 < 0) {
      pcVar3 = "Failed to set variable to file search path.";
      goto LAB_00405e51;
    }
    goto LAB_00405e09;
  }
  FUN_00430f28(2,"File search: %ls, did not find path: %ls");
  uVar1 = 0;
LAB_00405e71:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00405e87 */

DWORD FUN_00405e87(int param_1,LPCRITICAL_SECTION param_2)

{
  DWORD DVar1;
  char *pcVar2;
  int local_10;
  undefined4 local_c;
  LPCWSTR local_8;
  
  local_10 = 0;
  local_c = 0;
  local_8 = (LPCWSTR)0x0;
  DVar1 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x14),(int *)&local_8,(uint *)0x0);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to format path string.";
  }
  else {
    DVar1 = FUN_0043710a(local_8,&local_c,&local_10);
    if ((DVar1 == 0x80070002) || (DVar1 == 0x80070003)) {
      FUN_00430f28(2,"File search: %ls, did not find path: %ls");
      DVar1 = 0;
      goto LAB_00405f25;
    }
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed get file version.";
    }
    else {
      DVar1 = FUN_0040467b(param_2,*(PCNZWCH *)(param_1 + 4),local_10,local_c,0);
      if (-1 < (int)DVar1) goto LAB_00405f25;
      pcVar2 = "Failed to set variable.";
    }
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_00405f25:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_00405f3b */

int FUN_00405f3b(int param_1,LPCRITICAL_SECTION param_2)

{
  int iVar1;
  int iVar2;
  undefined1 (*pauVar3) [16];
  char *pcVar4;
  LPVOID local_14;
  LPVOID local_10;
  int local_c;
  undefined1 (*local_8) [16];
  
  local_c = 0;
  local_10 = (LPVOID)0x0;
  local_14 = (LPVOID)0x0;
  local_8 = (undefined1 (*) [16])0x0;
  iVar2 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x18),(int *)&local_10,(uint *)0x0);
  if (iVar2 < 0) {
    pcVar4 = "Failed to format component id string.";
LAB_00406069:
    FUN_00430a57(iVar2,pcVar4);
  }
  else {
    if ((*(int *)(param_1 + 0x14) != 0) &&
       (iVar2 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x14),(int *)&local_14,(uint *)0x0),
       iVar2 < 0)) {
      pcVar4 = "Failed to format product code string.";
      goto LAB_00406069;
    }
    if (local_14 == (LPVOID)0x0) {
      iVar2 = FUN_0043566f(local_10,&local_c,(int *)&local_8);
    }
    else {
      iVar2 = FUN_00435156(local_14,local_10,&local_c,(int *)&local_8);
    }
    iVar1 = 4;
    if (local_c == -4) {
LAB_00406000:
      local_c = iVar1;
      iVar1 = *(int *)(param_1 + 0x10);
      if (iVar1 == 1) {
        if (((local_c == 2) || (local_c == 3)) || (local_c == 4)) {
LAB_00406050:
          iVar2 = FUN_0040461f(param_2,*(PCNZWCH *)(param_1 + 4),(int)local_8,0);
        }
      }
      else if (iVar1 == 2) {
        iVar2 = FUN_004045df(param_2,*(PCNZWCH *)(param_1 + 4),local_c,local_c >> 0x1f,0);
      }
      else if ((iVar1 == 3) && (((local_c == 2 || (local_c == 3)) || (local_c == 4)))) {
        pauVar3 = FUN_00427010(local_8,0x5c);
        if (pauVar3 != (undefined1 (*) [16])0x0) {
          *(undefined2 *)(*pauVar3 + 2) = 0;
        }
        goto LAB_00406050;
      }
      if (-1 < iVar2) goto LAB_00406083;
      pcVar4 = "Failed to set variable.";
      goto LAB_00406069;
    }
    if ((local_c == -1) || (local_c == -7)) {
      iVar1 = 2;
      goto LAB_00406000;
    }
    iVar1 = local_c;
    if (((local_c == 2) || (local_c == 3)) || (local_c == 4)) goto LAB_00406000;
    iVar2 = -0x7ff8ffa9;
    FUN_00430a57(0x80070057,"Failed to get component path: %d");
  }
  FUN_00430f28(2,"MsiComponentSearch failed: ID \'%ls\', HRESULT 0x%x");
LAB_00406083:
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_14 != (LPVOID)0x0) {
    FUN_004380ab(local_14);
  }
  if (local_8 != (undefined1 (*) [16])0x0) {
    FUN_004380ab(local_8);
  }
  return iVar2;
}



/* Function: FUN_004060b6 */

uint FUN_004060b6(int param_1,LPCRITICAL_SECTION param_2)

{
  int iVar1;
  uint uVar2;
  wchar_t *pwVar3;
  char *pcVar4;
  uint local_1c [5];
  LPVOID local_8;
  
  local_1c[0] = 0;
  local_1c[1] = 0;
  local_1c[2] = 0;
  local_1c[3] = 0;
  iVar1 = *(int *)(param_1 + 0x10);
  local_8 = (LPVOID)0x0;
  local_1c[4] = 0;
  if (iVar1 == 1) {
    pwVar3 = L"VersionString";
LAB_00406117:
    uVar2 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x14),(int *)&local_8,(uint *)0x0);
    if ((int)uVar2 < 0) {
      pcVar4 = "Failed to format product code string.";
    }
    else {
      local_1c[2] = 2;
      uVar2 = FUN_004352d2(local_8,pwVar3,(int *)local_1c);
      if (uVar2 == 0x80070648) {
        FUN_00430f28(3,"Trying per-machine extended info for property \'%ls\' for product: %ls");
        uVar2 = FUN_00435361(local_8,0,4,pwVar3,(int *)local_1c);
        if (uVar2 == 0x80070645) {
          FUN_00430f28(2,"Trying per-user extended info for property \'%ls\' for product: %ls");
          uVar2 = FUN_00435361(local_8,0,2,pwVar3,(int *)local_1c);
          goto LAB_004061a9;
        }
      }
      else {
LAB_004061a9:
        if (uVar2 == 0x80070645) {
          FUN_00430f28(2,"Product not found: %ls");
          iVar1 = *(int *)(param_1 + 0x10);
          if (iVar1 == 1) {
LAB_004061d0:
            local_1c[0] = 0;
            local_1c[1] = 0;
LAB_004061d8:
            local_1c[2] = 1;
          }
          else {
            if (iVar1 == 3) {
              local_1c[0] = 2;
              local_1c[1] = 0;
              goto LAB_004061d8;
            }
            if (iVar1 == 4) goto LAB_004061d0;
          }
          uVar2 = 0;
        }
      }
      if ((int)uVar2 < 0) {
        pcVar4 = "Failed to get product info.";
      }
      else {
        iVar1 = *(int *)(param_1 + 0x10);
        if (iVar1 == 1) {
          uVar2 = 3;
        }
        else if (iVar1 == 2) {
          uVar2 = 2;
        }
        else if ((iVar1 == 3) || (uVar2 = local_1c[4], iVar1 == 4)) {
          uVar2 = 1;
        }
        uVar2 = FUN_00418b53(local_1c,uVar2);
        if ((int)uVar2 < 0) {
          pcVar4 = "Failed to change value type.";
        }
        else {
          uVar2 = FUN_0040465b(param_2,*(PCNZWCH *)(param_1 + 4),(int *)local_1c,0);
          if (-1 < (int)uVar2) goto LAB_00406266;
          pcVar4 = "Failed to set variable.";
        }
      }
    }
    FUN_00430a57(uVar2,pcVar4);
  }
  else {
    if (iVar1 == 2) {
      pwVar3 = L"Language";
      goto LAB_00406117;
    }
    if (iVar1 == 3) {
      pwVar3 = L"State";
      goto LAB_00406117;
    }
    if (iVar1 == 4) {
      pwVar3 = L"AssignmentType";
      goto LAB_00406117;
    }
    uVar2 = 0x80004001;
    FUN_00430a57(0x80004001,"Unsupported product search type: %u");
  }
  FUN_00430f28(2,"MsiProductSearch failed: ID \'%ls\', HRESULT 0x%x");
LAB_00406266:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  FUN_00418e52((int *)local_1c);
  return uVar2;
}



/* Function: FUN_00406286 */

uint FUN_00406286(int param_1,LPCRITICAL_SECTION param_2)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  char *pcVar5;
  DWORD local_14;
  HKEY local_10;
  LPCWSTR local_c;
  LPVOID local_8;
  
  iVar4 = 1;
  iVar1 = iVar4;
  if (*(int *)(param_1 + 0x24) != 0) {
    iVar1 = 0x101;
  }
  local_8 = (LPVOID)0x0;
  local_c = (LPCWSTR)0x0;
  local_10 = (HKEY)0x0;
  local_14 = 0;
  uVar2 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x1c),(int *)&local_8,(uint *)0x0);
  if ((int)uVar2 < 0) {
    pcVar5 = "Failed to format key string.";
LAB_00406369:
    FUN_00430a57(uVar2,pcVar5);
  }
  else {
    uVar2 = FUN_004324d5(*(undefined4 *)(param_1 + 0x18),local_8,iVar1,&local_10);
    if (-1 < (int)uVar2) {
      if (*(int *)(param_1 + 0x20) != 0) {
        uVar2 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x20),(int *)&local_c,(uint *)0x0);
        if ((int)uVar2 < 0) {
          pcVar5 = "Failed to format value string.";
          goto LAB_00406369;
        }
        uVar3 = RegQueryValueExW(local_10,local_c,(LPDWORD)0x0,&local_14,(LPBYTE)0x0,(LPDWORD)0x0);
        if (uVar3 != 0) {
          if (uVar3 == 2) {
            FUN_00430f28(2,"Registry value not found. Key = \'%ls\', Value = \'%ls\'");
            goto LAB_004063a4;
          }
          if (uVar3 != 0) {
            uVar2 = uVar3 & 0xffff | 0x80070000;
            if ((int)uVar3 < 1) {
              uVar2 = uVar3;
            }
            if (-1 < (int)uVar2) {
              uVar2 = 0x80004005;
            }
            FUN_004300d9();
            pcVar5 = "Failed to query registry key value.";
            goto LAB_00406369;
          }
        }
      }
LAB_004063a6:
      uVar2 = FUN_004045df(param_2,*(PCNZWCH *)(param_1 + 4),iVar4,0,0);
      if (-1 < (int)uVar2) goto LAB_004063ea;
      pcVar5 = "Failed to set variable.";
      goto LAB_00406369;
    }
    if (uVar2 == 0x80070002) {
      FUN_00430f28(2,"Registry key not found. Key = \'%ls\'");
LAB_004063a4:
      iVar4 = 0;
      goto LAB_004063a6;
    }
    FUN_00430a57(uVar2,"Failed to open registry key. Key = \'%ls\'");
  }
  if ((int)uVar2 < 0) {
    FUN_00430f28(2,"RegistrySearchExists failed: ID \'%ls\', HRESULT 0x%x");
  }
LAB_004063ea:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (HKEY)0x0) {
    RegCloseKey(local_10);
  }
  return uVar2;
}



/* Function: FUN_0040641e */

uint FUN_0040641e(int param_1,LPCRITICAL_SECTION param_2)

{
  undefined4 uVar1;
  uint uVar2;
  uint uVar3;
  DWORD DVar4;
  DWORD DVar5;
  int iVar6;
  LPCWSTR lpSrc;
  int iVar7;
  char *pcVar8;
  LPWSTR local_28;
  undefined4 uStack_24;
  undefined4 local_20;
  undefined4 uStack_1c;
  DWORD local_18;
  HKEY local_14;
  LPCWSTR local_10;
  LPVOID local_c;
  DWORD local_8;
  
  local_28 = (LPWSTR)0x0;
  uStack_24 = 0;
  local_20 = 0;
  uStack_1c = 0;
  uVar1 = 1;
  if (*(int *)(param_1 + 0x24) != 0) {
    uVar1 = 0x101;
  }
  local_c = (LPVOID)0x0;
  local_10 = (LPCWSTR)0x0;
  local_14 = (HKEY)0x0;
  local_18 = 0;
  local_8 = 0;
  lpSrc = (LPCWSTR)0x0;
  uVar2 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x1c),(int *)&local_c,(uint *)0x0);
  if ((int)uVar2 < 0) {
    pcVar8 = "Failed to format key string.";
LAB_00406738:
    FUN_00430a57(uVar2,pcVar8);
    if (-1 < (int)uVar2) goto LAB_00406757;
  }
  else {
    if ((*(int *)(param_1 + 0x20) != 0) &&
       (uVar2 = FUN_00403a92(param_2,*(LPCWSTR *)(param_1 + 0x20),(int *)&local_10,(uint *)0x0),
       (int)uVar2 < 0)) {
      pcVar8 = "Failed to format value string.";
      goto LAB_00406738;
    }
    uVar2 = FUN_004324d5(*(undefined4 *)(param_1 + 0x18),local_c,uVar1,&local_14);
    if (uVar2 == 0x80070002) {
      FUN_00430f28(2,"Registry key not found. Key = \'%ls\'");
LAB_004064cb:
      uVar2 = FUN_0040465b(param_2,*(PCNZWCH *)(param_1 + 4),(int *)&local_28,0);
      if (-1 < (int)uVar2) {
        uVar2 = 0;
        goto LAB_00406757;
      }
      pcVar8 = "Failed to clear variable.";
      goto LAB_00406738;
    }
    if ((int)uVar2 < 0) {
      pcVar8 = "Failed to open registry key.";
      goto LAB_00406738;
    }
    uVar3 = RegQueryValueExW(local_14,local_10,(LPDWORD)0x0,&local_18,(LPBYTE)0x0,&local_8);
    if (uVar3 == 2) {
      FUN_00430f28(2,"Registry value not found. Key = \'%ls\', Value = \'%ls\'");
      goto LAB_004064cb;
    }
    if (uVar3 != 0) {
      uVar2 = uVar3 & 0xffff | 0x80070000;
      if ((int)uVar3 < 1) {
        uVar2 = uVar3;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
      pcVar8 = "Failed to query registry key value size.";
      goto LAB_00406738;
    }
    lpSrc = (LPCWSTR)FUN_00431078(local_8 + 2,1);
    if (lpSrc != (LPCWSTR)0x0) {
      uVar3 = RegQueryValueExW(local_14,local_10,(LPDWORD)0x0,&local_18,(LPBYTE)lpSrc,&local_8);
      if (uVar3 == 0) {
        if (local_18 == 1) {
LAB_004066ea:
          uVar2 = FUN_00418dbd((int *)&local_28,lpSrc,0);
        }
        else {
          if (local_18 != 2) {
            if (local_18 == 4) {
              if (local_8 == 4) {
                iVar7 = *(int *)lpSrc;
                iVar6 = iVar7 >> 0x1f;
LAB_00406636:
                uVar2 = FUN_00418d81((int *)&local_28,iVar7,iVar6);
                goto LAB_004066f8;
              }
            }
            else {
              if (local_18 != 0xb) {
                uVar2 = 0x80004001;
                FUN_00430a57(0x80004001,"Unsupported registry key value type. Type = \'%u\'");
                goto LAB_00406744;
              }
              if (local_8 == 8) {
                iVar6 = *(int *)(lpSrc + 2);
                iVar7 = *(int *)lpSrc;
                goto LAB_00406636;
              }
            }
            uVar2 = 0x8000ffff;
            goto LAB_00406744;
          }
          if (*(int *)(param_1 + 0x28) == 0) goto LAB_004066ea;
          uVar2 = FUN_00433bdf((int *)&local_28,local_8);
          if ((int)uVar2 < 0) {
LAB_0040666d:
            pcVar8 = "Failed to allocate string buffer.";
            goto LAB_00406738;
          }
          local_20 = 2;
          DVar4 = ExpandEnvironmentStringsW(lpSrc,local_28,local_8);
          if (local_8 < DVar4) {
            uVar2 = FUN_00433bdf((int *)&local_28,DVar4);
            if ((int)uVar2 < 0) goto LAB_0040666d;
            DVar5 = ExpandEnvironmentStringsW(lpSrc,local_28,DVar4);
            if (DVar4 != DVar5) {
              DVar4 = GetLastError();
              uVar2 = DVar4 & 0xffff | 0x80070000;
              if ((int)DVar4 < 1) {
                uVar2 = DVar4;
              }
              if (-1 < (int)uVar2) {
                uVar2 = 0x80004005;
              }
              FUN_004300d9();
              pcVar8 = "Failed to get expand environment string.";
              goto LAB_00406738;
            }
          }
        }
LAB_004066f8:
        if ((int)uVar2 < 0) {
          pcVar8 = "Failed to read registry value.";
        }
        else {
          uVar2 = FUN_00418b53((uint *)&local_28,*(uint *)(param_1 + 0x14));
          if ((int)uVar2 < 0) {
            pcVar8 = "Failed to change value type.";
          }
          else {
            uVar2 = FUN_0040465b(param_2,*(PCNZWCH *)(param_1 + 4),(int *)&local_28,0);
            if (-1 < (int)uVar2) goto LAB_00406757;
            pcVar8 = "Failed to set variable.";
          }
        }
      }
      else {
        uVar2 = uVar3 & 0xffff | 0x80070000;
        if ((int)uVar3 < 1) {
          uVar2 = uVar3;
        }
        if (-1 < (int)uVar2) {
          uVar2 = 0x80004005;
        }
        FUN_004300d9();
        pcVar8 = "Failed to query registry key value.";
      }
      goto LAB_00406738;
    }
    uVar2 = 0x8007000e;
    FUN_004300d9();
    FUN_00430a57(0x8007000e,"Failed to allocate memory registry value.");
  }
LAB_00406744:
  FUN_00430f28(2,"RegistrySearchValue failed: ID \'%ls\', HRESULT 0x%x");
LAB_00406757:
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_14 != (HKEY)0x0) {
    RegCloseKey(local_14);
    local_14 = (HKEY)0x0;
  }
  if (lpSrc != (LPCWSTR)0x0) {
    FUN_00431137(lpSrc);
  }
  FUN_00418e52((int *)&local_28);
  return uVar2;
}



/* Function: FUN_004067a2 */

DWORD FUN_004067a2(int *param_1,LPCRITICAL_SECTION param_2)

{
  short *psVar1;
  int iVar2;
  DWORD DVar3;
  int iVar4;
  uint local_10;
  int local_c;
  uint local_8;
  
  local_10 = 0;
  local_8 = 0;
  if (param_1[1] != 0) {
    local_c = 0;
    do {
      iVar4 = *param_1 + local_c;
      psVar1 = *(short **)(iVar4 + 8);
      if ((psVar1 == (short *)0x0) || (*psVar1 == 0)) {
LAB_0040680a:
        iVar2 = *(int *)(iVar4 + 0xc);
        if (iVar2 == 1) {
          if (*(int *)(iVar4 + 0x10) == 1) {
            FUN_00405b42(iVar4,param_2);
          }
          else if (*(int *)(iVar4 + 0x10) == 2) {
            FUN_00405c02(iVar4,param_2);
          }
        }
        else if (iVar2 == 2) {
          iVar2 = *(int *)(iVar4 + 0x10);
          if (iVar2 == 1) {
            FUN_00405cd5(iVar4,param_2);
          }
          else if (iVar2 == 2) {
            FUN_00405e87(iVar4,param_2);
          }
          else if (iVar2 == 3) {
            FUN_00405dbc(iVar4,param_2);
          }
        }
        else if (iVar2 == 3) {
          if (*(int *)(iVar4 + 0x10) == 1) {
            FUN_00406286(iVar4,param_2);
          }
          else if (*(int *)(iVar4 + 0x10) == 2) {
            FUN_0040641e(iVar4,param_2);
          }
        }
        else if (iVar2 == 4) {
          FUN_00405f3b(iVar4,param_2);
        }
        else if (iVar2 == 5) {
          FUN_004060b6(iVar4,param_2);
        }
        else if (iVar2 == 6) {
          FUN_00430f28(2,"MsiFeatureSearch failed: ID \'%ls\', HRESULT 0x%x");
        }
      }
      else {
        DVar3 = FUN_00405961((uint)param_2,psVar1,&local_10);
        if (DVar3 != 0x8007000d) {
          if ((int)DVar3 < 0) {
            FUN_00430a57(DVar3,
                         "Failed to evaluate search condition. Id = \'%ls\', Condition = \'%ls\'");
            return DVar3;
          }
          if (local_10 != 0) goto LAB_0040680a;
        }
      }
      local_8 = local_8 + 1;
      local_c = local_c + 0x2c;
    } while (local_8 < (uint)param_1[1]);
  }
  return 0;
}



/* Function: FUN_004068e6 */

uint FUN_004068e6(int *param_1,int *param_2)

{
  uint uVar1;
  int iVar2;
  int *piVar3;
  undefined4 uVar4;
  wchar_t *lpString2;
  char *pcVar5;
  int local_1c;
  int *local_18;
  int *local_14;
  PCNZWCH local_10;
  int *local_c;
  PCNZWCH local_8;
  
  local_18 = (int *)0x0;
  local_c = (int *)0x0;
  local_14 = (int *)0x0;
  local_10 = (PCNZWCH)0x0;
  local_8 = (PCNZWCH)0x0;
  uVar1 = FUN_00435fbe(param_2,
                       L"DirectorySearch|FileSearch|RegistrySearch|MsiComponentSearch|MsiProductSearch|MsiFeatureSearch"
                       ,(int)&local_18);
  if ((int)uVar1 < 0) {
    pcVar5 = "Failed to select search nodes.";
  }
  else {
    uVar1 = (**(code **)(*local_18 + 0x20))(local_18,&local_14);
    if ((int)uVar1 < 0) {
      pcVar5 = "Failed to get search node count.";
    }
    else {
      if (local_14 == (int *)0x0) goto LAB_00407084;
      iVar2 = FUN_00431078((int)local_14 * 0x2c,1);
      *param_1 = iVar2;
      if (iVar2 != 0) {
        param_1[1] = (int)local_14;
        param_2 = (int *)0x0;
        if (local_14 != (int *)0x0) {
          local_1c = 0;
          do {
            piVar3 = (int *)(*param_1 + local_1c);
            uVar1 = FUN_00435f1d(local_18,&local_c,&local_10);
            if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get next node.";
LAB_00407077:
              FUN_00430a57(uVar1,pcVar5);
              goto LAB_00407084;
            }
            uVar1 = FUN_00435b5e(local_c,&DAT_0043c524,piVar3);
            if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get @Id.";
              goto LAB_00407077;
            }
            uVar1 = FUN_00435b5e(local_c,L"Variable",piVar3 + 1);
            if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get @Variable.";
              goto LAB_00407077;
            }
            uVar1 = FUN_00435b5e(local_c,L"Condition",piVar3 + 2);
            if ((uVar1 != 0x80070490) && ((int)uVar1 < 0)) {
              pcVar5 = "Failed to get @Condition.";
              goto LAB_00407077;
            }
            iVar2 = CompareStringW(0x7f,0,local_10,-1,L"DirectorySearch",-1);
            if (iVar2 == 2) {
              piVar3[3] = 1;
              uVar1 = FUN_00435b5e(local_c,L"Path",piVar3 + 5);
              if ((int)uVar1 < 0) {
LAB_00406fcd:
                pcVar5 = "Failed to get @Path.";
                goto LAB_00407077;
              }
              uVar1 = FUN_00435b5e(local_c,L"Type",(int *)&local_8);
              if (-1 < (int)uVar1) {
                iVar2 = CompareStringW(0x7f,0,local_8,-1,L"exists",-1);
                if (iVar2 == 2) goto LAB_00406f74;
                iVar2 = CompareStringW(0x7f,0,local_8,-1,L"path",-1);
                if (iVar2 != 2) goto LAB_00407025;
LAB_00406a99:
                piVar3[4] = 2;
                goto LAB_00406f7b;
              }
LAB_00407037:
              pcVar5 = "Failed to get @Type.";
              goto LAB_00407077;
            }
            iVar2 = CompareStringW(0x7f,0,local_10,-1,L"FileSearch",-1);
            if (iVar2 == 2) {
              piVar3[3] = 2;
              uVar1 = FUN_00435b5e(local_c,L"Path",piVar3 + 5);
              if ((int)uVar1 < 0) goto LAB_00406fcd;
              uVar1 = FUN_00435b5e(local_c,L"Type",(int *)&local_8);
              if ((int)uVar1 < 0) goto LAB_00407037;
              iVar2 = CompareStringW(0x7f,0,local_8,-1,L"exists",-1);
              if (iVar2 == 2) goto LAB_00406f74;
              iVar2 = CompareStringW(0x7f,0,local_8,-1,L"version",-1);
              if (iVar2 == 2) goto LAB_00406a99;
              lpString2 = L"path";
LAB_00406dfd:
              iVar2 = CompareStringW(0x7f,0,local_8,-1,lpString2,-1);
              if (iVar2 == 2) {
LAB_00406e10:
                piVar3[4] = 3;
                goto LAB_00406f7b;
              }
LAB_00407025:
              pcVar5 = "Invalid value for @Type: %ls";
LAB_0040702d:
              uVar1 = 0x80070057;
              uVar4 = 0x80070057;
LAB_0040705a:
              FUN_00430a57(uVar4,pcVar5);
              goto LAB_00407084;
            }
            iVar2 = CompareStringW(0x7f,0,local_10,-1,L"RegistrySearch",-1);
            if (iVar2 == 2) {
              piVar3[3] = 3;
              uVar1 = FUN_00435b5e(local_c,L"Root",(int *)&local_8);
              if ((int)uVar1 < 0) {
                pcVar5 = "Failed to get @Root.";
                goto LAB_00407077;
              }
              iVar2 = CompareStringW(0x7f,0,local_8,-1,L"HKCR",-1);
              if (iVar2 != 2) {
                iVar2 = CompareStringW(0x7f,0,local_8,-1,L"HKCU",-1);
                if (iVar2 == 2) {
                  piVar3[6] = -0x7fffffff;
                  goto LAB_00406beb;
                }
                iVar2 = CompareStringW(0x7f,0,local_8,-1,L"HKLM",-1);
                if (iVar2 == 2) {
                  piVar3[6] = -0x7ffffffe;
                  goto LAB_00406beb;
                }
                iVar2 = CompareStringW(0x7f,0,local_8,-1,L"HKU",-1);
                if (iVar2 == 2) {
                  piVar3[6] = -0x7ffffffd;
                  goto LAB_00406beb;
                }
                pcVar5 = "Invalid value for @Root: %ls";
                goto LAB_0040702d;
              }
              piVar3[6] = -0x80000000;
LAB_00406beb:
              uVar1 = FUN_00435b5e(local_c,&DAT_0043dc68,piVar3 + 7);
              if ((int)uVar1 < 0) {
                pcVar5 = "Failed to get Key attribute.";
              }
              else {
                uVar1 = FUN_00435b5e(local_c,L"Value",piVar3 + 8);
                if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                  uVar1 = FUN_00435b5e(local_c,L"Type",(int *)&local_8);
                  if ((int)uVar1 < 0) goto LAB_00407037;
                  uVar1 = FUN_00435d6c(local_c,L"Win64",(uint *)(piVar3 + 9));
                  if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                    iVar2 = CompareStringW(0x7f,0,local_8,-1,L"exists",-1);
                    if (iVar2 == 2) goto LAB_00406f74;
                    iVar2 = CompareStringW(0x7f,0,local_8,-1,L"value",-1);
                    if (iVar2 != 2) goto LAB_00407025;
                    piVar3[4] = 2;
                    uVar1 = FUN_00435d6c(local_c,L"ExpandEnvironment",(uint *)(piVar3 + 10));
                    if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                      uVar1 = FUN_00435b5e(local_c,L"VariableType",(int *)&local_8);
                      if (-1 < (int)uVar1) {
                        iVar2 = CompareStringW(0x7f,0,local_8,-1,L"numeric",-1);
                        if (iVar2 == 2) {
                          piVar3[5] = 1;
                        }
                        else {
                          iVar2 = CompareStringW(0x7f,0,local_8,-1,L"string",-1);
                          if (iVar2 == 2) {
                            piVar3[5] = 2;
                          }
                          else {
                            iVar2 = CompareStringW(0x7f,0,local_8,-1,L"version",-1);
                            if (iVar2 != 2) {
                              pcVar5 = "Invalid value for @VariableType: %ls";
                              goto LAB_0040702d;
                            }
                            piVar3[5] = 3;
                          }
                        }
                        goto LAB_00406f7b;
                      }
                      pcVar5 = "Failed to get @VariableType.";
                    }
                    else {
                      pcVar5 = "Failed to get @ExpandEnvironment.";
                    }
                  }
                  else {
                    pcVar5 = "Failed to get Win64 attribute.";
                  }
                }
                else {
                  pcVar5 = "Failed to get Value attribute.";
                }
              }
              goto LAB_00407077;
            }
            iVar2 = CompareStringW(0x7f,0,local_10,-1,L"MsiComponentSearch",-1);
            if (iVar2 == 2) {
              piVar3[3] = 4;
              uVar1 = FUN_00435b5e(local_c,L"ProductCode",piVar3 + 5);
              if ((uVar1 != 0x80070490) && ((int)uVar1 < 0)) {
LAB_00407045:
                pcVar5 = "Failed to get @ProductCode.";
                goto LAB_00407077;
              }
              uVar1 = FUN_00435b5e(local_c,L"ComponentId",piVar3 + 6);
              if ((int)uVar1 < 0) {
                pcVar5 = "Failed to get @ComponentId.";
                goto LAB_00407077;
              }
              uVar1 = FUN_00435b5e(local_c,L"Type",(int *)&local_8);
              if ((int)uVar1 < 0) goto LAB_00407037;
              iVar2 = CompareStringW(0x7f,0,local_8,-1,L"keyPath",-1);
              if (iVar2 != 2) {
                iVar2 = CompareStringW(0x7f,0,local_8,-1,L"state",-1);
                if (iVar2 != 2) {
                  lpString2 = L"directory";
                  goto LAB_00406dfd;
                }
                goto LAB_00406a99;
              }
            }
            else {
              iVar2 = CompareStringW(0x7f,0,local_10,-1,L"MsiProductSearch",-1);
              if (iVar2 == 2) {
                piVar3[3] = 5;
                uVar1 = FUN_00435b5e(local_c,L"ProductCode",piVar3 + 5);
                if ((int)uVar1 < 0) goto LAB_00407045;
                uVar1 = FUN_00435b5e(local_c,L"Type",(int *)&local_8);
                if ((int)uVar1 < 0) goto LAB_00407037;
                iVar2 = CompareStringW(0x7f,0,local_8,-1,L"version",-1);
                if (iVar2 != 2) {
                  iVar2 = CompareStringW(0x7f,0,local_8,-1,L"language",-1);
                  if (iVar2 != 2) {
                    iVar2 = CompareStringW(0x7f,0,local_8,-1,L"state",-1);
                    if (iVar2 == 2) goto LAB_00406e10;
                    iVar2 = CompareStringW(0x7f,0,local_8,-1,L"assignment",-1);
                    if (iVar2 != 2) goto LAB_00407025;
                    piVar3[4] = 4;
                    goto LAB_00406f7b;
                  }
                  goto LAB_00406a99;
                }
              }
              else {
                iVar2 = CompareStringW(0x7f,0,local_10,-1,L"MsiFeatureSearch",-1);
                if (iVar2 != 2) {
                  uVar1 = 0x8000ffff;
                  pcVar5 = "Unexpected element name: %ls";
                  uVar4 = 0x8000ffff;
                  goto LAB_0040705a;
                }
                piVar3[3] = 6;
                uVar1 = FUN_00435b5e(local_c,L"ProductCode",piVar3 + 5);
                if ((int)uVar1 < 0) goto LAB_00407045;
                uVar1 = FUN_00435b5e(local_c,L"FeatureId",piVar3 + 6);
                if ((int)uVar1 < 0) {
                  pcVar5 = "Failed to get @FeatureId.";
                  goto LAB_00407077;
                }
                uVar1 = FUN_00435b5e(local_c,L"Type",(int *)&local_8);
                if ((int)uVar1 < 0) goto LAB_00407037;
                iVar2 = CompareStringW(0x7f,0,local_8,-1,L"state",-1);
                if (iVar2 != 2) goto LAB_00407025;
              }
            }
LAB_00406f74:
            piVar3[4] = 1;
LAB_00406f7b:
            if (local_c != (int *)0x0) {
              (**(code **)(*local_c + 8))(local_c);
              local_c = (int *)0x0;
            }
            if (local_10 != (PCNZWCH)0x0) {
              Ordinal_6(local_10);
              local_10 = (PCNZWCH)0x0;
            }
            param_2 = (int *)((int)param_2 + 1);
            local_1c = local_1c + 0x2c;
          } while (param_2 < local_14);
        }
        uVar1 = 0;
        goto LAB_00407084;
      }
      uVar1 = 0x8007000e;
      FUN_004300d9();
      pcVar5 = "Failed to allocate memory for search structs.";
    }
  }
  FUN_00430a57(uVar1,pcVar5);
LAB_00407084:
  if (local_18 != (int *)0x0) {
    (**(code **)(*local_18 + 8))(local_18);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  if (local_10 != (PCNZWCH)0x0) {
    Ordinal_6(local_10);
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_004070c2 */

void FUN_004070c2(int *param_1)

{
  int iVar1;
  int *piVar2;
  int *piVar3;
  uint uVar4;
  LPVOID pvVar5;
  
  piVar2 = param_1;
  uVar4 = 0;
  if (*param_1 != 0) {
    if (param_1[1] != 0) {
      param_1 = (int *)0x0;
      do {
        piVar3 = (int *)(*piVar2 + (int)param_1);
        if (*piVar3 != 0) {
          FUN_004380ab((LPVOID)*piVar3);
        }
        if (piVar3[1] != 0) {
          FUN_004380ab((LPVOID)piVar3[1]);
        }
        if (piVar3[2] != 0) {
          FUN_004380ab((LPVOID)piVar3[2]);
        }
        iVar1 = piVar3[3];
        if ((iVar1 == 1) || (iVar1 == 2)) {
LAB_00407156:
          if (piVar3[5] != 0) {
            pvVar5 = (LPVOID)piVar3[5];
            goto LAB_0040715f;
          }
        }
        else if (iVar1 == 3) {
          if (piVar3[7] != 0) {
            FUN_004380ab((LPVOID)piVar3[7]);
          }
          if (piVar3[8] != 0) {
            pvVar5 = (LPVOID)piVar3[8];
            goto LAB_0040715f;
          }
        }
        else {
          if (iVar1 != 4) {
            if (iVar1 == 5) goto LAB_00407156;
            if (iVar1 != 6) goto LAB_00407164;
          }
          if (piVar3[5] != 0) {
            FUN_004380ab((LPVOID)piVar3[5]);
          }
          if (piVar3[6] != 0) {
            pvVar5 = (LPVOID)piVar3[6];
LAB_0040715f:
            FUN_004380ab(pvVar5);
          }
        }
LAB_00407164:
        uVar4 = uVar4 + 1;
        param_1 = param_1 + 0xb;
      } while (uVar4 < (uint)piVar2[1]);
    }
    FUN_00431137((LPVOID)*piVar2);
  }
  return;
}



/* Function: FUN_00407185 */

undefined4
FUN_00407185(int param_1,uint param_2,int param_3,uint *param_4,uint *param_5,undefined4 *param_6)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  undefined4 uVar4;
  undefined4 uVar5;
  
  uVar5 = 0;
  if (param_2 < *(uint *)(param_1 + 0x34)) {
    if (param_3 == *(int *)(param_1 + 0x30)) {
      uVar3 = 1;
      if (param_2 == 0) {
        *param_4 = *(uint *)(param_1 + 4);
        param_4[1] = 0;
      }
      else {
        *param_4 = *(uint *)(param_1 + 8);
        param_4[1] = 0;
        if (1 < param_2) {
          do {
            uVar2 = *(uint *)(*(int *)(param_1 + 0x38) + uVar3 * 4);
            uVar1 = *param_4;
            *param_4 = *param_4 + uVar2;
            param_4[1] = param_4[1] + (uint)CARRY4(uVar1,uVar2);
            uVar3 = uVar3 + 1;
          } while (uVar3 < param_2);
        }
      }
      uVar4 = 1;
      *param_5 = *(uint *)(*(int *)(param_1 + 0x38) + param_2 * 4);
      param_5[1] = 0;
      uVar3 = param_4[1] + (uint)CARRY4(*param_4,*param_5);
      if ((*(uint *)(param_1 + 0x14) < uVar3) ||
         ((*(uint *)(param_1 + 0x14) <= uVar3 && (*(uint *)(param_1 + 0x10) < *param_4 + *param_5)))
         ) {
        uVar4 = 0;
      }
      *param_6 = uVar4;
    }
    else {
      uVar5 = 0x8007000d;
      FUN_004300d9();
      FUN_00430a57(0x8007000d,"Unexpected container format.");
    }
  }
  else {
    uVar5 = 0x8007000d;
    FUN_004300d9();
    FUN_00430a57(0x8007000d,"Failed to find container info, too few elements: %u");
  }
  return uVar5;
}



/* Function: FUN_0040725f */

void FUN_0040725f(undefined4 *param_1)

{
  LARGE_INTEGER liDistanceToMove;
  LARGE_INTEGER liDistanceToMove_00;
  uint uVar1;
  HANDLE pvVar2;
  DWORD DVar3;
  BOOL BVar4;
  int iVar5;
  LPVOID nNumberOfBytesToRead;
  undefined8 *puVar6;
  int iVar7;
  DWORD unaff_ESI;
  char *unaff_EDI;
  DWORD *pDVar8;
  int iVar9;
  char *pcVar10;
  DWORD local_18c [5];
  uint local_178;
  LPVOID local_174;
  LPCWSTR local_170;
  _OVERLAPPED local_16c;
  LPDWORD local_158;
  int local_154;
  uint local_140;
  ushort local_13a;
  ushort local_12c;
  uint local_48 [15];
  int local_c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_170 = (LPCWSTR)0x0;
  local_16c.Internal = 0;
  local_18c[0] = 0;
  local_18c[1] = 0;
  FUN_004267c0(local_48,0,0x40);
  FUN_004267c0(&local_140,0,0xf8);
  *param_1 = 0xffffffff;
  local_16c.InternalHigh = 0;
  local_16c.u.s.Offset = 0;
  pDVar8 = &local_16c.u.s.OffsetHigh;
  for (iVar7 = 8; iVar7 != 0; iVar7 = iVar7 + -1) {
    *pDVar8 = 0;
    pDVar8 = pDVar8 + 1;
  }
  local_18c[3] = 0;
  local_18c[4] = 0;
  local_174 = (LPVOID)0x0;
  uVar1 = FUN_00431c19((int *)&local_170,(HMODULE)0x0);
  if (-1 < (int)uVar1) {
    pvVar2 = CreateFileW(local_170,0x80000000,5,(LPSECURITY_ATTRIBUTES)0x0,3,0x80,(HANDLE)0x0);
    *param_1 = pvVar2;
    if (pvVar2 == (HANDLE)0xffffffff) {
      DVar3 = GetLastError();
      uVar1 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar1 = DVar3;
      }
      if (-1 < (int)uVar1) {
        uVar1 = 0x80004005;
      }
      FUN_004300d9();
      pcVar10 = "Failed to open handle to engine process path: %ls";
LAB_0040735a:
      FUN_00430a57(uVar1,pcVar10);
      goto LAB_004079f8;
    }
    BVar4 = SetFilePointerEx(pvVar2,(LARGE_INTEGER)0x0,(PLARGE_INTEGER)0x0,(DWORD)unaff_EDI);
    if (BVar4 == 0) {
      DVar3 = GetLastError();
      uVar1 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar1 = DVar3;
      }
      if (-1 < (int)uVar1) {
        uVar1 = 0x80004005;
      }
      FUN_004300d9();
      unaff_EDI = "Failed to seek to start of file.";
    }
    else {
      BVar4 = ReadFile((HANDLE)*param_1,local_48,0x40,&local_16c.Internal,(LPOVERLAPPED)0x0);
      if (BVar4 == 0) {
        DVar3 = GetLastError();
        uVar1 = DVar3 & 0xffff | 0x80070000;
        if ((int)DVar3 < 1) {
          uVar1 = DVar3;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        FUN_004300d9();
        unaff_EDI = "Failed to read DOS header.";
      }
      else if ((local_16c.Internal < (LPDWORD)0x40) || ((short)local_48[0] != 0x5a4d)) {
        FUN_004300d9();
        unaff_EDI = "Failed to find valid DOS image header in buffer.";
LAB_004079f0:
        uVar1 = 0x8007000d;
      }
      else {
        DVar3 = 0;
        liDistanceToMove_00.s.HighPart = 0;
        liDistanceToMove_00.s.LowPart = local_c >> 0x1f;
        BVar4 = SetFilePointerEx((HANDLE)*param_1,liDistanceToMove_00,(PLARGE_INTEGER)0x0,unaff_ESI)
        ;
        if (BVar4 == 0) {
          DVar3 = GetLastError();
          uVar1 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            uVar1 = DVar3;
          }
          if (-1 < (int)uVar1) {
            uVar1 = 0x80004005;
          }
          FUN_004300d9();
          unaff_EDI = "Failed to seek to NT header.";
        }
        else {
          BVar4 = ReadFile((HANDLE)*param_1,&local_140,0x18,&local_16c.Internal,(LPOVERLAPPED)0x0);
          if (BVar4 == 0) {
            DVar3 = GetLastError();
            uVar1 = DVar3 & 0xffff | 0x80070000;
            if ((int)DVar3 < 1) {
              uVar1 = DVar3;
            }
            if (-1 < (int)uVar1) {
              uVar1 = 0x80004005;
            }
            FUN_004300d9();
            unaff_EDI = "Failed to read NT header.";
          }
          else {
            if ((local_16c.Internal < (LPDWORD)0x18) || (local_140 != 0x4550)) {
              FUN_004300d9();
              unaff_EDI = "Failed to find valid NT image header in buffer.";
              goto LAB_004079f0;
            }
            iVar7 = local_c + 0x58;
            iVar5 = local_c + 0x98;
            BVar4 = SetFilePointerEx((HANDLE)*param_1,(LARGE_INTEGER)0x0,(PLARGE_INTEGER)0x0,DVar3);
            if (BVar4 == 0) {
              DVar3 = GetLastError();
              uVar1 = DVar3 & 0xffff | 0x80070000;
              if ((int)DVar3 < 1) {
                uVar1 = DVar3;
              }
              if (-1 < (int)uVar1) {
                uVar1 = 0x80004005;
              }
              FUN_004300d9();
              unaff_EDI = "Failed to seek to section info.";
            }
            else {
              BVar4 = ReadFile((HANDLE)*param_1,local_18c + 3,4,&local_16c.Internal,
                               (LPOVERLAPPED)0x0);
              if (BVar4 == 0) {
                DVar3 = GetLastError();
                uVar1 = DVar3 & 0xffff | 0x80070000;
                if ((int)DVar3 < 1) {
                  uVar1 = DVar3;
                }
                if (-1 < (int)uVar1) {
                  uVar1 = 0x80004005;
                }
                FUN_004300d9();
                unaff_EDI = "Failed to read signature offset.";
              }
              else {
                pvVar2 = (HANDLE)0x40758f;
                BVar4 = ReadFile((HANDLE)*param_1,local_18c + 4,4,&local_16c.Internal,
                                 (LPOVERLAPPED)0x0);
                if (BVar4 == 0) {
                  DVar3 = GetLastError();
                  uVar1 = DVar3 & 0xffff | 0x80070000;
                  if ((int)DVar3 < 1) {
                    uVar1 = DVar3;
                  }
                  if (-1 < (int)uVar1) {
                    uVar1 = 0x80004005;
                  }
                  FUN_004300d9();
                  unaff_EDI = "Failed to read signature size.";
                }
                else {
                  liDistanceToMove.s.HighPart = 0;
                  liDistanceToMove.s.LowPart = local_c + 0x18 + (uint)local_12c;
                  BVar4 = SetFilePointerEx(pvVar2,liDistanceToMove,(PLARGE_INTEGER)0x0,0);
                  if (BVar4 != 0) {
                    iVar9 = 0;
                    local_18c[2] = 0;
                    BVar4 = ReadFile((HANDLE)*param_1,&local_16c.InternalHigh,0x28,
                                     &local_16c.Internal,(LPOVERLAPPED)0x0);
                    if (BVar4 != 0) {
                      uVar1 = 1;
                      do {
                        if (local_16c.Internal < (LPDWORD)0x28) {
                          FUN_004300d9();
                          pcVar10 = "Failed to read complete image section header, index: %u";
LAB_0040797d:
                          uVar1 = 0x8007000d;
                          goto LAB_0040735a;
                        }
                        if ((local_16c.InternalHigh == 0x7869772e) &&
                           (local_16c.u.s.Offset == 0x6e727562)) {
                          if (local_158 < (LPDWORD)0x34) {
                            FUN_004300d9();
                            pcVar10 = "Failed to read section info, data to short: %u";
                            goto LAB_0040797d;
                          }
                          nNumberOfBytesToRead = (LPVOID)FUN_00431078((SIZE_T)local_158,1);
                          local_174 = nNumberOfBytesToRead;
                          if (nNumberOfBytesToRead == (LPVOID)0x0) {
                            FUN_004300d9();
                            unaff_EDI = "Failed to allocate buffer for section info.";
                            uVar1 = 0x8007000e;
                            goto LAB_004079f1;
                          }
                          pvVar2 = (HANDLE)*param_1;
                          BVar4 = SetFilePointerEx(pvVar2,(LARGE_INTEGER)0x0,(PLARGE_INTEGER)0x0,
                                                   unaff_ESI);
                          if (BVar4 == 0) {
                            DVar3 = GetLastError();
                            uVar1 = DVar3 & 0xffff | 0x80070000;
                            if ((int)DVar3 < 1) {
                              uVar1 = DVar3;
                            }
                            if (-1 < (int)uVar1) {
                              uVar1 = 0x80004005;
                            }
                            pcVar10 = (LPCSTR)0xc3;
                            FUN_004300d9();
LAB_00407765:
                            FUN_00430a57(uVar1,pcVar10);
                          }
                          else {
                            local_178 = local_154 + 0x1c;
                            BVar4 = ReadFile(pvVar2,(LPVOID)*param_1,(DWORD)nNumberOfBytesToRead,
                                             local_158,&local_16c);
                            if (BVar4 == 0) {
                              DVar3 = GetLastError();
                              uVar1 = DVar3 & 0xffff | 0x80070000;
                              if ((int)DVar3 < 1) {
                                uVar1 = DVar3;
                              }
                              if (-1 < (int)uVar1) {
                                uVar1 = 0x80004005;
                              }
                              pcVar10 = (LPCSTR)0xcc;
                              FUN_004300d9();
                              goto LAB_00407765;
                            }
                            if (local_16c.Internal < local_158) {
                              FUN_004300d9();
                              pcVar10 = "Failed to read complete section info.";
                              goto LAB_0040793a;
                            }
                            if (*(int *)((int)nNumberOfBytesToRead + 4) == 2) {
                              uVar1 = FUN_004370a5((HANDLE)*param_1,local_18c);
                              if ((int)uVar1 < 0) {
                                pcVar10 = "Failed to get total size of bundle.";
                              }
                              else {
                                iVar9 = *(int *)((int)nNumberOfBytesToRead + 0x18);
                                param_1[1] = iVar9;
                                if (*(int *)((int)nNumberOfBytesToRead + 0x20) == 0) {
                                  if (local_18c[3] == 0) {
                                    iVar9 = *(int *)((int)nNumberOfBytesToRead + 0x30) + iVar9;
                                  }
                                  else {
                                    iVar9 = local_18c[4] + local_18c[3];
                                  }
                                }
                                else {
                                  iVar9 = *(int *)((int)nNumberOfBytesToRead + 0x24) +
                                          *(int *)((int)nNumberOfBytesToRead + 0x20);
                                }
                                param_1[2] = iVar9;
                                param_1[4] = local_18c[0];
                                param_1[5] = local_18c[1];
                                param_1[6] = iVar7;
                                param_1[7] = iVar5;
                                param_1[8] = local_178;
                                param_1[9] = *(undefined4 *)((int)nNumberOfBytesToRead + 0x1c);
                                param_1[10] = *(undefined4 *)((int)nNumberOfBytesToRead + 0x20);
                                param_1[0xb] = *(undefined4 *)((int)nNumberOfBytesToRead + 0x24);
                                param_1[0xc] = *(undefined4 *)((int)nNumberOfBytesToRead + 0x28);
                                iVar7 = *(int *)((int)nNumberOfBytesToRead + 0x2c);
                                param_1[0xd] = iVar7;
                                puVar6 = (undefined8 *)FUN_00431078(iVar7 << 2,1);
                                param_1[0xe] = puVar6;
                                if (puVar6 != (undefined8 *)0x0) {
                                  FUN_004270c0(puVar6,(undefined8 *)
                                                      ((int)nNumberOfBytesToRead + 0x30),
                                               param_1[0xd] << 2);
                                  goto LAB_00407948;
                                }
                                FUN_004300d9();
                                pcVar10 = "Failed to allocate memory for container sizes.";
                                uVar1 = 0x8007000e;
                              }
                              goto LAB_00407765;
                            }
                            FUN_004300d9();
                            FUN_00430a57(0x8007000d,
                                         "Failed to read section info, unsupported version: %08x");
                            nNumberOfBytesToRead = local_174;
                          }
LAB_00407948:
                          if (nNumberOfBytesToRead != (LPVOID)0x0) {
                            FUN_00431137(nNumberOfBytesToRead);
                          }
                          goto LAB_004079f8;
                        }
                        if (local_13a <= uVar1) {
                          FUN_004300d9();
                          pcVar10 = "Failed to find Burn section.";
LAB_0040793a:
                          FUN_00430a57(0x8007000d,pcVar10);
                          nNumberOfBytesToRead = local_174;
                          goto LAB_00407948;
                        }
                        iVar9 = iVar9 + 1;
                        local_178 = uVar1 + 1;
                        local_18c[2] = iVar9;
                        BVar4 = ReadFile((HANDLE)*param_1,&local_16c.InternalHigh,0x28,
                                         &local_16c.Internal,(LPOVERLAPPED)0x0);
                        uVar1 = local_178;
                      } while (BVar4 != 0);
                    }
                    DVar3 = GetLastError();
                    uVar1 = DVar3 & 0xffff | 0x80070000;
                    if ((int)DVar3 < 1) {
                      uVar1 = DVar3;
                    }
                    if (-1 < (int)uVar1) {
                      uVar1 = 0x80004005;
                    }
                    FUN_004300d9();
                    pcVar10 = "Failed to read image section header, index: %u";
                    goto LAB_0040735a;
                  }
                  DVar3 = GetLastError();
                  uVar1 = DVar3 & 0xffff | 0x80070000;
                  if ((int)DVar3 < 1) {
                    uVar1 = DVar3;
                  }
                  if (-1 < (int)uVar1) {
                    uVar1 = 0x80004005;
                  }
                  FUN_004300d9();
                  unaff_EDI = "Failed to seek past optional headers.";
                }
              }
            }
          }
        }
      }
    }
  }
LAB_004079f1:
  FUN_00430a57(uVar1,unaff_EDI);
LAB_004079f8:
  if (local_170 != (LPCWSTR)0x0) {
    FUN_004380ab(local_170);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00407a1f */

void FUN_00407a1f(uint *param_1)

{
  if (param_1[0xe] != 0) {
    FUN_00431137((LPVOID)param_1[0xe]);
  }
  if (*param_1 != 0xffffffff) {
    CloseHandle((HANDLE)*param_1);
    *param_1 = 0xffffffff;
  }
  FUN_004267c0(param_1,0,0x40);
  return;
}



/* Function: FUN_00407a56 */

undefined4 FUN_00407a56(int *param_1,PCNZWCH param_2,undefined4 *param_3)

{
  int *piVar1;
  undefined4 *puVar2;
  int iVar3;
  uint uVar4;
  
  piVar1 = param_1;
  uVar4 = 0;
  if (param_1[1] != 0) {
    param_1 = (int *)0x0;
    do {
      puVar2 = (undefined4 *)(*piVar1 + (int)param_1);
      iVar3 = CompareStringW(0x7f,0,(PCNZWCH)*puVar2,-1,param_2,-1);
      if (iVar3 == 2) {
        *param_3 = puVar2;
        return 0;
      }
      uVar4 = uVar4 + 1;
      param_1 = param_1 + 4;
    } while (uVar4 < (uint)piVar1[1]);
  }
  return 0x80070490;
}



/* Function: FUN_00407ab3 */

DWORD FUN_00407ab3(int *param_1,int *param_2)

{
  int iVar1;
  int *piVar2;
  DWORD DVar3;
  HANDLE pvVar4;
  uint uVar5;
  char *pcVar6;
  uint local_c;
  int local_8;
  
  piVar2 = param_1;
  uVar5 = 0;
  local_8 = 0;
  local_c = 0;
  if (param_1[1] != 0) {
    param_1 = (int *)0x0;
    do {
      iVar1 = *piVar2;
      DVar3 = FUN_00407f4a(param_2,*(PCNZWCH *)((int)param_1 + iVar1 + 4),&local_8);
      if ((int)DVar3 < 0) {
        pcVar6 = "Failed to find payload for catalog file.";
LAB_00407bb5:
        FUN_00430a57(DVar3,pcVar6);
        return DVar3;
      }
      DVar3 = FUN_00433f88((int *)((int)param_1 + iVar1 + 8),*(LPCWSTR *)(local_8 + 0x50),0);
      if ((int)DVar3 < 0) {
        pcVar6 = "Failed to get catalog local file path";
        goto LAB_00407bb5;
      }
      pvVar4 = CreateFileW(*(LPCWSTR *)((int)param_1 + iVar1 + 8),0x80000000,5,
                           (LPSECURITY_ATTRIBUTES)0x0,3,0x8000000,(HANDLE)0x0);
      *(HANDLE *)((int)param_1 + iVar1 + 0xc) = pvVar4;
      if (pvVar4 == (HANDLE)0xffffffff) {
        DVar3 = GetLastError();
        uVar5 = DVar3 & 0xffff | 0x80070000;
        if ((int)DVar3 < 1) {
          uVar5 = DVar3;
        }
        if (-1 < (int)uVar5) {
          uVar5 = 0x80004005;
        }
        FUN_004300d9();
        pcVar6 = "Failed to open catalog in working path: %ls";
LAB_00407b9e:
        FUN_00430a57(uVar5,pcVar6);
        return uVar5;
      }
      uVar5 = FUN_004141e9(local_8,*(undefined4 *)((int)param_1 + iVar1 + 8),pvVar4);
      if ((int)uVar5 < 0) {
        pcVar6 = "Failed to verify catalog signature: %ls";
        goto LAB_00407b9e;
      }
      local_c = local_c + 1;
      param_1 = param_1 + 4;
    } while (local_c < (uint)piVar2[1]);
  }
  return uVar5;
}



/* Function: FUN_00407bc6 */

void FUN_00407bc6(int *param_1)

{
  int *piVar1;
  uint uVar2;
  int *piVar3;
  
  piVar1 = param_1;
  if (*param_1 != 0) {
    uVar2 = 0;
    if (param_1[1] != 0) {
      param_1 = (int *)0x0;
      do {
        piVar3 = (int *)(*piVar1 + (int)param_1);
        if (piVar3[3] != 0) {
          CloseHandle((HANDLE)piVar3[3]);
          piVar3[3] = 0;
        }
        if (*piVar3 != 0) {
          FUN_004380ab((LPVOID)*piVar3);
        }
        if (piVar3[2] != 0) {
          FUN_004380ab((LPVOID)piVar3[2]);
        }
        if (piVar3[1] != 0) {
          FUN_004380ab((LPVOID)piVar3[1]);
        }
        uVar2 = uVar2 + 1;
        param_1 = param_1 + 4;
      } while (uVar2 < (uint)piVar1[1]);
    }
    FUN_00431137((LPVOID)*piVar1);
  }
  *piVar1 = 0;
  piVar1[1] = 0;
  return;
}



/* Function: FUN_00407c43 */

uint FUN_00407c43(int *param_1,int *param_2)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  int *piVar4;
  char *pcVar5;
  int *local_10;
  uint local_c;
  int *local_8;
  
  local_10 = (int *)0x0;
  local_8 = (int *)0x0;
  local_c = 0;
  uVar1 = FUN_00435fbe(param_2,L"Catalog",(int)&local_10);
  if ((int)uVar1 < 0) {
    pcVar5 = "Failed to select catalog nodes.";
  }
  else {
    uVar1 = (**(code **)(*local_10 + 0x20))(local_10,&local_c);
    if ((int)uVar1 < 0) {
      pcVar5 = "Failed to get payload node count.";
    }
    else {
      if (local_c == 0) goto LAB_00407d6f;
      iVar2 = FUN_00431078(local_c << 4,1);
      *param_1 = iVar2;
      if (iVar2 != 0) {
        param_1[1] = local_c;
        uVar3 = 0;
        if (local_c != 0) {
          param_2 = (int *)0x0;
          do {
            piVar4 = (int *)(*param_1 + (int)param_2);
            piVar4[3] = -1;
            uVar1 = FUN_00435f1d(local_10,&local_8,(undefined4 *)0x0);
            if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get next node.";
LAB_00407d66:
              FUN_00430a57(uVar1,pcVar5);
              break;
            }
            uVar1 = FUN_00435b5e(local_8,&DAT_0043c524,piVar4);
            if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get @Id.";
              goto LAB_00407d66;
            }
            uVar1 = FUN_00435b5e(local_8,L"Payload",piVar4 + 1);
            if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get @Payload.";
              goto LAB_00407d66;
            }
            if (local_8 != (int *)0x0) {
              (**(code **)(*local_8 + 8))(local_8);
              local_8 = (int *)0x0;
            }
            uVar3 = uVar3 + 1;
            param_2 = param_2 + 4;
          } while (uVar3 < local_c);
        }
        goto LAB_00407d6f;
      }
      uVar1 = 0x8007000e;
      FUN_004300d9();
      pcVar5 = "Failed to allocate memory for payload structs.";
    }
  }
  FUN_00430a57(uVar1,pcVar5);
LAB_00407d6f:
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return uVar1;
}



/* Function: FUN_00407d91 */

DWORD FUN_00407d91(int *param_1,int param_2,int param_3,LPCWSTR param_4)

{
  int *piVar1;
  PCNZWCH lpString2;
  int iVar2;
  DWORD DVar3;
  int iVar4;
  DWORD DVar5;
  char *pcVar6;
  int local_18;
  uint local_14;
  int local_10;
  LPCWSTR local_c;
  PCNZWCH local_8;
  
  DVar5 = 0;
  local_8 = (PCNZWCH)0x0;
  local_c = (LPCWSTR)0x0;
  local_10 = 0;
  while (DVar3 = FUN_00418f25(param_3,&local_8), lpString2 = local_8, DVar3 != 0x80070103) {
    if ((int)DVar3 < 0) {
      pcVar6 = "Failed to get next stream.";
      goto LAB_00407ed7;
    }
    local_14 = 0;
    if (param_1[1] != 0) {
      local_18 = 0;
      do {
        iVar4 = *param_1 + local_18;
        if (((*(int *)(iVar4 + 4) == 2) && ((param_2 == 0 || (*(int *)(iVar4 + 0x3c) == param_2))))
           && (iVar2 = CompareStringW(0x7f,0,*(PCNZWCH *)(iVar4 + 0x38),-1,lpString2,-1),
              DVar3 = DVar5, iVar2 == 2)) goto LAB_00407e19;
        local_14 = local_14 + 1;
        local_18 = local_18 + 0x58;
      } while (local_14 < (uint)param_1[1]);
    }
    DVar3 = 0x80070490;
    iVar4 = local_10;
LAB_00407e19:
    local_10 = iVar4;
    if ((int)DVar3 < 0) {
      pcVar6 = "Failed to find embedded payload: %ls";
      goto LAB_00407f1c;
    }
    piVar1 = (int *)(local_10 + 0x50);
    DVar3 = FUN_004314a9(param_4,*(LPCWSTR *)(local_10 + 0x18),piVar1);
    if ((int)DVar3 < 0) {
      pcVar6 = "Failed to concat file paths.";
LAB_00407ed7:
      FUN_00430a57(DVar3,pcVar6);
      goto LAB_00407f25;
    }
    DVar3 = FUN_00431c88((LPCWSTR)*piVar1,(int *)&local_c);
    if ((int)DVar3 < 0) {
      pcVar6 = "Failed to get directory portion of local file path";
      goto LAB_00407ed7;
    }
    DVar3 = FUN_00437850(local_c,(LPSECURITY_ATTRIBUTES)0x0);
    if ((int)DVar3 < 0) {
      pcVar6 = "Failed to ensure directory exists";
      goto LAB_00407ed7;
    }
    DVar3 = FUN_00419196(param_3,*piVar1);
    if ((int)DVar3 < 0) {
      pcVar6 = "Failed to extract file.";
      goto LAB_00407ed7;
    }
    *(undefined4 *)(local_10 + 0x4c) = 1;
  }
  DVar3 = 0;
  if (param_1[1] != 0) {
    iVar4 = *param_1;
    do {
      if (((param_2 == 0) || (*(int *)(iVar4 + 0x3c) == param_2)) && (*(int *)(iVar4 + 0x4c) < 1)) {
        DVar3 = 0x8007000d;
        FUN_004300d9();
        pcVar6 = "Payload was not found in container: %ls";
LAB_00407f1c:
        FUN_00430a57(DVar3,pcVar6);
        break;
      }
      DVar5 = DVar5 + 1;
      iVar4 = iVar4 + 0x58;
    } while (DVar5 < (uint)param_1[1]);
  }
LAB_00407f25:
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar3;
}



/* Function: FUN_00407f4a */

undefined4 FUN_00407f4a(int *param_1,PCNZWCH param_2,undefined4 *param_3)

{
  int *piVar1;
  undefined4 *puVar2;
  int iVar3;
  uint uVar4;
  
  piVar1 = param_1;
  uVar4 = 0;
  if (param_1[1] != 0) {
    param_1 = (int *)0x0;
    do {
      puVar2 = (undefined4 *)(*piVar1 + (int)param_1);
      iVar3 = CompareStringW(0x7f,0,(PCNZWCH)*puVar2,-1,param_2,-1);
      if (iVar3 == 2) {
        *param_3 = puVar2;
        return 0;
      }
      uVar4 = uVar4 + 1;
      param_1 = param_1 + 0x16;
    } while (uVar4 < (uint)piVar1[1]);
  }
  return 0x80070490;
}



/* Function: FUN_00407fa7 */

uint FUN_00407fa7(int *param_1,int *param_2,int *param_3,int *param_4)

{
  int *piVar1;
  uint uVar2;
  int iVar3;
  int *piVar4;
  char *pcVar5;
  int *local_14;
  int *local_10;
  int *local_c;
  PCNZWCH local_8;
  
  piVar1 = param_1;
  local_14 = (int *)0x0;
  local_c = (int *)0x0;
  local_10 = (int *)0x0;
  local_8 = (PCNZWCH)0x0;
  uVar2 = FUN_00435fbe(param_4,L"Payload",(int)&local_14);
  if ((int)uVar2 < 0) {
    pcVar5 = "Failed to select payload nodes.";
  }
  else {
    uVar2 = (**(code **)(*local_14 + 0x20))(local_14,&local_10);
    if (-1 < (int)uVar2) {
      if (local_10 != (int *)0x0) {
        iVar3 = FUN_00431078((int)local_10 * 0x58,1);
        *param_1 = iVar3;
        if (iVar3 == 0) {
          uVar2 = 0x8007000e;
          FUN_004300d9();
          FUN_00430a57(0x8007000e,"Failed to allocate memory for payload structs.");
        }
        else {
          param_4 = (int *)0x0;
          param_1[1] = (int)local_10;
          if (local_10 != (int *)0x0) {
            param_1 = (int *)0x0;
            do {
              piVar4 = (int *)(*piVar1 + (int)param_1);
              uVar2 = FUN_00435f1d(local_14,&local_c,(undefined4 *)0x0);
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to get next node.";
LAB_00408415:
                FUN_00430a57(uVar2,pcVar5);
                goto LAB_0040833c;
              }
              uVar2 = FUN_00435b5e(local_c,&DAT_0043c524,piVar4);
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to get @Id.";
                goto LAB_00408415;
              }
              uVar2 = FUN_00435b5e(local_c,L"FilePath",piVar4 + 6);
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to get @FilePath.";
                goto LAB_00408415;
              }
              uVar2 = FUN_00435b5e(local_c,L"Packaging",(int *)&local_8);
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to get @Packaging.";
                goto LAB_00408415;
              }
              iVar3 = CompareStringW(0x7f,0,local_8,-1,L"download",-1);
              if (iVar3 != 2) {
                iVar3 = CompareStringW(0x7f,0,local_8,-1,L"embedded",-1);
                if (iVar3 == 2) {
                  piVar4[1] = 2;
                  goto LAB_0040812b;
                }
                iVar3 = CompareStringW(0x7f,0,local_8,-1,L"external",-1);
                if (iVar3 == 2) {
                  piVar4[1] = 3;
                  goto LAB_0040812b;
                }
                uVar2 = 0x80070057;
                pcVar5 = "Invalid value for @Packaging: %ls";
LAB_004083ed:
                FUN_00430a57(uVar2,pcVar5);
                goto LAB_0040833c;
              }
              piVar4[1] = 1;
LAB_0040812b:
              if ((param_2 != (int *)0x0) &&
                 ((uVar2 = FUN_00435b5e(local_c,L"Container",(int *)&local_8), uVar2 != 0x80070490
                  || (piVar4[1] == 2)))) {
                if ((int)uVar2 < 0) {
                  pcVar5 = "Failed to get @Container.";
                  goto LAB_00408415;
                }
                uVar2 = FUN_00418ec8(param_2,local_8,piVar4 + 0xf);
                if ((int)uVar2 < 0) {
                  pcVar5 = "Failed to to find container: %ls";
                  goto LAB_004083ed;
                }
              }
              uVar2 = FUN_00435d6c(local_c,L"LayoutOnly",(uint *)(piVar4 + 2));
              if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
                pcVar5 = "Failed to get @LayoutOnly.";
                goto LAB_00408415;
              }
              uVar2 = FUN_00435b5e(local_c,L"SourcePath",piVar4 + 0xe);
              if (((uVar2 != 0x80070490) || (piVar4[1] != 1)) && ((int)uVar2 < 0)) {
                pcVar5 = "Failed to get @SourcePath.";
                goto LAB_00408415;
              }
              uVar2 = FUN_00435b5e(local_c,L"DownloadUrl",piVar4 + 0x10);
              if (((uVar2 != 0x80070490) || (piVar4[1] == 1)) && ((int)uVar2 < 0)) {
                pcVar5 = "Failed to get @DownloadUrl.";
                goto LAB_00408415;
              }
              uVar2 = FUN_00435b5e(local_c,L"FileSize",(int *)&local_8);
              if (uVar2 != 0x80070490) {
                if ((int)uVar2 < 0) {
                  pcVar5 = "Failed to get @FileSize.";
                }
                else {
                  uVar2 = FUN_0043472d(local_8,0,(ulonglong *)(piVar4 + 4));
                  if (-1 < (int)uVar2) goto LAB_00408223;
                  pcVar5 = "Failed to parse @FileSize.";
                }
                goto LAB_00408415;
              }
LAB_00408223:
              uVar2 = FUN_00435b5e(local_c,L"CertificateRootPublicKeyIdentifier",(int *)&local_8);
              if (uVar2 != 0x80070490) {
                if ((int)uVar2 < 0) {
                  pcVar5 = "Failed to get @CertificateRootPublicKeyIdentifier.";
                }
                else {
                  uVar2 = FUN_00433e39(local_8,piVar4 + 8,(uint *)(piVar4 + 9));
                  if (-1 < (int)uVar2) goto LAB_00408260;
                  pcVar5 = "Failed to hex decode @CertificateRootPublicKeyIdentifier.";
                }
                goto LAB_00408415;
              }
LAB_00408260:
              uVar2 = FUN_00435b5e(local_c,L"CertificateRootThumbprint",(int *)&local_8);
              if (uVar2 != 0x80070490) {
                if ((int)uVar2 < 0) {
                  pcVar5 = "Failed to get @CertificateRootThumbprint.";
                }
                else {
                  uVar2 = FUN_00433e39(local_8,piVar4 + 10,(uint *)(piVar4 + 0xb));
                  if (-1 < (int)uVar2) goto LAB_0040829d;
                  pcVar5 = "Failed to hex decode @CertificateRootThumbprint.";
                }
                goto LAB_00408415;
              }
LAB_0040829d:
              uVar2 = FUN_00435b5e(local_c,L"Hash",(int *)&local_8);
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to get @Hash.";
                goto LAB_00408415;
              }
              uVar2 = FUN_00433e39(local_8,piVar4 + 0xc,(uint *)(piVar4 + 0xd));
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to hex decode the Payload/@Hash.";
                goto LAB_00408415;
              }
              uVar2 = FUN_00435b5e(local_c,L"Catalog",(int *)&local_8);
              if (uVar2 != 0x80070490) {
                if ((int)uVar2 < 0) {
                  pcVar5 = "Failed to get @Catalog.";
                }
                else {
                  uVar2 = FUN_00407a56(param_3,local_8,piVar4 + 7);
                  if (-1 < (int)uVar2) goto LAB_0040830e;
                  pcVar5 = "Failed to find catalog.";
                }
                goto LAB_00408415;
              }
LAB_0040830e:
              if (local_c != (int *)0x0) {
                (**(code **)(*local_c + 8))(local_c);
                local_c = (int *)0x0;
              }
              param_4 = (int *)((int)param_4 + 1);
              param_1 = param_1 + 0x16;
            } while (param_4 < local_10);
          }
          uVar2 = 0;
        }
      }
      goto LAB_0040833c;
    }
    pcVar5 = "Failed to get payload node count.";
  }
  FUN_00430a57(uVar2,pcVar5);
LAB_0040833c:
  if (local_14 != (int *)0x0) {
    (**(code **)(*local_14 + 8))(local_14);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar2;
}



/* Function: FUN_00408422 */

void FUN_00408422(int *param_1)

{
  int *piVar1;
  uint uVar2;
  int *piVar3;
  
  piVar1 = param_1;
  if (*param_1 != 0) {
    uVar2 = 0;
    if (param_1[1] != 0) {
      param_1 = (int *)0x0;
      do {
        piVar3 = (int *)(*piVar1 + (int)param_1);
        if (*piVar3 != 0) {
          FUN_004380ab((LPVOID)*piVar3);
        }
        if (piVar3[6] != 0) {
          FUN_004380ab((LPVOID)piVar3[6]);
        }
        if (piVar3[0xc] != 0) {
          FUN_00431137((LPVOID)piVar3[0xc]);
        }
        if (piVar3[10] != 0) {
          FUN_00431137((LPVOID)piVar3[10]);
        }
        if (piVar3[8] != 0) {
          FUN_00431137((LPVOID)piVar3[8]);
        }
        if (piVar3[0xe] != 0) {
          FUN_004380ab((LPVOID)piVar3[0xe]);
        }
        if (piVar3[0x14] != 0) {
          FUN_004380ab((LPVOID)piVar3[0x14]);
        }
        if (piVar3[0x10] != 0) {
          FUN_004380ab((LPVOID)piVar3[0x10]);
        }
        if (piVar3[0x11] != 0) {
          FUN_004380ab((LPVOID)piVar3[0x11]);
        }
        if (piVar3[0x12] != 0) {
          FUN_004380ab((LPVOID)piVar3[0x12]);
        }
        uVar2 = uVar2 + 1;
        param_1 = param_1 + 0x16;
      } while (uVar2 < (uint)piVar1[1]);
    }
    FUN_00431137((LPVOID)*piVar1);
  }
  *piVar1 = 0;
  piVar1[1] = 0;
  return;
}



/* Function: FUN_004084fa */

int FUN_004084fa(uint param_1,int param_2)

{
  bool bVar1;
  
  if (param_2 == 0) {
    return 0;
  }
  if (param_2 == -1) {
    return -1;
  }
  if (param_1 < 5) {
    if (param_1 == 4) {
      if ((param_2 == 1) || (param_2 == 6)) {
        return 6;
      }
      if (((param_2 != 2) && (param_2 != 3)) && (param_2 != 7)) {
        return 0;
      }
      return 7;
    }
    if (param_1 == 0) {
      return 1;
    }
    if (param_1 == 1) {
      if (param_2 == 1) {
        return 1;
      }
      if (param_2 == 6) {
        return 1;
      }
      if (param_2 == 2) {
        return 2;
      }
      if (param_2 == 3) {
        return 2;
      }
      bVar1 = param_2 == 7;
    }
    else {
      if (param_1 == 2) {
        if (param_2 == 2) {
          return 3;
        }
        if (param_2 == 3) {
          return 3;
        }
        if (param_2 == 4) {
          return 4;
        }
        if (param_2 != 10) {
          if (param_2 == 5) {
            return 5;
          }
          return 0;
        }
        return 4;
      }
      if (param_1 != 3) {
        return param_2;
      }
      if (param_2 == 1) {
        return 6;
      }
      if (param_2 == 6) {
        return 6;
      }
      if (param_2 == 7) {
        return 7;
      }
      if (param_2 == 2) {
        return 2;
      }
      bVar1 = param_2 == 3;
    }
    if (bVar1) {
      return 2;
    }
  }
  else if (param_1 == 5) {
    if (param_2 == 4) {
      return 4;
    }
    if (param_2 == 10) {
      return 4;
    }
    if ((param_2 == 2) || (param_2 == 3)) {
      return 3;
    }
  }
  else if (param_1 == 6) {
    if (param_2 == 2) {
      return 3;
    }
    if (param_2 == 3) {
      return 3;
    }
    if (param_2 == 4) {
      return 4;
    }
    if (param_2 == 10) {
      return 4;
    }
    if ((param_2 == 0xb) || (param_2 == 5)) {
      return 0xb;
    }
  }
  else if (param_1 == 0xe) {
    if (param_2 == 1) {
      return 1;
    }
    if (param_2 == 6) {
      return 1;
    }
    if (param_2 == 0xb) {
      return 5;
    }
    if (param_2 == 5) {
      return 5;
    }
    if (param_2 == 2) {
      return 2;
    }
    if (param_2 == 3) {
      return 2;
    }
    if (param_2 == 4) {
      return 4;
    }
    if (param_2 == 10) {
      return 4;
    }
    if (param_2 == 7) {
      return 4;
    }
  }
  else {
    if (param_1 != 0xf) {
      return param_2;
    }
    if (param_2 == 4) {
      return 4;
    }
    if (param_2 == 10) {
      return 10;
    }
  }
  return 0;
}



/* Function: FUN_00408682 */

int FUN_00408682(int param_1,uint *param_2)

{
  LONG LVar1;
  int iVar2;
  
  iVar2 = 0;
  EnterCriticalSection((LPCRITICAL_SECTION)(param_1 + 0x18));
  LVar1 = InterlockedCompareExchange((LONG *)(param_1 + 0x30),1,0);
  if (LVar1 != 0) {
    iVar2 = -0x7ff8ec61;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)(param_1 + 0x18));
  if (param_2 != (uint *)0x0) {
    *param_2 = (uint)(LVar1 == 0);
  }
  if (iVar2 < 0) {
    FUN_004300d9();
    FUN_00430a57(iVar2,"Engine active cannot be changed because it was already in that state.");
  }
  return iVar2;
}



/* Function: FUN_004086ee */

void FUN_004086ee(int param_1,int param_2,uint param_3,int param_4)

{
  if ((param_2 == 0) || ((param_4 != 2 && (param_4 != 3)))) {
    if ((*(int *)(param_1 + 0x34) < 0) && (param_2 == 0)) {
      param_4 = 2;
    }
  }
  else {
    param_4 = 0;
  }
  FUN_004084fa(param_3,param_4);
  return;
}



/* Function: FUN_00408728 */

void FUN_00408728(int param_1)

{
  InterlockedExchange((LONG *)(param_1 + 0x30),0);
  return;
}



/* Function: FUN_0040873e */

undefined4 FUN_0040873e(int param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (*(int *)(param_1 + 0x30) != 0) {
    uVar1 = 0x800700aa;
    FUN_004300d9();
    FUN_00430a57(0x800700aa,"Engine is active, cannot proceed.");
  }
  return uVar1;
}



/* Function: FUN_00408775 */

DWORD FUN_00408775(undefined4 param_1,int *param_2)

{
  DWORD DVar1;
  char *pcVar2;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  DVar1 = FUN_00413970(param_1,(int *)&local_8);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to create working folder.";
  }
  else {
    DVar1 = FUN_00431510(local_8,L".ba%d",999999,param_2);
    if (-1 < (int)DVar1) goto LAB_004087bf;
    pcVar2 = "Failed to get unique temporary folder for bootstrapper application.";
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_004087bf:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_004087d4 */

void FUN_004087d4(int param_1,int param_2)

{
  if (param_2 < 0) {
    *(int *)(param_1 + 0x34) = param_2;
  }
  return;
}



/* Function: FUN_004087e8 */

void FUN_004087e8(int param_1)

{
  *(undefined4 *)(param_1 + 0x34) = 0;
  *(undefined4 *)(param_1 + 0x38) = 0;
  return;
}



/* Function: FUN_004087fa */

int FUN_004087fa(int param_1,int param_2,uint param_3,int param_4)

{
  int iVar1;
  
  iVar1 = *(int *)(param_1 + 0x34);
  if ((-1 < iVar1) || (param_2 != 0)) {
    iVar1 = FUN_004086ee(param_1,param_2,param_3,param_4);
    if ((iVar1 == 1) || (iVar1 == 0)) {
      iVar1 = 0;
    }
    else if ((iVar1 == 2) || (iVar1 == 3)) {
      iVar1 = -0x7ff8f9be;
    }
    else {
      iVar1 = -0x7ff8f9bd;
    }
  }
  return iVar1;
}



/* Function: FUN_00408843 */

undefined4 FUN_00408843(undefined4 param_1,uint param_2,int param_3)

{
  int iVar1;
  undefined4 uVar2;
  
  iVar1 = FUN_004084fa(param_2,param_3);
  if ((iVar1 == 1) || (iVar1 == 0)) {
    uVar2 = 0;
  }
  else if ((iVar1 == 2) || (iVar1 == 3)) {
    uVar2 = 0x80070642;
  }
  else {
    uVar2 = 0x80070643;
  }
  return uVar2;
}



/* Function: FUN_00408878 */

DWORD FUN_00408878(int param_1,undefined4 param_2,undefined4 param_3)

{
  HMODULE hModule;
  DWORD DVar1;
  FARPROC pFVar2;
  uint uVar3;
  char *pcVar4;
  
  hModule = LoadLibraryW(*(LPCWSTR *)(*(int *)(param_1 + 4) + 0x50));
  *(HMODULE *)(param_1 + 0xc) = hModule;
  if (hModule == (HMODULE)0x0) {
    DVar1 = GetLastError();
    uVar3 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar3 = DVar1;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    pcVar4 = "Failed to load UX DLL.";
  }
  else {
    pFVar2 = GetProcAddress(hModule,"BootstrapperApplicationCreate");
    if (pFVar2 == (FARPROC)0x0) {
      DVar1 = GetLastError();
      uVar3 = DVar1 & 0xffff | 0x80070000;
      if ((int)DVar1 < 1) {
        uVar3 = DVar1;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
      FUN_004300d9();
      pcVar4 = "Failed to get BootstrapperApplicationCreate entry-point";
    }
    else {
      uVar3 = (*pFVar2)(param_2,param_3,param_1 + 0x10);
      if (-1 < (int)uVar3) {
        return uVar3;
      }
      pcVar4 = "Failed to create UX.";
    }
  }
  FUN_00430a57(uVar3,pcVar4);
  return uVar3;
}



/* Function: FUN_0040892e */

uint FUN_0040892e(uint *param_1,int *param_2)

{
  uint uVar1;
  char *pcVar2;
  int *local_8;
  
  local_8 = (int *)0x0;
  uVar1 = FUN_00436045(param_2,(undefined2 *)&DAT_0043f03c,(int)&local_8);
  if (uVar1 == 1) {
    uVar1 = 0x80070490;
  }
  if ((int)uVar1 < 0) {
    FUN_00430a57(uVar1,"Failed to select user experience node.");
  }
  else {
    uVar1 = FUN_00435d6c(local_8,L"SplashScreen",param_1);
    if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
      uVar1 = FUN_00407fa7((int *)(param_1 + 1),(int *)0x0,(int *)0x0,local_8);
      if ((int)uVar1 < 0) {
        pcVar2 = "Failed to parse user experience payloads.";
      }
      else {
        if (param_1[2] != 0) goto LAB_004089c4;
        uVar1 = 0x8000ffff;
        pcVar2 = "Too few UX payloads.";
      }
    }
    else {
      pcVar2 = "Failed to to get UX/@SplashScreen";
    }
    FUN_00430a57(uVar1,pcVar2);
  }
LAB_004089c4:
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return uVar1;
}



/* Function: FUN_004089d9 */

undefined4 FUN_004089d9(int param_1)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (*(int *)(param_1 + 0x14) != 0) {
    uVar1 = FUN_0043740c(*(LPCWSTR *)(param_1 + 0x14),7);
  }
  return uVar1;
}



/* Function: FUN_004089f8 */

undefined4
FUN_004089f8(int *param_1,undefined4 param_2,undefined4 param_3,LPVOID param_4,LPVOID param_5,
            undefined4 param_6,undefined4 param_7)

{
  LPVOID pvVar1;
  DWORD DVar2;
  undefined4 uVar3;
  LPVOID pvVar4;
  uint uVar5;
  
  pvVar4 = param_5;
  pvVar1 = param_4;
  uVar5 = (uint)param_4 & 0xffff;
  param_4 = (LPVOID)0x0;
  if (param_5 == (LPVOID)0x0) {
    DVar2 = FUN_00433da8((int *)&param_4,(DWORD)pvVar1,(LPCVOID)0x0);
    if (-1 < (int)DVar2) {
      pvVar4 = param_4;
    }
  }
  uVar3 = (**(code **)(*param_1 + 0x6c))(param_1,param_2,param_3,uVar5,pvVar4,param_6,0,0,param_7);
  if (param_4 != (LPVOID)0x0) {
    FUN_004380ab(param_4);
  }
  return uVar3;
}



/* Function: FUN_00408a55 */

void FUN_00408a55(uint *param_1)

{
  if (param_1[5] != 0) {
    FUN_004380ab((LPVOID)param_1[5]);
  }
  FUN_00408422((int *)(param_1 + 1));
  FUN_004267c0(param_1,0,0x40);
  return;
}



/* Function: FUN_00408a85 */

DWORD FUN_00408a85(int param_1)

{
  int *piVar1;
  FARPROC pFVar2;
  BOOL BVar3;
  DWORD DVar4;
  DWORD DVar5;
  
  piVar1 = *(int **)(param_1 + 0x10);
  DVar5 = 0;
  if (piVar1 != (int *)0x0) {
    (**(code **)(*piVar1 + 8))(piVar1);
    *(undefined4 *)(param_1 + 0x10) = 0;
  }
  if (*(int *)(param_1 + 0xc) != 0) {
    pFVar2 = GetProcAddress(*(HMODULE *)(param_1 + 0xc),"BootstrapperApplicationDestroy");
    if (pFVar2 != (FARPROC)0x0) {
      (*pFVar2)();
    }
    BVar3 = FreeLibrary(*(HMODULE *)(param_1 + 0xc));
    if (BVar3 == 0) {
      DVar4 = GetLastError();
      DVar5 = DVar4 & 0xffff | 0x80070000;
      if ((int)DVar4 < 1) {
        DVar5 = DVar4;
      }
    }
    *(undefined4 *)(param_1 + 0xc) = 0;
  }
  return DVar5;
}



/* Function: FUN_00408ae5 */

undefined4 FUN_00408ae5(int *param_1,PCNZWCH param_2,int *param_3)

{
  undefined4 *puVar1;
  int iVar2;
  uint uVar3;
  
  uVar3 = 0;
  if (param_1[1] != 0) {
    do {
      puVar1 = (undefined4 *)(*param_1 + uVar3 * 8);
      iVar2 = CompareStringW(0x7f,0,(PCNZWCH)*puVar1,-1,param_2,-1);
      if (iVar2 == 2) {
        *param_3 = (int)puVar1;
        return 0;
      }
      uVar3 = uVar3 + 1;
    } while (uVar3 < (uint)param_1[1]);
  }
  return 0x80070490;
}



/* Function: FUN_00408b34 */

uint FUN_00408b34(int param_1,int *param_2)

{
  int *piVar1;
  uint uVar2;
  int iVar3;
  uint uVar4;
  char *pcVar5;
  int *local_10;
  uint local_c;
  int *local_8;
  
  uVar4 = 0;
  local_10 = (int *)0x0;
  local_8 = (int *)0x0;
  local_c = 0;
  uVar2 = FUN_00435fbe(param_2,L"PatchTargetCode",(int)&local_10);
  if ((int)uVar2 < 0) {
    pcVar5 = "Failed to select PatchTargetCode nodes.";
  }
  else {
    uVar2 = (**(code **)(*local_10 + 0x20))(local_10,&local_c);
    if (-1 < (int)uVar2) {
      if (local_c == 0) {
        uVar2 = 0;
      }
      else {
        iVar3 = FUN_00431078(local_c << 3,1);
        *(int *)(param_1 + 0x10) = iVar3;
        if (iVar3 == 0) {
          uVar2 = 0x8007000e;
          FUN_004300d9();
          pcVar5 = "Failed to allocate memory for patch targetcodes.";
LAB_00408c77:
          FUN_00430a57(uVar2,pcVar5);
        }
        else {
          *(uint *)(param_1 + 0x14) = local_c;
          if (local_c != 0) {
            do {
              piVar1 = (int *)(*(int *)(param_1 + 0x10) + uVar4 * 8);
              uVar2 = FUN_00435f1d(local_10,&local_8,(undefined4 *)0x0);
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to get next node.";
                goto LAB_00408c77;
              }
              uVar2 = FUN_00435b5e(local_8,L"TargetCode",piVar1);
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to get @TargetCode attribute.";
                goto LAB_00408c77;
              }
              uVar2 = FUN_00435d6c(local_8,L"Product",(uint *)&param_2);
              if (uVar2 == 0x80070490) {
                param_2 = (int *)0x0;
                uVar2 = 0;
              }
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to get @Product.";
                goto LAB_00408c77;
              }
              piVar1[1] = (param_2 == (int *)0x0) + 1;
              if (local_8 != (int *)0x0) {
                (**(code **)(*local_8 + 8))(local_8);
                local_8 = (int *)0x0;
              }
              uVar4 = uVar4 + 1;
            } while (uVar4 < local_c);
          }
        }
      }
      goto LAB_00408c80;
    }
    pcVar5 = "Failed to get PatchTargetCode node count.";
  }
  FUN_00430a57(uVar2,pcVar5);
LAB_00408c80:
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  return uVar2;
}



/* Function: FUN_00408ca2 */

uint FUN_00408ca2(int param_1,int *param_2,int *param_3)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  char *pcVar4;
  PCNZWCH local_14;
  int *local_10;
  uint local_c;
  int *local_8;
  
  uVar3 = 0;
  local_10 = (int *)0x0;
  local_8 = (int *)0x0;
  local_c = 0;
  local_14 = (PCNZWCH)0x0;
  uVar1 = FUN_00435fbe(param_3,L"PayloadRef",(int)&local_10);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to select package nodes.";
  }
  else {
    uVar1 = (**(code **)(*local_10 + 0x20))(local_10,&local_c);
    if (-1 < (int)uVar1) {
      if (local_c == 0) {
        uVar1 = 0;
      }
      else {
        iVar2 = FUN_00431078(local_c << 3,1);
        *(int *)(param_1 + 0x7c) = iVar2;
        if (iVar2 == 0) {
          uVar1 = 0x8007000e;
          FUN_004300d9();
          pcVar4 = "Failed to allocate memory for package payloads.";
LAB_00408df4:
          FUN_00430a57(uVar1,pcVar4);
        }
        else {
          *(uint *)(param_1 + 0x80) = local_c;
          if (local_c != 0) {
            do {
              iVar2 = *(int *)(param_1 + 0x7c);
              uVar1 = FUN_00435f1d(local_10,&local_8,(undefined4 *)0x0);
              if ((int)uVar1 < 0) {
                pcVar4 = "Failed to get next node.";
                goto LAB_00408df4;
              }
              uVar1 = FUN_00435b5e(local_8,&DAT_0043c524,(int *)&local_14);
              if ((int)uVar1 < 0) {
                pcVar4 = "Failed to get Id attribute.";
                goto LAB_00408df4;
              }
              uVar1 = FUN_00407f4a(param_2,local_14,(undefined4 *)(iVar2 + uVar3 * 8));
              if ((int)uVar1 < 0) {
                pcVar4 = "Failed to find payload.";
                goto LAB_00408df4;
              }
              if (local_8 != (int *)0x0) {
                (**(code **)(*local_8 + 8))(local_8);
                local_8 = (int *)0x0;
              }
              uVar3 = uVar3 + 1;
            } while (uVar3 < local_c);
          }
          uVar1 = 0;
        }
      }
      goto LAB_00408db1;
    }
    pcVar4 = "Failed to get package node count.";
  }
  FUN_00430a57(uVar1,pcVar4);
LAB_00408db1:
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_14 != (PCNZWCH)0x0) {
    FUN_004380ab(local_14);
  }
  return uVar1;
}



/* Function: FUN_00408dfe */

undefined4 FUN_00408dfe(int param_1,PCNZWCH param_2,undefined4 *param_3)

{
  int iVar1;
  undefined4 *puVar2;
  int iVar3;
  uint uVar4;
  
  iVar1 = param_1;
  uVar4 = 0;
  if (*(int *)(param_1 + 0xc) != 0) {
    param_1 = 0;
    do {
      puVar2 = (undefined4 *)(*(int *)(iVar1 + 8) + param_1);
      iVar3 = CompareStringW(0x7f,0,(PCNZWCH)*puVar2,-1,param_2,-1);
      if (iVar3 == 2) {
        *param_3 = puVar2;
        return 0;
      }
      uVar4 = uVar4 + 1;
      param_1 = param_1 + 0xd0;
    } while (uVar4 < *(uint *)(iVar1 + 0xc));
  }
  return 0x80070490;
}



/* Function: FUN_00408e5f */

undefined4 FUN_00408e5f(int *param_1,PCNZWCH param_2,undefined4 *param_3)

{
  int *piVar1;
  undefined4 *puVar2;
  int iVar3;
  uint uVar4;
  
  piVar1 = param_1;
  uVar4 = 0;
  if (param_1[1] != 0) {
    param_1 = (int *)0x0;
    do {
      puVar2 = (undefined4 *)(*piVar1 + 0x18 + (int)param_1);
      iVar3 = CompareStringW(0x7f,0,(PCNZWCH)*puVar2,-1,param_2,-1);
      if (iVar3 == 2) {
        *param_3 = puVar2;
        return 0;
      }
      uVar4 = uVar4 + 1;
      param_1 = param_1 + 0x3a;
    } while (uVar4 < (uint)piVar1[1]);
  }
  return 0x80070490;
}



/* Function: FUN_00408ec2 */

int FUN_00408ec2(uint param_1,PCNZWCH param_2,int *param_3)

{
  int iVar1;
  uint uVar2;
  undefined4 *puVar3;
  
  puVar3 = (undefined4 *)0x0;
  uVar2 = 0;
  if (*(int *)(param_1 + 0x8c) == 2) {
    puVar3 = *(undefined4 **)(param_1 + 0xac);
    uVar2 = *(uint *)(param_1 + 0xb0);
  }
  else if (*(int *)(param_1 + 0x8c) == 3) {
    puVar3 = *(undefined4 **)(param_1 + 0x9c);
    uVar2 = *(uint *)(param_1 + 0xa0);
  }
  param_1 = 0;
  if (uVar2 != 0) {
    do {
      iVar1 = CompareStringW(0,0,(PCNZWCH)*puVar3,-1,param_2,-1);
      if (iVar1 == 2) {
        if ((param_3 != (int *)0x0) &&
           (iVar1 = FUN_00433f88(param_3,(LPCWSTR)puVar3[1],0), iVar1 < 0)) {
          FUN_00430a57(iVar1,"Failed to copy the property value.");
          return iVar1;
        }
        return 0;
      }
      param_1 = param_1 + 1;
      puVar3 = puVar3 + 3;
    } while (param_1 < uVar2);
  }
  return -0x7ff8fb70;
}



/* Function: FUN_00408f61 */

void FUN_00408f61(int *param_1)

{
  int iVar1;
  uint uVar2;
  
  if (*param_1 != 0) {
    FUN_004380ab((LPVOID)*param_1);
  }
  if (param_1[1] != 0) {
    FUN_004380ab((LPVOID)param_1[1]);
  }
  if (param_1[2] != 0) {
    FUN_004380ab((LPVOID)param_1[2]);
  }
  if (param_1[3] != 0) {
    FUN_004380ab((LPVOID)param_1[3]);
  }
  if (param_1[4] != 0) {
    FUN_004380ab((LPVOID)param_1[4]);
  }
  if (param_1[9] != 0) {
    FUN_004380ab((LPVOID)param_1[9]);
  }
  uVar2 = 0;
  if (param_1[0x21] != 0) {
    if (param_1[0x22] != 0) {
      iVar1 = 0;
      do {
        FUN_0041f1f9((int *)(param_1[0x21] + iVar1));
        uVar2 = uVar2 + 1;
        iVar1 = iVar1 + 0x10;
      } while (uVar2 < (uint)param_1[0x22]);
    }
    FUN_00431137((LPVOID)param_1[0x21]);
  }
  if (param_1[0x1f] != 0) {
    FUN_00431137((LPVOID)param_1[0x1f]);
  }
  iVar1 = param_1[0x23];
  if (iVar1 == 1) {
    FUN_00419b9d((int)param_1);
  }
  else if (iVar1 == 2) {
    FUN_0041b99b((int)param_1);
  }
  else if (iVar1 == 3) {
    FUN_0041d523((int)param_1);
  }
  else if (iVar1 == 4) {
    FUN_0041df1f((int)param_1);
  }
  return;
}



/* Function: FUN_0040903a */

uint FUN_0040903a(int *param_1,int *param_2,int *param_3)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  undefined4 *puVar4;
  uint uVar5;
  int *piVar6;
  char *pcVar7;
  uint local_24;
  uint local_20;
  int local_1c;
  PCNZWCH local_18;
  uint local_14;
  int *local_10;
  PCNZWCH local_c;
  int *local_8;
  
  local_10 = (int *)0x0;
  local_8 = (int *)0x0;
  local_14 = 0;
  local_c = (PCNZWCH)0x0;
  local_1c = 0;
  local_18 = (PCNZWCH)0x0;
  uVar1 = FUN_00435fbe(param_3,L"RollbackBoundary",(int)&local_10);
  if ((int)uVar1 < 0) {
    pcVar7 = "Failed to select rollback boundary nodes.";
  }
  else {
    uVar1 = (**(code **)(*local_10 + 0x20))(local_10,&local_14);
    if (-1 < (int)uVar1) {
      if (local_14 != 0) {
        iVar2 = FUN_00431078(local_14 << 3,1);
        *param_1 = iVar2;
        if (iVar2 != 0) {
          uVar5 = 0;
          param_1[1] = local_14;
          if (local_14 != 0) {
            do {
              piVar6 = (int *)(*param_1 + uVar5 * 8);
              uVar1 = FUN_00435f1d(local_10,&local_8,&local_c);
              if ((int)uVar1 < 0) goto LAB_0040979c;
              uVar1 = FUN_00435b5e(local_8,&DAT_0043c524,piVar6);
              if ((int)uVar1 < 0) goto LAB_00409795;
              uVar1 = FUN_00435d6c(local_8,L"Vital",(uint *)(piVar6 + 1));
              if ((int)uVar1 < 0) goto LAB_00409764;
              if (local_8 != (int *)0x0) {
                (**(code **)(*local_8 + 8))(local_8);
                local_8 = (int *)0x0;
              }
              if (local_c != (PCNZWCH)0x0) {
                Ordinal_6(local_c);
                local_c = (PCNZWCH)0x0;
              }
              uVar5 = uVar5 + 1;
            } while (uVar5 < local_14);
          }
          goto LAB_00409173;
        }
        FUN_004300d9();
        pcVar7 = "Failed to allocate memory for rollback boundary structs.";
        goto LAB_00409621;
      }
LAB_00409173:
      if (local_10 != (int *)0x0) {
        (**(code **)(*local_10 + 8))(local_10);
        local_10 = (int *)0x0;
      }
      uVar1 = FUN_00435fbe(param_3,
                           L"Chain/ExePackage|Chain/MsiPackage|Chain/MspPackage|Chain/MsuPackage",
                           (int)&local_10);
      if ((int)uVar1 < 0) {
        pcVar7 = "Failed to select package nodes.";
      }
      else {
        uVar1 = (**(code **)(*local_10 + 0x20))(local_10,&local_14);
        if (-1 < (int)uVar1) {
          if (local_14 != 0) {
            iVar2 = FUN_00431078(local_14 * 0xd0,1);
            param_1[2] = iVar2;
            if (iVar2 == 0) {
              FUN_004300d9();
              pcVar7 = "Failed to allocate memory for package structs.";
              goto LAB_00409621;
            }
            local_20 = 0;
            param_1[3] = local_14;
            if (local_14 != 0) {
              local_24 = 0;
              do {
                piVar6 = (int *)(param_1[2] + local_24);
                uVar1 = FUN_00435f1d(local_10,&local_8,&local_c);
                if ((int)uVar1 < 0) goto LAB_0040979c;
                uVar1 = FUN_00435b5e(local_8,&DAT_0043c524,piVar6);
                if ((int)uVar1 < 0) goto LAB_00409795;
                uVar1 = FUN_00435d6c(local_8,L"Cache",(uint *)(piVar6 + 8));
                if ((int)uVar1 < 0) {
                  pcVar7 = "Failed to get @Cache.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_00435b5e(local_8,L"CacheId",piVar6 + 9);
                if ((int)uVar1 < 0) {
                  pcVar7 = "Failed to get @CacheId.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_00435c30(local_8,L"Size",piVar6 + 0xc);
                if ((int)uVar1 < 0) {
                  pcVar7 = "Failed to get @Size.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_00435c30(local_8,L"InstallSize",piVar6 + 10);
                if ((int)uVar1 < 0) {
                  pcVar7 = "Failed to get @InstallSize.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_00435d6c(local_8,L"PerMachine",(uint *)(piVar6 + 5));
                if ((int)uVar1 < 0) {
                  pcVar7 = "Failed to get @PerMachine.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_00435d6c(local_8,L"Permanent",(uint *)(piVar6 + 6));
                if ((int)uVar1 < 0) {
                  pcVar7 = "Failed to get @Permanent.";
                  goto LAB_0040974d;
                }
                piVar6[6] = (uint)(piVar6[6] == 0);
                uVar1 = FUN_00435d6c(local_8,L"Vital",(uint *)(piVar6 + 7));
                if ((int)uVar1 < 0) goto LAB_00409764;
                uVar1 = FUN_00435b5e(local_8,L"LogPathVariable",piVar6 + 1);
                if ((uVar1 != 0x80070490) && ((int)uVar1 < 0)) {
                  pcVar7 = "Failed to get @LogPathVariable.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_00435b5e(local_8,L"RollbackLogPathVariable",piVar6 + 2);
                if ((uVar1 != 0x80070490) && ((int)uVar1 < 0)) {
                  pcVar7 = "Failed to get @RollbackLogPathVariable.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_00435b5e(local_8,L"InstallCondition",piVar6 + 3);
                if ((uVar1 != 0x80070490) && ((int)uVar1 < 0)) {
                  pcVar7 = "Failed to get @InstallCondition.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_00435b5e(local_8,L"RollbackBoundaryForward",(int *)&local_18);
                if (uVar1 != 0x80070490) {
                  if ((int)uVar1 < 0) {
                    pcVar7 = "Failed to get @RollbackBoundaryForward.";
                    goto LAB_0040974d;
                  }
                  uVar1 = FUN_00408ae5(param_1,local_18,piVar6 + 0xe);
                  if (-1 < (int)uVar1) goto LAB_004093b9;
                  pcVar7 = "Failed to find forward transaction boundary: %ls";
LAB_004095c3:
                  FUN_00430a57(uVar1,pcVar7);
                  goto LAB_004097a7;
                }
LAB_004093b9:
                uVar1 = FUN_00435b5e(local_8,L"RollbackBoundaryBackward",(int *)&local_18);
                if (uVar1 != 0x80070490) {
                  if ((int)uVar1 < 0) {
                    pcVar7 = "Failed to get @RollbackBoundaryBackward.";
                    goto LAB_0040974d;
                  }
                  uVar1 = FUN_00408ae5(param_1,local_18,piVar6 + 0xf);
                  if ((int)uVar1 < 0) {
                    pcVar7 = "Failed to find backward transaction boundary: %ls";
                    goto LAB_004095c3;
                  }
                }
                iVar2 = CompareStringW(0x7f,0,local_c,-1,L"ExePackage",-1);
                if (iVar2 == 2) {
                  piVar6[0x23] = 1;
                  uVar1 = FUN_00419c14(local_8,(uint)piVar6);
                  if ((int)uVar1 < 0) {
                    pcVar7 = "Failed to parse EXE package.";
                    goto LAB_0040974d;
                  }
                }
                else {
                  iVar2 = CompareStringW(0x7f,0,local_c,-1,L"MsiPackage",-1);
                  if (iVar2 == 2) {
                    piVar6[0x23] = 2;
                    uVar1 = FUN_0041bb77(local_8,(int)piVar6);
                    if ((int)uVar1 < 0) {
                      pcVar7 = "Failed to parse MSI package.";
                      goto LAB_0040974d;
                    }
                  }
                  else {
                    iVar2 = CompareStringW(0x7f,0,local_c,-1,L"MspPackage",-1);
                    if (iVar2 == 2) {
                      piVar6[0x23] = 3;
                      uVar1 = FUN_0041d5d8(local_8,(int)piVar6);
                      if ((int)uVar1 < 0) {
                        pcVar7 = "Failed to parse MSP package.";
                        goto LAB_0040974d;
                      }
                      local_1c = local_1c + 1;
                    }
                    else {
                      iVar2 = CompareStringW(0x7f,0,local_c,-1,L"MsuPackage",-1);
                      if (iVar2 == 2) {
                        piVar6[0x23] = 4;
                        uVar1 = FUN_0041df59(local_8,(int)piVar6);
                        if ((int)uVar1 < 0) {
                          pcVar7 = "Failed to parse MSU package.";
                          goto LAB_0040974d;
                        }
                      }
                    }
                  }
                }
                uVar1 = FUN_00408ca2((int)piVar6,param_2,local_8);
                if ((int)uVar1 < 0) {
                  pcVar7 = "Failed to parse payload references.";
                  goto LAB_0040974d;
                }
                uVar1 = FUN_0041eb12((int)piVar6,local_8);
                if ((int)uVar1 < 0) {
                  pcVar7 = "Failed to parse dependency providers.";
                  goto LAB_0040974d;
                }
                if (local_8 != (int *)0x0) {
                  (**(code **)(*local_8 + 8))(local_8);
                  local_8 = (int *)0x0;
                }
                if (local_c != (PCNZWCH)0x0) {
                  Ordinal_6(local_c);
                  local_c = (PCNZWCH)0x0;
                }
                local_20 = local_20 + 1;
                local_24 = local_24 + 0xd0;
              } while (local_20 < local_14);
              if (local_1c != 0) {
                iVar2 = FUN_00431078(local_1c << 4,1);
                param_1[6] = iVar2;
                if (iVar2 == 0) {
                  FUN_004300d9();
                  pcVar7 = "Failed to allocate memory for MSP patch sequence information.";
                }
                else {
                  iVar2 = FUN_00431078(local_1c << 2,1);
                  param_1[7] = iVar2;
                  if (param_1[6] != 0) {
                    param_2 = (int *)0x0;
                    if (param_1[3] != 0) {
                      local_1c = 0;
                      do {
                        puVar4 = (undefined4 *)(param_1[2] + local_1c);
                        if (puVar4[0x23] == 3) {
                          *(undefined4 *)(param_1[6] + param_1[8] * 0x10) = puVar4[0x25];
                          *(undefined4 *)(param_1[6] + 4 + param_1[8] * 0x10) = 2;
                          *(undefined4 **)(param_1[7] + param_1[8] * 4) = puVar4;
                          param_1[8] = param_1[8] + 1;
                          local_24 = 0;
                          if (param_1[3] != 0) {
                            local_20 = 0;
                            do {
                              iVar2 = param_1[2] + local_20;
                              if ((*(int *)(iVar2 + 0x8c) == 2) &&
                                 (uVar1 = 0, *(int *)(iVar2 + 0xcc) != 0)) {
                                do {
                                  if ((*(int *)(*(int *)(iVar2 + 200) + uVar1 * 4) != 0) &&
                                     (iVar3 = CompareStringW(0x7f,0,(PCNZWCH)*puVar4,-1,
                                                             *(PCNZWCH *)
                                                              (*(int *)(iVar2 + 200) + uVar1 * 4),-1
                                                            ), iVar3 == 2)) {
                                    *(undefined4 **)(*(int *)(iVar2 + 0xc4) + uVar1 * 4) = puVar4;
                                    if (*(int *)(*(int *)(iVar2 + 200) + uVar1 * 4) != 0) {
                                      FUN_004380ab(*(LPVOID *)(*(int *)(iVar2 + 200) + uVar1 * 4));
                                      *(undefined4 *)(*(int *)(iVar2 + 200) + uVar1 * 4) = 0;
                                    }
                                  }
                                  uVar1 = uVar1 + 1;
                                } while (uVar1 < *(uint *)(iVar2 + 0xcc));
                              }
                              local_24 = local_24 + 1;
                              local_20 = local_20 + 0xd0;
                            } while (local_24 < (uint)param_1[3]);
                          }
                        }
                        param_2 = (int *)((int)param_2 + 1);
                        local_1c = local_1c + 0xd0;
                      } while (param_2 < (int *)param_1[3]);
                    }
                    goto LAB_00409738;
                  }
                  FUN_004300d9();
                  pcVar7 = 
                  "Failed to allocate memory for patch sequence information to package lookup.";
                }
LAB_00409621:
                uVar1 = 0x8007000e;
                goto LAB_0040974d;
              }
            }
LAB_00409738:
            uVar1 = FUN_00408b34((int)param_1,param_3);
            if ((int)uVar1 < 0) {
              pcVar7 = "Failed to parse target product codes.";
              goto LAB_0040974d;
            }
          }
          uVar1 = 0;
          goto LAB_004097a7;
        }
        pcVar7 = "Failed to get package node count.";
      }
      goto LAB_0040974d;
    }
    pcVar7 = "Failed to get rollback bundary node count.";
  }
  FUN_00430a57(uVar1,pcVar7);
  goto LAB_004097a7;
LAB_0040979c:
  pcVar7 = "Failed to get next node.";
  goto LAB_0040974d;
LAB_00409795:
  pcVar7 = "Failed to get @Id.";
  goto LAB_0040974d;
LAB_00409764:
  pcVar7 = "Failed to get @Vital.";
LAB_0040974d:
  FUN_00430a57(uVar1,pcVar7);
LAB_004097a7:
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_c != (PCNZWCH)0x0) {
    Ordinal_6(local_c);
  }
  if (local_18 != (PCNZWCH)0x0) {
    FUN_004380ab(local_18);
  }
  return uVar1;
}



/* Function: FUN_004097e5 */

void FUN_004097e5(int *param_1)

{
  uint uVar1;
  int iVar2;
  
  iVar2 = 0;
  if (*param_1 != 0) {
    uVar1 = 0;
    if (param_1[1] != 0) {
      do {
        if (*(int *)(*param_1 + uVar1 * 8) != 0) {
          FUN_004380ab(*(LPVOID *)(*param_1 + uVar1 * 8));
        }
        uVar1 = uVar1 + 1;
      } while (uVar1 < (uint)param_1[1]);
    }
    FUN_00431137((LPVOID)*param_1);
  }
  if (param_1[2] != 0) {
    uVar1 = 0;
    if (param_1[3] != 0) {
      do {
        FUN_00408f61((int *)(param_1[2] + iVar2));
        uVar1 = uVar1 + 1;
        iVar2 = iVar2 + 0xd0;
      } while (uVar1 < (uint)param_1[3]);
    }
    FUN_00431137((LPVOID)param_1[2]);
  }
  uVar1 = 0;
  if (param_1[4] != 0) {
    if (param_1[5] != 0) {
      do {
        if (*(int *)(param_1[4] + uVar1 * 8) != 0) {
          FUN_004380ab(*(LPVOID *)(param_1[4] + uVar1 * 8));
        }
        uVar1 = uVar1 + 1;
      } while (uVar1 < (uint)param_1[5]);
    }
    FUN_00431137((LPVOID)param_1[4]);
  }
  if (param_1[6] != 0) {
    FUN_00431137((LPVOID)param_1[6]);
  }
  if (param_1[7] != 0) {
    FUN_00431137((LPVOID)param_1[7]);
  }
  for (iVar2 = 9; iVar2 != 0; iVar2 = iVar2 + -1) {
    *param_1 = 0;
    param_1 = param_1 + 1;
  }
  return;
}



/* Function: FUN_00409897 */

int FUN_00409897(int param_1,int *param_2)

{
  int iVar1;
  char *pcVar2;
  int *local_8;
  
  local_8 = (int *)0x0;
  iVar1 = FUN_00436045(param_2,L"Update",(int)&local_8);
  if (iVar1 == 1) {
    iVar1 = 0;
  }
  else {
    if (iVar1 < 0) {
      pcVar2 = "Failed to select Bundle/Update node.";
    }
    else {
      iVar1 = FUN_00435b5e(local_8,L"Location",(int *)(param_1 + 4));
      if (-1 < iVar1) goto LAB_004098ee;
      pcVar2 = "Failed to get Update@Location.";
    }
    FUN_00430a57(iVar1,pcVar2);
  }
LAB_004098ee:
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return iVar1;
}



/* Function: FUN_00409902 */

void FUN_00409902(uint *param_1)

{
  FUN_00408f61((int *)(param_1 + 2));
  if (param_1[1] != 0) {
    FUN_004380ab((LPVOID)param_1[1]);
  }
  FUN_004267c0(param_1,0,0xd8);
  return;
}



/* Function: FUN_00409935 */

int FUN_00409935(int param_1,undefined4 *param_2)

{
  LPVOID pvVar1;
  int iVar2;
  LPVOID local_8;
  
  local_8 = (LPVOID)0x0;
  iVar2 = FUN_00433cea((int *)&local_8,L"SOFTWARE\\%ls\\Updates\\");
  if (-1 < iVar2) {
    if (*(int *)(param_1 + 0xa8) != 0) {
      iVar2 = FUN_00433cea((int *)&local_8,L"%ls%ls\\");
      if (iVar2 < 0) goto LAB_0040999b;
    }
    iVar2 = FUN_00433c35((int *)&local_8,*(short **)(param_1 + 0xac),0);
    pvVar1 = local_8;
    if (-1 < iVar2) {
      local_8 = (LPVOID)0x0;
      *param_2 = pvVar1;
      goto LAB_004099b6;
    }
  }
LAB_0040999b:
  FUN_00430a57(iVar2,"Failed to format the key path for update registration.");
LAB_004099b6:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar2;
}



/* Function: FUN_004099cc */

DWORD FUN_004099cc(int param_1,LPCRITICAL_SECTION param_2,int *param_3)

{
  DWORD DVar1;
  char *pcVar2;
  
  DVar1 = FUN_00403c02(param_2,L"WixBundleName",param_3);
  if (DVar1 == 0x80070490) {
    DVar1 = FUN_0040461f(param_2,L"WixBundleName",*(int *)(param_1 + 0x60),0);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to set bundle name.";
      goto LAB_00409a23;
    }
    DVar1 = FUN_00433f88(param_3,*(LPCWSTR *)(param_1 + 0x60),0);
  }
  if (-1 < (int)DVar1) {
    return DVar1;
  }
  pcVar2 = "Failed to get bundle name.";
LAB_00409a23:
  FUN_00430a57(DVar1,pcVar2);
  return DVar1;
}



/* Function: FUN_00409a34 */

uint FUN_00409a34(int param_1,int *param_2)

{
  uint uVar1;
  int iVar2;
  char *pcVar3;
  int *local_18;
  int *local_14;
  int *local_10;
  PCNZWCH local_c;
  LPVOID local_8;
  
  local_10 = (int *)0x0;
  local_14 = (int *)0x0;
  local_c = (PCNZWCH)0x0;
  local_8 = (LPVOID)0x0;
  local_18 = (int *)0x0;
  uVar1 = FUN_00435fbe(param_2,L"RelatedBundle",(int)&local_10);
  if ((int)uVar1 < 0) {
    pcVar3 = "Failed to get RelatedBundle nodes";
  }
  else {
    uVar1 = (**(code **)(*local_10 + 0x20))(local_10,&local_18);
    if (-1 < (int)uVar1) {
      param_2 = (int *)0x0;
      if (local_18 != (int *)0x0) {
        do {
          uVar1 = FUN_00435f1d(local_10,&local_14,(undefined4 *)0x0);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get next RelatedBundle element.";
LAB_00409c67:
            FUN_00430a57(uVar1,pcVar3);
            break;
          }
          uVar1 = FUN_00435b5e(local_14,L"Action",(int *)&local_c);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get @Action.";
            goto LAB_00409c67;
          }
          uVar1 = FUN_00435b5e(local_14,&DAT_0043c524,(int *)&local_8);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get @Id.";
            goto LAB_00409c67;
          }
          iVar2 = CompareStringW(0x7f,0,local_c,-1,L"Detect",-1);
          if (iVar2 == 2) {
            uVar1 = FUN_0043109a((int *)(param_1 + 0x14),*(int *)(param_1 + 0x18) + 1,4,5);
            if ((int)uVar1 < 0) {
              pcVar3 = "Failed to resize Detect code array in registration";
              goto LAB_00409c67;
            }
            *(LPVOID *)(*(int *)(param_1 + 0x14) + *(int *)(param_1 + 0x18) * 4) = local_8;
            *(int *)(param_1 + 0x18) = *(int *)(param_1 + 0x18) + 1;
          }
          else {
            iVar2 = CompareStringW(0x7f,0,local_c,-1,L"Upgrade",-1);
            if (iVar2 == 2) {
              uVar1 = FUN_0043109a((int *)(param_1 + 0x1c),*(int *)(param_1 + 0x20) + 1,4,5);
              if ((int)uVar1 < 0) {
                pcVar3 = "Failed to resize Upgrade code array in registration";
                goto LAB_00409c67;
              }
              *(LPVOID *)(*(int *)(param_1 + 0x1c) + *(int *)(param_1 + 0x20) * 4) = local_8;
              *(int *)(param_1 + 0x20) = *(int *)(param_1 + 0x20) + 1;
            }
            else {
              iVar2 = CompareStringW(0x7f,0,local_c,-1,L"Addon",-1);
              if (iVar2 == 2) {
                uVar1 = FUN_0043109a((int *)(param_1 + 0x24),*(int *)(param_1 + 0x28) + 1,4,5);
                if ((int)uVar1 < 0) {
                  pcVar3 = "Failed to resize Addon code array in registration";
                  goto LAB_00409c67;
                }
                *(LPVOID *)(*(int *)(param_1 + 0x24) + *(int *)(param_1 + 0x28) * 4) = local_8;
                *(int *)(param_1 + 0x28) = *(int *)(param_1 + 0x28) + 1;
              }
              else {
                iVar2 = CompareStringW(0x7f,0,local_c,-1,L"Patch",-1);
                if (iVar2 != 2) {
                  uVar1 = 0x80070057;
                  FUN_00430a57(0x80070057,"Invalid value for @Action: %ls");
                  break;
                }
                uVar1 = FUN_0043109a((int *)(param_1 + 0x2c),*(int *)(param_1 + 0x30) + 1,4,5);
                if ((int)uVar1 < 0) {
                  pcVar3 = "Failed to resize Patch code array in registration";
                  goto LAB_00409c67;
                }
                *(LPVOID *)(*(int *)(param_1 + 0x2c) + *(int *)(param_1 + 0x30) * 4) = local_8;
                *(int *)(param_1 + 0x30) = *(int *)(param_1 + 0x30) + 1;
              }
            }
          }
          local_8 = (LPVOID)0x0;
          param_2 = (int *)((int)param_2 + 1);
        } while (param_2 < local_18);
      }
      goto LAB_00409c70;
    }
    pcVar3 = "Failed to get RelatedBundle element count.";
  }
  FUN_00430a57(uVar1,pcVar3);
LAB_00409c70:
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  if (local_14 != (int *)0x0) {
    (**(code **)(*local_14 + 8))(local_14);
  }
  if (local_c != (PCNZWCH)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00409cae */

uint FUN_00409cae(int *param_1,int *param_2,uint *param_3)

{
  uint uVar1;
  int *piVar2;
  LPVOID pvVar3;
  char *pcVar4;
  int *local_14;
  int *local_10;
  LPCWSTR local_c;
  int *local_8;
  
  local_14 = (int *)0x0;
  local_8 = (int *)0x0;
  local_10 = (int *)0x0;
  pvVar3 = (LPVOID)0x0;
  local_c = (LPCWSTR)0x0;
  uVar1 = FUN_00435fbe(param_1,L"SoftwareTag",(int)&local_14);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to select software tag nodes.";
  }
  else {
    uVar1 = (**(code **)(*local_14 + 0x20))(local_14,&local_10);
    if (-1 < (int)uVar1) {
      if (local_10 != (int *)0x0) {
        pvVar3 = (LPVOID)FUN_00431078((int)local_10 * 0xc,1);
        if (pvVar3 == (LPVOID)0x0) {
          uVar1 = 0x8007000e;
          FUN_004300d9();
          pcVar4 = "Failed to allocate memory for software tag structs.";
          goto LAB_00409e57;
        }
        param_1 = (int *)0x0;
        if (local_10 != (int *)0x0) {
          piVar2 = (int *)((int)pvVar3 + 8);
          do {
            uVar1 = FUN_00435f1d(local_14,&local_8,(undefined4 *)0x0);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to get next node.";
              goto LAB_00409e57;
            }
            uVar1 = FUN_00435b5e(local_8,L"Filename",piVar2 + -2);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to get @Filename.";
              goto LAB_00409e57;
            }
            uVar1 = FUN_00435b5e(local_8,L"Regid",piVar2 + -1);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to get @Regid.";
              goto LAB_00409e57;
            }
            uVar1 = FUN_00435d59(local_8,&local_c);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to get SoftwareTag text.";
              goto LAB_00409e57;
            }
            uVar1 = FUN_00434262(piVar2,local_c,0,0xfde9);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to convert SoftwareTag text to UTF-8";
              goto LAB_00409e57;
            }
            if (local_c != (LPCWSTR)0x0) {
              Ordinal_6(local_c);
              local_c = (LPCWSTR)0x0;
            }
            if (local_8 != (int *)0x0) {
              (**(code **)(*local_8 + 8))(local_8);
              local_8 = (int *)0x0;
            }
            param_1 = (int *)((int)param_1 + 1);
            piVar2 = piVar2 + 3;
          } while (param_1 < local_10);
        }
      }
      uVar1 = 0;
      *param_3 = (uint)local_10;
      *param_2 = (int)pvVar3;
      pvVar3 = (LPVOID)0x0;
      goto LAB_00409e17;
    }
    pcVar4 = "Failed to get software tag count.";
  }
LAB_00409e57:
  FUN_00430a57(uVar1,pcVar4);
LAB_00409e17:
  if (local_c != (LPCWSTR)0x0) {
    Ordinal_6(local_c);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_14 != (int *)0x0) {
    (**(code **)(*local_14 + 8))(local_14);
  }
  if (pvVar3 != (LPVOID)0x0) {
    FUN_00431137(pvVar3);
  }
  return uVar1;
}



/* Function: FUN_00409e7d */

DWORD FUN_00409e7d(undefined4 param_1,LPCRITICAL_SECTION param_2,PCNZWCH param_3,undefined4 param_4)

{
  uint uVar1;
  char *pcVar2;
  short *local_8;
  
  local_8 = (short *)0x0;
  uVar1 = FUN_00403c02(param_2,param_3,(int *)&local_8);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to get the %ls variable.";
  }
  else {
    uVar1 = FUN_00432a16(param_1,param_4,local_8);
    if (-1 < (int)uVar1) goto LAB_00409eca;
    pcVar2 = "Failed to write %ls value.";
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_00409eca:
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00409edf */

int FUN_00409edf(int param_1,int *param_2)

{
  int iVar1;
  undefined4 uVar2;
  int iVar3;
  uint uVar4;
  LPCWSTR local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  uVar4 = 0;
  uVar2 = 0x1c;
  if (param_1 != 0) {
    uVar2 = 0x23;
  }
  local_10 = (LPCWSTR)0x0;
  local_8 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  iVar3 = FUN_00431d07(uVar2,(int *)&local_10);
  if (iVar3 < 0) {
    FUN_00430a57(iVar3,"Failed to find local %hs appdata directory.");
  }
  else if (param_2[1] != 0) {
    param_1 = 0;
    do {
      iVar1 = *param_2;
      iVar3 = FUN_004314a9(local_10,(LPCWSTR)((undefined4 *)(iVar1 + param_1))[1],(int *)&local_8);
      if ((iVar3 < 0) ||
         (iVar3 = FUN_004314a9(local_8,*(LPCWSTR *)(iVar1 + param_1),(int *)&local_c), iVar3 < 0)) {
        FUN_00430a57(iVar3,"Failed to allocate regid folder path.");
        break;
      }
      FUN_00436816(local_c);
      RemoveDirectoryW(local_8);
      uVar4 = uVar4 + 1;
      param_1 = param_1 + 0xc;
    } while (uVar4 < (uint)param_2[1]);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  return iVar3;
}



/* Function: FUN_00409fd3 */

uint FUN_00409fd3(int param_1)

{
  LPCWSTR pWVar1;
  uint uVar2;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  uVar2 = FUN_00409935(param_1,&local_8);
  pWVar1 = local_8;
  if ((int)uVar2 < 0) {
    FUN_00430a57(uVar2,"Failed to format key for update registration.");
  }
  else {
    uVar2 = FUN_004321e8(*(undefined4 *)(param_1 + 0x4c),local_8,0,0);
    if ((uVar2 != 0x80070002) && ((int)uVar2 < 0)) {
      FUN_00430a57(uVar2,"Failed to remove update registration key: %ls");
    }
  }
  if (pWVar1 != (LPCWSTR)0x0) {
    FUN_004380ab(pWVar1);
  }
  return uVar2;
}



/* Function: FUN_0040a040 */

int FUN_0040a040(int *param_1)

{
  int iVar1;
  char *pcVar2;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  param_1[0x13] = (*param_1 != 0) + 0x80000001;
  iVar1 = FUN_00433cea(param_1 + 0x14,L"%s\\%s");
  if (iVar1 < 0) {
    pcVar2 = "Failed to build uninstall registry key path.";
  }
  else {
    iVar1 = FUN_00413be9(*param_1,param_1[3],(int *)&local_8);
    if (iVar1 < 0) {
      pcVar2 = "Failed to build cache directory.";
    }
    else {
      iVar1 = FUN_004314a9(local_8,(LPCWSTR)param_1[0x12],param_1 + 0x15);
      if (iVar1 < 0) {
        pcVar2 = "Failed to build cached executable path.";
      }
      else {
        iVar1 = FUN_00433cea(param_1 + 0x17,L"%s\\state.rsm");
        if (-1 < iVar1) goto LAB_0040a0e0;
        pcVar2 = "Failed to build state file path.";
      }
    }
  }
  FUN_00430a57(iVar1,pcVar2);
LAB_0040a0e0:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_0040a0f6 */

uint FUN_0040a0f6(int param_1,int param_2,int param_3,int param_4)

{
  uint uVar1;
  uint uVar2;
  wchar_t *pwVar3;
  char *pcVar4;
  undefined4 local_14;
  int local_10;
  short *local_c;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  local_c = (short *)0x0;
  local_10 = 0;
  local_14 = 0;
  FUN_00436186(&local_10,&local_14);
  pwVar3 = L"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run";
  if (4 < local_10) {
    pwVar3 = L"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce";
  }
  if (param_2 == 0) {
LAB_0040a173:
    if (param_3 != 1) {
LAB_0040a179:
      if (param_4 == 0) {
        uVar1 = FUN_004324d5(*(undefined4 *)(param_1 + 0x4c),pwVar3,0x20006,&local_8);
        if ((uVar1 == 0x80070002) || (uVar1 == 0x80070003)) {
          uVar1 = 0;
          goto LAB_0040a25e;
        }
        uVar2 = RegDeleteValueW(local_8,*(LPCWSTR *)(param_1 + 0xc));
        if (uVar2 == 2) {
          uVar2 = 0;
        }
        if (uVar2 == 0) goto LAB_0040a25e;
        uVar1 = uVar2 & 0xffff | 0x80070000;
        if ((int)uVar2 < 1) {
          uVar1 = uVar2;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        FUN_004300d9();
        pcVar4 = "Failed to delete run key value.";
        goto LAB_0040a256;
      }
    }
    uVar1 = FUN_00433cea((int *)&local_c,L"%ls /%ls");
    if ((int)uVar1 < 0) {
      pcVar4 = "Failed to format resume command line for RunOnce.";
    }
    else {
      uVar1 = FUN_00432129(*(undefined4 *)(param_1 + 0x4c),pwVar3,0x20006,&local_8);
      if ((int)uVar1 < 0) {
        pcVar4 = "Failed to create run key.";
      }
      else {
        uVar1 = FUN_00432a16(local_8,*(undefined4 *)(param_1 + 0xc),local_c);
        if (-1 < (int)uVar1) goto LAB_0040a25e;
        pcVar4 = "Failed to write run key value.";
      }
    }
  }
  else {
    uVar1 = FUN_004329c8(param_2,L"Resume");
    if (-1 < (int)uVar1) {
      if (param_3 != 3) goto LAB_0040a173;
      uVar1 = FUN_004329c8(param_2,L"Installed");
      if ((int)uVar1 < 0) {
        pcVar4 = "Failed to write Installed value.";
        goto LAB_0040a256;
      }
      goto LAB_0040a179;
    }
    pcVar4 = "Failed to write Resume value.";
  }
LAB_0040a256:
  FUN_00430a57(uVar1,pcVar4);
LAB_0040a25e:
  if (local_c != (short *)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  return uVar1;
}



/* Function: FUN_0040a284 */

DWORD FUN_0040a284(int param_1,int *param_2)

{
  undefined4 uVar1;
  DWORD DVar2;
  uint uVar3;
  uint uVar4;
  undefined4 *puVar5;
  char *pcVar6;
  undefined4 *puVar7;
  LPCWSTR local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  uVar4 = 0;
  uVar1 = 0x1c;
  if (param_1 != 0) {
    uVar1 = 0x23;
  }
  local_10 = (LPCWSTR)0x0;
  local_8 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  DVar2 = FUN_00431d07(uVar1,(int *)&local_10);
  if ((int)DVar2 < 0) {
    pcVar6 = "Failed to find local %hs appdata directory.";
LAB_0040a366:
    FUN_00430a57(DVar2,pcVar6);
  }
  else if (param_2[1] != 0) {
    param_1 = 0;
    do {
      puVar5 = (undefined4 *)(*param_2 + param_1);
      DVar2 = FUN_004314a9(local_10,(LPCWSTR)puVar5[1],(int *)&local_8);
      if (((int)DVar2 < 0) ||
         (DVar2 = FUN_004314a9(local_8,(LPCWSTR)*puVar5,(int *)&local_c), (int)DVar2 < 0)) {
        FUN_00430a57(DVar2,"Failed to allocate regid folder path.");
        break;
      }
      DVar2 = FUN_00437850(local_8,(LPSECURITY_ATTRIBUTES)0x0);
      if ((int)DVar2 < 0) {
        pcVar6 = "Failed to create regid folder: %ls";
        goto LAB_0040a366;
      }
      puVar7 = (undefined4 *)0x0;
      uVar3 = lstrlenA((LPCSTR)puVar5[2]);
      DVar2 = FUN_0043731c(local_c,0x80,puVar5[2],uVar3,puVar7);
      if ((int)DVar2 < 0) {
        pcVar6 = "Failed to write tag xml to file: %ls";
        goto LAB_0040a366;
      }
      uVar4 = uVar4 + 1;
      param_1 = param_1 + 0xc;
    } while (uVar4 < (uint)param_2[1]);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  return DVar2;
}



/* Function: FUN_0040a3b1 */

uint FUN_0040a3b1(int param_1,LPCRITICAL_SECTION param_2)

{
  DWORD DVar1;
  char *pcVar2;
  LPVOID local_c;
  HKEY local_8;
  
  local_c = (LPVOID)0x0;
  local_8 = (HKEY)0x0;
  DVar1 = FUN_00409935(param_1,&local_c);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to get the formatted key path for update registration.";
  }
  else {
    DVar1 = FUN_00432129(*(undefined4 *)(param_1 + 0x4c),local_c,0x20006,&local_8);
    if (-1 < (int)DVar1) {
      DVar1 = FUN_00432a16(local_8,L"ThisVersionInstalled",(short *)&DAT_00441138);
      if (((((((int)DVar1 < 0) ||
             (DVar1 = FUN_00432a16(local_8,L"PackageName",*(short **)(param_1 + 0x60)),
             (int)DVar1 < 0)) ||
            (DVar1 = FUN_00432a16(local_8,L"PackageVersion",*(short **)(param_1 + 100)),
            (int)DVar1 < 0)) ||
           (DVar1 = FUN_00432a16(local_8,L"Publisher",*(short **)(param_1 + 0x68)), (int)DVar1 < 0))
          || ((((*(short **)(param_1 + 0xa4) != (short *)0x0 &&
                (DVar1 = FUN_00432a16(local_8,L"PublishingGroup",*(short **)(param_1 + 0xa4)),
                (int)DVar1 < 0)) ||
               ((DVar1 = FUN_00432a16(local_8,L"ReleaseType",*(short **)(param_1 + 0xb0)),
                (int)DVar1 < 0 ||
                ((DVar1 = FUN_00409e7d(local_8,param_2,L"LogonUser",L"InstalledBy"), (int)DVar1 < 0
                 || (DVar1 = FUN_00409e7d(local_8,param_2,L"Date",L"InstalledDate"), (int)DVar1 < 0)
                 ))))) ||
              (DVar1 = FUN_00409e7d(local_8,param_2,L"InstallerName",L"InstallerName"),
              (int)DVar1 < 0)))) ||
         (DVar1 = FUN_00409e7d(local_8,param_2,L"InstallerVersion",L"InstallerVersion"),
         (int)DVar1 < 0)) {
        FUN_00430a57(DVar1,"Failed to write %ls value.");
      }
      goto LAB_0040a556;
    }
    pcVar2 = "Failed to create the key for update registration.";
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_0040a556:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar1;
}



/* Function: FUN_0040a57f */

uint FUN_0040a57f(int param_1,uint *param_2)

{
  uint uVar1;
  int local_c;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  local_c = 0;
  uVar1 = FUN_004324d5(*(undefined4 *)(param_1 + 0x4c),*(undefined4 *)(param_1 + 0x50),1,&local_8);
  if (-1 < (int)uVar1) {
    uVar1 = FUN_00432582(local_8,L"Installed",&local_c);
  }
  if ((uVar1 == 0x80070002) || (uVar1 == 0x80070003)) {
    uVar1 = 0;
  }
  *param_2 = (uint)(local_c == 1);
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  return uVar1;
}



/* Function: FUN_0040a5f0 */

uint FUN_0040a5f0(int param_1)

{
  uint uVar1;
  char *pcVar2;
  
  uVar1 = FUN_0041f98e(1,param_1,(int *)(param_1 + 0xb4));
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to initialize per-machine related bundles.";
  }
  else {
    uVar1 = FUN_0041f98e(0,param_1,(int *)(param_1 + 0xb4));
    if (-1 < (int)uVar1) {
      return uVar1;
    }
    pcVar2 = "Failed to initialize per-user related bundles.";
  }
  FUN_00430a57(uVar1,pcVar2);
  return uVar1;
}



/* Function: FUN_0040a63a */

uint FUN_0040a63a(int param_1,undefined4 *param_2)

{
  uint uVar1;
  char *pcVar2;
  int local_14;
  LPVOID local_10;
  HKEY local_c;
  HKEY local_8;
  
  local_10 = (LPVOID)0x0;
  local_c = (HKEY)0x0;
  local_8 = (HKEY)0x0;
  local_14 = 0;
  uVar1 = FUN_00433cea((int *)&local_10,L"%ls.RebootRequired");
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to format pending restart registry key to read.";
    goto LAB_0040a6fd;
  }
  uVar1 = FUN_004324d5(*(undefined4 *)(param_1 + 0x4c),local_10,1,&local_c);
  if ((int)uVar1 < 0) {
    uVar1 = FUN_004324d5(*(undefined4 *)(param_1 + 0x4c),*(undefined4 *)(param_1 + 0x50),1,&local_8)
    ;
    if ((uVar1 != 0x80070002) && (uVar1 != 0x80070003)) {
      if ((int)uVar1 < 0) {
        pcVar2 = "Failed to open registration key.";
      }
      else {
        uVar1 = FUN_00432582(local_8,L"Resume",&local_14);
        if (uVar1 == 0x80070002) {
          *param_2 = 1;
          goto LAB_0040a74f;
        }
        if (-1 < (int)uVar1) {
          if (local_14 == 1) {
            *param_2 = 2;
          }
          else if (local_14 == 2) {
            *param_2 = 5;
          }
          else if (local_14 == 3) {
            *param_2 = 6;
          }
          else if (local_14 == 4) {
            *param_2 = 4;
          }
          else {
            *param_2 = 1;
          }
          goto LAB_0040a751;
        }
        pcVar2 = "Failed to read Resume value.";
      }
LAB_0040a6fd:
      FUN_00430a57(uVar1,pcVar2);
      goto LAB_0040a751;
    }
    *param_2 = 0;
  }
  else {
    *param_2 = 3;
  }
LAB_0040a74f:
  uVar1 = 0;
LAB_0040a751:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_c != (HKEY)0x0) {
    RegCloseKey(local_c);
    local_c = (HKEY)0x0;
  }
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  return uVar1;
}



/* Function: FUN_0040a787 */

void FUN_0040a787(int param_1,int *param_2,SIZE_T *param_3)

{
  FUN_00436b6a(param_2,param_3,*(LPCWSTR *)(param_1 + 0x5c));
  return;
}



/* Function: FUN_0040a79f */

uint FUN_0040a79f(uint *param_1,int *param_2)

{
  uint uVar1;
  int iVar2;
  char *pcVar3;
  int *local_14;
  LPCWSTR local_10;
  int *local_c;
  int *local_8;
  
  local_c = (int *)0x0;
  local_8 = (int *)0x0;
  local_14 = (int *)0x0;
  local_10 = (LPCWSTR)0x0;
  uVar1 = FUN_00436045(param_2,L"Registration",(int)&local_c);
  if (uVar1 == 1) {
    uVar1 = 0x80070490;
  }
  if ((int)uVar1 < 0) {
    FUN_00430a57(uVar1,"Failed to select registration node.");
    goto LAB_0040acd1;
  }
  uVar1 = FUN_00435b5e(local_c,&DAT_0043c524,(int *)(param_1 + 3));
  if ((int)uVar1 < 0) {
    pcVar3 = "Failed to get @Id.";
  }
  else {
    uVar1 = FUN_00435b5e(local_c,&DAT_00440130,(int *)(param_1 + 4));
    if ((int)uVar1 < 0) {
      pcVar3 = "Failed to get @Tag.";
    }
    else {
      uVar1 = FUN_00409a34((int)param_1,param_2);
      if ((int)uVar1 < 0) {
        pcVar3 = "Failed to parse related bundles";
      }
      else {
        uVar1 = FUN_00435b5e(local_c,L"Version",(int *)&local_10);
        if ((int)uVar1 < 0) {
          pcVar3 = "Failed to get @Version.";
        }
        else {
          uVar1 = FUN_0043720f(local_10,0,param_1 + 0xe);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to parse @Version: %ls";
LAB_0040ab54:
            FUN_00430a57(uVar1,pcVar3);
            goto LAB_0040acd1;
          }
          uVar1 = FUN_00435b5e(local_c,L"ProviderKey",(int *)(param_1 + 0x11));
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to get @ProviderKey.";
          }
          else {
            uVar1 = FUN_00435b5e(local_c,L"ExecutableName",(int *)(param_1 + 0x12));
            if ((int)uVar1 < 0) {
              pcVar3 = "Failed to get @ExecutableName.";
            }
            else {
              uVar1 = FUN_00435d6c(local_c,L"PerMachine",param_1);
              if ((int)uVar1 < 0) {
                pcVar3 = "Failed to get @PerMachine.";
              }
              else {
                uVar1 = FUN_00436045(local_c,(undefined2 *)&DAT_00440228,(int)&local_8);
                if (uVar1 == 1) goto LAB_0040abaf;
                if ((int)uVar1 < 0) {
                  pcVar3 = "Failed to select ARP node.";
                }
                else {
                  uVar1 = FUN_00435d6c(local_8,L"Register",param_1 + 1);
                  if ((int)uVar1 < 0) {
                    pcVar3 = "Failed to get @Register.";
                  }
                  else {
                    uVar1 = FUN_00435b5e(local_8,L"DisplayName",(int *)(param_1 + 0x18));
                    if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                      uVar1 = FUN_00435b5e(local_8,L"DisplayVersion",(int *)(param_1 + 0x19));
                      if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                        uVar1 = FUN_00435b5e(local_8,L"Publisher",(int *)(param_1 + 0x1a));
                        if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                          uVar1 = FUN_00435b5e(local_8,L"HelpLink",(int *)(param_1 + 0x1b));
                          if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                            uVar1 = FUN_00435b5e(local_8,L"HelpTelephone",(int *)(param_1 + 0x1c));
                            if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                              uVar1 = FUN_00435b5e(local_8,L"AboutUrl",(int *)(param_1 + 0x1d));
                              if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                                uVar1 = FUN_00435b5e(local_8,L"UpdateUrl",(int *)(param_1 + 0x1e));
                                if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                                  uVar1 = FUN_00435b5e(local_8,L"ParentDisplayName",
                                                       (int *)(param_1 + 0x1f));
                                  if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                                    uVar1 = FUN_00435b5e(local_8,L"Comments",(int *)(param_1 + 0x20)
                                                        );
                                    if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                                      uVar1 = FUN_00435b5e(local_8,L"Contact",
                                                           (int *)(param_1 + 0x21));
                                      if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                                        uVar1 = FUN_00435b5e(local_8,L"DisableModify",
                                                             (int *)&local_10);
                                        if ((int)uVar1 < 0) {
                                          if (uVar1 == 0x80070490) {
                                            param_1[0x22] = 0;
                                            uVar1 = 0;
                                          }
                                        }
                                        else {
                                          iVar2 = CompareStringW(0x7f,0,local_10,-1,L"button",-1);
                                          if (iVar2 == 2) {
                                            param_1[0x22] = 2;
                                          }
                                          else {
                                            iVar2 = CompareStringW(0x7f,0,local_10,-1,L"yes",-1);
                                            if (iVar2 == 2) {
                                              param_1[0x22] = 1;
                                            }
                                            else {
                                              iVar2 = CompareStringW(0x7f,0,local_10,-1,L"no",-1);
                                              if (iVar2 != 2) {
                                                uVar1 = 0x8000ffff;
                                                FUN_004300d9();
                                                pcVar3 = "Invalid modify disabled type: %ls";
                                                goto LAB_0040ab54;
                                              }
                                              param_1[0x22] = 0;
                                            }
                                          }
                                        }
                                        if ((int)uVar1 < 0) {
                                          pcVar3 = "Failed to get @DisableModify.";
                                        }
                                        else {
                                          uVar1 = FUN_00435d6c(local_8,L"DisableRemove",
                                                               param_1 + 0x24);
                                          if (uVar1 != 0x80070490) {
                                            if ((int)uVar1 < 0) {
                                              pcVar3 = "Failed to get @DisableRemove.";
                                              goto LAB_0040acc8;
                                            }
                                            param_1[0x23] = 1;
                                          }
LAB_0040abaf:
                                          uVar1 = FUN_00409cae(local_c,(int *)(param_1 + 0x25),
                                                               param_1 + 0x26);
                                          if ((int)uVar1 < 0) {
                                            pcVar3 = "Failed to parse software tag.";
                                          }
                                          else {
                                            uVar1 = FUN_00436045(local_c,L"Update",(int)&local_14);
                                            if (uVar1 == 1) {
LAB_0040acb7:
                                              uVar1 = FUN_0040a040((int *)param_1);
                                              if (-1 < (int)uVar1) goto LAB_0040acd1;
                                              pcVar3 = "Failed to set registration paths.";
                                            }
                                            else if ((int)uVar1 < 0) {
                                              pcVar3 = "Failed to select Update node.";
                                            }
                                            else {
                                              param_1[0x27] = 1;
                                              uVar1 = FUN_00435b5e(local_14,L"Manufacturer",
                                                                   (int *)(param_1 + 0x28));
                                              if ((int)uVar1 < 0) {
                                                pcVar3 = "Failed to get @Manufacturer.";
                                              }
                                              else {
                                                uVar1 = FUN_00435b5e(local_14,L"Department",
                                                                     (int *)(param_1 + 0x29));
                                                if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                                                  uVar1 = FUN_00435b5e(local_14,L"ProductFamily",
                                                                       (int *)(param_1 + 0x2a));
                                                  if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                                                    uVar1 = FUN_00435b5e(local_14,L"Name",
                                                                         (int *)(param_1 + 0x2b));
                                                    if ((int)uVar1 < 0) {
                                                      pcVar3 = "Failed to get @Name.";
                                                    }
                                                    else {
                                                      uVar1 = FUN_00435b5e(local_14,
                                                  L"Classification",(int *)(param_1 + 0x2c));
                                                  if (-1 < (int)uVar1) goto LAB_0040acb7;
                                                  pcVar3 = "Failed to get @Classification.";
                                                  }
                                                  }
                                                  else {
                                                    pcVar3 = "Failed to get @ProductFamily.";
                                                  }
                                                }
                                                else {
                                                  pcVar3 = "Failed to get @Department.";
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                      else {
                                        pcVar3 = "Failed to get @Contact.";
                                      }
                                    }
                                    else {
                                      pcVar3 = "Failed to get @Comments.";
                                    }
                                  }
                                  else {
                                    pcVar3 = "Failed to get @ParentDisplayName.";
                                  }
                                }
                                else {
                                  pcVar3 = "Failed to get @UpdateUrl.";
                                }
                              }
                              else {
                                pcVar3 = "Failed to get @AboutUrl.";
                              }
                            }
                            else {
                              pcVar3 = "Failed to get @HelpTelephone.";
                            }
                          }
                          else {
                            pcVar3 = "Failed to get @HelpLink.";
                          }
                        }
                        else {
                          pcVar3 = "Failed to get @Publisher.";
                        }
                      }
                      else {
                        pcVar3 = "Failed to get @DisplayVersion.";
                      }
                    }
                    else {
                      pcVar3 = "Failed to get @DisplayName.";
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
LAB_0040acc8:
  FUN_00430a57(uVar1,pcVar3);
LAB_0040acd1:
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_14 != (int *)0x0) {
    (**(code **)(*local_14 + 8))(local_14);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  return uVar1;
}



/* Function: FUN_0040ad0e */

DWORD FUN_0040ad0e(int param_1,int param_2,uint param_3)

{
  DWORD DVar1;
  
  DVar1 = FUN_0043731c(*(LPCWSTR *)(param_1 + 0x5c),0x80,param_2,param_3,(undefined4 *)0x0);
  if (DVar1 == 0x80070003) {
    DVar1 = 0;
  }
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to write state to file: %ls");
  }
  return DVar1;
}



/* Function: FUN_0040ad55 */

DWORD FUN_0040ad55(LPCWSTR param_1,int *param_2,LPCRITICAL_SECTION param_3,int param_4,byte param_5,
                  int param_6,uint param_7,uint param_8)

{
  DWORD DVar1;
  short *psVar2;
  char *pcVar3;
  short *local_c;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  local_c = (short *)0x0;
  if (((param_5 & 1) == 0) ||
     (DVar1 = FUN_004135a7(*param_2,(LPCWSTR)param_2[0x12],param_2[3],(int *)(param_4 + 4),param_1),
     -1 < (int)DVar1)) {
    DVar1 = FUN_00432129(param_2[0x13],param_2[0x14],0x20006,&local_8);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to create registration key.";
    }
    else {
      if ((param_5 & 2) != 0) {
        DVar1 = FUN_00432a16(local_8,L"BundleCachePath",(short *)param_2[0x15]);
        if (((((-1 < (int)DVar1) &&
              (DVar1 = FUN_00432abe(local_8,L"BundleUpgradeCode",(short *)param_2[7],param_2[8]),
              -1 < (int)DVar1)) &&
             (DVar1 = FUN_00432abe(local_8,L"BundleAddonCode",(short *)param_2[9],param_2[10]),
             -1 < (int)DVar1)) &&
            (((DVar1 = FUN_00432abe(local_8,L"BundleDetectCode",(short *)param_2[5],param_2[6]),
              -1 < (int)DVar1 &&
              (DVar1 = FUN_00432abe(local_8,L"BundlePatchCode",(short *)param_2[0xb],param_2[0xc]),
              -1 < (int)DVar1)) &&
             ((DVar1 = FUN_00432bf4(local_8,L"BundleVersion",L"%hu.%hu.%hu.%hu"), -1 < (int)DVar1 &&
              ((param_2[0x11] == 0 ||
               (DVar1 = FUN_00432a16(local_8,L"BundleProviderKey",(short *)param_2[0x11]),
               -1 < (int)DVar1)))))))) &&
           (((param_2[4] == 0 ||
             (DVar1 = FUN_00432a16(local_8,L"BundleTag",(short *)param_2[4]), -1 < (int)DVar1)) &&
            ((DVar1 = FUN_00432bf4(local_8,L"EngineVersion",L"%hs"), -1 < (int)DVar1 &&
             (DVar1 = FUN_00432bf4(local_8,L"DisplayIcon",L"%s,0"), -1 < (int)DVar1)))))) {
          DVar1 = FUN_004099cc((int)param_2,param_3,(int *)&local_c);
          psVar2 = local_c;
          if ((int)DVar1 < 0) {
            psVar2 = (short *)param_2[0x18];
          }
          DVar1 = FUN_00432a16(local_8,L"DisplayName",psVar2);
          if (((((((-1 < (int)DVar1) &&
                  ((param_2[0x19] == 0 ||
                   (DVar1 = FUN_00432a16(local_8,L"DisplayVersion",(short *)param_2[0x19]),
                   -1 < (int)DVar1)))) &&
                 ((param_2[0x1a] == 0 ||
                  (DVar1 = FUN_00432a16(local_8,L"Publisher",(short *)param_2[0x1a]),
                  -1 < (int)DVar1)))) &&
                ((((param_2[0x1b] == 0 ||
                   (DVar1 = FUN_00432a16(local_8,L"HelpLink",(short *)param_2[0x1b]),
                   -1 < (int)DVar1)) &&
                  ((param_2[0x1c] == 0 ||
                   (DVar1 = FUN_00432a16(local_8,L"HelpTelephone",(short *)param_2[0x1c]),
                   -1 < (int)DVar1)))) &&
                 ((param_2[0x1d] == 0 ||
                  (DVar1 = FUN_00432a16(local_8,L"URLInfoAbout",(short *)param_2[0x1d]),
                  -1 < (int)DVar1)))))) &&
               ((param_2[0x1e] == 0 ||
                (DVar1 = FUN_00432a16(local_8,L"URLUpdateInfo",(short *)param_2[0x1e]),
                -1 < (int)DVar1)))) &&
              (((param_2[0x1f] == 0 ||
                ((DVar1 = FUN_00432a16(local_8,L"ParentDisplayName",(short *)param_2[0x1f]),
                 -1 < (int)DVar1 &&
                 (DVar1 = FUN_00432a16(local_8,L"ParentKeyName",(short *)param_2[0x1f]),
                 -1 < (int)DVar1)))) &&
               (((short *)param_2[0x20] == (short *)0x0 ||
                (DVar1 = FUN_00432a16(local_8,L"Comments",(short *)param_2[0x20]), -1 < (int)DVar1))
               )))) && (((short *)param_2[0x21] == (short *)0x0 ||
                        (DVar1 = FUN_00432a16(local_8,L"Contact",(short *)param_2[0x21]),
                        -1 < (int)DVar1)))) {
            if (param_2[0x22] == 1) {
              DVar1 = FUN_004329c8(local_8,L"NoModify");
joined_r0x0040b167:
              if ((int)DVar1 < 0) goto LAB_0040b2b3;
            }
            else if (param_2[0x22] != 2) {
              DVar1 = FUN_00432bf4(local_8,L"ModifyPath",L"\"%ls\" /modify");
              if ((int)DVar1 < 0) goto LAB_0040b2b3;
              DVar1 = FUN_004329c8(local_8,L"NoElevateOnModify");
              goto joined_r0x0040b167;
            }
            if ((((param_2[0x23] == 0) ||
                 (DVar1 = FUN_004329c8(local_8,L"NoRemove"), -1 < (int)DVar1)) &&
                ((param_2[1] != 0 ||
                 (DVar1 = FUN_004329c8(local_8,L"SystemComponent"), -1 < (int)DVar1)))) &&
               ((DVar1 = FUN_00432bf4(local_8,L"QuietUninstallString",L"\"%ls\" /uninstall /quiet"),
                -1 < (int)DVar1 &&
                (DVar1 = FUN_00432bf4(local_8,L"UninstallString",L"\"%ls\" %ls"), -1 < (int)DVar1)))
               ) {
              if ((param_2[0x26] == 0) ||
                 (DVar1 = FUN_0040a284(*param_2,param_2 + 0x25), -1 < (int)DVar1)) {
                if ((param_2[0x27] == 0) ||
                   (DVar1 = FUN_0040a3b1((int)param_2,param_3), -1 < (int)DVar1)) goto LAB_0040b26e;
                pcVar3 = "Failed to write update registration.";
              }
              else {
                pcVar3 = "Failed to write software tags.";
              }
              goto LAB_0040b2f3;
            }
          }
        }
LAB_0040b2b3:
        pcVar3 = "Failed to write %ls value.";
        goto LAB_0040b2b8;
      }
LAB_0040b26e:
      if ((param_5 & 4) != 0) {
        if (((param_8 >> 10 != 0) || (param_7 >> 10 != 0 || (param_8 & 0x3ff) != 0)) &&
           (DVar1 = FUN_004329c8(local_8,L"EstimatedSize"), (int)DVar1 < 0)) goto LAB_0040b2b3;
      }
      if ((param_6 == 1) && (DVar1 = FUN_0041f17c((int)param_2), (int)DVar1 < 0)) {
        pcVar3 = "Failed to register the bundle dependency key.";
      }
      else {
        DVar1 = FUN_0040a0f6((int)param_2,(int)local_8,1,0);
        if (-1 < (int)DVar1) goto LAB_0040b2fb;
        pcVar3 = "Failed to update resume mode.";
      }
    }
LAB_0040b2f3:
    FUN_00430a57(DVar1,pcVar3);
  }
  else {
    pcVar3 = "Failed to cache bundle from path: %ls";
LAB_0040b2b8:
    FUN_00430a57(DVar1,pcVar3);
  }
LAB_0040b2fb:
  if (local_c != (short *)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  return DVar1;
}



/* Function: FUN_0040b31f */

uint FUN_0040b31f(int *param_1,int param_2,int param_3,int param_4)

{
  uint uVar1;
  char *pcVar2;
  LPVOID local_10;
  HKEY local_c;
  HKEY local_8;
  
  local_10 = (LPVOID)0x0;
  local_c = (HKEY)0x0;
  local_8 = (HKEY)0x0;
  if (param_3 != 0) {
    uVar1 = FUN_00433cea((int *)&local_10,L"%ls.RebootRequired");
    if (-1 < (int)uVar1) {
      uVar1 = FUN_00432176(param_1[0x13],local_10,0x20006,1,0,&local_c,(uint *)0x0);
      if (-1 < (int)uVar1) goto LAB_0040b37d;
    }
    FUN_00430a57(uVar1,"Failed to write volatile reboot required registry key.");
  }
LAB_0040b37d:
  if (param_2 == 0) {
    if ((param_4 == 1) || (param_4 == 2)) {
      FUN_0041f233((int)param_1);
    }
    if (param_1[0x27] != 0) {
      FUN_00409fd3((int)param_1);
    }
    FUN_00409edf(*param_1,param_1 + 0x25);
    uVar1 = FUN_004321e8(param_1[0x13],(LPCWSTR)param_1[0x14],0,0);
    if ((uVar1 != 0x80070002) && ((int)uVar1 < 0)) {
      FUN_00430a57(uVar1,"Failed to delete registration key: %ls");
      goto LAB_0040b415;
    }
    FUN_00413f05(*param_1,param_1[3]);
LAB_0040b3ec:
    uVar1 = FUN_0040a0f6((int)param_1,(int)local_8,param_2,(uint)(param_3 == 2));
    if (-1 < (int)uVar1) goto LAB_0040b415;
    pcVar2 = "Failed to update resume mode.";
  }
  else {
    uVar1 = FUN_004324d5(param_1[0x13],param_1[0x14],0x20006,&local_8);
    if (-1 < (int)uVar1) goto LAB_0040b3ec;
    pcVar2 = "Failed to open registration key.";
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_0040b415:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_c != (HKEY)0x0) {
    RegCloseKey(local_c);
    local_c = (HKEY)0x0;
  }
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  return uVar1;
}



/* Function: FUN_0040b468 */

uint FUN_0040b468(int param_1)

{
  uint uVar1;
  char *pcVar2;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  uVar1 = FUN_004324d5(*(undefined4 *)(param_1 + 0x4c),*(undefined4 *)(param_1 + 0x50),0x20006,
                       &local_8);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to open registration key.";
  }
  else {
    uVar1 = FUN_0040a0f6(param_1,(int)local_8,1,0);
    if (-1 < (int)uVar1) goto LAB_0040b4b6;
    pcVar2 = "Failed to update resume mode.";
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_0040b4b6:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  return uVar1;
}



/* Function: FUN_0040b4cd */

DWORD FUN_0040b4cd(int param_1,LPCRITICAL_SECTION param_2)

{
  short *psVar1;
  DWORD DVar2;
  char *pcVar3;
  LPVOID local_8;
  
  local_8 = (LPVOID)0x0;
  if ((*(int *)(param_1 + 8) == 0) ||
     (DVar2 = FUN_004045df(param_2,L"WixBundleInstalled",1,0,1), -1 < (int)DVar2)) {
    DVar2 = FUN_004099cc(param_1,param_2,(int *)&local_8);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to intitialize bundle name.";
    }
    else {
      psVar1 = *(short **)(param_1 + 0x68);
      if (((psVar1 == (short *)0x0) || (*psVar1 == 0)) ||
         (DVar2 = FUN_0040461f(param_2,L"WixBundleManufacturer",(int)psVar1,1), -1 < (int)DVar2)) {
        psVar1 = *(short **)(param_1 + 0x40);
        if (((psVar1 == (short *)0x0) || (*psVar1 == 0)) ||
           (DVar2 = FUN_0040461f(param_2,L"WixBundleActiveParent",(int)psVar1,1), -1 < (int)DVar2))
        {
          DVar2 = FUN_0040461f(param_2,L"WixBundleProviderKey",*(int *)(param_1 + 0x44),1);
          if ((int)DVar2 < 0) {
            pcVar3 = "Failed to overwrite the bundle provider key built-in variable.";
          }
          else {
            DVar2 = FUN_0040461f(param_2,L"WixBundleTag",*(int *)(param_1 + 0x10),1);
            if ((-1 < (int)DVar2) &&
               (DVar2 = FUN_0040467b(param_2,L"WixBundleVersion",*(int *)(param_1 + 0x38),
                                     *(undefined4 *)(param_1 + 0x3c),1), -1 < (int)DVar2))
            goto LAB_0040b5ca;
            pcVar3 = "Failed to overwrite the bundle tag built-in variable.";
          }
        }
        else {
          pcVar3 = "Failed to overwrite the bundle active parent built-in variable.";
        }
      }
      else {
        pcVar3 = "Failed to overwrite the bundle manufacturer built-in variable.";
      }
    }
  }
  else {
    pcVar3 = "Failed to set the bundle installed built-in variable.";
  }
  FUN_00430a57(DVar2,pcVar3);
LAB_0040b5ca:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar2;
}



/* Function: FUN_0040b5e1 */

void FUN_0040b5e1(uint *param_1)

{
  LPVOID pvVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  
  if (param_1[3] != 0) {
    FUN_004380ab((LPVOID)param_1[3]);
  }
  if (param_1[4] != 0) {
    FUN_004380ab((LPVOID)param_1[4]);
  }
  uVar2 = 0;
  uVar3 = 0;
  if (param_1[6] != 0) {
    do {
      if (*(int *)(param_1[5] + uVar3 * 4) != 0) {
        FUN_004380ab(*(LPVOID *)(param_1[5] + uVar3 * 4));
      }
      uVar3 = uVar3 + 1;
    } while (uVar3 < param_1[6]);
  }
  if (param_1[5] != 0) {
    FUN_00431137((LPVOID)param_1[5]);
  }
  uVar3 = 0;
  if (param_1[8] != 0) {
    do {
      if (*(int *)(param_1[7] + uVar3 * 4) != 0) {
        FUN_004380ab(*(LPVOID *)(param_1[7] + uVar3 * 4));
      }
      uVar3 = uVar3 + 1;
    } while (uVar3 < param_1[8]);
  }
  if (param_1[7] != 0) {
    FUN_00431137((LPVOID)param_1[7]);
  }
  uVar3 = 0;
  if (param_1[10] != 0) {
    do {
      if (*(int *)(param_1[9] + uVar3 * 4) != 0) {
        FUN_004380ab(*(LPVOID *)(param_1[9] + uVar3 * 4));
      }
      uVar3 = uVar3 + 1;
    } while (uVar3 < param_1[10]);
  }
  if (param_1[9] != 0) {
    FUN_00431137((LPVOID)param_1[9]);
  }
  uVar3 = 0;
  if (param_1[0xc] != 0) {
    do {
      if (*(int *)(param_1[0xb] + uVar3 * 4) != 0) {
        FUN_004380ab(*(LPVOID *)(param_1[0xb] + uVar3 * 4));
      }
      uVar3 = uVar3 + 1;
    } while (uVar3 < param_1[0xc]);
  }
  if (param_1[0xb] != 0) {
    FUN_00431137((LPVOID)param_1[0xb]);
  }
  if (param_1[0x11] != 0) {
    FUN_004380ab((LPVOID)param_1[0x11]);
  }
  if (param_1[0x10] != 0) {
    FUN_004380ab((LPVOID)param_1[0x10]);
  }
  if (param_1[0x12] != 0) {
    FUN_004380ab((LPVOID)param_1[0x12]);
  }
  if (param_1[0x14] != 0) {
    FUN_004380ab((LPVOID)param_1[0x14]);
  }
  if (param_1[0x15] != 0) {
    FUN_004380ab((LPVOID)param_1[0x15]);
  }
  if (param_1[0x16] != 0) {
    FUN_004380ab((LPVOID)param_1[0x16]);
  }
  if (param_1[0x17] != 0) {
    FUN_004380ab((LPVOID)param_1[0x17]);
  }
  if (param_1[0x18] != 0) {
    FUN_004380ab((LPVOID)param_1[0x18]);
  }
  if (param_1[0x19] != 0) {
    FUN_004380ab((LPVOID)param_1[0x19]);
  }
  if (param_1[0x1a] != 0) {
    FUN_004380ab((LPVOID)param_1[0x1a]);
  }
  if (param_1[0x1b] != 0) {
    FUN_004380ab((LPVOID)param_1[0x1b]);
  }
  if (param_1[0x1c] != 0) {
    FUN_004380ab((LPVOID)param_1[0x1c]);
  }
  if (param_1[0x1d] != 0) {
    FUN_004380ab((LPVOID)param_1[0x1d]);
  }
  if (param_1[0x1e] != 0) {
    FUN_004380ab((LPVOID)param_1[0x1e]);
  }
  if (param_1[0x1f] != 0) {
    FUN_004380ab((LPVOID)param_1[0x1f]);
  }
  if ((LPVOID)param_1[0x20] != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x20]);
  }
  if ((LPVOID)param_1[0x21] != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x21]);
  }
  if ((LPVOID)param_1[0x28] != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x28]);
  }
  if ((LPVOID)param_1[0x29] != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x29]);
  }
  if ((LPVOID)param_1[0x2a] != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x2a]);
  }
  if ((LPVOID)param_1[0x2b] != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x2b]);
  }
  if ((LPVOID)param_1[0x2c] != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x2c]);
  }
  if (param_1[0x25] != 0) {
    if (param_1[0x26] != 0) {
      iVar4 = 0;
      do {
        if (*(int *)(iVar4 + param_1[0x25]) != 0) {
          FUN_004380ab(*(LPVOID *)(iVar4 + param_1[0x25]));
        }
        pvVar1 = *(LPVOID *)(iVar4 + 4 + param_1[0x25]);
        if (pvVar1 != (LPVOID)0x0) {
          FUN_004380ab(pvVar1);
        }
        pvVar1 = *(LPVOID *)(iVar4 + 8 + param_1[0x25]);
        if (pvVar1 != (LPVOID)0x0) {
          FUN_004380ab(pvVar1);
        }
        uVar2 = uVar2 + 1;
        iVar4 = iVar4 + 0xc;
      } while (uVar2 < param_1[0x26]);
    }
    FUN_00431137((LPVOID)param_1[0x25]);
  }
  if ((LPVOID)param_1[0x2f] != (LPVOID)0x0) {
    FUN_004380ab((LPVOID)param_1[0x2f]);
  }
  FUN_0041fa79((int *)(param_1 + 0x2d));
  FUN_004267c0(param_1,0,0x198);
  return;
}



/* Function: FUN_0040b87c */

int FUN_0040b87c(int param_1,int param_2,undefined4 *param_3,int *param_4)

{
  int iVar1;
  char *pcVar2;
  undefined4 *local_c;
  LPVOID local_8;
  
  local_8 = (LPVOID)0x0;
  local_c = (undefined4 *)0x0;
  iVar1 = FUN_004132c1(*(undefined4 *)(param_1 + 4),param_2,(int *)&local_8);
  if (iVar1 < 0) {
    pcVar2 = "Failed to calculate unverified path for container.";
  }
  else {
    iVar1 = FUN_0040bd21(param_1,(int *)&local_c);
    if (-1 < iVar1) {
      *local_c = 7;
      local_c[2] = param_2;
      local_c[3] = local_8;
      local_8 = (LPVOID)0x0;
      if (param_3 != (undefined4 *)0x0) {
        *param_3 = local_c;
      }
      if (param_4 == (int *)0x0) {
        return iVar1;
      }
      *param_4 = *(int *)(param_1 + 0x50) + -1;
      goto LAB_0040b8fb;
    }
    pcVar2 = "Failed to append acquire container action to plan.";
  }
  FUN_00430a57(iVar1,pcVar2);
LAB_0040b8fb:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_0040b90e */

DWORD FUN_0040b90e(int param_1,undefined4 *param_2,undefined4 *param_3)

{
  int *piVar1;
  uint *puVar2;
  PCNZWCH lpString2;
  int iVar3;
  uint uVar4;
  int iVar5;
  undefined4 *puVar6;
  int iVar7;
  uint uVar8;
  HANDLE pvVar9;
  DWORD DVar10;
  uint uVar11;
  int iVar12;
  char *pcVar13;
  uint local_c;
  undefined4 *local_8;
  
  iVar5 = param_1;
  lpString2 = (PCNZWCH)*param_2;
  local_8 = (undefined4 *)0x0;
  uVar11 = 0;
  if (*(int *)(param_1 + 0x50) != 0) {
    param_1 = 0;
    do {
      if ((*(int *)(*(int *)(iVar5 + 0x4c) + param_1) == 4) &&
         (iVar7 = CompareStringW(0,0,(PCNZWCH)**(undefined4 **)
                                                (*(int *)(iVar5 + 0x4c) + 8 + param_1),-1,lpString2,
                                 -1), iVar7 == 2)) {
        if (*(uint *)(iVar5 + 0x50) <= uVar11 + 1) {
          return 0;
        }
        if (*(int *)(uVar11 * 0x28 + 0x28 + *(int *)(iVar5 + 0x4c)) != 6) {
          return 0;
        }
        *param_3 = *(undefined4 *)(uVar11 * 0x28 + 0x30 + *(int *)(iVar5 + 0x4c));
        return 0;
      }
      uVar11 = uVar11 + 1;
      param_1 = param_1 + 0x28;
    } while (uVar11 < *(uint *)(iVar5 + 0x50));
  }
  iVar7 = DAT_00456f50 + 1;
  DAT_00456f50 = iVar7;
  uVar11 = FUN_0040bd21(iVar5,(int *)&local_8);
  if ((int)uVar11 < 0) {
LAB_0040b9bd:
    pcVar13 = "Failed to append package start action.";
  }
  else {
    *local_8 = 1;
    local_8[2] = iVar7;
    uVar11 = FUN_0040c0db(iVar5,(int *)&local_8);
    if (-1 < (int)uVar11) {
      *local_8 = 1;
      local_8[2] = iVar7;
      uVar11 = FUN_0040bd21(iVar5,(int *)&local_8);
      if ((int)uVar11 < 0) goto LAB_0040b9bd;
      *local_8 = 3;
      local_8[2] = param_2;
      uVar8 = *(int *)(iVar5 + 0x50) - 1;
      uVar11 = FUN_0040c0db(iVar5,(int *)&local_8);
      if (-1 < (int)uVar11) {
        *local_8 = 5;
        local_8[2] = param_2;
        local_c = 0;
        if (param_2[0x20] != 0) {
          do {
            iVar7 = param_2[0x1f];
            uVar11 = FUN_0040bd6a(iVar5,(int)param_2,uVar8,*(undefined4 **)(iVar7 + local_c * 8),
                                  *(undefined4 **)(iVar7 + 4 + local_c * 8),(LPCWSTR)0x0);
            if ((int)uVar11 < 0) {
              pcVar13 = "Failed to append payload cache action.";
              goto LAB_0040bb2d;
            }
            iVar12 = uVar8 * 0x28;
            piVar1 = (int *)(*(int *)(iVar5 + 0x4c) + 0xc + iVar12);
            *piVar1 = *piVar1 + 1;
            iVar3 = *(int *)(iVar5 + 0x4c);
            iVar7 = *(int *)(iVar7 + local_c * 8);
            uVar4 = *(uint *)(iVar7 + 0x10);
            puVar2 = (uint *)(iVar3 + 0x10 + iVar12);
            uVar11 = *puVar2;
            *puVar2 = *puVar2 + uVar4;
            piVar1 = (int *)(iVar3 + 0x14 + iVar12);
            *piVar1 = *piVar1 + *(int *)(iVar7 + 0x14) + (uint)CARRY4(uVar11,uVar4);
            local_c = local_c + 1;
          } while (local_c < (uint)param_2[0x20]);
        }
        uVar11 = FUN_0040bd21(iVar5,(int *)&local_8);
        if (-1 < (int)uVar11) {
          *local_8 = 4;
          local_8[2] = param_2;
          *(int *)(uVar8 * 0x28 + 0x18 + *(int *)(iVar5 + 0x4c)) = *(int *)(iVar5 + 0x50) + -1;
          uVar11 = FUN_0040bd21(iVar5,(int *)&local_8);
          puVar6 = local_8;
          if (-1 < (int)uVar11) {
            *local_8 = 6;
            pvVar9 = CreateEventW((LPSECURITY_ATTRIBUTES)0x0,1,0,(LPCWSTR)0x0);
            puVar6[2] = pvVar9;
            if (pvVar9 != (HANDLE)0x0) {
              *param_3 = pvVar9;
              *(int *)(iVar5 + 0x34) = *(int *)(iVar5 + 0x34) + 1;
              param_2[0x15] = (uint)(param_2[0x11] != 2);
              return uVar11;
            }
            DVar10 = GetLastError();
            uVar11 = DVar10 & 0xffff | 0x80070000;
            if ((int)DVar10 < 1) {
              uVar11 = DVar10;
            }
            if (-1 < (int)uVar11) {
              uVar11 = 0x80004005;
            }
            FUN_004300d9();
            pcVar13 = "Failed to create syncpoint event.";
            goto LAB_0040bb2d;
          }
        }
        pcVar13 = "Failed to append cache action.";
        goto LAB_0040bb2d;
      }
    }
    pcVar13 = "Failed to append rollback cache action.";
  }
LAB_0040bb2d:
  FUN_00430a57(uVar11,pcVar13);
  return uVar11;
}



/* Function: FUN_0040bb57 */

DWORD FUN_0040bb57(int param_1,int param_2)

{
  DWORD DVar1;
  uint uVar2;
  undefined4 local_8;
  
  DVar1 = 0;
  uVar2 = 0;
  if (*(int *)(param_2 + 0xcc) != 0) {
    do {
      DVar1 = FUN_0040b90e(param_1,*(undefined4 **)(*(int *)(param_2 + 0xc4) + uVar2 * 4),&local_8);
      if ((int)DVar1 < 0) {
        FUN_00430a57(DVar1,"Failed to plan slipstream MSP: %ls");
        return DVar1;
      }
      uVar2 = uVar2 + 1;
    } while (uVar2 < *(uint *)(param_2 + 0xcc));
  }
  return DVar1;
}



/* Function: FUN_0040bbb3 */

int FUN_0040bbb3(int param_1,undefined4 param_2,int param_3,LPCWSTR param_4)

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  undefined4 *puVar5;
  char *pcVar6;
  
  iVar4 = FUN_0043109a((int *)(param_1 + 0x20),*(int *)(param_1 + 0x24) + 1,0xc,5);
  if (iVar4 < 0) {
    pcVar6 = "Failed to grow list of payloads to extract from container.";
  }
  else {
    puVar5 = (undefined4 *)(*(int *)(param_1 + 0x24) * 0xc + *(int *)(param_1 + 0x20));
    *puVar5 = param_2;
    puVar5[1] = param_3;
    iVar4 = FUN_00433f88(puVar5 + 2,param_4,0);
    if (-1 < iVar4) {
      *(int *)(param_1 + 0x24) = *(int *)(param_1 + 0x24) + 1;
      uVar3 = *(uint *)(param_3 + 0x10);
      puVar1 = (uint *)(param_1 + 0x10);
      uVar2 = *puVar1;
      *puVar1 = *puVar1 + uVar3;
      *(int *)(param_1 + 0x14) =
           *(int *)(param_1 + 0x14) + *(int *)(param_3 + 0x14) + (uint)CARRY4(uVar2,uVar3);
      return iVar4;
    }
    pcVar6 = "Failed to copy unverified path for payload to extract.";
  }
  FUN_00430a57(iVar4,pcVar6);
  return iVar4;
}



/* Function: FUN_0040bc29 */

int FUN_0040bc29(int param_1,int param_2,LPCWSTR param_3,LPCWSTR param_4)

{
  int iVar1;
  int *piVar2;
  char *pcVar3;
  
  iVar1 = FUN_0043109a((int *)(param_1 + 0x3c),*(int *)(param_1 + 0x40) + 1,0xc,5);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to grow plan\'s array of registration actions.");
    return iVar1;
  }
  piVar2 = (int *)(*(int *)(param_1 + 0x40) * 0xc + *(int *)(param_1 + 0x3c));
  *(int *)(param_1 + 0x40) = *(int *)(param_1 + 0x40) + 1;
  *piVar2 = param_2;
  iVar1 = FUN_00433f88(piVar2 + 1,param_4,0);
  if (-1 < iVar1) {
    iVar1 = FUN_00433f88(piVar2 + 2,param_3,0);
    if (iVar1 < 0) {
      pcVar3 = "Failed to copy dependent provider key to registration action.";
      goto LAB_0040bd10;
    }
    iVar1 = FUN_0043109a((int *)(param_1 + 0x44),*(int *)(param_1 + 0x48) + 1,0xc,5);
    if (iVar1 < 0) {
      pcVar3 = "Failed to grow plan\'s array of rollback registration actions.";
      goto LAB_0040bd10;
    }
    piVar2 = (int *)(*(int *)(param_1 + 0x48) * 0xc + *(int *)(param_1 + 0x44));
    *(int *)(param_1 + 0x48) = *(int *)(param_1 + 0x48) + 1;
    *piVar2 = (param_2 == 1) + 1;
    iVar1 = FUN_00433f88(piVar2 + 1,param_4,0);
    if (-1 < iVar1) {
      iVar1 = FUN_00433f88(piVar2 + 2,param_3,0);
      if (-1 < iVar1) {
        return iVar1;
      }
      pcVar3 = "Failed to copy dependent provider key to rollback registration action.";
      goto LAB_0040bd10;
    }
  }
  pcVar3 = "Failed to copy owner bundle to registration action.";
LAB_0040bd10:
  FUN_00430a57(iVar1,pcVar3);
  return iVar1;
}



/* Function: FUN_0040bd21 */

int FUN_0040bd21(int param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_0043109a((int *)(param_1 + 0x4c),*(int *)(param_1 + 0x50) + 1,0x28,5);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to grow plan\'s array of cache actions.");
  }
  else {
    *param_2 = *(int *)(param_1 + 0x50) * 0x28 + *(int *)(param_1 + 0x4c);
    *(int *)(param_1 + 0x50) = *(int *)(param_1 + 0x50) + 1;
  }
  return iVar1;
}



/* Function: FUN_0040bd6a */

DWORD FUN_0040bd6a(int param_1,int param_2,uint param_3,undefined4 *param_4,undefined4 *param_5,
                  LPCWSTR param_6)

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  DWORD DVar5;
  int iVar6;
  undefined4 *puVar7;
  int *piVar8;
  undefined4 *puVar9;
  char *pcVar10;
  undefined4 *local_10;
  int *local_c;
  LPCWSTR local_8;
  
  puVar9 = param_4;
  iVar4 = param_1;
  local_8 = (LPCWSTR)0x0;
  local_c = (int *)0x0;
  local_10 = (undefined4 *)0x80000000;
  DVar5 = FUN_004133cf(*(undefined4 *)(param_1 + 4),param_4,(int *)&local_8);
  if ((int)DVar5 < 0) {
    pcVar10 = "Failed to calculate unverified path for payload.";
    goto LAB_0040bf77;
  }
  if (puVar9[0xf] == 0) {
    piVar8 = FUN_0040c6ee(iVar4,(int)puVar9);
    if (piVar8 == (int *)0x0) {
      local_c = piVar8;
      DVar5 = FUN_0040bd21(iVar4,(int *)&local_c);
      piVar8 = local_c;
      if ((int)DVar5 < 0) {
        pcVar10 = "Failed to append cache action to acquire payload.";
      }
      else {
        *local_c = 10;
        local_c[1] = (int)param_5;
        local_c[2] = param_2;
        local_c[3] = (int)param_4;
        DVar5 = FUN_00433f88(local_c + 4,local_8,0);
        if (-1 < (int)DVar5) goto LAB_0040bf03;
        pcVar10 = "Failed to copy unverified path for payload to acquire.";
      }
      goto LAB_0040bf77;
    }
LAB_0040bf03:
    param_5 = (undefined4 *)(((int)piVar8 - *(int *)(iVar4 + 0x4c)) / 0x28);
    local_c = (int *)0x0;
    puVar9 = param_4;
LAB_0040bf18:
    DVar5 = FUN_0040bd21(iVar4,(int *)&local_c);
    if (-1 < (int)DVar5) {
      if (param_6 == (LPCWSTR)0x0) {
        *local_c = 0xb;
        local_c[2] = param_2;
        local_c[3] = (int)puVar9;
        local_c[7] = 1;
        local_c[4] = (int)param_5;
        local_c[6] = (int)local_8;
      }
      else {
        DVar5 = FUN_00433f88(local_c + 6,param_6,0);
        if ((int)DVar5 < 0) {
          pcVar10 = "Failed to copy layout directory into plan.";
          goto LAB_0040bf77;
        }
        *local_c = 0xc;
        local_c[2] = param_2;
        local_c[3] = (int)puVar9;
        local_c[8] = 1;
        local_c[4] = (int)param_5;
        local_c[7] = (int)local_8;
      }
      uVar3 = puVar9[4];
      local_8 = (LPCWSTR)0x0;
      puVar1 = (uint *)(iVar4 + 0x20);
      uVar2 = *puVar1;
      *puVar1 = *puVar1 + uVar3;
      *(int *)(iVar4 + 0x24) = *(int *)(iVar4 + 0x24) + puVar9[5] + (uint)CARRY4(uVar2,uVar3);
      goto LAB_0040bfb5;
    }
    pcVar10 = "Failed to append cache action to cache payload.";
  }
  else {
    param_4 = (undefined4 *)0x0;
    param_1 = 0;
    if (param_5 == (undefined4 *)0x0) {
      iVar6 = FUN_0040c3ae(8,iVar4,puVar9[0xf],0,param_3,&param_4,(uint *)0x0);
      if (iVar6 != 0) {
        DVar5 = FUN_0040bbb3((int)param_4,param_2,(int)puVar9,local_8);
        if ((int)DVar5 < 0) {
          pcVar10 = "Failed to add extract payload action to previous package.";
          goto LAB_0040bf77;
        }
      }
    }
    iVar6 = FUN_0040c3ae(8,iVar4,puVar9[0xf],param_3,0x80000000,&param_1,(uint *)&local_10);
    if (iVar6 == 0) {
      puVar7 = param_5;
      if (param_4 != (undefined4 *)0x0) {
        puVar7 = (undefined4 *)0x1;
      }
      DVar5 = FUN_0040c124(iVar4,puVar9[0xf],param_3,(int)puVar7,&param_1,(uint *)&local_10);
      if (-1 < (int)DVar5) {
        param_5 = local_10;
        goto LAB_0040be84;
      }
      pcVar10 = "Failed to create container extract action.";
    }
    else {
      param_4 = (undefined4 *)0x80000000;
      param_5 = local_10;
      iVar6 = FUN_0040c3ae(7,iVar4,puVar9[0xf],param_3,(uint)local_10,(undefined4 *)0x0,
                           (uint *)&param_4);
      if (iVar6 != 0) {
        param_5 = param_4;
      }
      if ((int)DVar5 < 0) {
        pcVar10 = "Failed while searching for package\'s container extract action.";
      }
      else {
LAB_0040be84:
        DVar5 = FUN_0040bbb3(param_1,param_2,(int)puVar9,local_8);
        if (-1 < (int)DVar5) goto LAB_0040bf18;
        pcVar10 = "Failed to add extract payload to current package.";
      }
    }
  }
LAB_0040bf77:
  FUN_00430a57(DVar5,pcVar10);
LAB_0040bfb5:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar5;
}



/* Function: FUN_0040bfcc */

int FUN_0040bfcc(int param_1,undefined4 param_2,uint param_3,int param_4,int param_5,LPCWSTR param_6
                )

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  char *pcVar6;
  int local_14;
  int local_10;
  undefined4 *local_c;
  LPVOID local_8;
  
  iVar5 = 0;
  local_10 = 0;
  local_14 = -0x80000000;
  local_8 = (LPVOID)0x0;
  local_c = (undefined4 *)0x0;
  if (param_5 != 0) {
    return 0;
  }
  if (*(int *)(param_4 + 0xc) != 0) {
    return 0;
  }
  iVar4 = FUN_0040c3ae(7,param_1,param_4,0,param_3,(undefined4 *)0x0,(uint *)0x0);
  if (iVar4 == 0) {
    iVar5 = FUN_0040b87c(param_1,param_4,&local_10,&local_14);
    if (iVar5 < 0) {
      pcVar6 = "Failed to append acquire container action for layout to plan.";
    }
    else {
      iVar5 = FUN_00433f88((int *)&local_8,*(LPCWSTR *)(local_10 + 0xc),0);
      if (iVar5 < 0) {
        pcVar6 = "Failed to copy container working path for layout.";
      }
      else {
        iVar5 = FUN_0040bd21(param_1,(int *)&local_c);
        if (iVar5 < 0) {
          pcVar6 = "Failed to append cache action to cache payload.";
        }
        else {
          iVar5 = FUN_00433f88(local_c + 6,param_6,0);
          if (-1 < iVar5) {
            *local_c = 9;
            local_c[2] = param_2;
            local_c[3] = param_4;
            local_c[8] = 1;
            local_c[4] = local_14;
            local_c[7] = local_8;
            uVar3 = *(uint *)(param_4 + 0x18);
            local_8 = (LPVOID)0x0;
            puVar1 = (uint *)(param_1 + 0x20);
            uVar2 = *puVar1;
            *puVar1 = *puVar1 + uVar3;
            *(int *)(param_1 + 0x24) =
                 *(int *)(param_1 + 0x24) + *(int *)(param_4 + 0x1c) + (uint)CARRY4(uVar2,uVar3);
            goto LAB_0040c0c4;
          }
          pcVar6 = "Failed to copy layout directory into plan.";
        }
      }
    }
    FUN_00430a57(iVar5,pcVar6);
  }
LAB_0040c0c4:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar5;
}



/* Function: FUN_0040c0db */

int FUN_0040c0db(int param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_0043109a((int *)(param_1 + 0x54),*(int *)(param_1 + 0x58) + 1,0x28,5);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to grow plan\'s array of rollback cache actions.");
  }
  else {
    *param_2 = *(int *)(param_1 + 0x58) * 0x28 + *(int *)(param_1 + 0x54);
    *(int *)(param_1 + 0x58) = *(int *)(param_1 + 0x58) + 1;
  }
  return iVar1;
}



/* Function: FUN_0040c124 */

DWORD FUN_0040c124(int param_1,int param_2,uint param_3,int param_4,undefined4 *param_5,
                  uint *param_6)

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  uint uVar6;
  DWORD DVar7;
  char *pcVar8;
  uint local_14;
  undefined4 *local_10;
  LPVOID local_c;
  uint local_8;
  
  iVar4 = param_2;
  DVar7 = 0;
  local_8 = 0x80000000;
  local_10 = (undefined4 *)0x0;
  local_14 = 0x80000000;
  local_c = (LPVOID)0x0;
  if (*(int *)(param_2 + 0x48) == 0) {
    param_2 = 0;
    iVar5 = FUN_0040c3ae(7,param_1,iVar4,param_3,0x80000000,&param_2,&local_8);
    if (iVar5 != 0) goto LAB_0040c19c;
    DVar7 = FUN_0040b87c(param_1,iVar4,&param_2,(int *)&local_8);
    if (-1 < (int)DVar7) {
      *(undefined4 *)(param_2 + 4) = 1;
      goto LAB_0040c19c;
    }
    pcVar8 = "Failed to append acquire container action to plan.";
    goto LAB_0040c213;
  }
LAB_0040c19c:
  uVar6 = local_8;
  if (local_8 == 0x80000000) {
    uVar6 = param_3;
  }
  iVar5 = FUN_0040c3ae(8,param_1,iVar4,uVar6,0x80000000,&local_10,&local_14);
  uVar6 = local_14;
  if (iVar5 == 0) {
    if (*(int *)(iVar4 + 0x48) == 0) {
      DVar7 = FUN_00433f88((int *)&local_c,
                           *(LPCWSTR *)(*(int *)(param_1 + 0x4c) + 0xc + local_8 * 0x28),0);
      if (-1 < (int)DVar7) goto LAB_0040c1fe;
      pcVar8 = "Failed to copy container unverified path for cache action to extract container.";
    }
    else {
      DVar7 = FUN_00431c19((int *)&local_c,(HMODULE)0x0);
      if ((int)DVar7 < 0) {
        pcVar8 = "Failed to get path for executing module as attached container working path.";
      }
      else {
LAB_0040c1fe:
        DVar7 = FUN_0040bd21(param_1,(int *)&local_10);
        if (-1 < (int)DVar7) {
          iVar5 = *(int *)(param_1 + 0x50);
          *local_10 = 8;
          local_10[1] = *(undefined4 *)(iVar4 + 0x48);
          local_10[2] = iVar4;
          local_10[6] = local_8;
          local_10[7] = local_c;
          local_c = (LPVOID)0x0;
          uVar6 = iVar5 - 1;
          goto LAB_0040c24b;
        }
        pcVar8 = "Failed to append cache action to extract payloads from container.";
      }
    }
LAB_0040c213:
    FUN_00430a57(DVar7,pcVar8);
  }
  else {
LAB_0040c24b:
    if (local_8 != 0x80000000) {
      uVar6 = local_8;
    }
    iVar5 = uVar6 * 0x28 + *(int *)(param_1 + 0x4c);
    if (((*(int *)(iVar5 + 4) != 0) && (param_4 == 0)) &&
       (*(undefined4 *)(iVar5 + 4) = 0, *(int *)(iVar4 + 0x48) == 0)) {
      uVar3 = *(uint *)(iVar4 + 0x18);
      puVar1 = (uint *)(param_1 + 0x20);
      uVar2 = *puVar1;
      *puVar1 = *puVar1 + uVar3;
      *(int *)(param_1 + 0x24) =
           *(int *)(param_1 + 0x24) + *(int *)(iVar4 + 0x1c) + (uint)CARRY4(uVar2,uVar3);
    }
    *param_5 = local_10;
    *param_6 = uVar6;
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar7;
}



/* Function: FUN_0040c2a1 */

undefined4 FUN_0040c2a1(int param_1,int param_2,uint param_3)

{
  int iVar1;
  int iVar2;
  undefined4 uVar3;
  int iVar4;
  uint uVar5;
  uint uVar6;
  int *piVar7;
  uint local_8;
  
  local_8 = 0;
  if (param_3 != 0) {
    piVar7 = (int *)(param_2 + 0x18);
    do {
      uVar5 = 0;
      if ((piVar7[-6] == 5) && (iVar1 = piVar7[-4], *(int *)(iVar1 + 0xcc) != 0)) {
        iVar2 = FUN_00431078(*(int *)(iVar1 + 0xcc) << 2,1);
        piVar7[2] = iVar2;
        if (iVar2 == 0) {
          FUN_004300d9();
          FUN_00430a57(0x8007000e,"Failed to allocate memory for patch actions.");
          return 0x8007000e;
        }
        if (((*piVar7 != 5) && (*piVar7 != 1)) && (*(int *)(iVar1 + 0xcc) != 0)) {
          do {
            iVar2 = *(int *)(*(int *)(iVar1 + 0xc4) + uVar5 * 4);
            if (param_1 == 0) {
              uVar3 = *(undefined4 *)(iVar2 + 0x60);
            }
            else {
              uVar3 = *(undefined4 *)(iVar2 + 0x5c);
            }
            *(undefined4 *)(piVar7[2] + uVar5 * 4) = uVar3;
            if (*(uint *)(iVar2 + 0xa8) != 0) {
              iVar4 = *(int *)(iVar2 + 0xa4);
              uVar6 = 0;
              do {
                if (iVar1 == *(int *)(iVar4 + 0x58)) {
                  if (param_1 == 0) {
                    uVar3 = *(undefined4 *)(iVar4 + 0x68);
                  }
                  else {
                    uVar3 = *(undefined4 *)(iVar4 + 100);
                  }
                  *(undefined4 *)(piVar7[2] + uVar5 * 4) = uVar3;
                  break;
                }
                uVar6 = uVar6 + 1;
                iVar4 = iVar4 + 0x6c;
              } while (uVar6 < *(uint *)(iVar2 + 0xa8));
            }
            uVar5 = uVar5 + 1;
          } while (uVar5 < *(uint *)(iVar1 + 0xcc));
        }
      }
      local_8 = local_8 + 1;
      piVar7 = piVar7 + 0xc;
    } while (local_8 < param_3);
  }
  return 0;
}



/* Function: FUN_0040c3ae */

undefined4
FUN_0040c3ae(int param_1,int param_2,int param_3,uint param_4,uint param_5,undefined4 *param_6,
            uint *param_7)

{
  int *piVar1;
  
  if (param_4 == 0x80000000) {
    param_4 = 0;
  }
  if (param_5 == 0x80000000) {
    param_5 = *(uint *)(param_2 + 0x50);
  }
  if (param_4 < param_5) {
    piVar1 = (int *)(param_4 * 0x28 + *(int *)(param_2 + 0x4c));
    do {
      if ((*piVar1 == param_1) &&
         (((*piVar1 == 7 && (piVar1[2] == param_3)) || ((*piVar1 == 8 && (piVar1[2] == param_3))))))
      {
        if (param_6 != (undefined4 *)0x0) {
          *param_6 = piVar1;
        }
        if (param_7 != (uint *)0x0) {
          *param_7 = param_4;
        }
        return 1;
      }
      param_4 = param_4 + 1;
      piVar1 = piVar1 + 10;
    } while (param_4 < param_5);
  }
  return 0;
}



/* Function: FUN_0040c424 */

undefined4 FUN_0040c424(int param_1,int param_2,int param_3,undefined4 *param_4)

{
  undefined4 uVar1;
  
  if (param_1 == 3) {
    uVar1 = 2;
    if (param_2 != 0) {
      uVar1 = 0;
    }
    *param_4 = uVar1;
    return 0;
  }
  if (param_1 != 4) {
    if (param_1 == 5) {
      if (param_3 == 2) {
        *param_4 = 2;
        return 0;
      }
      if (param_3 == 3) {
        *param_4 = 3;
        return 0;
      }
      if (param_3 != 4) {
        *param_4 = 0;
        return 0;
      }
    }
    else {
      if (param_1 == 6) {
        *param_4 = 5;
        return 0;
      }
      if ((param_1 != 7) && (param_1 != 8)) {
        FUN_004300d9();
        FUN_00430a57(0x80070057,"Invalid action state.");
        return 0x80070057;
      }
    }
  }
  *param_4 = 4;
  return 0;
}



/* Function: FUN_0040c4b9 */

DWORD FUN_0040c4b9(uint param_1,int param_2,uint *param_3,undefined4 *param_4,int param_5,
                  LPCRITICAL_SECTION param_6,int param_7,int param_8,LPCWSTR param_9,uint *param_10,
                  int *param_11,int *param_12)

{
  uint uVar1;
  int iVar2;
  char *pcVar3;
  
  uVar1 = FUN_0040cabe(param_4[0x23],param_4[0x10],(uint)(param_4[6] == 0),*param_3,(uint)param_6,
                       (short *)param_4[3],param_8,param_4 + 0x13);
  if ((int)uVar1 < 0) {
    pcVar3 = "Failed to set default package state.";
  }
  else {
    param_4[0x14] = param_4[0x13];
    iVar2 = (**(code **)(**(int **)(param_2 + 0x10) + 0x4c))
                      (*(int **)(param_2 + 0x10),*param_4,param_4 + 0x14);
    uVar1 = FUN_00408843(param_2,1,iVar2);
    if ((int)uVar1 < 0) {
      FUN_004300d9();
      pcVar3 = "UX aborted plan package begin.";
    }
    else {
      if (*param_3 == 3) {
        iVar2 = param_4[0xf];
      }
      else {
        iVar2 = param_4[0xe];
      }
      uVar1 = FUN_0040c69a((int)param_3,iVar2,param_11);
      if ((int)uVar1 < 0) {
        pcVar3 = "Failed to process package rollback boundary.";
      }
      else if (param_4[0x14] == 0) {
        if (*param_3 != 2) {
          uVar1 = FUN_0041ee25(param_1,(uint)param_4,(int *)param_3);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to begin plan dependency actions for package: %ls";
          }
          else {
            uVar1 = FUN_0041ed32((uint *)0x0,(int)param_4,(int)param_3);
            if ((int)uVar1 < 0) {
              pcVar3 = "Failed to plan package dependency actions.";
              goto LAB_0040c617;
            }
            uVar1 = FUN_0041f0a2((int)param_4,(int *)param_3);
            if (-1 < (int)uVar1) goto LAB_0040c5f4;
            pcVar3 = "Failed to complete plan dependency actions for package: %ls";
          }
          FUN_00430a57(uVar1,pcVar3);
          goto LAB_0040c61f;
        }
LAB_0040c5f4:
        if (((param_4[0x17] == 0) && (param_4[0x18] == 0)) && (param_4[0x1b] == 0))
        goto LAB_0040c61f;
        uVar1 = FUN_0040dd6d((int)param_3);
        if (-1 < (int)uVar1) goto LAB_0040c61f;
        pcVar3 = "Failed to append execute checkpoint.";
      }
      else if (*param_3 == 2) {
        uVar1 = FUN_0040d1ab((uint)param_3,(int)param_4,param_9);
        if (-1 < (int)uVar1) goto LAB_0040c5f4;
        pcVar3 = "Failed to plan layout package.";
      }
      else {
        if (((param_4[6] != 0) && (param_12 != (int *)0x0)) && (param_12[1] == -0x80000000)) {
          param_12[1] = param_3[0x1a];
        }
        uVar1 = FUN_0040cc1d(param_1,param_7,param_2,param_3,param_4,param_5,param_6,param_10);
        if (-1 < (int)uVar1) {
          if ((param_4[6] != 0) && (param_12 != (int *)0x0)) {
            if (*param_12 == -0x80000000) {
              *param_12 = param_3[0x18] - 1;
            }
            param_12[2] = param_3[0x18];
            param_12[3] = param_3[0x1a];
          }
          goto LAB_0040c5f4;
        }
        pcVar3 = "Failed to plan execute package.";
      }
    }
  }
LAB_0040c617:
  FUN_00430a57(uVar1,pcVar3);
LAB_0040c61f:
  (**(code **)(**(int **)(param_2 + 0x10) + 0x58))
            (*(int **)(param_2 + 0x10),*param_4,uVar1,param_4[0x10],param_4[0x14],param_4[0x17],
             param_4[0x18]);
  return uVar1;
}



/* Function: FUN_0040c69a */

int FUN_0040c69a(int param_1,int param_2,int *param_3)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = 0;
  if (param_2 != 0) {
    if ((*param_3 == 0) || (iVar1 = FUN_0040dd6d(param_1), -1 < iVar1)) {
      iVar1 = FUN_0040dd01(param_1,param_2);
      if (-1 < iVar1) {
        *param_3 = param_2;
        return iVar1;
      }
      pcVar2 = "Failed to plan rollback boundary begin.";
    }
    else {
      pcVar2 = "Failed to plan rollback boundary complete.";
    }
    FUN_00430a57(iVar1,pcVar2);
  }
  return iVar1;
}



/* Function: FUN_0040c6ee */

int * FUN_0040c6ee(int param_1,int param_2)

{
  int *piVar1;
  uint uVar2;
  int *piVar3;
  int *piVar4;
  
  piVar3 = (int *)0x0;
  uVar2 = 0;
  if (*(uint *)(param_1 + 0x50) != 0) {
    piVar1 = *(int **)(param_1 + 0x4c);
    piVar4 = piVar3;
    do {
      if ((*piVar1 != 10) || (piVar3 = piVar1, piVar1[3] != param_2)) {
        if ((*piVar1 == 0xb) && ((piVar1[3] == param_2 && (piVar1[7] != 0)))) {
          piVar1[7] = 0;
          return piVar4;
        }
        piVar3 = piVar4;
        if (((*piVar1 == 0xc) && (piVar1[3] == param_2)) && (piVar1[8] != 0)) {
          piVar1[8] = 0;
          return piVar4;
        }
      }
      uVar2 = uVar2 + 1;
      piVar1 = piVar1 + 10;
      piVar4 = piVar3;
    } while (uVar2 < *(uint *)(param_1 + 0x50));
  }
  return piVar3;
}



/* Function: FUN_0040c751 */

undefined4 FUN_0040c751(int param_1,int param_2,int param_3)

{
  int iVar1;
  int *piVar2;
  DWORD DVar3;
  
  if (param_3 != 0) {
    piVar2 = (int *)(param_2 + 0x10);
    do {
      if ((piVar2[-4] == 6) && (iVar1 = *piVar2, iVar1 != 0)) {
        if (param_1 == 0) {
          iVar1 = *(int *)(iVar1 + 0x60);
        }
        else {
          iVar1 = *(int *)(iVar1 + 0x5c);
        }
        if (iVar1 == 1) {
          FUN_0040e2bb(1);
          FUN_0040e2bb(piVar2[5]);
          DVar3 = 0xa00000cd;
        }
        else {
          if ((((iVar1 < 2) || (piVar2[1] == 0)) || (piVar2[5] < 2)) ||
             ((iVar1 == 5 && (piVar2[5] != 5)))) goto LAB_0040c801;
          FUN_0040e2bb(iVar1);
          FUN_0040e2bb(piVar2[5]);
          DVar3 = 0xa00000ce;
        }
        FUN_00402003(2,DVar3);
        piVar2[-3] = 1;
      }
LAB_0040c801:
      piVar2 = piVar2 + 0xc;
      param_3 = param_3 + -1;
    } while (param_3 != 0);
  }
  return 0;
}



/* Function: FUN_0040c814 */

void FUN_0040c814(int param_1)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  
  *(undefined4 *)(param_1 + 0x48) = 0;
  *(undefined4 *)(param_1 + 0x4c) = 0;
  *(undefined4 *)(param_1 + 0x50) = 0;
  *(undefined4 *)(param_1 + 0x54) = 0;
  *(undefined4 *)(param_1 + 0x58) = 0;
  *(undefined4 *)(param_1 + 0x5c) = 0;
  *(undefined4 *)(param_1 + 0x60) = 0;
  *(undefined4 *)(param_1 + 100) = 0;
  *(undefined4 *)(param_1 + 0x68) = 0;
  *(undefined4 *)(param_1 + 0x6c) = 0;
  *(undefined4 *)(param_1 + 0x70) = 0;
  *(undefined4 *)(param_1 + 0x74) = 0;
  if ((*(int *)(param_1 + 0x8c) == 2) && (*(int *)(param_1 + 0xb4) != 0)) {
    uVar3 = 0;
    if (*(int *)(param_1 + 0xb8) != 0) {
      iVar2 = 0;
      do {
        iVar1 = *(int *)(param_1 + 0xb4);
        uVar3 = uVar3 + 1;
        *(undefined4 *)(iVar1 + 0x20 + iVar2) = 0;
        *(undefined4 *)(iVar1 + 0x24 + iVar2) = 0;
        iVar2 = iVar2 + 0x28;
      } while (uVar3 < *(uint *)(param_1 + 0xb8));
    }
  }
  else if ((*(int *)(param_1 + 0x8c) == 3) &&
          ((*(int *)(param_1 + 0xa4) != 0 && (uVar3 = 0, *(int *)(param_1 + 0xa8) != 0)))) {
    iVar2 = 0;
    do {
      iVar1 = *(int *)(param_1 + 0xa4);
      uVar3 = uVar3 + 1;
      *(undefined4 *)(iVar1 + 100 + iVar2) = 0;
      *(undefined4 *)(iVar1 + 0x68 + iVar2) = 0;
      iVar2 = iVar2 + 0x6c;
    } while (uVar3 < *(uint *)(param_1 + 0xa8));
  }
  return;
}



/* Function: FUN_0040c8b6 */

void FUN_0040c8b6(int *param_1)

{
  int iVar1;
  LPVOID pvVar2;
  
  iVar1 = *param_1;
  if (iVar1 == 2) {
    if (param_1[2] != 0) {
      FUN_004380ab((LPVOID)param_1[2]);
    }
    if (param_1[3] != 0) {
      FUN_004380ab((LPVOID)param_1[3]);
    }
  }
  else {
    if (iVar1 == 6) {
      if (param_1[2] == 0) {
        return;
      }
      CloseHandle((HANDLE)param_1[2]);
      param_1[2] = 0;
      return;
    }
    if (iVar1 == 7) {
      if (param_1[3] == 0) {
        return;
      }
      pvVar2 = (LPVOID)param_1[3];
      goto LAB_0040c942;
    }
    if (iVar1 == 8) {
      if (param_1[7] != 0) {
        FUN_004380ab((LPVOID)param_1[7]);
      }
      if (param_1[8] == 0) {
        return;
      }
      FUN_00431137((LPVOID)param_1[8]);
      return;
    }
    if (iVar1 != 10) {
      if (iVar1 != 0xb) {
        return;
      }
      if (param_1[6] == iVar1 + -0xb) {
        return;
      }
      pvVar2 = (LPVOID)param_1[6];
      goto LAB_0040c942;
    }
  }
  if (param_1[4] == 0) {
    return;
  }
  pvVar2 = (LPVOID)param_1[4];
LAB_0040c942:
  FUN_004380ab(pvVar2);
  return;
}



/* Function: FUN_0040c94c */

void FUN_0040c94c(undefined4 *param_1)

{
  if (param_1[2] != 0) {
    FUN_004380ab((LPVOID)param_1[2]);
  }
  if (param_1[1] != 0) {
    FUN_004380ab((LPVOID)param_1[1]);
  }
  *param_1 = 0;
  param_1[1] = 0;
  param_1[2] = 0;
  return;
}



/* Function: FUN_0040c979 */

int FUN_0040c979(int param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_0043109a((int *)(param_1 + 0x5c),*(int *)(param_1 + 0x60) + 1,0x30,5);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to grow plan\'s array of execute actions.");
  }
  else {
    *param_2 = *(int *)(param_1 + 0x60) * 0x30 + *(int *)(param_1 + 0x5c);
    *(int *)(param_1 + 0x60) = *(int *)(param_1 + 0x60) + 1;
  }
  return iVar1;
}



/* Function: FUN_0040c9c2 */

int FUN_0040c9c2(int param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_0043109a((int *)(param_1 + 100),*(int *)(param_1 + 0x68) + 1,0x30,5);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to grow plan\'s array of rollback actions.");
  }
  else {
    *param_2 = *(int *)(param_1 + 0x68) * 0x30 + *(int *)(param_1 + 100);
    *(int *)(param_1 + 0x68) = *(int *)(param_1 + 0x68) + 1;
  }
  return iVar1;
}



/* Function: FUN_0040ca0b */

int FUN_0040ca0b(int *param_1,int param_2)

{
  int iVar1;
  int iVar2;
  
  iVar2 = 0;
  if ((((*(int *)(param_2 + 0x54) != 0) || (*(int *)(param_2 + 0x44) == 1)) ||
      (*(int *)(param_2 + 0x44) == 2)) &&
     ((((*(int *)(param_2 + 0x20) == 0 ||
        (((iVar1 = *(int *)(param_2 + 0x50), iVar1 == 1 || (iVar1 == 2)) &&
         (*(int *)(param_2 + 0x5c) == 1)))) ||
       (((iVar1 == 1 || (iVar1 == 2)) &&
        ((*(int *)(param_2 + 0x5c) == 0 &&
         ((*(int *)(param_2 + 0x74) == 0 && (*(int *)(param_2 + 0x40) < 4)))))))) ||
      ((*param_1 == 3 &&
       ((((iVar1 == 0 && (*(int *)(param_2 + 0x5c) == 0)) && (*(int *)(param_2 + 0x74) == 0)) &&
        (*(int *)(param_2 + 0x40) < 4)))))))) {
    iVar2 = FUN_0043109a(param_1 + 0x1b,param_1[0x1c] + 1,4,5);
    if (iVar2 < 0) {
      FUN_00430a57(iVar2,"Failed to grow plan\'s array of clean actions.");
    }
    else {
      iVar1 = param_1[0x1c];
      param_1[0x1c] = iVar1 + 1;
      *(int *)(param_1[0x1b] + iVar1 * 4) = param_2;
      *(undefined4 *)(param_2 + 0x58) = 1;
    }
  }
  return iVar2;
}



/* Function: FUN_0040cabe */

DWORD FUN_0040cabe(int param_1,int param_2,int param_3,int param_4,uint param_5,short *param_6,
                  int param_7,undefined4 *param_8)

{
  DWORD DVar1;
  undefined4 uVar2;
  char *pcVar3;
  uint local_c;
  undefined4 local_8;
  
  local_8 = 0;
  local_c = 0;
  if (param_4 == 2) {
    *param_8 = 3;
    return 0;
  }
  if ((param_7 == 4) && (param_1 == 3)) {
    if ((param_2 == 2) && (3 < param_4)) {
      *param_8 = 4;
      return 0;
    }
  }
  else if (param_2 == 5) {
    if (param_4 != 0) {
LAB_0040cb13:
      DVar1 = FUN_0040c424(param_4,param_3,param_2,&local_8);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to get default request state for action.";
      }
      else {
        if (((param_4 == 3) || (param_6 == (short *)0x0)) || (*param_6 == 0)) {
          *param_8 = local_8;
          return DVar1;
        }
        DVar1 = FUN_00405961(param_5,param_6,&local_c);
        if (-1 < (int)DVar1) {
          uVar2 = 2;
          if (local_c != 0) {
            uVar2 = local_8;
          }
          *param_8 = uVar2;
          return DVar1;
        }
        pcVar3 = "Failed to evaluate install condition.";
      }
      FUN_00430a57(DVar1,pcVar3);
      return DVar1;
    }
  }
  else if ((param_2 != 1) || ((param_4 == 3 && (param_1 == 3)))) goto LAB_0040cb13;
  *param_8 = 0;
  return 0;
}



/* Function: FUN_0040cb9c */

int FUN_0040cb9c(int param_1,undefined4 param_2,undefined4 param_3,int param_4)

{
  int iVar1;
  char *pcVar2;
  undefined4 *local_8;
  
  local_8 = (undefined4 *)0x0;
  iVar1 = FUN_0040c979(param_1,(int *)&local_8);
  if (iVar1 < 0) {
    pcVar2 = "Failed to append wait action for caching.";
  }
  else {
    *local_8 = 2;
    local_8[2] = param_3;
    if (param_4 == 0) {
      return iVar1;
    }
    iVar1 = FUN_0040c9c2(param_1,(int *)&local_8);
    if (iVar1 < 0) {
      pcVar2 = "Failed to append rollback action.";
    }
    else {
      *local_8 = 3;
      local_8[2] = param_2;
      iVar1 = FUN_0040dd6d(param_1);
      if (-1 < iVar1) {
        return iVar1;
      }
      pcVar2 = "Failed to append execute checkpoint for cache rollback.";
    }
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0040cc1d */

uint FUN_0040cc1d(uint param_1,int param_2,int param_3,uint *param_4,undefined4 *param_5,int param_6
                 ,LPCRITICAL_SECTION param_7,uint *param_8)

{
  uint *puVar1;
  int iVar2;
  int iVar3;
  uint uVar4;
  DWORD DVar5;
  uint uVar6;
  bool bVar7;
  char *pcVar8;
  
  iVar2 = param_5[0x23];
  if (iVar2 == 1) {
    DVar5 = FUN_0041a116((int)param_5);
  }
  else if (iVar2 == 2) {
    DVar5 = FUN_0041c4f5(param_5,(uint)param_7,param_3);
  }
  else if (iVar2 == 3) {
    DVar5 = FUN_0041d772(param_5,param_3);
  }
  else {
    if (iVar2 != 4) {
      FUN_00430a57(0x8000ffff,"Invalid package type.");
      return 0x8000ffff;
    }
    DVar5 = FUN_0041e0a7((int)param_5);
  }
  if ((int)DVar5 < 0) {
    FUN_00430a57(DVar5,"Failed to calculate plan actions for package: %ls");
    return DVar5;
  }
  uVar6 = FUN_0041ee25(param_1,(uint)param_5,(int *)param_4);
  if ((int)uVar6 < 0) {
    pcVar8 = "Failed to begin plan dependency actions for package: %ls";
  }
  else {
    iVar2 = param_5[0x23];
    if (iVar2 == 1) {
      bVar7 = param_5[0x17] != 0;
    }
    else {
      bVar7 = 1 < (int)param_5[0x17];
    }
    if (bVar7) {
      if (((iVar2 == 2) && (param_5[0x33] != 0)) &&
         (DVar5 = FUN_0040bb57((int)param_4,(int)param_5), (int)DVar5 < 0)) {
        pcVar8 = "Failed to plan slipstream patches for package.";
        goto LAB_0040cdb7;
      }
      DVar5 = FUN_0040b90e((int)param_4,param_5,param_8);
      if ((int)DVar5 < 0) {
        pcVar8 = "Failed to plan cache package.";
        goto LAB_0040cdb7;
      }
    }
    else if ((param_5[0x11] != 2) &&
            ((iVar3 = param_5[0x18], 1 < iVar3 || ((iVar2 == 1 && (iVar3 != 0)))))) {
      FUN_0040e2bb(iVar3);
      FUN_0040e3d3(param_5[0x11]);
      FUN_00402003(2,0xa00000d0);
      param_5[0x18] = 0;
    }
    if ((param_5[0x14] == 4) || ((param_5[0x10] == 4 && (2 < (int)param_5[0x14])))) {
      if (param_5[8] != 0) {
        uVar4 = param_5[0xc];
        puVar1 = param_4 + 10;
        uVar6 = *puVar1;
        *puVar1 = *puVar1 + uVar4;
        param_4[0xb] = param_4[0xb] + param_5[0xd] + (uint)CARRY4(uVar6,uVar4);
      }
      if (3 < (int)param_5[0x14]) {
        if (param_5[0x23] == 3) {
          uVar4 = param_5[0xc];
          puVar1 = param_4 + 10;
          uVar6 = *puVar1;
          *puVar1 = *puVar1 + uVar4;
          param_4[0xb] = param_4[0xb] + param_5[0xd] + (uint)CARRY4(uVar6,uVar4);
        }
        uVar4 = param_5[10];
        puVar1 = param_4 + 10;
        uVar6 = *puVar1;
        *puVar1 = *puVar1 + uVar4;
        param_4[0xb] = param_4[0xb] + param_5[0xb] + (uint)CARRY4(uVar6,uVar4);
      }
    }
    iVar2 = param_5[0x23];
    if (iVar2 == 1) {
      uVar6 = FUN_00419fad((uint *)0x0,(int)param_5,(int *)param_4,param_6,param_7,*param_8,
                           param_5[0x15]);
    }
    else if (iVar2 == 2) {
      uVar6 = FUN_0041c275(param_2,(int)param_5,(int)param_4,param_6,param_7,*param_8,param_5[0x15])
      ;
    }
    else if (iVar2 == 3) {
      uVar6 = FUN_0041d674(param_2,(uint)param_5,param_4,param_6,param_7,*param_8,param_5[0x15]);
    }
    else {
      if (iVar2 != 4) {
        pcVar8 = "Invalid package type.";
        DVar5 = 0x8000ffff;
LAB_0040cdb7:
        FUN_00430a57(DVar5,pcVar8);
        return DVar5;
      }
      uVar6 = FUN_0041dfb1((int)param_5,(int)param_4,param_6,param_7,*param_8,param_5[0x15]);
    }
    if ((int)uVar6 < 0) {
      pcVar8 = "Failed to add plan actions for package: %ls";
    }
    else {
      uVar6 = FUN_0041f0a2((int)param_5,(int *)param_4);
      if (-1 < (int)uVar6) {
        if ((param_5[0x17] == 0) && (param_5[0x18] == 0)) {
          return uVar6;
        }
        FUN_0040e431();
        param_4[0xc] = param_4[0xc] + 1;
        param_4[0xd] = param_4[0xd] + 1;
        if (param_5[5] == 0) {
          return uVar6;
        }
        param_4[3] = 1;
        return uVar6;
      }
      pcVar8 = "Failed to complete plan dependency actions for package: %ls";
    }
  }
  FUN_00430a57(uVar6,pcVar8);
  return uVar6;
}



/* Function: FUN_0040ce7f */

int FUN_0040ce7f(int param_1)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = FUN_0040c751(1,*(int *)(param_1 + 0x5c),*(int *)(param_1 + 0x60));
  if ((iVar1 < 0) ||
     (iVar1 = FUN_0040c751(0,*(int *)(param_1 + 100),*(int *)(param_1 + 0x68)), iVar1 < 0)) {
    pcVar2 = "Failed to remove unnecessary execute actions.";
  }
  else {
    iVar1 = FUN_0040c2a1(1,*(int *)(param_1 + 0x5c),*(uint *)(param_1 + 0x60));
    if (iVar1 < 0) {
      pcVar2 = "Failed to finalize slipstream execute actions.";
    }
    else {
      iVar1 = FUN_0040c2a1(0,*(int *)(param_1 + 100),*(uint *)(param_1 + 0x68));
      if (-1 < iVar1) {
        return iVar1;
      }
      pcVar2 = "Failed to finalize slipstream rollback actions.";
    }
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0040cef6 */

int FUN_0040cef6(uint param_1,int param_2,int *param_3)

{
  int iVar1;
  
  iVar1 = FUN_0043116d((int *)(param_2 + 0x5c),param_1,1,*(int *)(param_2 + 0x60) + 1,0x30,5);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to grow plan\'s array of execute actions.");
  }
  else {
    *param_3 = param_1 * 0x30 + *(int *)(param_2 + 0x5c);
    *(int *)(param_2 + 0x60) = *(int *)(param_2 + 0x60) + 1;
  }
  return iVar1;
}



/* Function: FUN_0040cf43 */

int FUN_0040cf43(uint param_1,int param_2,int *param_3)

{
  int iVar1;
  
  iVar1 = FUN_0043116d((int *)(param_2 + 100),param_1,1,*(int *)(param_2 + 0x68) + 1,0x30,5);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to grow plan\'s array of rollback actions.");
  }
  else {
    *param_3 = param_1 * 0x30 + *(int *)(param_2 + 100);
    *(int *)(param_2 + 0x68) = *(int *)(param_2 + 0x68) + 1;
  }
  return iVar1;
}



/* Function: FUN_0040cf90 */

int FUN_0040cf90(int param_1,uint param_2,uint param_3)

{
  int iVar1;
  char *pcVar2;
  undefined4 *local_8;
  
  iVar1 = 0;
  local_8 = (undefined4 *)0x0;
  if (param_2 != 0x80000000) {
    iVar1 = FUN_0040cef6(param_2,param_1,(int *)&local_8);
    if (iVar1 < 0) {
      pcVar2 = "Failed to insert keep registration execute action.";
      goto LAB_0040cff0;
    }
    *local_8 = 0xd;
    local_8[2] = 1;
  }
  if (param_3 == 0x80000000) {
    return iVar1;
  }
  iVar1 = FUN_0040cf43(param_3,param_1,(int *)&local_8);
  if (-1 < iVar1) {
    *local_8 = 0xd;
    local_8[2] = 0;
    return iVar1;
  }
  pcVar2 = "Failed to insert keep registration rollback action.";
LAB_0040cff0:
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0040d00c */

DWORD FUN_0040d00c(int param_1,LPCWSTR param_2,uint param_3,int param_4,LPCRITICAL_SECTION param_5,
                  int *param_6,undefined4 *param_7)

{
  uint *puVar1;
  uint uVar2;
  undefined4 *puVar3;
  LPCWSTR pWVar4;
  DWORD DVar5;
  int iVar6;
  char *pcVar7;
  undefined4 *local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_10 = (undefined4 *)0x0;
  local_c = (LPCWSTR)0x0;
  local_8 = (LPCWSTR)0x0;
  DVar5 = FUN_00403c02(param_5,L"WixBundleLayoutDirectory",(int *)&local_8);
  if (DVar5 == 0x80070490) {
    DVar5 = FUN_00431c19((int *)&local_c,(HMODULE)0x0);
    if ((int)DVar5 < 0) {
      pcVar7 = "Failed to get path for current executing process as layout directory.";
    }
    else {
      DVar5 = FUN_00431c88(local_c,(int *)&local_8);
      if (-1 < (int)DVar5) goto LAB_0040d075;
      pcVar7 = "Failed to get executing process as layout directory.";
    }
  }
  else if ((int)DVar5 < 0) {
    pcVar7 = "Failed to get bundle layout directory property.";
  }
  else {
LAB_0040d075:
    DVar5 = FUN_0043124a((int *)&local_8);
    if ((int)DVar5 < 0) {
      pcVar7 = "Failed to ensure layout directory is backslash terminated.";
    }
    else {
      DVar5 = FUN_0040bd21(param_1,(int *)&local_10);
      puVar3 = local_10;
      if (-1 < (int)DVar5) {
        *local_10 = 2;
        DVar5 = FUN_00433f88(local_10 + 2,param_2,0);
        if ((int)DVar5 < 0) {
          pcVar7 = "Failed to to copy executable name for bundle.";
        }
        else {
          DVar5 = FUN_00433f88(puVar3 + 3,local_8,0);
          if ((int)DVar5 < 0) {
            pcVar7 = "Failed to to copy layout directory for bundle.";
          }
          else {
            DVar5 = FUN_00413307(*(short **)(param_1 + 4),puVar3 + 4);
            if (-1 < (int)DVar5) {
              puVar3[6] = param_3;
              puVar3[7] = param_4;
              puVar1 = (uint *)(param_1 + 0x20);
              uVar2 = *puVar1;
              *puVar1 = *puVar1 + param_3;
              *(int *)(param_1 + 0x24) =
                   *(int *)(param_1 + 0x24) + param_4 + (uint)CARRY4(uVar2,param_3);
              *(int *)(param_1 + 0x34) = *(int *)(param_1 + 0x34) + 1;
              param_5 = (LPCRITICAL_SECTION)0x0;
              if (param_6[1] != 0) {
                iVar6 = 0;
                do {
                  if ((((undefined4 *)(*param_6 + iVar6))[2] != 0) &&
                     (DVar5 = FUN_0040bd6a(param_1,0,0x80000000,(undefined4 *)(*param_6 + iVar6),
                                           (undefined4 *)0x0,local_8), (int)DVar5 < 0)) {
                    pcVar7 = "Failed to plan layout payload.";
                    goto LAB_0040d1a1;
                  }
                  param_5 = (LPCRITICAL_SECTION)((int)&param_5->DebugInfo + 1);
                  iVar6 = iVar6 + 0x58;
                } while (param_5 < (LPCRITICAL_SECTION)param_6[1]);
              }
              pWVar4 = local_8;
              local_8 = (LPCWSTR)0x0;
              *param_7 = pWVar4;
              goto LAB_0040d178;
            }
            pcVar7 = "Failed to calculate bundle layout working path.";
          }
        }
LAB_0040d1a1:
        FUN_00430a57(DVar5,pcVar7);
        goto LAB_0040d178;
      }
      pcVar7 = "Failed to append bundle start action.";
    }
  }
  FUN_00430a57(DVar5,pcVar7);
LAB_0040d178:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar5;
}



/* Function: FUN_0040d1ab */

DWORD FUN_0040d1ab(uint param_1,int param_2,LPCWSTR param_3)

{
  int *piVar1;
  uint *puVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  uint uVar6;
  uint uVar7;
  DWORD DVar8;
  uint uVar9;
  int iVar10;
  char *pcVar11;
  undefined4 *local_8;
  
  uVar7 = param_1;
  local_8 = (undefined4 *)0x0;
  DVar8 = FUN_0040bd21(param_1,(int *)&local_8);
  if ((int)DVar8 < 0) {
    FUN_00430a57(DVar8,"Failed to append package start action.");
  }
  else {
    *local_8 = 3;
    local_8[2] = param_2;
    uVar9 = *(int *)(param_1 + 0x50) - 1;
    param_1 = 0;
    if (*(int *)(param_2 + 0x80) != 0) {
      do {
        iVar4 = *(int *)(param_2 + 0x7c);
        if ((param_3 == (LPCWSTR)0x0) ||
           (iVar5 = *(int *)(iVar4 + param_1 * 8), *(int *)(iVar5 + 0x3c) == 0)) {
          DVar8 = FUN_0040bd6a(uVar7,param_2,uVar9,*(undefined4 **)(iVar4 + param_1 * 8),
                               (undefined4 *)0x0,param_3);
          if ((int)DVar8 < 0) {
            pcVar11 = "Failed to append cache/layout payload action.";
            goto LAB_0040d295;
          }
        }
        else {
          DVar8 = FUN_0040bfcc(uVar7,param_2,uVar9,*(int *)(iVar5 + 0x3c),0,param_3);
          if ((int)DVar8 < 0) {
            pcVar11 = "Failed to append layout container action.";
            goto LAB_0040d295;
          }
        }
        iVar10 = uVar9 * 0x28;
        piVar1 = (int *)(*(int *)(uVar7 + 0x4c) + 0xc + iVar10);
        *piVar1 = *piVar1 + 1;
        iVar5 = *(int *)(uVar7 + 0x4c);
        iVar4 = *(int *)(iVar4 + param_1 * 8);
        uVar6 = *(uint *)(iVar4 + 0x10);
        puVar2 = (uint *)(iVar5 + 0x10 + iVar10);
        uVar3 = *puVar2;
        *puVar2 = *puVar2 + uVar6;
        piVar1 = (int *)(iVar5 + 0x14 + iVar10);
        *piVar1 = *piVar1 + *(int *)(iVar4 + 0x14) + (uint)CARRY4(uVar3,uVar6);
        param_1 = param_1 + 1;
      } while (param_1 < *(uint *)(param_2 + 0x80));
    }
    DVar8 = FUN_0040bd21(uVar7,(int *)&local_8);
    if ((int)DVar8 < 0) {
      pcVar11 = "Failed to append cache action.";
LAB_0040d295:
      FUN_00430a57(DVar8,pcVar11);
    }
    else {
      *local_8 = 4;
      local_8[2] = param_2;
      *(int *)(uVar9 * 0x28 + 0x18 + *(int *)(uVar7 + 0x4c)) = *(int *)(uVar7 + 0x50) + -1;
      *(int *)(uVar7 + 0x34) = *(int *)(uVar7 + 0x34) + 1;
    }
  }
  return DVar8;
}



/* Function: FUN_0040d2cf */

DWORD FUN_0040d2cf(int param_1,int param_2,uint *param_3,int param_4,LPCRITICAL_SECTION param_5,
                  int param_6,int param_7,int param_8,LPCWSTR param_9,uint *param_10)

{
  uint *puVar1;
  uint *puVar2;
  uint *puVar3;
  uint uVar4;
  uint uVar5;
  uint uVar6;
  DWORD DVar7;
  char *pcVar8;
  uint local_24;
  uint local_20;
  uint local_1c;
  uint local_18;
  undefined4 local_14;
  uint local_10;
  int local_c;
  uint local_8;
  
  puVar1 = param_3;
  local_10 = param_3[3];
  local_14 = 0x80000000;
  local_20 = 0x80000000;
  local_8 = 0x80000000;
  local_18 = 0x80000000;
  uVar6 = 0;
  puVar2 = *(uint **)(param_2 + 0xc);
  DVar7 = 0;
  local_c = 0;
  local_24 = 0x80000000;
  local_1c = 0x80000000;
  param_3 = (uint *)0x0;
  if (puVar2 != (uint *)0x0) {
    do {
      puVar3 = param_3;
      if (*puVar1 == 3) {
        puVar3 = (uint *)((int)puVar2 + (-1 - (int)param_3));
      }
      DVar7 = FUN_0040c4b9(local_10,param_1,puVar1,
                           (undefined4 *)((int)puVar3 * 0xd0 + *(int *)(param_2 + 8)),param_4,
                           param_5,param_7,param_8,param_9,param_10,&local_c,(int *)&local_24);
      if ((int)DVar7 < 0) {
        pcVar8 = "Failed to process package.";
        goto LAB_0040d443;
      }
      param_3 = (uint *)((int)param_3 + 1);
      puVar2 = *(uint **)(param_2 + 0xc);
    } while (param_3 < puVar2);
    local_8 = local_18;
  }
  local_18 = local_8;
  if ((param_6 == 0) && (((*puVar1 == 4 || (*puVar1 == 5)) || (*puVar1 == 6)))) {
    uVar5 = local_20;
    uVar4 = local_24;
    if (local_24 == 0x80000000) {
      uVar4 = puVar1[0x18];
      uVar5 = puVar1[0x1a];
    }
    DVar7 = FUN_0040cf90((int)puVar1,uVar4,uVar5);
    if ((int)DVar7 < 0) {
      pcVar8 = "Failed to plan install keep registration.";
      goto LAB_0040d443;
    }
  }
  else if (*puVar1 == 3) {
    uVar4 = local_8;
    uVar5 = local_1c;
    if (local_1c == 0x80000000) {
      uVar4 = puVar1[0x1a];
      uVar5 = puVar1[0x18];
    }
    DVar7 = FUN_0040db41((int)puVar1,uVar5,uVar4);
    if ((int)DVar7 < 0) {
      pcVar8 = "Failed to plan uninstall remove registration.";
      goto LAB_0040d443;
    }
  }
  if ((local_c == 0) || (DVar7 = FUN_0040dd6d((int)puVar1), -1 < (int)DVar7)) {
    uVar4 = *(uint *)(param_2 + 0xc);
    if (uVar4 == 0) {
      return DVar7;
    }
    while( true ) {
      uVar5 = uVar6;
      if (*puVar1 == 3) {
        uVar5 = (uVar4 - uVar6) - 1;
      }
      DVar7 = FUN_0040ca0b((int *)puVar1,uVar5 * 0xd0 + *(int *)(param_2 + 8));
      if ((int)DVar7 < 0) break;
      uVar6 = uVar6 + 1;
      uVar4 = *(uint *)(param_2 + 0xc);
      if (uVar4 <= uVar6) {
        return DVar7;
      }
    }
    pcVar8 = "Failed to plan clean package.";
  }
  else {
    pcVar8 = "Failed to plan rollback boundary begin.";
  }
LAB_0040d443:
  FUN_00430a57(DVar7,pcVar8);
  return DVar7;
}



/* Function: FUN_0040d454 */

DWORD FUN_0040d454(int param_1,undefined4 *param_2,uint *param_3,int param_4,
                  LPCRITICAL_SECTION param_5,int param_6,int param_7,uint *param_8)

{
  uint *puVar1;
  DWORD DVar2;
  char *pcVar3;
  
  puVar1 = param_3;
  param_3 = (uint *)0x0;
  DVar2 = FUN_0040c4b9(puVar1[3],param_1,puVar1,param_2,param_4,param_5,param_6,param_7,(LPCWSTR)0x0
                       ,param_8,(int *)&param_3,(int *)0x0);
  if ((int)DVar2 < 0) {
    pcVar3 = "Failed to process passthrough package.";
  }
  else {
    if (param_3 == (uint *)0x0) {
      return DVar2;
    }
    DVar2 = FUN_0040dd6d((int)puVar1);
    if (-1 < (int)DVar2) {
      return DVar2;
    }
    pcVar3 = "Failed to plan rollback boundary for passthrough package.";
  }
  FUN_00430a57(DVar2,pcVar3);
  return DVar2;
}



/* Function: FUN_0040d4b9 */

uint FUN_0040d4b9(int *param_1,uint param_2,uint param_3,int param_4,wchar_t *param_5,
                 undefined4 *param_6)

{
  wchar_t *pwVar1;
  uint uVar2;
  bool bVar3;
  bool bVar4;
  int iVar5;
  wchar_t *pwVar6;
  undefined3 extraout_var;
  int *piVar7;
  int *piVar8;
  undefined3 extraout_var_00;
  undefined3 extraout_var_01;
  uint uVar9;
  char *pcVar10;
  LPVOID local_10;
  uint local_c;
  int *local_8;
  
  uVar2 = param_2;
  piVar8 = param_1;
  iVar5 = 1;
  param_1[4] = 1;
  uVar9 = 0;
  local_8 = (int *)0x0;
  local_10 = (LPVOID)0x0;
  local_c = 0;
  if ((*(int *)(param_2 + 8) == 0) && (param_3 != 4)) {
    iVar5 = 0;
  }
  param_1[6] = iVar5;
  param_1[7] = 0;
  pwVar1 = *(wchar_t **)(param_2 + 0x40);
  if (pwVar1 == (wchar_t *)0x0) {
    pwVar6 = *(wchar_t **)(param_2 + 0xc);
  }
  else {
    pwVar6 = (wchar_t *)0x0;
    if (*pwVar1 != L'\0') {
      pwVar6 = pwVar1;
    }
  }
  if (*param_1 == 3) {
    if ((*(PCNZWCH *)(param_2 + 0xbc) == (PCNZWCH)0x0) ||
       (iVar5 = CompareStringW(0,1,*(PCNZWCH *)(param_2 + 0xc),-1,*(PCNZWCH *)(param_2 + 0xbc),-1),
       iVar5 != 2)) {
      FUN_00402003(2,0xa00000d1);
    }
    else {
      param_1[0xe] = 2;
    }
    uVar9 = FUN_00437ee1(&local_8,5,1);
    if ((int)uVar9 < 0) {
      pcVar10 = "Failed to create the string dictionary.";
    }
    else if ((pwVar6 == (wchar_t *)0x0) ||
            (bVar3 = FUN_0041e9e9(param_2), CONCAT31(extraout_var,bVar3) == 0)) {
LAB_0040d5b4:
      if (param_4 == 2) goto LAB_0040d804;
      if (((param_5 == (wchar_t *)0x0) || (*param_5 == L'\0')) ||
         (uVar9 = FUN_0041e934(local_8,param_5), -1 < (int)uVar9)) {
        param_3 = 0;
        if (*(int *)(param_2 + 0xb8) != 0) {
          param_4 = 0;
          do {
            piVar7 = (int *)(*(int *)(uVar2 + 0xb4) + param_4);
            if ((*piVar7 == 5) && (param_1 = (int *)0x0, piVar7[0x28] != 0)) {
              param_2 = 0;
              do {
                uVar9 = FUN_0041e934(local_8,*(wchar_t **)(piVar7[0x27] + param_2));
                if ((int)uVar9 < 0) {
                  pcVar10 = "Failed to add dependent bundle provider key to ignore dependents.";
                  goto LAB_0040d7fc;
                }
                param_1 = (int *)((int)param_1 + 1);
                param_2 = param_2 + 0x10;
              } while (param_1 < (int *)piVar7[0x28]);
            }
            param_3 = param_3 + 1;
            param_4 = param_4 + 0xe8;
          } while (param_3 < *(uint *)(uVar2 + 0xb8));
        }
        uVar9 = FUN_00438ce4(*(undefined4 *)(uVar2 + 0x4c),*(short **)(uVar2 + 0x44),0,local_8,
                             (int *)&local_10,&local_c);
        if (uVar9 == 0x80070002) {
          uVar9 = 0;
          goto LAB_0040d804;
        }
        if (-1 < (int)uVar9) {
          if (local_c != 0) {
            piVar8[7] = 1;
            *param_6 = 0;
            FUN_00402003(2,0xa00000d2);
          }
          goto LAB_0040d804;
        }
        pcVar10 = "Failed to check for remaining dependents during planning.";
      }
      else {
        pcVar10 = "Failed to add dependents ignored from command-line.";
      }
    }
    else {
      uVar9 = FUN_0040bc29((int)param_1,2,pwVar6,*(LPCWSTR *)(param_2 + 0xc));
      if ((int)uVar9 < 0) {
        pcVar10 = "Failed to allocate registration action.";
      }
      else {
        uVar9 = FUN_0041e934(local_8,pwVar6);
        if (-1 < (int)uVar9) goto LAB_0040d5b4;
        pcVar10 = "Failed to add self-dependent to ignore dependents.";
      }
    }
  }
  else {
    if ((*(int *)(param_2 + 0x28) != 0) || (bVar3 = false, *(int *)(param_2 + 0x30) != 0)) {
      bVar3 = true;
    }
    iVar5 = FUN_004369f6(*(LPCWSTR *)(param_2 + 0x54),(uint *)0x0);
    if (iVar5 == 0) {
LAB_0040d705:
      param_1[5] = param_1[5] | 3;
    }
    else if (*param_1 == 6) {
      iVar5 = FUN_00413062();
      if (iVar5 == 0) goto LAB_0040d705;
      if (*param_1 == 6) {
        param_1[5] = param_1[5] | 2;
      }
    }
    param_1[5] = param_1[5] | 4;
    param_1[0xe] = 1;
    param_5 = (wchar_t *)0x0;
    if (*(int *)(param_2 + 0xb8) != 0) {
      param_6 = (undefined4 *)0x0;
      do {
        piVar8 = (int *)(*(int *)(uVar2 + 0xb4) + (int)param_6);
        if ((*piVar8 == 5) && (param_2 = 0, piVar8[0x28] != 0)) {
          param_3 = 0;
          do {
            iVar5 = piVar8[0x27];
            bVar4 = FUN_0041e9e9(uVar2);
            if ((CONCAT31(extraout_var_00,bVar4) == 0) &&
               (uVar9 = FUN_0040bc29((int)param_1,1,*(LPCWSTR *)(iVar5 + param_3),(LPCWSTR)piVar8[6]
                                    ), (int)uVar9 < 0)) {
              pcVar10 = "Failed to add registration action for dependent related bundle.";
              goto LAB_0040d7fc;
            }
            param_2 = param_2 + 1;
            param_3 = param_3 + 0x10;
          } while (param_2 < (uint)piVar8[0x28]);
        }
        param_5 = (wchar_t *)((int)param_5 + 1);
        param_6 = param_6 + 0x3a;
      } while (param_5 < *(wchar_t **)(uVar2 + 0xb8));
    }
    if (((pwVar6 == (wchar_t *)0x0) ||
        (((*(int *)(uVar2 + 0x40) == 0 && (bVar3)) ||
         (bVar3 = FUN_0041e9e9(uVar2), CONCAT31(extraout_var_01,bVar3) != 0)))) ||
       (uVar9 = FUN_0040bc29((int)param_1,1,pwVar6,*(LPCWSTR *)(uVar2 + 0xc)), -1 < (int)uVar9))
    goto LAB_0040d804;
    pcVar10 = "Failed to add registration action for self dependent.";
  }
LAB_0040d7fc:
  FUN_00430a57(uVar9,pcVar10);
LAB_0040d804:
  if (local_8 != (int *)0x0) {
    FUN_0043800c(local_8);
  }
  if (local_10 != (LPVOID)0x0) {
    FUN_00438ea2(local_10,local_c);
  }
  return uVar9;
}



/* Function: FUN_0040d833 */

uint FUN_0040d833(int param_1,uint *param_2,int param_3,uint *param_4,undefined4 param_5,
                 LPCRITICAL_SECTION param_6,int *param_7)

{
  uint *puVar1;
  uint uVar2;
  int iVar3;
  int *piVar4;
  char *pcVar5;
  int local_10;
  uint local_c;
  LPCWSTR local_8;
  
  puVar1 = param_4;
  local_8 = (LPCWSTR)0x0;
  uVar2 = FUN_0041e9b3((int)param_4,(int *)&local_8);
  if ((int)uVar2 < 0) {
    FUN_00430a57(uVar2,"Failed to get the list of dependencies to ignore.");
  }
  else {
    local_c = 0;
    if (param_2[0x2e] != 0) {
      local_10 = 0;
      do {
        piVar4 = (int *)(param_2[0x2d] + local_10);
        param_4 = (uint *)0x0;
        iVar3 = *piVar4;
        piVar4[0x19] = 0;
        piVar4[0x1a] = 0;
        if (iVar3 != 1) {
          if (iVar3 == 2) {
            if ((param_3 != 2) && (3 < (int)*puVar1)) {
              if ((param_2[0xf] < (uint)piVar4[3]) ||
                 ((param_2[0xf] <= (uint)piVar4[3] && (param_2[0xe] <= (uint)piVar4[2])))) {
                iVar3 = 0;
              }
              else {
                iVar3 = 2;
              }
LAB_0040da3e:
              piVar4[0x1a] = iVar3;
            }
            goto LAB_0040d8b3;
          }
          if ((iVar3 != 3) && (iVar3 != 4)) {
            if (iVar3 == 5) goto LAB_0040d8b3;
            uVar2 = 0x8000ffff;
            pcVar5 = "Unexpected relation type encountered during plan: %d";
            goto LAB_0040db02;
          }
          uVar2 = FUN_00433f88(piVar4 + 0x2e,local_8,0);
          if (-1 < (int)uVar2) {
            if (*puVar1 == 3) {
              param_4 = (uint *)&stack0x00000020;
              piVar4[0x1a] = 2;
            }
            else {
              iVar3 = 4;
              if ((*puVar1 == 4) || (*puVar1 == 5)) goto LAB_0040da3e;
              if (*puVar1 == 6) {
                piVar4[0x1a] = 5;
              }
            }
            goto LAB_0040d8b3;
          }
          pcVar5 = "Failed to copy the list of dependencies to ignore.";
LAB_0040db22:
          FUN_00430a57(uVar2,pcVar5);
          break;
        }
LAB_0040d8b3:
        piVar4[0x19] = piVar4[0x1a];
        iVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x48))
                          (*(int **)(param_1 + 0x10),piVar4[6],piVar4 + 0x1a);
        uVar2 = FUN_00408843(param_1,1,iVar3);
        if ((int)uVar2 < 0) {
          FUN_004300d9();
          pcVar5 = "UX aborted plan related bundle.";
          goto LAB_0040db22;
        }
        if (piVar4[0x1a] != piVar4[0x19]) {
          FUN_0040e881(piVar4[0x19]);
          FUN_0040e881(piVar4[0x1a]);
          FUN_00402003(2,0x200000ca);
        }
        if (piVar4[0x1a] != 0) {
          uVar2 = FUN_0041a116((int)(piVar4 + 6));
          if ((int)uVar2 < 0) {
            pcVar5 = "Failed to calcuate plan for related bundle: %ls";
          }
          else {
            if ((*piVar4 == 3) || (*piVar4 == 4)) {
              uVar2 = FUN_0041ee25(*param_2,(uint)(piVar4 + 6),(int *)puVar1);
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to begin plan dependency actions to  package: %ls";
                goto LAB_0040db02;
              }
              if ((param_4 != (uint *)0x0) && (*puVar1 == 3)) {
                *param_4 = *param_4 + 1;
              }
            }
            uVar2 = FUN_00419fad(param_4,(int)(piVar4 + 6),(int *)puVar1,param_5,param_6,*param_7,0)
            ;
            if (-1 < (int)uVar2) {
              if (((*piVar4 == 3) || (*piVar4 == 4)) &&
                 (uVar2 = FUN_0041f0a2((int)(piVar4 + 6),(int *)puVar1), (int)uVar2 < 0))
              goto LAB_0040dae9;
              if (piVar4[0x1d] != 0) {
                FUN_0040e431();
                puVar1[0xc] = puVar1[0xc] + 1;
                puVar1[0xd] = puVar1[0xd] + 1;
              }
              if (piVar4[0xb] != 0) {
                puVar1[3] = 1;
              }
              goto LAB_0040da92;
            }
            pcVar5 = "Failed to add to plan related bundle: %ls";
          }
LAB_0040db02:
          FUN_00430a57(uVar2,pcVar5);
          break;
        }
        if ((*piVar4 == 3) || (*piVar4 == 4)) {
          uVar2 = FUN_0041ee25(*param_2,(uint)(piVar4 + 6),(int *)puVar1);
          if ((int)uVar2 < 0) {
            pcVar5 = "Failed to begin plan dependency actions for related bundle package: %ls";
            goto LAB_0040db02;
          }
          uVar2 = FUN_0041ed32(param_4,(int)(piVar4 + 6),(int)puVar1);
          if ((int)uVar2 < 0) {
            pcVar5 = "Failed to plan related bundle package provider actions.";
            goto LAB_0040db22;
          }
          uVar2 = FUN_0041f0a2((int)(piVar4 + 6),(int *)puVar1);
          if (-1 < (int)uVar2) goto LAB_0040da92;
LAB_0040dae9:
          pcVar5 = "Failed to complete plan dependency actions for related bundle package: %ls";
          goto LAB_0040db02;
        }
LAB_0040da92:
        local_c = local_c + 1;
        local_10 = local_10 + 0xe8;
      } while (local_c < param_2[0x2e]);
    }
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar2;
}



/* Function: FUN_0040db41 */

int FUN_0040db41(int param_1,uint param_2,uint param_3)

{
  int iVar1;
  char *pcVar2;
  undefined4 *local_8;
  
  iVar1 = 0;
  local_8 = (undefined4 *)0x0;
  if (param_2 != 0x80000000) {
    iVar1 = FUN_0040cef6(param_2,param_1,(int *)&local_8);
    if (iVar1 < 0) {
      pcVar2 = "Failed to insert remove registration execute action.";
      goto LAB_0040db9e;
    }
    *local_8 = 0xd;
    local_8[2] = 0;
  }
  if (param_3 == 0x80000000) {
    return iVar1;
  }
  iVar1 = FUN_0040cf43(param_3,param_1,(int *)&local_8);
  if (-1 < iVar1) {
    *local_8 = 0xd;
    local_8[2] = 1;
    return iVar1;
  }
  pcVar2 = "Failed to insert remove registration rollback action.";
LAB_0040db9e:
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0040dbbd */

void FUN_0040dbbd(uint *param_1,int param_2)

{
  uint uVar1;
  int iVar2;
  
  iVar2 = 0;
  if (param_1[0xf] != 0) {
    uVar1 = 0;
    if (param_1[0x10] != 0) {
      do {
        FUN_0040c94c((undefined4 *)(param_1[0xf] + iVar2));
        uVar1 = uVar1 + 1;
        iVar2 = iVar2 + 0xc;
      } while (uVar1 < param_1[0x10]);
    }
    FUN_00431137((LPVOID)param_1[0xf]);
  }
  iVar2 = 0;
  if (param_1[0x11] != 0) {
    uVar1 = 0;
    if (param_1[0x12] != 0) {
      do {
        FUN_0040c94c((undefined4 *)(param_1[0x11] + iVar2));
        uVar1 = uVar1 + 1;
        iVar2 = iVar2 + 0xc;
      } while (uVar1 < param_1[0x12]);
    }
    FUN_00431137((LPVOID)param_1[0x11]);
  }
  iVar2 = 0;
  if (param_1[0x13] != 0) {
    uVar1 = 0;
    if (param_1[0x14] != 0) {
      do {
        FUN_0040c8b6((int *)(param_1[0x13] + iVar2));
        uVar1 = uVar1 + 1;
        iVar2 = iVar2 + 0x28;
      } while (uVar1 < param_1[0x14]);
    }
    FUN_00431137((LPVOID)param_1[0x13]);
  }
  iVar2 = 0;
  if (param_1[0x17] != 0) {
    uVar1 = 0;
    if (param_1[0x18] != 0) {
      do {
        FUN_0040de80((int *)(param_1[0x17] + iVar2));
        uVar1 = uVar1 + 1;
        iVar2 = iVar2 + 0x30;
      } while (uVar1 < param_1[0x18]);
    }
    FUN_00431137((LPVOID)param_1[0x17]);
  }
  iVar2 = 0;
  if (param_1[0x19] != 0) {
    uVar1 = 0;
    if (param_1[0x1a] != 0) {
      do {
        FUN_0040de80((int *)(param_1[0x19] + iVar2));
        uVar1 = uVar1 + 1;
        iVar2 = iVar2 + 0x30;
      } while (uVar1 < param_1[0x1a]);
    }
    FUN_00431137((LPVOID)param_1[0x19]);
  }
  uVar1 = 0;
  if (param_1[0x1b] != 0) {
    FUN_00431137((LPVOID)param_1[0x1b]);
  }
  if (param_1[0x1d] != 0) {
    FUN_00438ea2((LPVOID)param_1[0x1d],param_1[0x1e]);
  }
  FUN_004267c0(param_1,0,0x80);
  if ((*(int *)(param_2 + 8) != 0) && (*(int *)(param_2 + 0xc) != 0)) {
    iVar2 = 0;
    do {
      FUN_0040c814(*(int *)(param_2 + 8) + iVar2);
      uVar1 = uVar1 + 1;
      iVar2 = iVar2 + 0xd0;
    } while (uVar1 < *(uint *)(param_2 + 0xc));
  }
  return;
}



/* Function: FUN_0040dd01 */

int FUN_0040dd01(int param_1,undefined4 param_2)

{
  int iVar1;
  undefined4 *local_8;
  
  local_8 = (undefined4 *)0x0;
  iVar1 = FUN_0040c979(param_1,(int *)&local_8);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to append rollback boundary begin action.");
  }
  else {
    *local_8 = 0xc;
    local_8[2] = param_2;
    iVar1 = FUN_0040c9c2(param_1,(int *)&local_8);
    if (iVar1 < 0) {
      FUN_00430a57(iVar1,"Failed to append rollback boundary begin action.");
    }
    else {
      *local_8 = 0xc;
      local_8[2] = param_2;
    }
  }
  return iVar1;
}



/* Function: FUN_0040dd6d */

int FUN_0040dd6d(int param_1)

{
  int iVar1;
  int iVar2;
  undefined4 *local_8;
  
  local_8 = (undefined4 *)0x0;
  iVar2 = DAT_00456f50 + 1;
  DAT_00456f50 = iVar2;
  iVar1 = FUN_0040c979(param_1,(int *)&local_8);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to append execute action.");
  }
  else {
    *local_8 = 1;
    local_8[2] = iVar2;
    iVar1 = FUN_0040c9c2(param_1,(int *)&local_8);
    if (iVar1 < 0) {
      FUN_00430a57(iVar1,"Failed to append rollback action.");
    }
    else {
      *local_8 = 1;
      local_8[2] = iVar2;
    }
  }
  return iVar1;
}



/* Function: FUN_0040dde3 */

int FUN_0040dde3(int param_1,int param_2,int param_3,int param_4)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = FUN_00433cea((int *)(param_1 + 0x58),L"\"%ls\"");
  if (iVar1 < 0) {
    pcVar2 = "Failed to copy executable path to resume command-line.";
  }
  else {
    iVar1 = FUN_00411c05((int *)(param_1 + 0x58),param_2,*(int *)(param_3 + 4),*(int *)(param_3 + 8)
                         ,*(int *)(param_3 + 0x1c),*(int *)(param_3 + 0x20),
                         *(short **)(param_1 + 0x40),*(short **)(param_4 + 0xc),
                         *(short **)(param_3 + 0xc));
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to recreate resume command-line.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0040de4d */

int FUN_0040de4d(int param_1,LPCRITICAL_SECTION param_2)

{
  int iVar1;
  
  iVar1 = FUN_004045df(param_2,L"WixBundleAction",param_1,param_1 >> 0x1f,1);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to set the bundle action built-in variable.");
  }
  return iVar1;
}



/* Function: FUN_0040de80 */

void FUN_0040de80(int *param_1)

{
  int iVar1;
  LPVOID pvVar2;
  
  iVar1 = *param_1;
  if (iVar1 == 4) {
    if (param_1[5] == 0) {
      return;
    }
    pvVar2 = (LPVOID)param_1[5];
LAB_0040df29:
    FUN_004380ab(pvVar2);
  }
  else {
    if (iVar1 == 5) {
      if (param_1[3] != 0) {
        FUN_004380ab((LPVOID)param_1[3]);
      }
      if (param_1[7] != 0) {
        FUN_00431137((LPVOID)param_1[7]);
      }
      if (param_1[8] != 0) {
        FUN_00431137((LPVOID)param_1[8]);
      }
      if (param_1[9] == 0) {
        return;
      }
      pvVar2 = (LPVOID)param_1[9];
    }
    else {
      if (iVar1 != 6) {
        if (iVar1 != 7) {
          if ((iVar1 == 8) || (iVar1 == 9)) {
            if (param_1[2] == 0) {
              return;
            }
            pvVar2 = (LPVOID)param_1[2];
            goto LAB_0040df29;
          }
          if (iVar1 != 0xb) {
            return;
          }
        }
        if (param_1[3] == 0) {
          return;
        }
        pvVar2 = (LPVOID)param_1[3];
        goto LAB_0040df29;
      }
      if (param_1[3] != 0) {
        FUN_004380ab((LPVOID)param_1[3]);
      }
      if (param_1[7] != 0) {
        FUN_004380ab((LPVOID)param_1[7]);
      }
      if (param_1[10] == 0) {
        return;
      }
      pvVar2 = (LPVOID)param_1[10];
    }
    FUN_00431137(pvVar2);
  }
  return;
}



/* Function: FUN_0040df33 */

DWORD FUN_0040df33(int param_1,undefined4 *param_2,uint *param_3,int param_4,
                  LPCRITICAL_SECTION param_5,int param_6,int param_7,uint *param_8)

{
  uint *puVar1;
  DWORD DVar2;
  char *pcVar3;
  
  puVar1 = param_3;
  param_3 = (uint *)0x0;
  DVar2 = FUN_0040c4b9(puVar1[3],param_1,puVar1,param_2,param_4,param_5,param_6,param_7,(LPCWSTR)0x0
                       ,param_8,(int *)&param_3,(int *)0x0);
  if ((int)DVar2 < 0) {
    pcVar3 = "Failed to process update package.";
  }
  else if ((param_3 == (uint *)0x0) || (DVar2 = FUN_0040dd6d((int)puVar1), -1 < (int)DVar2)) {
    DVar2 = FUN_0040ca0b((int *)puVar1,(int)param_2);
    if (-1 < (int)DVar2) {
      return DVar2;
    }
    pcVar3 = "Failed to plan clean of update package.";
  }
  else {
    pcVar3 = "Failed to plan rollback boundary for update package.";
  }
  FUN_00430a57(DVar2,pcVar3);
  return DVar2;
}



/* Function: FUN_0040dfae */

void FUN_0040dfae(uint *param_1)

{
  short sVar1;
  uint uVar2;
  short *psVar3;
  short *local_c;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  local_c = (short *)0x0;
  uVar2 = FUN_004324d5(0x80000002,L"SOFTWARE\\Policies\\Microsoft\\Windows\\Installer",0x20019,
                       &local_8);
  if ((-1 < (int)uVar2) &&
     (uVar2 = FUN_00432602(local_8,L"Logging",(int *)&local_c), -1 < (int)uVar2)) {
    sVar1 = *local_c;
    psVar3 = local_c;
    while (sVar1 != 0) {
      sVar1 = *psVar3;
      if ((sVar1 == 0x76) || (sVar1 == 0x56)) {
        *param_1 = *param_1 | 2;
      }
      else if ((sVar1 == 0x78) || (sVar1 == 0x58)) {
        *param_1 = *param_1 | 4;
      }
      psVar3 = psVar3 + 1;
      sVar1 = *psVar3;
    }
  }
  if (local_c != (short *)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  return;
}



/* Function: FUN_0040e054 */

void FUN_0040e054(int *param_1)

{
  DWORD DVar1;
  BOOL BVar2;
  int iVar3;
  uint uVar4;
  uint uVar5;
  DWORD *pSessionId;
  char *pcVar6;
  DWORD local_220;
  uint local_21c;
  int local_218;
  PCNZWCH local_214;
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0((uint *)local_210,0,0x208);
  local_220 = 0;
  local_214 = (PCNZWCH)0x0;
  local_21c = 0;
  local_218 = 0;
  DVar1 = GetTempPathW(0x104,local_210);
  if (DVar1 == 0) {
    DVar1 = GetLastError();
    uVar4 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar4 = DVar1;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar6 = "Failed to get temp folder.";
  }
  else {
    uVar4 = FUN_0040e205(local_210,0x104,(int *)&local_21c);
    if (-1 < (int)uVar4) {
      pSessionId = &local_220;
      DVar1 = GetCurrentProcessId();
      BVar2 = ProcessIdToSessionId(DVar1,pSessionId);
      uVar4 = local_21c;
      if (BVar2 == 0) {
LAB_0040e1bd:
        iVar3 = FUN_00433f88(param_1,local_210,uVar4);
        if (-1 < iVar3) goto LAB_0040e1df;
        pcVar6 = "Failed to copy temp folder.";
      }
      else {
        iVar3 = FUN_00433cea((int *)&local_214,L"%u\\");
        if (iVar3 < 0) {
          pcVar6 = "Failed to format session id as a string.";
        }
        else {
          iVar3 = FUN_0040e205(local_214,0x7fffffff,&local_218);
          uVar4 = local_21c;
          if (-1 < iVar3) {
            uVar5 = local_21c - local_218;
            iVar3 = CompareStringW(0,0,local_210 + uVar5,local_218,local_214,local_218);
            if (iVar3 == 2) {
              uVar4 = uVar5;
            }
            goto LAB_0040e1bd;
          }
          pcVar6 = "Failed to get length of session id string.";
        }
      }
      FUN_00430a57(iVar3,pcVar6);
      goto LAB_0040e1df;
    }
    pcVar6 = "Failed to get length of temp folder.";
  }
  FUN_00430a57(uVar4,pcVar6);
LAB_0040e1df:
  if (local_214 != (PCNZWCH)0x0) {
    FUN_004380ab(local_214);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0040e205 */

int FUN_0040e205(short *param_1,uint param_2,int *param_3)

{
  int iVar1;
  uint uVar2;
  
  if ((param_1 == (short *)0x0) || (0x7fffffff < param_2)) {
    iVar1 = -0x7ff8ffa9;
    goto LAB_0040e256;
  }
  iVar1 = 0;
  uVar2 = param_2;
  if (param_2 == 0) {
LAB_0040e239:
    iVar1 = -0x7ff8ffa9;
  }
  else {
    do {
      if (*param_1 == 0) break;
      param_1 = param_1 + 1;
      uVar2 = uVar2 - 1;
    } while (uVar2 != 0);
    if (uVar2 == 0) goto LAB_0040e239;
  }
  if (param_3 != (int *)0x0) {
    if (iVar1 < 0) {
      *param_3 = 0;
    }
    else {
      *param_3 = param_2 - uVar2;
    }
  }
LAB_0040e256:
  if ((iVar1 < 0) && (param_3 != (int *)0x0)) {
    *param_3 = 0;
  }
  return iVar1;
}



/* Function: FUN_0040e268 */

int __cdecl FUN_0040e268(char *param_1,uint param_2,char *param_3)

{
  uint uVar1;
  int iVar2;
  uint _Count;
  
  iVar2 = 0;
  if ((param_2 == 0) || (0x7fffffff < param_2)) {
    iVar2 = -0x7ff8ffa9;
  }
  if (-1 < iVar2) {
    iVar2 = 0;
    _Count = param_2 - 1;
    uVar1 = __vsnprintf(param_1,_Count,param_3,&stack0x00000010);
    if (((int)uVar1 < 0) || (_Count < uVar1)) {
      iVar2 = -0x7ff8ff86;
    }
    else if (uVar1 != _Count) {
      return 0;
    }
    param_1[_Count] = '\0';
  }
  return iVar2;
}



/* Function: FUN_0040e2bb */

char * FUN_0040e2bb(undefined4 param_1)

{
  char *pcVar1;
  
  switch(param_1) {
  case 0:
    pcVar1 = "None";
    break;
  case 1:
    pcVar1 = "Uninstall";
    break;
  case 2:
    pcVar1 = "Install";
    break;
  case 3:
    pcVar1 = "AdminInstall";
    break;
  case 4:
    pcVar1 = "Modify";
    break;
  case 5:
    pcVar1 = "Repair";
    break;
  case 6:
    pcVar1 = "MinorUpgrade";
    break;
  case 7:
    pcVar1 = "MajorUpgrade";
    break;
  case 8:
    pcVar1 = "Patch";
    break;
  default:
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e33b */

undefined * FUN_0040e33b(int param_1)

{
  undefined *puVar1;
  
  puVar1 = &DAT_004429e8;
  if (param_1 == 0) {
    puVar1 = &DAT_004429ec;
  }
  return puVar1;
}



/* Function: FUN_0040e353 */

char * FUN_0040e353(undefined4 param_1)

{
  char *pcVar1;
  
  switch(param_1) {
  case 0:
    pcVar1 = "Unknown";
    break;
  case 1:
    pcVar1 = "Help";
    break;
  case 2:
    pcVar1 = "Layout";
    break;
  case 3:
    pcVar1 = "Uninstall";
    break;
  case 4:
    pcVar1 = "Install";
    break;
  case 5:
    pcVar1 = "Modify";
    break;
  case 6:
    pcVar1 = "Repair";
    break;
  case 7:
    pcVar1 = "UpdateReplace";
    break;
  case 8:
    pcVar1 = "UpdateReplaceEmbedded";
    break;
  default:
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e3d3 */

char * FUN_0040e3d3(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "None";
  }
  else if (param_1 == 1) {
    pcVar1 = "Partial";
  }
  else if (param_1 == 2) {
    pcVar1 = "Complete";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e402 */

char * FUN_0040e402(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "None";
  }
  else if (param_1 == 1) {
    pcVar1 = "Register";
  }
  else if (param_1 == 2) {
    pcVar1 = "Unregister";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e431 */

void FUN_0040e431(void)

{
  DAT_00456f54 = DAT_00456f54 + 1;
  return;
}



/* Function: FUN_0040e438 */

char * FUN_0040e438(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "None";
  }
  else if (param_1 == 1) {
    pcVar1 = "AddLocal";
  }
  else if (param_1 == 2) {
    pcVar1 = "AddSource";
  }
  else if (param_1 == 3) {
    pcVar1 = "AddDefault";
  }
  else if (param_1 == 4) {
    pcVar1 = "Reinstall";
  }
  else if (param_1 == 5) {
    pcVar1 = "Advertise";
  }
  else if (param_1 == 6) {
    pcVar1 = "Remove";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e48f */

char * FUN_0040e48f(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "Unknown";
  }
  else if (param_1 == 1) {
    pcVar1 = "Absent";
  }
  else if (param_1 == 2) {
    pcVar1 = "Advertised";
  }
  else if (param_1 == 3) {
    pcVar1 = "Local";
  }
  else if (param_1 == 4) {
    pcVar1 = "Source";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e4d2 */

char * FUN_0040e4d2(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "None";
  }
  else if (param_1 == 1) {
    pcVar1 = "UserManaged";
  }
  else if (param_1 == 2) {
    pcVar1 = "UserUnmanaged";
  }
  else if (param_1 == 4) {
    pcVar1 = "Machine";
  }
  else if (param_1 == 7) {
    pcVar1 = "All";
  }
  else if (param_1 == 8) {
    pcVar1 = "AllUserManaged";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e522 */

DWORD FUN_0040e522(int *param_1,LPCRITICAL_SECTION param_2,int param_3,LPCWSTR param_4)

{
  uint *puVar1;
  int *piVar2;
  PCNZWCH pWVar3;
  int *piVar4;
  DWORD DVar5;
  DWORD DVar6;
  short *psVar7;
  int iVar8;
  char *pcVar9;
  WCHAR *local_8;
  
  piVar4 = param_1;
  puVar1 = (uint *)(param_1 + 2);
  local_8 = (WCHAR *)0x0;
  FUN_0040dfae(puVar1);
  if (((*puVar1 & 2) != 0) || ((*puVar1 & 4) != 0)) {
    if ((*puVar1 & 4) == 0) {
      if ((*puVar1 & 2) != 0) {
        iVar8 = 3;
        goto LAB_0040e55d;
      }
    }
    else {
      iVar8 = 4;
LAB_0040e55d:
      FUN_00430eb8(iVar8,0);
    }
    psVar7 = (short *)param_1[3];
    if (((psVar7 == (short *)0x0) || (*psVar7 == 0)) &&
       (((short *)param_1[4] == (short *)0x0 || (*(short *)param_1[4] == 0)))) {
      FUN_0043167e((WCHAR *)0x0,L"Setup",0,&DAT_00442778,param_1 + 3,(undefined4 *)0x0);
    }
  }
  piVar2 = param_1 + 3;
  if (((short *)*piVar2 == (short *)0x0) || (*(short *)*piVar2 == 0)) {
    if (((short *)param_1[4] == (short *)0x0) || (*(short *)param_1[4] == 0)) {
      FUN_00430995();
    }
    else {
      DVar5 = FUN_0040e054((int *)&local_8);
      if ((int)DVar5 < 0) {
        pcVar9 = "Failed to get non-session specific TEMP folder.";
        goto LAB_0040e733;
      }
      DVar5 = FUN_00430d33(local_8,(LPCWSTR)param_1[4],0,(short *)param_1[5],0,0,piVar2);
      if (-1 < (int)DVar5) goto LAB_0040e6aa;
      FUN_00430995();
    }
    DVar5 = 0;
    *param_1 = 2;
LAB_0040e6bd:
    if (*piVar4 != 1) goto LAB_0040e757;
    psVar7 = FUN_00431b86((short *)*piVar2);
    if ((psVar7 == (short *)0x0) || (*psVar7 == 0)) {
      DVar5 = FUN_00433f88(piVar4 + 4,(LPCWSTR)*piVar2,0);
      if (-1 < (int)DVar5) {
LAB_0040e73d:
        pWVar3 = (PCNZWCH)piVar4[1];
        if ((pWVar3 != (PCNZWCH)0x0) && (*pWVar3 != L'\0')) {
          FUN_0040461f(param_2,pWVar3,*piVar2,0);
        }
        goto LAB_0040e757;
      }
      pcVar9 = "Failed to copy full log path to prefix.";
    }
    else {
      DVar5 = FUN_00433f88(piVar4 + 4,(LPCWSTR)*piVar2,(int)psVar7 - *piVar2 >> 1);
      if ((int)DVar5 < 0) {
        pcVar9 = "Failed to copy log path to prefix.";
      }
      else {
        DVar5 = FUN_00433f88(piVar4 + 5,psVar7 + 1,0);
        if (-1 < (int)DVar5) goto LAB_0040e73d;
        pcVar9 = "Failed to copy log extension to extension.";
      }
    }
  }
  else {
    param_1 = (int *)0x0;
    DVar5 = FUN_00437949((int *)&local_8);
    if (-1 < (int)DVar5) {
      do {
        if (param_1 != (int *)0x0) {
          Sleep(2000);
        }
        DVar6 = FUN_00430d33(local_8,(LPCWSTR)*piVar2,0,(short *)0x0,piVar4[2] & 1,0,piVar2);
        if (((*(byte *)(piVar4 + 2) & 1) != 0) && (DVar6 == 0x80070020)) {
          param_1 = (int *)((int)param_1 + 1);
        }
      } while ((param_1 != (int *)0x0) && (param_1 < (int *)0x4));
      DVar5 = DVar6;
      if ((int)DVar6 < 0) {
        FUN_00430995();
        *piVar4 = 2;
        if ((*(byte *)(piVar4 + 2) & 1) == 0) {
          DVar5 = 0x80070656;
          FUN_00417551(param_3,param_4,0x80070656);
          if ((int)DVar6 < 0) {
            FUN_00430a57(DVar6,"Failed to open log: %ls");
            goto LAB_0040e757;
          }
        }
        else {
          DVar5 = 0;
        }
      }
      else {
LAB_0040e6aa:
        *piVar4 = 1;
      }
      goto LAB_0040e6bd;
    }
    pcVar9 = "Failed to get current directory.";
  }
LAB_0040e733:
  FUN_00430a57(DVar5,pcVar9);
LAB_0040e757:
  if (local_8 != (WCHAR *)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar5;
}



/* Function: FUN_0040e76e */

char * FUN_0040e76e(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "Unknown";
  }
  else if (param_1 == 1) {
    pcVar1 = "Obsolete";
  }
  else if (param_1 == 2) {
    pcVar1 = "Absent";
  }
  else if (param_1 == 3) {
    pcVar1 = "Cached";
  }
  else if (param_1 == 4) {
    pcVar1 = "Present";
  }
  else if (param_1 == 5) {
    pcVar1 = "Superseded";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e7bb */

char * FUN_0040e7bb(int param_1)

{
  char *pcVar1;
  
  pcVar1 = "PerMachine";
  if (param_1 == 0) {
    pcVar1 = "PerUser";
  }
  return pcVar1;
}



/* Function: FUN_0040e7d3 */

char * FUN_0040e7d3(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "None";
  }
  else if (param_1 == 1) {
    pcVar1 = "Downgrade";
  }
  else if (param_1 == 2) {
    pcVar1 = "MinorUpdate";
  }
  else if (param_1 == 3) {
    pcVar1 = "MajorUpgrade";
  }
  else if (param_1 == 4) {
    pcVar1 = "Remove";
  }
  else if (param_1 == 5) {
    pcVar1 = "Install";
  }
  else if (param_1 == 6) {
    pcVar1 = "Repair";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e82a */

char * FUN_0040e82a(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "None";
  }
  else if (param_1 == 1) {
    pcVar1 = "Detect";
  }
  else if (param_1 == 2) {
    pcVar1 = "Upgrade";
  }
  else if (param_1 == 3) {
    pcVar1 = "Addon";
  }
  else if (param_1 == 4) {
    pcVar1 = "Patch";
  }
  else if (param_1 == 5) {
    pcVar1 = "Dependent";
  }
  else if (param_1 == 6) {
    pcVar1 = "Update";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e881 */

char * FUN_0040e881(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "None";
  }
  else if (param_1 == 1) {
    pcVar1 = "ForceAbsent";
  }
  else if (param_1 == 2) {
    pcVar1 = "Absent";
  }
  else if (param_1 == 3) {
    pcVar1 = "Cache";
  }
  else if (param_1 == 4) {
    pcVar1 = "Present";
  }
  else if (param_1 == 5) {
    pcVar1 = "Repair";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e8ce */

char * FUN_0040e8ce(int param_1)

{
  char *pcVar1;
  
  if (param_1 == 0) {
    pcVar1 = "None";
  }
  else if (param_1 == 1) {
    pcVar1 = "Required";
  }
  else if (param_1 == 2) {
    pcVar1 = "Initiated";
  }
  else {
    pcVar1 = "Invalid";
  }
  return pcVar1;
}



/* Function: FUN_0040e8fd */

char * FUN_0040e8fd(int param_1)

{
  char *pcVar1;
  
  pcVar1 = "rollback";
  if (param_1 == 0) {
    pcVar1 = "execute";
  }
  return pcVar1;
}



/* Function: FUN_0040e915 */

int FUN_0040e915(int param_1,int param_2,int param_3,undefined4 param_4,LPCRITICAL_SECTION param_5,
                int *param_6)

{
  short *psVar1;
  int iVar2;
  PCNZWCH pWVar3;
  char *pcVar4;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  if (param_3 == 0) {
    psVar1 = *(short **)(param_1 + 4);
  }
  else {
    psVar1 = *(short **)(param_1 + 8);
  }
  if (psVar1 == (short *)0x0) {
    return 0;
  }
  if (*psVar1 == 0) {
    return 0;
  }
  iVar2 = FUN_00433cea((int *)&local_8,L"%ls%hs%ls_%u_%ls%ls.%ls");
  if (iVar2 < 0) {
    pcVar4 = "Failed to allocate path for package log.";
  }
  else {
    if (param_3 == 0) {
      pWVar3 = *(PCNZWCH *)(param_1 + 4);
    }
    else {
      pWVar3 = *(PCNZWCH *)(param_1 + 8);
    }
    iVar2 = FUN_0040461f(param_5,pWVar3,(int)local_8,0);
    if (iVar2 < 0) {
      pcVar4 = "Failed to set log path into variable.";
    }
    else {
      if ((param_6 == (int *)0x0) || (iVar2 = FUN_00433f88(param_6,local_8,0), -1 < iVar2))
      goto LAB_0040e9fb;
      pcVar4 = "Failed to copy package log path.";
    }
  }
  FUN_00430a57(iVar2,pcVar4);
LAB_0040e9fb:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar2;
}



/* Function: FUN_0040ea12 */

wchar_t * FUN_0040ea12(wchar_t *param_1)

{
  wchar_t *pwVar1;
  
  pwVar1 = L"Unknown";
  if (param_1 != (wchar_t *)0x0) {
    pwVar1 = param_1;
  }
  return pwVar1;
}



/* Function: FUN_0040ea26 */

char * FUN_0040ea26(int param_1)

{
  char *pcVar1;
  
  pcVar1 = "true";
  if (param_1 == 0) {
    pcVar1 = "false";
  }
  return pcVar1;
}



/* Function: FUN_0040ea3e */

undefined4 * FUN_0040ea3e(void)

{
  int iVar1;
  undefined4 *puVar2;
  
  iVar1 = FUN_0040e268((char *)&DAT_00456f58,0x28,"%I64u.%I64u.%I64u.%I64u");
  if (iVar1 < 0) {
    puVar2 = &DAT_00456f58;
    for (iVar1 = 10; iVar1 != 0; iVar1 = iVar1 + -1) {
      *puVar2 = 0;
      puVar2 = puVar2 + 1;
    }
  }
  return &DAT_00456f58;
}



/* Function: FUN_0040ea93 */

undefined4
FUN_0040ea93(undefined4 param_1,void *param_2,rsize_t param_3,undefined4 *param_4,SIZE_T *param_5)

{
  SIZE_T _DstSize;
  rsize_t _DstSize_00;
  void *_Dst;
  undefined4 uVar1;
  
  uVar1 = 0;
  _DstSize_00 = param_3;
  if (param_2 == (void *)0x0) {
    _DstSize_00 = 0;
  }
  _DstSize = _DstSize_00 + 8;
  param_3 = _DstSize_00;
  _Dst = (void *)FUN_00431078(_DstSize,0);
  if (_Dst == (void *)0x0) {
    uVar1 = 0x8007000e;
    FUN_004300d9();
    FUN_00430a57(0x8007000e,"Failed to allocate memory for message.");
  }
  else {
    _memcpy_s(_Dst,_DstSize,&param_1,4);
    _memcpy_s((void *)((int)_Dst + 4),_DstSize_00 + 4,&param_3,4);
    if (param_3 != 0) {
      _memcpy_s((void *)((int)_Dst + 8),_DstSize_00,param_2,param_3);
    }
    *param_5 = _DstSize;
    *param_4 = _Dst;
  }
  return uVar1;
}



/* Function: FUN_0040eb2e */

DWORD FUN_0040eb2e(HANDLE param_1,PCNZWCH param_2,int *param_3)

{
  BOOL BVar1;
  DWORD DVar2;
  int iVar3;
  uint uVar4;
  char *pcVar5;
  DWORD local_1c [4];
  uint local_c;
  PCNZWCH local_8;
  
  local_8 = (PCNZWCH)0x0;
  local_c = 0;
  local_1c[2] = 0;
  local_1c[3] = 0;
  local_1c[0] = GetCurrentProcessId();
  local_1c[1] = 0;
  BVar1 = ReadFile(param_1,&local_c,4,local_1c + 3,(LPOVERLAPPED)0x0);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar5 = "Failed to read size of verification secret from parent pipe.";
  }
  else if (local_c >> 1 < 0x100) {
    uVar4 = FUN_00433bdf((int *)&local_8,(local_c >> 1) + 1);
    if ((int)uVar4 < 0) {
      pcVar5 = "Failed to allocate buffer for verification secret.";
    }
    else {
      BVar1 = ReadFile(param_1,local_8,local_c,local_1c + 3,(LPOVERLAPPED)0x0);
      if (BVar1 == 0) {
        DVar2 = GetLastError();
        uVar4 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar4 = DVar2;
        }
        if (-1 < (int)uVar4) {
          uVar4 = 0x80004005;
        }
        FUN_004300d9();
        pcVar5 = "Failed to read verification secret from parent pipe.";
      }
      else {
        iVar3 = CompareStringW(0,0,local_8,-1,param_2,-1);
        if (iVar3 != 2) {
          FUN_004300d9();
          pcVar5 = "Verification secret from parent does not match.";
          goto LAB_0040ebcc;
        }
        BVar1 = ReadFile(param_1,local_1c + 2,4,local_1c + 3,(LPOVERLAPPED)0x0);
        if (BVar1 == 0) {
          DVar2 = GetLastError();
          uVar4 = DVar2 & 0xffff | 0x80070000;
          if ((int)DVar2 < 1) {
            uVar4 = DVar2;
          }
          if (-1 < (int)uVar4) {
            uVar4 = 0x80004005;
          }
          FUN_004300d9();
          pcVar5 = "Failed to read verification process id from parent pipe.";
        }
        else {
          if (*param_3 == 0) {
            *param_3 = local_1c[2];
          }
          else if (*param_3 != local_1c[2]) {
            FUN_004300d9();
            pcVar5 = "Verification process id from parent does not match.";
            goto LAB_0040ebcc;
          }
          BVar1 = WriteFile(param_1,local_1c,4,local_1c + 1,(LPOVERLAPPED)0x0);
          if (BVar1 != 0) goto LAB_0040ed1a;
          DVar2 = GetLastError();
          uVar4 = DVar2 & 0xffff | 0x80070000;
          if ((int)DVar2 < 1) {
            uVar4 = DVar2;
          }
          if (-1 < (int)uVar4) {
            uVar4 = 0x80004005;
          }
          FUN_004300d9();
          pcVar5 = "Failed to inform parent process that child is running.";
        }
      }
    }
  }
  else {
    FUN_004300d9();
    pcVar5 = "Verification secret from parent is too big.";
LAB_0040ebcc:
    uVar4 = 0x8007000d;
  }
  FUN_00430a57(uVar4,pcVar5);
LAB_0040ed1a:
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar4;
}



/* Function: FUN_0040ed57 */

void FUN_0040ed57(int param_1)

{
  if (*(int *)(param_1 + 8) != 0) {
    if (*(int *)(param_1 + 0xc) != 0) {
      FUN_00431137(*(LPVOID *)(param_1 + 0xc));
      *(undefined4 *)(param_1 + 0xc) = 0;
    }
    *(undefined4 *)(param_1 + 8) = 0;
  }
  return;
}



/* Function: FUN_0040ed7f */

DWORD FUN_0040ed7f(HANDLE param_1,undefined4 *param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  LPVOID lpBuffer;
  uint uVar3;
  uint uVar4;
  char *pcVar5;
  undefined4 local_10;
  SIZE_T local_c;
  DWORD local_8;
  
  uVar4 = 0;
  local_10 = 0;
  local_c = 0;
  local_8 = 0;
  uVar3 = 0;
  do {
    BVar1 = ReadFile(param_1,(LPVOID)((int)&local_10 + uVar3),8 - uVar3,&local_8,(LPOVERLAPPED)0x0);
    if (BVar1 == 0) {
      DVar2 = GetLastError();
      if (DVar2 == 0xea) {
        uVar4 = 0;
      }
      else {
        if (DVar2 == 0x6d) {
          local_10 = 0;
          local_c = 0;
          uVar4 = 1;
          break;
        }
        uVar4 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar4 = DVar2;
        }
        if ((int)uVar4 < 0) {
          FUN_004300d9();
          pcVar5 = "Failed to read message from pipe.";
          goto LAB_0040ee95;
        }
      }
    }
    uVar3 = uVar3 + local_8;
  } while (uVar3 < 8);
  *param_2 = local_10;
  param_2[1] = local_c;
  if (local_c != 0) {
    lpBuffer = (LPVOID)FUN_00431078(local_c,0);
    param_2[3] = lpBuffer;
    if (lpBuffer == (LPVOID)0x0) {
      uVar4 = 0x8007000e;
      FUN_004300d9();
      pcVar5 = "Failed to allocate data for message.";
    }
    else {
      BVar1 = ReadFile(param_1,lpBuffer,param_2[1],&local_8,(LPOVERLAPPED)0x0);
      if (BVar1 != 0) {
        param_2[2] = 1;
        goto LAB_0040eea6;
      }
      DVar2 = GetLastError();
      uVar4 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar4 = DVar2;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to read data for message.";
    }
LAB_0040ee95:
    FUN_00430a57(uVar4,pcVar5);
  }
LAB_0040eea6:
  if ((param_2[2] == 0) && (param_2[3] != 0)) {
    FUN_00431137((LPVOID)param_2[3]);
  }
  return uVar4;
}



/* Function: FUN_0040eec3 */

DWORD FUN_0040eec3(HANDLE param_1,undefined4 param_2,void *param_3,rsize_t param_4)

{
  uint uVar1;
  BOOL BVar2;
  DWORD DVar3;
  uint uVar4;
  char *pcVar5;
  LPCVOID local_c;
  SIZE_T local_8;
  
  uVar4 = 0;
  local_c = (LPCVOID)0x0;
  local_8 = 0;
  uVar1 = FUN_0040ea93(param_2,param_3,param_4,&local_c,&local_8);
  if ((int)uVar1 < 0) {
    pcVar5 = "Failed to allocate message to write.";
LAB_0040ef56:
    FUN_00430a57(uVar1,pcVar5);
  }
  else {
    param_4 = 0;
    if (local_8 != 0) {
      do {
        BVar2 = WriteFile(param_1,local_c,local_8 - uVar4,&param_4,(LPOVERLAPPED)0x0);
        if (BVar2 == 0) {
          DVar3 = GetLastError();
          uVar1 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            uVar1 = DVar3;
          }
          if (-1 < (int)uVar1) {
            uVar1 = 0x80004005;
          }
          FUN_004300d9();
          pcVar5 = "Failed to write message type to pipe.";
          goto LAB_0040ef56;
        }
        uVar4 = uVar4 + param_4;
      } while (uVar4 < local_8);
    }
  }
  if (local_c != (LPVOID)0x0) {
    FUN_00431137(local_c);
  }
  return uVar1;
}



/* Function: FUN_0040ef74 */

DWORD FUN_0040ef74(int param_1,int param_2)

{
  DWORD *pDVar1;
  uint uVar2;
  HANDLE pvVar3;
  DWORD DVar4;
  uint uVar5;
  char *pcVar6;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  uVar2 = FUN_00433cea((int *)&local_8,L"\\\\.\\pipe\\%ls");
  if ((int)uVar2 < 0) {
    FUN_00430a57(uVar2,"Failed to allocate name of parent pipe.");
    goto LAB_0040f137;
  }
  uVar2 = 0x8000ffff;
  uVar5 = 0;
  do {
    if (0x707 < uVar5) break;
    pvVar3 = CreateFileW(local_8,0xc0000000,0,(LPSECURITY_ATTRIBUTES)0x0,3,0,(HANDLE)0x0);
    *(HANDLE *)(param_1 + 0x10) = pvVar3;
    if (pvVar3 == (HANDLE)0xffffffff) {
      DVar4 = GetLastError();
      uVar2 = DVar4 & 0xffff | 0x80070000;
      if ((int)DVar4 < 1) {
        uVar2 = DVar4;
      }
      if (uVar2 == 0x80070002) {
        uVar2 = 0x800705b4;
      }
      Sleep(100);
    }
    else {
      uVar2 = 0;
    }
    uVar5 = uVar5 + 1;
  } while ((int)uVar2 < 0);
  if ((int)uVar2 < 0) {
LAB_0040f019:
    FUN_004300d9();
    pcVar6 = "Failed to open parent pipe: %ls";
  }
  else {
    pDVar1 = (DWORD *)(param_1 + 8);
    uVar2 = FUN_0040eb2e(*(HANDLE *)(param_1 + 0x10),*(PCNZWCH *)(param_1 + 4),(int *)pDVar1);
    if ((int)uVar2 < 0) {
LAB_0040f045:
      pcVar6 = "Failed to verify parent pipe: %ls";
    }
    else {
      if (param_2 != 0) {
        uVar2 = FUN_00433cea((int *)&local_8,L"\\\\.\\pipe\\%ls.Cache");
        if ((int)uVar2 < 0) {
          FUN_00430a57(uVar2,"Failed to allocate name of parent cache pipe.");
          goto LAB_0040f137;
        }
        pvVar3 = CreateFileW(local_8,0xc0000000,0,(LPSECURITY_ATTRIBUTES)0x0,3,0,(HANDLE)0x0);
        *(HANDLE *)(param_1 + 0x14) = pvVar3;
        if (pvVar3 == (HANDLE)0xffffffff) {
          DVar4 = GetLastError();
          uVar2 = DVar4 & 0xffff | 0x80070000;
          if ((int)DVar4 < 1) {
            uVar2 = DVar4;
          }
          if (-1 < (int)uVar2) {
            uVar2 = 0x80004005;
          }
          goto LAB_0040f019;
        }
        uVar2 = FUN_0040eb2e(pvVar3,*(PCNZWCH *)(param_1 + 4),(int *)pDVar1);
        if ((int)uVar2 < 0) goto LAB_0040f045;
      }
      pvVar3 = OpenProcess(0x100000,0,*pDVar1);
      *(HANDLE *)(param_1 + 0xc) = pvVar3;
      if (pvVar3 != (HANDLE)0x0) goto LAB_0040f137;
      DVar4 = GetLastError();
      uVar2 = DVar4 & 0xffff | 0x80070000;
      if ((int)DVar4 < 1) {
        uVar2 = DVar4;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
      pcVar6 = "Failed to open companion process with PID: %u";
    }
  }
  FUN_00430a57(uVar2,pcVar6);
LAB_0040f137:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar2;
}



/* Function: FUN_0040f14d */

void FUN_0040f14d(undefined4 *param_1)

{
  int iVar1;
  undefined4 *puVar2;
  
  puVar2 = param_1;
  for (iVar1 = 6; iVar1 != 0; iVar1 = iVar1 + -1) {
    *puVar2 = 0;
    puVar2 = puVar2 + 1;
  }
  param_1[4] = 0xffffffff;
  param_1[5] = 0xffffffff;
  return;
}



/* Function: FUN_0040f16a */

void FUN_0040f16a(int *param_1)

{
  int iVar1;
  int *piVar2;
  
  if (param_1[5] != -1) {
    CloseHandle((HANDLE)param_1[5]);
    param_1[5] = -1;
  }
  if (param_1[4] != -1) {
    CloseHandle((HANDLE)param_1[4]);
    param_1[4] = -1;
  }
  if (param_1[3] != 0) {
    CloseHandle((HANDLE)param_1[3]);
    param_1[3] = 0;
  }
  if (param_1[1] != 0) {
    FUN_004380ab((LPVOID)param_1[1]);
  }
  if (*param_1 != 0) {
    FUN_004380ab((LPVOID)*param_1);
  }
  piVar2 = param_1;
  for (iVar1 = 6; iVar1 != 0; iVar1 = iVar1 + -1) {
    *piVar2 = 0;
    piVar2 = piVar2 + 1;
  }
  param_1[4] = -1;
  param_1[5] = -1;
  return;
}



/* Function: FUN_0040f1d5 */

void FUN_0040f1d5(undefined4 *param_1,undefined4 *param_2)

{
  LPVOID pvVar1;
  LPVOID pvVar2;
  uint uVar3;
  int iVar4;
  char *pcVar5;
  LPVOID local_70;
  LPVOID local_6c;
  UUID local_68;
  OLECHAR local_58 [40];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_6c = (LPVOID)0x0;
  local_70 = (LPVOID)0x0;
  local_68.Data1 = 0;
  local_68.Data2 = 0;
  local_68.Data3 = 0;
  local_68.Data4[0] = '\0';
  local_68.Data4[1] = '\0';
  local_68.Data4[2] = '\0';
  local_68.Data4[3] = '\0';
  local_68.Data4[4] = '\0';
  local_68.Data4[5] = '\0';
  local_68.Data4[6] = '\0';
  local_68.Data4[7] = '\0';
  uVar3 = UuidCreate(&local_68);
  uVar3 = uVar3 | 1;
  if ((int)uVar3 < 0) {
LAB_0040f27b:
    pcVar5 = "Failed to create pipe guid.";
  }
  else {
    iVar4 = StringFromGUID2(&local_68,local_58,0x27);
    if (iVar4 == 0) {
LAB_0040f29d:
      FUN_004300d9();
      pcVar5 = "Failed to convert pipe guid into string.";
      uVar3 = 0x8007000e;
    }
    else {
      uVar3 = FUN_00433cea((int *)&local_6c,L"BurnPipe.%s");
      if ((int)uVar3 < 0) {
        pcVar5 = "Failed to allocate pipe name.";
      }
      else {
        uVar3 = UuidCreate(&local_68);
        uVar3 = uVar3 | 1;
        if ((int)uVar3 < 0) {
          FUN_004300d9();
          goto LAB_0040f27b;
        }
        iVar4 = StringFromGUID2(&local_68,local_58,0x27);
        if (iVar4 == 0) goto LAB_0040f29d;
        uVar3 = FUN_00433f88((int *)&local_70,local_58,0);
        pvVar2 = local_6c;
        pvVar1 = local_70;
        if (-1 < (int)uVar3) {
          local_6c = (LPVOID)0x0;
          *param_1 = pvVar2;
          local_70 = (LPVOID)0x0;
          *param_2 = pvVar1;
          goto LAB_0040f2ec;
        }
        pcVar5 = "Failed to allocate pipe secret.";
      }
    }
  }
  FUN_00430a57(uVar3,pcVar5);
LAB_0040f2ec:
  if (local_70 != (LPVOID)0x0) {
    FUN_004380ab(local_70);
  }
  if (local_6c != (LPVOID)0x0) {
    FUN_004380ab(local_6c);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0040f31a */

DWORD FUN_0040f31a(int param_1,int param_2,undefined4 *param_3)

{
  int iVar1;
  DWORD DVar2;
  LPSECURITY_ATTRIBUTES lpSecurityAttributes;
  HANDLE hObject;
  HANDLE pvVar3;
  uint uVar4;
  char *pcVar5;
  _SECURITY_ATTRIBUTES local_1c;
  HANDLE local_10;
  HLOCAL local_c;
  LPCWSTR local_8;
  
  local_10 = (HANDLE)0xffffffff;
  local_1c.nLength = 0;
  local_1c.lpSecurityDescriptor = (HLOCAL)0x0;
  local_c = (HLOCAL)0x0;
  local_1c.bInheritHandle = 0;
  local_8 = (LPCWSTR)0x0;
  if (param_2 == 0) {
    iVar1 = ConvertStringSecurityDescriptorToSecurityDescriptorW
                      (L"D:(A;;GA;;;SY)(A;;GA;;;BA)(A;;GRGW0x00100000;;;WD)",1,&local_c,0);
    if (iVar1 == 0) {
      DVar2 = GetLastError();
      uVar4 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar4 = DVar2;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar4,
                   "Failed to create the security descriptor for the connection event and pipe.");
      goto LAB_0040f4dc;
    }
    local_1c.nLength = 0xc;
  }
  local_1c.bInheritHandle = 0;
  local_1c.lpSecurityDescriptor = local_c;
  uVar4 = FUN_00433cea((int *)&local_8,L"\\\\.\\pipe\\%ls");
  if ((int)uVar4 < 0) {
    pcVar5 = "Failed to allocate full name of pipe: %ls";
  }
  else {
    lpSecurityAttributes = &local_1c;
    if (local_c == (HLOCAL)0x0) {
      lpSecurityAttributes = (LPSECURITY_ATTRIBUTES)0x0;
    }
    hObject = CreateNamedPipeW(local_8,0x80003,0,1,0x10000,0x10000,1,lpSecurityAttributes);
    if (hObject != (HANDLE)0xffffffff) {
      pvVar3 = local_10;
      if (param_2 == 0) {
LAB_0040f4d0:
        *(HANDLE *)(param_1 + 0x14) = pvVar3;
        *(HANDLE *)(param_1 + 0x10) = hObject;
        *param_3 = 0;
      }
      else {
        uVar4 = FUN_00433cea((int *)&local_8,L"\\\\.\\pipe\\%ls.Cache");
        if ((int)uVar4 < 0) {
          pcVar5 = "Failed to allocate full name of cache pipe: %ls";
        }
        else {
          pvVar3 = CreateNamedPipeW(local_8,0x80003,0,1,0x10000,0x10000,1,(LPSECURITY_ATTRIBUTES)0x0
                                   );
          if (pvVar3 != (HANDLE)0xffffffff) goto LAB_0040f4d0;
          DVar2 = GetLastError();
          uVar4 = DVar2 & 0xffff | 0x80070000;
          if ((int)DVar2 < 1) {
            uVar4 = DVar2;
          }
          if (-1 < (int)uVar4) {
            uVar4 = 0x80004005;
          }
          FUN_004300d9();
          pcVar5 = "Failed to create pipe: %ls";
        }
        FUN_00430a57(uVar4,pcVar5);
        CloseHandle(hObject);
      }
      goto LAB_0040f4dc;
    }
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar5 = "Failed to create pipe: %ls";
  }
  FUN_00430a57(uVar4,pcVar5);
LAB_0040f4dc:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (HLOCAL)0x0) {
    LocalFree(local_c);
  }
  return uVar4;
}



/* Function: FUN_0040f502 */

int FUN_0040f502(undefined4 param_1,int param_2,int param_3,undefined4 param_4)

{
  int iVar1;
  wchar_t *pwVar2;
  DWORD DVar3;
  undefined4 local_14;
  int local_10;
  LPVOID local_c;
  HANDLE local_8;
  
  GetCurrentProcessId();
  local_c = (LPVOID)0x0;
  local_10 = 0;
  local_14 = 0;
  local_8 = (HANDLE)0x0;
  iVar1 = FUN_00433cea((int *)&local_c,L"-q -%ls %ls %ls %u");
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to allocate parameters for elevated process.");
  }
  else {
    FUN_00436186(&local_10,&local_14);
    if ((local_10 < 5) || (pwVar2 = L"runas", param_3 == 0)) {
      pwVar2 = L"open";
    }
    iVar1 = FUN_004362ff(param_1,local_c,pwVar2,0,0,param_4,&local_8);
    if (iVar1 < 0) {
      FUN_00430a57(iVar1,"Failed to launch elevated child process: %ls");
    }
    else {
      DVar3 = GetProcessId(local_8);
      *(DWORD *)(param_2 + 8) = DVar3;
      *(HANDLE *)(param_2 + 0xc) = local_8;
      local_8 = (HANDLE)0x0;
    }
  }
  if (local_8 != (HANDLE)0x0) {
    CloseHandle(local_8);
    local_8 = (HANDLE)0x0;
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  return iVar1;
}



/* Function: FUN_0040f5e1 */

DWORD FUN_0040f5e1(undefined4 param_1,WORD param_2)

{
  DWORD DVar1;
  char *pcVar2;
  LPVOID local_10;
  HANDLE local_c;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  local_10 = (LPVOID)0x0;
  local_c = (HANDLE)0x0;
  GetCurrentProcessId();
  DVar1 = FUN_00431c19((int *)&local_8,(HMODULE)0x0);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to get current process path.";
  }
  else {
    DVar1 = FUN_00433cea((int *)&local_10,L"%ls -%ls %ls %ls %u");
    if (-1 < (int)DVar1) {
      DVar1 = FUN_00431ece(local_8,local_10,param_2,&local_c);
      if ((int)DVar1 < 0) {
        FUN_00430a57(DVar1,"Failed to launch parent process with unelevate disabled: %ls");
      }
      goto LAB_0040f672;
    }
    pcVar2 = "Failed to allocate parameters for elevated process.";
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_0040f672:
  if (local_c != (HANDLE)0x0) {
    CloseHandle(local_c);
    local_c = (HANDLE)0x0;
  }
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_0040f6a6 */

DWORD FUN_0040f6a6(HANDLE param_1,undefined *param_2,undefined4 param_3,undefined4 *param_4)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  int local_20;
  uint local_1c;
  undefined4 uStack_18;
  undefined4 *local_14;
  DWORD local_10;
  LPCSTR local_c;
  uint local_8;
  
  local_20 = 0;
  local_1c = 0;
  uStack_18 = 0;
  local_14 = (undefined4 *)0x0;
  local_8 = 0;
  local_c = (LPCSTR)0x0;
  local_10 = 0;
  DVar2 = FUN_0040ed7f(param_1,&local_20);
  do {
    if (DVar2 != 0) {
      if ((int)DVar2 < 0) {
        pcVar3 = "Failed to get message over pipe";
LAB_0040f7b1:
        FUN_00430a57(DVar2,pcVar3);
      }
      else if (DVar2 == 1) {
        DVar2 = 0;
      }
LAB_0040f863:
      if (local_c != (LPCSTR)0x0) {
        FUN_004380ab(local_c);
      }
      FUN_0040ed57((int)&local_20);
      return DVar2;
    }
    if (local_20 != -0xfffffff) {
      if (local_20 == -0xffffffe) {
        if ((local_14 == (undefined4 *)0x0) || (local_1c != 4)) {
          FUN_004300d9();
          pcVar3 = "No status returned to PipePumpMessages()";
          DVar2 = 0x80070057;
          goto LAB_0040f7b1;
        }
        *param_4 = *local_14;
      }
      else {
        if (local_20 != -0xffffffd) {
          if (param_2 == (undefined *)0x0) {
            DVar2 = 0x80070057;
          }
          else {
            DVar2 = (*(code *)param_2)(&local_20,param_3,&local_10);
          }
          DVar1 = local_10;
          if ((int)DVar2 < 0) {
            pcVar3 = "Failed to process message: %u";
            goto LAB_0040f724;
          }
          goto LAB_0040f767;
        }
        local_8 = 0;
        DVar2 = FUN_004302f8((int)local_14,local_1c,&local_8,param_4);
        if ((int)DVar2 < 0) {
          pcVar3 = "Failed to read returned result to PipePumpMessages()";
          goto LAB_0040f7b1;
        }
        if ((local_1c == 8) &&
           (DVar2 = FUN_004302f8((int)local_14,8,&local_8,param_4 + 1), (int)DVar2 < 0)) {
          pcVar3 = "Failed to read returned restart to PipePumpMessages()";
          goto LAB_0040f7b1;
        }
      }
      DVar2 = 0;
      goto LAB_0040f863;
    }
    local_8 = 0;
    DVar2 = FUN_0043043d((int)local_14,local_1c,&local_8,(int *)&local_c);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to read log message.";
      goto LAB_0040f7b1;
    }
    DVar2 = FUN_00430f66(local_c);
    DVar1 = DVar2;
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to write log message:\'%hs\'.";
LAB_0040f724:
      FUN_00430a57(DVar2,pcVar3);
      goto LAB_0040f863;
    }
LAB_0040f767:
    local_10 = DVar1;
    DVar2 = FUN_0040eec3(param_1,0xf0000002,&local_10,4);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to post result to child process.";
      goto LAB_0040f7b1;
    }
    FUN_0040ed57((int)&local_20);
    DVar2 = FUN_0040ed7f(param_1,&local_20);
  } while( true );
}



/* Function: FUN_0040f882 */

DWORD FUN_0040f882(HANDLE param_1,undefined4 param_2,void *param_3,rsize_t param_4,
                  undefined *param_5,undefined4 param_6,undefined4 *param_7)

{
  DWORD DVar1;
  char *pcVar2;
  undefined4 local_c;
  undefined4 local_8;
  
  local_c = 0;
  local_8 = 0;
  DVar1 = FUN_0040eec3(param_1,param_2,param_3,param_4);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to write send message to pipe.";
  }
  else {
    DVar1 = FUN_0040f6a6(param_1,param_5,param_6,&local_c);
    if (-1 < (int)DVar1) {
      *param_7 = local_c;
      return DVar1;
    }
    pcVar2 = "Failed to pump messages during send message to pipe.";
  }
  FUN_00430a57(DVar1,pcVar2);
  return DVar1;
}



/* Function: FUN_0040f8e4 */

DWORD FUN_0040f8e4(int param_1,undefined4 param_2,undefined4 param_3)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  void *local_c;
  rsize_t local_8;
  
  local_c = (void *)0x0;
  local_8 = 0;
  DVar1 = FUN_0043055b((int *)&local_c,(int *)&local_8,param_2);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write exit code to message buffer.";
  }
  else {
    DVar1 = FUN_0043055b((int *)&local_c,(int *)&local_8,param_3);
    if (-1 < (int)DVar1) {
      if ((*(int *)(param_1 + 0x14) == -1) ||
         (uVar2 = FUN_0040eec3(*(HANDLE *)(param_1 + 0x14),0xf0000003,local_c,local_8),
         -1 < (int)uVar2)) {
        uVar2 = FUN_0040eec3(*(HANDLE *)(param_1 + 0x10),0xf0000003,local_c,local_8);
        if ((int)uVar2 < 0) {
          pcVar3 = "Failed to post terminate message to child process.";
        }
        else {
          if (*(int *)(param_1 + 0xc) == 0) {
            return uVar2;
          }
          DVar1 = WaitForSingleObject(*(HANDLE *)(param_1 + 0xc),180000);
          if (DVar1 != 0xffffffff) {
            return uVar2;
          }
          DVar1 = GetLastError();
          uVar2 = DVar1 & 0xffff | 0x80070000;
          if ((int)DVar1 < 1) {
            uVar2 = DVar1;
          }
          if (-1 < (int)uVar2) {
            uVar2 = 0x80004005;
          }
          FUN_004300d9();
          pcVar3 = "Failed to wait for child process exit.";
        }
      }
      else {
        pcVar3 = "Failed to post terminate message to child process cache thread.";
      }
      FUN_00430a57(uVar2,pcVar3);
      return uVar2;
    }
    pcVar3 = "Failed to write restart to message buffer.";
  }
  FUN_00430a57(DVar1,pcVar3);
  return DVar1;
}



/* Function: FUN_0040f9dc */

DWORD FUN_0040f9dc(DWORD param_1)

{
  HANDLE hNamedPipe;
  int iVar1;
  BOOL BVar2;
  DWORD DVar3;
  uint uVar4;
  char *pcVar5;
  DWORD local_28 [4];
  LPCWSTR local_18;
  uint local_14;
  DWORD local_10;
  uint local_c;
  DWORD local_8;
  
  local_28[0] = *(DWORD *)(param_1 + 0x10);
  local_28[1] = *(undefined4 *)(param_1 + 0x14);
  local_18 = *(LPCWSTR *)(param_1 + 4);
  uVar4 = 0;
  iVar1 = lstrlenW(local_18);
  local_10 = iVar1 * 2;
  local_28[3] = GetCurrentProcessId();
  local_28[2] = 0;
  param_1 = 0;
  local_14 = 0;
  do {
    hNamedPipe = (HANDLE)local_28[local_14];
    if (hNamedPipe == (HANDLE)0xffffffff) {
      return uVar4;
    }
    local_8 = 1;
    BVar2 = SetNamedPipeHandleState(hNamedPipe,&local_8,(LPDWORD)0x0,(LPDWORD)0x0);
    if (BVar2 == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to set pipe to non-blocking.";
LAB_0040fca3:
      FUN_00430a57(uVar4,pcVar5);
      return uVar4;
    }
    local_c = 0;
    do {
      BVar2 = ConnectNamedPipe(hNamedPipe,(LPOVERLAPPED)0x0);
      if (BVar2 == 0) {
        DVar3 = GetLastError();
        if (DVar3 == 0x217) {
          uVar4 = 0;
          goto LAB_0040faa5;
        }
        if (DVar3 != 0x218) {
          uVar4 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            uVar4 = DVar3;
          }
          break;
        }
        if (0x707 < local_c) {
          uVar4 = 0x800705b4;
          goto LAB_0040fb5c;
        }
        local_c = local_c + 1;
        uVar4 = 0x80070218;
        Sleep(100);
      }
    } while (uVar4 == 0x80070218);
    if ((int)uVar4 < 0) {
LAB_0040fb5c:
      FUN_004300d9();
      pcVar5 = "Failed to wait for child to connect to pipe.";
      goto LAB_0040fca3;
    }
LAB_0040faa5:
    local_8 = 0;
    BVar2 = SetNamedPipeHandleState(hNamedPipe,&local_8,(LPDWORD)0x0,(LPDWORD)0x0);
    if (BVar2 == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to reset pipe to blocking.";
      goto LAB_0040fca3;
    }
    BVar2 = WriteFile(hNamedPipe,&local_10,4,&param_1,(LPOVERLAPPED)0x0);
    if (BVar2 == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to write secret length to pipe.";
      goto LAB_0040fca3;
    }
    BVar2 = WriteFile(hNamedPipe,local_18,local_10,&param_1,(LPOVERLAPPED)0x0);
    if (BVar2 == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to write secret to pipe.";
      goto LAB_0040fca3;
    }
    BVar2 = WriteFile(hNamedPipe,local_28 + 3,4,&param_1,(LPOVERLAPPED)0x0);
    if (BVar2 == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to write our process id to pipe.";
      goto LAB_0040fca3;
    }
    BVar2 = ReadFile(hNamedPipe,local_28 + 2,4,&param_1,(LPOVERLAPPED)0x0);
    if (BVar2 == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to read ACK from pipe.";
      goto LAB_0040fca3;
    }
    local_14 = local_14 + 1;
    if (1 < local_14) {
      return uVar4;
    }
  } while( true );
}



/* Function: FUN_0040fcb4 */

undefined4 * FUN_0040fcb4(int *param_1)

{
  int *piVar1;
  int iVar2;
  undefined4 *puVar3;
  undefined4 *puVar4;
  bool bVar5;
  
  piVar1 = (int *)param_1[1];
  iVar2 = *param_1;
  puVar3 = (undefined4 *)param_1[2];
  puVar4 = (undefined4 *)CoInitializeEx((LPVOID)0x0,0);
  bVar5 = -1 < (int)puVar4;
  if (bVar5) {
    puVar4 = FUN_00421c08(*(HANDLE *)(iVar2 + 0x48),iVar2 + 0xb8,(LPCRITICAL_SECTION)(iVar2 + 0x88),
                          iVar2 + 0x3d8,*(HANDLE *)(iVar2 + 0x480),piVar1,puVar3);
  }
  else {
    FUN_00430a57(puVar4,"Failed to initialize COM on cache thread.");
  }
  FUN_004087d4(iVar2 + 0xb8,(int)puVar4);
  if (bVar5) {
    CoUninitialize();
  }
  return puVar4;
}



/* Function: FUN_0040fd39 */

DWORD FUN_0040fd39(int param_1)

{
  short *psVar1;
  int iVar2;
  uint uVar3;
  DWORD DVar4;
  char *pcVar5;
  DWORD local_1c [3];
  undefined4 local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  uVar3 = 0;
  psVar1 = *(short **)(param_1 + 0x24);
  DVar4 = 0;
  local_8 = (LPCWSTR)0x0;
  local_10 = 0;
  local_c = (LPCWSTR)0x0;
  local_1c[0] = 0;
  local_1c[1] = 0;
  if ((psVar1 != (short *)0x0) && (*psVar1 != 0)) {
    DVar4 = FUN_00413be9(*(int *)(param_1 + 0x14),psVar1,(int *)&local_8);
    if ((int)DVar4 < 0) {
      pcVar5 = "Failed to get completed cache path.";
LAB_0040fe78:
      FUN_00430a57(DVar4,pcVar5);
      goto LAB_0040fe4e;
    }
    iVar2 = FUN_0043791e(local_8,(DWORD *)0x0);
    if ((iVar2 != 0) && (local_10 = 2, *(int *)(param_1 + 0x80) != 0)) {
      do {
        local_1c[2] = *(int *)(param_1 + 0x7c);
        DVar4 = FUN_004314a9(local_8,*(LPCWSTR *)(*(int *)(local_1c[2] + uVar3 * 8) + 0x18),
                             (int *)&local_c);
        if ((int)DVar4 < 0) {
          pcVar5 = "Failed to concat payload cache path.";
          goto LAB_0040fe78;
        }
        DVar4 = FUN_0043701a(local_c,local_1c);
        if ((((int)DVar4 < 0) ||
            (local_1c[0] != *(DWORD *)(*(int *)(local_1c[2] + uVar3 * 8) + 0x10))) ||
           (local_1c[1] != *(int *)(*(int *)(local_1c[2] + uVar3 * 8) + 0x14))) {
          FUN_00402003(2,0xa0000078);
          local_10 = 1;
          DVar4 = 0;
        }
        else {
          *(undefined4 *)(local_1c[2] + 4 + uVar3 * 8) = 1;
        }
        uVar3 = uVar3 + 1;
      } while (uVar3 < *(uint *)(param_1 + 0x80));
    }
  }
  *(undefined4 *)(param_1 + 0x44) = local_10;
LAB_0040fe4e:
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar4;
}



/* Function: FUN_0040fe82 */

void FUN_0040fe82(uint param_1,int param_2,int param_3,int *param_4,int param_5)

{
  int *piVar1;
  int iVar2;
  int *piVar3;
  uint uVar4;
  uint uVar5;
  int iVar6;
  uint uVar7;
  DWORD DVar8;
  
  piVar1 = param_4;
  if (param_1 == 0) {
    if (param_2 == 0) {
      if (((param_5 == 3) && (param_4[1] != 0)) && (iVar6 = param_4[1] + -1, -1 < iVar6)) {
        iVar2 = iVar6 * 0xe8;
        do {
          piVar3 = (int *)(*param_4 + iVar2);
          FUN_0040e402(piVar3[0x21]);
          FUN_0040e2bb(piVar3[0x1e]);
          FUN_0040e2bb(piVar3[0x1d]);
          FUN_0040e881(piVar3[0x1a]);
          FUN_0040e881(piVar3[0x19]);
          FUN_0040e82a(*piVar3);
          FUN_00402003(2,0x200000cf);
          iVar2 = iVar2 + -0xe8;
          iVar6 = iVar6 + -1;
        } while (-1 < iVar6);
      }
      uVar7 = 0;
      uVar4 = *(uint *)(param_3 + 0xc);
      param_1 = 0;
      if (uVar4 != 0) {
        do {
          uVar5 = param_1;
          if (param_5 == 3) {
            uVar5 = (uVar4 - param_1) - 1;
          }
          iVar6 = uVar5 * 0xd0 + *(int *)(param_3 + 8);
          FUN_0040e402(*(int *)(iVar6 + 0x6c));
          FUN_0040e33b(*(int *)(iVar6 + 0x58));
          FUN_0040e33b(*(int *)(iVar6 + 0x54));
          FUN_0040e2bb(*(undefined4 *)(iVar6 + 0x60));
          FUN_0040e2bb(*(undefined4 *)(iVar6 + 0x5c));
          FUN_0040e881(*(int *)(iVar6 + 0x50));
          FUN_0040e881(*(int *)(iVar6 + 0x4c));
          FUN_0040e76e(*(int *)(iVar6 + 0x40));
          FUN_00402003(2,0x200000c9);
          uVar4 = *(uint *)(param_3 + 0xc);
          param_1 = param_1 + 1;
        } while (param_1 < uVar4);
      }
      if (param_5 < 4) {
        return;
      }
      if (param_4[1] == 0) {
        return;
      }
      param_4 = (int *)0x0;
      do {
        piVar3 = (int *)(*piVar1 + (int)param_4);
        FUN_0040e402(piVar3[0x21]);
        FUN_0040e2bb(piVar3[0x1e]);
        FUN_0040e2bb(piVar3[0x1d]);
        FUN_0040e881(piVar3[0x1a]);
        FUN_0040e881(piVar3[0x19]);
        FUN_0040e82a(*piVar3);
        FUN_00402003(2,0x200000cf);
        uVar7 = uVar7 + 1;
        param_4 = param_4 + 0x3a;
      } while (uVar7 < (uint)piVar1[1]);
      return;
    }
    FUN_0040e402(*(int *)(param_2 + 0x6c));
    FUN_0040e2bb(*(undefined4 *)(param_2 + 0x60));
    FUN_0040e2bb(*(undefined4 *)(param_2 + 0x5c));
    FUN_0040e881(*(int *)(param_2 + 0x50));
    FUN_0040e881(*(int *)(param_2 + 0x4c));
    DVar8 = 0x200000d4;
  }
  else {
    FUN_0040e402(*(int *)(param_1 + 0x6c));
    FUN_0040e2bb(*(undefined4 *)(param_1 + 0x60));
    FUN_0040e2bb(*(undefined4 *)(param_1 + 0x5c));
    FUN_0040e881(*(int *)(param_1 + 0x50));
    FUN_0040e881(*(int *)(param_1 + 0x4c));
    DVar8 = 0x200000d3;
  }
  FUN_00402003(2,DVar8);
  return;
}



/* Function: FUN_00410095 */

DWORD FUN_00410095(short *param_1,int *param_2,int *param_3,int *param_4,int *param_5,int *param_6,
                  int *param_7,int *param_8,uint *param_9,int *param_10,int *param_11,int *param_12)

{
  WCHAR WVar1;
  DWORD DVar2;
  int iVar3;
  int iVar4;
  int *piVar5;
  LPCWSTR pWVar6;
  int iVar7;
  uint uVar8;
  wchar_t *pwVar9;
  char *pcVar10;
  LPWSTR *local_10;
  LPCWSTR local_c;
  int local_8;
  
  uVar8 = 0;
  local_8 = 0;
  local_10 = (LPWSTR *)0x0;
  local_c = (LPCWSTR)0x0;
  if ((param_1 == (short *)0x0) || (*param_1 == 0)) {
LAB_00410153:
    iVar7 = 1;
    if (1 < local_8) {
      do {
        WVar1 = *local_10[iVar7];
        if ((WVar1 != L'-') && (WVar1 != L'/')) goto LAB_00410949;
        iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"l",-1);
        if ((iVar3 == 2) ||
           (iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"log",-1), iVar3 == 2)) {
          *param_9 = *param_9 & 0xfffffffe;
          iVar7 = iVar7 + 1;
          if (local_8 <= iVar7) {
            FUN_004300d9();
            pcVar10 = "Must specify a path for log.";
            goto LAB_00410a69;
          }
          uVar8 = FUN_00433f88(param_10,local_10[iVar7],0);
          if ((int)uVar8 < 0) {
            pcVar10 = "Failed to copy log file path.";
            goto LAB_004108da;
          }
        }
        else {
          iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"?",-1);
          piVar5 = param_2;
          if (((iVar3 == 2) ||
              (iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"h",-1), iVar3 == 2)) ||
             (iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"help",-1), iVar3 == 2)) {
LAB_0041082c:
            *piVar5 = 1;
          }
          else {
            iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"q",-1);
            if (((iVar3 == 2) ||
                (iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"quiet",-1), iVar3 == 2)) ||
               ((iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"s",-1), iVar3 == 2 ||
                (iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"silent",-1), iVar3 == 2))))
            {
              param_2[1] = 2;
              if (param_2[2] == 0) {
                param_2[2] = 3;
              }
            }
            else {
              iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"passive",-1);
              if (iVar3 == 2) {
                param_2[1] = 3;
                if (param_2[2] == 0) {
                  param_2[2] = 3;
                }
              }
              else {
                iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"norestart",-1);
                if (iVar3 == 2) {
                  param_2[2] = 1;
                }
                else {
                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"forcerestart",-1);
                  if (iVar3 == 2) {
                    param_2[2] = 4;
                  }
                  else {
                    iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"promptrestart",-1);
                    if (iVar3 == 2) {
                      param_2[2] = 2;
                    }
                    else {
                      iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"layout",-1);
                      if (iVar3 == 2) {
                        if (*param_2 != 1) {
                          *param_2 = 2;
                        }
                        iVar3 = iVar7 + 1;
                        if (((iVar3 < local_8) && (*local_10[iVar7 + 1] != L'-')) &&
                           ((*local_10[iVar7 + 1] != L'/' &&
                            (uVar8 = FUN_0043191f(param_2 + 9,local_10[iVar3],(LPWSTR)0x3),
                            iVar7 = iVar3, (int)uVar8 < 0)))) {
                          pcVar10 = "Failed to copy path for layout directory.";
                          goto LAB_004108da;
                        }
                      }
                      else {
                        iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"uninstall",-1);
                        if (iVar3 == 2) {
                          if (*param_2 != 1) {
                            *param_2 = 3;
                          }
                        }
                        else {
                          iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"repair",-1);
                          if (iVar3 == 2) {
                            if (*param_2 != 1) {
                              *param_2 = 6;
                            }
                          }
                          else {
                            iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"modify",-1);
                            if (iVar3 == 2) {
                              if (*param_2 != 1) {
                                *param_2 = 5;
                              }
                            }
                            else {
                              iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"package",-1);
                              if ((iVar3 == 2) ||
                                 (iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"update",-1)
                                 , iVar3 == 2)) {
                                if (*param_2 == 0) {
                                  *param_2 = 4;
                                }
                              }
                              else {
                                iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"noaupause",-1
                                                      );
                                if (iVar3 == 2) {
                                  *param_6 = 0;
                                }
                                else {
                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,
                                                         L"keepaupaused",-1);
                                  if (iVar3 == 2) {
                                    if (*param_6 != 0) {
                                      *param_6 = 2;
                                    }
                                  }
                                  else {
                                    iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,L"parent",
                                                           -1);
                                    if (iVar3 == 2) {
                                      iVar7 = iVar7 + 1;
                                      if (local_8 <= iVar7) {
                                        FUN_004300d9();
                                        pcVar10 = "Must specify a value for parent.";
                                        goto LAB_00410a69;
                                      }
                                      uVar8 = FUN_00433f88(param_11,local_10[iVar7],0);
                                      if ((int)uVar8 < 0) {
                                        pcVar10 = "Failed to copy parent.";
                                        goto LAB_004108da;
                                      }
                                    }
                                    else {
                                      iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,
                                                             L"parent:none",-1);
                                      if (iVar3 == 2) {
                                        uVar8 = FUN_00433f88(param_11,L"",0);
                                        if ((int)uVar8 < 0) {
                                          pcVar10 = "Failed to initialize parent to none.";
                                          goto LAB_004108da;
                                        }
                                      }
                                      else {
                                        iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,
                                                               L"burn.log.append",-1);
                                        if (iVar3 != 2) {
                                          iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,
                                                                 L"burn.elevated",-1);
                                          if (iVar3 == 2) {
                                            if (local_8 <= iVar7 + 3) {
                                              FUN_004300d9();
                                              pcVar10 = 
                                              "Must specify the elevated name, token and parent process id."
                                              ;
                                              goto LAB_00410a69;
                                            }
                                            *param_7 = 3;
                                            uVar8 = FUN_00410b39(local_10 + iVar7 + 1,param_3);
                                            if (-1 < (int)uVar8) {
LAB_00410664:
                                              iVar7 = iVar7 + 3;
                                              goto LAB_004109b6;
                                            }
                                            pcVar10 = "Failed to parse elevated connection.";
                                          }
                                          else {
                                            iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,
                                                                   L"burn.unelevated",-1);
                                            if (iVar3 == 2) {
                                              if (local_8 <= iVar7 + 3) {
                                                FUN_004300d9();
                                                pcVar10 = 
                                                "Must specify the unelevated name, token and parent process id."
                                                ;
                                                goto LAB_00410a69;
                                              }
                                              *param_7 = 1;
                                              uVar8 = FUN_00410b39(local_10 + iVar7 + 1,param_3);
                                              if (-1 < (int)uVar8) goto LAB_00410664;
                                              pcVar10 = "Failed to parse unelevated connection.";
                                            }
                                            else {
                                              iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1,
                                                                     L"burn.embedded",-1);
                                              if (iVar3 != 2) {
                                                iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,-1
                                                                       ,L"burn.related.detect",-1);
                                                if (iVar3 == 2) {
                                                  iVar3 = 1;
LAB_00410731:
                                                  param_2[7] = iVar3;
                                                  FUN_0040e82a(iVar3);
                                                  DVar2 = 0x20000003;
                                                }
                                                else {
                                                  iVar4 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         -1,L"burn.related.upgrade",
                                                                         -1);
                                                  iVar3 = 2;
                                                  if (iVar4 == 2) goto LAB_00410731;
                                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         -1,L"burn.related.addon",-1
                                                                        );
                                                  if (iVar3 == 2) {
                                                    iVar3 = 3;
                                                    goto LAB_00410731;
                                                  }
                                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         -1,L"burn.related.patch",-1
                                                                        );
                                                  if (iVar3 == 2) {
                                                    iVar3 = 4;
                                                    goto LAB_00410731;
                                                  }
                                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         -1,L"burn.related.update",
                                                                         -1);
                                                  if (iVar3 == 2) {
                                                    iVar3 = 6;
                                                    goto LAB_00410731;
                                                  }
                                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         -1,L"burn.passthrough",-1);
                                                  if (iVar3 == 2) {
                                                    param_2[8] = 1;
                                                    goto LAB_004109b6;
                                                  }
                                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         -1,
                                                  L"burn.disable.unelevate",-1);
                                                  piVar5 = param_8;
                                                  if (iVar3 == 2) goto LAB_0041082c;
                                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         -1,L"burn.runonce",-1);
                                                  if (iVar3 == 2) {
                                                    *param_5 = 3;
                                                    goto LAB_004109b6;
                                                  }
                                                  iVar3 = lstrlenW(L"burn.ignoredependencies");
                                                  pwVar9 = L"burn.ignoredependencies";
                                                  iVar4 = lstrlenW(L"burn.ignoredependencies");
                                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         iVar4,pwVar9,iVar3);
                                                  if (iVar3 == 2) {
                                                    iVar3 = lstrlenW(L"burn.ignoredependencies");
                                                    if ((local_10[iVar7][iVar3 + 1] == L'=') &&
                                                       (pWVar6 = local_10[iVar7] + iVar3 + 2,
                                                       *pWVar6 != L'\0')) {
                                                      uVar8 = FUN_00433f88(param_12,pWVar6,0);
                                                      if ((int)uVar8 < 0) {
                                                        pcVar10 = 
                                                  "Failed to allocate the list of dependencies to ignore."
                                                  ;
                                                  goto LAB_004108da;
                                                  }
                                                  goto LAB_004109b6;
                                                  }
                                                  FUN_004300d9();
                                                  uVar8 = 0x80070057;
                                                  FUN_00430a57(0x80070057,
                                                                                                                              
                                                  "Missing required parameter for switch: %ls");
                                                  goto LAB_00410b03;
                                                  }
                                                  iVar3 = lstrlenW(local_10[iVar7] + 1);
                                                  iVar4 = lstrlenW(L"burn.");
                                                  if (iVar3 < iVar4) {
LAB_00410949:
                                                    FUN_004312a7(param_2 + 3,local_10[iVar7]);
                                                    goto LAB_004109b6;
                                                  }
                                                  iVar3 = lstrlenW(L"burn.");
                                                  pwVar9 = L"burn.";
                                                  iVar4 = lstrlenW(L"burn.");
                                                  iVar3 = CompareStringW(0x7f,1,local_10[iVar7] + 1,
                                                                         iVar4,pwVar9,iVar3);
                                                  if (iVar3 != 2) goto LAB_00410949;
                                                  DVar2 = 0xa0000002;
                                                }
                                                FUN_00402003(2,DVar2);
                                                goto LAB_004109b6;
                                              }
                                              if (local_8 <= iVar7 + 3) {
                                                FUN_004300d9();
                                                pcVar10 = 
                                                "Must specify the embedded name, token and parent process id."
                                                ;
                                                goto LAB_00410a69;
                                              }
                                              *param_5 = 2;
                                              uVar8 = FUN_00410b39(local_10 + iVar7 + 1,param_4);
                                              if (-1 < (int)uVar8) goto LAB_00410664;
                                              pcVar10 = "Failed to parse embedded connection.";
                                            }
                                          }
LAB_004108da:
                                          FUN_00430a57(uVar8,pcVar10);
                                          goto LAB_00410b03;
                                        }
                                        iVar7 = iVar7 + 1;
                                        if (local_8 <= iVar7) {
                                          FUN_004300d9();
                                          pcVar10 = "Must specify a path for append log.";
LAB_00410a69:
                                          uVar8 = 0x80070057;
                                          goto LAB_004108da;
                                        }
                                        uVar8 = FUN_00433f88(param_10,local_10[iVar7],0);
                                        if ((int)uVar8 < 0) {
                                          pcVar10 = "Failed to copy append log file path.";
                                          goto LAB_004108da;
                                        }
                                        *param_9 = *param_9 | 1;
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
LAB_004109b6:
        iVar7 = iVar7 + 1;
      } while (iVar7 < local_8);
    }
    if ((*param_5 == 3) || ((*param_7 != 2 && (*param_7 != 3)))) {
      if (*param_5 == 2) {
        param_2[1] = 1;
      }
    }
    else {
      *param_5 = 1;
    }
    if (*param_2 == 0) {
      *param_2 = 4;
    }
    if (param_2[1] == 0) {
      param_2[1] = 4;
    }
    if (param_2[2] == 0) {
      param_2[2] = 2;
    }
LAB_00410b03:
    if (local_10 != (LPWSTR *)0x0) {
      LocalFree(local_10);
    }
  }
  else {
    uVar8 = FUN_00433c35((int *)&local_c,L"ignored ",0);
    if ((int)uVar8 < 0) {
      pcVar10 = "Failed to initialize command line.";
    }
    else {
      uVar8 = FUN_00433c35((int *)&local_c,param_1,0);
      if ((int)uVar8 < 0) {
        pcVar10 = "Failed to copy command line.";
      }
      else {
        local_10 = CommandLineToArgvW(local_c,&local_8);
        if (local_10 != (LPWSTR *)0x0) goto LAB_00410153;
        DVar2 = GetLastError();
        uVar8 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar8 = DVar2;
        }
        if (-1 < (int)uVar8) {
          uVar8 = 0x80004005;
        }
        FUN_004300d9();
        pcVar10 = "Failed to get command line.";
      }
    }
    FUN_00430a57(uVar8,pcVar10);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return uVar8;
}



/* Function: FUN_00410b39 */

int FUN_00410b39(undefined4 *param_1,int *param_2)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = FUN_00433f88(param_2,(LPCWSTR)*param_1,0);
  if (iVar1 < 0) {
    pcVar2 = "Failed to copy connection name from command line.";
  }
  else {
    iVar1 = FUN_00433f88(param_2 + 1,(LPCWSTR)param_1[1],0);
    if (iVar1 < 0) {
      pcVar2 = "Failed to copy connection secret from command line.";
    }
    else {
      iVar1 = FUN_004346e9((LPCWSTR)param_1[2],0,param_2 + 2);
      if (-1 < iVar1) {
        return iVar1;
      }
      pcVar2 = "Failed to copy parent process id from command line.";
    }
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_00410ba1 */

DWORD FUN_00410ba1(HANDLE param_1)

{
  DWORD DVar1;
  BOOL BVar2;
  char *pcVar3;
  DWORD local_8;
  
  local_8 = 0;
  DVar1 = WaitForSingleObject(param_1,0xffffffff);
  if (DVar1 == 0) {
    BVar2 = GetExitCodeThread(param_1,&local_8);
    if (BVar2 != 0) {
      return local_8;
    }
    DVar1 = GetLastError();
    local_8 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      local_8 = DVar1;
    }
    if (-1 < (int)local_8) {
      local_8 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to get cache thread exit code.";
  }
  else {
    DVar1 = GetLastError();
    local_8 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      local_8 = DVar1;
    }
    if (-1 < (int)local_8) {
      local_8 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to wait for cache thread to terminate.";
  }
  FUN_00430a57(local_8,pcVar3);
  return local_8;
}



/* Function: FUN_00410c48 */

DWORD FUN_00410c48(uint param_1,undefined4 param_2)

{
  uint uVar1;
  DWORD DVar2;
  int iVar3;
  HANDLE pvVar4;
  DWORD DVar5;
  int iVar6;
  char *pcVar7;
  uint local_34;
  undefined4 *local_30;
  int *local_2c;
  uint local_28;
  int local_24;
  int local_20;
  int local_1c;
  undefined4 local_18;
  uint local_14;
  HANDLE local_10;
  HANDLE local_c;
  int local_8;
  
  uVar1 = param_1;
  local_20 = *(int *)(param_1 + 0x3f0);
  local_34 = 0;
  local_30 = (undefined4 *)0x0;
  local_28 = 0;
  local_c = (HANDLE)0x0;
  local_18 = 0;
  local_10 = (HANDLE)0x0;
  local_24 = 0;
  local_1c = 0;
  local_8 = 0;
  local_14 = 0;
  param_1 = 0;
  local_2c = (int *)0x0;
  FUN_00402003(2,0x2000012c);
  iVar6 = uVar1 + 0xb8;
  DVar2 = FUN_00408682(iVar6,&local_28);
  if ((int)DVar2 < 0) {
    pcVar7 = "Engine cannot start apply because it is busy with another action.";
  }
  else {
    FUN_0042258b(iVar6,uVar1 + 0x2a8);
    iVar3 = (**(code **)(**(int **)(uVar1 + 200) + 0x60))(*(int **)(uVar1 + 200));
    DVar2 = FUN_00408843(iVar6,1,iVar3);
    if (-1 < (int)DVar2) {
      if (*(int *)(uVar1 + 0x30) == 3) {
        DVar2 = 0x8007015e;
        param_1 = 1;
        FUN_004089f8(*(int **)(uVar1 + 200),5,0,(LPVOID)0x8007015e,(LPVOID)0x0,0x10,0);
        goto LAB_00410fd9;
      }
      DVar2 = FUN_004223ef();
      if ((int)DVar2 < 0) {
        pcVar7 = "Another per-user setup is already executing.";
        goto LAB_00410cab;
      }
      FUN_004223e3();
      *(undefined4 *)(uVar1 + 0xf0) = param_2;
      DVar2 = FUN_004225bc((LPCRITICAL_SECTION)(uVar1 + 0x88));
      if ((int)DVar2 < 0) {
        pcVar7 = "Failed to set initial apply variables.";
        goto LAB_00410d63;
      }
      if ((((*(int *)(uVar1 + 0x418) == 0) && (*(int *)(uVar1 + 0x428) == 0)) &&
          (*(int *)(uVar1 + 0x438) == 0)) && (*(int *)(uVar1 + 0x448) == 0)) {
        FUN_00402003(2,0xa000017c);
        goto LAB_00410fd9;
      }
      if ((*(int *)(uVar1 + 0x468) == 0) &&
         (DVar2 = FUN_00413068(*(uint *)(uVar1 + 0x104),*(LPCWSTR *)(uVar1 + 0x140),
                               (int *)(uVar1 + 0xbc),(undefined4 *)(uVar1 + 0x48),
                               (int *)(uVar1 + 0x468)), (int)DVar2 < 0)) {
        pcVar7 = "Failed to cache engine to working directory.";
      }
      else {
        if (*(int *)(uVar1 + 0x3e4) == 0) {
LAB_00410e35:
          if (*(int *)(uVar1 + 1000) == 0) {
LAB_00410e63:
            if (*(int *)(uVar1 + 0x428) == 0) {
LAB_00410f0c:
              pvVar4 = local_10;
              if (*(int *)(uVar1 + 0x438) != 0) {
                DVar2 = FUN_0042229d(uVar1,local_10,&local_18,&local_20,&local_8,&local_14,
                                     (int *)&param_1);
                FUN_004087d4(uVar1 + 0xb8,DVar2);
              }
              DVar5 = DVar2;
              if ((((pvVar4 == (HANDLE)0x0) || (DVar5 = FUN_00410ba1(pvVar4), -1 < (int)DVar2)) &&
                  ((DVar2 = DVar5, -1 < (int)DVar5 &&
                   (((local_8 == 0 && (local_14 == 0)) && (param_1 != 2)))))) &&
                 (*(int *)(uVar1 + 0x448) != 0)) {
                FUN_00422274(uVar1 + 0xb8,uVar1 + 0x3d8,*(HANDLE *)(uVar1 + 0x47c));
              }
            }
            else {
              local_30 = &local_18;
              local_2c = &local_8;
              local_34 = uVar1;
              pvVar4 = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,FUN_0040fcb4,&local_34,0,
                                    (LPDWORD)0x0);
              local_10 = pvVar4;
              if (pvVar4 != (HANDLE)0x0) {
                if (*(int *)(uVar1 + 0x3b8) == 0) {
                  DVar2 = FUN_00410ba1(pvVar4);
                  if ((int)DVar2 < 0) {
                    pcVar7 = "Failed while caching, aborting execution.";
                    goto LAB_00410eee;
                  }
                  CloseHandle(pvVar4);
                  local_10 = (HANDLE)0x0;
                }
                goto LAB_00410f0c;
              }
              DVar5 = GetLastError();
              DVar2 = DVar5 & 0xffff | 0x80070000;
              if ((int)DVar5 < 1) {
                DVar2 = DVar5;
              }
              if (-1 < (int)DVar2) {
                DVar2 = 0x80004005;
              }
              FUN_004300d9();
              pcVar7 = "Failed to create cache thread.";
LAB_00410eee:
              FUN_00430a57(DVar2,pcVar7);
            }
            if (local_1c != 0) {
              if ((local_20 == 0) && (*(int *)(uVar1 + 0x3f4) == 0)) {
                iVar6 = 0;
              }
              else {
                iVar6 = 1;
              }
              if (((int)DVar2 < 0) || (local_8 != 0)) {
                iVar3 = 1;
              }
              else {
                iVar3 = 0;
              }
              FUN_004225f7(uVar1,iVar3,iVar6,local_14,param_1);
            }
          }
          else {
            DVar2 = FUN_004223f4(uVar1);
            if (-1 < (int)DVar2) {
              local_1c = 1;
              goto LAB_00410e63;
            }
            FUN_00430a57(DVar2,"Failed to register bundle.");
          }
          if (local_24 != 0) {
            FUN_00416171(*(HANDLE *)(uVar1 + 0x47c));
          }
          goto LAB_00410fd9;
        }
        DVar2 = FUN_004114d0(uVar1,*(undefined4 *)(uVar1 + 0xf0));
        if ((int)DVar2 < 0) {
          pcVar7 = "Failed to elevate.";
        }
        else {
          DVar2 = FUN_004160a6(*(HANDLE *)(uVar1 + 0x47c),(LPCRITICAL_SECTION)(uVar1 + 0x88),
                               *(undefined4 *)(uVar1 + 0x3d8),*(undefined4 *)(uVar1 + 0x45c),
                               (uint)(*(int *)(uVar1 + 0x3b4) == 0));
          if (-1 < (int)DVar2) {
            local_24 = 1;
            goto LAB_00410e35;
          }
          pcVar7 = "Another per-machine setup is already executing.";
        }
      }
LAB_00410d63:
      FUN_00430a57(DVar2,pcVar7);
      goto LAB_00410fd9;
    }
    FUN_004300d9();
    pcVar7 = "UX aborted apply begin.";
  }
LAB_00410cab:
  FUN_00430a57(DVar2,pcVar7);
LAB_00410fd9:
  *(undefined4 *)(uVar1 + 0xf0) = 0;
  FUN_004225eb();
  if (local_c != (HANDLE)0x0) {
    ReleaseMutex(local_c);
    CloseHandle(local_c);
  }
  if (local_28 != 0) {
    FUN_00408728(uVar1 + 0xb8);
  }
  if (local_10 != (HANDLE)0x0) {
    CloseHandle(local_10);
  }
  iVar6 = (**(code **)(**(int **)(uVar1 + 200) + 200))(*(int **)(uVar1 + 200),DVar2,param_1);
  if (iVar6 == 0x66) {
    *(undefined4 *)(uVar1 + 0x18) = 1;
  }
  FUN_0040e33b(*(int *)(uVar1 + 0x18));
  FUN_0040e8ce(param_1);
  FUN_00402003(2,0x2000018f);
  return DVar2;
}



/* Function: FUN_00411061 */

DWORD FUN_00411061(int param_1)

{
  DWORD DVar1;
  int iVar2;
  DWORD DVar3;
  undefined4 *puVar4;
  int iVar5;
  uint uVar6;
  uint uVar7;
  char *pcVar8;
  uint local_20;
  int local_1c;
  int local_18;
  int local_14;
  DWORD local_10;
  uint local_c;
  DWORD local_8;
  
  local_20 = 0;
  local_10 = 0;
  FUN_00402003(2,0x20000064);
  DVar1 = FUN_00408682(param_1 + 0xb8,&local_20);
  if ((int)DVar1 < 0) {
    pcVar8 = "Engine cannot start detect because it is busy with another action.";
    DVar3 = DVar1;
  }
  else {
    iVar2 = (**(code **)(**(int **)(param_1 + 200) + 0x18))
                      (*(int **)(param_1 + 200),*(undefined4 *)(param_1 + 0x100),
                       *(undefined4 *)(param_1 + 0x2b4));
    DVar1 = FUN_00408843(param_1 + 0xb8,1,iVar2);
    if ((int)DVar1 < 0) {
      FUN_004300d9();
      pcVar8 = "UX aborted detect begin.";
      DVar3 = DVar1;
    }
    else {
      uVar7 = param_1 + 0xf8;
      FUN_0041fdf7(uVar7,param_1 + 0x2a8);
      FUN_0040dbbd((uint *)(param_1 + 0x3d8),param_1 + 0x2a8);
      DVar1 = FUN_004067a2((int *)(param_1 + 0xb0),(LPCRITICAL_SECTION)(param_1 + 0x88));
      if ((int)DVar1 < 0) {
        pcVar8 = "Failed to execute searches.";
        DVar3 = DVar1;
      }
      else {
        DVar1 = FUN_0040a5f0(uVar7);
        if ((int)DVar1 < 0) {
          pcVar8 = "Failed to detect related bundles.";
          DVar3 = DVar1;
        }
        else {
          DVar1 = FUN_0041ea0a(uVar7);
          if ((int)DVar1 < 0) {
            if (DVar1 == 0x80070490) {
              DVar1 = 0;
            }
          }
          else {
            DVar3 = FUN_0041face(param_1 + 0xb8,(int *)(param_1 + 0x1c),uVar7);
            if ((int)DVar3 < 0) {
              pcVar8 = "Failed to detect forward compatible bundle.";
              goto LAB_00411410;
            }
            if (*(int *)(param_1 + 0x1b8) != 0) goto LAB_00411492;
          }
          if ((int)DVar1 < 0) {
            pcVar8 = "Failed to detect provider key bundle id.";
            DVar3 = DVar1;
          }
          else {
            DVar1 = FUN_0041fc8c(param_1 + 0xb8,uVar7,*(int *)(param_1 + 0x38),
                                 *(int *)(param_1 + 0x1c));
            if ((int)DVar1 < 0) {
              pcVar8 = "Failed to report detected related bundles.";
              DVar3 = DVar1;
            }
            else {
              DVar1 = FUN_0041ff03(*(undefined4 *)(param_1 + 0x104),param_1 + 0xb8,param_1 + 0x2d0);
              local_8 = DVar1;
              if ((int)DVar1 < 0) {
                pcVar8 = "Failed to detect update.";
                DVar3 = DVar1;
              }
              else {
                if ((*(int *)(param_1 + 0x2c8) == 0) ||
                   (DVar1 = FUN_0041ce43(param_1 + 0x2a8), -1 < (int)DVar1)) {
                  local_c = 0;
                  local_8 = DVar1;
                  if (*(int *)(param_1 + 0x2b4) != 0) {
                    local_14 = 0;
                    do {
                      puVar4 = (undefined4 *)(*(int *)(param_1 + 0x2b0) + local_14);
                      iVar2 = (**(code **)(**(int **)(param_1 + 200) + 0x2c))
                                        (*(int **)(param_1 + 200),*puVar4);
                      DVar1 = FUN_00408843(param_1 + 0xb8,1,iVar2);
                      if ((int)DVar1 < 0) {
                        FUN_004300d9();
                        pcVar8 = "UX aborted detect package begin.";
                        DVar3 = DVar1;
                        goto LAB_00411410;
                      }
                      DVar1 = FUN_0040fd39((int)puVar4);
                      if ((int)DVar1 < 0) {
                        FUN_00430a57(DVar1,
                                     "Failed to detect if payloads are all cached for package: %ls")
                        ;
                        goto LAB_00411492;
                      }
                      iVar2 = puVar4[0x23];
                      if (iVar2 == 1) {
                        DVar1 = FUN_00419552((int)puVar4,param_1 + 0x88);
                      }
                      else if (iVar2 == 2) {
                        DVar1 = FUN_0041ad2a(puVar4,param_1 + 0xb8);
                      }
                      else if (iVar2 == 3) {
                        DVar1 = FUN_0041cf70(puVar4,param_1 + 0xb8);
                      }
                      else {
                        if (iVar2 != 4) {
                          DVar1 = 0x80004001;
                          FUN_004300d9();
                          FUN_00430a57(0x80004001,"Package type not supported by detect yet.");
                          goto LAB_00411498;
                        }
                        DVar1 = FUN_0041dad9((int)puVar4,param_1 + 0x88);
                      }
                      local_8 = DVar1;
                      if ((int)DVar1 < 0) {
                        if (-1 < (int)local_10) {
                          local_10 = DVar1;
                        }
                        puVar4[0x10] = 0;
                        FUN_004309f9(DVar1,0xe0000097,(LPCVOID)0x0);
                      }
                      (**(code **)(**(int **)(param_1 + 200) + 0x3c))
                                (*(int **)(param_1 + 200),*puVar4,DVar1,puVar4[0x10]);
                      local_c = local_c + 1;
                      local_14 = local_14 + 0xd0;
                    } while (local_c < *(uint *)(param_1 + 0x2b4));
                  }
                  local_c = 0;
                  if (*(int *)(param_1 + 0x2b4) != 0) {
                    local_1c = 0;
                    do {
                      uVar7 = local_c;
                      iVar5 = *(int *)(param_1 + 0x2b0) + local_1c;
                      local_18 = iVar5;
                      FUN_0040e3d3(*(int *)(iVar5 + 0x44));
                      FUN_0040e76e(*(int *)(iVar5 + 0x40));
                      FUN_00402003(2,0x20000065);
                      iVar2 = local_18;
                      if (*(int *)(iVar5 + 0x8c) == 2) {
                        if (*(int *)(iVar5 + 0xb8) != 0) {
                          uVar6 = 0;
                          local_14 = 0;
                          do {
                            FUN_0040e48f(*(int *)(*(int *)(iVar5 + 0xb4) + local_14 + 0x1c));
                            FUN_00402003(2,0x20000068);
                            uVar6 = uVar6 + 1;
                            local_14 = local_14 + 0x28;
                            uVar7 = local_c;
                          } while (uVar6 < *(uint *)(iVar5 + 0xb8));
                        }
                      }
                      else if ((*(int *)(iVar5 + 0x8c) == 3) && (*(int *)(iVar5 + 0xa8) != 0)) {
                        uVar6 = 0;
                        local_14 = 0;
                        do {
                          FUN_0040e76e(*(int *)(*(int *)(iVar2 + 0xa4) + local_14 + 0x60));
                          FUN_00402003(2,0x20000069);
                          uVar6 = uVar6 + 1;
                          local_14 = local_14 + 0x6c;
                          uVar7 = local_c;
                        } while (uVar6 < *(uint *)(iVar2 + 0xa8));
                      }
                      local_c = uVar7 + 1;
                      local_1c = local_1c + 0xd0;
                      DVar1 = local_8;
                    } while (local_c < *(uint *)(param_1 + 0x2b4));
                  }
                  goto LAB_00411492;
                }
                pcVar8 = "Failed to initialize MSP engine detection.";
                DVar3 = DVar1;
                local_8 = DVar1;
              }
            }
          }
        }
      }
    }
  }
LAB_00411410:
  FUN_00430a57(DVar3,pcVar8);
LAB_00411492:
  if (-1 < (int)DVar1) {
    DVar1 = local_10;
  }
LAB_00411498:
  if (local_20 != 0) {
    FUN_00408728(param_1 + 0xb8);
  }
  (**(code **)(**(int **)(param_1 + 200) + 0x40))(*(int **)(param_1 + 200),DVar1);
  FUN_00402003(2,0x200000c7);
  return DVar1;
}



/* Function: FUN_004114d0 */

DWORD FUN_004114d0(int param_1,undefined4 param_2)

{
  DWORD DVar1;
  char *pcVar2;
  
  DVar1 = 0;
  if (*(int *)(param_1 + 0x47c) == -1) {
    if ((*(int *)(param_1 + 0x468) == 0) &&
       (DVar1 = FUN_00413068(*(uint *)(param_1 + 0x104),*(LPCWSTR *)(param_1 + 0x140),
                             (int *)(param_1 + 0xbc),(undefined4 *)(param_1 + 0x48),
                             (int *)(param_1 + 0x468)), (int)DVar1 < 0)) {
      pcVar2 = "Failed to cache engine to working directory.";
    }
    else {
      DVar1 = FUN_004164cb(param_1,param_2);
      if (-1 < (int)DVar1) {
        DVar1 = FUN_004045df((LPCRITICAL_SECTION)(param_1 + 0x88),L"WixBundleElevated",1,0,1);
        if (-1 < (int)DVar1) {
          return DVar1;
        }
        FUN_00430a57(DVar1,"Failed to overwrite the %ls built-in variable.");
        return DVar1;
      }
      pcVar2 = "Failed to actually elevate.";
    }
    FUN_00430a57(DVar1,pcVar2);
  }
  return DVar1;
}



/* Function: FUN_00411570 */

DWORD FUN_00411570(short *param_1,int param_2)

{
  DWORD DVar1;
  bool bVar2;
  char *pcVar3;
  HANDLE local_70 [22];
  undefined8 local_18;
  undefined4 local_10;
  LPVOID local_c;
  LPVOID local_8;
  
  local_c = (LPVOID)0x0;
  local_8 = (LPVOID)0x0;
  local_10 = 0;
  FUN_004267c0((uint *)local_70,0,0x58);
  DVar1 = FUN_00410095(param_1,(int *)(param_2 + 0x1c),(int *)(param_2 + 0x46c),
                       (int *)(param_2 + 0x484),(int *)(param_2 + 0x458),(int *)(param_2 + 0x45c),
                       (int *)(param_2 + 0x460),(int *)(param_2 + 0x4a0),(uint *)(param_2 + 0x3c4),
                       (int *)(param_2 + 0x3c8),(int *)(param_2 + 0x138),(int *)(param_2 + 0x4a4));
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to parse command line.");
  }
  else {
    DVar1 = FUN_00403d71((LPCRITICAL_SECTION)(param_2 + 0x88));
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to initialize variables.";
    }
    else {
      bVar2 = *(int *)(param_2 + 0x460) == 0;
      if (bVar2) {
        local_18 = 0;
      }
      DVar1 = FUN_004045df((LPCRITICAL_SECTION)(param_2 + 0x88),L"WixBundleElevated",(uint)!bVar2,0,
                           1);
      if ((int)DVar1 < 0) {
        FUN_00430a57(DVar1,"Failed to overwrite the %ls built-in variable.");
        goto LAB_00411752;
      }
      DVar1 = FUN_004190b7((undefined4 *)(param_2 + 0x48),local_70);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to open attached UX container.";
      }
      else {
        DVar1 = FUN_00418f25((int)local_70,&local_c);
        if ((int)DVar1 < 0) {
          pcVar3 = "Failed to open manifest stream.";
        }
        else {
          DVar1 = FUN_00419174((int)local_70,&local_8,&local_10);
          if ((int)DVar1 < 0) {
            pcVar3 = "Failed to get manifest stream from container.";
          }
          else {
            DVar1 = FUN_004226be(local_8,local_10,param_2);
            if ((int)DVar1 < 0) {
              pcVar3 = "Failed to load manifest.";
            }
            else {
              if ((*(int *)(param_2 + 0x460) != 0) && (*(int *)(param_2 + 0x460) != 1))
              goto LAB_00411752;
              DVar1 = FUN_00408775(*(undefined4 *)(param_2 + 0x104),(int *)(param_2 + 0xcc));
              if ((int)DVar1 < 0) {
                pcVar3 = "Failed to get unique temporary folder for bootstrapper application.";
              }
              else {
                DVar1 = FUN_00407d91((int *)(param_2 + 0xbc),0,(int)local_70,
                                     *(LPCWSTR *)(param_2 + 0xcc));
                if ((int)DVar1 < 0) {
                  pcVar3 = "Failed to extract bootstrapper application payloads.";
                }
                else {
                  DVar1 = FUN_00407ab3((int *)(param_2 + 0x298),(int *)(param_2 + 0xbc));
                  if (-1 < (int)DVar1) goto LAB_00411752;
                  pcVar3 = "Failed to load catalog files.";
                }
              }
            }
          }
        }
      }
    }
    FUN_00430a57(DVar1,pcVar3);
  }
LAB_00411752:
  FUN_00418e76((uint *)local_70);
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar1;
}



/* Function: FUN_0041177f */

DWORD FUN_0041177f(int param_1,uint param_2)

{
  uint *puVar1;
  int iVar2;
  DWORD DVar3;
  int iVar4;
  char *pcVar5;
  uint local_18;
  undefined4 *local_14;
  undefined4 *local_10;
  LPCWSTR local_c;
  uint local_8;
  
  iVar2 = param_1;
  local_14 = (undefined4 *)0x0;
  local_18 = 0;
  local_c = (LPCWSTR)0x0;
  local_8 = 0;
  local_10 = (undefined4 *)0x0;
  FUN_0040e353(param_2);
  FUN_00402003(2,0x200000c8);
  DVar3 = FUN_00408682(iVar2 + 0xb8,&local_18);
  if ((int)DVar3 < 0) {
    pcVar5 = "Engine cannot start plan because it is busy with another action.";
  }
  else {
    iVar4 = (**(code **)(**(int **)(iVar2 + 200) + 0x44))
                      (*(int **)(iVar2 + 200),*(undefined4 *)(iVar2 + 0x2b4));
    DVar3 = FUN_00408843(iVar2 + 0xb8,1,iVar4);
    if (-1 < (int)DVar3) {
      puVar1 = (uint *)(iVar2 + 0x3d8);
      FUN_0040dbbd(puVar1,iVar2 + 0x2a8);
      *(undefined4 *)(iVar2 + 0x3dc) = *(undefined4 *)(iVar2 + 0x104);
      *(undefined4 *)(iVar2 + 0x3e0) = *(undefined4 *)(iVar2 + 0x104);
      *puVar1 = param_2;
      DVar3 = FUN_0040de4d(param_2,(LPCRITICAL_SECTION)(iVar2 + 0x88));
      if ((int)DVar3 < 0) {
        pcVar5 = "Failed to update action.";
      }
      else {
        DVar3 = FUN_0040dde3(iVar2 + 0xf8,param_2,iVar2 + 0x1c,iVar2 + 0x3bc);
        if ((int)DVar3 < 0) {
          pcVar5 = "Failed to set resume command";
        }
        else {
          DVar3 = FUN_0041ecd1(iVar2,(int)puVar1);
          if ((int)DVar3 < 0) {
            pcVar5 = "Failed to initialize the dependencies for the plan.";
          }
          else if (param_2 == 2) {
            DVar3 = FUN_0040d00c((int)puVar1,*(LPCWSTR *)(iVar2 + 0x140),*(uint *)(iVar2 + 0x58),
                                 *(int *)(iVar2 + 0x5c),(LPCRITICAL_SECTION)(iVar2 + 0x88),
                                 (int *)(iVar2 + 0x2a0),&local_c);
            if ((int)DVar3 < 0) {
              pcVar5 = "Failed to plan the layout of the bundle.";
            }
            else {
              DVar3 = FUN_0040d2cf(iVar2 + 0xb8,iVar2 + 0x2a8,puVar1,iVar2 + 0x3bc,
                                   (LPCRITICAL_SECTION)(iVar2 + 0x88),0,*(int *)(iVar2 + 0x20),
                                   *(int *)(iVar2 + 0x38),local_c,&local_8);
              if (-1 < (int)DVar3) goto LAB_00411a8b;
LAB_0041191b:
              pcVar5 = "Failed to plan packages.";
            }
          }
          else if ((param_2 == 7) || (param_2 == 8)) {
            local_14 = (undefined4 *)(iVar2 + 0x2d8);
            DVar3 = FUN_0040df33(iVar2 + 0xb8,local_14,puVar1,iVar2 + 0x3bc,
                                 (LPCRITICAL_SECTION)(iVar2 + 0x88),*(int *)(iVar2 + 0x20),
                                 *(int *)(iVar2 + 0x38),&local_8);
            if (-1 < (int)DVar3) goto LAB_00411a8b;
            pcVar5 = "Failed to plan update.";
          }
          else if (*(int *)(iVar2 + 0x1b8) == 0) {
            param_1 = 1;
            *(undefined4 *)(iVar2 + 0x3e4) = *(undefined4 *)(iVar2 + 0xf8U);
            DVar3 = FUN_0040d4b9((int *)puVar1,iVar2 + 0xf8U,*(uint *)(iVar2 + 0x30),
                                 *(int *)(iVar2 + 0x38),*(wchar_t **)(iVar2 + 0x4a4),&param_1);
            if (-1 < (int)DVar3) {
              if (param_1 != 0) {
                DVar3 = FUN_0040d2cf(iVar2 + 0xb8,iVar2 + 0x2a8,puVar1,iVar2 + 0x3bc,
                                     (LPCRITICAL_SECTION)(iVar2 + 0x88),*(int *)(iVar2 + 0x100),
                                     *(int *)(iVar2 + 0x20),*(int *)(iVar2 + 0x38),(LPCWSTR)0x0,
                                     &local_8);
                if ((int)DVar3 < 0) goto LAB_0041191b;
                DVar3 = FUN_0040d833(iVar2 + 0xb8,(uint *)(iVar2 + 0xf8),*(int *)(iVar2 + 0x38),
                                     puVar1,iVar2 + 0x3bc,(LPCRITICAL_SECTION)(iVar2 + 0x88),
                                     (int *)&local_8);
                if ((int)DVar3 < 0) {
                  pcVar5 = "Failed to plan related bundles.";
                  goto LAB_0041185c;
                }
              }
              goto LAB_00411a8b;
            }
            pcVar5 = "Failed to plan registration.";
          }
          else {
            local_10 = (undefined4 *)(iVar2 + 0x1c0);
            DVar3 = FUN_0040d454(iVar2 + 0xb8,local_10,puVar1,iVar2 + 0x3bc,
                                 (LPCRITICAL_SECTION)(iVar2 + 0x88),*(int *)(iVar2 + 0x20),
                                 *(int *)(iVar2 + 0x38),&local_8);
            if ((int)DVar3 < 0) {
              pcVar5 = "Failed to plan passthrough.";
            }
            else {
LAB_00411a8b:
              DVar3 = FUN_0040ce7f((int)puVar1);
              if (-1 < (int)DVar3) {
                FUN_0040fe82((uint)local_14,(int)local_10,iVar2 + 0x2a8,(int *)(iVar2 + 0x1ac),
                             param_2);
                goto LAB_00411ac3;
              }
              pcVar5 = "Failed to remove unnecessary actions from plan.";
            }
          }
        }
      }
LAB_0041185c:
      FUN_00430a57(DVar3,pcVar5);
      goto LAB_00411ac3;
    }
    FUN_004300d9();
    pcVar5 = "UX aborted plan begin.";
  }
  FUN_00430a57(DVar3,pcVar5);
LAB_00411ac3:
  if (local_18 != 0) {
    FUN_00408728(iVar2 + 0xb8);
  }
  (**(code **)(**(int **)(iVar2 + 200) + 0x5c))(*(int **)(iVar2 + 200),DVar3);
  FUN_00402003(2,0x2000012b);
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar3;
}



/* Function: FUN_00411b03 */

uint FUN_00411b03(int param_1)

{
  uint uVar1;
  int iVar2;
  uint local_10;
  SIZE_T local_c;
  LPVOID local_8;
  
  local_8 = (LPVOID)0x0;
  local_c = 0;
  local_10 = 0;
  iVar2 = param_1 + 0xf8;
  FUN_0040a57f(iVar2,(uint *)(param_1 + 0x100));
  uVar1 = FUN_0040a63a(iVar2,(undefined4 *)(param_1 + 0x30));
  if ((int)uVar1 < 0) {
    FUN_00430a57(uVar1,"Failed to detect resume type.");
  }
  else if (1 < *(int *)(param_1 + 0x30)) {
    iVar2 = FUN_0040a787(iVar2,(int *)&local_8,&local_c);
    if (-1 < iVar2) {
      uVar1 = FUN_00403823((LPCRITICAL_SECTION)(param_1 + 0x88),(int)local_8,local_c,&local_10);
      if (-1 < (int)uVar1) goto LAB_00411b9a;
    }
    FUN_00402003(2,0xa0000037);
    uVar1 = 0;
  }
LAB_00411b9a:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return uVar1;
}



/* Function: FUN_00411bb1 */

DWORD FUN_00411bb1(int param_1,int param_2)

{
  DWORD DVar1;
  
  DVar1 = 0;
  if (*(int *)(param_1 + 0x49c) != 0) {
    DVar1 = FUN_00411ea8(param_1);
    if ((int)DVar1 < 0) {
      FUN_004309f9(DVar1,0xa00001f5,(LPCVOID)0x0);
      DVar1 = 0;
    }
  }
  FUN_00402003(2,0x200001f4);
  PostQuitMessage(param_2);
  return DVar1;
}



/* Function: FUN_00411c05 */

int FUN_00411c05(int *param_1,int param_2,int param_3,int param_4,int param_5,int param_6,
                short *param_7,short *param_8,short *param_9)

{
  wchar_t *pwVar1;
  int iVar2;
  wchar_t *pwVar3;
  char *pcVar4;
  short *local_8;
  
  iVar2 = 0;
  local_8 = (short *)0x0;
  pwVar1 = FUN_00411e63(param_5);
  if (param_3 == 2) {
    pwVar3 = L" /quiet";
LAB_00411c3a:
    iVar2 = FUN_00433c35(param_1,pwVar3,0);
    if (-1 < iVar2) goto LAB_00411c50;
    pcVar4 = "Failed to append display state to command-line";
  }
  else {
    if (param_3 == 3) {
      pwVar3 = L" /passive";
      goto LAB_00411c3a;
    }
LAB_00411c50:
    if (param_2 == 3) {
      pwVar3 = L" /uninstall";
LAB_00411c79:
      iVar2 = FUN_00433c35(param_1,pwVar3,0);
    }
    else {
      if (param_2 == 5) {
        pwVar3 = L" /modify";
        goto LAB_00411c79;
      }
      if (param_2 == 6) {
        pwVar3 = L" /repair";
        goto LAB_00411c79;
      }
    }
    if (iVar2 < 0) {
      pcVar4 = "Failed to append action state to command-line";
    }
    else {
      if (param_4 == 1) {
        pwVar3 = L" /norestart";
LAB_00411caa:
        iVar2 = FUN_00433c35(param_1,pwVar3,0);
      }
      else if (param_4 == 4) {
        pwVar3 = L" /forcerestart";
        goto LAB_00411caa;
      }
      if (iVar2 < 0) {
        pcVar4 = "Failed to append restart state to command-line";
      }
      else if (param_7 == (short *)0x0) {
LAB_00411d37:
        if (pwVar1 == (wchar_t *)0x0) {
LAB_00411d7b:
          if (param_6 == 0) {
LAB_00411dc1:
            if ((param_8 == (short *)0x0) || (*param_8 == 0)) {
LAB_00411e08:
              if ((param_9 == (short *)0x0) || (*param_9 == 0)) goto LAB_00411e4c;
              iVar2 = FUN_00433c35(param_1,(short *)&DAT_004443f0,0);
              if (iVar2 < 0) {
                pcVar4 = "Failed to append space to command-line.";
              }
              else {
                iVar2 = FUN_00433c35(param_1,param_9,0);
                if (-1 < iVar2) goto LAB_00411e4c;
                pcVar4 = "Failed to append command-line to command-line.";
              }
            }
            else {
              iVar2 = FUN_00433cea((int *)&local_8,L" /%ls \"%ls\"");
              if (iVar2 < 0) {
                pcVar4 = "Failed to format append log command-line for command-line.";
              }
              else {
                iVar2 = FUN_00433c35(param_1,local_8,0);
                if (-1 < iVar2) goto LAB_00411e08;
                pcVar4 = "Failed to append log command-line to command-line";
              }
            }
          }
          else {
            iVar2 = FUN_00433cea((int *)&local_8,L" /%ls");
            if (iVar2 < 0) {
              pcVar4 = "Failed to format passthrough for command-line.";
            }
            else {
              iVar2 = FUN_00433c35(param_1,local_8,0);
              if (-1 < iVar2) goto LAB_00411dc1;
              pcVar4 = "Failed to append passthrough to command-line.";
            }
          }
        }
        else {
          iVar2 = FUN_00433cea((int *)&local_8,L" /%ls");
          if (iVar2 < 0) {
            pcVar4 = "Failed to format relation type for command-line.";
          }
          else {
            iVar2 = FUN_00433c35(param_1,local_8,0);
            if (-1 < iVar2) goto LAB_00411d7b;
            pcVar4 = "Failed to append relation type to command-line.";
          }
        }
      }
      else if (*param_7 == 0) {
        iVar2 = FUN_00433cea((int *)&local_8,L" /%ls");
        if (-1 < iVar2) goto LAB_00411d1b;
        pcVar4 = "Failed to format parent:none command-line for command-line.";
      }
      else {
        iVar2 = FUN_00433cea((int *)&local_8,L" /%ls \"%ls\"");
        if (iVar2 < 0) {
          pcVar4 = "Failed to format active parent command-line for command-line.";
        }
        else {
LAB_00411d1b:
          iVar2 = FUN_00433c35(param_1,local_8,0);
          if (-1 < iVar2) goto LAB_00411d37;
          pcVar4 = "Failed to append active parent command-line to command-line.";
        }
      }
    }
  }
  FUN_00430a57(iVar2,pcVar4);
LAB_00411e4c:
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar2;
}



/* Function: FUN_00411e63 */

wchar_t * FUN_00411e63(int param_1)

{
  wchar_t *pwVar1;
  
  pwVar1 = (wchar_t *)0x0;
  if (param_1 != 0) {
    if (param_1 == 1) {
      pwVar1 = L"burn.related.detect";
    }
    else if (param_1 == 2) {
      pwVar1 = L"burn.related.upgrade";
    }
    else if (param_1 == 3) {
      pwVar1 = L"burn.related.addon";
    }
    else if (param_1 == 4) {
      pwVar1 = L"burn.related.patch";
    }
    else if ((param_1 != 5) && (param_1 == 6)) {
      pwVar1 = L"burn.related.update";
    }
  }
  return pwVar1;
}



/* Function: FUN_00411ea8 */

DWORD FUN_00411ea8(int param_1)

{
  DWORD DVar1;
  char *pcVar2;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  DVar1 = FUN_00411f2d(param_1,(int *)&local_8,(int *)&local_c);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to serialize engine state.";
  }
  else if (*(int *)(param_1 + 0xf8) == 0) {
    DVar1 = FUN_0040ad0e(param_1 + 0xf8,(int)local_8,local_c);
    if (-1 < (int)DVar1) goto LAB_00411f17;
    pcVar2 = "Failed to save engine state.";
  }
  else {
    DVar1 = FUN_00416e56(*(HANDLE *)(param_1 + 0x47c),local_8,local_c);
    if (-1 < (int)DVar1) goto LAB_00411f17;
    pcVar2 = "Failed to save engine state in per-machine process.";
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_00411f17:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar1;
}



/* Function: FUN_00411f2d */

int FUN_00411f2d(int param_1,int *param_2,int *param_3)

{
  int iVar1;
  
  iVar1 = FUN_00404496((LPCRITICAL_SECTION)(param_1 + 0x88),1,param_2,param_3);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to serialize variables.");
  }
  return iVar1;
}



/* Function: FUN_00411f61 */

DWORD FUN_00411f61(WELL_KNOWN_SID_TYPE param_1,undefined4 *param_2)

{
  PSID pSid;
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  DWORD local_8;
  
  uVar3 = 0;
  local_8 = 0x44;
  pSid = (PSID)FUN_00431078(0x44,1);
  if (pSid == (PSID)0x0) {
    uVar3 = 0x8007000e;
    FUN_004300d9();
    FUN_00430a57(0x8007000e,"Failed to allocate memory for well known SID.");
  }
  else {
    BVar1 = CreateWellKnownSid(param_1,(PSID)0x0,pSid,&local_8);
    if (BVar1 == 0) {
      DVar2 = GetLastError();
      uVar3 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar3 = DVar2;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar3,"Failed to create well known SID.");
    }
    else {
      *param_2 = pSid;
      pSid = (LPVOID)0x0;
    }
    if (pSid != (LPVOID)0x0) {
      FUN_00431137(pSid);
    }
  }
  return uVar3;
}



/* Function: FUN_0041200a */

void FUN_0041200a(undefined4 param_1,int *param_2)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0((uint *)local_210,0,0x208);
  DVar1 = GetTempPathW(0x104,local_210);
  if (DVar1 == 0) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to get temp path for working folder.";
  }
  else {
    uVar2 = FUN_00433cea(param_2,L"%ls%ls\\");
    if (-1 < (int)uVar2) goto LAB_004120af;
    pcVar3 = "Failed to append bundle id on to temp path for working folder.";
  }
  FUN_00430a57(uVar2,pcVar3);
LAB_004120af:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004120c1 */

void FUN_004120c1(HANDLE param_1,undefined4 param_2,LPCWSTR param_3,int param_4)

{
  LARGE_INTEGER liDistanceToMove;
  LARGE_INTEGER liDistanceToMove_00;
  HANDLE hFile;
  DWORD DVar1;
  int iVar2;
  BOOL BVar3;
  uint uVar4;
  DWORD unaff_EDI;
  HANDLE hFile_00;
  char *pcVar5;
  undefined4 local_14;
  undefined4 uStack_10;
  undefined4 uStack_c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_14 = 0;
  uStack_10 = 0;
  uStack_c = 0;
  hFile = CreateFileW(param_3,0x40000000,5,(LPSECURITY_ATTRIBUTES)0x0,2,0x8000080,(HANDLE)0x0);
  if (hFile == (HANDLE)0xffffffff) {
    DVar1 = GetLastError();
    uVar4 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar4 = DVar1;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar4,"Failed to create engine file at path: %ls");
    goto LAB_004122f9;
  }
  DVar1 = FUN_00436faf(param_1,0,0,(undefined4 *)0x0,(PLARGE_INTEGER)0x0);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to seek to beginning of engine file: %ls");
  }
  else {
    iVar2 = FUN_0043659f(param_1,hFile,*(uint *)(param_4 + 8),0,(uint *)0x0);
    if (iVar2 < 0) {
      FUN_00430a57(iVar2,"Failed to copy engine from: %ls to: %ls");
    }
    else if (*(int *)(param_4 + 0x28) != 0) {
      hFile_00 = (HANDLE)0x4121c4;
      BVar3 = SetFilePointerEx(hFile,(LARGE_INTEGER)0x0,(PLARGE_INTEGER)0x0,unaff_EDI);
      if (BVar3 == 0) {
        DVar1 = GetLastError();
        uVar4 = DVar1 & 0xffff | 0x80070000;
        if ((int)DVar1 < 1) {
          uVar4 = DVar1;
        }
        if (-1 < (int)uVar4) {
          uVar4 = 0x80004005;
        }
        FUN_004300d9();
        pcVar5 = "Failed to seek to checksum in exe header.";
      }
      else {
        uVar4 = FUN_004373a3(hFile,param_4 + 0x24,4);
        if (-1 < (int)uVar4) {
          liDistanceToMove.s.HighPart = 0;
          liDistanceToMove.s.LowPart = *(uint *)(param_4 + 0x1c);
          BVar3 = SetFilePointerEx(hFile_00,liDistanceToMove,(PLARGE_INTEGER)0x0,0);
          if (BVar3 == 0) {
            DVar1 = GetLastError();
            uVar4 = DVar1 & 0xffff | 0x80070000;
            if ((int)DVar1 < 1) {
              uVar4 = DVar1;
            }
            if (-1 < (int)uVar4) {
              uVar4 = 0x80004005;
            }
            FUN_004300d9();
            pcVar5 = "Failed to seek to signature table in exe header.";
            goto LAB_004122ea;
          }
          uVar4 = FUN_004373a3(hFile,param_4 + 0x28,4);
          if (-1 < (int)uVar4) {
            uVar4 = FUN_004373a3(hFile,param_4 + 0x2c,4);
            if (-1 < (int)uVar4) {
              liDistanceToMove_00.s.HighPart = 0;
              liDistanceToMove_00.s.LowPart = *(uint *)(param_4 + 0x20);
              BVar3 = SetFilePointerEx(hFile_00,liDistanceToMove_00,(PLARGE_INTEGER)0x0,0);
              if (BVar3 == 0) {
                DVar1 = GetLastError();
                uVar4 = DVar1 & 0xffff | 0x80070000;
                if ((int)DVar1 < 1) {
                  uVar4 = DVar1;
                }
                if (-1 < (int)uVar4) {
                  uVar4 = 0x80004005;
                }
                FUN_004300d9();
                pcVar5 = "Failed to seek to original data in exe burn section header.";
              }
              else {
                uVar4 = FUN_004373a3(hFile,(int)&local_14,0xc);
                if (-1 < (int)uVar4) goto LAB_004122f2;
                pcVar5 = "Failed to zero out original data offset.";
              }
              goto LAB_004122ea;
            }
          }
        }
        pcVar5 = "Failed to update signature offset.";
      }
LAB_004122ea:
      FUN_00430a57(uVar4,pcVar5);
    }
  }
LAB_004122f2:
  CloseHandle(hFile);
LAB_004122f9:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0041230c */

DWORD FUN_0041230c(int param_1,undefined4 param_2,undefined4 *param_3)

{
  LPCWSTR pWVar1;
  DWORD DVar2;
  char *pcVar3;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  if ((param_1 == 0) || (DAT_00456f90 != 0)) {
LAB_0041236d:
    DVar2 = FUN_00413be9(param_1,param_2,(int *)&local_8);
    if ((int)DVar2 < 0) {
LAB_00412380:
      FUN_00430a57(DVar2,"Failed to get cache directory.");
      goto LAB_004123c2;
    }
    DVar2 = FUN_00437850(local_8,(LPSECURITY_ATTRIBUTES)0x0);
    if (-1 < (int)DVar2) {
      FUN_004125c9(param_1,local_8);
      pWVar1 = local_8;
      local_8 = (LPCWSTR)0x0;
      *param_3 = pWVar1;
      goto LAB_004123c2;
    }
LAB_004123a1:
    pcVar3 = "Failed to create cache directory: %ls";
  }
  else {
    DVar2 = FUN_00413be9(param_1,&DAT_0043b580,(int *)&local_8);
    if ((int)DVar2 < 0) goto LAB_00412380;
    DVar2 = FUN_00437850(local_8,(LPSECURITY_ATTRIBUTES)0x0);
    if ((int)DVar2 < 0) goto LAB_004123a1;
    DVar2 = FUN_00412697(local_8);
    if (-1 < (int)DVar2) {
      DAT_00456f90 = 1;
      goto LAB_0041236d;
    }
    pcVar3 = "Failed to secure cache directory: %ls";
  }
  FUN_00430a57(DVar2,pcVar3);
LAB_004123c2:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar2;
}



/* Function: FUN_004123d8 */

DWORD FUN_004123d8(int param_1,LPCWSTR param_2,int *param_3)

{
  DWORD DVar1;
  char *pcVar2;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  DVar1 = FUN_00413be9(param_1,L".unverified",(int *)&local_8);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to get cache directory.";
  }
  else {
    if (DAT_00456f94 == 0) {
      DVar1 = FUN_00437850(local_8,(LPSECURITY_ATTRIBUTES)0x0);
      if ((int)DVar1 < 0) {
        FUN_00430a57(DVar1,"Failed to create unverified cache directory: %ls");
        goto LAB_00412454;
      }
      FUN_004125c9(param_1,local_8);
    }
    DVar1 = FUN_004314a9(local_8,param_2,param_3);
    if (-1 < (int)DVar1) goto LAB_00412454;
    pcVar2 = "Failed to concat payload id to unverified folder path.";
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_00412454:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_00412469 */

DWORD FUN_00412469(WELL_KNOWN_SID_TYPE param_1,undefined4 param_2,undefined4 *param_3)

{
  DWORD DVar1;
  
  DVar1 = FUN_00411f61(param_1,param_3 + 7);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to allocate SID to grate access.");
  }
  else {
    param_3[5] = 0;
    param_3[1] = 1;
    *param_3 = param_2;
    param_3[2] = 3;
    param_3[6] = 2;
  }
  return DVar1;
}



/* Function: FUN_004124b8 */

int FUN_004124b8(int param_1,int param_2,undefined4 param_3,LPCWSTR param_4)

{
  int iVar1;
  uint uVar2;
  char *pcVar3;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_c = (LPCWSTR)0x0;
  local_8 = (LPCWSTR)0x0;
  iVar1 = FUN_00413be9(param_2,&DAT_0043b580,(int *)&local_c);
  if (iVar1 < 0) {
    pcVar3 = "Failed to calculate root cache path.";
  }
  else {
    iVar1 = FUN_004314a9(local_c,param_4,(int *)&local_8);
    if (iVar1 < 0) {
      pcVar3 = "Failed to combine id to root cache path.";
    }
    else {
      iVar1 = FUN_0043124a((int *)&local_8);
      if (-1 < iVar1) {
        FUN_00402003(2,(param_1 != 0) + 0x2000015f);
        iVar1 = -0x7fffbffb;
        uVar2 = 0;
        while (uVar2 < 3) {
          if (uVar2 != 0) {
            Sleep(2000);
          }
          iVar1 = FUN_0043740c(local_8,7);
          if ((iVar1 == -0x7ff8fffd) || (uVar2 = uVar2 + 1, -1 < iVar1)) break;
        }
        if (iVar1 < 0) {
          FUN_00402003(2,(param_1 != 0) + 0xa0000161);
          iVar1 = 0;
        }
        else {
          FUN_0043740c(local_c,4);
        }
        goto LAB_004125a6;
      }
      pcVar3 = "Failed to ensure cache directory to remove was backslash terminated.";
    }
  }
  FUN_00430a57(iVar1,pcVar3);
LAB_004125a6:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return iVar1;
}



/* Function: FUN_004125c9 */

DWORD FUN_004125c9(int param_1,LPCWSTR param_2)

{
  SECURITY_INFORMATION SVar1;
  uint uVar2;
  BOOL BVar3;
  DWORD DVar4;
  LPVOID pvVar5;
  char *pcVar6;
  ACL local_10;
  LPVOID local_8;
  
  SVar1 = 0x20000004;
  local_10.AclRevision = '\0';
  local_10.Sbz1 = '\0';
  local_10.AclSize = 0;
  local_10.AceCount = 0;
  local_10.Sbz2 = 0;
  local_8 = (LPVOID)0x0;
  if (param_1 == 0) {
LAB_0041265b:
    pvVar5 = local_8;
    uVar2 = FUN_004380b4(param_2,SE_FILE_OBJECT,SVar1,local_8,(PSID)0x0,&local_10,(PACL)0x0,3,2000);
    SetFileAttributesW(param_2,0x80);
  }
  else {
    uVar2 = FUN_00411f61(WinBuiltinAdministratorsSid,&local_8);
    if ((int)uVar2 < 0) {
      pcVar6 = "Failed to allocate administrator SID.";
    }
    else {
      BVar3 = InitializeAcl(&local_10,8,2);
      if (BVar3 != 0) {
        SVar1 = 0x20000005;
        goto LAB_0041265b;
      }
      DVar4 = GetLastError();
      uVar2 = DVar4 & 0xffff | 0x80070000;
      if ((int)DVar4 < 1) {
        uVar2 = DVar4;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
      pcVar6 = "Failed to initialize ACL.";
    }
    FUN_00430a57(uVar2,pcVar6);
    pvVar5 = local_8;
  }
  if (pvVar5 != (LPVOID)0x0) {
    FUN_00431137(pvVar5);
  }
  return uVar2;
}



/* Function: FUN_00412697 */

void FUN_00412697(LPCWSTR param_1)

{
  uint uVar1;
  DWORD DVar2;
  int iVar3;
  LPWSTR *ppWVar4;
  char *pcVar5;
  PACL local_8c;
  _EXPLICIT_ACCESS_W local_88;
  undefined4 local_68 [8];
  undefined4 local_48 [8];
  undefined4 local_28 [8];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0(&local_88.grfAccessPermissions,0,0x80);
  local_8c = (PACL)0x0;
  uVar1 = FUN_00412469(WinBuiltinAdministratorsSid,0x1f01ff,&local_88.grfAccessPermissions);
  iVar3 = 4;
  if ((int)uVar1 < 0) {
    pcVar5 = "Failed to allocate access for Administrators group to path: %ls";
  }
  else {
    uVar1 = FUN_00412469(WinLocalSystemSid,0x1f01ff,local_68);
    if ((int)uVar1 < 0) {
      pcVar5 = "Failed to allocate access for SYSTEM group to path: %ls";
    }
    else {
      uVar1 = FUN_00412469(WinWorldSid,0xa0000000,local_48);
      if ((int)uVar1 < 0) {
        pcVar5 = "Failed to allocate access for Everyone group to path: %ls";
      }
      else {
        uVar1 = FUN_00412469(WinBuiltinUsersSid,0xa0000000,local_28);
        if ((int)uVar1 < 0) {
          pcVar5 = "Failed to allocate access for Users group to path: %ls";
        }
        else {
          DVar2 = SetEntriesInAclW(4,&local_88,(PACL)0x0,&local_8c);
          if (DVar2 == 0) {
            uVar1 = FUN_004380b4(param_1,SE_FILE_OBJECT,0x80000005,local_88.Trustee.ptstrName,
                                 (PSID)0x0,local_8c,(PACL)0x0,3,2000);
            if (-1 < (int)uVar1) goto LAB_004127d4;
            pcVar5 = "Failed to secure cache path: %ls";
          }
          else {
            uVar1 = DVar2 & 0xffff | 0x80070000;
            if ((int)DVar2 < 1) {
              uVar1 = DVar2;
            }
            if (-1 < (int)uVar1) {
              uVar1 = 0x80004005;
            }
            FUN_004300d9();
            pcVar5 = "Failed to create ACL to secure cache path: %ls";
          }
        }
      }
    }
  }
  FUN_00430a57(uVar1,pcVar5);
LAB_004127d4:
  if (local_8c != (PACL)0x0) {
    LocalFree(local_8c);
  }
  ppWVar4 = &local_88.Trustee.ptstrName;
  do {
    if (*ppWVar4 != (LPWSTR)0x0) {
      FUN_00431137(*ppWVar4);
    }
    ppWVar4 = ppWVar4 + 8;
    iVar3 = iVar3 + -1;
  } while (iVar3 != 0);
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00412811 */

uint FUN_00412811(LPCWSTR param_1,LPCWSTR param_2,int param_3)

{
  uint uVar1;
  char *pcVar2;
  
  if (param_3 == 0) {
    uVar1 = FUN_004367c5(param_1,param_2,1,3,2000);
    if (-1 < (int)uVar1) {
      return uVar1;
    }
    pcVar2 = "Failed to copy %ls to %ls";
  }
  else {
    uVar1 = FUN_004369b5(param_1,param_2,1,1,3,2000);
    if (-1 < (int)uVar1) {
      return uVar1;
    }
    pcVar2 = "Failed to move %ls to %ls";
  }
  FUN_00430a57(uVar1,pcVar2);
  return uVar1;
}



/* Function: FUN_00412870 */

DWORD FUN_00412870(int param_1,LPCWSTR param_2)

{
  HANDLE hObject;
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  
  uVar2 = 0;
  hObject = CreateFileW(param_2,0x80000000,5,(LPSECURITY_ATTRIBUTES)0x0,3,0x8000000,(HANDLE)0x0);
  if (hObject == (HANDLE)0xffffffff) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (uVar2 == 0x80070003) {
      return 0x80070003;
    }
    if (uVar2 == 0x80070002) {
      return 0x80070002;
    }
    if ((int)uVar2 < 0) {
      FUN_004300d9();
      FUN_00430a57(uVar2,"Failed to open payload at path: %ls");
      return uVar2;
    }
  }
  if (*(int *)(param_1 + 0x20) == 0) {
    if (*(int *)(param_1 + 0x1c) == 0) {
      if ((*(int *)(param_1 + 0x30) == 0) ||
         (uVar2 = FUN_0041296c(*(int *)(param_1 + 0x30),*(int *)(param_1 + 0x34),param_2,hObject),
         -1 < (int)uVar2)) goto LAB_00412957;
      pcVar3 = "Failed to verify hash of payload: %ls";
    }
    else {
      uVar2 = FUN_00412b6a(param_1,param_2,hObject);
      if (-1 < (int)uVar2) goto LAB_00412957;
      pcVar3 = "Failed to verify catalog signature of payload: %ls";
    }
  }
  else {
    uVar2 = FUN_004141e9(param_1,param_2,hObject);
    if (-1 < (int)uVar2) goto LAB_00412957;
    pcVar3 = "Failed to verify signature of payload: %ls";
  }
  FUN_00430a57(uVar2,pcVar3);
LAB_00412957:
  if (hObject != (HANDLE)0xffffffff) {
    CloseHandle(hObject);
  }
  return uVar2;
}



/* Function: FUN_0041296c */

void FUN_0041296c(int param_1,int param_2,undefined4 param_3,HANDLE param_4)

{
  int iVar1;
  char *pcVar2;
  undefined1 local_24 [8];
  int local_1c [6];
  
  local_1c[5] = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_1c[0] = 0;
  local_1c[1] = 0;
  local_1c[2] = 0;
  local_1c[3] = 0;
  local_1c[4] = 0;
  iVar1 = FUN_0043821c(param_4,1,0x8004,(BYTE *)local_1c,0x14,(uint)local_24);
  if (iVar1 < 0) {
    pcVar2 = "Failed to calculate hash for path: %ls";
  }
  else {
    if (param_2 == 0x14) {
      iVar1 = 0;
      do {
        if (*(int *)(param_1 + iVar1 * 4) != local_1c[iVar1]) goto LAB_004129d2;
        iVar1 = iVar1 + 1;
      } while (iVar1 != 5);
      goto LAB_004129e6;
    }
LAB_004129d2:
    iVar1 = -0x7ff6eff9;
    pcVar2 = "Hash mismatch for path: %ls";
  }
  FUN_00430a57(iVar1,pcVar2);
LAB_004129e6:
  __security_check_cookie(local_1c[5] ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004129f9 */

void FUN_004129f9(int param_1,int param_2)

{
  PCCERT_CONTEXT pCVar1;
  BOOL BVar2;
  int iVar3;
  uint uVar4;
  DWORD DVar5;
  char *pcVar6;
  uint local_2c;
  DWORD local_28;
  SIZE_T local_24;
  void *local_20;
  BYTE local_1c [20];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_1c[0] = '\0';
  local_1c[1] = '\0';
  local_1c[2] = '\0';
  local_1c[3] = '\0';
  local_1c[4] = '\0';
  local_1c[5] = '\0';
  local_1c[6] = '\0';
  local_1c[7] = '\0';
  local_1c[8] = '\0';
  local_1c[9] = '\0';
  local_1c[10] = '\0';
  local_1c[0xb] = '\0';
  local_1c[0xc] = '\0';
  local_1c[0xd] = '\0';
  local_1c[0xe] = '\0';
  local_1c[0xf] = '\0';
  local_1c[0x10] = '\0';
  local_1c[0x11] = '\0';
  local_1c[0x12] = '\0';
  local_1c[0x13] = '\0';
  local_28 = 0x14;
  local_20 = (void *)0x0;
  local_24 = 0;
  iVar3 = **(int **)(param_2 + 0x10);
  DVar5 = 0x80070490;
  local_2c = 0;
  if (*(int *)(iVar3 + 0xc) != 0) {
    do {
      pCVar1 = *(PCCERT_CONTEXT *)(*(int *)(*(int *)(iVar3 + 0x10) + local_2c * 4) + 4);
      BVar2 = CryptHashPublicKeyInfo
                        (0,0x8004,0,1,&pCVar1->pCertInfo->SubjectPublicKeyInfo,local_1c,&local_28);
      if (BVar2 == 0) {
        DVar5 = GetLastError();
        uVar4 = DVar5 & 0xffff | 0x80070000;
        if ((int)DVar5 < 1) {
          uVar4 = DVar5;
        }
        if (-1 < (int)uVar4) {
          uVar4 = 0x80004005;
        }
        FUN_004300d9();
        pcVar6 = "Failed to get certificate public key identifier.";
        goto LAB_00412b02;
      }
      if ((*(size_t *)(param_1 + 0x24) == local_28) &&
         (iVar3 = _memcmp(*(void **)(param_1 + 0x20),local_1c,local_28), iVar3 == 0)) {
        if (*(int *)(param_1 + 0x28) != 0) {
          uVar4 = FUN_00438141(pCVar1,3,&local_20,&local_24);
          if ((int)uVar4 < 0) {
            pcVar6 = "Failed to read certificate thumbprint.";
            goto LAB_00412b02;
          }
          if ((*(size_t *)(param_1 + 0x2c) != local_24) ||
             (iVar3 = _memcmp(*(void **)(param_1 + 0x28),local_20,local_24), iVar3 != 0)) {
            if (local_20 != (LPVOID)0x0) {
              FUN_00431137(local_20);
              local_20 = (void *)0x0;
            }
            goto LAB_00412ade;
          }
        }
        DVar5 = 0;
        break;
      }
LAB_00412ade:
      local_2c = local_2c + 1;
      iVar3 = **(int **)(param_2 + 0x10);
    } while (local_2c < *(uint *)(iVar3 + 0xc));
  }
  if ((int)DVar5 < 0) {
    pcVar6 = "Failed to find expected public key in certificate chain.";
    uVar4 = DVar5;
LAB_00412b02:
    FUN_00430a57(uVar4,pcVar6);
  }
  if (local_20 != (LPVOID)0x0) {
    FUN_00431137(local_20);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00412b6a */

void FUN_00412b6a(int param_1,LPCWSTR param_2,HANDLE param_3)

{
  uint uVar1;
  short *psVar2;
  DWORD DVar3;
  BOOL BVar4;
  LONG LVar5;
  int iVar6;
  uint uVar7;
  short **ppsVar8;
  byte *pbHash;
  char *pcVar9;
  short *local_80 [4];
  short *local_70;
  HANDLE local_6c;
  byte *local_68;
  SIZE_T local_64;
  uint local_5c [3];
  undefined4 local_50;
  undefined4 local_48;
  short **local_44;
  undefined4 local_40;
  uint local_34;
  LPCWSTR local_2c;
  HANDLE local_28;
  short *local_24;
  short *local_20;
  DWORD local_1c;
  GUID local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_2c = param_2;
  local_28 = param_3;
  FUN_004267c0(local_5c,0,0x30);
  ppsVar8 = local_80;
  for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
    *ppsVar8 = (short *)0x0;
    ppsVar8 = ppsVar8 + 1;
  }
  local_20 = (short *)0x0;
  local_24 = (short *)0x0;
  local_1c = 0;
  pbHash = (byte *)0x0;
  local_18.Data1 = 0xaac56b;
  local_18.Data2 = 0xcd44;
  local_18.Data3 = 0x11d0;
  local_18.Data4[0] = 0x8c;
  local_18.Data4[1] = 0xc2;
  local_18.Data4[2] = '\0';
  local_18.Data4[3] = 0xc0;
  local_18.Data4[4] = 'O';
  local_18.Data4[5] = 0xc2;
  local_18.Data4[6] = 0x95;
  local_18.Data4[7] = 0xee;
  uVar1 = FUN_00433f88((int *)&local_20,param_2,0);
  psVar2 = local_20;
  if ((int)uVar1 < 0) {
    pcVar9 = "Failed to allocate memory";
  }
  else {
    for (; *psVar2 != 0; psVar2 = psVar2 + 1) {
      *psVar2 = *psVar2 + 0x20;
    }
    CryptCATAdminCalcHashFromFileHandle(param_3,&local_1c,(BYTE *)0x0,0);
    DVar3 = GetLastError();
    if (DVar3 == 0x7a) {
      pbHash = (byte *)FUN_00431078(local_1c,1);
      BVar4 = CryptCATAdminCalcHashFromFileHandle(param_3,&local_1c,pbHash,0);
      if (BVar4 != 0) {
LAB_00412c86:
        uVar7 = local_1c * 2 + 1;
        uVar1 = FUN_00433bdf((int *)&local_24,uVar7);
        if ((int)uVar1 < 0) {
          pcVar9 = "Failed to allocate string.";
        }
        else {
          uVar1 = FUN_004344b6(pbHash,local_1c,local_24,uVar7);
          if ((int)uVar1 < 0) {
            pcVar9 = "Failed to encode file hash.";
          }
          else {
            local_44 = local_80;
            local_64 = local_1c;
            local_6c = local_28;
            local_80[3] = local_24;
            local_70 = local_20;
            local_5c[0] = 0x30;
            local_50 = 2;
            local_48 = 2;
            local_40 = 1;
            local_34 = 0x80;
            local_80[0] = (short *)0x24;
            local_80[2] = *(short **)(*(int *)(param_1 + 0x1c) + 8);
            local_68 = pbHash;
            LVar5 = WinVerifyTrust((HWND)0xffffffff,&local_18,local_5c);
            if (LVar5 != 0) {
              local_34 = local_34 | 0x1000;
              uVar1 = WinVerifyTrust((HWND)0xffffffff,&local_18,local_5c);
              if (uVar1 != 0) {
                uVar7 = uVar1 & 0xffff | 0x80070000;
                if ((int)uVar1 < 1) {
                  uVar7 = uVar1;
                }
                if (-1 < (int)uVar7) {
                  uVar7 = 0x80004005;
                }
                FUN_004300d9();
                FUN_00430a57(uVar7,"Could not verify file %ls.");
                goto LAB_00412dce;
              }
            }
            local_40 = 2;
            uVar7 = WinVerifyTrust((HWND)0xffffffff,&local_18,local_5c);
            if (uVar7 == 0) goto LAB_00412dce;
            uVar1 = uVar7 & 0xffff | 0x80070000;
            if ((int)uVar7 < 1) {
              uVar1 = uVar7;
            }
            if (-1 < (int)uVar1) {
              uVar1 = 0x80004005;
            }
            FUN_004300d9();
            pcVar9 = "Could not close verify handle.";
          }
        }
        goto LAB_00412dc6;
      }
      DVar3 = GetLastError();
      uVar1 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar1 = DVar3;
      }
      if (-1 < (int)uVar1) {
        uVar1 = 0x80004005;
      }
    }
    else {
      if (DVar3 == 0) goto LAB_00412c86;
      uVar1 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar1 = DVar3;
      }
      if (-1 < (int)uVar1) {
        uVar1 = 0x80004005;
      }
    }
    FUN_004300d9();
    pcVar9 = "Failed to get file hash.";
  }
LAB_00412dc6:
  FUN_00430a57(uVar1,pcVar9);
LAB_00412dce:
  if (local_20 != (short *)0x0) {
    FUN_004380ab(local_20);
  }
  if (local_24 != (short *)0x0) {
    FUN_004380ab(local_24);
  }
  if (pbHash != (byte *)0x0) {
    FUN_00431137(pbHash);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00412e07 */

uint FUN_00412e07(int param_1,LPCWSTR param_2,LPCWSTR param_3,int param_4)

{
  HANDLE hObject;
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  
  hObject = CreateFileW(param_3,0x80000000,5,(LPSECURITY_ATTRIBUTES)0x0,3,0x8000000,(HANDLE)0x0);
  if (hObject == (HANDLE)0xffffffff) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar2,"Failed to open container in working path: %ls");
    return uVar2;
  }
  if ((*(int *)(param_1 + 0x38) == 0) ||
     (uVar2 = FUN_0041296c(*(int *)(param_1 + 0x38),*(int *)(param_1 + 0x3c),param_3,hObject),
     -1 < (int)uVar2)) {
    FUN_00430f28(2,"%ls container from working path \'%ls\' to path \'%ls\'");
    if (param_4 == 0) {
      uVar2 = FUN_004367c5(param_3,param_2,1,3,2000);
      if (-1 < (int)uVar2) goto LAB_00412f0c;
      pcVar3 = "Failed to copy %ls to %ls";
    }
    else {
      uVar2 = FUN_004369b5(param_3,param_2,1,1,3,2000);
      if (-1 < (int)uVar2) goto LAB_00412f0c;
      pcVar3 = "Failed to move %ls to %ls";
    }
    FUN_00430a57(uVar2,pcVar3);
  }
  else {
    FUN_00430a57(uVar2,"Failed to verify container hash: %ls");
  }
LAB_00412f0c:
  CloseHandle(hObject);
  return uVar2;
}



/* Function: FUN_00412f1f */

uint FUN_00412f1f(int param_1,LPCWSTR param_2,LPCWSTR param_3,int param_4)

{
  HANDLE hObject;
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  
  hObject = CreateFileW(param_3,0x80000000,5,(LPSECURITY_ATTRIBUTES)0x0,3,0x8000000,(HANDLE)0x0);
  if (hObject == (HANDLE)0xffffffff) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar2,"Failed to open payload in working path: %ls");
    return uVar2;
  }
  if (*(int *)(param_1 + 0x20) == 0) {
    if (*(int *)(param_1 + 0x1c) != 0) {
      uVar2 = FUN_00412b6a(param_1,param_3,hObject);
      goto LAB_00412fab;
    }
    if ((*(int *)(param_1 + 0x30) != 0) &&
       (uVar2 = FUN_0041296c(*(int *)(param_1 + 0x30),*(int *)(param_1 + 0x34),param_3,hObject),
       (int)uVar2 < 0)) {
      pcVar3 = "Failed to verify payload hash: %ls";
      goto LAB_00412fdb;
    }
  }
  else {
    uVar2 = FUN_004141e9(param_1,param_3,hObject);
LAB_00412fab:
    if ((int)uVar2 < 0) {
      pcVar3 = "Failed to verify payload signature: %ls";
LAB_00412fdb:
      FUN_00430a57(uVar2,pcVar3);
      goto LAB_00413051;
    }
  }
  FUN_00430f28(2,"%ls payload from working path \'%ls\' to path \'%ls\'");
  if (param_4 == 0) {
    uVar2 = FUN_004367c5(param_3,param_2,1,3,2000);
    if (-1 < (int)uVar2) goto LAB_00413051;
    pcVar3 = "Failed to copy %ls to %ls";
  }
  else {
    uVar2 = FUN_004369b5(param_3,param_2,1,1,3,2000);
    if (-1 < (int)uVar2) goto LAB_00413051;
    pcVar3 = "Failed to move %ls to %ls";
  }
  FUN_00430a57(uVar2,pcVar3);
LAB_00413051:
  CloseHandle(hObject);
  return uVar2;
}



/* Function: FUN_00413062 */

undefined4 FUN_00413062(void)

{
  return DAT_00456f84;
}



/* Function: FUN_00413068 */

DWORD FUN_00413068(uint param_1,LPCWSTR param_2,int *param_3,undefined4 *param_4,int *param_5)

{
  int iVar1;
  DWORD DVar2;
  char *pcVar3;
  LPCWSTR local_20;
  LPCWSTR local_1c;
  LPCWSTR local_18;
  LPCWSTR local_14;
  LPCWSTR local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  local_20 = (LPCWSTR)0x0;
  local_1c = (LPCWSTR)0x0;
  local_10 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  local_18 = (LPCWSTR)0x0;
  local_14 = (LPCWSTR)0x0;
  DVar2 = FUN_00431c19((int *)&local_8,(HMODULE)0x0);
  if ((int)DVar2 < 0) {
    pcVar3 = "Failed to get current process path.";
LAB_00413159:
    FUN_00430a57(DVar2,pcVar3);
LAB_0041323f:
    if ((int)DVar2 < 0) goto LAB_00413257;
  }
  else {
    if (DAT_00456f84 == 0) {
      DVar2 = FUN_00431c88(local_8,(int *)&local_20);
      if (-1 < (int)DVar2) {
        DVar2 = FUN_00413970(param_1,(int *)&local_1c);
        if ((int)DVar2 < 0) {
          pcVar3 = "Failed to create working path to copy engine.";
        }
        else {
          DVar2 = FUN_004314a9(local_1c,L".be",(int *)&local_10);
          if ((int)DVar2 < 0) {
            pcVar3 = "Failed to calculate the bundle working folder target name.";
          }
          else {
            DVar2 = FUN_00437850(local_10,(LPSECURITY_ATTRIBUTES)0x0);
            if ((int)DVar2 < 0) {
              pcVar3 = "Failed create bundle working folder.";
            }
            else {
              DVar2 = FUN_004314a9(local_10,param_2,(int *)&local_c);
              if (-1 < (int)DVar2) {
                DVar2 = FUN_004120c1((HANDLE)*param_4,local_8,local_c,(int)param_4);
                if ((int)DVar2 < 0) {
                  FUN_00430a57(DVar2,"Failed to copy engine: \'%ls\' to working path: %ls");
                }
                else {
                  param_1 = 0;
                  if (param_3[1] != 0) {
                    param_2 = (LPCWSTR)0x0;
                    do {
                      iVar1 = *param_3;
                      if (*(int *)((int)param_2 + iVar1 + 4) == 3) {
                        DVar2 = FUN_004314a9(local_20,*(LPCWSTR *)((int)param_2 + iVar1 + 0x38),
                                             (int *)&local_18);
                        if ((int)DVar2 < 0) {
                          pcVar3 = "Failed to build payload source path for working copy.";
                        }
                        else {
                          DVar2 = FUN_004314a9(local_10,*(LPCWSTR *)((int)param_2 + iVar1 + 0x18),
                                               (int *)&local_14);
                          if (-1 < (int)DVar2) {
                            DVar2 = FUN_004367c5(local_18,local_14,1,3,2000);
                            if (-1 < (int)DVar2) goto LAB_00413201;
                            FUN_00430a57(DVar2,"Failed to copy UX payload from: \'%ls\' to: \'%ls\'"
                                        );
                            break;
                          }
                          pcVar3 = "Failed to build payload target path for working copy.";
                        }
                        FUN_00430a57(DVar2,pcVar3);
                        break;
                      }
LAB_00413201:
                      param_1 = param_1 + 1;
                      param_2 = param_2 + 0x2c;
                    } while (param_1 < (uint)param_3[1]);
                  }
                }
                goto LAB_0041323f;
              }
              pcVar3 = "Failed to combine working path with engine file name.";
            }
          }
        }
        goto LAB_00413159;
      }
      FUN_00430a57(DVar2,"Failed to get directory from engine path: %ls");
      goto LAB_0041323f;
    }
    DVar2 = FUN_00433f88((int *)&local_c,local_8,0);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to use current process path as target path.";
      goto LAB_00413159;
    }
  }
  if (param_5 != (int *)0x0) {
    DVar2 = FUN_00433f88(param_5,local_c,0);
  }
LAB_00413257:
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  if (local_18 != (LPCWSTR)0x0) {
    FUN_004380ab(local_18);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_1c != (LPCWSTR)0x0) {
    FUN_004380ab(local_1c);
  }
  if (local_20 != (LPCWSTR)0x0) {
    FUN_004380ab(local_20);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar2;
}



/* Function: FUN_004132c1 */

int FUN_004132c1(undefined4 param_1,int param_2,int *param_3)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = FUN_0041200a(param_1,param_3);
  if (iVar1 < 0) {
    pcVar2 = "Failed to get working folder for container.";
  }
  else {
    iVar1 = FUN_00433c35(param_3,*(short **)(param_2 + 0x20),0);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to append SHA1 hash as container unverified path.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_00413307 */

int FUN_00413307(short *param_1,int *param_2)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = FUN_0041200a(param_1,param_2);
  if (iVar1 < 0) {
    pcVar2 = "Failed to get working folder for bundle layout.";
  }
  else {
    iVar1 = FUN_00433c35(param_2,param_1,0);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to append bundle id for bundle layout working path.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0041334a */

DWORD FUN_0041334a(undefined4 param_1,undefined4 param_2,int *param_3)

{
  DWORD DVar1;
  char *pcVar2;
  LPVOID local_8;
  
  local_8 = (LPVOID)0x0;
  if (DAT_00456f84 == 0) {
    DVar1 = FUN_0041200a(param_1,(int *)&local_8);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to get working folder for bundle.";
    }
    else {
      DVar1 = FUN_00433cea(param_3,L"%ls%ls\\%ls");
      if (-1 < (int)DVar1) goto LAB_004133ba;
      pcVar2 = "Failed to calculate the bundle working path.";
    }
  }
  else {
    DVar1 = FUN_00431c19(param_3,(HMODULE)0x0);
    if (-1 < (int)DVar1) goto LAB_004133ba;
    pcVar2 = "Failed to get current process path.";
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_004133ba:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_004133cf */

int FUN_004133cf(undefined4 param_1,undefined4 *param_2,int *param_3)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = FUN_0041200a(param_1,param_3);
  if (iVar1 < 0) {
    pcVar2 = "Failed to get working folder for payload.";
  }
  else {
    iVar1 = FUN_00433c35(param_3,(short *)*param_2,0);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to append SHA1 hash as payload unverified path.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_00413414 */

void FUN_00413414(int param_1,undefined4 param_2)

{
  int iVar1;
  HANDLE hFindFile;
  uint uVar2;
  BOOL BVar3;
  LPCWSTR local_264;
  LPCWSTR local_260;
  LPCWSTR local_25c;
  _WIN32_FIND_DATAW local_258;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_25c = (LPCWSTR)0x0;
  local_264 = (LPCWSTR)0x0;
  local_260 = (LPCWSTR)0x0;
  FUN_004267c0(&local_258.dwFileAttributes,0,0x250);
  iVar1 = FUN_00413be9(param_1,L".unverified",(int *)&local_25c);
  if (-1 < iVar1) {
    FUN_0043740c(local_25c,7);
  }
  if (param_1 == 0) {
    iVar1 = FUN_0041200a(param_2,(int *)&local_25c);
    if (-1 < iVar1) {
      iVar1 = FUN_004314a9(local_25c,L"*.*",(int *)&local_264);
      if (-1 < iVar1) {
        hFindFile = FindFirstFileW(local_264,&local_258);
        if (hFindFile != (HANDLE)0xffffffff) {
          do {
            if (((byte)local_258.dwFileAttributes & 0x10) == 0) {
              local_258.cFileName[0x103] = L'\0';
              uVar2 = lstrlenW(local_258.cFileName);
              if ((2 < uVar2) && (local_258.cFileName[uVar2 - 2] == L'.')) {
                if ((local_258.cFileName[uVar2 - 1] == L'R') ||
                   (local_258.cFileName[uVar2 - 1] == L'r')) goto LAB_00413543;
              }
              iVar1 = FUN_004314a9(local_25c,local_258.cFileName,(int *)&local_260);
              if (-1 < iVar1) {
                FUN_00436816(local_260);
              }
            }
LAB_00413543:
            BVar3 = FindNextFileW(hFindFile,&local_258);
          } while (BVar3 != 0);
          FindClose(hFindFile);
        }
      }
    }
  }
  if (local_260 != (LPCWSTR)0x0) {
    FUN_004380ab(local_260);
  }
  if (local_264 != (LPCWSTR)0x0) {
    FUN_004380ab(local_264);
  }
  if (local_25c != (LPCWSTR)0x0) {
    FUN_004380ab(local_25c);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004135a7 */

DWORD FUN_004135a7(int param_1,LPCWSTR param_2,undefined4 param_3,int *param_4,LPCWSTR param_5)

{
  DWORD DVar1;
  undefined4 *puVar2;
  char *pcVar3;
  int local_18;
  LPCWSTR local_14;
  LPCWSTR local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_18 = 0;
  local_14 = (LPCWSTR)0x0;
  local_8 = (LPCWSTR)0x0;
  local_10 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  DVar1 = FUN_0041230c(param_1,param_3,&local_14);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to create completed cache path for bundle.";
  }
  else {
    DVar1 = FUN_004314a9(local_14,param_2,(int *)&local_8);
    if (-1 < (int)DVar1) {
      DVar1 = FUN_00431437(param_5,local_8,&local_18);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to compare completed cache path for bundle: %ls";
      }
      else {
        if (local_18 == 2) goto LAB_0041372d;
        FUN_00430f28(2,"Caching bundle from: \'%ls\' to: \'%ls\'");
        FUN_00436e3f(local_8);
        DVar1 = FUN_004367c5(param_5,local_8,1,3,2000);
        if ((int)DVar1 < 0) {
          FUN_00430a57(DVar1,"Failed to cache bundle from: \'%ls\' to \'%ls\'");
          goto LAB_0041372d;
        }
        DVar1 = FUN_004125c9(param_1,local_8);
        if ((int)DVar1 < 0) {
          pcVar3 = "Failed to reset permissions on cached bundle: \'%ls\'";
        }
        else {
          DVar1 = FUN_00431c88(param_5,(int *)&local_10);
          if (-1 < (int)DVar1) {
            param_2 = (LPCWSTR)0x0;
            if (param_4[1] != 0) {
              param_5 = (LPCWSTR)0x0;
              do {
                puVar2 = (undefined4 *)(*param_4 + (int)param_5);
                if (puVar2[1] == 3) {
                  DVar1 = FUN_004314a9(local_10,(LPCWSTR)puVar2[0xe],(int *)&local_c);
                  if ((int)DVar1 < 0) {
                    FUN_00430a57(DVar1,"Failed to build payload source path.");
                    break;
                  }
                  DVar1 = FUN_0041376c(param_1,puVar2,param_3,local_c,0);
                  if ((int)DVar1 < 0) {
                    pcVar3 = "Failed to complete the cache of payload: %ls";
                    goto LAB_00413714;
                  }
                }
                param_2 = (LPCWSTR)((int)param_2 + 1);
                param_5 = param_5 + 0x2c;
              } while (param_2 < (LPCWSTR)param_4[1]);
            }
            goto LAB_0041372d;
          }
          pcVar3 = "Failed to get directory from engine working path: %ls";
        }
      }
LAB_00413714:
      FUN_00430a57(DVar1,pcVar3);
      goto LAB_0041372d;
    }
    pcVar3 = "Failed to combine completed path with engine file name.";
  }
  FUN_00430a57(DVar1,pcVar3);
LAB_0041372d:
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  return DVar1;
}



/* Function: FUN_0041376c */

DWORD FUN_0041376c(int param_1,undefined4 *param_2,undefined4 param_3,LPCWSTR param_4,int param_5)

{
  DWORD DVar1;
  int iVar2;
  char *pcVar3;
  LPCWSTR local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_10 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  local_8 = (LPCWSTR)0x0;
  DVar1 = FUN_0041230c(param_1,param_3,&local_10);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to get cached path for package with cache id: %ls");
    goto LAB_0041393f;
  }
  DVar1 = FUN_004314a9(local_10,(LPCWSTR)param_2[6],(int *)&local_c);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to concat complete cached path.";
LAB_00413836:
    FUN_00430a57(DVar1,pcVar3);
    goto LAB_0041393f;
  }
  DVar1 = FUN_00412870((int)param_2,local_c);
  if (-1 < (int)DVar1) {
    FUN_00402003(2,0x20000130);
    goto LAB_0041393f;
  }
  if ((DVar1 != 0x80070003) && (DVar1 != 0x80070002)) {
    FUN_004309f9(DVar1,0xe0000136,(LPCVOID)0x0);
    FUN_00436816(local_c);
  }
  DVar1 = FUN_004123d8(param_1,(LPCWSTR)*param_2,(int *)&local_8);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to create unverified path.";
    goto LAB_00413836;
  }
  iVar2 = FUN_00436af7(param_4,(uint *)0x0);
  if (iVar2 == 0) {
    iVar2 = FUN_00436af7(local_8,(uint *)0x0);
    if (iVar2 == 0) {
      DVar1 = 0x80070002;
      FUN_00430a57(0x80070002,
                   "Failed to find payload: %ls in working path: %ls and unverified path: %ls");
      goto LAB_0041393f;
    }
LAB_004138a1:
    DVar1 = FUN_004125c9(param_1,local_8);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to reset permissions on unverified cached payload: %ls";
    }
    else {
      DVar1 = FUN_00412870((int)param_2,local_8);
      if ((int)DVar1 < 0) {
        FUN_004309f9(DVar1,0xe0000136,(LPCVOID)0x0);
        FUN_00436816(local_8);
        goto LAB_0041393f;
      }
      FUN_00402003(2,0x20000131);
      DVar1 = FUN_004369b5(local_8,local_c,1,1,3,2000);
      if (-1 < (int)DVar1) goto LAB_0041393f;
      pcVar3 = "Failed to move verified file to complete payload path: %ls";
    }
  }
  else {
    DVar1 = FUN_00412811(param_4,local_8,param_5);
    if (-1 < (int)DVar1) goto LAB_004138a1;
    pcVar3 = "Failed to transfer working path to unverified path for payload: %ls.";
  }
  FUN_00430a57(DVar1,pcVar3);
LAB_0041393f:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  return DVar1;
}



/* Function: FUN_00413970 */

DWORD FUN_00413970(undefined4 param_1,int *param_2)

{
  DWORD DVar1;
  char *pcVar2;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  DVar1 = FUN_0041200a(param_1,(int *)&local_8);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to calculate working folder to ensure it exists.";
  }
  else {
    DVar1 = FUN_00437850(local_8,(LPSECURITY_ATTRIBUTES)0x0);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed create working folder.";
    }
    else {
      DecryptFileW(local_8,0);
      if (param_2 == (int *)0x0) goto LAB_004139d8;
      DVar1 = FUN_00433f88(param_2,local_8,0);
      if (-1 < (int)DVar1) goto LAB_004139d8;
      pcVar2 = "Failed to copy working folder.";
    }
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_004139d8:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_004139ed */

DWORD FUN_004139ed(LPCWSTR param_1,LPCRITICAL_SECTION param_2,int *param_3,int *param_4)

{
  int iVar1;
  PCNZWCH lpString1;
  DWORD DVar2;
  LPCWSTR pWVar3;
  char *pcVar4;
  PCNZWCH local_24 [2];
  int local_1c;
  LPCWSTR local_18;
  LPCWSTR local_14;
  PCNZWCH local_10;
  PCNZWCH local_c;
  LPCWSTR local_8;
  
  DVar2 = 0;
  local_18 = (LPCWSTR)0x0;
  local_14 = (LPCWSTR)0x0;
  local_10 = (PCNZWCH)0x0;
  local_c = (PCNZWCH)0x0;
  local_8 = (LPCWSTR)0x0;
  local_24[0] = (PCNZWCH)0x0;
  local_24[1] = (PCNZWCH)0x0;
  pWVar3 = (LPCWSTR)0x0;
  iVar1 = FUN_00431d3c(param_1);
  if (iVar1 == 0) {
    local_1c = 0;
    DVar2 = FUN_00403c02(param_2,L"WixBundleLastUsedSource",(int *)&local_8);
    if ((DVar2 == 0x80070490) &&
       (DVar2 = FUN_00403c02(param_2,L"WixBundleOriginalSource",&local_1c), -1 < (int)DVar2)) {
      DVar2 = FUN_00431c88((LPCWSTR)local_1c,(int *)&local_8);
    }
    if ((DAT_00456f84 != 0) && (lpString1 = (PCNZWCH)0x0, -1 < (int)DVar2)) {
LAB_00413adc:
      if ((local_8 != (LPCWSTR)0x0) && (*local_8 != L'\0')) {
        DVar2 = FUN_004314a9(local_8,param_1,(int *)&local_c);
        if ((int)DVar2 < 0) {
LAB_00413ac9:
          pcVar4 = "Failed to combine last source with source.";
          goto LAB_00413b92;
        }
        if ((pWVar3 == (LPCWSTR)0x0) ||
           (iVar1 = CompareStringW(0,1,lpString1,-1,local_c,-1), iVar1 != 2)) {
          local_24[(int)pWVar3] = local_c;
          pWVar3 = (LPCWSTR)((int)pWVar3 + 1);
          lpString1 = local_24[0];
        }
      }
      goto LAB_00413b26;
    }
    DVar2 = FUN_00431c19((int *)&local_18,(HMODULE)0x0);
    if ((int)DVar2 < 0) {
      pcVar4 = "Failed to get path to current process.";
    }
    else {
      DVar2 = FUN_00431c88(local_18,(int *)&local_14);
      if (-1 < (int)DVar2) {
        DVar2 = FUN_004314a9(local_14,param_1,(int *)&local_10);
        if (-1 < (int)DVar2) {
          local_24[0] = local_10;
          pWVar3 = (LPCWSTR)0x1;
          lpString1 = local_10;
          goto LAB_00413adc;
        }
        goto LAB_00413ac9;
      }
      pcVar4 = "Failed to get current process directory.";
    }
  }
  else {
    local_24[0] = param_1;
    pWVar3 = (LPCWSTR)0x1;
    lpString1 = param_1;
LAB_00413b26:
    *param_3 = 0;
    param_1 = (LPCWSTR)0x0;
    if (pWVar3 != (LPCWSTR)0x0) {
      do {
        iVar1 = FUN_00436af7(local_24[(int)param_1],(uint *)0x0);
        if (iVar1 != 0) {
          DVar2 = FUN_00433f88(param_4,local_24[(int)param_1],0);
          if ((int)DVar2 < 0) goto LAB_00413b8d;
          *param_3 = 1;
          break;
        }
        param_1 = (LPCWSTR)((int)param_1 + 1);
      } while (param_1 < pWVar3);
      if (*param_3 != 0) goto LAB_00413b9a;
    }
    DVar2 = FUN_00433f88(param_4,lpString1,0);
    if (-1 < (int)DVar2) goto LAB_00413b9a;
LAB_00413b8d:
    pcVar4 = "Failed to copy source path.";
  }
LAB_00413b92:
  FUN_00430a57(DVar2,pcVar4);
LAB_00413b9a:
  if (local_10 != (PCNZWCH)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  if (local_18 != (LPCWSTR)0x0) {
    FUN_004380ab(local_18);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (PCNZWCH)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar2;
}



/* Function: FUN_00413be9 */

int FUN_00413be9(int param_1,undefined4 param_2,int *param_3)

{
  undefined4 uVar1;
  int iVar2;
  LPVOID local_8;
  
  local_8 = (LPVOID)0x0;
  uVar1 = 0x1c;
  if (param_1 != 0) {
    uVar1 = 0x23;
  }
  iVar2 = FUN_00431d07(uVar1,(int *)&local_8);
  if (iVar2 < 0) {
    FUN_00430a57(iVar2,"Failed to find local %hs appdata directory.");
  }
  else {
    iVar2 = FUN_00433cea(param_3,L"%lsPackage Cache\\%ls");
    if (iVar2 < 0) {
      FUN_00430a57(iVar2,"Failed to format cache path.");
    }
  }
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar2;
}



/* Function: FUN_00413c6f */

int FUN_00413c6f(undefined4 param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_00433cea(param_2,L"%ls.R");
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to create resume path.");
  }
  return iVar1;
}



/* Function: FUN_00413ca0 */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

DWORD FUN_00413ca0(int *param_1,LPCRITICAL_SECTION param_2)

{
  DWORD DVar1;
  char *pcVar2;
  int local_18;
  int local_14;
  LPCWSTR local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  local_10 = (LPCWSTR)0x0;
  local_18 = 0;
  local_14 = 0;
  DVar1 = FUN_00431c19((int *)&local_8,(HMODULE)0x0);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to get current process path.");
    return DVar1;
  }
  DVar1 = FUN_00413be9(*param_1,param_1[3],(int *)&local_c);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to get completed path for bundle.";
  }
  else {
    DVar1 = FUN_004314a9(local_c,(LPCWSTR)param_1[0x12],(int *)&local_10);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to combine working path with engine file name.";
    }
    else {
      DVar1 = FUN_00431437(local_8,local_10,&local_14);
      if ((int)DVar1 < 0) {
        FUN_00430a57(DVar1,"Failed to compare current path for bundle: %ls");
        return DVar1;
      }
      DAT_00456f84 = (uint)(local_14 == 2);
      if (((DAT_00456f84 != 0) ||
          (DVar1 = FUN_00403c02(param_2,L"WixBundleOriginalSource",&local_18), DVar1 != 0x80070490))
         || (DVar1 = FUN_0040461f(param_2,L"WixBundleOriginalSource",(int)local_8,0),
            -1 < (int)DVar1)) {
        _DAT_00456f80 = 1;
        return DVar1;
      }
      pcVar2 = "Failed to set original source variable.";
    }
  }
  FUN_00430a57(DVar1,pcVar2);
  return DVar1;
}



/* Function: FUN_00413da4 */

uint FUN_00413da4(LPCWSTR param_1,LPCWSTR param_2,LPCWSTR param_3)

{
  uint uVar1;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  uVar1 = FUN_004314a9(param_2,param_1,(int *)&local_8);
  if ((int)uVar1 < 0) {
    FUN_00430a57(uVar1,"Failed to combine completed path with engine file name for layout.");
  }
  else {
    FUN_00430f28(2,"Layout bundle from: \'%ls\' to: \'%ls\'");
    uVar1 = FUN_004369b5(param_3,local_8,1,1,3,2000);
    if ((int)uVar1 < 0) {
      FUN_00430a57(uVar1,"Failed to layout bundle from: \'%ls\' to \'%ls\'");
    }
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00413e2b */

uint FUN_00413e2b(int param_1,LPCWSTR param_2,LPCWSTR param_3,int param_4)

{
  uint uVar1;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  uVar1 = FUN_004314a9(param_2,*(LPCWSTR *)(param_1 + 0x24),(int *)&local_8);
  if ((int)uVar1 < 0) {
    FUN_00430a57(uVar1,"Failed to concat complete cached path.");
  }
  else {
    uVar1 = FUN_00412e07(param_1,local_8,param_3,param_4);
    if ((int)uVar1 < 0) {
      FUN_00430a57(uVar1,"Failed to layout container from cached path: %ls");
    }
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00413e98 */

uint FUN_00413e98(int param_1,LPCWSTR param_2,LPCWSTR param_3,int param_4)

{
  uint uVar1;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  uVar1 = FUN_004314a9(param_2,*(LPCWSTR *)(param_1 + 0x18),(int *)&local_8);
  if ((int)uVar1 < 0) {
    FUN_00430a57(uVar1,"Failed to concat complete cached path.");
  }
  else {
    uVar1 = FUN_00412f1f(param_1,local_8,param_3,param_4);
    if ((int)uVar1 < 0) {
      FUN_00430a57(uVar1,"Failed to layout payload from cached payload: %ls");
    }
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00413f05 */

int FUN_00413f05(int param_1,undefined4 param_2)

{
  int iVar1;
  
  iVar1 = FUN_004124b8(1,param_1,param_2,(LPCWSTR)param_2);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to remove bundle id: %ls.");
  }
  return iVar1;
}



/* Function: FUN_00413f37 */

int FUN_00413f37(int param_1,undefined4 param_2,LPCWSTR param_3)

{
  int iVar1;
  
  iVar1 = FUN_004124b8(0,param_1,param_2,param_3);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to remove package id: %ls.");
  }
  return iVar1;
}



/* Function: FUN_00413f69 */

int FUN_00413f69(short *param_1)

{
  int iVar1;
  char *pcVar2;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  if (param_1 == (short *)0x0) {
    return 0;
  }
  if (*param_1 == 0) {
    return 0;
  }
  iVar1 = FUN_0041200a(param_1,(int *)&local_8);
  if (iVar1 < 0) {
    pcVar2 = "Failed to calculate the working folder to remove it.";
  }
  else {
    iVar1 = FUN_004314a9(local_8,L".be",(int *)&local_c);
    if (-1 < iVar1) {
      FUN_0043740c(local_c,7);
      iVar1 = FUN_0043740c(local_8,4);
      goto LAB_00413fd6;
    }
    pcVar2 = "Failed to calculate the bundle working folder to remove it.";
  }
  FUN_00430a57(iVar1,pcVar2);
LAB_00413fd6:
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_00413ff9 */

void FUN_00413ff9(int param_1,undefined4 param_2,undefined4 param_3,undefined4 *param_4)

{
  int iVar1;
  
  if (param_4 != (undefined4 *)0x0) {
    *param_4 = 0;
  }
  if (*(code **)(param_1 + 4) != (code *)0x0) {
    iVar1 = (**(code **)(param_1 + 4))
                      (param_2,param_3,param_4 != (undefined4 *)0x0,*(undefined4 *)(param_1 + 8));
    if ((param_4 != (undefined4 *)0x0) && (iVar1 == 4)) {
      *param_4 = 1;
    }
  }
  return;
}



/* Function: FUN_00414038 */

undefined4
FUN_00414038(undefined4 *param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
            undefined4 param_5,undefined4 param_6)

{
  int iVar1;
  undefined4 uVar2;
  char *pcVar3;
  
  uVar2 = 0;
  if (((code *)*param_1 != (code *)0x0) &&
     (iVar1 = (*(code *)*param_1)(param_4,param_5,param_2,param_3,DAT_00456f88,DAT_00456f8c,
                                  DAT_00456f88,DAT_00456f8c,1,0,0xffffffff,param_6,param_1[2]),
     iVar1 != 0)) {
    if ((iVar1 == 1) || (iVar1 == 2)) {
      uVar2 = 0x80070642;
      FUN_004300d9();
      pcVar3 = "UX aborted on download progress.";
    }
    else {
      if (iVar1 == 3) {
        *param_1 = 0;
        return 0;
      }
      uVar2 = 0x8000ffff;
      FUN_004300d9();
      pcVar3 = "Invalid return code from progress routine.";
    }
    FUN_00430a57(uVar2,pcVar3);
  }
  return uVar2;
}



/* Function: FUN_004140c7 */

DWORD FUN_004140c7(LPCRITICAL_SECTION param_1,LPCWSTR param_2,PCNZWCH param_3)

{
  DWORD DVar1;
  int iVar2;
  uint uVar3;
  char *pcVar4;
  uint local_14;
  int local_10;
  PCNZWCH local_c;
  PCNZWCH local_8;
  
  local_14 = 0;
  local_10 = 0;
  local_8 = (PCNZWCH)0x0;
  local_c = (PCNZWCH)0x0;
  DVar1 = FUN_0040e205(param_2,0x7fffffff,(int *)&local_14);
  if ((int)DVar1 < 0) {
    pcVar4 = "Failed to determine length of source path.";
  }
  else {
    DVar1 = FUN_0040e205(param_3,0x7fffffff,&local_10);
    if ((int)DVar1 < 0) {
      pcVar4 = "Failed to determine length of relative path.";
    }
    else {
      if (local_14 < local_10 + 3U) {
        return DVar1;
      }
      uVar3 = local_14 - local_10;
      iVar2 = CompareStringW(0,1,param_2 + uVar3,-1,param_3,-1);
      if (iVar2 != 2) goto LAB_004141c4;
      DVar1 = FUN_00433f88((int *)&local_8,param_2,uVar3);
      if ((int)DVar1 < 0) {
        pcVar4 = "Failed to trim source folder.";
        goto LAB_004141bc;
      }
      DVar1 = FUN_00403c02(param_1,L"WixBundleLastUsedSource",(int *)&local_c);
      if ((int)DVar1 < 0) {
        if (DVar1 == 0x80070490) {
          iVar2 = 3;
          DVar1 = 0;
          goto LAB_0041419e;
        }
      }
      else {
        iVar2 = CompareStringW(0,1,local_8,-1,local_c,-1);
LAB_0041419e:
        if (iVar2 == 2) goto LAB_004141c4;
      }
      DVar1 = FUN_0040461f(param_1,L"WixBundleLastUsedSource",(int)local_8,0);
      if (-1 < (int)DVar1) goto LAB_004141c4;
      pcVar4 = "Failed to set last source.";
    }
  }
LAB_004141bc:
  FUN_00430a57(DVar1,pcVar4);
LAB_004141c4:
  if (local_c != (PCNZWCH)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_004141e9 */

void FUN_004141e9(int param_1,undefined4 param_2,undefined4 param_3)

{
  LONG LVar1;
  uint uVar2;
  CRYPT_PROVIDER_DATA *pProvData;
  DWORD DVar3;
  CRYPT_PROVIDER_SGNR *pCVar4;
  uint uVar5;
  char *pcVar6;
  uint local_5c [3];
  undefined4 local_50;
  undefined4 local_48;
  undefined4 *local_44;
  undefined4 local_40;
  HANDLE local_3c;
  uint local_34;
  undefined4 local_2c;
  undefined4 local_28;
  undefined4 local_24;
  undefined4 uStack_20;
  int local_1c;
  GUID local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_1c = param_1;
  local_2c = 0;
  local_28 = 0;
  local_24 = 0;
  uStack_20 = 0;
  local_18.Data1 = 0xaac56b;
  local_18.Data2 = 0xcd44;
  local_18.Data3 = 0x11d0;
  local_18.Data4[0] = 0x8c;
  local_18.Data4[1] = 0xc2;
  local_18.Data4[2] = '\0';
  local_18.Data4[3] = 0xc0;
  local_18.Data4[4] = 'O';
  local_18.Data4[5] = 0xc2;
  local_18.Data4[6] = 0x95;
  local_18.Data4[7] = 0xee;
  FUN_004267c0(local_5c,0,0x30);
  local_44 = &local_2c;
  local_2c = 0x10;
  local_28 = param_2;
  local_24 = param_3;
  local_5c[0] = 0x30;
  local_48 = 1;
  local_40 = 1;
  local_34 = 0x80;
  local_50 = 2;
  LVar1 = WinVerifyTrust((HWND)0xffffffff,&local_18,local_5c);
  if (LVar1 != 0) {
    local_34 = local_34 | 0x1000;
    uVar2 = WinVerifyTrust((HWND)0xffffffff,&local_18,local_5c);
    if (uVar2 != 0) {
      uVar5 = uVar2 & 0xffff | 0x80070000;
      if ((int)uVar2 < 1) {
        uVar5 = uVar2;
      }
      if (-1 < (int)uVar5) {
        uVar5 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar5,"Failed authenticode verification of payload: %ls");
      goto LAB_00414378;
    }
  }
  pProvData = WTHelperProvDataFromStateData(local_3c);
  if (pProvData == (CRYPT_PROVIDER_DATA *)0x0) {
    DVar3 = GetLastError();
    uVar2 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar2 = DVar3;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    pcVar6 = "Failed to get provider state from authenticode certificate.";
  }
  else {
    pCVar4 = WTHelperGetProvSignerFromChain(pProvData,0,0,0);
    if (pCVar4 == (CRYPT_PROVIDER_SGNR *)0x0) {
      DVar3 = GetLastError();
      uVar2 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar2 = DVar3;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
      pcVar6 = "Failed to get signer chain from authenticode certificate.";
    }
    else {
      uVar2 = FUN_004129f9(local_1c,(int)pCVar4->pChainContext);
      if (-1 < (int)uVar2) goto LAB_00414378;
      pcVar6 = "Failed to verify expected payload against actual certificate chain.";
    }
  }
  FUN_00430a57(uVar2,pcVar6);
LAB_00414378:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0041438b */

DWORD FUN_0041438b(DWORD *param_1)

{
  BOOL BVar1;
  DWORD DVar2;
  DWORD DVar3;
  uint uVar4;
  char *pcVar5;
  DWORD local_c [2];
  
  local_c[0] = 0;
  local_c[1] = 0;
  BVar1 = TlsSetValue(*param_1,(LPVOID)param_1[1]);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar5 = "Failed to set elevated cache pipe into thread local storage for logging.";
  }
  else {
    uVar4 = CoInitializeEx((LPVOID)0x0,0);
    if (-1 < (int)uVar4) {
      DVar3 = FUN_0040f6a6((HANDLE)param_1[1],FUN_004158ca,param_1,local_c);
      DVar2 = local_c[0];
      if ((int)DVar3 < 0) {
        FUN_00430a57(DVar3,"Failed to pump messages in child process.");
        DVar2 = DVar3;
      }
      CoUninitialize();
      return DVar2;
    }
    pcVar5 = "Failed to initialize COM.";
  }
  FUN_00430a57(uVar4,pcVar5);
  return uVar4;
}



/* Function: FUN_00414436 */

undefined4 FUN_00414436(int *param_1,HANDLE param_2)

{
  int iVar1;
  DWORD DVar2;
  uint uVar3;
  char *pcVar4;
  undefined4 local_10;
  rsize_t local_c;
  void *local_8;
  
  local_10 = 1;
  local_8 = (void *)0x0;
  local_c = 0;
  uVar3 = 0;
  DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[1]);
  if ((int)DVar2 < 0) {
    pcVar4 = "Failed to write UI flags.";
  }
  else {
    iVar1 = *param_1;
    if (iVar1 == 1) {
      DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[2]);
      if ((int)DVar2 < 0) {
        pcVar4 = "Failed to write error code to message buffer.";
      }
      else {
        DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)param_1[3]);
        if (-1 < (int)DVar2) {
          uVar3 = 0x14;
          goto LAB_00414523;
        }
        pcVar4 = "Failed to write message to message buffer.";
      }
    }
    else {
      if (iVar1 == 2) {
        DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[2]);
        if ((int)DVar2 < 0) {
          pcVar4 = "Failed to write progress percentage to message buffer.";
          goto LAB_00414541;
        }
        uVar3 = 0x13;
      }
      else if (iVar1 == 3) {
        DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[2]);
        if ((int)DVar2 < 0) {
          pcVar4 = "Failed to count of files in use to message buffer.";
          goto LAB_00414541;
        }
        if (param_1[2] != 0) {
          do {
            DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,
                                 *(LPCWSTR *)(param_1[3] + uVar3 * 4));
            if ((int)DVar2 < 0) {
              pcVar4 = "Failed to write file in use to message buffer.";
              goto LAB_00414541;
            }
            uVar3 = uVar3 + 1;
          } while (uVar3 < (uint)param_1[2]);
        }
        uVar3 = 0x16;
      }
LAB_00414523:
      DVar2 = FUN_0040f882(param_2,uVar3,local_8,local_c,(undefined *)0x0,0,&local_10);
      if (-1 < (int)DVar2) goto LAB_00414549;
      pcVar4 = "Failed to send message to per-user process.";
    }
  }
LAB_00414541:
  FUN_00430a57(DVar2,pcVar4);
LAB_00414549:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return local_10;
}



/* Function: FUN_00414561 */

undefined4 FUN_00414561(int *param_1,HANDLE param_2)

{
  int iVar1;
  DWORD DVar2;
  uint uVar3;
  char *pcVar4;
  undefined4 uVar5;
  undefined4 local_10;
  rsize_t local_c;
  void *local_8;
  
  local_10 = 1;
  local_8 = (void *)0x0;
  local_c = 0;
  iVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[2]);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to write MSI data count to message buffer.");
    goto LAB_004146d6;
  }
  uVar3 = 0;
  if (param_1[2] != 0) {
    do {
      DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,*(LPCWSTR *)(param_1[3] + uVar3 * 4));
      if ((int)DVar2 < 0) {
        pcVar4 = "Failed to write MSI data to message buffer.";
        goto LAB_004146cd;
      }
      uVar3 = uVar3 + 1;
    } while (uVar3 < (uint)param_1[2]);
  }
  DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[1]);
  if ((int)DVar2 < 0) {
    pcVar4 = "Failed to write UI flags.";
  }
  else {
    iVar1 = *param_1;
    if (iVar1 == 1) {
      DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[5]);
      if (-1 < (int)DVar2) {
        uVar5 = 0x13;
        goto LAB_004146ae;
      }
      pcVar4 = "Failed to write progress percentage to message buffer.";
    }
    else if (iVar1 == 2) {
      DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[5]);
      if ((int)DVar2 < 0) {
        pcVar4 = "Failed to write error code to message buffer.";
      }
      else {
        DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)param_1[6]);
        if (-1 < (int)DVar2) {
          uVar5 = 0x14;
          goto LAB_004146ae;
        }
LAB_00414653:
        pcVar4 = "Failed to write message to message buffer.";
      }
    }
    else {
      if (iVar1 == 3) {
        DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_1[5]);
        if ((int)DVar2 < 0) {
          pcVar4 = "Failed to write MSI message type to message buffer.";
          goto LAB_004146cd;
        }
        DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)param_1[6]);
        if ((int)DVar2 < 0) goto LAB_00414653;
        uVar5 = 0x15;
      }
      else {
        if (iVar1 != 4) {
          FUN_00430a57(0x8000ffff,"Invalid message type: %d");
          goto LAB_004146d6;
        }
        uVar5 = 0x16;
      }
LAB_004146ae:
      DVar2 = FUN_0040f882(param_2,uVar5,local_8,local_c,(undefined *)0x0,0,&local_10);
      if (-1 < (int)DVar2) goto LAB_004146d6;
      pcVar4 = "Failed to send message to per-machine process.";
    }
  }
LAB_004146cd:
  FUN_00430a57(DVar2,pcVar4);
LAB_004146d6:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return local_10;
}



/* Function: FUN_004146ed */

DWORD FUN_004146ed(LPCRITICAL_SECTION param_1,int param_2,undefined4 param_3,undefined4 *param_4,
                  int param_5,uint param_6)

{
  DWORD DVar1;
  int iVar2;
  char *pcVar3;
  int local_18;
  int local_14;
  LPVOID local_10;
  int local_c [2];
  
  local_c[1] = 0;
  local_14 = 0;
  local_c[0] = 0;
  local_18 = 0;
  local_10 = (LPVOID)0x0;
  DVar1 = FUN_004302f8(param_5,param_6,(uint *)(local_c + 1),&local_14);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to read action.";
  }
  else {
    DVar1 = FUN_004302f8(param_5,param_6,(uint *)(local_c + 1),local_c);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to read update action.";
    }
    else {
      DVar1 = FUN_004302f8(param_5,param_6,(uint *)(local_c + 1),&local_18);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to read sysem restore point action.";
      }
      else {
        DVar1 = FUN_00403823(param_1,param_5,param_6,(uint *)(local_c + 1));
        if ((int)DVar1 < 0) {
          pcVar3 = "Failed to read variables.";
        }
        else {
          DVar1 = FUN_004223ef();
          if ((int)DVar1 < 0) {
            pcVar3 = "Failed to acquire lock due to setup in other session.";
          }
          else {
            FUN_0041fa79((int *)(param_2 + 0xb4));
            DVar1 = FUN_0041f98e(1,param_2,(int *)(param_2 + 0xb4));
            if (-1 < (int)DVar1) {
              if ((local_c[0] == 1) || (local_c[0] == 2)) {
                DVar1 = FUN_0043649f();
                if ((int)DVar1 < 0) {
                  FUN_00402003(2,0xa0000134);
                  DVar1 = 0;
                }
                else if (local_c[0] == 1) {
                  *param_4 = 1;
                }
              }
              if (local_18 != 0) {
                DVar1 = FUN_00403c02(param_1,L"WixBundleName",(int *)&local_10);
                if (-1 < (int)DVar1) {
                  FUN_00402003(2,0x20000168);
                  iVar2 = 3;
                  if (local_14 == 3) {
                    iVar2 = 1;
                  }
                  if (local_14 == 4) {
                    iVar2 = 2;
                  }
                  DVar1 = FUN_00433115((int)local_10,iVar2);
                  if (-1 < (int)DVar1) {
                    FUN_00402003(2,0x20000169);
                    goto LAB_0041487b;
                  }
                  if (DVar1 == 0x80004001) {
                    FUN_00402003(2,0x2000016a);
                  }
                  else {
                    FUN_00402003(2,0xa000016b);
                  }
                }
                DVar1 = 0;
              }
              goto LAB_0041487b;
            }
            pcVar3 = "Failed to initialize per-machine related bundles.";
          }
        }
      }
    }
  }
  FUN_00430a57(DVar1,pcVar3);
LAB_0041487b:
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  return DVar1;
}



/* Function: FUN_00414892 */

uint FUN_00414892(int *param_1,int param_2,int *param_3,int param_4,uint param_5)

{
  uint uVar1;
  char *pcVar2;
  int local_24;
  int local_20;
  undefined4 *local_1c;
  int local_18;
  LPCWSTR local_14;
  uint local_10;
  LPCWSTR local_c;
  PCNZWCH local_8;
  
  local_10 = 0;
  local_8 = (PCNZWCH)0x0;
  local_20 = 0;
  local_24 = 0;
  local_1c = (undefined4 *)0x0;
  local_14 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  local_18 = 0;
  uVar1 = FUN_00430351(param_4,param_5,&local_10,(int *)&local_8);
  if ((int)uVar1 < 0) {
LAB_004148d0:
    pcVar2 = "Failed to read package id.";
  }
  else {
    if ((local_8 != (PCNZWCH)0x0) && (*local_8 != L'\0')) {
      uVar1 = FUN_00418ec8(param_1,local_8,&local_20);
      if (-1 < (int)uVar1) goto LAB_00414908;
      pcVar2 = "Failed to find container: %ls";
LAB_00414a7d:
      FUN_00430a57(uVar1,pcVar2);
      goto LAB_00414aaa;
    }
LAB_00414908:
    uVar1 = FUN_00430351(param_4,param_5,&local_10,(int *)&local_8);
    if ((int)uVar1 < 0) goto LAB_004148d0;
    if ((local_8 != (PCNZWCH)0x0) && (*local_8 != L'\0')) {
      uVar1 = FUN_00408dfe(param_2,local_8,&local_24);
      if ((int)uVar1 < 0) {
        pcVar2 = "Failed to find package: %ls";
        goto LAB_00414a7d;
      }
    }
    uVar1 = FUN_00430351(param_4,param_5,&local_10,(int *)&local_8);
    if ((int)uVar1 < 0) {
      pcVar2 = "Failed to read payload id.";
    }
    else {
      if ((local_8 != (PCNZWCH)0x0) && (*local_8 != L'\0')) {
        uVar1 = FUN_00407f4a(param_3,local_8,&local_1c);
        if ((int)uVar1 < 0) {
          pcVar2 = "Failed to find payload: %ls";
          goto LAB_00414a7d;
        }
      }
      uVar1 = FUN_00430351(param_4,param_5,&local_10,(int *)&local_14);
      if ((int)uVar1 < 0) {
        pcVar2 = "Failed to read layout directory.";
      }
      else {
        uVar1 = FUN_00430351(param_4,param_5,&local_10,(int *)&local_c);
        if ((int)uVar1 < 0) {
          pcVar2 = "Failed to read unverified path.";
        }
        else {
          uVar1 = FUN_004302f8(param_4,param_5,&local_10,&local_18);
          if ((int)uVar1 < 0) {
            pcVar2 = "Failed to read move flag.";
          }
          else {
            if ((local_14 != (LPCWSTR)0x0) && (*local_14 != L'\0')) {
              if (local_20 == 0) {
                uVar1 = FUN_00413e98((int)local_1c,local_14,local_c,local_18);
                if (-1 < (int)uVar1) goto LAB_00414aaa;
                pcVar2 = "Failed to layout payload from: %ls to %ls";
              }
              else {
                uVar1 = FUN_00413e2b(local_20,local_14,local_c,local_18);
                if (-1 < (int)uVar1) goto LAB_00414aaa;
                pcVar2 = "Failed to layout container from: %ls to %ls";
              }
              FUN_00430a57(uVar1,pcVar2);
              goto LAB_00414aaa;
            }
            if (local_24 != 0) {
              uVar1 = FUN_0041376c(*(int *)(local_24 + 0x14),local_1c,
                                   *(undefined4 *)(local_24 + 0x24),local_c,local_18);
              if (-1 < (int)uVar1) goto LAB_00414aaa;
              pcVar2 = "Failed to cache payload: %ls";
              goto LAB_00414a7d;
            }
            uVar1 = 0x80070057;
            FUN_004300d9();
            pcVar2 = "Invalid data passed to cache or layout payload.";
          }
        }
      }
    }
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_00414aaa:
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00414add */

int FUN_00414add(int param_1,int param_2,uint param_3)

{
  int iVar1;
  char *pcVar2;
  uint local_10;
  undefined4 *local_c;
  PCNZWCH local_8;
  
  local_10 = 0;
  local_8 = (PCNZWCH)0x0;
  local_c = (undefined4 *)0x0;
  iVar1 = FUN_00430351(param_2,param_3,&local_10,(int *)&local_8);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to read package id.");
  }
  else {
    iVar1 = FUN_00408dfe(param_1,local_8,&local_c);
    if (iVar1 < 0) {
      pcVar2 = "Failed to find package: %ls";
    }
    else {
      iVar1 = FUN_00413f37(1,*local_c,(LPCWSTR)local_c[9]);
      if (-1 < iVar1) goto LAB_00414b5e;
      pcVar2 = "Failed to remove from cache package: %ls";
    }
    FUN_00430a57(iVar1,pcVar2);
  }
LAB_00414b5e:
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_00414b73 */

DWORD FUN_00414b73(undefined4 param_1,int param_2,int *param_3,LPCRITICAL_SECTION param_4,
                  int param_5,uint param_6)

{
  DWORD DVar1;
  char *pcVar2;
  uint local_48 [2];
  undefined4 local_40 [2];
  undefined4 local_38;
  int local_34 [7];
  int local_18;
  int local_14;
  LPCWSTR local_10;
  uint local_c;
  PCNZWCH local_8;
  
  local_c = 0;
  local_8 = (PCNZWCH)0x0;
  local_18 = 0;
  FUN_004267c0(local_48,0,0x30);
  local_10 = (LPCWSTR)0x0;
  local_14 = 0;
  local_48[0] = 4;
  DVar1 = FUN_00430351(param_5,param_6,&local_c,(int *)&local_8);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to read exe package.";
  }
  else {
    DVar1 = FUN_004302f8(param_5,param_6,&local_c,&local_38);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to read action.";
    }
    else {
      DVar1 = FUN_004302f8(param_5,param_6,&local_c,&local_18);
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to read rollback.";
      }
      else {
        DVar1 = FUN_00430351(param_5,param_6,&local_c,(int *)&local_10);
        if ((int)DVar1 < 0) {
          pcVar2 = "Failed to read the list of dependencies to ignore.";
        }
        else {
          DVar1 = FUN_00403823(param_4,param_5,param_6,&local_c);
          if ((int)DVar1 < 0) {
            pcVar2 = "Failed to read variables.";
          }
          else {
            DVar1 = FUN_00408dfe(param_2,local_8,local_40);
            if (DVar1 == 0x80070490) {
              DVar1 = FUN_00408e5f(param_3,local_8,local_40);
            }
            if ((int)DVar1 < 0) {
              FUN_00430a57(DVar1,"Failed to find package: %ls");
              goto LAB_00414cd8;
            }
            if ((local_10 != (LPCWSTR)0x0) && (*local_10 != L'\0')) {
              DVar1 = FUN_00433f88(local_34,local_10,0);
              if ((int)DVar1 < 0) {
                pcVar2 = "Failed to allocate the list of dependencies to ignore.";
                goto LAB_00414cd0;
              }
            }
            DVar1 = FUN_004195ac((int)local_48,param_4,local_18,FUN_00414436,param_1,&local_14);
            if (-1 < (int)DVar1) goto LAB_00414cd8;
            pcVar2 = "Failed to execute EXE package.";
          }
        }
      }
    }
  }
LAB_00414cd0:
  FUN_00430a57(DVar1,pcVar2);
LAB_00414cd8:
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  FUN_0040de80((int *)local_48);
  if (-1 < (int)DVar1) {
    if (local_14 == 1) {
      DVar1 = 0x80070bc2;
    }
    else if (local_14 == 2) {
      DVar1 = 0x80070669;
    }
  }
  return DVar1;
}



/* Function: FUN_00414d23 */

DWORD FUN_00414d23(uint param_1,int param_2,LPCRITICAL_SECTION param_3,int param_4,uint param_5)

{
  uint uVar1;
  DWORD DVar2;
  uint uVar3;
  char *pcVar4;
  uint local_48 [2];
  int local_40;
  int local_3c [2];
  undefined4 local_34;
  undefined4 local_30;
  int local_2c;
  int local_28;
  uint local_18;
  uint local_14;
  int local_10;
  PCNZWCH local_c;
  uint local_8;
  
  uVar1 = param_5;
  uVar3 = 0;
  local_8 = 0;
  local_c = (PCNZWCH)0x0;
  local_18 = 0;
  local_14 = 0;
  FUN_004267c0(local_48,0,0x30);
  local_10 = 0;
  local_48[0] = 5;
  DVar2 = FUN_00430351(param_4,param_5,&local_8,(int *)&local_c);
  if ((int)DVar2 < 0) {
LAB_00414d6d:
    pcVar4 = "Failed to read action.";
    goto LAB_00414f8f;
  }
  DVar2 = FUN_00408dfe(param_2,local_c,&local_40);
  if ((int)DVar2 < 0) {
    FUN_00430a57(DVar2,"Failed to find package: %ls");
    goto LAB_00414f96;
  }
  DVar2 = FUN_004302f8(param_4,param_5,&local_8,&local_18);
  if ((int)DVar2 < 0) {
    pcVar4 = "Failed to read parent hwnd.";
  }
  else {
    DVar2 = FUN_00430351(param_4,param_5,&local_8,local_3c);
    if ((int)DVar2 < 0) {
      pcVar4 = "Failed to read package log.";
    }
    else {
      DVar2 = FUN_004302f8(param_4,param_5,&local_8,&local_34);
      if ((int)DVar2 < 0) {
        pcVar4 = "Failed to read UI level.";
      }
      else {
        DVar2 = FUN_004302f8(param_4,param_5,&local_8,&local_30);
        if ((int)DVar2 < 0) goto LAB_00414d6d;
        if (*(int *)(local_40 + 0xb8) == 0) {
LAB_00414eb1:
          if (*(int *)(local_40 + 0xcc) != 0) {
            local_28 = FUN_00431078(*(int *)(local_40 + 0xcc) << 2,1);
            if (local_28 == 0) {
              FUN_004300d9();
              pcVar4 = "Failed to allocate memory for slipstream patch actions.";
              goto LAB_00414e63;
            }
            if (*(int *)(local_40 + 0xcc) != 0) {
              do {
                DVar2 = FUN_004302f8(param_4,uVar1,&local_8,(undefined4 *)(local_28 + uVar3 * 4));
                if ((int)DVar2 < 0) {
                  pcVar4 = "Failed to read slipstream action.";
                  goto LAB_00414f8f;
                }
                uVar3 = uVar3 + 1;
              } while (uVar3 < *(uint *)(local_40 + 0xcc));
            }
          }
          DVar2 = FUN_00403823(param_3,param_4,uVar1,&local_8);
          if ((int)DVar2 < 0) {
            pcVar4 = "Failed to read variables.";
          }
          else {
            DVar2 = FUN_004302f8(param_4,uVar1,&local_8,&local_14);
            if ((int)DVar2 < 0) {
              pcVar4 = "Failed to read rollback flag.";
            }
            else {
              DVar2 = FUN_0041b2fa(local_18,(int)local_48,param_3,local_14,0x414561,param_1,
                                   &local_10);
              if (-1 < (int)DVar2) goto LAB_00414f96;
              pcVar4 = "Failed to execute MSI package.";
            }
          }
        }
        else {
          local_2c = FUN_00431078(*(int *)(local_40 + 0xb8) << 2,1);
          if (local_2c != 0) {
            param_5 = 0;
            if (*(int *)(local_40 + 0xb8) != 0) {
              do {
                DVar2 = FUN_004302f8(param_4,uVar1,&local_8,(undefined4 *)(local_2c + param_5 * 4));
                if ((int)DVar2 < 0) {
                  pcVar4 = "Failed to read feature action.";
                  goto LAB_00414f8f;
                }
                param_5 = param_5 + 1;
              } while (param_5 < *(uint *)(local_40 + 0xb8));
            }
            goto LAB_00414eb1;
          }
          FUN_004300d9();
          pcVar4 = "Failed to allocate memory for feature actions.";
LAB_00414e63:
          DVar2 = 0x8007000e;
        }
      }
    }
  }
LAB_00414f8f:
  FUN_00430a57(DVar2,pcVar4);
LAB_00414f96:
  if (local_c != (PCNZWCH)0x0) {
    FUN_004380ab(local_c);
  }
  FUN_0040de80((int *)local_48);
  if (-1 < (int)DVar2) {
    if (local_10 == 1) {
      DVar2 = 0x80070bc2;
    }
    else if (local_10 == 2) {
      DVar2 = 0x80070669;
    }
  }
  return DVar2;
}



/* Function: FUN_00414fd3 */

DWORD FUN_00414fd3(uint param_1,int param_2,LPCRITICAL_SECTION param_3,int param_4,uint param_5)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  uint local_48 [2];
  undefined4 local_40;
  int local_3c [3];
  undefined4 local_30;
  int local_2c;
  undefined4 local_28;
  undefined4 local_24;
  int local_20;
  uint local_1c;
  uint local_18;
  uint local_14;
  int local_10;
  PCNZWCH local_c;
  uint local_8;
  
  uVar2 = 0;
  local_8 = 0;
  local_c = (PCNZWCH)0x0;
  local_18 = 0;
  local_14 = 0;
  FUN_004267c0(local_48,0,0x30);
  local_10 = 0;
  local_48[0] = 6;
  DVar1 = FUN_00430351(param_4,param_5,&local_8,(int *)&local_c);
  if ((int)DVar1 < 0) {
LAB_0041501d:
    pcVar3 = "Failed to read action.";
  }
  else {
    DVar1 = FUN_00408dfe(param_2,local_c,&local_40);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to find package: %ls";
LAB_004151a3:
      FUN_00430a57(DVar1,pcVar3);
      goto LAB_00415228;
    }
    DVar1 = FUN_004302f8(param_4,param_5,&local_8,&local_18);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to read parent hwnd.";
    }
    else {
      local_30 = 1;
      DVar1 = FUN_00430351(param_4,param_5,&local_8,local_3c);
      if (((int)DVar1 < 0) ||
         (DVar1 = FUN_00430351(param_4,param_5,&local_8,&local_2c), (int)DVar1 < 0)) {
        pcVar3 = "Failed to read package log.";
      }
      else {
        DVar1 = FUN_004302f8(param_4,param_5,&local_8,&local_28);
        if ((int)DVar1 < 0) {
          pcVar3 = "Failed to read UI level.";
        }
        else {
          DVar1 = FUN_004302f8(param_4,param_5,&local_8,&local_24);
          if ((int)DVar1 < 0) goto LAB_0041501d;
          DVar1 = FUN_004302f8(param_4,param_5,&local_8,&local_1c);
          if ((int)DVar1 < 0) {
            pcVar3 = "Failed to read count of ordered patches.";
          }
          else {
            if (local_1c != 0) {
              local_20 = FUN_00431078(local_1c << 3,1);
              if (local_20 == 0) {
                DVar1 = 0x8007000e;
                FUN_004300d9();
                pcVar3 = "Failed to allocate memory for ordered patches.";
                goto LAB_00415220;
              }
              if (local_1c != 0) {
                do {
                  DVar1 = FUN_004302f8(param_4,param_5,&local_8,(undefined4 *)(local_20 + uVar2 * 8)
                                      );
                  if ((int)DVar1 < 0) {
                    pcVar3 = "Failed to read ordered patch order number.";
                    goto LAB_00415220;
                  }
                  DVar1 = FUN_00430351(param_4,param_5,&local_8,(int *)&local_c);
                  if ((int)DVar1 < 0) {
                    pcVar3 = "Failed to read ordered patch package id.";
                    goto LAB_00415220;
                  }
                  DVar1 = FUN_00408dfe(param_2,local_c,(undefined4 *)(local_20 + uVar2 * 8 + 4));
                  if ((int)DVar1 < 0) {
                    pcVar3 = "Failed to find ordered patch package: %ls";
                    goto LAB_004151a3;
                  }
                  uVar2 = uVar2 + 1;
                } while (uVar2 < local_1c);
              }
            }
            DVar1 = FUN_00403823(param_3,param_4,param_5,&local_8);
            if ((int)DVar1 < 0) {
              pcVar3 = "Failed to read variables.";
            }
            else {
              DVar1 = FUN_004302f8(param_4,param_5,&local_8,&local_14);
              if ((int)DVar1 < 0) {
                pcVar3 = "Failed to read rollback flag.";
              }
              else {
                DVar1 = FUN_0041d0bc(local_18,(int)local_48,param_3,local_14,0x414561,param_1,
                                     &local_10);
                if (-1 < (int)DVar1) goto LAB_00415228;
                pcVar3 = "Failed to execute MSP package.";
              }
            }
          }
        }
      }
    }
  }
LAB_00415220:
  FUN_00430a57(DVar1,pcVar3);
LAB_00415228:
  if (local_c != (PCNZWCH)0x0) {
    FUN_004380ab(local_c);
  }
  FUN_0040de80((int *)local_48);
  if (-1 < (int)DVar1) {
    if (local_10 == 1) {
      DVar1 = 0x80070bc2;
    }
    else if (local_10 == 2) {
      DVar1 = 0x80070669;
    }
  }
  return DVar1;
}



/* Function: FUN_00415265 */

DWORD FUN_00415265(undefined4 param_1,int param_2,int param_3,uint param_4)

{
  DWORD DVar1;
  char *pcVar2;
  uint local_44 [2];
  undefined4 local_3c;
  int local_38;
  undefined4 local_34 [8];
  int local_14;
  int local_10 [2];
  PCNZWCH local_8;
  
  local_10[1] = 0;
  local_8 = (PCNZWCH)0x0;
  local_14 = 0;
  FUN_004267c0(local_44,0,0x30);
  local_10[0] = 0;
  local_44[0] = 7;
  DVar1 = FUN_00430351(param_3,param_4,(uint *)(local_10 + 1),(int *)&local_8);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to read package id.";
  }
  else {
    DVar1 = FUN_00430351(param_3,param_4,(uint *)(local_10 + 1),&local_38);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to read package log.";
    }
    else {
      DVar1 = FUN_004302f8(param_3,param_4,(uint *)(local_10 + 1),local_34);
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to read action.";
      }
      else {
        DVar1 = FUN_004302f8(param_3,param_4,(uint *)(local_10 + 1),&local_14);
        if ((int)DVar1 < 0) {
          pcVar2 = "Failed to read rollback.";
        }
        else {
          DVar1 = FUN_00408dfe(param_2,local_8,&local_3c);
          if ((int)DVar1 < 0) {
            FUN_00430a57(DVar1,"Failed to find package: %ls");
            goto LAB_00415369;
          }
          DVar1 = FUN_0041db33((int)local_44,local_14,FUN_00414436,param_1,local_10);
          if (-1 < (int)DVar1) goto LAB_00415369;
          pcVar2 = "Failed to execute MSU package.";
        }
      }
    }
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_00415369:
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  FUN_0040de80((int *)local_44);
  if (-1 < (int)DVar1) {
    if (local_10[0] == 1) {
      DVar1 = 0x80070bc2;
    }
    else if (local_10[0] == 2) {
      DVar1 = 0x80070669;
    }
  }
  return DVar1;
}



/* Function: FUN_004153a4 */

uint FUN_004153a4(int param_1,int *param_2,int param_3,uint param_4)

{
  uint uVar1;
  char *pcVar2;
  uint local_3c [2];
  undefined4 local_34;
  int local_30;
  undefined4 local_2c [8];
  uint local_c;
  PCNZWCH local_8;
  
  local_c = 0;
  local_8 = (PCNZWCH)0x0;
  FUN_004267c0(local_3c,0,0x30);
  local_3c[0] = 0xb;
  uVar1 = FUN_00430351(param_3,param_4,&local_c,(int *)&local_8);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to read package id from message buffer.";
  }
  else {
    uVar1 = FUN_00430351(param_3,param_4,&local_c,&local_30);
    if ((int)uVar1 < 0) {
      pcVar2 = "Failed to read bundle dependency key from message buffer.";
    }
    else {
      uVar1 = FUN_004302f8(param_3,param_4,&local_c,local_2c);
      if ((int)uVar1 < 0) {
        pcVar2 = "Failed to read action.";
      }
      else {
        uVar1 = FUN_00408dfe(param_1,local_8,&local_34);
        if (uVar1 == 0x80070490) {
          uVar1 = FUN_00408e5f(param_2,local_8,&local_34);
        }
        if ((int)uVar1 < 0) {
          FUN_00430a57(uVar1,"Failed to find package: %ls");
          return uVar1;
        }
        uVar1 = FUN_0041ea71(1,(int)local_3c);
        if (-1 < (int)uVar1) {
          return uVar1;
        }
        pcVar2 = "Failed to execute package dependency action.";
      }
    }
  }
  FUN_00430a57(uVar1,pcVar2);
  return uVar1;
}



/* Function: FUN_00415492 */

uint FUN_00415492(int param_1,int *param_2,int param_3,uint param_4)

{
  uint uVar1;
  char *pcVar2;
  uint local_3c [2];
  undefined4 local_34;
  undefined4 local_30 [9];
  uint local_c;
  PCNZWCH local_8;
  
  local_c = 0;
  local_8 = (PCNZWCH)0x0;
  FUN_004267c0(local_3c,0,0x30);
  local_3c[0] = 10;
  uVar1 = FUN_00430351(param_3,param_4,&local_c,(int *)&local_8);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to read package id from message buffer.";
  }
  else {
    uVar1 = FUN_004302f8(param_3,param_4,&local_c,local_30);
    if ((int)uVar1 < 0) {
      pcVar2 = "Failed to read action.";
    }
    else {
      uVar1 = FUN_00408dfe(param_1,local_8,&local_34);
      if (uVar1 == 0x80070490) {
        uVar1 = FUN_00408e5f(param_2,local_8,&local_34);
      }
      if ((int)uVar1 < 0) {
        FUN_00430a57(uVar1,"Failed to find package: %ls");
        return uVar1;
      }
      uVar1 = FUN_0041eac7((int)local_3c);
      if (-1 < (int)uVar1) {
        return uVar1;
      }
      pcVar2 = "Failed to execute package provider action.";
    }
  }
  FUN_00430a57(uVar1,pcVar2);
  return uVar1;
}



/* Function: FUN_0041555b */

uint FUN_0041555b(LPCWSTR param_1,int param_2,uint param_3)

{
  uint uVar1;
  char *pcVar2;
  uint local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_10 = 0;
  local_c = (LPCWSTR)0x0;
  local_8 = (LPCWSTR)0x0;
  uVar1 = FUN_00430351(param_2,param_3,&local_10,(int *)&local_c);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to read layout directory.";
  }
  else {
    uVar1 = FUN_00430351(param_2,param_3,&local_10,(int *)&local_8);
    if (-1 < (int)uVar1) {
      uVar1 = FUN_00413da4(param_1,local_c,local_8);
      if ((int)uVar1 < 0) {
        FUN_00430a57(uVar1,"Failed to layout bundle from: %ls");
      }
      goto LAB_004155da;
    }
    pcVar2 = "Failed to read unverified bundle path.";
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_004155da:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return uVar1;
}



/* Function: FUN_004155fd */

uint FUN_004155fd(int param_1,int param_2,uint param_3)

{
  uint uVar1;
  char *pcVar2;
  int local_14;
  LPVOID local_10;
  LPVOID local_c;
  uint local_8;
  
  local_8 = 0;
  local_14 = 0;
  local_10 = (LPVOID)0x0;
  local_c = (LPVOID)0x0;
  uVar1 = FUN_004302f8(param_2,param_3,&local_8,&local_14);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to read action type.";
  }
  else {
    uVar1 = FUN_00430351(param_2,param_3,&local_8,(int *)&local_10);
    if ((int)uVar1 < 0) {
      pcVar2 = "Failed to read bundle id.";
    }
    else {
      uVar1 = FUN_00430351(param_2,param_3,&local_8,(int *)&local_c);
      if (-1 < (int)uVar1) {
        uVar1 = FUN_0041f0f8(param_1,&local_14);
        if ((int)uVar1 < 0) {
          FUN_00430a57(uVar1,"Failed to execute dependent registration action for provider key: %ls"
                      );
        }
        goto LAB_0041569c;
      }
      pcVar2 = "Failed to read dependent provider key.";
    }
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_0041569c:
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  return uVar1;
}



/* Function: FUN_004156c0 */

DWORD FUN_004156c0(int *param_1,LPCRITICAL_SECTION param_2,int param_3,int param_4,uint param_5)

{
  DWORD DVar1;
  char *pcVar2;
  undefined8 local_1c;
  undefined4 local_14;
  int local_10;
  LPCWSTR local_c;
  uint local_8;
  
  local_8 = 0;
  local_c = (LPCWSTR)0x0;
  local_14 = 0;
  local_10 = 0;
  local_1c = 0;
  DVar1 = FUN_00430351(param_4,param_5,&local_8,(int *)&local_c);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to read engine working path.";
  }
  else {
    DVar1 = FUN_00430351(param_4,param_5,&local_8,param_1 + 0x16);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to read resume command line.";
    }
    else {
      DVar1 = FUN_004302f8(param_4,param_5,&local_8,&local_14);
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to read registration operations.";
      }
      else {
        DVar1 = FUN_004302f8(param_4,param_5,&local_8,&local_10);
        if ((int)DVar1 < 0) {
          pcVar2 = "Failed to read dependency registration action.";
        }
        else {
          DVar1 = FUN_00430298(param_4,param_5,&local_8,(undefined4 *)&local_1c);
          if ((int)DVar1 < 0) {
            pcVar2 = "Failed to read estimated size.";
          }
          else {
            DVar1 = FUN_00403823(param_2,param_4,param_5,&local_8);
            if ((int)DVar1 < 0) {
              pcVar2 = "Failed to read variables.";
            }
            else {
              DVar1 = FUN_0040ad55(local_c,param_1,param_2,param_3,(byte)local_14,local_10,
                                   (uint)local_1c,local_1c._4_4_);
              if (-1 < (int)DVar1) goto LAB_004157c5;
              pcVar2 = "Failed to begin registration session.";
            }
          }
        }
      }
    }
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_004157c5:
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar1;
}



/* Function: FUN_004157dc */

uint FUN_004157dc(int *param_1,int param_2,uint param_3)

{
  uint uVar1;
  char *pcVar2;
  int local_14;
  int local_10;
  int local_c [2];
  
  local_c[1] = 0;
  local_14 = 0;
  local_10 = 0;
  local_c[0] = 0;
  uVar1 = FUN_004302f8(param_2,param_3,(uint *)(local_c + 1),&local_14);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to read resume mode enum.";
  }
  else {
    uVar1 = FUN_004302f8(param_2,param_3,(uint *)(local_c + 1),&local_10);
    if ((int)uVar1 < 0) {
      pcVar2 = "Failed to read restart enum.";
    }
    else {
      uVar1 = FUN_004302f8(param_2,param_3,(uint *)(local_c + 1),local_c);
      if ((int)uVar1 < 0) {
        pcVar2 = "Failed to read dependency registration action.";
      }
      else {
        uVar1 = FUN_0040b31f(param_1,local_14,local_10,local_c[0]);
        if (-1 < (int)uVar1) {
          return uVar1;
        }
        pcVar2 = "Failed to suspend registration session.";
      }
    }
  }
  FUN_00430a57(uVar1,pcVar2);
  return uVar1;
}



/* Function: FUN_0041587c */

uint FUN_0041587c(int param_1,int param_2,uint param_3)

{
  uint uVar1;
  char *pcVar2;
  uint local_8;
  
  local_8 = 0;
  uVar1 = FUN_00430351(param_2,param_3,&local_8,(int *)(param_1 + 0x58));
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to read resume command line.";
  }
  else {
    uVar1 = FUN_0040b468(param_1);
    if (-1 < (int)uVar1) {
      return uVar1;
    }
    pcVar2 = "Failed to suspend registration session.";
  }
  FUN_00430a57(uVar1,pcVar2);
  return uVar1;
}



/* Function: FUN_004158ca */

undefined4 FUN_004158ca(int *param_1,int param_2,uint *param_3)

{
  int iVar1;
  uint uVar2;
  
  iVar1 = *param_1;
  if (iVar1 == 7) {
    uVar2 = FUN_0041555b(*(LPCWSTR *)(*(int *)(param_2 + 0x20) + 0x48),param_1[3],param_1[1]);
  }
  else if (iVar1 == 8) {
    uVar2 = FUN_00414892(*(int **)(param_2 + 0x10),*(int *)(param_2 + 0x14),
                         *(int **)(param_2 + 0x18),param_1[3],param_1[1]);
  }
  else if (iVar1 == 9) {
    FUN_00413414(1,*(undefined4 *)(*(int *)(param_2 + 0x20) + 0xc));
    uVar2 = 0;
  }
  else {
    if (iVar1 != 0x12) {
      FUN_004300d9();
      FUN_00430a57(0x80070057,"Unexpected elevated cache message sent to child process, msg: %u");
      return 0x80070057;
    }
    uVar2 = FUN_00414add(*(int *)(param_2 + 0x14),param_1[3],param_1[1]);
  }
  *param_3 = uVar2;
  return 0;
}



/* Function: FUN_0041596e */

undefined4 FUN_0041596e(undefined4 *param_1,int param_2,DWORD *param_3)

{
  int *piVar1;
  DWORD DVar2;
  
  switch(*param_1) {
  case 1:
    DVar2 = FUN_004146ed(*(LPCRITICAL_SECTION *)(param_2 + 0x1c),*(int *)(param_2 + 0x20),
                         *(undefined4 *)(param_2 + 8),*(undefined4 **)(param_2 + 0xc),param_1[3],
                         param_1[1]);
    break;
  case 2:
    piVar1 = *(int **)(param_2 + 8);
    if (*piVar1 != 0) {
      ReleaseMutex((HANDLE)*piVar1);
      CloseHandle((HANDLE)*piVar1);
      *piVar1 = 0;
    }
    DVar2 = 0;
    break;
  case 3:
    DVar2 = FUN_004156c0(*(int **)(param_2 + 0x20),*(LPCRITICAL_SECTION *)(param_2 + 0x1c),
                         *(int *)(param_2 + 0x24),param_1[3],param_1[1]);
    break;
  case 4:
    DVar2 = FUN_0041587c(*(int *)(param_2 + 0x20),param_1[3],param_1[1]);
    break;
  case 5:
    DVar2 = FUN_004157dc(*(int **)(param_2 + 0x20),param_1[3],param_1[1]);
    break;
  case 6:
    DVar2 = FUN_0040ad0e(*(int *)(param_2 + 0x20),param_1[3],param_1[1]);
    if ((int)DVar2 < 0) {
      FUN_00430a57(DVar2,"Failed to save state.");
    }
    break;
  default:
    FUN_004300d9();
    FUN_00430a57(0x80070057,"Unexpected elevated message sent to child process, msg: %u");
    return 0x80070057;
  case 10:
    DVar2 = FUN_004155fd(*(int *)(param_2 + 0x20),param_1[3],param_1[1]);
    break;
  case 0xb:
    DVar2 = FUN_00414b73(*(undefined4 *)(param_2 + 4),*(int *)(param_2 + 0x14),
                         (int *)(*(int *)(param_2 + 0x20) + 0xb4),
                         *(LPCRITICAL_SECTION *)(param_2 + 0x1c),param_1[3],param_1[1]);
    break;
  case 0xc:
    DVar2 = FUN_00414d23(*(uint *)(param_2 + 4),*(int *)(param_2 + 0x14),
                         *(LPCRITICAL_SECTION *)(param_2 + 0x1c),param_1[3],param_1[1]);
    break;
  case 0xd:
    DVar2 = FUN_00414fd3(*(uint *)(param_2 + 4),*(int *)(param_2 + 0x14),
                         *(LPCRITICAL_SECTION *)(param_2 + 0x1c),param_1[3],param_1[1]);
    break;
  case 0xe:
    DVar2 = FUN_00415265(*(undefined4 *)(param_2 + 4),*(int *)(param_2 + 0x14),param_1[3],param_1[1]
                        );
    break;
  case 0xf:
    DVar2 = FUN_00415492(*(int *)(param_2 + 0x14),(int *)(*(int *)(param_2 + 0x20) + 0xb4),
                         param_1[3],param_1[1]);
    break;
  case 0x10:
    DVar2 = FUN_004153a4(*(int *)(param_2 + 0x14),(int *)(*(int *)(param_2 + 0x20) + 0xb4),
                         param_1[3],param_1[1]);
    break;
  case 0x12:
    DVar2 = FUN_00414add(*(int *)(param_2 + 0x14),param_1[3],param_1[1]);
  }
  *param_3 = DVar2;
  return 0;
}



/* Function: FUN_00415b8e */

int FUN_00415b8e(int *param_1,undefined4 *param_2,undefined4 *param_3)

{
  int iVar1;
  undefined4 uVar2;
  int *piVar3;
  int *piVar4;
  int *piVar5;
  char *pcVar6;
  undefined4 local_24;
  undefined4 local_20;
  int *local_1c;
  int *local_18;
  int *local_14;
  int *local_10;
  int *local_c;
  uint local_8;
  
  piVar3 = param_1;
  local_8 = 0;
  local_10 = (int *)0x0;
  local_c = (int *)0x0;
  piVar4 = (int *)0x0;
  local_24 = 0;
  local_20 = 0;
  local_1c = (int *)0x0;
  local_18 = (int *)0x0;
  iVar1 = FUN_004302f8(param_1[3],param_1[1],&local_8,&local_20);
  if (iVar1 < 0) {
    pcVar6 = "Failed to allowed results.";
  }
  else {
    iVar1 = *param_1;
    if (iVar1 == 0x13) {
      local_24 = 2;
      iVar1 = FUN_004302f8(param_1[3],param_1[1],&local_8,&local_1c);
      if (-1 < iVar1) {
LAB_00415ca6:
        uVar2 = (*(code *)*param_2)(&local_24,param_2[1]);
        *param_3 = uVar2;
        goto LAB_00415cb7;
      }
      pcVar6 = "Failed to progress.";
    }
    else if (iVar1 == 0x14) {
      local_24 = 1;
      iVar1 = FUN_004302f8(param_1[3],param_1[1],&local_8,&local_1c);
      if (iVar1 < 0) {
        pcVar6 = "Failed to read error code.";
      }
      else {
        iVar1 = FUN_00430351(param_1[3],param_1[1],&local_8,(int *)&local_10);
        if (-1 < iVar1) {
          local_18 = local_10;
          goto LAB_00415ca6;
        }
        pcVar6 = "Failed to read message.";
      }
    }
    else if (iVar1 == 0x16) {
      local_24 = 3;
      iVar1 = FUN_004302f8(param_1[3],param_1[1],&local_8,&local_c);
      if (iVar1 < 0) {
        pcVar6 = "Failed to read file count.";
      }
      else {
        piVar4 = (int *)FUN_00431078((int)local_c << 2,1);
        if (piVar4 != (int *)0x0) {
          param_1 = (int *)0x0;
          piVar5 = piVar4;
          if (local_c != (int *)0x0) {
            do {
              local_14 = piVar5;
              iVar1 = FUN_00430351(piVar3[3],piVar3[1],&local_8,piVar5);
              if (iVar1 < 0) {
                FUN_00430a57(iVar1,"Failed to read file name: %u");
                goto LAB_00415cb7;
              }
              param_1 = (int *)((int)param_1 + 1);
              local_14 = local_14 + 1;
              piVar5 = local_14;
            } while (param_1 < local_c);
          }
          local_1c = local_c;
          local_18 = piVar4;
          goto LAB_00415ca6;
        }
        iVar1 = -0x7ff8fff2;
        FUN_004300d9();
        pcVar6 = "Failed to allocate buffer for files in use.";
      }
    }
    else {
      iVar1 = -0x7ff8ffa9;
      FUN_004300d9();
      pcVar6 = "Invalid package message.";
    }
  }
  FUN_00430a57(iVar1,pcVar6);
LAB_00415cb7:
  if (local_10 != (int *)0x0) {
    FUN_004380ab(local_10);
  }
  if (piVar4 != (int *)0x0) {
    if (local_c != (int *)0x0) {
      piVar5 = (int *)0x0;
      piVar3 = local_c;
      do {
        if (piVar4[(int)piVar5] != 0) {
          FUN_004380ab((LPVOID)piVar4[(int)piVar5]);
          piVar3 = local_c;
        }
        piVar5 = (int *)((int)piVar5 + 1);
      } while (piVar5 < piVar3);
    }
    FUN_00431137(piVar4);
  }
  return iVar1;
}



/* Function: FUN_00415d91 */

int FUN_00415d91(int *param_1,undefined4 *param_2,undefined4 *param_3)

{
  int iVar1;
  undefined4 uVar2;
  int *piVar3;
  int iVar4;
  int *piVar5;
  int **ppiVar6;
  int *piVar7;
  char *pcVar8;
  int *local_30 [5];
  int *local_1c;
  int *local_18;
  int *local_14;
  int *local_10;
  int *local_c;
  uint local_8;
  
  piVar3 = param_1;
  ppiVar6 = local_30;
  for (iVar4 = 7; iVar4 != 0; iVar4 = iVar4 + -1) {
    *ppiVar6 = (int *)0x0;
    ppiVar6 = ppiVar6 + 1;
  }
  local_8 = 0;
  local_c = (int *)0x0;
  piVar5 = (int *)0x0;
  local_10 = (int *)0x0;
  iVar4 = FUN_004302f8(param_1[3],param_1[1],&local_8,&local_c);
  if (iVar4 < 0) {
    pcVar8 = "Failed to read MSI data count.";
  }
  else {
    if (local_c != (int *)0x0) {
      piVar5 = (int *)FUN_00431078((int)local_c << 2,1);
      if (piVar5 == (int *)0x0) {
        iVar4 = -0x7ff8fff2;
        FUN_004300d9();
        pcVar8 = "Failed to allocate buffer to read MSI data.";
        goto LAB_00415eb9;
      }
      param_1 = (int *)0x0;
      piVar7 = piVar5;
      if (local_c != (int *)0x0) {
        do {
          local_14 = piVar7;
          iVar4 = FUN_00430351(piVar3[3],piVar3[1],&local_8,piVar7);
          if (iVar4 < 0) {
            FUN_00430a57(iVar4,"Failed to read MSI data: %u");
            goto LAB_00415ee4;
          }
          param_1 = (int *)((int)param_1 + 1);
          local_14 = local_14 + 1;
          piVar7 = local_14;
        } while (param_1 < local_c);
      }
      local_30[2] = local_c;
      local_30[3] = piVar5;
    }
    iVar4 = FUN_004302f8(piVar3[3],piVar3[1],&local_8,local_30 + 1);
    if (iVar4 < 0) {
      pcVar8 = "Failed to read UI flags.";
    }
    else {
      iVar1 = *piVar3;
      if (iVar1 == 0x13) {
        local_30[0] = (int *)0x1;
        iVar4 = FUN_004302f8(piVar3[3],piVar3[1],&local_8,&local_1c);
        if (-1 < iVar4) {
LAB_00415ed3:
          uVar2 = (*(code *)*param_2)(local_30,param_2[1]);
          *param_3 = uVar2;
          goto LAB_00415ee4;
        }
        pcVar8 = "Failed to read progress.";
      }
      else if (iVar1 == 0x14) {
        local_30[0] = (int *)0x2;
        iVar4 = FUN_004302f8(piVar3[3],piVar3[1],&local_8,&local_1c);
        if (iVar4 < 0) {
          pcVar8 = "Failed to read error code.";
        }
        else {
LAB_00415f4e:
          iVar4 = FUN_00430351(piVar3[3],piVar3[1],&local_8,(int *)&local_10);
          if (-1 < iVar4) {
            local_18 = local_10;
            goto LAB_00415ed3;
          }
          pcVar8 = "Failed to read message.";
        }
      }
      else if (iVar1 == 0x15) {
        local_30[0] = (int *)0x3;
        iVar4 = FUN_004302f8(piVar3[3],piVar3[1],&local_8,&local_1c);
        if (-1 < iVar4) goto LAB_00415f4e;
        pcVar8 = "Failed to read message type.";
      }
      else {
        if (iVar1 == 0x16) {
          local_30[0] = (int *)0x4;
          local_1c = local_c;
          local_18 = piVar5;
          goto LAB_00415ed3;
        }
        iVar4 = -0x7ff8ffa9;
        FUN_004300d9();
        pcVar8 = "Invalid package message.";
      }
    }
  }
LAB_00415eb9:
  FUN_00430a57(iVar4,pcVar8);
LAB_00415ee4:
  if (local_10 != (int *)0x0) {
    FUN_004380ab(local_10);
  }
  if (piVar5 != (int *)0x0) {
    if (local_c != (int *)0x0) {
      piVar7 = (int *)0x0;
      piVar3 = local_c;
      do {
        if (piVar5[(int)piVar7] != 0) {
          FUN_004380ab((LPVOID)piVar5[(int)piVar7]);
          piVar3 = local_c;
        }
        piVar7 = (int *)((int)piVar7 + 1);
      } while (piVar7 < piVar3);
    }
    FUN_00431137(piVar5);
  }
  return iVar4;
}



/* Function: FUN_00415fd4 */

int FUN_00415fd4(int param_1,undefined4 *param_2)

{
  if (param_1 == -0x7ff8f43e) {
    *param_2 = 1;
  }
  else {
    if (param_1 != -0x7ff8f997) {
      return param_1;
    }
    *param_2 = 2;
  }
  return 0;
}



/* Function: FUN_00416002 */

DWORD FUN_00416002(HANDLE param_1)

{
  DWORD DVar1;
  BOOL BVar2;
  uint uVar3;
  char *pcVar4;
  DWORD local_8;
  
  local_8 = 0;
  DVar1 = WaitForSingleObject(param_1,300000);
  if (DVar1 == 0) {
    BVar2 = GetExitCodeThread(param_1,&local_8);
    if (BVar2 != 0) {
      return 0;
    }
    DVar1 = GetLastError();
    uVar3 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar3 = DVar1;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    pcVar4 = "Failed to get cache thread exit code.";
  }
  else {
    DVar1 = GetLastError();
    uVar3 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar3 = DVar1;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    pcVar4 = "Failed to wait for cache thread to terminate.";
  }
  FUN_00430a57(uVar3,pcVar4);
  return uVar3;
}



/* Function: FUN_004160a6 */

DWORD FUN_004160a6(HANDLE param_1,LPCRITICAL_SECTION param_2,undefined4 param_3,undefined4 param_4,
                  undefined4 param_5)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_3);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write action to message buffer.";
  }
  else {
    DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_4);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to write update action to message buffer.";
    }
    else {
      DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_5);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to write system restore point action to message buffer.";
      }
      else {
        DVar1 = FUN_00404496(param_2,0,(int *)&local_8,(int *)&local_c);
        if ((int)DVar1 < 0) {
          pcVar3 = "Failed to write variables.";
        }
        else {
          DVar1 = FUN_0040f882(param_1,1,local_8,local_c,(undefined *)0x0,0,&local_10);
          DVar2 = local_10;
          if (-1 < (int)DVar1) goto LAB_0041615c;
          pcVar3 = "Failed to send message to per-machine process.";
        }
      }
    }
  }
  FUN_00430a57(DVar1,pcVar3);
  DVar2 = DVar1;
LAB_0041615c:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_00416171 */

DWORD FUN_00416171(HANDLE param_1)

{
  DWORD DVar1;
  DWORD local_8;
  
  local_8 = 0;
  DVar1 = FUN_0040f882(param_1,2,(void *)0x0,0,(undefined *)0x0,0,&local_8);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to send message to per-machine process.");
    local_8 = DVar1;
  }
  return local_8;
}



/* Function: FUN_004161ac */

DWORD FUN_004161ac(HANDLE param_1)

{
  DWORD DVar1;
  DWORD local_8;
  
  local_8 = 0;
  DVar1 = FUN_0040f882(param_1,9,(void *)0x0,0,(undefined *)0x0,0,&local_8);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,
                 "Failed to send BURN_ELEVATION_MESSAGE_TYPE_CACHE_CLEANUP message to per-machine process."
                );
    local_8 = DVar1;
  }
  return local_8;
}



/* Function: FUN_004161e7 */

DWORD FUN_004161e7(HANDLE param_1,undefined4 *param_2,undefined4 *param_3,undefined4 *param_4,
                  LPCWSTR param_5,LPCWSTR param_6,undefined4 param_7)

{
  DWORD DVar1;
  LPCWSTR pWVar2;
  DWORD DVar3;
  char *pcVar4;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  if (param_2 == (undefined4 *)0x0) {
    pWVar2 = (LPCWSTR)0x0;
  }
  else {
    pWVar2 = (LPCWSTR)*param_2;
  }
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,pWVar2);
  if ((int)DVar1 < 0) {
    pcVar4 = "Failed to write container id to message buffer.";
  }
  else {
    if (param_3 == (undefined4 *)0x0) {
      pWVar2 = (LPCWSTR)0x0;
    }
    else {
      pWVar2 = (LPCWSTR)*param_3;
    }
    DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,pWVar2);
    if ((int)DVar1 < 0) {
      pcVar4 = "Failed to write package id to message buffer.";
    }
    else {
      if (param_4 == (undefined4 *)0x0) {
        pWVar2 = (LPCWSTR)0x0;
      }
      else {
        pWVar2 = (LPCWSTR)*param_4;
      }
      DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,pWVar2);
      if ((int)DVar1 < 0) {
        pcVar4 = "Failed to write payload id to message buffer.";
      }
      else {
        DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,param_5);
        if ((int)DVar1 < 0) {
          pcVar4 = "Failed to write layout directory to message buffer.";
        }
        else {
          DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,param_6);
          if ((int)DVar1 < 0) {
            pcVar4 = "Failed to write unverified path to message buffer.";
          }
          else {
            DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_7);
            if ((int)DVar1 < 0) {
              pcVar4 = "Failed to write move flag to message buffer.";
            }
            else {
              DVar1 = FUN_0040f882(param_1,8,local_8,local_c,(undefined *)0x0,0,&local_10);
              DVar3 = local_10;
              if (-1 < (int)DVar1) goto LAB_004162fd;
              pcVar4 = 
              "Failed to send BURN_ELEVATION_MESSAGE_TYPE_CACHE_OR_LAYOUT_CONTAINER_OR_PAYLOAD message to per-machine process."
              ;
            }
          }
        }
      }
    }
  }
  FUN_00430a57(DVar1,pcVar4);
  DVar3 = DVar1;
LAB_004162fd:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar3;
}



/* Function: FUN_00416312 */

DWORD FUN_00416312(HANDLE param_1,HANDLE param_2,undefined4 param_3,undefined4 param_4,
                  undefined4 param_5,undefined4 param_6,undefined4 param_7,undefined4 param_8,
                  undefined4 param_9,undefined4 param_10,undefined4 param_11,undefined4 *param_12,
                  undefined4 *param_13)

{
  HANDLE hObject;
  DWORD DVar1;
  int iVar2;
  uint uVar3;
  HANDLE *ppvVar4;
  HANDLE local_5c [4];
  undefined4 local_4c;
  undefined4 local_48;
  undefined4 local_44;
  undefined4 local_40;
  undefined4 local_3c;
  undefined4 local_38;
  HANDLE local_34 [4];
  undefined4 local_24;
  undefined4 local_20;
  undefined4 local_1c;
  undefined4 local_18;
  undefined4 local_14;
  undefined4 local_10;
  undefined4 local_c;
  undefined4 local_8;
  
  local_c = 0;
  local_8 = 0;
  ppvVar4 = local_5c;
  for (iVar2 = 10; iVar2 != 0; iVar2 = iVar2 + -1) {
    *ppvVar4 = (HANDLE)0x0;
    ppvVar4 = ppvVar4 + 1;
  }
  ppvVar4 = local_34;
  for (iVar2 = 10; iVar2 != 0; iVar2 = iVar2 + -1) {
    *ppvVar4 = (HANDLE)0x0;
    ppvVar4 = ppvVar4 + 1;
  }
  local_5c[1] = (HANDLE)param_3;
  local_4c = param_4;
  local_48 = param_5;
  local_34[2] = (HANDLE)param_10;
  local_34[3] = (HANDLE)param_11;
  local_38 = param_9;
  local_24 = param_4;
  local_10 = param_9;
  local_20 = param_5;
  local_5c[0] = param_1;
  local_34[0] = param_1;
  local_44 = param_6;
  local_40 = param_7;
  local_3c = param_8;
  local_34[1] = param_2;
  local_1c = param_6;
  local_18 = param_7;
  local_14 = param_8;
  hObject = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,FUN_0041438b,local_5c,0,(LPDWORD)0x0);
  if (hObject == (HANDLE)0x0) {
    DVar1 = GetLastError();
    uVar3 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar3 = DVar1;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar3,"Failed to create elevated cache thread.");
  }
  else {
    uVar3 = FUN_0040f6a6(param_2,FUN_0041596e,local_34,&local_c);
    if ((int)uVar3 < 0) {
      FUN_00430a57(uVar3,"Failed to pump messages in child process.");
    }
    else {
      FUN_00416002(hObject);
      *param_12 = local_c;
      *param_13 = local_8;
    }
    CloseHandle(hObject);
  }
  return uVar3;
}



/* Function: FUN_00416439 */

int FUN_00416439(void)

{
  int iVar1;
  
  iVar1 = FUN_00436547();
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to resume automatic updates after pausing them, continuing...");
  }
  return iVar1;
}



/* Function: FUN_00416456 */

DWORD FUN_00416456(HANDLE param_1,undefined4 *param_2)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)*param_2);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write clean package id to message buffer.";
  }
  else {
    DVar1 = FUN_0040f882(param_1,0x12,local_8,local_c,(undefined *)0x0,0,&local_10);
    DVar2 = local_10;
    if (-1 < (int)DVar1) goto LAB_004164b6;
    pcVar3 = 
    "Failed to send BURN_ELEVATION_MESSAGE_TYPE_CLEAN_PACKAGE message to per-machine process.";
  }
  FUN_00430a57(DVar1,pcVar3);
  DVar2 = DVar1;
LAB_004164b6:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_004164cb */

DWORD FUN_004164cb(int param_1,undefined4 param_2)

{
  undefined4 *puVar1;
  int iVar2;
  DWORD DVar3;
  char *pcVar4;
  HANDLE local_8;
  
  local_8 = (HANDLE)0xffffffff;
  iVar2 = (**(code **)(**(int **)(param_1 + 200) + 100))(*(int **)(param_1 + 200));
  DVar3 = FUN_00408843(param_1 + 0xb8,1,iVar2);
  if ((int)DVar3 < 0) {
    FUN_004300d9();
    FUN_00430a57(DVar3,"UX aborted elevation requirement.");
  }
  else {
    puVar1 = (undefined4 *)(param_1 + 0x46c);
    DVar3 = FUN_0040f1d5(puVar1,(undefined4 *)(param_1 + 0x470));
    if ((int)DVar3 < 0) {
      pcVar4 = "Failed to create pipe name and client token.";
    }
    else {
      DVar3 = FUN_0040f31a((int)puVar1,1,&local_8);
      if ((int)DVar3 < 0) {
        pcVar4 = "Failed to create pipe and cache pipe.";
      }
      else {
        do {
          DVar3 = FUN_0040f502(*(undefined4 *)(param_1 + 0x468),(int)puVar1,1,param_2);
          if (-1 < (int)DVar3) {
            DVar3 = FUN_0040f9dc((DWORD)puVar1);
            if (-1 < (int)DVar3) goto LAB_004165c3;
            pcVar4 = "Failed to connect to elevated child process.";
            goto LAB_004165ba;
          }
          if ((DVar3 != 0x800704c7) && (DVar3 != 0x80070005)) {
            if (-1 < (int)DVar3) goto LAB_004165c3;
            break;
          }
          DVar3 = 0x80070642;
          iVar2 = FUN_004089f8(*(int **)(param_1 + 200),0,0,(LPVOID)0x80070642,(LPVOID)0x0,0x15,0);
        } while (iVar2 == 4);
        pcVar4 = "Failed to elevate.";
      }
    }
LAB_004165ba:
    FUN_00430a57(DVar3,pcVar4);
  }
LAB_004165c3:
  if (local_8 != (HANDLE)0x0) {
    CloseHandle(local_8);
    local_8 = (HANDLE)0x0;
  }
  if ((int)DVar3 < 0) {
    FUN_0040f16a((int *)(param_1 + 0x46c));
  }
  return DVar3;
}



/* Function: FUN_004165ee */

DWORD FUN_004165ee(HANDLE param_1,int param_2,LPCRITICAL_SECTION param_3,undefined4 param_4,
                  undefined4 param_5,undefined4 param_6,undefined4 *param_7)

{
  DWORD DVar1;
  char *pcVar2;
  undefined4 local_18;
  undefined4 local_14;
  int local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_18 = 0;
  local_14 = 0;
  local_10 = 0;
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)**(undefined4 **)(param_2 + 8));
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to write package id to message buffer.";
  }
  else {
    DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(param_2 + 0x10));
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to write action to message buffer.";
    }
    else {
      DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_4);
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to write rollback.";
      }
      else {
        DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,*(LPCWSTR *)(param_2 + 0x14));
        if ((int)DVar1 < 0) {
          pcVar2 = "Failed to write the list of dependencies to ignore to the message buffer.";
        }
        else {
          DVar1 = FUN_00404496(param_3,0,(int *)&local_8,(int *)&local_c);
          if ((int)DVar1 < 0) {
            pcVar2 = "Failed to write variables.";
          }
          else {
            local_18 = param_5;
            local_14 = param_6;
            DVar1 = FUN_0040f882(param_1,0xb,local_8,local_c,FUN_00415b8e,&local_18,&local_10);
            if (-1 < (int)DVar1) {
              DVar1 = FUN_00415fd4(local_10,param_7);
              goto LAB_004166f0;
            }
            pcVar2 = 
            "Failed to send BURN_ELEVATION_MESSAGE_TYPE_EXECUTE_EXE_PACKAGE message to per-machine process."
            ;
          }
        }
      }
    }
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_004166f0:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar1;
}



/* Function: FUN_00416706 */

DWORD FUN_00416706(HANDLE param_1,undefined4 param_2,int param_3,LPCRITICAL_SECTION param_4,
                  undefined4 param_5,undefined4 param_6,undefined4 param_7,undefined4 *param_8)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  undefined4 local_18;
  undefined4 local_14;
  int local_10;
  rsize_t local_c;
  void *local_8;
  
  uVar2 = 0;
  local_8 = (void *)0x0;
  local_c = 0;
  local_18 = 0;
  local_14 = 0;
  local_10 = 0;
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)**(undefined4 **)(param_3 + 8));
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write package id to message buffer.";
  }
  else {
    DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_2);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to write parent hwnd to message buffer.";
    }
    else {
      DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,*(LPCWSTR *)(param_3 + 0xc));
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to write package log to message buffer.";
      }
      else {
        DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(param_3 + 0x14));
        if ((int)DVar1 < 0) {
          pcVar3 = "Failed to write UI level to message buffer.";
        }
        else {
          DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(param_3 + 0x18));
          if ((int)DVar1 < 0) {
            pcVar3 = "Failed to write action to message buffer.";
          }
          else {
            if (*(int *)(*(int *)(param_3 + 8) + 0xb8) != 0) {
              do {
                DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,
                                     *(undefined4 *)(*(int *)(param_3 + 0x1c) + uVar2 * 4));
                if ((int)DVar1 < 0) {
                  pcVar3 = "Failed to write feature action to message buffer.";
                  goto LAB_004168a5;
                }
                uVar2 = uVar2 + 1;
              } while (uVar2 < *(uint *)(*(int *)(param_3 + 8) + 0xb8));
            }
            uVar2 = 0;
            if (*(int *)(*(int *)(param_3 + 8) + 0xcc) != 0) {
              do {
                DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,
                                     *(undefined4 *)(*(int *)(param_3 + 0x20) + uVar2 * 4));
                if ((int)DVar1 < 0) {
                  pcVar3 = "Failed to write slipstream patch action to message buffer.";
                  goto LAB_004168a5;
                }
                uVar2 = uVar2 + 1;
              } while (uVar2 < *(uint *)(*(int *)(param_3 + 8) + 0xcc));
            }
            DVar1 = FUN_00404496(param_4,0,(int *)&local_8,(int *)&local_c);
            if ((int)DVar1 < 0) {
              pcVar3 = "Failed to write variables.";
            }
            else {
              DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_5);
              if ((int)DVar1 < 0) {
                pcVar3 = "Failed to write rollback flag to message buffer.";
              }
              else {
                local_18 = param_6;
                local_14 = param_7;
                DVar1 = FUN_0040f882(param_1,0xc,local_8,local_c,FUN_00415d91,&local_18,&local_10);
                if (-1 < (int)DVar1) {
                  DVar1 = FUN_00415fd4(local_10,param_8);
                  goto LAB_004168bc;
                }
                pcVar3 = 
                "Failed to send BURN_ELEVATION_MESSAGE_TYPE_EXECUTE_MSI_PACKAGE message to per-machine process."
                ;
              }
            }
          }
        }
      }
    }
  }
LAB_004168a5:
  FUN_00430a57(DVar1,pcVar3);
LAB_004168bc:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar1;
}



/* Function: FUN_004168d3 */

DWORD FUN_004168d3(HANDLE param_1,undefined4 param_2,int param_3,LPCRITICAL_SECTION param_4,
                  undefined4 param_5,undefined4 param_6,undefined4 param_7,undefined4 *param_8)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  undefined4 local_18;
  undefined4 local_14;
  int local_10;
  rsize_t local_c;
  void *local_8;
  
  uVar2 = 0;
  local_8 = (void *)0x0;
  local_c = 0;
  local_18 = 0;
  local_14 = 0;
  local_10 = 0;
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)**(undefined4 **)(param_3 + 8));
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write package id to message buffer.";
  }
  else {
    DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_2);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to write parent hwnd to message buffer.";
    }
    else {
      DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,*(LPCWSTR *)(param_3 + 0xc));
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to write target product code to message buffer.";
      }
      else {
        DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,*(LPCWSTR *)(param_3 + 0x1c));
        if ((int)DVar1 < 0) {
          pcVar3 = "Failed to write package log to message buffer.";
        }
        else {
          DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(param_3 + 0x20));
          if ((int)DVar1 < 0) {
            pcVar3 = "Failed to write UI level to message buffer.";
          }
          else {
            DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(param_3 + 0x24));
            if ((int)DVar1 < 0) {
              pcVar3 = "Failed to write action to message buffer.";
            }
            else {
              DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(param_3 + 0x2c));
              if ((int)DVar1 < 0) {
                pcVar3 = "Failed to write count of ordered patches to message buffer.";
              }
              else {
                if (*(int *)(param_3 + 0x2c) != 0) {
                  do {
                    DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,
                                         *(undefined4 *)(*(int *)(param_3 + 0x28) + uVar2 * 8));
                    if ((int)DVar1 < 0) {
                      pcVar3 = "Failed to write ordered patch order to message buffer.";
                      goto LAB_00416a90;
                    }
                    DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,
                                         (LPCWSTR)**(undefined4 **)
                                                    (*(int *)(param_3 + 0x28) + 4 + uVar2 * 8));
                    if ((int)DVar1 < 0) {
                      pcVar3 = "Failed to write ordered patch id to message buffer.";
                      goto LAB_00416a90;
                    }
                    uVar2 = uVar2 + 1;
                  } while (uVar2 < *(uint *)(param_3 + 0x2c));
                }
                DVar1 = FUN_00404496(param_4,0,(int *)&local_8,(int *)&local_c);
                if ((int)DVar1 < 0) {
                  pcVar3 = "Failed to write variables.";
                }
                else {
                  DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_5);
                  if ((int)DVar1 < 0) {
                    pcVar3 = "Failed to write rollback flag to message buffer.";
                  }
                  else {
                    local_18 = param_6;
                    local_14 = param_7;
                    DVar1 = FUN_0040f882(param_1,0xd,local_8,local_c,FUN_00415d91,&local_18,
                                         &local_10);
                    if (-1 < (int)DVar1) {
                      DVar1 = FUN_00415fd4(local_10,param_8);
                      goto LAB_00416aa7;
                    }
                    pcVar3 = 
                    "Failed to send BURN_ELEVATION_MESSAGE_TYPE_EXECUTE_MSP_PACKAGE message to per-machine process."
                    ;
                  }
                }
              }
            }
          }
        }
      }
    }
  }
LAB_00416a90:
  FUN_00430a57(DVar1,pcVar3);
LAB_00416aa7:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar1;
}



/* Function: FUN_00416abe */

DWORD FUN_00416abe(HANDLE param_1,int param_2,undefined4 param_3,undefined4 param_4,
                  undefined4 param_5,undefined4 *param_6)

{
  DWORD DVar1;
  char *pcVar2;
  undefined4 local_18;
  undefined4 local_14;
  int local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_18 = 0;
  local_14 = 0;
  local_10 = 0;
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)**(undefined4 **)(param_2 + 8));
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to write package id to message buffer.";
  }
  else {
    DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,*(LPCWSTR *)(param_2 + 0xc));
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to write package log to message buffer.";
    }
    else {
      DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(param_2 + 0x10));
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to write action to message buffer.";
      }
      else {
        DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_3);
        if ((int)DVar1 < 0) {
          pcVar2 = "Failed to write rollback.";
        }
        else {
          local_18 = param_4;
          local_14 = param_5;
          DVar1 = FUN_0040f882(param_1,0xe,local_8,local_c,FUN_00415b8e,&local_18,&local_10);
          if (-1 < (int)DVar1) {
            DVar1 = FUN_00415fd4(local_10,param_6);
            goto LAB_00416b9e;
          }
          pcVar2 = 
          "Failed to send BURN_ELEVATION_MESSAGE_TYPE_EXECUTE_MSU_PACKAGE message to per-machine process."
          ;
        }
      }
    }
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_00416b9e:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar1;
}



/* Function: FUN_00416bb4 */

DWORD FUN_00416bb4(HANDLE param_1,int param_2)

{
  int iVar1;
  DWORD DVar2;
  char *pcVar3;
  int local_10;
  rsize_t local_c;
  void *local_8;
  
  iVar1 = param_2;
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)**(undefined4 **)(param_2 + 8));
  if ((int)DVar2 < 0) {
    pcVar3 = "Failed to write package id to message buffer.";
  }
  else {
    DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,*(LPCWSTR *)(iVar1 + 0xc));
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to write bundle dependency key to message buffer.";
    }
    else {
      DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(iVar1 + 0x10));
      if ((int)DVar2 < 0) {
        pcVar3 = "Failed to write action to message buffer.";
      }
      else {
        DVar2 = FUN_0040f882(param_1,0x10,local_8,local_c,(undefined *)0x0,0,&local_10);
        if (-1 < (int)DVar2) {
          DVar2 = FUN_00415fd4(local_10,&param_2);
          goto LAB_00416c5d;
        }
        pcVar3 = 
        "Failed to send BURN_ELEVATION_MESSAGE_TYPE_EXECUTE_PACKAGE_DEPENDENCY message to per-machine process."
        ;
      }
    }
  }
  FUN_00430a57(DVar2,pcVar3);
LAB_00416c5d:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_00416c73 */

DWORD FUN_00416c73(HANDLE param_1,int param_2)

{
  int iVar1;
  DWORD DVar2;
  char *pcVar3;
  int local_10;
  rsize_t local_c;
  void *local_8;
  
  iVar1 = param_2;
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)**(undefined4 **)(param_2 + 8));
  if ((int)DVar2 < 0) {
    pcVar3 = "Failed to write package id to message buffer.";
  }
  else {
    DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,*(undefined4 *)(iVar1 + 0xc));
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to write action to message buffer.";
    }
    else {
      DVar2 = FUN_0040f882(param_1,0xf,local_8,local_c,(undefined *)0x0,0,&local_10);
      if (-1 < (int)DVar2) {
        DVar2 = FUN_00415fd4(local_10,&param_2);
        goto LAB_00416cff;
      }
      pcVar3 = 
      "Failed to send BURN_ELEVATION_MESSAGE_TYPE_EXECUTE_PACKAGE_PROVIDER message to per-machine process."
      ;
    }
  }
  FUN_00430a57(DVar2,pcVar3);
LAB_00416cff:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_00416d15 */

DWORD FUN_00416d15(HANDLE param_1,LPCWSTR param_2,LPCWSTR param_3)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,param_2);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write layout directory to message buffer.";
  }
  else {
    DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,param_3);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to write payload unverified path to message buffer.";
    }
    else {
      DVar1 = FUN_0040f882(param_1,7,local_8,local_c,(undefined *)0x0,0,&local_10);
      DVar2 = local_10;
      if (-1 < (int)DVar1) goto LAB_00416d90;
      pcVar3 = 
      "Failed to send BURN_ELEVATION_MESSAGE_TYPE_LAYOUT_BUNDLE message to per-machine process.";
    }
  }
  FUN_00430a57(DVar1,pcVar3);
  DVar2 = DVar1;
LAB_00416d90:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_00416da5 */

DWORD FUN_00416da5(HANDLE param_1,undefined4 *param_2)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,*param_2);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write action type to message buffer.";
  }
  else {
    DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)param_2[1]);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to write bundle id to message buffer.";
    }
    else {
      DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,(LPCWSTR)param_2[2]);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to write dependent provider key to message buffer.";
      }
      else {
        DVar1 = FUN_0040f882(param_1,10,local_8,local_c,(undefined *)0x0,0,&local_10);
        DVar2 = local_10;
        if (-1 < (int)DVar1) goto LAB_00416e40;
        pcVar3 = 
        "Failed to send BURN_ELEVATION_MESSAGE_TYPE_PROCESS_DEPENDENT_REGISTRATION message to per-machine process."
        ;
      }
    }
  }
  FUN_00430a57(DVar1,pcVar3);
  DVar2 = DVar1;
LAB_00416e40:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_00416e56 */

DWORD FUN_00416e56(HANDLE param_1,void *param_2,rsize_t param_3)

{
  DWORD DVar1;
  DWORD local_8;
  
  local_8 = 0;
  DVar1 = FUN_0040f882(param_1,6,param_2,param_3,(undefined *)0x0,0,&local_8);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to send message to per-machine process.");
    local_8 = DVar1;
  }
  return local_8;
}



/* Function: FUN_00416e95 */

DWORD FUN_00416e95(HANDLE param_1,LPCWSTR param_2,LPCWSTR param_3,LPCRITICAL_SECTION param_4,
                  undefined4 param_5,undefined4 param_6,undefined4 param_7,undefined4 param_8)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,param_2);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write engine working path to message buffer.";
  }
  else {
    DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,param_3);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to write resume command line to message buffer.";
    }
    else {
      DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_5);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to write registration operations to message buffer.";
      }
      else {
        DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_6);
        if ((int)DVar1 < 0) {
          pcVar3 = "Failed to write dependency registration action to message buffer.";
        }
        else {
          DVar1 = FUN_00430526((int *)&local_8,(int *)&local_c,param_7,param_8);
          if ((int)DVar1 < 0) {
            pcVar3 = "Failed to write estimated size to message buffer.";
          }
          else {
            DVar1 = FUN_00404496(param_4,0,(int *)&local_8,(int *)&local_c);
            if ((int)DVar1 < 0) {
              pcVar3 = "Failed to write variables.";
            }
            else {
              DVar1 = FUN_0040f882(param_1,3,local_8,local_c,(undefined *)0x0,0,&local_10);
              DVar2 = local_10;
              if (-1 < (int)DVar1) goto LAB_00416f8e;
              pcVar3 = "Failed to send message to per-machine process.";
            }
          }
        }
      }
    }
  }
  FUN_00430a57(DVar1,pcVar3);
  DVar2 = DVar1;
LAB_00416f8e:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_00416fa3 */

DWORD FUN_00416fa3(HANDLE param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_2);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write resume mode to message buffer.";
  }
  else {
    DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_3);
    if ((int)DVar1 < 0) {
      pcVar3 = "Failed to write restart enum to message buffer.";
    }
    else {
      DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_4);
      if ((int)DVar1 < 0) {
        pcVar3 = "Failed to write dependency registration action to message buffer.";
      }
      else {
        DVar1 = FUN_0040f882(param_1,5,local_8,local_c,(undefined *)0x0,0,&local_10);
        DVar2 = local_10;
        if (-1 < (int)DVar1) goto LAB_0041703b;
        pcVar3 = "Failed to send message to per-machine process.";
      }
    }
  }
  FUN_00430a57(DVar1,pcVar3);
  DVar2 = DVar1;
LAB_0041703b:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_00417050 */

DWORD FUN_00417050(HANDLE param_1,LPCWSTR param_2)

{
  DWORD DVar1;
  DWORD DVar2;
  char *pcVar3;
  DWORD local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  DVar1 = FUN_00430589((int *)&local_8,(int *)&local_c,param_2);
  if ((int)DVar1 < 0) {
    pcVar3 = "Failed to write resume command line to message buffer.";
  }
  else {
    DVar1 = FUN_0040f882(param_1,4,local_8,local_c,(undefined *)0x0,0,&local_10);
    DVar2 = local_10;
    if (-1 < (int)DVar1) goto LAB_004170ae;
    pcVar3 = "Failed to send message to per-machine process.";
  }
  FUN_00430a57(DVar1,pcVar3);
  DVar2 = DVar1;
LAB_004170ae:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_004170c3 */

void FUN_004170c3(HINSTANCE param_1,undefined4 *param_2)

{
  POINT pt;
  HBITMAP h;
  DWORD DVar1;
  BOOL BVar2;
  HMONITOR hMonitor;
  int iVar3;
  uint uVar4;
  undefined4 *puVar5;
  tagMONITORINFO *ptVar6;
  undefined4 local_50 [6];
  tagPOINT local_38;
  tagMONITORINFO local_30;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  puVar5 = local_50;
  for (iVar3 = 6; iVar3 != 0; iVar3 = iVar3 + -1) {
    *puVar5 = 0;
    puVar5 = puVar5 + 1;
  }
  local_38.x = 0;
  local_38.y = 0;
  ptVar6 = &local_30;
  for (iVar3 = 10; iVar3 != 0; iVar3 = iVar3 + -1) {
    ptVar6->cbSize = 0;
    ptVar6 = (tagMONITORINFO *)&ptVar6->rcMonitor;
  }
  h = LoadBitmapW(param_1,(LPCWSTR)0x1);
  *param_2 = h;
  if (h == (HBITMAP)0x0) {
    DVar1 = GetLastError();
    uVar4 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar4 = DVar1;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar4,"Failed to load splash screen bitmap.");
  }
  else {
    GetObjectW(h,0x18,local_50);
    param_2[1] = 0x80000000;
    param_2[2] = 0x80000000;
    param_2[3] = local_50[1];
    param_2[4] = local_50[2];
    BVar2 = GetCursorPos(&local_38);
    if (BVar2 != 0) {
      pt.y = local_38.y;
      pt.x = local_38.x;
      hMonitor = MonitorFromPoint(pt,2);
      if (hMonitor != (HMONITOR)0x0) {
        local_30.cbSize = 0x28;
        BVar2 = GetMonitorInfoW(hMonitor,&local_30);
        if (BVar2 != 0) {
          param_2[1] = ((local_30.rcWork.right - param_2[3]) - local_30.rcWork.left) / 2 +
                       local_30.rcWork.left;
          param_2[2] = ((local_30.rcWork.bottom - param_2[4]) - local_30.rcWork.top) / 2 +
                       local_30.rcWork.top;
        }
      }
    }
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004171da */

DWORD FUN_004171da(undefined4 *param_1)

{
  ATOM AVar1;
  uint uVar2;
  DWORD DVar3;
  HWND hDlg;
  BOOL BVar4;
  int iVar5;
  WNDCLASSW *pWVar6;
  tagMSG *ptVar7;
  char *pcVar8;
  WNDCLASSW local_5c;
  tagMSG local_34;
  HGDIOBJ local_18;
  int local_14;
  int local_10;
  int local_c;
  int local_8;
  
  local_18 = (HGDIOBJ)0x0;
  local_14 = 0;
  local_10 = 0;
  local_c = 0;
  local_8 = 0;
  pWVar6 = &local_5c;
  for (iVar5 = 10; iVar5 != 0; iVar5 = iVar5 + -1) {
    pWVar6->style = 0;
    pWVar6 = (WNDCLASSW *)&pWVar6->lpfnWndProc;
  }
  ptVar7 = &local_34;
  for (iVar5 = 7; iVar5 != 0; iVar5 = iVar5 + -1) {
    ptVar7->hwnd = (HWND)0x0;
    ptVar7 = (tagMSG *)&ptVar7->message;
  }
  uVar2 = FUN_004170c3((HINSTANCE)param_1[1],&local_18);
  if ((int)uVar2 < 0) {
    FUN_00430a57(uVar2,"Failed to load splash screen.");
  }
  else {
    local_5c.hInstance = (HINSTANCE)param_1[1];
    local_5c.lpfnWndProc = FUN_0041737c;
    local_5c.hCursor = LoadCursorW((HINSTANCE)0x0,(LPCWSTR)0x7f00);
    local_5c.lpszClassName = L"WixBurnSplashScreen";
    AVar1 = RegisterClassW(&local_5c);
    if (AVar1 == 0) {
      DVar3 = GetLastError();
      uVar2 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar2 = DVar3;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
      pcVar8 = "Failed to register window.";
    }
    else {
      hDlg = CreateWindowExW(0x80,local_5c.lpszClassName,(LPCWSTR)param_1[2],0x90000000,local_14,
                             local_10,local_c,local_8,(HWND)0x0,(HMENU)0x0,(HINSTANCE)param_1[1],
                             &local_18);
      if (hDlg != (HWND)0x0) {
        *(HWND *)param_1[3] = hDlg;
        SetEvent((HANDLE)*param_1);
        while (BVar4 = GetMessageW(&local_34,(HWND)0x0,0,0), BVar4 != 0) {
          if (BVar4 == -1) {
            uVar2 = 0x8000ffff;
            pcVar8 = "Unexpected return value from message pump.";
            goto LAB_0041734e;
          }
          BVar4 = IsDialogMessageW(hDlg,&local_34);
          if (BVar4 == 0) {
            TranslateMessage(&local_34);
            DispatchMessageW(&local_34);
          }
        }
        goto LAB_00417357;
      }
      DVar3 = GetLastError();
      uVar2 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar2 = DVar3;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
      pcVar8 = "Failed to create window.";
    }
LAB_0041734e:
    FUN_00430a57(uVar2,pcVar8);
  }
LAB_00417357:
  UnregisterClassW(L"WixBurnSplashScreen",(HINSTANCE)param_1[1]);
  if (local_18 != (HGDIOBJ)0x0) {
    DeleteObject(local_18);
  }
  return uVar2;
}



/* Function: FUN_0041737c */

LRESULT FUN_0041737c(HWND param_1,UINT param_2,HDC param_3,LONG *param_4)

{
  undefined4 *puVar1;
  LRESULT LVar2;
  HDC hdc;
  HGDIOBJ h;
  
  puVar1 = (undefined4 *)GetWindowLongW(param_1,-0x15);
  if (param_2 == 2) {
    PostQuitMessage(0);
    LVar2 = 0;
  }
  else if (param_2 == 0x14) {
    hdc = CreateCompatibleDC(param_3);
    h = SelectObject(hdc,(HGDIOBJ)*puVar1);
    StretchBlt(param_3,0,0,puVar1[3],puVar1[4],hdc,0,0,puVar1[3],puVar1[4],0xcc0020);
    SelectObject(hdc,h);
    DeleteDC(hdc);
    LVar2 = 1;
  }
  else {
    if (param_2 == 0x81) {
      SetWindowLongW(param_1,-0x15,*param_4);
    }
    else {
      if (param_2 == 0x82) {
        LVar2 = DefWindowProcW(param_1,0x82,(WPARAM)param_3,(LPARAM)param_4);
        SetWindowLongW(param_1,-0x15,0);
        return LVar2;
      }
      if (param_2 == 0x84) {
        return 2;
      }
    }
    LVar2 = DefWindowProcW(param_1,param_2,(WPARAM)param_3,(LPARAM)param_4);
  }
  return LVar2;
}



/* Function: FUN_00417453 */

void FUN_00417453(undefined4 param_1,undefined4 param_2,undefined4 param_3)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  HANDLE local_20;
  undefined4 local_1c;
  undefined4 local_18;
  undefined4 local_14;
  HANDLE local_10;
  HANDLE local_c;
  DWORD local_8;
  
  local_20 = (HANDLE)0x0;
  local_1c = 0;
  local_18 = 0;
  local_14 = 0;
  local_10 = (HANDLE)0x0;
  local_c = (HANDLE)0x0;
  local_8 = 0;
  local_10 = CreateEventW((LPSECURITY_ATTRIBUTES)0x0,1,0,(LPCWSTR)0x0);
  if (local_10 == (HANDLE)0x0) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to create modal event.";
  }
  else {
    local_1c = param_1;
    local_18 = param_2;
    local_14 = param_3;
    local_20 = local_10;
    local_c = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,FUN_004171da,&local_20,0,&local_8);
    if (local_c != (HANDLE)0x0) {
      WaitForMultipleObjects(2,&local_10,0,0xffffffff);
      goto LAB_0041752e;
    }
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to create UI thread.";
  }
  FUN_00430a57(uVar2,pcVar3);
LAB_0041752e:
  if (local_c != (HANDLE)0x0) {
    CloseHandle(local_c);
    local_c = (HANDLE)0x0;
  }
  if (local_10 != (HANDLE)0x0) {
    CloseHandle(local_10);
  }
  return;
}



/* Function: FUN_00417551 */

DWORD FUN_00417551(int param_1,LPCWSTR param_2,DWORD param_3)

{
  DWORD DVar1;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  DVar1 = FUN_00433da8((int *)&local_8,param_3,(LPCVOID)0x0);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to allocate string to display error message");
  }
  else if (((param_1 == 2) || (param_1 == 3)) || (param_1 == 1)) {
    DVar1 = 0;
  }
  else {
    MessageBoxW((HWND)0x0,local_8,param_2,0x1010);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_004175be */

DWORD FUN_004175be(undefined4 *param_1)

{
  ATOM AVar1;
  uint uVar2;
  BOOL BVar3;
  DWORD DVar4;
  HWND pHVar5;
  int iVar6;
  uint uVar7;
  WNDCLASSW *pWVar8;
  tagMSG *ptVar9;
  char *pcVar10;
  WNDCLASSW local_50;
  tagMSG local_28;
  uint local_c;
  int local_8;
  
  pWVar8 = &local_50;
  for (iVar6 = 10; iVar6 != 0; iVar6 = iVar6 + -1) {
    pWVar8->style = 0;
    pWVar8 = (WNDCLASSW *)&pWVar8->lpfnWndProc;
  }
  uVar7 = 0;
  ptVar9 = &local_28;
  for (iVar6 = 7; iVar6 != 0; iVar6 = iVar6 + -1) {
    ptVar9->hwnd = (HWND)0x0;
    ptVar9 = (tagMSG *)&ptVar9->message;
  }
  iVar6 = param_1[2];
  local_c = 0;
  local_8 = 0;
  uVar2 = (uint)(*(int *)(iVar6 + 0x458) == 1);
  if ((uVar2 == 0) ||
     (BVar3 = TlsSetValue(*(DWORD *)(iVar6 + 0x464),*(LPVOID *)(iVar6 + 0x47c)), BVar3 != 0)) {
    local_50.hInstance = (HINSTANCE)param_1[1];
    local_50.lpfnWndProc = FUN_00417759;
    local_50.lpszClassName = L"WixBurnMessageWindow";
    AVar1 = RegisterClassW(&local_50);
    if (AVar1 == 0) {
      DVar4 = GetLastError();
      uVar7 = DVar4 & 0xffff | 0x80070000;
      if ((int)DVar4 < 1) {
        uVar7 = DVar4;
      }
      if (-1 < (int)uVar7) {
        uVar7 = 0x80004005;
      }
      FUN_004300d9();
      pcVar10 = "Failed to register window.";
    }
    else {
      local_8 = iVar6 + 0xb8;
      local_c = uVar2;
      pHVar5 = CreateWindowExW(0x80,local_50.lpszClassName,(LPCWSTR)0x0,0x90000000,-0x80000000,8,0,0
                               ,(HWND)0x0,(HMENU)0x0,(HINSTANCE)param_1[1],&local_c);
      if (pHVar5 != (HWND)0x0) {
        *(HWND *)(iVar6 + 0x3a8) = pHVar5;
        SetEvent((HANDLE)*param_1);
        while (BVar3 = GetMessageW(&local_28,(HWND)0x0,0,0), BVar3 != 0) {
          if (BVar3 == -1) {
            uVar7 = 0x8000ffff;
            pcVar10 = "Unexpected return value from message pump.";
            goto LAB_0041773a;
          }
          BVar3 = IsDialogMessageW(local_28.hwnd,&local_28);
          if (BVar3 == 0) {
            TranslateMessage(&local_28);
            DispatchMessageW(&local_28);
          }
        }
        goto LAB_00417742;
      }
      DVar4 = GetLastError();
      uVar7 = DVar4 & 0xffff | 0x80070000;
      if ((int)DVar4 < 1) {
        uVar7 = DVar4;
      }
      if (-1 < (int)uVar7) {
        uVar7 = 0x80004005;
      }
      FUN_004300d9();
      pcVar10 = "Failed to create window.";
    }
LAB_0041773a:
    FUN_00430a57(uVar7,pcVar10);
  }
  else {
    uVar7 = 0x8007139f;
  }
LAB_00417742:
  UnregisterClassW(L"WixBurnMessageWindow",(HINSTANCE)param_1[1]);
  return uVar7;
}



/* Function: FUN_00417759 */

uint FUN_00417759(HWND param_1,UINT param_2,WPARAM param_3,LONG *param_4)

{
  uint uVar1;
  int *piVar2;
  int iVar3;
  undefined4 uVar4;
  
  if (param_2 == 2) {
    PostQuitMessage(0);
    uVar1 = 0;
  }
  else if (param_2 == 0x11) {
    uVar1 = 0;
    piVar2 = (int *)GetWindowLongW(param_1,-0x15);
    if (*piVar2 == 0) {
      uVar4 = 2;
      if (((uint)param_4 & 0x40000000) != 0) {
        uVar4 = 0;
      }
      iVar3 = (**(code **)(**(int **)(piVar2[1] + 0x10) + 0x14))
                        (*(int **)(piVar2[1] + 0x10),param_4,uVar4);
      uVar1 = (uint)(iVar3 != 2);
    }
    FUN_0040e33b(uVar1);
    FUN_0040e33b(*piVar2);
    FUN_0040e33b((uint)param_4 & 0x40000000);
    FUN_00402003(2,0x20000190);
  }
  else {
    if (param_2 == 0x81) {
      SetWindowLongW(param_1,-0x15,*param_4);
    }
    else if (param_2 == 0x82) {
      uVar1 = DefWindowProcW(param_1,0x82,param_3,(LPARAM)param_4);
      SetWindowLongW(param_1,-0x15,0);
      return uVar1;
    }
    uVar1 = DefWindowProcW(param_1,param_2,param_3,(LPARAM)param_4);
  }
  return uVar1;
}



/* Function: FUN_0041783b */

void FUN_0041783b(int param_1)

{
  BOOL BVar1;
  
  BVar1 = IsWindow(*(HWND *)(param_1 + 0x3a8));
  if (BVar1 != 0) {
    PostMessageW(*(HWND *)(param_1 + 0x3a8),0x10,0,0);
    WaitForSingleObject(*(HANDLE *)(param_1 + 0x3ac),15000);
  }
  return;
}



/* Function: FUN_0041787a */

DWORD FUN_0041787a(undefined4 param_1,int param_2)

{
  DWORD DVar1;
  uint uVar2;
  char *pcVar3;
  HANDLE local_18;
  undefined4 local_14;
  int local_10;
  HANDLE local_c;
  HANDLE local_8;
  
  local_18 = (HANDLE)0x0;
  local_14 = 0;
  uVar2 = 0;
  local_c = (HANDLE)0x0;
  local_8 = (HANDLE)0x0;
  local_10 = 0;
  local_c = CreateEventW((LPSECURITY_ATTRIBUTES)0x0,1,0,(LPCWSTR)0x0);
  if (local_c == (HANDLE)0x0) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to create initialization event.";
  }
  else {
    local_14 = param_1;
    local_10 = param_2;
    local_18 = local_c;
    local_8 = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,FUN_004175be,&local_18,0,(LPDWORD)0x0);
    if (local_8 != (HANDLE)0x0) {
      WaitForMultipleObjects(2,&local_c,0,0xffffffff);
      *(HANDLE *)(param_2 + 0x3ac) = local_8;
      local_8 = (HANDLE)0x0;
      goto LAB_0041795c;
    }
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to create the UI thread.";
  }
  FUN_00430a57(uVar2,pcVar3);
LAB_0041795c:
  if (local_8 != (HANDLE)0x0) {
    CloseHandle(local_8);
    local_8 = (HANDLE)0x0;
  }
  if (local_c != (HANDLE)0x0) {
    CloseHandle(local_c);
  }
  return uVar2;
}



/* Function: FUN_0041797f */

undefined4 * __thiscall FUN_0041797f(void *this,undefined4 param_1,undefined4 param_2)

{
  *(undefined4 *)((int)this + 0xc) = param_1;
  *(undefined4 *)((int)this + 0x10) = param_2;
  *(undefined ***)this = CEngineForApplication::vftable;
  *(undefined ***)((int)this + 4) = CEngineForApplication::vftable;
  *(undefined4 *)((int)this + 8) = 1;
  return (undefined4 *)this;
}



/* Function: FUN_004179a8 */

void FUN_004179a8(int param_1)

{
  InterlockedIncrement((LONG *)(param_1 + 8));
  return;
}



/* Function: FUN_004179bc */

void FUN_004179bc(int param_1)

{
  FUN_004179a8(param_1 + -4);
  return;
}



/* Function: FUN_004179c6 */

DWORD FUN_004179c6(int param_1,LPARAM param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  
  uVar3 = 0;
  BVar1 = PostThreadMessageW(*(DWORD *)(param_1 + 0x10),0x9003,0,param_2);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar3,"Failed to post apply message.");
  }
  return uVar3;
}



/* Function: FUN_00417a27 */

undefined4 FUN_00417a27(int param_1)

{
  BOOL BVar1;
  
  BVar1 = IsWindow(*(HWND *)(*(int *)(param_1 + 0xc) + 0x34));
  if (BVar1 != 0) {
    PostMessageW(*(HWND *)(*(int *)(param_1 + 0xc) + 0x34),0x10,0,0);
  }
  return 0;
}



/* Function: FUN_00417a57 */

DWORD FUN_00417a57(int param_1)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  
  uVar3 = 0;
  BVar1 = PostThreadMessageW(*(DWORD *)(param_1 + 0x10),0x9000,0,0);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar3,"Failed to post detect message.");
  }
  return uVar3;
}



/* Function: FUN_00417ab6 */

undefined4 FUN_00417ab6(void)

{
  return 0x80004001;
}



/* Function: FUN_00417abe */

DWORD FUN_00417abe(int param_1,LPARAM param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  
  uVar3 = 0;
  if (*(int *)(*(int *)(param_1 + 0xc) + 0x47c) == -1) {
    BVar1 = PostThreadMessageW(*(DWORD *)(param_1 + 0x10),0x9002,0,param_2);
    if (BVar1 == 0) {
      DVar2 = GetLastError();
      uVar3 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar3 = DVar2;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar3,"Failed to post elevate message.");
    }
  }
  else {
    uVar3 = 0x800704df;
  }
  return uVar3;
}



/* Function: FUN_00417b32 */

int FUN_00417b32(undefined4 param_1,wchar_t *param_2,uint *param_3,uint *param_4)

{
  int iVar1;
  uint local_c;
  short *local_8;
  
  local_8 = (short *)0x0;
  local_c = 0;
  if (((param_2 == (wchar_t *)0x0) || (*param_2 == L'\0')) || (param_4 == (uint *)0x0)) {
    iVar1 = -0x7ff8ffa9;
  }
  else {
    iVar1 = FUN_00403999(param_2,(int *)&local_8);
    if (-1 < iVar1) {
      if (param_3 != (uint *)0x0) {
        iVar1 = FUN_00418805(param_3,*param_4,local_8,(int *)0x0,&local_c,0x200);
        if (iVar1 != -0x7ff8ff86) goto LAB_00417bab;
        iVar1 = -0x7ff8ff16;
      }
      FUN_0040e205(local_8,0x7fffffff,(int *)&local_c);
      *param_4 = local_c;
    }
  }
LAB_00417bab:
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_00417bc1 */

DWORD FUN_00417bc1(int param_1,short *param_2,uint *param_3)

{
  DWORD DVar1;
  
  if (((param_2 == (short *)0x0) || (*param_2 == 0)) || (param_3 == (uint *)0x0)) {
    DVar1 = 0x80070057;
  }
  else {
    DVar1 = FUN_00405961(*(int *)(param_1 + 0xc) + 0x88,param_2,param_3);
  }
  return DVar1;
}



/* Function: FUN_00417bf7 */

int FUN_00417bf7(int param_1,LPCWSTR param_2,uint *param_3,uint *param_4)

{
  int iVar1;
  uint local_c;
  short *local_8;
  
  local_8 = (short *)0x0;
  local_c = 0;
  if (((param_2 == (LPCWSTR)0x0) || (*param_2 == L'\0')) || (param_4 == (uint *)0x0)) {
    iVar1 = -0x7ff8ffa9;
  }
  else {
    iVar1 = FUN_00403a92((LPCRITICAL_SECTION)(*(int *)(param_1 + 0xc) + 0x88),param_2,
                         (int *)&local_8,&local_c);
    if (-1 < iVar1) {
      if (param_3 == (uint *)0x0) {
        iVar1 = -0x7ff8ff16;
        *param_4 = local_c;
      }
      else {
        iVar1 = FUN_00418805(param_3,*param_4,local_8,(int *)0x0,(uint *)0x0,0x200);
        if ((iVar1 < 0) && (*param_4 = local_c, iVar1 == -0x7ff8ff86)) {
          iVar1 = -0x7ff8ff16;
        }
      }
    }
  }
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_00417c92 */

undefined4
FUN_00417c92(undefined4 param_1,int param_2,undefined4 param_3,uint param_4,undefined4 param_5,
            undefined4 param_6,undefined4 *param_7)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = 0;
  do {
    if ((&DAT_00447bf8)[iVar1] != *(int *)(param_2 + iVar1 * 4)) {
      return 0x80004002;
    }
    iVar1 = iVar1 + 1;
  } while (iVar1 != 4);
  if ((param_4 & 3) == 0) {
    FUN_004300d9();
    pcVar2 = "Cannot marshal IBootstrapperEngine interface out of proc.";
  }
  else {
    if (param_7 != (undefined4 *)0x0) {
      *param_7 = 4;
      return 0;
    }
    FUN_004300d9();
    pcVar2 = "Invalid size output parameter is NULL.";
  }
  FUN_00430a57(0x80004005,pcVar2);
  return 0x80004005;
}



/* Function: FUN_00417d1a */

undefined4 FUN_00417d1a(int param_1,undefined4 *param_2)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_2 == (undefined4 *)0x0) {
    uVar1 = 0x80070057;
  }
  else {
    *param_2 = *(undefined4 *)(*(int *)(param_1 + 0xc) + 0x2b4);
  }
  return uVar1;
}



/* Function: FUN_00417d41 */

undefined4 FUN_00417d41(void)

{
  return 0x80004001;
}



/* Function: FUN_00417d49 */

DWORD FUN_00417d49(int param_1,PCNZWCH param_2,longlong *param_3)

{
  DWORD DVar1;
  
  if (((param_2 == (PCNZWCH)0x0) || (*param_2 == L'\0')) || (param_3 == (longlong *)0x0)) {
    DVar1 = 0x80070057;
  }
  else {
    DVar1 = FUN_00403b82((LPCRITICAL_SECTION)(*(int *)(param_1 + 0xc) + 0x88),param_2,param_3);
  }
  return DVar1;
}



/* Function: FUN_00417d7f */

DWORD FUN_00417d7f(int param_1,PCNZWCH param_2,uint *param_3,uint *param_4)

{
  DWORD DVar1;
  uint local_c;
  short *local_8;
  
  local_8 = (short *)0x0;
  local_c = 0;
  if (((param_2 == (PCNZWCH)0x0) || (*param_2 == L'\0')) || (param_4 == (uint *)0x0)) {
    DVar1 = 0x80070057;
  }
  else {
    DVar1 = FUN_00403c02((LPCRITICAL_SECTION)(*(int *)(param_1 + 0xc) + 0x88),param_2,
                         (int *)&local_8);
    if ((-1 < (int)DVar1) &&
       ((param_3 == (uint *)0x0 ||
        (DVar1 = FUN_00418805(param_3,*param_4,local_8,(int *)0x0,&local_c,0x200),
        DVar1 == 0x8007007a)))) {
      DVar1 = 0x800700ea;
      FUN_0040e205(local_8,0x7fffffff,(int *)&local_c);
      *param_4 = local_c + 1;
    }
  }
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_00417e1d */

DWORD FUN_00417e1d(int param_1,PCNZWCH param_2,uint *param_3)

{
  DWORD DVar1;
  
  if (((param_2 == (PCNZWCH)0x0) || (*param_2 == L'\0')) || (param_3 == (uint *)0x0)) {
    DVar1 = 0x80070057;
  }
  else {
    DVar1 = FUN_00403cf1((LPCRITICAL_SECTION)(*(int *)(param_1 + 0xc) + 0x88),param_2,param_3);
  }
  return DVar1;
}



/* Function: FUN_00417e53 */

int FUN_00417e53(undefined4 param_1,int param_2)

{
  int iVar1;
  
  if (param_2 == 1) {
    iVar1 = 2;
  }
  else if (param_2 == 2) {
    iVar1 = 3;
  }
  else if (param_2 == 3) {
    iVar1 = 4;
  }
  else {
    if (param_2 != 4) {
      return -0x7ff8ffa9;
    }
    iVar1 = 5;
  }
  iVar1 = FUN_00430f28(iVar1,"%ls");
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to log UX message.");
  }
  return iVar1;
}



/* Function: FUN_00417ea7 */

int FUN_00417ea7(int param_1,int *param_2,int param_3,int param_4,uint param_5)

{
  int iVar1;
  undefined4 uVar2;
  char *pcVar3;
  undefined4 local_8;
  
  iVar1 = 0;
  local_8 = 0;
  do {
    if ((&DAT_00447bf8)[iVar1] != *(int *)(param_3 + iVar1 * 4)) {
      return -0x7fffbffe;
    }
    iVar1 = iVar1 + 1;
  } while (iVar1 != 4);
  if ((param_5 & 3) == 0) {
    FUN_004300d9();
    pcVar3 = "Cannot marshal IBootstrapperEngine interface out of proc.";
  }
  else {
    if (param_4 == 0) {
      param_4 = param_1 + -4;
    }
    if (param_2 == (int *)0x0) {
      FUN_004300d9();
      pcVar3 = "The marshaling stream parameter is NULL.";
    }
    else {
      iVar1 = (**(code **)(*param_2 + 0x10))(param_2,param_4,4,&local_8);
      if (iVar1 == -0x7ffcff90) {
        pcVar3 = "Failed to write the stream because the stream is full.";
        uVar2 = 0x80030070;
        iVar1 = -0x7ffcff90;
        goto LAB_00417f44;
      }
      if (-1 < iVar1) {
        return iVar1;
      }
      pcVar3 = "Failed to write the IBootstrapperEngine interface pointer to the marshaling stream."
      ;
    }
  }
  iVar1 = -0x7fffbffb;
  uVar2 = 0x80004005;
LAB_00417f44:
  FUN_00430a57(uVar2,pcVar3);
  return iVar1;
}



/* Function: FUN_00417f6c */

DWORD FUN_00417f6c(int param_1,LPARAM param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  
  uVar3 = 0;
  BVar1 = PostThreadMessageW(*(DWORD *)(param_1 + 0x10),0x9001,0,param_2);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar3,"Failed to post plan message.");
  }
  return uVar3;
}



/* Function: FUN_00417fcd */

undefined4 FUN_00417fcd(int *param_1,int param_2,int *param_3)

{
  int *piVar1;
  int iVar2;
  
  if (param_3 == (int *)0x0) {
    FUN_004300d9();
    FUN_00430a57(0x80070057,"Invalid argument ppvObject");
    return 0x80070057;
  }
  *param_3 = 0;
  iVar2 = 0;
  do {
    if ((&DAT_00447bf8)[iVar2] != *(int *)(param_2 + iVar2 * 4)) {
      iVar2 = 0;
      goto LAB_00418020;
    }
    iVar2 = iVar2 + 1;
  } while (iVar2 != 4);
LAB_00418053:
  *param_3 = (int)param_1;
LAB_00418058:
  (**(code **)(*param_1 + 4))(param_1);
  return 0;
LAB_00418020:
  if ((&DAT_0044e93c)[iVar2] == *(int *)(param_2 + iVar2 * 4)) goto code_r0x00418028;
  iVar2 = 0;
  do {
    if ((&DAT_0044e92c)[iVar2] != *(int *)(param_2 + iVar2 * 4)) {
      return 0x80004002;
    }
    iVar2 = iVar2 + 1;
  } while (iVar2 != 4);
  goto LAB_00418053;
code_r0x00418028:
  iVar2 = iVar2 + 1;
  if (iVar2 == 4) goto code_r0x0041802e;
  goto LAB_00418020;
code_r0x0041802e:
  piVar1 = param_1 + 1;
  if (param_1 == (int *)0x0) {
    piVar1 = (int *)0x0;
  }
  *param_3 = (int)piVar1;
  goto LAB_00418058;
}



/* Function: FUN_0041806e */

void FUN_0041806e(int param_1,int param_2,int *param_3)

{
  FUN_00417fcd((int *)(param_1 + -4),param_2,param_3);
  return;
}



/* Function: FUN_00418078 */

DWORD FUN_00418078(int param_1,WPARAM param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  
  uVar3 = 0;
  BVar1 = PostThreadMessageW(*(DWORD *)(param_1 + 0x10),0x9004,param_2,0);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar3,"Failed to post shutdown message.");
  }
  return uVar3;
}



/* Function: FUN_004180d9 */

LONG FUN_004180d9(void *param_1)

{
  LONG LVar1;
  
  LVar1 = InterlockedDecrement((LONG *)((int)param_1 + 8));
  if (LVar1 < 1) {
    FID_conflict__free(param_1);
    LVar1 = 0;
  }
  return LVar1;
}



/* Function: FUN_004180fc */

void FUN_004180fc(int param_1)

{
  FUN_004180d9((void *)(param_1 + -4));
  return;
}



/* Function: FUN_00418106 */

DWORD FUN_00418106(int param_1,undefined4 param_2,LPCWSTR param_3,undefined4 param_4,
                  undefined4 *param_5)

{
  LPCWSTR pWVar1;
  DWORD DVar2;
  char *pcVar3;
  undefined4 local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  if (*(int *)(*(int *)(param_1 + 0xc) + 0x458) == 2) {
    DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_2);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to write error code to message buffer.";
    }
    else {
      pWVar1 = L"";
      if (param_3 != (LPCWSTR)0x0) {
        pWVar1 = param_3;
      }
      DVar2 = FUN_00430589((int *)&local_8,(int *)&local_c,pWVar1);
      if ((int)DVar2 < 0) {
        pcVar3 = "Failed to write message string to message buffer.";
      }
      else {
        DVar2 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_4);
        if ((int)DVar2 < 0) {
          pcVar3 = "Failed to write UI hint to message buffer.";
        }
        else {
          DVar2 = FUN_0040f882(*(HANDLE *)(*(int *)(param_1 + 0xc) + 0x494),1,local_8,local_c,
                               (undefined *)0x0,0,&local_10);
          if (-1 < (int)DVar2) {
            *param_5 = local_10;
            goto LAB_004181e2;
          }
          pcVar3 = "Failed to send embedded message over pipe.";
        }
      }
    }
  }
  else {
    DVar2 = 0x8007139f;
    FUN_004300d9();
    pcVar3 = "Application requested to send embedded message when not in embedded mode.";
  }
  FUN_00430a57(DVar2,pcVar3);
LAB_004181e2:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar2;
}



/* Function: FUN_004181f8 */

DWORD FUN_004181f8(int param_1,undefined4 param_2,undefined4 param_3,undefined4 *param_4)

{
  DWORD DVar1;
  char *pcVar2;
  undefined4 local_10;
  rsize_t local_c;
  void *local_8;
  
  local_8 = (void *)0x0;
  local_c = 0;
  local_10 = 0;
  if (*(int *)(*(int *)(param_1 + 0xc) + 0x458) == 2) {
    DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_2);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to write progress percentage to message buffer.";
    }
    else {
      DVar1 = FUN_0043055b((int *)&local_8,(int *)&local_c,param_3);
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to write overall progress percentage to message buffer.";
      }
      else {
        DVar1 = FUN_0040f882(*(HANDLE *)(*(int *)(param_1 + 0xc) + 0x494),2,local_8,local_c,
                             (undefined *)0x0,0,&local_10);
        if (-1 < (int)DVar1) {
          *param_4 = local_10;
          goto LAB_004182aa;
        }
        pcVar2 = "Failed to send embedded progress message over pipe.";
      }
    }
  }
  else {
    DVar1 = 0x8007139f;
    FUN_004300d9();
    pcVar2 = "Application requested to send embedded progress message when not in embedded mode.";
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_004182aa:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return DVar1;
}



/* Function: FUN_004182c0 */

int FUN_004182c0(int param_1,PCNZWCH param_2,PCNZWCH param_3,LPCWSTR param_4,LPCWSTR param_5,
                LPCWSTR param_6)

{
  int iVar1;
  int *piVar2;
  char *pcVar3;
  int local_c;
  int local_8;
  
  local_c = 0;
  local_8 = 0;
  EnterCriticalSection(*(LPCRITICAL_SECTION *)(param_1 + 0xc));
  iVar1 = FUN_0040873e(*(int *)(param_1 + 0xc) + 0xb8);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Engine is active, cannot change engine state.");
    goto LAB_0041844d;
  }
  if ((param_3 == (PCNZWCH)0x0) || (*param_3 == L'\0')) {
    if ((param_2 == (PCNZWCH)0x0) || (*param_2 == L'\0')) {
      iVar1 = -0x7ff8ffa9;
      pcVar3 = "UX did not provide container or payload id.";
      goto LAB_00418444;
    }
    iVar1 = FUN_00418ec8((int *)(*(int *)(param_1 + 0xc) + 0x290),param_2,&local_c);
    if (-1 < iVar1) {
      piVar2 = (int *)(local_c + 0x2c);
      goto LAB_00418393;
    }
    pcVar3 = "UX requested unknown container with id: %ls";
  }
  else {
    iVar1 = FUN_00407f4a((int *)(*(int *)(param_1 + 0xc) + 0x2a0),param_3,&local_8);
    if (iVar1 < 0) {
      pcVar3 = "UX requested unknown payload with id: %ls";
    }
    else {
      if (*(int *)(local_8 + 4) != 2) {
        piVar2 = (int *)(local_8 + 0x40);
LAB_00418393:
        if ((param_4 == (LPCWSTR)0x0) || (*param_4 == L'\0')) {
          if (*piVar2 != 0) {
            FUN_004380ab((LPVOID)*piVar2);
            *piVar2 = 0;
          }
LAB_00418414:
          if (piVar2[1] != 0) {
            FUN_004380ab((LPVOID)piVar2[1]);
            piVar2[1] = 0;
          }
LAB_00418426:
          if (piVar2[2] != 0) {
            FUN_004380ab((LPVOID)piVar2[2]);
            piVar2[2] = 0;
          }
        }
        else {
          iVar1 = FUN_00433f88(piVar2,param_4,0);
          if (iVar1 < 0) {
            pcVar3 = "Failed to set download URL.";
          }
          else {
            if ((param_5 == (LPCWSTR)0x0) || (*param_5 == L'\0')) goto LAB_00418414;
            iVar1 = FUN_00433f88(piVar2 + 1,param_5,0);
            if (iVar1 < 0) {
              pcVar3 = "Failed to set download user.";
            }
            else {
              if ((param_6 == (LPCWSTR)0x0) || (*param_6 == L'\0')) goto LAB_00418426;
              iVar1 = FUN_00433f88(piVar2 + 2,param_6,0);
              if (-1 < iVar1) goto LAB_0041844d;
              pcVar3 = "Failed to set download password.";
            }
          }
LAB_00418444:
          FUN_00430a57(iVar1,pcVar3);
        }
        goto LAB_0041844d;
      }
      iVar1 = -0x7ff8ef23;
      pcVar3 = "UX denied while trying to set download URL on embedded payload: %ls";
    }
  }
  FUN_00430a57(iVar1,pcVar3);
LAB_0041844d:
  LeaveCriticalSection(*(LPCRITICAL_SECTION *)(param_1 + 0xc));
  return iVar1;
}



/* Function: FUN_0041845e */

int FUN_0041845e(int param_1,PCNZWCH param_2,PCNZWCH param_3,LPCWSTR param_4)

{
  int iVar1;
  char *pcVar2;
  int local_c;
  int local_8;
  
  local_c = 0;
  local_8 = 0;
  EnterCriticalSection(*(LPCRITICAL_SECTION *)(param_1 + 0xc));
  iVar1 = FUN_0040873e(*(int *)(param_1 + 0xc) + 0xb8);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Engine is active, cannot change engine state.");
    goto LAB_0041857a;
  }
  if ((param_4 == (LPCWSTR)0x0) || (*param_4 == L'\0')) {
LAB_00418574:
    iVar1 = -0x7ff8ffa9;
  }
  else {
    if ((param_3 == (PCNZWCH)0x0) || (*param_3 == L'\0')) {
      if ((param_2 == (PCNZWCH)0x0) || (*param_2 == L'\0')) goto LAB_00418574;
      iVar1 = FUN_00418ec8((int *)(*(int *)(param_1 + 0xc) + 0x290),param_2,&local_c);
      if (-1 < iVar1) {
        iVar1 = FUN_00433f88((int *)(local_c + 0x28),param_4,0);
        if (-1 < iVar1) goto LAB_0041857a;
        pcVar2 = "Failed to set source path for container.";
        goto LAB_0041856a;
      }
      pcVar2 = "UX requested unknown container with id: %ls";
    }
    else {
      iVar1 = FUN_00407f4a((int *)(*(int *)(param_1 + 0xc) + 0x2a0),param_3,&local_8);
      if (iVar1 < 0) {
        pcVar2 = "UX requested unknown payload with id: %ls";
      }
      else {
        if (*(int *)(local_8 + 4) != 2) {
          iVar1 = FUN_00433f88((int *)(local_8 + 0x38),param_4,0);
          if (-1 < iVar1) goto LAB_0041857a;
          pcVar2 = "Failed to set source path for payload.";
LAB_0041856a:
          FUN_00430a57(iVar1,pcVar2);
          goto LAB_0041857a;
        }
        iVar1 = -0x7ff8ef23;
        pcVar2 = "UX denied while trying to set source on embedded payload: %ls";
      }
    }
    FUN_00430a57(iVar1,pcVar2);
  }
LAB_0041857a:
  LeaveCriticalSection(*(LPCRITICAL_SECTION *)(param_1 + 0xc));
  return iVar1;
}



/* Function: FUN_0041858e */

int FUN_0041858e(int param_1,LPCWSTR param_2,LPCWSTR param_3,int param_4,int param_5,int param_6,
                void *param_7,SIZE_T param_8)

{
  int iVar1;
  char *pcVar2;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  iVar1 = 0;
  local_8 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  EnterCriticalSection(*(LPCRITICAL_SECTION *)(param_1 + 0xc));
  if (((param_2 == (LPCWSTR)0x0) || (*param_2 == L'\0')) &&
     ((param_3 == (LPCWSTR)0x0 || (*param_3 == L'\0')))) {
    FUN_00409902((uint *)(*(int *)(param_1 + 0xc) + 0x2d0));
    goto LAB_004186e7;
  }
  if (param_6 == 0) {
    if ((param_8 != 0) || (param_7 != (void *)0x0)) {
LAB_00418632:
      iVar1 = -0x7ff8ffa9;
      goto LAB_004186e7;
    }
  }
  else if ((param_6 == 1) && ((param_8 != 0x14 || (param_7 == (void *)0x0)))) goto LAB_00418632;
  FUN_00409902((uint *)(*(int *)(param_1 + 0xc) + 0x2d0));
  if (((param_2 == (LPCWSTR)0x0) || (*param_2 == L'\0')) &&
     (iVar1 = FUN_00433cea((int *)&local_8,L"update\\%ls"), iVar1 < 0)) {
    pcVar2 = "Failed to default local update source";
  }
  else {
    iVar1 = *(int *)(param_1 + 0xc);
    iVar1 = FUN_00411c05((int *)&local_c,4,*(int *)(iVar1 + 0x20),*(int *)(iVar1 + 0x24),0,0,
                         *(short **)(iVar1 + 0x138),(short *)0x0,*(short **)(iVar1 + 0x28));
    if (iVar1 < 0) {
      pcVar2 = "Failed to recreate command-line for update bundle.";
    }
    else {
      iVar1 = *(int *)(param_1 + 0xc);
      if (local_8 != (LPCWSTR)0x0) {
        param_2 = local_8;
      }
      iVar1 = FUN_004229ce(0x4680000,0x30008,(int *)(iVar1 + 0x2d8),0,*(LPCWSTR *)(iVar1 + 0x104),6,
                           2,*(LPCWSTR *)(iVar1 + 0x140),param_2,param_3,param_4,param_5,1,local_c,
                           (LPCWSTR)0x0,(LPCWSTR)0x0,(undefined4 *)0x0,param_7,param_8);
      if (-1 < iVar1) {
        *(undefined4 *)(*(int *)(param_1 + 0xc) + 0x2d0) = 1;
        goto LAB_004186e7;
      }
      pcVar2 = "Failed to set update bundle.";
    }
  }
  FUN_00430a57(iVar1,pcVar2);
LAB_004186e7:
  LeaveCriticalSection(*(LPCRITICAL_SECTION *)(param_1 + 0xc));
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_00418715 */

int FUN_00418715(int param_1,PCNZWCH param_2,int param_3,undefined4 param_4)

{
  int iVar1;
  char *pcVar2;
  
  if ((param_2 == (PCNZWCH)0x0) || (*param_2 == L'\0')) {
    iVar1 = -0x7ff8ffa9;
    pcVar2 = "UX did not provide variable name.";
  }
  else {
    iVar1 = FUN_004045df((LPCRITICAL_SECTION)(*(int *)(param_1 + 0xc) + 0x88),param_2,param_3,
                         param_4,0);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to set numeric variable.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_00418766 */

int FUN_00418766(int param_1,PCNZWCH param_2,int param_3)

{
  int iVar1;
  char *pcVar2;
  
  if ((param_2 == (PCNZWCH)0x0) || (*param_2 == L'\0')) {
    iVar1 = -0x7ff8ffa9;
    pcVar2 = "UX did not provide variable name.";
  }
  else {
    iVar1 = FUN_0040461f((LPCRITICAL_SECTION)(*(int *)(param_1 + 0xc) + 0x88),param_2,param_3,0);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to set numeric variable.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_004187b4 */

int FUN_004187b4(int param_1,PCNZWCH param_2,int param_3,undefined4 param_4)

{
  int iVar1;
  char *pcVar2;
  
  if ((param_2 == (PCNZWCH)0x0) || (*param_2 == L'\0')) {
    iVar1 = -0x7ff8ffa9;
    pcVar2 = "UX did not provide variable name.";
  }
  else {
    iVar1 = FUN_0040467b((LPCRITICAL_SECTION)(*(int *)(param_1 + 0xc) + 0x88),param_2,param_3,
                         param_4,0);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to set version variable.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_00418805 */

int FUN_00418805(uint *param_1,uint param_2,short *param_3,int *param_4,uint *param_5,uint param_6)

{
  short sVar1;
  int iVar2;
  short *psVar3;
  uint uVar4;
  int iVar5;
  uint *puVar6;
  uint local_c;
  uint *local_8;
  
  iVar5 = 0;
  if ((param_6 & 0x100) == 0) {
    if (param_2 != 0) goto LAB_00418835;
LAB_0041883d:
    iVar5 = -0x7ff8ffa9;
  }
  else {
    if ((param_1 == (uint *)0x0) && (param_2 != 0)) goto LAB_0041883d;
LAB_00418835:
    if (0x7fffffff < param_2) goto LAB_0041883d;
  }
  if (iVar5 < 0) {
    return iVar5;
  }
  local_8 = param_1;
  local_c = param_2;
  psVar3 = param_3;
  if (((param_6 & 0x100) != 0) && (psVar3 = &DAT_0043b580, param_3 != (short *)0x0)) {
    psVar3 = param_3;
  }
  iVar5 = 0;
  if ((param_6 & 0xffffe000) == 0) {
    if (param_2 == 0) {
      uVar4 = param_2;
      if (*psVar3 == 0) goto LAB_004188b6;
      iVar5 = -0x7ff8ff86;
      if (param_1 == (uint *)0x0) {
        iVar5 = -0x7ff8ffa9;
      }
    }
    else {
      iVar2 = 0;
      uVar4 = param_2;
      puVar6 = param_1;
      do {
        if (((0x7ffffffe - param_2) + uVar4 == 0) ||
           (sVar1 = *(short *)(((int)psVar3 - (int)param_1) + (int)puVar6), sVar1 == 0)) break;
        *(short *)puVar6 = sVar1;
        puVar6 = (uint *)((int)puVar6 + 2);
        iVar2 = iVar2 + 1;
        uVar4 = uVar4 - 1;
      } while (uVar4 != 0);
      iVar5 = 0;
      if (uVar4 == 0) {
        puVar6 = (uint *)((int)puVar6 + -2);
        iVar2 = iVar2 + -1;
        iVar5 = -0x7ff8ff86;
      }
      *(short *)puVar6 = 0;
      uVar4 = param_2 - iVar2;
      local_8 = (uint *)((int)param_1 + iVar2 * 2);
      local_c = uVar4;
      if (-1 < iVar5) {
        if ((((param_6 & 0x200) != 0) && (1 < uVar4)) && (2 < uVar4 * 2)) {
          FUN_004267c0((uint *)((int)local_8 + 2),(byte)param_6,uVar4 * 2 - 2);
        }
        goto LAB_004188b6;
      }
    }
  }
  else {
    iVar5 = -0x7ff8ffa9;
    if (param_2 != 0) {
      *(undefined2 *)param_1 = 0;
    }
  }
  uVar4 = local_c;
  if (((param_6 & 0x1c00) != 0) && (param_2 != 0)) {
    FID_conflict__StringExHandleOtherFlagsW_24(param_1,param_2 * 2,0,&local_8,&local_c,param_6);
    uVar4 = local_c;
  }
  if ((iVar5 < 0) && (iVar5 != -0x7ff8ff86)) {
    return iVar5;
  }
LAB_004188b6:
  if (param_4 != (int *)0x0) {
    *param_4 = (int)local_8;
  }
  if (param_5 != (uint *)0x0) {
    *param_5 = uVar4;
  }
  return iVar5;
}



/* Function: FID_conflict:_StringExHandleOtherFlagsW@24 */

/* Library Function - Multiple Matches With Different Base Names
    long __stdcall StringExHandleOtherFlagsW(unsigned short *,unsigned int,unsigned int,unsigned
   short * *,unsigned int *,unsigned long)
    _RtlStringExHandleOtherFlagsW@24
    _StringExHandleOtherFlagsW@24
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release, Visual Studio 2019 Release */

undefined4
FID_conflict__StringExHandleOtherFlagsW_24
          (uint *param_1,uint param_2,int param_3,undefined4 *param_4,uint *param_5,uint param_6)

{
  undefined2 *puVar1;
  uint uVar2;
  
  uVar2 = param_2 >> 1;
  if ((uVar2 != 0) && ((param_6 & 0x1000) != 0)) {
    puVar1 = (undefined2 *)((int)param_1 + param_3 * 2);
    *param_4 = puVar1;
    *param_5 = uVar2 - param_3;
    *puVar1 = 0;
  }
  if ((param_6 & 0x400) != 0) {
    FUN_004267c0(param_1,(byte)param_6,param_2);
    if ((param_6 & 0xff) == 0) {
      *param_4 = param_1;
      *param_5 = uVar2;
    }
    else {
      if (uVar2 == 0) {
        return 0;
      }
      puVar1 = (undefined2 *)((int)param_1 + uVar2 * 2 + -2);
      *param_4 = puVar1;
      *param_5 = 1;
      *puVar1 = 0;
    }
  }
  if ((uVar2 != 0) && ((param_6 & 0x800) != 0)) {
    *param_4 = param_1;
    *param_5 = uVar2;
    *(undefined2 *)param_1 = 0;
  }
  return 0;
}



/* Function: FUN_00418a37 */

int FUN_00418a37(undefined4 param_1,int *param_2,int param_3,undefined4 *param_4)

{
  int iVar1;
  char *pcVar2;
  undefined4 local_8;
  
  iVar1 = 0;
  local_8 = 0;
  do {
    if ((&DAT_00447bf8)[iVar1] != *(int *)(param_3 + iVar1 * 4)) {
      return -0x7fffbffe;
    }
    iVar1 = iVar1 + 1;
  } while (iVar1 != 4);
  if (param_2 == (int *)0x0) {
    FUN_004300d9();
    pcVar2 = "The marshaling stream parameter is NULL.";
  }
  else if (param_4 == (undefined4 *)0x0) {
    FUN_004300d9();
    pcVar2 = "The interface output parameter is NULL.";
  }
  else {
    iVar1 = (**(code **)(*param_2 + 0xc))(param_2,*param_4,4,&local_8);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to read the IBootstrapperEngine interface pointer from the marshaling stream.";
  }
  FUN_00430a57(0x80004005,pcVar2);
  return -0x7fffbffb;
}



/* Function: FUN_00418ad9 */

int FUN_00418ad9(undefined4 param_1,undefined4 param_2,undefined4 param_3)

{
  void *this;
  int *piVar1;
  int iVar2;
  
  this = operator_new(0x14);
  if (this == (void *)0x0) {
    piVar1 = (int *)0x0;
  }
  else {
    piVar1 = FUN_0041797f(this,param_1,param_2);
  }
  if (piVar1 == (int *)0x0) {
    iVar2 = -0x7ff8fff2;
    FUN_004300d9();
    FUN_00430a57(0x8007000e,"Failed to allocate new BootstrapperEngineForApplication object.");
  }
  else {
    iVar2 = (**(code **)*piVar1)(piVar1,&DAT_00447bf8,param_3);
    if (iVar2 < 0) {
      FUN_00430a57(iVar2,
                   "Failed to QI for IBootstrapperEngine from BootstrapperEngineForApplication object."
                  );
    }
    (**(code **)(*piVar1 + 8))(piVar1);
  }
  return iVar2;
}



/* Function: FUN_00418b53 */

int FUN_00418b53(uint *param_1,uint param_2)

{
  int iVar1;
  uint local_14 [4];
  
  local_14[0] = 0;
  local_14[1] = 0;
  local_14[2] = 0;
  local_14[3] = 0;
  iVar1 = 0;
  if (param_1[2] != param_2) {
    if (param_2 != 0) {
      if (param_2 == 1) {
        iVar1 = FUN_00418c4f(param_1,(longlong *)local_14);
      }
      else if (param_2 == 2) {
        iVar1 = FUN_00418c97(param_1,(int *)local_14);
      }
      else {
        if (param_2 != 3) {
          return -0x7ff8ffa9;
        }
        iVar1 = FUN_00418d39(param_1,local_14);
      }
    }
    if (iVar1 < 0) {
      FUN_00430a57(iVar1,"Failed to copy variant value.");
    }
    else {
      local_14[2] = param_2;
      FUN_00418e52((int *)param_1);
      _memcpy_s(param_1,0x10,local_14,0x10);
    }
  }
  return iVar1;
}



/* Function: FUN_00418be2 */

int FUN_00418be2(int *param_1,int *param_2)

{
  int iVar1;
  int iVar2;
  
  iVar1 = param_1[2];
  iVar2 = 0;
  if (iVar1 == 0) {
    FUN_00418e52(param_2);
  }
  else if (iVar1 == 1) {
    iVar2 = FUN_00418d81(param_2,*param_1,param_1[1]);
  }
  else if (iVar1 == 2) {
    iVar2 = FUN_00418dbd(param_2,(LPCWSTR)*param_1,0);
  }
  else {
    if (iVar1 != 3) {
      iVar2 = -0x7ff8ffa9;
      goto LAB_00418c3b;
    }
    iVar2 = FUN_00418e16(param_2,*param_1,param_1[1]);
  }
  if (-1 < iVar2) {
    return iVar2;
  }
LAB_00418c3b:
  FUN_00430a57(iVar2,"Failed to copy variant.");
  return iVar2;
}



/* Function: FUN_00418c4f */

int FUN_00418c4f(undefined4 *param_1,longlong *param_2)

{
  int iVar1;
  
  iVar1 = param_1[2];
  if (iVar1 != 1) {
    if (iVar1 == 2) {
      iVar1 = FUN_004345da((LPCWSTR)*param_1,0,param_2);
      if (-1 < iVar1) {
        return iVar1;
      }
      return -0x7ffdfffb;
    }
    if (iVar1 != 3) {
      return -0x7ff8ffa9;
    }
  }
  *(undefined4 *)param_2 = *param_1;
  *(undefined4 *)((int)param_2 + 4) = param_1[1];
  return 0;
}



/* Function: FUN_00418c97 */

int FUN_00418c97(undefined4 *param_1,int *param_2)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = param_1[2];
  if (iVar1 == 1) {
    iVar1 = FUN_00433cea(param_2,L"%I64d");
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to convert int64 to string.";
  }
  else if (iVar1 == 2) {
    iVar1 = FUN_00433f88(param_2,(LPCWSTR)*param_1,0);
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to copy value.";
  }
  else {
    if (iVar1 != 3) {
      return -0x7ff8ffa9;
    }
    iVar1 = FUN_00433cea(param_2,L"%hu.%hu.%hu.%hu");
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to convert version to string.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_00418d39 */

int FUN_00418d39(uint *param_1,uint *param_2)

{
  uint uVar1;
  int iVar2;
  
  uVar1 = param_1[2];
  if (uVar1 != 1) {
    if (uVar1 == 2) {
      iVar2 = FUN_0043720f((LPCWSTR)*param_1,0,param_2);
      if (-1 < iVar2) {
        return iVar2;
      }
      return -0x7ffdfffb;
    }
    if (uVar1 != 3) {
      return -0x7ff8ffa9;
    }
  }
  *param_2 = *param_1;
  param_2[1] = param_1[1];
  return 0;
}



/* Function: FUN_00418d81 */

undefined4 FUN_00418d81(int *param_1,int param_2,int param_3)

{
  if ((param_1[2] == 2) && (*param_1 != 0)) {
    FUN_004380ab((LPVOID)*param_1);
  }
  *param_1 = 0;
  param_1[1] = 0;
  param_1[2] = 0;
  param_1[3] = 0;
  *param_1 = param_2;
  param_1[1] = param_3;
  param_1[2] = 1;
  return 0;
}



/* Function: FUN_00418dbd */

int FUN_00418dbd(int *param_1,LPCWSTR param_2,uint param_3)

{
  int iVar1;
  
  iVar1 = 0;
  if (param_2 == (LPCWSTR)0x0) {
    FUN_00418e52(param_1);
  }
  else {
    if (param_1[2] != 2) {
      *param_1 = 0;
      param_1[1] = 0;
      param_1[2] = 0;
      param_1[3] = 0;
    }
    iVar1 = FUN_00433f88(param_1,param_2,param_3);
    if (iVar1 < 0) {
      FUN_00430a57(iVar1,"Failed to copy string.");
    }
    else {
      param_1[2] = 2;
    }
  }
  return iVar1;
}



/* Function: FUN_00418e16 */

undefined4 FUN_00418e16(int *param_1,int param_2,int param_3)

{
  if ((param_1[2] == 2) && (*param_1 != 0)) {
    FUN_004380ab((LPVOID)*param_1);
  }
  *param_1 = 0;
  param_1[1] = 0;
  param_1[2] = 0;
  param_1[3] = 0;
  *param_1 = param_2;
  param_1[1] = param_3;
  param_1[2] = 3;
  return 0;
}



/* Function: FUN_00418e52 */

void FUN_00418e52(int *param_1)

{
  if ((param_1[2] == 2) && (*param_1 != 0)) {
    FUN_004380ab((LPVOID)*param_1);
  }
  *param_1 = 0;
  param_1[1] = 0;
  param_1[2] = 0;
  param_1[3] = 0;
  return;
}



/* Function: FUN_00418e76 */

DWORD FUN_00418e76(uint *param_1)

{
  DWORD DVar1;
  
  DVar1 = 0;
  if (param_1[6] == 1) {
    DVar1 = FUN_00423f94((int)param_1);
    if ((int)DVar1 < 0) {
      FUN_00430a57(DVar1,"Failed to close cabinet.");
    }
  }
  if (*param_1 != 0xffffffff) {
    CloseHandle((HANDLE)*param_1);
    *param_1 = 0xffffffff;
  }
  if (-1 < (int)DVar1) {
    FUN_004267c0(param_1,0,0x58);
  }
  return DVar1;
}



/* Function: FUN_00418ec8 */

undefined4 FUN_00418ec8(int *param_1,PCNZWCH param_2,undefined4 *param_3)

{
  int *piVar1;
  undefined4 *puVar2;
  int iVar3;
  uint uVar4;
  
  piVar1 = param_1;
  uVar4 = 0;
  if (param_1[1] != 0) {
    param_1 = (int *)0x0;
    do {
      puVar2 = (undefined4 *)(*piVar1 + (int)param_1);
      iVar3 = CompareStringW(0x7f,0,(PCNZWCH)*puVar2,-1,param_2,-1);
      if (iVar3 == 2) {
        *param_3 = puVar2;
        return 0;
      }
      uVar4 = uVar4 + 1;
      param_1 = param_1 + 0x14;
    } while (uVar4 < (uint)piVar1[1]);
  }
  return 0x80070490;
}



/* Function: FUN_00418f25 */

DWORD FUN_00418f25(int param_1,undefined4 param_2)

{
  DWORD DVar1;
  
  DVar1 = 0;
  if (*(int *)(param_1 + 0x18) == 1) {
    DVar1 = FUN_00424093(param_1,param_2);
  }
  return DVar1;
}



/* Function: FUN_00418f44 */

DWORD FUN_00418f44(LPHANDLE param_1,int param_2,HANDLE param_3,LPCWSTR param_4)

{
  LARGE_INTEGER liDistanceToMove;
  HANDLE pvVar1;
  DWORD DVar2;
  HANDLE hSourceProcessHandle;
  BOOL BVar3;
  DWORD unaff_EDI;
  uint uVar4;
  LPHANDLE lpTargetHandle;
  char *pcVar5;
  DWORD dwOptions;
  
  param_1[6] = *(HANDLE *)(param_2 + 4);
  param_1[4] = *(HANDLE *)(param_2 + 0x18);
  param_1[5] = *(HANDLE *)(param_2 + 0x1c);
  param_1[2] = *(HANDLE *)(param_2 + 0x40);
  param_1[3] = *(HANDLE *)(param_2 + 0x44);
  if (param_3 == (HANDLE)0xffffffff) {
    pvVar1 = CreateFileW(param_4,0x80000000,1,(LPSECURITY_ATTRIBUTES)0x0,3,0x8000080,(HANDLE)0x0);
    *param_1 = pvVar1;
    if (pvVar1 != (HANDLE)0xffffffff) {
LAB_00419035:
      if (*(int *)(param_2 + 0xc) == 0) {
        pvVar1 = (HANDLE)0x0;
      }
      else {
        pvVar1 = param_1[3];
      }
      liDistanceToMove.s.HighPart = 0;
      liDistanceToMove.s.LowPart = (DWORD)pvVar1;
      BVar3 = SetFilePointerEx(*param_1,liDistanceToMove,(PLARGE_INTEGER)0x0,unaff_EDI);
      if (BVar3 == 0) {
        DVar2 = GetLastError();
        uVar4 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar4 = DVar2;
        }
        if (-1 < (int)uVar4) {
          uVar4 = 0x80004005;
        }
        FUN_004300d9();
        pcVar5 = "Failed to move file pointer to container offset.";
      }
      else {
        if (param_1[6] != (HANDLE)0x1) {
          return 0;
        }
        uVar4 = FUN_004240d7(param_1,param_4);
        if (-1 < (int)uVar4) {
          return uVar4;
        }
        pcVar5 = "Failed to open container.";
      }
      FUN_00430a57(uVar4,pcVar5);
      return uVar4;
    }
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar5 = "Failed to open file: %ls";
  }
  else {
    dwOptions = 2;
    BVar3 = 0;
    DVar2 = 0;
    lpTargetHandle = param_1;
    pvVar1 = GetCurrentProcess();
    hSourceProcessHandle = GetCurrentProcess();
    BVar3 = DuplicateHandle(hSourceProcessHandle,param_3,pvVar1,lpTargetHandle,DVar2,BVar3,dwOptions
                           );
    if (BVar3 != 0) goto LAB_00419035;
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar5 = "Failed to duplicate handle to container: %ls";
  }
  FUN_00430a57(uVar4,pcVar5);
  return uVar4;
}



/* Function: FUN_004190b7 */

DWORD FUN_004190b7(undefined4 *param_1,LPHANDLE param_2)

{
  DWORD DVar1;
  char *pcVar2;
  uint local_58 [6];
  uint local_40 [10];
  uint local_18 [2];
  undefined4 local_10 [2];
  LPCWSTR local_8;
  
  FUN_004267c0(local_58,0,0x50);
  local_8 = (LPCWSTR)0x0;
  local_58[1] = 1;
  local_58[2] = 1;
  local_58[3] = 1;
  local_58[4] = 0;
  DVar1 = FUN_00407185((int)param_1,0,1,local_18,local_40,local_10);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to get container information for UX container.";
  }
  else {
    DVar1 = FUN_00431c19((int *)&local_8,(HMODULE)0x0);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to get path for executing module.";
    }
    else {
      DVar1 = FUN_00418f44(param_2,(int)local_58,(HANDLE)*param_1,local_8);
      if (-1 < (int)DVar1) goto LAB_00419142;
      pcVar2 = "Failed to open attached container.";
    }
  }
  FUN_00430a57(DVar1,pcVar2);
LAB_00419142:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_00419158 */

DWORD FUN_00419158(int param_1)

{
  DWORD DVar1;
  
  DVar1 = 0;
  if (*(int *)(param_1 + 0x18) == 1) {
    DVar1 = FUN_00424200(param_1);
  }
  return DVar1;
}



/* Function: FUN_00419174 */

DWORD FUN_00419174(int param_1,undefined4 *param_2,undefined4 *param_3)

{
  DWORD DVar1;
  
  DVar1 = 0;
  if (*(int *)(param_1 + 0x18) == 1) {
    DVar1 = FUN_0042422e(param_1,param_2,param_3);
  }
  return DVar1;
}



/* Function: FUN_00419196 */

DWORD FUN_00419196(int param_1,undefined4 param_2)

{
  DWORD DVar1;
  
  DVar1 = 0;
  if (*(int *)(param_1 + 0x18) == 1) {
    DVar1 = FUN_0042427b(param_1,param_2);
  }
  return DVar1;
}



/* Function: FUN_004191b5 */

uint FUN_004191b5(int param_1,int *param_2,int *param_3)

{
  uint *puVar1;
  uint uVar2;
  int iVar3;
  int *piVar4;
  char *pcVar5;
  int local_14;
  int *local_10;
  int *local_c;
  int *local_8;
  
  local_10 = (int *)0x0;
  local_8 = (int *)0x0;
  local_c = (int *)0x0;
  uVar2 = FUN_00435fbe(param_3,L"Container",(int)&local_10);
  if ((int)uVar2 < 0) {
    pcVar5 = "Failed to select container nodes.";
  }
  else {
    uVar2 = (**(code **)(*local_10 + 0x20))(local_10,&local_c);
    if ((int)uVar2 < 0) {
      pcVar5 = "Failed to get container node count.";
    }
    else {
      if (local_c == (int *)0x0) goto LAB_00419458;
      iVar3 = FUN_00431078((int)local_c * 0x50,1);
      *param_2 = iVar3;
      if (iVar3 != 0) {
        param_3 = (int *)0x0;
        param_2[1] = (int)local_c;
        if (local_c != (int *)0x0) {
          local_14 = 0;
          do {
            piVar4 = (int *)(*param_2 + local_14);
            uVar2 = FUN_00435f1d(local_10,&local_8,(undefined4 *)0x0);
            if ((int)uVar2 < 0) {
              pcVar5 = "Failed to get next node.";
LAB_0041944a:
              FUN_00430a57(uVar2,pcVar5);
              goto LAB_00419458;
            }
            piVar4[1] = 1;
            uVar2 = FUN_00435b5e(local_8,&DAT_0043c524,piVar4);
            if ((int)uVar2 < 0) {
              pcVar5 = "Failed to get @Id.";
              goto LAB_0041944a;
            }
            puVar1 = (uint *)(piVar4 + 2);
            uVar2 = FUN_00435d6c(local_8,L"Primary",puVar1);
            if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
              pcVar5 = "Failed to get @Primary.";
              goto LAB_0041944a;
            }
            uVar2 = FUN_00435d6c(local_8,L"Attached",(uint *)(piVar4 + 3));
            if (((uVar2 != 0x80070490) || (*puVar1 != 0)) && ((int)uVar2 < 0)) {
              pcVar5 = "Failed to get @Attached.";
              goto LAB_0041944a;
            }
            uVar2 = FUN_00435c9d(local_8,L"AttachedIndex",(ulong *)(piVar4 + 4));
            if (((uVar2 != 0x80070490) || (piVar4[3] != 0)) && ((int)uVar2 < 0)) {
              pcVar5 = "Failed to get @AttachedIndex.";
              goto LAB_0041944a;
            }
            uVar2 = FUN_00435b5e(local_8,L"FilePath",piVar4 + 9);
            if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
              pcVar5 = "Failed to get @FilePath.";
              goto LAB_0041944a;
            }
            uVar2 = FUN_00433f88(piVar4 + 10,(LPCWSTR)piVar4[9],0);
            if ((int)uVar2 < 0) {
              pcVar5 = "Failed to copy @FilePath";
              goto LAB_0041944a;
            }
            uVar2 = FUN_00435b5e(local_8,L"DownloadUrl",piVar4 + 0xb);
            if (((uVar2 != 0x80070490) || ((*puVar1 == 0 && (piVar4[10] == 0)))) && ((int)uVar2 < 0)
               ) {
              pcVar5 = 
              "Failed to get @DownloadUrl. Either @SourcePath or @DownloadUrl needs to be provided."
              ;
              goto LAB_0041944a;
            }
            uVar2 = FUN_00435b5e(local_8,L"Hash",piVar4 + 8);
            if ((int)uVar2 < 0) {
              if (uVar2 == 0x80070490) goto LAB_004193b2;
              pcVar5 = "Failed to get @Hash.";
              goto LAB_0041944a;
            }
            uVar2 = FUN_00433e39((LPCWSTR)piVar4[8],piVar4 + 0xe,(uint *)(piVar4 + 0xf));
            if ((int)uVar2 < 0) {
              pcVar5 = "Failed to hex decode the Container/@Hash.";
              goto LAB_0041944a;
            }
LAB_004193b2:
            if ((piVar4[3] != 0) &&
               (uVar2 = FUN_00407185(param_1,piVar4[4],piVar4[1],(uint *)(piVar4 + 0x10),
                                     (uint *)(piVar4 + 6),piVar4 + 0x12), (int)uVar2 < 0)) {
              pcVar5 = "Failed to get attached container information.";
              goto LAB_0041944a;
            }
            if (local_8 != (int *)0x0) {
              (**(code **)(*local_8 + 8))(local_8);
              local_8 = (int *)0x0;
            }
            param_3 = (int *)((int)param_3 + 1);
            local_14 = local_14 + 0x50;
          } while (param_3 < local_c);
        }
        uVar2 = 0;
        goto LAB_00419458;
      }
      uVar2 = 0x8007000e;
      FUN_004300d9();
      pcVar5 = "Failed to allocate memory for container structs.";
    }
  }
  FUN_00430a57(uVar2,pcVar5);
LAB_00419458:
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return uVar2;
}



/* Function: FUN_00419479 */

uint FUN_00419479(int param_1,uint param_2,undefined4 *param_3)

{
  uint uVar1;
  int *piVar2;
  uint uVar3;
  int iStack_14;
  
  uVar1 = 0;
  iStack_14 = 0;
  uVar3 = 0;
  if (*(uint *)(param_1 + 0xb4) != 0) {
    piVar2 = *(int **)(param_1 + 0xb0);
    do {
      if (piVar2[2] == 0) {
        if (param_2 == piVar2[1]) {
          iStack_14 = *piVar2;
          break;
        }
      }
      else {
        iStack_14 = *piVar2;
      }
      uVar3 = uVar3 + 1;
      piVar2 = piVar2 + 3;
    } while (uVar3 < *(uint *)(param_1 + 0xb4));
    if (iStack_14 != 0) goto LAB_004194fd;
  }
  if (param_2 == 0) {
    iStack_14 = 1;
  }
  else if ((((param_2 == 0xbc2) || (param_2 == 0x80070bc2)) || (param_2 == 0xbc3)) ||
          (param_2 == 0x80070bc3)) {
    iStack_14 = 3;
  }
  else if ((param_2 == 0x669) || (param_2 == 0x80070669)) {
    iStack_14 = 4;
  }
  else {
    iStack_14 = 2;
  }
LAB_004194fd:
  if (iStack_14 == 1) {
    *param_3 = 0;
  }
  else if (iStack_14 == 2) {
    *param_3 = 0;
    uVar1 = param_2 & 0xffff | 0x80070000;
    if ((int)param_2 < 1) {
      uVar1 = param_2;
    }
    if (-1 < (int)uVar1) {
      uVar1 = 0x80004005;
    }
  }
  else if (iStack_14 == 3) {
    *param_3 = 1;
  }
  else if (iStack_14 == 4) {
    *param_3 = 2;
  }
  else {
    uVar1 = 0x8000ffff;
  }
  return uVar1;
}



/* Function: FUN_00419552 */

DWORD FUN_00419552(int param_1,uint param_2)

{
  short *psVar1;
  undefined4 uVar2;
  uint uVar3;
  DWORD DVar4;
  uint local_8;
  
  DVar4 = 0;
  psVar1 = *(short **)(param_1 + 0x90);
  local_8 = 0;
  uVar3 = 0;
  if (((psVar1 == (short *)0x0) || (*psVar1 == 0)) ||
     (DVar4 = FUN_00405961(param_2,psVar1,&local_8), uVar3 = local_8, -1 < (int)DVar4)) {
    uVar2 = 2;
    if (uVar3 != 0) {
      uVar2 = 4;
    }
    *(undefined4 *)(param_1 + 0x40) = uVar2;
  }
  else {
    FUN_00430a57(DVar4,"Failed to evaluate executable package detect condition.");
  }
  return DVar4;
}



/* Function: FUN_004195ac */

void FUN_004195ac(int param_1,LPCRITICAL_SECTION param_2,int param_3,undefined *param_4,
                 undefined4 param_5,undefined4 *param_6)

{
  DWORD DVar1;
  int iVar2;
  BOOL BVar3;
  uint uVar4;
  LPCWSTR pWVar5;
  char *pcVar6;
  _STARTUPINFOW local_2a8;
  undefined4 local_264;
  undefined4 local_260;
  undefined4 local_25c;
  undefined4 uStack_258;
  int local_254;
  undefined4 *local_250;
  _PROCESS_INFORMATION local_24c;
  LPCRITICAL_SECTION local_23c;
  BOOL local_238;
  undefined4 local_234;
  code *local_230;
  LPVOID local_22c;
  LPVOID local_228;
  LPCWSTR local_224;
  DWORD local_220;
  LPVOID local_21c;
  LPWSTR local_218;
  LPCWSTR local_214;
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_23c = param_2;
  local_254 = param_3;
  local_230 = (code *)param_4;
  local_234 = param_5;
  local_250 = param_6;
  FUN_004267c0((uint *)local_210,0,0x208);
  local_238 = 0;
  local_22c = (LPVOID)0x0;
  local_228 = (LPVOID)0x0;
  local_224 = (LPCWSTR)0x0;
  local_214 = (LPCWSTR)0x0;
  local_218 = (LPWSTR)0x0;
  local_21c = (LPVOID)0x0;
  FUN_004267c0(&local_2a8.cb,0,0x44);
  local_24c.hProcess = (HANDLE)0x0;
  local_24c.hThread = (HANDLE)0x0;
  local_24c.dwProcessId = 0;
  local_24c.dwThreadId = 0;
  local_264 = 0;
  local_260 = 0;
  local_25c = 0;
  uStack_258 = 0;
  local_220 = 0;
  DVar1 = FUN_00413be9(*(int *)(*(int *)(param_1 + 8) + 0x14),
                       *(undefined4 *)(*(int *)(param_1 + 8) + 0x24),(int *)&local_224);
  if ((int)DVar1 < 0) {
    pcVar6 = "Failed to get cached path for package: %ls";
    goto LAB_00419685;
  }
  iVar2 = FUN_004314a9(local_224,*(LPCWSTR *)(**(int **)(*(int *)(param_1 + 8) + 0x7c) + 0x18),
                       (int *)&local_214);
  if (iVar2 < 0) {
    pcVar6 = "Failed to build executable path.";
  }
  else {
    iVar2 = *(int *)(param_1 + 0x10);
    if (iVar2 == 1) {
      pWVar5 = *(LPCWSTR *)(*(int *)(param_1 + 8) + 0x9c);
    }
    else if (iVar2 == 2) {
      pWVar5 = *(LPCWSTR *)(*(int *)(param_1 + 8) + 0x94);
    }
    else {
      if (iVar2 != 5) {
        iVar2 = -0x7fff0001;
        pcVar6 = "Failed to get action arguments for executable package.";
        goto LAB_004196bb;
      }
      pWVar5 = *(LPCWSTR *)(*(int *)(param_1 + 8) + 0x98);
    }
    if ((pWVar5 == (LPCWSTR)0x0) || (*pWVar5 == L'\0')) {
      iVar2 = FUN_00433cea((int *)&local_218,L"\"%ls\"");
      if (iVar2 < 0) {
LAB_0041975b:
        pcVar6 = "Failed to create executable command.";
      }
      else {
        iVar2 = FUN_00433cea((int *)&local_21c,L"\"%ls\"");
LAB_004197e3:
        if (iVar2 < 0) {
          pcVar6 = "Failed to create obfuscated executable command.";
        }
        else {
          if ((*(int *)(param_1 + 0x14) == 0) || (*(int *)(*(int *)(param_1 + 8) + 0xac) != 1)) {
LAB_00419866:
            FUN_0040e2bb(*(undefined4 *)(param_1 + 0x10));
            FUN_0040e8fd(local_254);
            FUN_00402003(2,0x2000012d);
            if (*(int *)(param_1 + 0xc) == 0) {
              if (*(int *)(*(int *)(param_1 + 8) + 0xac) == 1) {
                DVar1 = FUN_00424468(local_214,local_218,local_230,local_234,&local_220);
                if ((int)DVar1 < 0) {
                  pcVar6 = "Failed to run bundle as embedded from path: %ls";
LAB_00419685:
                  FUN_00430a57(DVar1,pcVar6);
                  goto LAB_00419ae3;
                }
              }
              else {
                if (*(int *)(*(int *)(param_1 + 8) + 0xac) != 2) goto LAB_00419944;
                DVar1 = FUN_00424c63(local_214,local_218,local_230,local_234,&local_220);
                if ((int)DVar1 < 0) {
                  pcVar6 = "Failed to run netfx chainer: %ls";
                  goto LAB_00419685;
                }
              }
LAB_00419a59:
              uVar4 = FUN_00419479(*(int *)(param_1 + 8),local_220,local_250);
              if ((int)uVar4 < 0) {
                FUN_004300d9();
                pcVar6 = "Process returned error: 0x%x";
                goto LAB_00419ac8;
              }
            }
            else {
LAB_00419944:
              DVar1 = GetCurrentDirectoryW(0x104,local_210);
              if (DVar1 != 0) {
                local_238 = SetCurrentDirectoryW(local_224);
              }
              local_2a8.cb = 0x44;
              BVar3 = CreateProcessW(local_214,local_218,(LPSECURITY_ATTRIBUTES)0x0,
                                     (LPSECURITY_ATTRIBUTES)0x0,0,0x8000000,(LPVOID)0x0,(LPCWSTR)0x0
                                     ,&local_2a8,&local_24c);
              if (BVar3 == 0) {
                DVar1 = GetLastError();
                uVar4 = DVar1 & 0xffff | 0x80070000;
                if ((int)DVar1 < 1) {
                  uVar4 = DVar1;
                }
                if (-1 < (int)uVar4) {
                  uVar4 = 0x80004005;
                }
                FUN_004300d9();
                pcVar6 = "Failed to CreateProcess on path: %ls";
              }
              else {
                if (*(int *)(param_1 + 0xc) != 0) {
                  WaitForInputIdle(local_24c.hProcess,5000);
                  goto LAB_00419ad1;
                }
                do {
                  local_264 = 2;
                  local_260 = 1;
                  local_25c = 0x32;
                  iVar2 = (*local_230)(&local_264,local_234);
                  if ((iVar2 != 1) && (iVar2 != 0)) {
                    FUN_004300d9();
                    FUN_00430a57((iVar2 != 2) + 0x80070642,
                                 "Bootstrapper application aborted during EXE progress.");
                    goto LAB_00419ad1;
                  }
                  uVar4 = FUN_00431fb6(local_24c.hProcess,500,&local_220);
                } while (uVar4 == 0x80070102);
                if (-1 < (int)uVar4) goto LAB_00419a59;
                pcVar6 = "Failed to wait for executable to complete: %ls";
              }
LAB_00419ac8:
              FUN_00430a57(uVar4,pcVar6);
            }
LAB_00419ad1:
            if (local_238 != 0) {
              SetCurrentDirectoryW(local_210);
            }
            goto LAB_00419ae3;
          }
          iVar2 = FUN_00433cea((int *)&local_218,L"%ls -%ls=%ls");
          if (iVar2 < 0) {
            pcVar6 = "Failed to append the list of dependencies to ignore to the command line.";
          }
          else {
            iVar2 = FUN_00433cea((int *)&local_21c,L"%ls -%ls=%ls");
            if (-1 < iVar2) goto LAB_00419866;
            pcVar6 = 
            "Failed to append the list of dependencies to ignore to the obfuscated command line.";
          }
        }
      }
    }
    else {
      iVar2 = FUN_00403a92(local_23c,pWVar5,(int *)&local_22c,(uint *)0x0);
      if (iVar2 < 0) {
        pcVar6 = "Failed to format argument string.";
      }
      else {
        iVar2 = FUN_00433cea((int *)&local_218,L"\"%ls\" %s");
        if (iVar2 < 0) goto LAB_0041975b;
        iVar2 = FUN_00403aac(local_23c,pWVar5,(int *)&local_228,(uint *)0x0);
        if (-1 < iVar2) {
          iVar2 = FUN_00433cea((int *)&local_21c,L"\"%ls\" %s");
          goto LAB_004197e3;
        }
        pcVar6 = "Failed to format obfuscated argument string.";
      }
    }
  }
LAB_004196bb:
  FUN_00430a57(iVar2,pcVar6);
LAB_00419ae3:
  if (local_22c != (LPVOID)0x0) {
    FUN_004380ab(local_22c);
  }
  if (local_228 != (LPVOID)0x0) {
    FUN_004380ab(local_228);
  }
  if (local_224 != (LPCWSTR)0x0) {
    FUN_004380ab(local_224);
  }
  if (local_214 != (LPCWSTR)0x0) {
    FUN_004380ab(local_214);
  }
  if (local_218 != (LPWSTR)0x0) {
    FUN_004380ab(local_218);
  }
  if (local_21c != (LPVOID)0x0) {
    FUN_004380ab(local_21c);
  }
  if (local_24c.hThread != (HANDLE)0x0) {
    CloseHandle(local_24c.hThread);
    local_24c.hThread = (HANDLE)0x0;
  }
  if (local_24c.hProcess != (HANDLE)0x0) {
    CloseHandle(local_24c.hProcess);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00419b9d */

void FUN_00419b9d(int param_1)

{
  int iVar1;
  int *piVar2;
  
  piVar2 = (int *)(param_1 + 0x90);
  if (*piVar2 != 0) {
    FUN_004380ab((LPVOID)*piVar2);
  }
  if (*(LPVOID *)(param_1 + 0x94) != (LPVOID)0x0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x94));
  }
  if (*(LPVOID *)(param_1 + 0x98) != (LPVOID)0x0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x98));
  }
  if (*(LPVOID *)(param_1 + 0x9c) != (LPVOID)0x0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x9c));
  }
  if (*(LPVOID *)(param_1 + 0xa0) != (LPVOID)0x0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0xa0));
  }
  if (*(LPVOID *)(param_1 + 0xb0) != (LPVOID)0x0) {
    FUN_00431137(*(LPVOID *)(param_1 + 0xb0));
  }
  for (iVar1 = 10; iVar1 != 0; iVar1 = iVar1 + -1) {
    *piVar2 = 0;
    piVar2 = piVar2 + 1;
  }
  return;
}



/* Function: FUN_00419c14 */

uint FUN_00419c14(int *param_1,uint param_2)

{
  uint uVar1;
  uint uVar2;
  int iVar3;
  undefined4 *puVar4;
  char *pcVar5;
  int *local_14;
  uint local_10;
  int *local_c;
  PCNZWCH local_8;
  
  uVar1 = param_2;
  local_14 = (int *)0x0;
  local_c = (int *)0x0;
  local_10 = 0;
  local_8 = (PCNZWCH)0x0;
  uVar2 = FUN_00435b5e(param_1,L"DetectCondition",(int *)(param_2 + 0x90));
  if ((int)uVar2 < 0) {
    pcVar5 = "Failed to get @DetectCondition.";
  }
  else {
    uVar2 = FUN_00435b5e(param_1,L"InstallArguments",(int *)(param_2 + 0x94));
    if ((int)uVar2 < 0) {
      pcVar5 = "Failed to get @InstallArguments.";
    }
    else {
      uVar2 = FUN_00435b5e(param_1,L"UninstallArguments",(int *)(param_2 + 0x9c));
      if ((int)uVar2 < 0) {
        pcVar5 = "Failed to get @UninstallArguments.";
      }
      else {
        uVar2 = FUN_00435b5e(param_1,L"RepairArguments",(int *)(param_2 + 0x98));
        if ((int)uVar2 < 0) {
          pcVar5 = "Failed to get @RepairArguments.";
        }
        else {
          uVar2 = FUN_00435d6c(param_1,L"Repairable",(uint *)(param_2 + 0xa8));
          if ((uVar2 == 0x80070490) || (-1 < (int)uVar2)) {
            uVar2 = FUN_00435b5e(param_1,L"Protocol",(int *)&local_8);
            if ((int)uVar2 < 0) {
              if (uVar2 != 0x80070490) {
                pcVar5 = "Failed to get @Protocol.";
                goto LAB_00419f83;
              }
            }
            else {
              iVar3 = CompareStringW(0x7f,0,local_8,-1,L"burn",-1);
              if (iVar3 == 2) {
                *(undefined4 *)(param_2 + 0xac) = 1;
              }
              else {
                iVar3 = CompareStringW(0x7f,0,local_8,-1,L"netfx4",-1);
                if (iVar3 == 2) {
                  *(undefined4 *)(param_2 + 0xac) = 2;
                }
                else {
                  iVar3 = CompareStringW(0x7f,0,local_8,-1,L"none",-1);
                  if (iVar3 != 2) {
LAB_00419f8d:
                    pcVar5 = "Invalid exit code type: %ls";
                    uVar2 = 0x8000ffff;
LAB_00419f74:
                    FUN_00430a57(uVar2,pcVar5);
                    goto LAB_00419f3a;
                  }
                  *(undefined4 *)(param_2 + 0xac) = 0;
                }
              }
            }
            uVar2 = FUN_00435fbe(param_1,L"ExitCode",(int)&local_14);
            if ((int)uVar2 < 0) {
              pcVar5 = "Failed to select exit code nodes.";
            }
            else {
              uVar2 = (**(code **)(*local_14 + 0x20))(local_14,&local_10);
              if (-1 < (int)uVar2) {
                if (local_10 != 0) {
                  iVar3 = FUN_00431078(local_10 * 0xc,1);
                  *(int *)(param_2 + 0xb0) = iVar3;
                  if (iVar3 == 0) {
                    uVar2 = 0x8007000e;
                    FUN_004300d9();
                    pcVar5 = "Failed to allocate memory for exit code structs.";
                    goto LAB_00419f83;
                  }
                  param_2 = 0;
                  *(uint *)(uVar1 + 0xb4) = local_10;
                  if (local_10 != 0) {
                    param_1 = (int *)0x0;
                    do {
                      puVar4 = (undefined4 *)(*(int *)(uVar1 + 0xb0) + (int)param_1);
                      uVar2 = FUN_00435f1d(local_14,&local_c,(undefined4 *)0x0);
                      if ((int)uVar2 < 0) {
                        pcVar5 = "Failed to get next node.";
                        goto LAB_00419f83;
                      }
                      uVar2 = FUN_00435b5e(local_c,L"Type",(int *)&local_8);
                      if ((int)uVar2 < 0) {
                        pcVar5 = "Failed to get @Type.";
                        goto LAB_00419f83;
                      }
                      iVar3 = CompareStringW(0x7f,0,local_8,-1,L"success",-1);
                      if (iVar3 == 2) {
                        *puVar4 = 1;
                      }
                      else {
                        iVar3 = CompareStringW(0x7f,0,local_8,-1,L"error",-1);
                        if (iVar3 == 2) {
                          *puVar4 = 2;
                        }
                        else {
                          iVar3 = CompareStringW(0x7f,0,local_8,-1,L"scheduleReboot",-1);
                          if (iVar3 == 2) {
                            *puVar4 = 3;
                          }
                          else {
                            iVar3 = CompareStringW(0x7f,0,local_8,-1,L"forceReboot",-1);
                            if (iVar3 != 2) goto LAB_00419f8d;
                            *puVar4 = 4;
                          }
                        }
                      }
                      uVar2 = FUN_00435b5e(local_c,L"Code",(int *)&local_8);
                      if ((int)uVar2 < 0) {
                        pcVar5 = "Failed to get @Code.";
                        goto LAB_00419f83;
                      }
                      if (*local_8 == L'*') {
                        puVar4[2] = 1;
                      }
                      else {
                        uVar2 = FUN_004346e9(local_8,0,puVar4 + 1);
                        if ((int)uVar2 < 0) {
                          pcVar5 = "Failed to parse @Code value: %ls";
                          goto LAB_00419f74;
                        }
                      }
                      if (local_c != (int *)0x0) {
                        (**(code **)(*local_c + 8))(local_c);
                        local_c = (int *)0x0;
                      }
                      param_2 = param_2 + 1;
                      param_1 = param_1 + 3;
                    } while (param_2 < local_10);
                  }
                }
                uVar2 = 0;
                goto LAB_00419f3a;
              }
              pcVar5 = "Failed to get exit code node count.";
            }
          }
          else {
            pcVar5 = "Failed to get @Repairable.";
          }
        }
      }
    }
  }
LAB_00419f83:
  FUN_00430a57(uVar2,pcVar5);
LAB_00419f3a:
  if (local_14 != (int *)0x0) {
    (**(code **)(*local_14 + 8))(local_14);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar2;
}



/* Function: FUN_00419fad */

int FUN_00419fad(uint *param_1,int param_2,int *param_3,undefined4 param_4,
                LPCRITICAL_SECTION param_5,int param_6,int param_7)

{
  int iVar1;
  char *pcVar2;
  undefined4 *local_8;
  
  local_8 = (undefined4 *)0x0;
  if ((param_6 != 0) && (iVar1 = FUN_0040cb9c((int)param_3,param_2,param_6,param_7), iVar1 < 0)) {
    pcVar2 = "Failed to plan package cache syncpoint";
    goto LAB_0041a0f1;
  }
  iVar1 = FUN_0041ed32(param_1,param_2,(int)param_3);
  if (iVar1 < 0) {
    pcVar2 = "Failed to plan package dependency actions.";
    goto LAB_0041a0f1;
  }
  if (*(int *)(param_2 + 0x5c) == 0) {
LAB_0041a098:
    if (*(int *)(param_2 + 0x60) == 0) {
      return iVar1;
    }
    iVar1 = FUN_0040c9c2((int)param_3,(int *)&local_8);
    if (iVar1 < 0) {
      pcVar2 = "Failed to append rollback action.";
      goto LAB_0041a0f1;
    }
    *local_8 = 4;
    local_8[2] = param_2;
    local_8[4] = *(undefined4 *)(param_2 + 0x60);
    if ((*(LPCWSTR *)(param_2 + 0xa0) == (LPCWSTR)0x0) ||
       (iVar1 = FUN_00433f88(local_8 + 5,*(LPCWSTR *)(param_2 + 0xa0),0), -1 < iVar1)) {
      FUN_0040e915(param_2,0,1,param_4,param_5,(int *)0x0);
      return iVar1;
    }
  }
  else {
    if (param_1 == (uint *)0x0) {
      iVar1 = FUN_0040c979((int)param_3,(int *)&local_8);
      if (iVar1 < 0) {
        pcVar2 = "Failed to append execute action.";
        goto LAB_0041a0f1;
      }
    }
    else {
      iVar1 = FUN_0040cef6(*param_1,(int)param_3,(int *)&local_8);
      if (iVar1 < 0) {
        pcVar2 = "Failed to insert execute action.";
        goto LAB_0041a0f1;
      }
    }
    *local_8 = 4;
    local_8[2] = param_2;
    local_8[3] = (uint)(*param_3 == 7);
    local_8[4] = *(undefined4 *)(param_2 + 0x5c);
    if ((*(LPCWSTR *)(param_2 + 0xa0) == (LPCWSTR)0x0) ||
       (iVar1 = FUN_00433f88(local_8 + 5,*(LPCWSTR *)(param_2 + 0xa0),0), -1 < iVar1)) {
      FUN_0040e915(param_2,0,0,param_4,param_5,(int *)0x0);
      goto LAB_0041a098;
    }
  }
  pcVar2 = "Failed to allocate the list of dependencies to ignore.";
LAB_0041a0f1:
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0041a116 */

undefined4 FUN_0041a116(int param_1)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  
  iVar4 = *(int *)(param_1 + 0x40);
  uVar3 = 0;
  if (iVar4 == 2) {
    iVar1 = *(int *)(param_1 + 0x50);
    if ((iVar1 == 1) || (iVar1 == 2)) {
      uVar2 = 0;
      goto LAB_0041a1bc;
    }
    if ((iVar1 != 4) && (iVar1 != 5)) {
LAB_0041a16f:
      uVar2 = 0;
      goto LAB_0041a21c;
    }
    uVar2 = 2;
  }
  else {
    if (iVar4 != 4) {
      FUN_004300d9();
      FUN_00430a57(0x80070057,"Invalid package current state: %d.");
      return 0x80070057;
    }
    iVar1 = *(int *)(param_1 + 0x50);
    if (iVar1 == 1) {
      uVar2 = 1;
    }
    else if (iVar1 == 2) {
      uVar2 = (uint)(*(int *)(param_1 + 0x18) != 0);
    }
    else if (iVar1 == 4) {
      uVar2 = -(uint)(*(int *)(param_1 + 0xa4) != 0) & 2;
    }
    else {
      if (iVar1 != 5) goto LAB_0041a16f;
      uVar2 = -(uint)(*(int *)(param_1 + 0xa8) != 0) & 5;
    }
LAB_0041a1bc:
    if (uVar2 == 0) goto LAB_0041a21c;
  }
  if (*(int *)(param_1 + 0x48) != 0) {
    iVar4 = *(int *)(param_1 + 0x48);
  }
  if (iVar4 == 2) {
    if (((iVar1 != 1) && (iVar1 != 2)) && ((iVar1 == 4 || (iVar1 == 5)))) {
      uVar3 = (uint)(*(int *)(param_1 + 0x18) != 0);
    }
  }
  else {
    if (iVar4 != 4) {
      FUN_004300d9();
      FUN_00430a57(0x80070057,"Invalid package expected state.");
      return 0x80070057;
    }
    if ((iVar1 == 1) || (iVar1 == 2)) {
      uVar3 = 2;
    }
  }
LAB_0041a21c:
  *(uint *)(param_1 + 0x5c) = uVar2;
  *(uint *)(param_1 + 0x60) = uVar3;
  return 0;
}



/* Function: FUN_0041a22b */

undefined4 FUN_0041a22b(int param_1,int param_2,int param_3,int *param_4,undefined4 *param_5)

{
  *param_4 = 0;
  if (param_2 == 0) {
    *param_4 = 0;
  }
  else if (param_2 == 1) {
    if (param_1 != 1) {
      *param_4 = 6;
    }
  }
  else {
    if (param_2 == 2) {
      if (param_1 != 2) {
        *param_4 = 5;
        goto LAB_0041a2bd;
      }
    }
    else {
      if (param_2 != 3) {
        if (param_2 != 4) {
          FUN_004300d9();
          FUN_00430a57(0x8000ffff,"Invalid state value.");
          return 0x8000ffff;
        }
        if (param_1 == 4) {
          if (param_3 != 0) {
            *param_4 = 4;
          }
        }
        else {
          *param_4 = 2;
        }
        goto LAB_0041a2bd;
      }
      if (param_1 != 3) {
        *param_4 = 1;
        goto LAB_0041a2bd;
      }
    }
    if (param_3 != 0) {
      *param_4 = 4;
    }
  }
LAB_0041a2bd:
  if (*param_4 != 0) {
    *param_5 = 1;
  }
  return 0;
}



/* Function: FUN_0041a2cd */

int FUN_0041a2cd(int param_1,int param_2,int *param_3)

{
  int iVar1;
  int iVar2;
  LPVOID *ppvVar3;
  uint uVar4;
  int iVar5;
  char *pcVar6;
  int local_24;
  LPVOID local_20;
  LPVOID local_1c;
  LPVOID local_18;
  LPVOID local_14;
  LPVOID local_10;
  LPVOID local_c;
  short *local_8;
  
  iVar5 = 0;
  local_8 = (short *)0x0;
  local_c = (LPVOID)0x0;
  local_10 = (LPVOID)0x0;
  local_14 = (LPVOID)0x0;
  local_18 = (LPVOID)0x0;
  local_1c = (LPVOID)0x0;
  local_20 = (LPVOID)0x0;
  uVar4 = 0;
  if (*(int *)(param_1 + 0xb8) == 0) {
    return 0;
  }
  local_24 = 0;
  do {
    iVar1 = *(int *)(param_1 + 0xb4);
    iVar2 = *(int *)(param_2 + uVar4 * 4);
    if (iVar2 == 1) {
      if ((local_c != (LPVOID)0x0) &&
         (iVar5 = FUN_00433c35((int *)&local_c,(short *)&DAT_0044a0c8,0), iVar5 < 0)) {
LAB_0041a433:
        pcVar6 = "Failed to concat separator.";
        goto LAB_0041a5b7;
      }
      ppvVar3 = &local_c;
LAB_0041a407:
      iVar5 = FUN_00433c35((int *)ppvVar3,*(short **)(iVar1 + local_24),0);
      if (iVar5 < 0) {
        pcVar6 = "Failed to concat feature.";
        goto LAB_0041a5b7;
      }
    }
    else {
      if (iVar2 == 2) {
        if ((local_10 != (LPVOID)0x0) &&
           (iVar5 = FUN_00433c35((int *)&local_10,(short *)&DAT_0044a0c8,0), iVar5 < 0))
        goto LAB_0041a433;
        ppvVar3 = &local_10;
        goto LAB_0041a407;
      }
      if (iVar2 == 3) {
        if ((local_14 != (LPVOID)0x0) &&
           (iVar5 = FUN_00433c35((int *)&local_14,(short *)&DAT_0044a0c8,0), iVar5 < 0))
        goto LAB_0041a433;
        ppvVar3 = &local_14;
        goto LAB_0041a407;
      }
      if (iVar2 == 4) {
        if ((local_18 != (LPVOID)0x0) &&
           (iVar5 = FUN_00433c35((int *)&local_18,(short *)&DAT_0044a0c8,0), iVar5 < 0))
        goto LAB_0041a433;
        ppvVar3 = &local_18;
        goto LAB_0041a407;
      }
      if (iVar2 == 5) {
        if ((local_1c != (LPVOID)0x0) &&
           (iVar5 = FUN_00433c35((int *)&local_1c,(short *)&DAT_0044a0c8,0), iVar5 < 0))
        goto LAB_0041a433;
        ppvVar3 = &local_1c;
        goto LAB_0041a407;
      }
      if (iVar2 == 6) {
        if ((local_20 != (LPVOID)0x0) &&
           (iVar5 = FUN_00433c35((int *)&local_20,(short *)&DAT_0044a0c8,0), iVar5 < 0))
        goto LAB_0041a433;
        ppvVar3 = &local_20;
        goto LAB_0041a407;
      }
    }
    local_24 = local_24 + 0x28;
    uVar4 = uVar4 + 1;
  } while (uVar4 < *(uint *)(param_1 + 0xb8));
  if (local_c == (LPVOID)0x0) {
LAB_0041a489:
    if (local_10 != (LPVOID)0x0) {
      iVar5 = FUN_00433cea((int *)&local_8,L" ADDSOURCE=\"%s\"");
      if (iVar5 < 0) {
        pcVar6 = "Failed to format ADDSOURCE string.";
        goto LAB_0041a5b7;
      }
      iVar5 = FUN_00433c35(param_3,local_8,0);
      if (iVar5 < 0) goto LAB_0041a47d;
    }
    if (local_14 != (LPVOID)0x0) {
      iVar5 = FUN_00433cea((int *)&local_8,L" ADDDEFAULT=\"%s\"");
      if (iVar5 < 0) {
        pcVar6 = "Failed to format ADDDEFAULT string.";
        goto LAB_0041a5b7;
      }
      iVar5 = FUN_00433c35(param_3,local_8,0);
      if (iVar5 < 0) goto LAB_0041a47d;
    }
    if (local_18 != (LPVOID)0x0) {
      iVar5 = FUN_00433cea((int *)&local_8,L" REINSTALL=\"%s\"");
      if (iVar5 < 0) {
        pcVar6 = "Failed to format REINSTALL string.";
        goto LAB_0041a5b7;
      }
      iVar5 = FUN_00433c35(param_3,local_8,0);
      if (iVar5 < 0) goto LAB_0041a47d;
    }
    if (local_1c != (LPVOID)0x0) {
      iVar5 = FUN_00433cea((int *)&local_8,L" ADVERTISE=\"%s\"");
      if (iVar5 < 0) {
        pcVar6 = "Failed to format ADVERTISE string.";
        goto LAB_0041a5b7;
      }
      iVar5 = FUN_00433c35(param_3,local_8,0);
      if (iVar5 < 0) goto LAB_0041a47d;
    }
    if (local_20 == (LPVOID)0x0) goto LAB_0041a5bf;
    iVar5 = FUN_00433cea((int *)&local_8,L" REMOVE=\"%s\"");
    if (-1 < iVar5) {
      iVar5 = FUN_00433c35(param_3,local_8,0);
      if (-1 < iVar5) goto LAB_0041a5bf;
      goto LAB_0041a47d;
    }
    pcVar6 = "Failed to format REMOVE string.";
  }
  else {
    iVar5 = FUN_00433cea((int *)&local_8,L" ADDLOCAL=\"%s\"");
    if (iVar5 < 0) {
      pcVar6 = "Failed to format ADDLOCAL string.";
    }
    else {
      iVar5 = FUN_00433c35(param_3,local_8,0);
      if (-1 < iVar5) goto LAB_0041a489;
LAB_0041a47d:
      pcVar6 = "Failed to concat argument string.";
    }
  }
LAB_0041a5b7:
  FUN_00430a57(iVar5,pcVar6);
LAB_0041a5bf:
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_14 != (LPVOID)0x0) {
    FUN_004380ab(local_14);
  }
  if (local_18 != (LPVOID)0x0) {
    FUN_004380ab(local_18);
  }
  if (local_1c != (LPVOID)0x0) {
    FUN_004380ab(local_1c);
  }
  if (local_20 != (LPVOID)0x0) {
    FUN_004380ab(local_20);
  }
  return iVar5;
}



/* Function: FUN_0041a624 */

int FUN_0041a624(int param_1,int param_2,int *param_3)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  char *pcVar4;
  LPCWSTR local_10;
  short *local_c;
  short *local_8;
  
  iVar2 = 0;
  local_10 = (LPCWSTR)0x0;
  local_c = (short *)0x0;
  local_8 = (short *)0x0;
  if (param_2 == 0) {
    return 0;
  }
  uVar3 = 0;
  if (*(int *)(param_1 + 0xcc) == 0) {
    return 0;
  }
  do {
    iVar1 = *(int *)(*(int *)(param_1 + 0xc4) + uVar3 * 4);
    if (1 < *(int *)(param_2 + uVar3 * 4)) {
      iVar2 = FUN_00413be9(*(int *)(iVar1 + 0x14),*(undefined4 *)(iVar1 + 0x24),(int *)&local_10);
      if (iVar2 < 0) {
        FUN_00430a57(iVar2,"Failed to get cached path for MSP package: %ls");
        goto LAB_0041a768;
      }
      iVar2 = FUN_004314a9(local_10,*(LPCWSTR *)(**(int **)(iVar1 + 0x7c) + 0x18),(int *)&local_c);
      if (iVar2 < 0) {
        pcVar4 = "Failed to build MSP path.";
        goto LAB_0041a760;
      }
      if (local_8 == (short *)0x0) {
        iVar2 = FUN_00433c35((int *)&local_8,L" PATCH=\"",0);
        if (iVar2 < 0) {
          pcVar4 = "Failed to prefix with PATCH property.";
          goto LAB_0041a760;
        }
      }
      else {
        iVar2 = FUN_00433c35((int *)&local_8,(short *)&DAT_0044a344,0);
        if (iVar2 < 0) {
          pcVar4 = "Failed to semi-colon delimit patches.";
          goto LAB_0041a760;
        }
      }
      iVar2 = FUN_00433c35((int *)&local_8,local_c,0);
      if (iVar2 < 0) {
        pcVar4 = "Failed to append patch path.";
        goto LAB_0041a760;
      }
    }
    uVar3 = uVar3 + 1;
  } while (uVar3 < *(uint *)(param_1 + 0xcc));
  if (local_8 != (short *)0x0) {
    iVar2 = FUN_00433c35((int *)&local_8,(short *)&DAT_0044a390,0);
    if (iVar2 < 0) {
      pcVar4 = "Failed to close the quoted PATCH property.";
    }
    else {
      iVar2 = FUN_00433c35(param_3,local_8,0);
      if (-1 < iVar2) goto LAB_0041a768;
      pcVar4 = "Failed to append PATCH property.";
    }
LAB_0041a760:
    FUN_00430a57(iVar2,pcVar4);
  }
LAB_0041a768:
  if (local_c != (short *)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar2;
}



/* Function: FUN_0041a79b */

int FUN_0041a79b(short *param_1,int *param_2)

{
  short sVar1;
  short *psVar2;
  int iVar3;
  int iVar4;
  
  iVar4 = 0;
  iVar3 = 0;
  sVar1 = *param_1;
  psVar2 = param_1;
  while (sVar1 != 0) {
    iVar4 = iVar4 + 1;
    if (sVar1 == 0x22) {
      iVar3 = iVar3 + 1;
    }
    psVar2 = psVar2 + 1;
    sVar1 = *psVar2;
  }
  iVar3 = FUN_00433bdf(param_2,iVar4 + 1 + iVar3);
  if (iVar3 < 0) {
    FUN_00430a57(iVar3,"Failed to allocate string buffer.");
  }
  else {
    psVar2 = (short *)*param_2;
    sVar1 = *param_1;
    while (sVar1 != 0) {
      sVar1 = *param_1;
      *psVar2 = sVar1;
      if (sVar1 == 0x22) {
        psVar2 = psVar2 + 1;
        *psVar2 = 0x22;
      }
      param_1 = param_1 + 1;
      psVar2 = psVar2 + 1;
      sVar1 = *param_1;
    }
    *psVar2 = 0;
  }
  return iVar3;
}



/* Function: FUN_0041a820 */

DWORD FUN_0041a820(uint param_1,int param_2,int param_3,int param_4,undefined4 *param_5)

{
  DWORD DVar1;
  char *pcVar2;
  uint local_8;
  
  local_8 = 0;
  if (param_2 == 0) {
    if (param_3 != 0) {
LAB_0041a87b:
      DVar1 = FUN_00405961(param_1,param_3,&local_8);
      if ((int)DVar1 < 0) {
        pcVar2 = "Failed to evaluate add source condition.";
        goto LAB_0041a8c5;
      }
      if (local_8 != 0) {
        *param_5 = 4;
        return DVar1;
      }
      goto LAB_0041a8a6;
    }
    if (param_4 == 0) {
      *param_5 = 0;
      return 0;
    }
  }
  else {
    DVar1 = FUN_00405961(param_1,param_2,&local_8);
    if ((int)DVar1 < 0) {
      pcVar2 = "Failed to evaluate add local condition.";
      goto LAB_0041a8c5;
    }
    if (local_8 != 0) {
      *param_5 = 3;
      return DVar1;
    }
    if (param_3 != 0) goto LAB_0041a87b;
LAB_0041a8a6:
    if (param_4 == 0) goto LAB_0041a8e0;
  }
  DVar1 = FUN_00405961(param_1,param_4,&local_8);
  if ((int)DVar1 < 0) {
    pcVar2 = "Failed to evaluate advertise condition.";
LAB_0041a8c5:
    FUN_00430a57(DVar1,pcVar2);
    return DVar1;
  }
  if (local_8 != 0) {
    *param_5 = 2;
    return DVar1;
  }
LAB_0041a8e0:
  *param_5 = 1;
  return DVar1;
}



/* Function: FUN_0041a8f0 */

uint FUN_0041a8f0(int *param_1,int *param_2)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  char *pcVar4;
  int *local_14;
  int *local_10;
  uint local_c;
  LPCWSTR local_8;
  
  local_14 = (int *)0x0;
  local_10 = (int *)0x0;
  local_c = 0;
  local_8 = (LPCWSTR)0x0;
  uVar1 = FUN_00435b5e(param_1,&DAT_0043c524,param_2);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to get @Id.";
  }
  else {
    uVar1 = FUN_00435b5e(param_1,L"MinVersion",(int *)&local_8);
    if (uVar1 == 0x80070490) {
LAB_0041a994:
      uVar1 = FUN_00435b5e(param_1,L"MaxVersion",(int *)&local_8);
      if (uVar1 == 0x80070490) {
LAB_0041aa0b:
        uVar1 = FUN_00435d6c(param_1,L"OnlyDetect",(uint *)(param_2 + 10));
        if ((int)uVar1 < 0) {
          pcVar4 = "Failed to get @OnlyDetect.";
        }
        else {
          uVar1 = FUN_00435fbe(param_1,L"Language",(int)&local_14);
          if ((int)uVar1 < 0) {
            pcVar4 = "Failed to select language nodes.";
          }
          else {
            uVar1 = (**(code **)(*local_14 + 0x20))(local_14,&local_c);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to get language node count.";
            }
            else {
              if (local_c == 0) {
LAB_0041ab14:
                uVar1 = 0;
                goto LAB_0041ab16;
              }
              uVar1 = FUN_00435d6c(param_1,L"LangInclusive",(uint *)(param_2 + 0xb));
              if ((int)uVar1 < 0) {
                pcVar4 = "Failed to get @LangInclusive.";
              }
              else {
                iVar2 = FUN_00431078(local_c << 2,1);
                param_2[0xc] = iVar2;
                if (iVar2 != 0) {
                  uVar3 = 0;
                  param_2[0xd] = local_c;
                  if (local_c != 0) {
                    do {
                      uVar1 = FUN_00435f1d(local_14,&local_10,(undefined4 *)0x0);
                      if ((int)uVar1 < 0) {
                        pcVar4 = "Failed to get next node.";
                        goto LAB_0041ab4c;
                      }
                      uVar1 = FUN_00435c9d(local_10,&DAT_0043c524,
                                           (ulong *)(param_2[0xc] + uVar3 * 4));
                      if ((int)uVar1 < 0) {
                        pcVar4 = "Failed to get Language/@Id.";
                        goto LAB_0041ab4c;
                      }
                      if (local_10 != (int *)0x0) {
                        (**(code **)(*local_10 + 8))(local_10);
                        local_10 = (int *)0x0;
                      }
                      uVar3 = uVar3 + 1;
                    } while (uVar3 < local_c);
                  }
                  goto LAB_0041ab14;
                }
                uVar1 = 0x8007000e;
                FUN_004300d9();
                pcVar4 = "Failed to allocate memory for language IDs.";
              }
            }
          }
        }
      }
      else if ((int)uVar1 < 0) {
        pcVar4 = "Failed to get @MaxVersion.";
      }
      else {
        uVar1 = FUN_0043720f(local_8,0,(uint *)(param_2 + 4));
        if ((int)uVar1 < 0) {
          pcVar4 = "Failed to parse @MaxVersion: %ls";
          goto LAB_0041a9d7;
        }
        param_2[7] = 1;
        uVar1 = FUN_00435d6c(param_1,L"MaxInclusive",(uint *)(param_2 + 9));
        if (-1 < (int)uVar1) goto LAB_0041aa0b;
        pcVar4 = "Failed to get @MaxInclusive.";
      }
    }
    else if ((int)uVar1 < 0) {
      pcVar4 = "Failed to get @MinVersion.";
    }
    else {
      uVar1 = FUN_0043720f(local_8,0,(uint *)(param_2 + 2));
      if ((int)uVar1 < 0) {
        pcVar4 = "Failed to parse @MinVersion: %ls";
LAB_0041a9d7:
        FUN_00430a57(uVar1,pcVar4);
        goto LAB_0041ab16;
      }
      param_2[6] = 1;
      uVar1 = FUN_00435d6c(param_1,L"MinInclusive",(uint *)(param_2 + 8));
      if (-1 < (int)uVar1) goto LAB_0041a994;
      pcVar4 = "Failed to get @MinInclusive.";
    }
  }
LAB_0041ab4c:
  FUN_00430a57(uVar1,pcVar4);
LAB_0041ab16:
  if (local_14 != (int *)0x0) {
    (**(code **)(*local_14 + 8))(local_14);
  }
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_0041ab5d */

void FUN_0041ab5d(int param_1,LPCWSTR param_2)

{
  int iVar1;
  uint uVar2;
  undefined4 uVar3;
  LPVOID local_8;
  
  uVar3 = 2;
  if (*(int *)(param_1 + 0x14) != 0) {
    uVar3 = 4;
  }
  local_8 = (LPVOID)0x0;
  iVar1 = FUN_00431c88(param_2,(int *)&local_8);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to get directory for path: %ls");
  }
  else {
    uVar2 = FUN_004357bb(*(undefined4 *)(param_1 + 0x90),0,uVar3,0,local_8,1);
    if ((int)uVar2 < 0) {
      FUN_00402003(3,0xa0000163);
    }
  }
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return;
}



/* Function: FUN_0041abe0 */

undefined4 FUN_0041abe0(int param_1,int param_2,int param_3)

{
  undefined4 uStack_8;
  
  uStack_8 = 0x102;
  if (((param_1 != 0) && (param_3 != 1)) && (param_3 != 5)) {
    if (param_2 == 3) {
      uStack_8 = 4;
    }
    else if (param_2 == 4) {
      uStack_8 = 5;
    }
  }
  return uStack_8;
}



/* Function: FUN_0041ac12 */

int FUN_0041ac12(int param_1,uint param_2,LPCRITICAL_SECTION param_3,int param_4,int *param_5,
                int param_6)

{
  LPCWSTR pWVar1;
  uint uVar2;
  int iVar3;
  int *piVar4;
  char *pcVar5;
  short *local_10;
  LPVOID local_c;
  short *local_8;
  
  iVar3 = 0;
  local_8 = (short *)0x0;
  local_c = (LPVOID)0x0;
  local_10 = (short *)0x0;
  uVar2 = 0;
  if (param_2 != 0) {
    piVar4 = (int *)(param_1 + 8);
    do {
      if (param_6 == 0) {
        if ((param_4 == 0) || (pWVar1 = (LPCWSTR)*piVar4, pWVar1 == (LPCWSTR)0x0)) {
          pWVar1 = (LPCWSTR)piVar4[-1];
        }
        iVar3 = FUN_00403a92(param_3,pWVar1,(int *)&local_8,(uint *)0x0);
      }
      else {
        if ((param_4 == 0) || (pWVar1 = (LPCWSTR)*piVar4, pWVar1 == (LPCWSTR)0x0)) {
          pWVar1 = (LPCWSTR)piVar4[-1];
        }
        iVar3 = FUN_00403aac(param_3,pWVar1,(int *)&local_8,(uint *)0x0);
      }
      if (iVar3 < 0) {
        pcVar5 = "Failed to format property value.";
LAB_0041acef:
        FUN_00430a57(iVar3,pcVar5);
        break;
      }
      iVar3 = FUN_0041a79b(local_8,(int *)&local_c);
      if (iVar3 < 0) {
        pcVar5 = "Failed to escape string.";
        goto LAB_0041acef;
      }
      iVar3 = FUN_00433cea((int *)&local_10,L" %s%=\"%s\"");
      if (iVar3 < 0) {
        pcVar5 = "Failed to format property string part.";
        goto LAB_0041acef;
      }
      iVar3 = FUN_00433c35(param_5,local_10,0);
      if (iVar3 < 0) {
        pcVar5 = "Failed to append property string part.";
        goto LAB_0041acef;
      }
      uVar2 = uVar2 + 1;
      piVar4 = piVar4 + 3;
    } while (uVar2 < param_2);
    if (local_8 != (short *)0x0) {
      FUN_004380ab(local_8);
    }
    if (local_c != (LPVOID)0x0) {
      FUN_004380ab(local_c);
    }
    if (local_10 != (short *)0x0) {
      FUN_004380ab(local_10);
    }
  }
  return iVar3;
}



/* Function: FUN_0041ad2a */

void FUN_0041ad2a(undefined4 *param_1,int param_2)

{
  bool bVar1;
  uint uVar2;
  int iVar3;
  undefined4 uVar4;
  int *piVar5;
  int iVar6;
  undefined4 *puVar7;
  uint uVar8;
  char *pcVar9;
  int local_88;
  uint local_84 [5];
  undefined4 *local_70;
  LPCWSTR local_6c;
  int local_68;
  undefined4 *local_64;
  int local_60;
  LPCWSTR local_5c;
  WCHAR local_58 [40];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_84[3] = -1;
  uVar8 = 0;
  local_68 = param_2;
  local_5c = (LPCWSTR)0x0;
  local_6c = (LPCWSTR)0x0;
  local_60 = 0;
  FUN_004267c0((uint *)local_58,0,0x4e);
  uVar4 = 2;
  if (param_1[5] != 0) {
    uVar4 = 4;
  }
  local_84[0] = 0;
  local_84[1] = 0;
  local_84[2] = 0;
  uVar2 = FUN_00435361(param_1[0x24],0,uVar4,L"VersionString",(int *)&local_5c);
  if ((int)uVar2 < 0) {
    if ((uVar2 != 0x80070645) && (uVar2 != 0x80070648)) {
      pcVar9 = "Failed to get product information for ProductCode: %ls";
LAB_0041b218:
      FUN_00430a57(uVar2,pcVar9);
      goto LAB_0041b2cb;
    }
    param_1[0x10] = 2;
  }
  else {
    iVar3 = FUN_0043720f(local_5c,0,param_1 + 0x28);
    if (iVar3 < 0) {
LAB_0041b1f9:
      FUN_00430a57(iVar3,"Failed to convert version: %ls to DWORD64 for ProductCode: %ls");
      goto LAB_0041b2cb;
    }
    uVar2 = param_1[0x29];
    if (uVar2 < (uint)param_1[0x27]) {
LAB_0041adfb:
      iVar3 = 2;
      local_60 = 2;
LAB_0041ae05:
      param_1[0x10] = 4;
      if (iVar3 == 0) goto LAB_0041aec3;
    }
    else {
      if ((uVar2 <= (uint)param_1[0x27]) && ((uint)param_1[0x28] <= (uint)param_1[0x26])) {
        if ((uVar2 <= (uint)param_1[0x27]) &&
           ((uVar2 < (uint)param_1[0x27] || ((uint)param_1[0x28] < (uint)param_1[0x26]))))
        goto LAB_0041adfb;
        iVar3 = 0;
        goto LAB_0041ae05;
      }
      iVar3 = 1;
      local_60 = 1;
      param_1[0x10] = 5;
    }
    FUN_0040e7d3(iVar3);
    FUN_0040ea3e();
    FUN_0040e7bb(param_1[5]);
    FUN_00402003(2,0x20000067);
    iVar3 = (**(code **)(**(int **)(local_68 + 0x10) + 0x30))
                      (*(int **)(local_68 + 0x10),*param_1,param_1[0x24],param_1[5],param_1[0x28],
                       param_1[0x29],local_60);
    uVar2 = FUN_00408843(local_68,1,iVar3);
    if ((int)uVar2 < 0) {
LAB_0041ae86:
      FUN_004300d9();
      pcVar9 = "UX aborted detect related MSI package.";
LAB_0041b2c3:
      FUN_00430a57(uVar2,pcVar9);
      goto LAB_0041b2cb;
    }
  }
LAB_0041aec3:
  local_84[4] = 0;
  if (param_1[0x30] != 0) {
    local_70 = (undefined4 *)0x0;
    do {
      local_64 = (undefined4 *)(param_1[0x2f] + (int)local_70);
      uVar4 = *local_64;
      local_88 = 0;
      while (uVar2 = FUN_004350ff(uVar4,local_88,local_58), uVar2 != 0x80070103) {
        if ((int)uVar2 < 0) {
          pcVar9 = "Failed to enum related products.";
          goto LAB_0041b2c3;
        }
        iVar3 = CompareStringW(0,1,(PCNZWCH)param_1[0x24],-1,local_58,-1);
        puVar7 = local_64;
        if (iVar3 == 2) goto LAB_0041b12c;
        uVar2 = FUN_00435361(local_58,0,2,L"VersionString",(int *)&local_5c);
        if ((uVar2 == 0x80070645) || (uVar2 == 0x80070648)) {
          uVar2 = FUN_00435361(local_58,0,4,L"VersionString",(int *)&local_5c);
          puVar7 = local_64;
          if ((uVar2 == 0x80070645) || (uVar2 == 0x80070648)) goto LAB_0041b12c;
          if ((int)uVar2 < 0) {
            pcVar9 = "Failed to get version for product in machine context: %ls";
            goto LAB_0041b218;
          }
          local_60 = 1;
        }
        else {
          if ((int)uVar2 < 0) {
            pcVar9 = "Failed to get version for product in user unmanaged context: %ls";
            goto LAB_0041b218;
          }
          local_60 = 0;
        }
        iVar3 = FUN_0043720f(local_5c,0,local_84);
        puVar7 = local_64;
        if (iVar3 < 0) goto LAB_0041b1f9;
        if (local_64[6] != 0) {
          if (local_64[8] == 0) {
            if (((uint)local_64[3] <= local_84[1]) &&
               (((uint)local_64[3] < local_84[1] || ((uint)local_64[2] < local_84[0]))))
            goto LAB_0041afe4;
          }
          else if (((uint)local_64[3] <= local_84[1]) &&
                  (((uint)local_64[3] < local_84[1] || ((uint)local_64[2] <= local_84[0]))))
          goto LAB_0041afe4;
          goto LAB_0041b12c;
        }
LAB_0041afe4:
        if (local_64[7] == 0) {
LAB_0041b018:
          local_84[2] = 0;
          if (local_64[0xd] == 0) {
LAB_0041b094:
            if (puVar7[10] == 0) {
              iVar3 = 3;
            }
            else if (param_1[0x10] == 2) {
              iVar3 = 1;
              param_1[0x10] = 1;
            }
            else {
              iVar3 = 0;
            }
            FUN_0040e7d3(iVar3);
            FUN_0040ea3e();
            FUN_0040e7bb(local_60);
            FUN_00402003(2,0x20000067);
            iVar3 = (**(code **)(**(int **)(local_68 + 0x10) + 0x30))
                              (*(int **)(local_68 + 0x10),*param_1,local_58,local_60,local_84[0],
                               local_84[1],iVar3);
            uVar2 = FUN_00408843(local_68,1,iVar3);
            puVar7 = local_64;
            if ((int)uVar2 < 0) goto LAB_0041ae86;
          }
          else {
            uVar4 = 2;
            if (local_60 != 0) {
              uVar4 = 4;
            }
            uVar2 = FUN_00435361(local_58,0,uVar4,L"Language",(int *)&local_6c);
            if (((int)uVar2 < 0) || (uVar2 = FUN_004346e9(local_6c,0,local_84 + 2), (int)uVar2 < 0))
            {
              FUN_004309f9(uVar2,0xe0000098,(LPCVOID)0x0);
            }
            else {
              uVar2 = 0;
              bVar1 = false;
              if (puVar7[0xd] != 0) {
                piVar5 = (int *)puVar7[0xc];
                do {
                  puVar7 = local_64;
                  if (local_84[2] == *piVar5) {
                    bVar1 = true;
                    break;
                  }
                  uVar2 = uVar2 + 1;
                  piVar5 = piVar5 + 1;
                } while (uVar2 < (uint)local_64[0xd]);
              }
              if (puVar7[0xb] != 0) {
                if (!bVar1) goto LAB_0041b12c;
                if (puVar7[0xb] != 0) goto LAB_0041b094;
              }
              if (!bVar1) goto LAB_0041b094;
            }
          }
        }
        else if (local_64[9] == 0) {
          if ((local_84[1] <= (uint)local_64[5]) &&
             ((local_84[1] < (uint)local_64[5] || (local_84[0] < (uint)local_64[4]))))
          goto LAB_0041b018;
        }
        else if ((local_84[1] <= (uint)local_64[5]) &&
                ((local_84[1] < (uint)local_64[5] || (local_84[0] <= (uint)local_64[4]))))
        goto LAB_0041b018;
LAB_0041b12c:
        local_88 = local_88 + 1;
        uVar4 = *puVar7;
      }
      local_84[4] = local_84[4] + 1;
      local_70 = local_70 + 0xe;
    } while (local_84[4] < (uint)param_1[0x30]);
  }
  if (param_1[0x2e] != 0) {
    local_84[4] = 0;
    do {
      local_70 = (undefined4 *)(param_1[0x2d] + local_84[4]);
      if ((int)param_1[0x10] < 4) {
        local_84[3] = 2;
      }
      else {
        uVar2 = FUN_0043572e(param_1[0x24],*local_70,(int *)(local_84 + 3));
        if ((int)uVar2 < 0) {
          pcVar9 = "Failed to query feature state.";
          goto LAB_0041b2c3;
        }
        if (local_84[3] == -1) {
          local_84[3] = 2;
        }
      }
      iVar3 = local_68;
      if (local_84[3] == 1) {
        local_70[7] = 2;
      }
      else if (local_84[3] == 2) {
        local_70[7] = 1;
      }
      else if (local_84[3] == 3) {
        local_70[7] = 3;
      }
      else {
        if (local_84[3] != 4) {
          uVar2 = 0x8000ffff;
          FUN_004300d9();
          pcVar9 = "Invalid state value.";
          goto LAB_0041b2c3;
        }
        local_70[7] = 4;
      }
      iVar6 = (**(code **)(**(int **)(local_68 + 0x10) + 0x38))
                        (*(int **)(local_68 + 0x10),*param_1,*local_70,local_70[7]);
      uVar2 = FUN_00408843(iVar3,1,iVar6);
      if ((int)uVar2 < 0) {
        FUN_004300d9();
        pcVar9 = "UX aborted detect.";
        goto LAB_0041b2c3;
      }
      uVar8 = uVar8 + 1;
      local_84[4] = local_84[4] + 0x28;
    } while (uVar8 < (uint)param_1[0x2e]);
  }
LAB_0041b2cb:
  if (local_6c != (LPCWSTR)0x0) {
    FUN_004380ab(local_6c);
  }
  if (local_5c != (LPCWSTR)0x0) {
    FUN_004380ab(local_5c);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0041b2fa */

void FUN_0041b2fa(uint param_1,int param_2,LPCRITICAL_SECTION param_3,uint param_4,uint param_5,
                 uint param_6,undefined4 *param_7)

{
  short *psVar1;
  uint uVar2;
  undefined4 uVar3;
  int iVar4;
  char *pcVar5;
  LPCWSTR local_648;
  LPVOID local_644;
  int local_640;
  LPVOID local_63c;
  LPCWSTR local_638;
  LPVOID local_634;
  uint local_630 [394];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0(local_630,0,0x628);
  local_640 = 0;
  local_644 = (LPVOID)0x0;
  local_648 = (LPCWSTR)0x0;
  local_638 = (LPCWSTR)0x0;
  local_634 = (LPVOID)0x0;
  local_63c = (LPVOID)0x0;
  if (param_4 != 0) {
    if (*(int *)(param_2 + 0x18) == 1) {
      uVar3 = 2;
      if (*(int *)(*(int *)(param_2 + 8) + 0x14) != 0) {
        uVar3 = 4;
      }
      uVar2 = FUN_00435361(*(undefined4 *)(*(int *)(param_2 + 8) + 0x90),0,uVar3,L"VersionString",
                           (int *)&local_644);
      if ((int)uVar2 < 0) {
        iVar4 = 2;
LAB_0041b3c8:
        FUN_0040e76e(iVar4);
        FUN_0040e2bb(*(undefined4 *)(param_2 + 0x18));
        FUN_00402003(2,0x2000013e);
        goto LAB_0041b3ed;
      }
    }
    else if (*(int *)(param_2 + 0x18) == 2) {
      uVar3 = 2;
      if (*(int *)(*(int *)(param_2 + 8) + 0x14) != 0) {
        uVar3 = 4;
      }
      uVar2 = FUN_00435361(*(undefined4 *)(*(int *)(param_2 + 8) + 0x90),0,uVar3,L"VersionString",
                           (int *)&local_644);
      if (-1 < (int)uVar2) {
        iVar4 = 4;
        goto LAB_0041b3c8;
      }
    }
  }
  uVar3 = 0x1fdf;
  if ((*(byte *)(param_2 + 0x10) & 4) != 0) {
    uVar3 = 0x3fdf;
  }
  iVar4 = FUN_00413be9(*(int *)(*(int *)(param_2 + 8) + 0x14),
                       *(undefined4 *)(*(int *)(param_2 + 8) + 0x24),(int *)&local_648);
  if (iVar4 < 0) {
    FUN_00430a57(iVar4,"Failed to get cached path for package: %ls");
    goto LAB_0041b3ed;
  }
  uVar2 = FUN_004314a9(local_648,*(LPCWSTR *)(**(int **)(*(int *)(param_2 + 8) + 0x7c) + 0x18),
                       (int *)&local_638);
  if ((int)uVar2 < 0) {
    pcVar5 = "Failed to build MSI path.";
  }
  else {
    uVar2 = FUN_00435549(param_5,*(undefined4 *)(param_2 + 0x14),param_1,param_6,param_4,local_630);
    if ((int)uVar2 < 0) {
      pcVar5 = "Failed to initialize external UI handler.";
    }
    else {
      psVar1 = *(short **)(param_2 + 0xc);
      if (((psVar1 != (short *)0x0) && (*psVar1 != 0)) &&
         (uVar2 = FUN_00435046(uVar3,psVar1,0), (int)uVar2 < 0)) {
        FUN_00430a57(uVar2,"Failed to enable logging for package: %ls to: %ls");
        goto LAB_0041b3ed;
      }
      uVar2 = FUN_0041ac12(*(int *)(*(int *)(param_2 + 8) + 0xac),
                           *(uint *)(*(int *)(param_2 + 8) + 0xb0),param_3,param_4,(int *)&local_634
                           ,0);
      if ((int)uVar2 < 0) {
        pcVar5 = "Failed to add properties to argument string.";
      }
      else {
        uVar2 = FUN_0041ac12(*(int *)(*(int *)(param_2 + 8) + 0xac),
                             *(uint *)(*(int *)(param_2 + 8) + 0xb0),param_3,param_4,
                             (int *)&local_63c,1);
        if ((int)uVar2 < 0) {
          pcVar5 = "Failed to add obfuscated properties to argument string.";
        }
        else {
          uVar2 = FUN_0041a2cd(*(int *)(param_2 + 8),*(int *)(param_2 + 0x1c),(int *)&local_634);
          if ((int)uVar2 < 0) {
            pcVar5 = "Failed to add feature action properties to argument string.";
          }
          else {
            uVar2 = FUN_0041a2cd(*(int *)(param_2 + 8),*(int *)(param_2 + 0x1c),(int *)&local_63c);
            if ((int)uVar2 < 0) {
              pcVar5 = "Failed to add feature action properties to obfuscated argument string.";
            }
            else {
              uVar2 = FUN_0041a624(*(int *)(param_2 + 8),*(int *)(param_2 + 0x20),(int *)&local_634)
              ;
              if ((int)uVar2 < 0) {
                pcVar5 = "Failed to add patch properties to argument string.";
              }
              else {
                uVar2 = FUN_0041a624(*(int *)(param_2 + 8),*(int *)(param_2 + 0x20),
                                     (int *)&local_63c);
                if (-1 < (int)uVar2) {
                  FUN_0040e2bb(*(undefined4 *)(param_2 + 0x18));
                  FUN_0040e8fd(param_4);
                  FUN_00402003(2,0x2000012d);
                  iVar4 = *(int *)(param_2 + 0x18);
                  if (iVar4 == 1) {
                    uVar2 = FUN_00433c35((int *)&local_634,L" REBOOT=ReallySuppress",0);
                    if ((int)uVar2 < 0) {
                      pcVar5 = "Failed to add reboot suppression property on uninstall.";
                    }
                    else {
                      uVar2 = FUN_00433cea((int *)&local_634,L"%ls %ls=ALL");
                      if ((int)uVar2 < 0) {
                        pcVar5 = 
                        "Failed to add the list of dependencies to ignore to the properties.";
                      }
                      else {
                        uVar2 = FUN_00434f98(*(undefined4 *)(*(int *)(param_2 + 8) + 0x90),0,2,
                                             local_634,&local_640);
                        if (uVar2 == 0x80070645) {
                          FUN_00402003(2,0xa0000133);
                          uVar2 = 0;
                        }
                        if (-1 < (int)uVar2) goto LAB_0041b3ed;
                        pcVar5 = "Failed to uninstall MSI package.";
                      }
                    }
                    goto LAB_0041b918;
                  }
                  if (iVar4 == 2) {
LAB_0041b873:
                    uVar2 = FUN_00433c35((int *)&local_634,L" REBOOT=ReallySuppress",0);
                    if ((int)uVar2 < 0) {
                      pcVar5 = "Failed to add reboot suppression property on install.";
                    }
                    else {
                      uVar2 = FUN_00435621(local_638,local_634,&local_640);
                      if (-1 < (int)uVar2) {
LAB_0041b8ba:
                        FUN_0041ab5d(*(int *)(param_2 + 8),local_638);
                        goto LAB_0041b3ed;
                      }
                      pcVar5 = "Failed to install MSI package.";
                    }
                  }
                  else {
                    if (iVar4 == 3) {
                      uVar2 = FUN_00433c35((int *)&local_634,L" ACTION=ADMIN",0);
                      if ((int)uVar2 < 0) {
                        pcVar5 = "Failed to add ADMIN property on admin install.";
                        goto LAB_0041b918;
                      }
                      goto LAB_0041b873;
                    }
                    if ((iVar4 == 4) || (iVar4 == 5)) {
                      uVar2 = FUN_00433cea((int *)&local_634,
                                           L"%ls%ls REINSTALLMODE=\"cmus%ls\" REBOOT=ReallySuppress"
                                          );
                      if ((int)uVar2 < 0) {
                        pcVar5 = 
                        "Failed to add reinstall mode and reboot suppression properties on repair.";
                      }
                      else {
                        uVar2 = FUN_00433cea((int *)&local_634,L"%ls %ls=ALL");
                        if ((int)uVar2 < 0) {
                          pcVar5 = 
                          "Failed to add the list of dependencies to ignore to the properties.";
                        }
                        else {
                          uVar2 = FUN_00435621(local_638,local_634,&local_640);
                          if (-1 < (int)uVar2) goto LAB_0041b3ed;
                          pcVar5 = "Failed to run maintanance mode for MSI package.";
                        }
                      }
                      goto LAB_0041b532;
                    }
                    if (iVar4 != 6) {
                      if (iVar4 != 7) goto LAB_0041b3ed;
                      goto LAB_0041b873;
                    }
                    if ((*(int *)(*(int *)(param_2 + 8) + 0xb8) != 0) ||
                       (uVar2 = FUN_00433c35((int *)&local_634,L" REINSTALL=ALL",0), -1 < (int)uVar2
                       )) {
                      uVar2 = FUN_00433c35((int *)&local_634,
                                           L" REINSTALLMODE=\"vomus\" REBOOT=ReallySuppress",0);
                      if ((int)uVar2 < 0) {
                        pcVar5 = 
                        "Failed to add reinstall mode and reboot suppression properties on minor upgrade."
                        ;
                        goto LAB_0041b918;
                      }
                      uVar2 = FUN_00435621(local_638,local_634,&local_640);
                      if ((int)uVar2 < 0) {
                        pcVar5 = "Failed to perform minor upgrade of MSI package.";
                        goto LAB_0041b918;
                      }
                      goto LAB_0041b8ba;
                    }
                    pcVar5 = "Failed to add reinstall all property on minor upgrade.";
                  }
LAB_0041b918:
                  FUN_00430a57(uVar2,pcVar5);
                  goto LAB_0041b3ed;
                }
                pcVar5 = "Failed to add patch properties to obfuscated argument string.";
              }
            }
          }
        }
      }
    }
  }
LAB_0041b532:
  FUN_00430a57(uVar2,pcVar5);
LAB_0041b3ed:
  FUN_00435855(local_630);
  if (local_634 != (LPVOID)0x0) {
    FUN_004380ab(local_634);
  }
  if (local_63c != (LPVOID)0x0) {
    FUN_004380ab(local_63c);
  }
  if (local_638 != (LPCWSTR)0x0) {
    FUN_004380ab(local_638);
  }
  if (local_648 != (LPCWSTR)0x0) {
    FUN_004380ab(local_648);
  }
  if (local_644 != (LPVOID)0x0) {
    FUN_004380ab(local_644);
  }
  if (local_640 == 0) {
    *param_7 = 0;
  }
  else if (local_640 == 1) {
    *param_7 = 1;
  }
  else if (local_640 == 2) {
    *param_7 = 2;
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0041b99b */

void FUN_0041b99b(int param_1)

{
  int iVar1;
  undefined4 *puVar2;
  uint uVar3;
  int iVar4;
  int *piVar5;
  
  iVar1 = param_1;
  if (*(int *)(param_1 + 0x90) != 0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x90));
  }
  if (*(int *)(param_1 + 0xb4) != 0) {
    uVar3 = 0;
    if (*(int *)(param_1 + 0xb8) != 0) {
      param_1 = 0;
      do {
        piVar5 = (int *)(*(int *)(iVar1 + 0xb4) + param_1);
        if (*piVar5 != 0) {
          FUN_004380ab((LPVOID)*piVar5);
        }
        if (piVar5[1] != 0) {
          FUN_004380ab((LPVOID)piVar5[1]);
        }
        if (piVar5[2] != 0) {
          FUN_004380ab((LPVOID)piVar5[2]);
        }
        if (piVar5[3] != 0) {
          FUN_004380ab((LPVOID)piVar5[3]);
        }
        if (piVar5[4] != 0) {
          FUN_004380ab((LPVOID)piVar5[4]);
        }
        if (piVar5[5] != 0) {
          FUN_004380ab((LPVOID)piVar5[5]);
        }
        if (piVar5[6] != 0) {
          FUN_004380ab((LPVOID)piVar5[6]);
        }
        uVar3 = uVar3 + 1;
        param_1 = param_1 + 0x28;
      } while (uVar3 < *(uint *)(iVar1 + 0xb8));
    }
    FUN_00431137(*(LPVOID *)(iVar1 + 0xb4));
  }
  if (*(int *)(iVar1 + 0xac) != 0) {
    uVar3 = 0;
    if (*(int *)(iVar1 + 0xb0) != 0) {
      param_1 = 0;
      do {
        piVar5 = (int *)(*(int *)(iVar1 + 0xac) + param_1);
        if (*piVar5 != 0) {
          FUN_004380ab((LPVOID)*piVar5);
        }
        if (piVar5[1] != 0) {
          FUN_004380ab((LPVOID)piVar5[1]);
        }
        if (piVar5[2] != 0) {
          FUN_004380ab((LPVOID)piVar5[2]);
        }
        uVar3 = uVar3 + 1;
        param_1 = param_1 + 0xc;
      } while (uVar3 < *(uint *)(iVar1 + 0xb0));
    }
    FUN_00431137(*(LPVOID *)(iVar1 + 0xac));
  }
  if (*(int *)(iVar1 + 0xbc) != 0) {
    uVar3 = 0;
    if (*(int *)(iVar1 + 0xc0) != 0) {
      iVar4 = 0;
      do {
        puVar2 = (undefined4 *)(*(int *)(iVar1 + 0xbc) + iVar4);
        if ((LPVOID)*puVar2 != (LPVOID)0x0) {
          FUN_004380ab((LPVOID)*puVar2);
        }
        if (puVar2[0xc] != 0) {
          FUN_00431137((LPVOID)puVar2[0xc]);
        }
        uVar3 = uVar3 + 1;
        iVar4 = iVar4 + 0x38;
      } while (uVar3 < *(uint *)(iVar1 + 0xc0));
    }
    FUN_00431137(*(LPVOID *)(iVar1 + 0xbc));
  }
  if (*(int *)(iVar1 + 200) != 0) {
    uVar3 = 0;
    if (*(int *)(iVar1 + 0xcc) != 0) {
      do {
        if (*(int *)(*(int *)(iVar1 + 200) + uVar3 * 4) != 0) {
          FUN_004380ab(*(LPVOID *)(*(int *)(iVar1 + 200) + uVar3 * 4));
        }
        uVar3 = uVar3 + 1;
      } while (uVar3 < *(uint *)(iVar1 + 0xcc));
    }
    FUN_00431137(*(LPVOID *)(iVar1 + 200));
  }
  if (*(LPVOID *)(iVar1 + 0xc4) != (LPVOID)0x0) {
    FUN_00431137(*(LPVOID *)(iVar1 + 0xc4));
  }
  FUN_004267c0((uint *)(iVar1 + 0x90),0,0x40);
  return;
}



/* Function: FUN_0041bb77 */

uint FUN_0041bb77(int *param_1,int param_2)

{
  int iVar1;
  uint uVar2;
  int iVar3;
  int *piVar4;
  int *piVar5;
  char *pcVar6;
  int local_18;
  LPCWSTR local_14;
  int *local_10;
  int *local_c;
  int *local_8;
  
  iVar1 = param_2;
  piVar5 = param_1;
  local_c = (int *)0x0;
  local_8 = (int *)0x0;
  local_10 = (int *)0x0;
  local_14 = (LPCWSTR)0x0;
  uVar2 = FUN_00435b5e(param_1,L"ProductCode",(int *)(param_2 + 0x90));
  if ((int)uVar2 < 0) {
    pcVar6 = "Failed to get @ProductCode.";
  }
  else {
    uVar2 = FUN_00435c9d(param_1,L"Language",(ulong *)(param_2 + 0x94));
    if ((int)uVar2 < 0) {
      pcVar6 = "Failed to get @Language.";
    }
    else {
      uVar2 = FUN_00435b5e(param_1,L"Version",(int *)&local_14);
      if ((int)uVar2 < 0) {
        pcVar6 = "Failed to get @Version.";
      }
      else {
        uVar2 = FUN_0043720f(local_14,0,(uint *)(param_2 + 0x98));
        if ((int)uVar2 < 0) {
          FUN_00430a57(uVar2,"Failed to parse @Version: %ls");
          goto LAB_0041c0a5;
        }
        uVar2 = FUN_00435d6c(param_1,L"DisplayInternalUI",(uint *)(param_2 + 0xa8));
        if ((int)uVar2 < 0) {
          pcVar6 = "Failed to get @DisplayInternalUI.";
        }
        else {
          uVar2 = FUN_00435fbe(param_1,L"MsiFeature",(int)&local_c);
          if ((int)uVar2 < 0) {
            pcVar6 = "Failed to select feature nodes.";
          }
          else {
            uVar2 = (**(code **)(*local_c + 0x20))(local_c,&local_10);
            if ((int)uVar2 < 0) {
              pcVar6 = "Failed to get feature node count.";
            }
            else {
              if (local_10 != (int *)0x0) {
                iVar3 = FUN_00431078((int)local_10 * 0x28,1);
                *(int *)(param_2 + 0xb4) = iVar3;
                if (iVar3 != 0) {
                  param_1 = (int *)0x0;
                  *(int **)(param_2 + 0xb8) = local_10;
                  if (local_10 != (int *)0x0) {
                    local_18 = 0;
                    do {
                      piVar4 = (int *)(*(int *)(param_2 + 0xb4) + local_18);
                      uVar2 = FUN_00435f1d(local_c,&local_8,(undefined4 *)0x0);
                      if ((int)uVar2 < 0) goto LAB_0041bfad;
                      uVar2 = FUN_00435b5e(local_8,&DAT_0043c524,piVar4);
                      if ((int)uVar2 < 0) {
                        pcVar6 = "Failed to get @Id.";
                        goto LAB_0041c0dc;
                      }
                      uVar2 = FUN_00435b5e(local_8,L"AddLocalCondition",piVar4 + 1);
                      if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
                        pcVar6 = "Failed to get @AddLocalCondition.";
                        goto LAB_0041c0dc;
                      }
                      uVar2 = FUN_00435b5e(local_8,L"AddSourceCondition",piVar4 + 2);
                      if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
                        pcVar6 = "Failed to get @AddSourceCondition.";
                        goto LAB_0041c0dc;
                      }
                      uVar2 = FUN_00435b5e(local_8,L"AdvertiseCondition",piVar4 + 3);
                      if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
                        pcVar6 = "Failed to get @AdvertiseCondition.";
                        goto LAB_0041c0dc;
                      }
                      uVar2 = FUN_00435b5e(local_8,L"RollbackAddLocalCondition",piVar4 + 4);
                      if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
                        pcVar6 = "Failed to get @RollbackAddLocalCondition.";
                        goto LAB_0041c0dc;
                      }
                      uVar2 = FUN_00435b5e(local_8,L"RollbackAddSourceCondition",piVar4 + 5);
                      if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
                        pcVar6 = "Failed to get @RollbackAddSourceCondition.";
                        goto LAB_0041c0dc;
                      }
                      uVar2 = FUN_00435b5e(local_8,L"RollbackAdvertiseCondition",piVar4 + 6);
                      if ((uVar2 != 0x80070490) && ((int)uVar2 < 0)) {
                        pcVar6 = "Failed to get @RollbackAdvertiseCondition.";
                        goto LAB_0041c0dc;
                      }
                      if (local_8 != (int *)0x0) {
                        (**(code **)(*local_8 + 8))(local_8);
                        local_8 = (int *)0x0;
                      }
                      param_1 = (int *)((int)param_1 + 1);
                      local_18 = local_18 + 0x28;
                    } while (param_1 < local_10);
                  }
                  goto LAB_0041be25;
                }
                FUN_004300d9();
                pcVar6 = "Failed to allocate memory for MSI feature structs.";
                goto LAB_0041c046;
              }
LAB_0041be25:
              if (local_c != (int *)0x0) {
                (**(code **)(*local_c + 8))(local_c);
                local_c = (int *)0x0;
              }
              uVar2 = FUN_0041c0ec(piVar5,(int *)(param_2 + 0xac),(uint *)(param_2 + 0xb0));
              if ((int)uVar2 < 0) {
                pcVar6 = "Failed to parse properties from XML.";
              }
              else {
                uVar2 = FUN_00435fbe(piVar5,L"RelatedPackage",(int)&local_c);
                if ((int)uVar2 < 0) {
LAB_0041bf99:
                  pcVar6 = "Failed to select related MSI nodes.";
                }
                else {
                  uVar2 = (**(code **)(*local_c + 0x20))(local_c,&local_10);
                  if (-1 < (int)uVar2) {
                    if (local_10 != (int *)0x0) {
                      iVar3 = FUN_00431078((int)local_10 * 0x38,1);
                      *(int *)(param_2 + 0xbc) = iVar3;
                      if (iVar3 == 0) {
                        FUN_004300d9();
                        pcVar6 = "Failed to allocate memory for related MSI structs.";
                        goto LAB_0041c046;
                      }
                      param_1 = (int *)0x0;
                      *(int **)(param_2 + 0xc0) = local_10;
                      if (local_10 != (int *)0x0) {
                        param_2 = 0;
                        do {
                          uVar2 = FUN_00435f1d(local_c,&local_8,(undefined4 *)0x0);
                          if ((int)uVar2 < 0) goto LAB_0041bfad;
                          uVar2 = FUN_0041a8f0(local_8,(int *)(*(int *)(iVar1 + 0xbc) + param_2));
                          if ((int)uVar2 < 0) {
                            pcVar6 = "Failed to parse related MSI element.";
                            goto LAB_0041c0dc;
                          }
                          if (local_8 != (int *)0x0) {
                            (**(code **)(*local_8 + 8))(local_8);
                            local_8 = (int *)0x0;
                          }
                          param_2 = param_2 + 0x38;
                          param_1 = (int *)((int)param_1 + 1);
                        } while (param_1 < local_10);
                      }
                    }
                    if (local_c != (int *)0x0) {
                      (**(code **)(*local_c + 8))(local_c);
                      local_c = (int *)0x0;
                    }
                    uVar2 = FUN_00435fbe(piVar5,L"SlipstreamMsp",(int)&local_c);
                    if ((int)uVar2 < 0) goto LAB_0041bf99;
                    uVar2 = (**(code **)(*local_c + 0x20))(local_c,&local_10);
                    if (-1 < (int)uVar2) {
                      if (local_10 == (int *)0x0) {
LAB_0041c0a3:
                        uVar2 = 0;
                        goto LAB_0041c0a5;
                      }
                      iVar3 = FUN_00431078((int)local_10 << 2,1);
                      *(int *)(iVar1 + 0xc4) = iVar3;
                      if (iVar3 == 0) {
                        FUN_004300d9();
                        pcVar6 = "Failed to allocate memory for slipstream MSP packages.";
                      }
                      else {
                        iVar3 = FUN_00431078((int)local_10 << 2,1);
                        *(int *)(iVar1 + 200) = iVar3;
                        if (iVar3 != 0) {
                          piVar5 = (int *)0x0;
                          *(int **)(iVar1 + 0xcc) = local_10;
                          if (local_10 != (int *)0x0) {
                            do {
                              uVar2 = FUN_00435f1d(local_c,&local_8,(undefined4 *)0x0);
                              if ((int)uVar2 < 0) {
                                pcVar6 = "Failed to get next slipstream MSP node.";
                                goto LAB_0041c0dc;
                              }
                              uVar2 = FUN_00435b5e(local_8,&DAT_0043c524,
                                                   (int *)(*(int *)(iVar1 + 200) + (int)piVar5 * 4))
                              ;
                              if ((int)uVar2 < 0) {
                                pcVar6 = "Failed to parse slipstream MSP ids.";
                                goto LAB_0041c0dc;
                              }
                              if (local_8 != (int *)0x0) {
                                (**(code **)(*local_8 + 8))(local_8);
                                local_8 = (int *)0x0;
                              }
                              piVar5 = (int *)((int)piVar5 + 1);
                            } while (piVar5 < local_10);
                          }
                          goto LAB_0041c0a3;
                        }
                        FUN_004300d9();
                        pcVar6 = "Failed to allocate memory for slipstream MSP ids.";
                      }
LAB_0041c046:
                      uVar2 = 0x8007000e;
                      goto LAB_0041c0dc;
                    }
                  }
                  pcVar6 = "Failed to get related MSI node count.";
                }
              }
            }
          }
        }
      }
    }
  }
  goto LAB_0041c0dc;
LAB_0041bfad:
  pcVar6 = "Failed to get next node.";
LAB_0041c0dc:
  FUN_00430a57(uVar2,pcVar6);
LAB_0041c0a5:
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  return uVar2;
}



/* Function: FUN_0041c0ec */

uint FUN_0041c0ec(int *param_1,int *param_2,uint *param_3)

{
  uint uVar1;
  int *piVar2;
  LPVOID pvVar3;
  char *pcVar4;
  int *local_10;
  int *local_c;
  int *local_8;
  
  local_c = (int *)0x0;
  local_8 = (int *)0x0;
  local_10 = (int *)0x0;
  pvVar3 = (LPVOID)0x0;
  uVar1 = FUN_00435fbe(param_1,L"MsiProperty",(int)&local_c);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to select property nodes.";
  }
  else {
    uVar1 = (**(code **)(*local_c + 0x20))(local_c,&local_10);
    if (-1 < (int)uVar1) {
      if (local_10 != (int *)0x0) {
        pvVar3 = (LPVOID)FUN_00431078((int)local_10 * 0xc,1);
        if (pvVar3 == (LPVOID)0x0) {
          uVar1 = 0x8007000e;
          FUN_004300d9();
          pcVar4 = "Failed to allocate memory for MSI property structs.";
LAB_0041c26b:
          FUN_00430a57(uVar1,pcVar4);
          goto LAB_0041c22e;
        }
        param_1 = (int *)0x0;
        if (local_10 != (int *)0x0) {
          piVar2 = (int *)((int)pvVar3 + 8);
          do {
            uVar1 = FUN_00435f1d(local_c,&local_8,(undefined4 *)0x0);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to get next node.";
              goto LAB_0041c26b;
            }
            uVar1 = FUN_00435b5e(local_8,&DAT_0043c524,piVar2 + -2);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to get @Id.";
              goto LAB_0041c26b;
            }
            uVar1 = FUN_00435b5e(local_8,L"Value",piVar2 + -1);
            if ((int)uVar1 < 0) {
              pcVar4 = "Failed to get @Value.";
              goto LAB_0041c26b;
            }
            uVar1 = FUN_00435b5e(local_8,L"RollbackValue",piVar2);
            if ((uVar1 != 0x80070490) && ((int)uVar1 < 0)) {
              pcVar4 = "Failed to get @RollbackValue.";
              goto LAB_0041c26b;
            }
            if (local_8 != (int *)0x0) {
              (**(code **)(*local_8 + 8))(local_8);
              local_8 = (int *)0x0;
            }
            param_1 = (int *)((int)param_1 + 1);
            piVar2 = piVar2 + 3;
          } while (param_1 < local_10);
        }
      }
      *param_3 = (uint)local_10;
      *param_2 = (int)pvVar3;
      pvVar3 = (LPVOID)0x0;
      uVar1 = 0;
      goto LAB_0041c22e;
    }
    pcVar4 = "Failed to get property node count.";
  }
  FUN_00430a57(uVar1,pcVar4);
LAB_0041c22e:
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
    local_c = (int *)0x0;
  }
  if (pvVar3 != (LPVOID)0x0) {
    FUN_00431137(pvVar3);
  }
  return uVar1;
}



/* Function: FUN_0041c275 */

int FUN_0041c275(int param_1,int param_2,int param_3,int param_4,LPCRITICAL_SECTION param_5,
                int param_6,int param_7)

{
  int iVar1;
  undefined4 uVar2;
  undefined4 *puVar3;
  uint uVar4;
  int iVar5;
  char *pcVar6;
  undefined4 *local_10;
  LPVOID local_c;
  undefined4 *local_8;
  
  iVar1 = param_2;
  uVar4 = 0;
  local_8 = (undefined4 *)0x0;
  local_c = (LPVOID)0x0;
  local_10 = (undefined4 *)0x0;
  if (*(int *)(param_2 + 0xb8) == 0) {
LAB_0041c34c:
    if ((param_6 == 0) || (iVar5 = FUN_0040cb9c(param_3,iVar1,param_6,param_7), -1 < iVar5)) {
      iVar5 = FUN_0041ed32((uint *)0x0,iVar1,param_3);
      if (iVar5 < 0) {
        pcVar6 = "Failed to plan package dependency actions.";
      }
      else {
        if (*(int *)(iVar1 + 0x60) == 0) {
LAB_0041c422:
          if (*(int *)(iVar1 + 0x5c) != 0) {
            iVar5 = FUN_0040c979(param_3,(int *)&local_8);
            puVar3 = local_8;
            if (iVar5 < 0) {
              pcVar6 = "Failed to append execute action.";
              goto LAB_0041c443;
            }
            *local_8 = 5;
            local_8[2] = iVar1;
            local_8[6] = *(undefined4 *)(iVar1 + 0x5c);
            uVar2 = FUN_0041abe0(*(int *)(iVar1 + 0xa8),param_1,local_8[6]);
            puVar3[5] = uVar2;
            local_8[7] = local_c;
            local_c = (LPVOID)0x0;
            FUN_0040e915(iVar1,0,0,param_4,param_5,local_8 + 3);
            local_8[4] = *(undefined4 *)(param_4 + 8);
          }
          uVar4 = 0;
          if (*(int *)(iVar1 + 0xcc) != 0) {
            do {
              FUN_0041d8ba(*(int *)(*(int *)(iVar1 + 0xc4) + uVar4 * 4),*(int *)(iVar1 + 0x5c),
                           *(int *)(iVar1 + 0x60));
              uVar4 = uVar4 + 1;
            } while (uVar4 < *(uint *)(iVar1 + 0xcc));
          }
          goto LAB_0041c4d2;
        }
        iVar5 = FUN_0040c9c2(param_3,(int *)&local_8);
        puVar3 = local_8;
        if (iVar5 < 0) {
          pcVar6 = "Failed to append rollback action.";
        }
        else {
          *local_8 = 5;
          local_8[2] = iVar1;
          local_8[6] = *(undefined4 *)(iVar1 + 0x60);
          uVar2 = FUN_0041abe0(*(int *)(iVar1 + 0xa8),param_1,local_8[6]);
          puVar3[5] = uVar2;
          local_8[7] = local_10;
          local_10 = (undefined4 *)0x0;
          FUN_0040e915(iVar1,0,1,param_4,param_5,local_8 + 3);
          local_8[4] = *(undefined4 *)(param_4 + 8);
          iVar5 = FUN_0040dd6d(param_3);
          if (-1 < iVar5) goto LAB_0041c422;
          pcVar6 = "Failed to append execute checkpoint.";
        }
      }
    }
    else {
      pcVar6 = "Failed to plan package cache syncpoint";
    }
  }
  else {
    local_c = (LPVOID)FUN_00431078(*(int *)(param_2 + 0xb8) << 2,1);
    if (local_c == (LPVOID)0x0) {
      FUN_004300d9();
      FUN_00430a57(0x8007000e,"Failed to allocate memory for feature actions.");
      return -0x7ff8fff2;
    }
    local_10 = (undefined4 *)FUN_00431078(*(int *)(param_2 + 0xb8) << 2,1);
    if (local_10 != (undefined4 *)0x0) {
      if (*(int *)(param_2 + 0xb8) != 0) {
        param_2 = 0;
        puVar3 = local_10;
        do {
          iVar5 = *(int *)(iVar1 + 0xb4) + param_2;
          uVar4 = uVar4 + 1;
          *(undefined4 *)(((int)local_c - (int)local_10) + (int)puVar3) =
               *(undefined4 *)(iVar5 + 0x20);
          *puVar3 = *(undefined4 *)(iVar5 + 0x24);
          param_2 = param_2 + 0x28;
          puVar3 = puVar3 + 1;
        } while (uVar4 < *(uint *)(iVar1 + 0xb8));
      }
      goto LAB_0041c34c;
    }
    FUN_004300d9();
    pcVar6 = "Failed to allocate memory for rollback feature actions.";
    iVar5 = -0x7ff8fff2;
  }
LAB_0041c443:
  FUN_00430a57(iVar5,pcVar6);
LAB_0041c4d2:
  if (local_c != (LPVOID)0x0) {
    FUN_00431137(local_c);
  }
  if (local_10 != (undefined4 *)0x0) {
    FUN_00431137(local_10);
  }
  return iVar5;
}



/* Function: FUN_0041c4f5 */

DWORD FUN_0041c4f5(undefined4 *param_1,uint param_2,int param_3)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  DWORD DVar7;
  uint uVar8;
  undefined4 *puVar9;
  uint uVar10;
  char *pcVar11;
  int local_24;
  int local_20;
  int local_1c;
  uint local_18;
  int local_14;
  int local_10;
  int local_c;
  int local_8;
  
  uVar10 = param_1[0x26];
  uVar1 = param_1[0x27];
  uVar2 = param_1[0x28];
  uVar3 = param_1[0x29];
  uVar8 = 0;
  DVar7 = 0;
  local_20 = 0;
  local_24 = 0;
  iVar4 = 0;
  if (param_1[0x2e] != 0) {
    if (((int)param_1[0x10] < 4) || (local_10 = 1, param_1[0x14] != 5)) {
      local_10 = 0;
    }
    FUN_00402003(2,0x200000cc);
    local_18 = 0;
    if (param_1[0x2e] != 0) {
      local_1c = 0;
      do {
        puVar9 = (undefined4 *)(param_1[0x2d] + local_1c);
        local_8 = 0;
        local_c = 0;
        local_14 = 0;
        DVar7 = FUN_0041a820(param_2,puVar9[1],puVar9[2],puVar9[3],&local_c);
        if ((int)DVar7 < 0) {
          pcVar11 = "Failed to evaluate requested state conditions.";
          goto LAB_0041c7cd;
        }
        DVar7 = FUN_0041a820(param_2,puVar9[4],puVar9[5],puVar9[6],&local_14);
        if ((int)DVar7 < 0) {
          pcVar11 = "Failed to evaluate expected state conditions.";
          goto LAB_0041c7cd;
        }
        local_8 = local_c;
        iVar4 = (**(code **)(**(int **)(param_3 + 0x10) + 0x54))
                          (*(int **)(param_3 + 0x10),*param_1,*puVar9,&local_8);
        DVar7 = FUN_00408843(param_3,1,iVar4);
        if ((int)DVar7 < 0) {
          FUN_004300d9();
          pcVar11 = "UX aborted plan MSI feature.";
          goto LAB_0041c7cd;
        }
        DVar7 = FUN_0041a22b(puVar9[7],local_8,local_10,puVar9 + 8,&local_20);
        if ((int)DVar7 < 0) {
          pcVar11 = "Failed to calculate execute feature state.";
          goto LAB_0041c7cd;
        }
        iVar4 = local_14;
        if (puVar9[8] != 0) {
          iVar4 = puVar9[7];
        }
        DVar7 = FUN_0041a22b(local_8,iVar4,0,puVar9 + 9,&local_24);
        if ((int)DVar7 < 0) {
          pcVar11 = "Failed to calculate rollback feature state.";
          goto LAB_0041c7cd;
        }
        FUN_0040e438(puVar9[9]);
        FUN_0040e438(puVar9[8]);
        FUN_0040e48f(local_8);
        FUN_0040e48f(local_c);
        FUN_0040e48f(puVar9[7]);
        FUN_00402003(2,0x200000cb);
        local_18 = local_18 + 1;
        local_1c = local_1c + 0x28;
        iVar4 = local_20;
      } while (local_18 < (uint)param_1[0x2e]);
    }
  }
  iVar6 = param_1[0x10];
  if (((iVar6 == 1) || (iVar6 == 2)) || (iVar6 == 3)) {
    iVar5 = param_1[0x14];
    if ((iVar5 != 4) && (iVar5 != 5)) {
LAB_0041c751:
      uVar10 = 0;
      goto LAB_0041c806;
    }
    uVar10 = 2;
LAB_0041c796:
    if (uVar10 == 0) goto LAB_0041c806;
  }
  else {
    if ((iVar6 != 4) && (iVar6 != 5)) {
      FUN_004300d9();
      FUN_00430a57(0x80070057,"Invalid package current state result encountered during plan: %d");
      return 0x80070057;
    }
    iVar5 = param_1[0x14];
    if ((iVar5 == 4) || (iVar5 == 5)) {
      if ((uVar1 < uVar3) || ((uVar1 <= uVar3 && (uVar10 <= uVar2)))) {
        if (iVar5 != 5) {
          uVar10 = -(uint)(iVar4 != 0) & 4;
          goto LAB_0041c796;
        }
        uVar10 = 5;
      }
      else {
        uVar10 = 6;
      }
    }
    else {
      if ((((iVar5 != 2) && (iVar5 != 3)) || (param_1[6] == 0)) && (iVar5 != 1)) goto LAB_0041c751;
      uVar10 = 1;
    }
  }
  if (param_1[0x12] != 0) {
    iVar6 = param_1[0x12];
  }
  if (((iVar6 == 1) || (iVar6 == 2)) || (iVar6 == 3)) {
    if (((iVar5 == 4) || (iVar5 == 5)) && (param_1[6] != 0)) {
      uVar8 = 1;
    }
  }
  else {
    if ((iVar6 != 4) && (iVar6 != 5)) {
      FUN_004300d9();
      pcVar11 = "Invalid package detection result encountered.";
      DVar7 = 0x80070057;
LAB_0041c7cd:
      FUN_00430a57(DVar7,pcVar11);
      return DVar7;
    }
    if ((iVar5 == 1) || (iVar5 == 2)) {
      uVar8 = 2;
    }
    else if (iVar5 == 4) {
      uVar8 = -(uint)(local_24 != 0) & 4;
    }
  }
LAB_0041c806:
  param_1[0x17] = uVar10;
  param_1[0x18] = uVar8;
  return DVar7;
}



/* Function: FUN_0041c815 */

int FUN_0041c815(int param_1,int param_2,undefined4 param_3,PCNZWCH param_4,undefined4 param_5)

{
  int *piVar1;
  int iVar2;
  int iVar3;
  char *pcVar4;
  
  piVar1 = (int *)(param_2 + 0xa4);
  iVar2 = FUN_0043109a(piVar1,*(int *)(param_2 + 0xa8) + 1,0x6c,5);
  if (iVar2 < 0) {
    pcVar4 = "Failed to ensure enough target product codes were allocated.";
  }
  else {
    iVar2 = FUN_0041cddb((short *)(*piVar1 + 8 + *(int *)(param_2 + 0xa8) * 0x6c),0x27,(int)param_4)
    ;
    if (-1 < iVar2) {
      iVar3 = *(int *)(param_2 + 0xa8) * 0x6c;
      FUN_0041c980(param_1,param_2,param_4,(int *)(*piVar1 + 0x58 + iVar3),
                   (undefined4 *)(*piVar1 + 0x5c + iVar3));
      *(undefined4 *)(*(int *)(param_2 + 0xa8) * 0x6c + *piVar1) = param_5;
      *(undefined4 *)(*(int *)(param_2 + 0xa8) * 0x6c + 4 + *piVar1) = param_3;
      *(int *)(param_2 + 0xa8) = *(int *)(param_2 + 0xa8) + 1;
      return iVar2;
    }
    pcVar4 = "Failed to copy target product code.";
  }
  FUN_00430a57(iVar2,pcVar4);
  return iVar2;
}



/* Function: FUN_0041c8c8 */

int FUN_0041c8c8(int *param_1,LPCWSTR param_2,int param_3,int *param_4,int *param_5)

{
  int *piVar1;
  int *piVar2;
  int iVar3;
  uint uVar4;
  int iVar5;
  char *pcVar6;
  
  iVar5 = 0;
  iVar3 = FUN_0043805f(param_1,param_2);
  if ((iVar3 == -0x7ff8fb70) &&
     ((param_3 != 0 || (uVar4 = FUN_0043508e(param_2,0,7,0,0,&param_3,0,0), -1 < (int)uVar4)))) {
    iVar5 = FUN_00437da1(param_1,param_2);
    piVar2 = param_5;
    if (iVar5 < 0) {
      FUN_00430a57(iVar5,"Failed to add possible target code to unique product codes.");
    }
    else {
      iVar5 = FUN_0043109a(param_4,*param_5 + 1,0x54,3);
      piVar1 = param_4;
      if (iVar5 < 0) {
        pcVar6 = "Failed to grow array of possible target products.";
      }
      else {
        iVar5 = FUN_0041cddb((short *)(*piVar2 * 0x54 + *param_4),0x27,(int)param_2);
        if (-1 < iVar5) {
          *(int *)(*piVar2 * 0x54 + 0x50 + *piVar1) = param_3;
          *piVar2 = *piVar2 + 1;
          return iVar5;
        }
        pcVar6 = "Failed to copy possible target product code.";
      }
      FUN_00430a57(iVar5,pcVar6);
    }
  }
  return iVar5;
}



/* Function: FUN_0041c980 */

void FUN_0041c980(int param_1,int param_2,PCNZWCH param_3,int *param_4,undefined4 *param_5)

{
  int iVar1;
  int iVar2;
  int *piVar3;
  uint uVar4;
  undefined4 uVar5;
  int iVar6;
  int local_c;
  uint local_8;
  
  iVar1 = param_1;
  uVar5 = 0;
  local_c = 0;
  local_8 = 0;
  if (*(int *)(param_1 + 0xc) != 0) {
    param_1 = 0;
    do {
      iVar6 = *(int *)(iVar1 + 8) + param_1;
      if ((*(int *)(iVar6 + 0x8c) == 2) &&
         (iVar2 = CompareStringW(0,0,param_3,-1,*(PCNZWCH *)(iVar6 + 0x90),-1), iVar2 == 2)) {
        uVar4 = 0;
        local_c = iVar6;
        if (*(uint *)(iVar6 + 0xcc) != 0) {
          piVar3 = *(int **)(iVar6 + 0xc4);
          goto LAB_0041c9f9;
        }
        break;
      }
      local_8 = local_8 + 1;
      param_1 = param_1 + 0xd0;
    } while (local_8 < *(uint *)(iVar1 + 0xc));
  }
  goto LAB_0041ca0b;
  while( true ) {
    uVar4 = uVar4 + 1;
    piVar3 = piVar3 + 1;
    if (*(uint *)(iVar6 + 0xcc) <= uVar4) break;
LAB_0041c9f9:
    if (*piVar3 == param_2) {
      uVar5 = 1;
      break;
    }
  }
LAB_0041ca0b:
  *param_4 = local_c;
  *param_5 = uVar5;
  return;
}



/* Function: FUN_0041ca1e */

void FUN_0041ca1e(int param_1,int *param_2,int *param_3)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  char *pcVar4;
  int local_60;
  int *local_5c;
  WCHAR local_58 [40];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_5c = (int *)0x0;
  uVar2 = FUN_00437ee1(&local_5c,5,0);
  if ((int)uVar2 < 0) {
    FUN_00430a57(uVar2,"Failed to create unique target product codes.");
  }
  else {
    uVar3 = 0;
    if (*(int *)(param_1 + 0x10) == 0) {
      do {
        local_60 = 0;
        uVar2 = FUN_0043508e(0,0,7,uVar3,local_58,&local_60,0,0);
        if ((int)uVar2 < 0) {
          if (uVar2 == 0x8007064a) {
            FUN_00402003(2,0xa00000aa);
            uVar2 = 0;
          }
        }
        else {
          uVar2 = FUN_0041c8c8(local_5c,local_58,local_60,param_2,param_3);
          if ((int)uVar2 < 0) {
            pcVar4 = "Failed to add product code to search product codes.";
            goto LAB_0041cbc1;
          }
        }
        uVar3 = uVar3 + 1;
      } while (-1 < (int)uVar2);
      if (uVar2 == 0x80070103) {
        uVar2 = 0;
      }
      if ((int)uVar2 < 0) {
        pcVar4 = "Failed to enumerate all products on the machine for patches applicability.";
LAB_0041cbc1:
        FUN_00430a57(uVar2,pcVar4);
      }
    }
    else if (*(int *)(param_1 + 0x14) != 0) {
      do {
        iVar1 = *(int *)(param_1 + 0x10);
        if (*(int *)(iVar1 + 4 + uVar3 * 8) == 1) {
          uVar2 = FUN_0041c8c8(local_5c,*(LPCWSTR *)(iVar1 + uVar3 * 8),0,param_2,param_3);
          if ((int)uVar2 < 0) {
            pcVar4 = "Failed to add product code to possible target product codes.";
            goto LAB_0041cbc1;
          }
        }
        else {
          local_60 = 0;
          while (-1 < (int)uVar2) {
            uVar2 = FUN_004350ff(*(undefined4 *)(iVar1 + uVar3 * 8),local_60,local_58);
            if ((int)uVar2 < 0) {
              if (uVar2 == 0x8007064a) {
                FUN_00402003(2,0xa00000aa);
                uVar2 = 0;
              }
            }
            else {
              uVar2 = FUN_0041c8c8(local_5c,local_58,0,param_2,param_3);
              if ((int)uVar2 < 0) {
                pcVar4 = "Failed to add upgrade product code to possible target product codes.";
                goto LAB_0041cbc1;
              }
            }
            local_60 = local_60 + 1;
          }
          if (uVar2 == 0x80070103) {
            uVar2 = 0;
          }
          if ((int)uVar2 < 0) {
            FUN_00430a57(uVar2,
                         "Failed to enumerate all products to patch related to upgrade code: %ls");
            break;
          }
        }
        uVar3 = uVar3 + 1;
      } while (uVar3 < *(uint *)(param_1 + 0x14));
    }
  }
  if (local_5c != (int *)0x0) {
    FUN_0043800c(local_5c);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0041cbea */

int FUN_0041cbea(int param_1,uint param_2,uint *param_3,undefined4 param_4,
                LPCRITICAL_SECTION param_5,uint param_6,uint param_7,int *param_8)

{
  uint uVar1;
  undefined4 uVar2;
  undefined4 uVar3;
  uint *puVar4;
  int *piVar5;
  uint uVar6;
  int iVar7;
  uint uVar8;
  int iVar9;
  uint *puVar10;
  char *pcVar11;
  
  puVar4 = param_3;
  uVar1 = param_2;
  if (param_2 == 0) {
    uVar8 = param_3[0x17];
    uVar6 = param_3[0x18];
  }
  else {
    uVar8 = param_3[0x19];
    uVar6 = param_3[0x1a];
  }
  param_3 = (uint *)0x0;
  param_2 = 0;
  if (uVar6 == 0) {
LAB_0041cc7f:
    if (uVar1 == 0) {
      iVar7 = FUN_0040c979((int)puVar4,(int *)&param_3);
    }
    else {
      iVar7 = FUN_0040c9c2((int)puVar4,(int *)&param_3);
    }
    piVar5 = param_8;
    if (iVar7 < 0) {
      pcVar11 = "Failed to plan action for target product.";
      goto LAB_0041cd67;
    }
    *param_3 = 6;
    param_3[9] = param_6;
    param_3[2] = param_7;
    param_3[6] = (uint)(*param_8 == 4);
    uVar8 = FUN_0041abe0(*(int *)(param_7 + 0x98),param_1,param_3[9]);
    param_3[8] = uVar8;
    param_3[4] = piVar5[0x16];
    param_3[5] = piVar5[0x17];
    iVar7 = FUN_00433f88((int *)(param_3 + 3),(LPCWSTR)(piVar5 + 2),0);
    uVar8 = param_7;
    if (iVar7 < 0) {
      pcVar11 = "Failed to copy target product code.";
      goto LAB_0041cd67;
    }
    if (param_3[6] != 0) {
      puVar4[3] = 1;
    }
    FUN_0040e915(param_7,param_3[3],uVar1,param_4,param_5,(int *)(param_3 + 7));
  }
  else {
    puVar10 = (uint *)(uVar8 + 0x18);
    do {
      param_3 = puVar10 + -6;
      if ((((*param_3 == 6) && (puVar10[3] == param_6)) && (*puVar10 == (uint)(*param_8 == 4))) &&
         (iVar7 = CompareStringW(0,0,(PCNZWCH)puVar10[-3],-1,(PCNZWCH)(param_8 + 2),-1), iVar7 == 2)
         ) break;
      param_2 = param_2 + 1;
      puVar10 = puVar10 + 0xc;
      param_3 = (uint *)0x0;
    } while (param_2 < uVar6);
    uVar8 = param_7;
    if (param_3 == (uint *)0x0) goto LAB_0041cc7f;
  }
  iVar7 = FUN_0043109a((int *)(param_3 + 10),param_3[0xb] + 1,8,2);
  if (-1 < iVar7) {
    *(int *)(param_3[10] + param_3[0xb] * 8) = param_8[1];
    *(uint *)(param_3[10] + 4 + param_3[0xb] * 8) = uVar8;
    param_3[0xb] = param_3[0xb] + 1;
    iVar9 = param_3[0xb] - 1;
    while( true ) {
      if (iVar9 == 0) {
        return iVar7;
      }
      uVar1 = param_3[10];
      uVar8 = *(uint *)(uVar1 + iVar9 * 8);
      if (*(uint *)((uVar1 - 8) + iVar9 * 8) <= uVar8) break;
      uVar2 = *(undefined4 *)((uVar1 - 8) + iVar9 * 8);
      uVar3 = *(undefined4 *)((uVar1 - 4) + iVar9 * 8);
      *(uint *)((uVar1 - 8) + iVar9 * 8) = uVar8;
      *(undefined4 *)((uVar1 - 4) + iVar9 * 8) = *(undefined4 *)(uVar1 + 4 + iVar9 * 8);
      uVar1 = param_3[10];
      *(undefined4 *)(uVar1 + iVar9 * 8) = uVar2;
      iVar9 = iVar9 + -1;
      *(undefined4 *)(uVar1 + 0xc + iVar9 * 8) = uVar3;
    }
    return iVar7;
  }
  pcVar11 = "Failed grow array of ordered patches.";
LAB_0041cd67:
  FUN_00430a57(iVar7,pcVar11);
  return iVar7;
}



/* Function: FUN_0041cddb */

int FUN_0041cddb(short *param_1,uint param_2,int param_3)

{
  short sVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  
  iVar3 = 0;
  if ((param_2 == 0) || (0x7fffffff < param_2)) {
    iVar3 = -0x7ff8ffa9;
  }
  if (iVar3 < 0) {
    return iVar3;
  }
  iVar3 = 0;
  if (param_2 != 0) {
    iVar4 = 0x7ffffffe - param_2;
    iVar2 = param_3 - (int)param_1;
    do {
      if ((iVar4 + param_2 == 0) || (sVar1 = *(short *)(iVar2 + (int)param_1), sVar1 == 0)) break;
      *param_1 = sVar1;
      param_1 = param_1 + 1;
      param_2 = param_2 - 1;
    } while (param_2 != 0);
    if (param_2 != 0) goto LAB_0041ce37;
  }
  param_1 = param_1 + -1;
  iVar3 = -0x7ff8ff86;
LAB_0041ce37:
  *param_1 = 0;
  return iVar3;
}



/* Function: FUN_0041ce43 */

int FUN_0041ce43(uint param_1)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  PCNZWCH pWVar4;
  int local_18;
  uint local_14;
  int local_10;
  uint local_c;
  LPVOID local_8;
  
  uVar1 = param_1;
  local_8 = (LPVOID)0x0;
  local_c = 0;
  iVar2 = FUN_0041ca1e(param_1,(int *)&local_8,(int *)&local_c);
  if (iVar2 < 0) {
    FUN_00430a57(iVar2,"Failed to get possible target product codes.");
  }
  else {
    local_14 = 0;
    if (local_c != 0) {
      local_18 = 0;
      do {
        pWVar4 = (PCNZWCH)((int)local_8 + local_18);
        FUN_0040e4d2(*(int *)(pWVar4 + 0x28));
        FUN_00402003(2,0x2000006a);
        uVar3 = FUN_00434fec(pWVar4,0,*(undefined4 *)(pWVar4 + 0x28),*(undefined4 *)(uVar1 + 0x18),
                             *(undefined4 *)(uVar1 + 0x20));
        if ((int)uVar3 < 0) {
          FUN_0040e4d2(*(int *)(pWVar4 + 0x28));
          FUN_00402003(2,0xa0000079);
        }
        else {
          param_1 = 0;
          if (*(int *)(uVar1 + 0x20) != 0) {
            local_10 = 0;
            do {
              if ((*(int *)(*(int *)(uVar1 + 0x18) + 0xc + local_10) == 0) &&
                 (iVar2 = FUN_0041c815(uVar1,*(int *)(*(int *)(uVar1 + 0x1c) + param_1 * 4),
                                       *(undefined4 *)(*(int *)(uVar1 + 0x18) + 8 + local_10),pWVar4
                                       ,*(undefined4 *)(pWVar4 + 0x28)), iVar2 < 0)) {
                FUN_00430a57(iVar2,"Failed to add target product code to package: %ls");
                goto LAB_0041cf59;
              }
              param_1 = param_1 + 1;
              local_10 = local_10 + 0x10;
            } while (param_1 < *(uint *)(uVar1 + 0x20));
          }
        }
        iVar2 = 0;
        local_14 = local_14 + 1;
        local_18 = local_18 + 0x54;
      } while (local_14 < local_c);
    }
  }
LAB_0041cf59:
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return iVar2;
}



/* Function: FUN_0041cf70 */

uint FUN_0041cf70(undefined4 *param_1,int param_2)

{
  short sVar1;
  undefined4 *puVar2;
  int iVar3;
  undefined4 *puVar4;
  uint uVar5;
  int local_c;
  short *local_8;
  
  puVar2 = param_1;
  uVar5 = 0;
  iVar3 = param_1[0x2a];
  local_8 = (short *)0x0;
  if (iVar3 == 0) {
    param_1[0x10] = 2;
  }
  else {
    param_1 = (undefined4 *)0x0;
    puVar2[0x10] = 5;
    if (iVar3 != 0) {
      local_c = 0;
      do {
        puVar4 = (undefined4 *)(puVar2[0x29] + local_c);
        uVar5 = FUN_0043521e(puVar2[0x24],puVar4 + 2,0,*puVar4,L"State",(int *)&local_8);
        if ((int)uVar5 < 0) {
          if (uVar5 == 0x8007066f) {
            puVar4[0x18] = 2;
            uVar5 = 0;
          }
        }
        else {
          sVar1 = *local_8;
          if (sVar1 == 0x31) {
            puVar4[0x18] = 4;
          }
          else if (sVar1 == 0x32) {
            puVar4[0x18] = 5;
          }
          else if (sVar1 == 0x34) {
            puVar4[0x18] = 1;
          }
          else {
            puVar4[0x18] = 2;
          }
        }
        if ((int)uVar5 < 0) {
          FUN_00430a57(uVar5,
                       "Failed to get patch information for patch code: %ls, target product code: %ls"
                      );
          break;
        }
        if ((int)puVar4[0x18] < (int)puVar2[0x10]) {
          puVar2[0x10] = puVar4[0x18];
        }
        iVar3 = (**(code **)(**(int **)(param_2 + 0x10) + 0x34))
                          (*(int **)(param_2 + 0x10),*puVar2,puVar4 + 2,puVar4[0x18]);
        uVar5 = FUN_00408843(param_2,1,iVar3);
        if ((int)uVar5 < 0) {
          FUN_004300d9();
          FUN_00430a57(uVar5,"UX aborted detect target MSI package.");
          break;
        }
        param_1 = (undefined4 *)((int)param_1 + 1);
        local_c = local_c + 0x6c;
      } while (param_1 < (undefined4 *)puVar2[0x2a]);
      if (local_8 != (short *)0x0) {
        FUN_004380ab(local_8);
      }
    }
  }
  return uVar5;
}



/* Function: FUN_0041d0bc */

void FUN_0041d0bc(uint param_1,int param_2,LPCRITICAL_SECTION param_3,uint param_4,uint param_5,
                 uint param_6,undefined4 *param_7)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  undefined4 uVar4;
  short *psVar5;
  char *pcVar6;
  uint local_650;
  int local_64c;
  undefined4 *local_648;
  LPCWSTR local_644;
  LPVOID local_640;
  short *local_63c;
  short *local_638;
  LPVOID local_634;
  uint local_630 [394];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_648 = param_7;
  uVar4 = 0x102;
  if (*(int *)(*(int *)(param_2 + 8) + 0x98) != 0) {
    uVar4 = 1;
  }
  FUN_004267c0(local_630,0,0x628);
  local_64c = 0;
  local_644 = (LPCWSTR)0x0;
  local_63c = (short *)0x0;
  local_638 = (short *)0x0;
  local_634 = (LPVOID)0x0;
  local_640 = (LPVOID)0x0;
  local_650 = 0;
  if (*(int *)(param_2 + 0x2c) != 0) {
    do {
      iVar1 = *(int *)(*(int *)(param_2 + 0x28) + 4 + local_650 * 8);
      if (*(int *)(param_2 + 0x24) == 2) {
        iVar2 = FUN_00413be9(*(int *)(iVar1 + 0x14),*(undefined4 *)(iVar1 + 0x24),(int *)&local_644)
        ;
        if (iVar2 < 0) {
          FUN_00430a57(iVar2,"Failed to get cached path for MSP package: %ls");
          goto LAB_0041d46c;
        }
        uVar3 = FUN_004314a9(local_644,*(LPCWSTR *)(**(int **)(iVar1 + 0x7c) + 0x18),
                             (int *)&local_63c);
        psVar5 = local_63c;
        if ((int)uVar3 < 0) {
          pcVar6 = "Failed to build MSP path.";
          goto LAB_0041d216;
        }
      }
      else {
        psVar5 = *(short **)(iVar1 + 0x90);
      }
      if ((local_638 != (short *)0x0) &&
         (uVar3 = FUN_00433c35((int *)&local_638,(short *)&DAT_0044a344,0), (int)uVar3 < 0)) {
        pcVar6 = "Failed to semi-colon delimit patches.";
        goto LAB_0041d216;
      }
      uVar3 = FUN_00433c35((int *)&local_638,psVar5,0);
      if ((int)uVar3 < 0) {
        pcVar6 = "Failed to append patch.";
        goto LAB_0041d216;
      }
      local_650 = local_650 + 1;
    } while (local_650 < *(uint *)(param_2 + 0x2c));
  }
  uVar3 = FUN_00435549(param_5,uVar4,param_1,param_6,param_4,local_630);
  if ((int)uVar3 < 0) {
    pcVar6 = "Failed to initialize external UI handler.";
  }
  else {
    psVar5 = *(short **)(param_2 + 0x1c);
    if (((psVar5 != (short *)0x0) && (*psVar5 != 0)) &&
       (uVar3 = FUN_00435046(0x1fdf,psVar5,0), (int)uVar3 < 0)) {
      FUN_00430a57(uVar3,"Failed to enable logging for package: %ls to: %ls");
      goto LAB_0041d46c;
    }
    uVar3 = FUN_0041ac12(*(int *)(*(int *)(param_2 + 8) + 0x9c),
                         *(uint *)(*(int *)(param_2 + 8) + 0xa0),param_3,param_4,(int *)&local_634,0
                        );
    if ((int)uVar3 < 0) {
      pcVar6 = "Failed to add properties to argument string.";
    }
    else {
      uVar3 = FUN_0041ac12(*(int *)(*(int *)(param_2 + 8) + 0x9c),
                           *(uint *)(*(int *)(param_2 + 8) + 0xa0),param_3,param_4,(int *)&local_640
                           ,1);
      if (-1 < (int)uVar3) {
        FUN_0040e2bb(*(undefined4 *)(param_2 + 0x24));
        FUN_00402003(2,0x20000132);
        iVar1 = *(int *)(param_2 + 0x24);
        if (iVar1 == 1) {
          uVar3 = FUN_00433c35((int *)&local_634,L" REBOOT=ReallySuppress",0);
          if ((int)uVar3 < 0) {
            pcVar6 = "Failed to add reboot suppression property on uninstall.";
          }
          else {
            uVar3 = FUN_00433cea((int *)&local_634,L"%ls %ls=ALL");
            if ((int)uVar3 < 0) {
              pcVar6 = "Failed to add the list of dependencies to ignore to the properties.";
            }
            else {
              uVar3 = FUN_00435768(local_638,*(undefined4 *)(param_2 + 0xc),local_634,&local_64c);
              if (-1 < (int)uVar3) goto LAB_0041d46c;
              pcVar6 = "Failed to uninstall MSP package.";
            }
          }
        }
        else {
          if ((iVar1 != 2) && (iVar1 != 5)) goto LAB_0041d46c;
          uVar3 = FUN_00433c35((int *)&local_634,L" PATCH=\"",0);
          if ((int)uVar3 < 0) {
            pcVar6 = "Failed to add PATCH property on install.";
          }
          else {
            uVar3 = FUN_00433c35((int *)&local_634,local_638,0);
            if ((int)uVar3 < 0) {
              pcVar6 = "Failed to add patches to PATCH property on install.";
            }
            else {
              uVar3 = FUN_00433c35((int *)&local_634,L"\" REBOOT=ReallySuppress",0);
              if ((int)uVar3 < 0) {
                pcVar6 = "Failed to add reboot suppression property on install.";
              }
              else {
                uVar3 = FUN_00434f98(*(undefined4 *)(param_2 + 0xc),0,5,local_634,&local_64c);
                if (-1 < (int)uVar3) goto LAB_0041d46c;
                pcVar6 = "Failed to install MSP package.";
              }
            }
          }
        }
        FUN_00430a57(uVar3,pcVar6);
        goto LAB_0041d46c;
      }
      pcVar6 = "Failed to add properties to obfuscated argument string.";
    }
  }
LAB_0041d216:
  FUN_00430a57(uVar3,pcVar6);
LAB_0041d46c:
  FUN_00435855(local_630);
  if (local_644 != (LPCWSTR)0x0) {
    FUN_004380ab(local_644);
  }
  if (local_63c != (short *)0x0) {
    FUN_004380ab(local_63c);
  }
  if (local_634 != (LPVOID)0x0) {
    FUN_004380ab(local_634);
  }
  if (local_640 != (LPVOID)0x0) {
    FUN_004380ab(local_640);
  }
  if (local_638 != (short *)0x0) {
    FUN_004380ab(local_638);
  }
  if (local_64c == 0) {
    *local_648 = 0;
  }
  else if (local_64c == 1) {
    *local_648 = 1;
  }
  else if (local_64c == 2) {
    *local_648 = 2;
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0041d523 */

void FUN_0041d523(int param_1)

{
  int iVar1;
  int iVar2;
  int *piVar3;
  uint uVar4;
  undefined4 *puVar5;
  
  iVar1 = param_1;
  if (*(int *)(param_1 + 0x90) != 0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x90));
  }
  if (*(LPVOID *)(param_1 + 0x94) != (LPVOID)0x0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x94));
  }
  uVar4 = 0;
  if (*(int *)(param_1 + 0x9c) != 0) {
    if (*(int *)(param_1 + 0xa0) != 0) {
      param_1 = 0;
      do {
        piVar3 = (int *)(*(int *)(iVar1 + 0x9c) + param_1);
        if (*piVar3 != 0) {
          FUN_004380ab((LPVOID)*piVar3);
        }
        if (piVar3[1] != 0) {
          FUN_004380ab((LPVOID)piVar3[1]);
        }
        if (piVar3[2] != 0) {
          FUN_004380ab((LPVOID)piVar3[2]);
        }
        uVar4 = uVar4 + 1;
        param_1 = param_1 + 0xc;
      } while (uVar4 < *(uint *)(iVar1 + 0xa0));
    }
    FUN_00431137(*(LPVOID *)(iVar1 + 0x9c));
  }
  if (*(LPVOID *)(iVar1 + 0xa4) != (LPVOID)0x0) {
    FUN_00431137(*(LPVOID *)(iVar1 + 0xa4));
  }
  puVar5 = (undefined4 *)(iVar1 + 0x90);
  for (iVar2 = 7; iVar2 != 0; iVar2 = iVar2 + -1) {
    *puVar5 = 0;
    puVar5 = puVar5 + 1;
  }
  return;
}



/* Function: FUN_0041d5d8 */

uint FUN_0041d5d8(int *param_1,int param_2)

{
  uint uVar1;
  char *pcVar2;
  
  uVar1 = FUN_00435b5e(param_1,L"PatchCode",(int *)(param_2 + 0x90));
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to get @PatchCode.";
  }
  else {
    uVar1 = FUN_00435b5e(param_1,L"PatchXml",(int *)(param_2 + 0x94));
    if ((int)uVar1 < 0) {
      pcVar2 = "Failed to get @PatchXml.";
    }
    else {
      uVar1 = FUN_00435d6c(param_1,L"DisplayInternalUI",(uint *)(param_2 + 0x98));
      if ((int)uVar1 < 0) {
        pcVar2 = "Failed to get @DisplayInternalUI.";
      }
      else {
        uVar1 = FUN_0041c0ec(param_1,(int *)(param_2 + 0x9c),(uint *)(param_2 + 0xa0));
        if (-1 < (int)uVar1) {
          return uVar1;
        }
        pcVar2 = "Failed to parse properties from XML.";
      }
    }
  }
  FUN_00430a57(uVar1,pcVar2);
  return uVar1;
}



/* Function: FUN_0041d674 */

int FUN_0041d674(int param_1,uint param_2,uint *param_3,undefined4 param_4,
                LPCRITICAL_SECTION param_5,uint param_6,int param_7)

{
  uint uVar1;
  int iVar2;
  int *piVar3;
  char *pcVar4;
  
  uVar1 = param_2;
  if ((param_6 == 0) || (iVar2 = FUN_0040cb9c((int)param_3,param_2,param_6,param_7), -1 < iVar2)) {
    iVar2 = FUN_0041ed32((uint *)0x0,param_2,(int)param_3);
    if (-1 < iVar2) {
      param_6 = 0;
      if (*(int *)(param_2 + 0xa8) == 0) {
        return iVar2;
      }
      param_2 = 0;
      while( true ) {
        piVar3 = (int *)(*(int *)(uVar1 + 0xa4) + param_2);
        if (*(int *)(uVar1 + 0x5c) < piVar3[0x19]) {
          piVar3[0x19] = 0;
          piVar3[0x1a] = 0;
        }
        if ((piVar3[0x19] != 0) &&
           (iVar2 = FUN_0041cbea(param_1,0,param_3,param_4,param_5,piVar3[0x19],uVar1,piVar3),
           iVar2 < 0)) break;
        if ((piVar3[0x1a] != 0) &&
           (iVar2 = FUN_0041cbea(param_1,1,param_3,param_4,param_5,piVar3[0x1a],uVar1,piVar3),
           iVar2 < 0)) {
          pcVar4 = "Failed to plan rollack target product.";
          goto LAB_0041d761;
        }
        param_6 = param_6 + 1;
        param_2 = param_2 + 0x6c;
        if (*(uint *)(uVar1 + 0xa8) <= param_6) {
          return iVar2;
        }
      }
      pcVar4 = "Failed to plan target product.";
LAB_0041d761:
      FUN_00430a57(iVar2,pcVar4);
      return iVar2;
    }
    pcVar4 = "Failed to plan package dependency actions.";
  }
  else {
    pcVar4 = "Failed to plan package cache syncpoint";
  }
  FUN_00430a57(iVar2,pcVar4);
  return iVar2;
}



/* Function: FUN_0041d772 */

int FUN_0041d772(undefined4 *param_1,int param_2)

{
  int iVar1;
  uint uVar2;
  int iVar3;
  int iVar4;
  uint uVar5;
  int local_10;
  uint local_c;
  int local_8;
  
  iVar3 = 0;
  local_c = 0;
  if (param_1[0x2a] != 0) {
    local_10 = 0;
    do {
      local_8 = param_1[0x14];
      iVar4 = param_1[0x29] + local_10;
      uVar2 = 0;
      iVar3 = (**(code **)(**(int **)(param_2 + 0x10) + 0x50))
                        (*(int **)(param_2 + 0x10),*param_1,iVar4 + 8,&local_8);
      iVar3 = FUN_00408843(param_2,1,iVar3);
      if (iVar3 < 0) {
        FUN_004300d9();
        FUN_00430a57(iVar3,"UX aborted plan target MSI package.");
        return iVar3;
      }
      if (*(int *)(iVar4 + 0x60) == 2) {
        if ((local_8 == 4) || (local_8 == 5)) {
          uVar2 = 2;
          goto LAB_0041d855;
        }
LAB_0041d7f5:
        uVar2 = 0;
LAB_0041d7f7:
        uVar5 = 0;
      }
      else {
        if (*(int *)(iVar4 + 0x60) != 4) goto LAB_0041d7f7;
        if (local_8 == 1) {
          uVar2 = 1;
LAB_0041d855:
          if (uVar2 == 0) goto LAB_0041d7f7;
        }
        else {
          if ((local_8 == 2) || (local_8 == 3)) {
            uVar2 = (uint)(param_1[6] != 0);
            goto LAB_0041d855;
          }
          if (local_8 != 5) goto LAB_0041d7f5;
          uVar2 = 5;
        }
        iVar1 = param_1[0x12];
        if (iVar1 == 0) {
          iVar1 = param_1[0x10];
        }
        if ((iVar1 == 2) || (iVar1 == 3)) {
          if ((local_8 != 4) && (local_8 != 5)) goto LAB_0041d880;
          uVar5 = (uint)(param_1[6] != 0);
        }
        else if ((iVar1 == 4) && ((local_8 == 1 || (local_8 == 2)))) {
          uVar5 = 2;
        }
        else {
LAB_0041d880:
          uVar5 = 0;
        }
      }
      *(uint *)(iVar4 + 100) = uVar2;
      *(uint *)(iVar4 + 0x68) = uVar5;
      if ((int)param_1[0x17] < (int)uVar2) {
        param_1[0x17] = uVar2;
      }
      if ((int)param_1[0x18] < (int)uVar5) {
        param_1[0x18] = uVar5;
      }
      local_c = local_c + 1;
      local_10 = local_10 + 0x6c;
    } while (local_c < (uint)param_1[0x2a]);
  }
  return iVar3;
}



/* Function: FUN_0041d8ba */

void FUN_0041d8ba(int param_1,int param_2,int param_3)

{
  if (*(int *)(param_1 + 0x74) == 0) {
    if (*(int *)(param_1 + 0x5c) < param_2) {
      *(int *)(param_1 + 0x5c) = param_2;
    }
    if (*(int *)(param_1 + 0x60) < param_3) {
      *(int *)(param_1 + 0x60) = param_3;
    }
  }
  return;
}



/* Function: FUN_0041d8e0 */

void FUN_0041d8e0(undefined4 *param_1,undefined4 *param_2)

{
  SC_HANDLE hSCManager;
  DWORD DVar1;
  BOOL BVar2;
  int iVar3;
  SC_HANDLE hService;
  uint uVar4;
  _SERVICE_STATUS *p_Var5;
  char *pcVar6;
  LPVOID local_28;
  _SERVICE_STATUS local_24;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  hService = (SC_HANDLE)0x0;
  p_Var5 = &local_24;
  for (iVar3 = 7; iVar3 != 0; iVar3 = iVar3 + -1) {
    p_Var5->dwServiceType = 0;
    p_Var5 = (_SERVICE_STATUS *)&p_Var5->dwCurrentState;
  }
  local_28 = (LPVOID)0x0;
  hSCManager = OpenSCManagerW((LPCWSTR)0x0,(LPCWSTR)0x0,0xf003f);
  if (hSCManager == (SC_HANDLE)0x0) {
    DVar1 = GetLastError();
    uVar4 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar4 = DVar1;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar6 = "Failed to open service control manager.";
  }
  else {
    hService = OpenServiceW(hSCManager,L"wuauserv",7);
    if (hService == (SC_HANDLE)0x0) {
      DVar1 = GetLastError();
      uVar4 = DVar1 & 0xffff | 0x80070000;
      if ((int)DVar1 < 1) {
        uVar4 = DVar1;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar6 = "Failed to open WU service.";
    }
    else {
      BVar2 = QueryServiceStatus(hService,&local_24);
      if (BVar2 != 0) {
        if (local_24.dwCurrentState != 4) {
          uVar4 = FUN_00438466(hService,&local_28);
          if ((int)uVar4 < 0) {
            pcVar6 = "Failed to read configuration for WU service.";
            goto LAB_0041da24;
          }
          if (*(int *)((int)local_28 + 4) == 4) {
            uVar4 = FUN_0041da76(hService,3);
            if ((int)uVar4 < 0) {
              pcVar6 = "Failed to mark WU service to start on demand.";
              goto LAB_0041da24;
            }
            *param_2 = 1;
          }
        }
        *param_1 = hService;
        hService = (SC_HANDLE)0x0;
        goto LAB_0041da3e;
      }
      DVar1 = GetLastError();
      uVar4 = DVar1 & 0xffff | 0x80070000;
      if ((int)DVar1 < 1) {
        uVar4 = DVar1;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar6 = "Failed to query status of WU service.";
    }
  }
LAB_0041da24:
  FUN_00430a57(uVar4,pcVar6);
LAB_0041da3e:
  if (local_28 != (LPVOID)0x0) {
    FUN_00431137(local_28);
  }
  if (hService != (SC_HANDLE)0x0) {
    CloseServiceHandle(hService);
  }
  if (hSCManager != (SC_HANDLE)0x0) {
    CloseServiceHandle(hSCManager);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0041da76 */

DWORD FUN_0041da76(SC_HANDLE param_1,DWORD param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  
  uVar3 = 0;
  BVar1 = ChangeServiceConfigW
                    (param_1,0xffffffff,param_2,0xffffffff,(LPCWSTR)0x0,(LPCWSTR)0x0,(LPDWORD)0x0,
                     (LPCWSTR)0x0,(LPCWSTR)0x0,(LPCWSTR)0x0,(LPCWSTR)0x0);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar3,"Failed to set service start type.");
  }
  return uVar3;
}



/* Function: FUN_0041dad9 */

DWORD FUN_0041dad9(int param_1,uint param_2)

{
  short *psVar1;
  undefined4 uVar2;
  uint uVar3;
  DWORD DVar4;
  uint local_8;
  
  DVar4 = 0;
  psVar1 = *(short **)(param_1 + 0x90);
  local_8 = 0;
  uVar3 = 0;
  if (((psVar1 == (short *)0x0) || (*psVar1 == 0)) ||
     (DVar4 = FUN_00405961(param_2,psVar1,&local_8), uVar3 = local_8, -1 < (int)DVar4)) {
    uVar2 = 2;
    if (uVar3 != 0) {
      uVar2 = 4;
    }
    *(undefined4 *)(param_1 + 0x40) = uVar2;
  }
  else {
    FUN_00430a57(DVar4,"Failed to evaluate MSU package detect condition.");
  }
  return DVar4;
}



/* Function: FUN_0041db33 */

DWORD FUN_0041db33(int param_1,int param_2,undefined *param_3,undefined4 param_4,undefined4 *param_5
                  )

{
  DWORD DVar1;
  BOOL BVar2;
  DWORD DVar3;
  int iVar4;
  char *pcVar5;
  _STARTUPINFOW local_88;
  undefined4 local_44;
  undefined4 local_40;
  undefined4 local_3c;
  undefined4 uStack_38;
  _PROCESS_INFORMATION local_34;
  int local_24;
  SC_HANDLE local_20;
  DWORD local_1c;
  LPCWSTR local_18;
  LPCWSTR local_14;
  LPVOID local_10;
  LPCWSTR local_c;
  LPWSTR local_8;
  
  local_18 = (LPCWSTR)0x0;
  local_10 = (LPVOID)0x0;
  local_14 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  local_8 = (LPWSTR)0x0;
  local_20 = (SC_HANDLE)0x0;
  local_24 = 0;
  FUN_004267c0(&local_88.cb,0,0x44);
  local_34.hProcess = (HANDLE)0x0;
  local_34.hThread = (HANDLE)0x0;
  local_34.dwProcessId = 0;
  local_34.dwThreadId = 0;
  local_44 = 0;
  local_40 = 0;
  local_3c = 0;
  uStack_38 = 0;
  local_1c = 0;
  *param_5 = 0;
  DVar1 = FUN_00431d07(0x25,(int *)&local_14);
  if ((int)DVar1 < 0) {
    pcVar5 = "Failed to find System32 directory.";
  }
  else {
    DVar1 = FUN_004314a9(local_14,L"wusa.exe",(int *)&local_c);
    if ((int)DVar1 < 0) {
      pcVar5 = "Failed to allocate WUSA.exe path.";
    }
    else if (*(int *)(param_1 + 0x10) == 1) {
      DVar1 = FUN_00433cea((int *)&local_8,L"\"%ls\" /uninstall /kb:%ls /quiet /norestart");
      if ((int)DVar1 < 0) {
        pcVar5 = "Failed to format MSU uninstall command.";
      }
      else {
LAB_0041dc7e:
        if ((*(short **)(param_1 + 0xc) == (short *)0x0) || (**(short **)(param_1 + 0xc) == 0)) {
LAB_0041dcc9:
          FUN_0040e2bb(*(undefined4 *)(param_1 + 0x10));
          FUN_0040e8fd(param_2);
          FUN_00402003(2,0x2000012d);
          DVar1 = FUN_0041d8e0(&local_20,&local_24);
          if (-1 < (int)DVar1) {
            local_88.cb = 0x44;
            BVar2 = CreateProcessW(local_c,local_8,(LPSECURITY_ATTRIBUTES)0x0,
                                   (LPSECURITY_ATTRIBUTES)0x0,0,0x8000000,(LPVOID)0x0,(LPCWSTR)0x0,
                                   &local_88,&local_34);
            if (BVar2 == 0) {
              DVar3 = GetLastError();
              DVar1 = DVar3 & 0xffff | 0x80070000;
              if ((int)DVar3 < 1) {
                DVar1 = DVar3;
              }
              if (-1 < (int)DVar1) {
                DVar1 = 0x80004005;
              }
              FUN_004300d9();
              pcVar5 = "Failed to CreateProcess on path: %ls";
            }
            else {
              do {
                local_44 = 2;
                local_40 = 1;
                local_3c = 0x32;
                iVar4 = (*(code *)param_3)(&local_44,param_4);
                if ((iVar4 != 1) && (iVar4 != 0)) {
                  DVar1 = (iVar4 != 2) + 0x80070642;
                  FUN_004300d9();
                  pcVar5 = "Bootstrapper application aborted during MSU progress.";
                  goto LAB_0041de19;
                }
                DVar1 = FUN_00431fb6(local_34.hProcess,500,&local_1c);
              } while (DVar1 == 0x80070102);
              if (-1 < (int)DVar1) {
                BVar2 = GetExitCodeProcess(local_34.hProcess,&local_1c);
                if (BVar2 != 0) {
                  if (local_1c == 0x80070bc2) {
                    local_1c = 0xbc2;
                  }
                  if ((local_1c != 0) && (local_1c != 1)) {
                    if ((local_1c == 0xbc2) || (local_1c == 0x240005)) {
                      *param_5 = 1;
                    }
                    else if ((local_1c != 0x240006) && (DVar1 = local_1c, local_1c != 0x80240017))
                    goto LAB_0041de9c;
                  }
                  DVar1 = 0;
                  goto LAB_0041de9c;
                }
                DVar3 = GetLastError();
                DVar1 = DVar3 & 0xffff | 0x80070000;
                if ((int)DVar3 < 1) {
                  DVar1 = DVar3;
                }
                if (-1 < (int)DVar1) {
                  DVar1 = 0x80004005;
                }
                FUN_004300d9();
                pcVar5 = "Failed to get process exit code.";
                goto LAB_0041de19;
              }
              pcVar5 = "Failed to wait for executable to complete: %ls";
            }
LAB_0041de93:
            FUN_00430a57(DVar1,pcVar5);
            goto LAB_0041de9c;
          }
          pcVar5 = "Failed to ensure WU service was enabled to install MSU package.";
        }
        else {
          DVar1 = FUN_00433c35((int *)&local_8,L" /log:",0);
          if ((int)DVar1 < 0) {
            pcVar5 = "Failed to append log switch to MSU command-line.";
          }
          else {
            DVar1 = FUN_00433c35((int *)&local_8,*(short **)(param_1 + 0xc),0);
            if (-1 < (int)DVar1) goto LAB_0041dcc9;
            pcVar5 = "Failed to append log path to MSU command-line.";
          }
        }
      }
    }
    else if (*(int *)(param_1 + 0x10) == 2) {
      DVar1 = FUN_00413be9(1,*(undefined4 *)(*(int *)(param_1 + 8) + 0x24),(int *)&local_18);
      if ((int)DVar1 < 0) {
        pcVar5 = "Failed to get cached path for package: %ls";
        goto LAB_0041de93;
      }
      DVar1 = FUN_004314a9(local_18,*(LPCWSTR *)(**(int **)(*(int *)(param_1 + 8) + 0x7c) + 0x18),
                           (int *)&local_10);
      if ((int)DVar1 < 0) {
        pcVar5 = "Failed to build MSU path.";
      }
      else {
        DVar1 = FUN_00433cea((int *)&local_8,L"\"%ls\" \"%ls\" /quiet /norestart");
        if (-1 < (int)DVar1) goto LAB_0041dc7e;
        pcVar5 = "Failed to format MSU install command.";
      }
    }
    else {
      DVar1 = 0x8000ffff;
      pcVar5 = "Failed to get action arguments for MSU package.";
    }
  }
LAB_0041de19:
  FUN_00430a57(DVar1,pcVar5);
LAB_0041de9c:
  if (local_18 != (LPCWSTR)0x0) {
    FUN_004380ab(local_18);
  }
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_34.hProcess != (HANDLE)0x0) {
    CloseHandle(local_34.hProcess);
    local_34.hProcess = (HANDLE)0x0;
  }
  if (local_34.hThread != (HANDLE)0x0) {
    CloseHandle(local_34.hThread);
    local_34.hThread = (HANDLE)0x0;
  }
  if (local_24 != 0) {
    FUN_0041da76(local_20,4);
  }
  return DVar1;
}



/* Function: FUN_0041df1f */

void FUN_0041df1f(int param_1)

{
  if (*(LPVOID *)(param_1 + 0x94) != (LPVOID)0x0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x94));
    *(undefined4 *)(param_1 + 0x94) = 0;
  }
  if (*(LPVOID *)(param_1 + 0x90) != (LPVOID)0x0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x90));
    *(undefined4 *)(param_1 + 0x90) = 0;
  }
  return;
}



/* Function: FUN_0041df59 */

int FUN_0041df59(int *param_1,int param_2)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = FUN_00435b5e(param_1,&DAT_0044a9cc,(int *)(param_2 + 0x94));
  if (iVar1 < 0) {
    pcVar2 = "Failed to get @KB.";
  }
  else {
    iVar1 = FUN_00435b5e(param_1,L"DetectCondition",(int *)(param_2 + 0x90));
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to get @DetectCondition.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0041dfb1 */

int FUN_0041dfb1(int param_1,int param_2,undefined4 param_3,LPCRITICAL_SECTION param_4,int param_5,
                int param_6)

{
  int iVar1;
  char *pcVar2;
  undefined4 *local_8;
  
  local_8 = (undefined4 *)0x0;
  if ((param_5 == 0) || (iVar1 = FUN_0040cb9c(param_2,param_1,param_5,param_6), -1 < iVar1)) {
    iVar1 = FUN_0041ed32((uint *)0x0,param_1,param_2);
    if (iVar1 < 0) {
      pcVar2 = "Failed to plan package dependency actions.";
    }
    else {
      if (*(int *)(param_1 + 0x5c) != 0) {
        iVar1 = FUN_0040c979(param_2,(int *)&local_8);
        if (iVar1 < 0) {
          pcVar2 = "Failed to append execute action.";
          goto LAB_0041e066;
        }
        *local_8 = 7;
        local_8[2] = param_1;
        local_8[4] = *(undefined4 *)(param_1 + 0x5c);
        FUN_0040e915(param_1,0,0,param_3,param_4,local_8 + 3);
      }
      if (*(int *)(param_1 + 0x60) == 0) {
        return iVar1;
      }
      iVar1 = FUN_0040c9c2(param_2,(int *)&local_8);
      if (-1 < iVar1) {
        *local_8 = 7;
        local_8[2] = param_1;
        local_8[4] = *(undefined4 *)(param_1 + 0x60);
        FUN_0040e915(param_1,0,1,param_3,param_4,local_8 + 3);
        return iVar1;
      }
      pcVar2 = "Failed to append rollback action.";
    }
  }
  else {
    pcVar2 = "Failed to plan package cache syncpoint";
  }
LAB_0041e066:
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0041e0a7 */

undefined4 FUN_0041e0a7(int param_1)

{
  bool bVar1;
  int iVar2;
  uint uVar3;
  int iVar4;
  uint uVar5;
  char *pcVar6;
  undefined4 local_c;
  int local_8;
  
  uVar5 = 0;
  local_8 = 0;
  local_c = 0;
  FUN_00436186(&local_8,&local_c);
  uVar3 = 1;
  if (((*(short **)(param_1 + 0x94) == (short *)0x0) || (**(short **)(param_1 + 0x94) == 0)) ||
     (bVar1 = true, local_8 < 7)) {
    bVar1 = false;
  }
  if (*(int *)(param_1 + 0x40) == 2) {
    iVar2 = *(int *)(param_1 + 0x50);
    if ((iVar2 != 4) && (iVar2 != 5)) {
LAB_0041e120:
      uVar3 = 0;
      goto LAB_0041e1a1;
    }
    uVar3 = 2;
LAB_0041e14a:
    if (uVar3 == 0) goto LAB_0041e1a1;
  }
  else {
    if (*(int *)(param_1 + 0x40) != 4) {
      FUN_004300d9();
      pcVar6 = "Invalid package state.";
      goto LAB_0041e17c;
    }
    iVar2 = *(int *)(param_1 + 0x50);
    if (iVar2 == 1) {
      uVar3 = (uint)bVar1;
      goto LAB_0041e14a;
    }
    if (((iVar2 != 2) || (!bVar1)) || (*(int *)(param_1 + 0x18) == 0)) goto LAB_0041e120;
  }
  iVar4 = *(int *)(param_1 + 0x40);
  if (*(int *)(param_1 + 0x48) != 0) {
    iVar4 = *(int *)(param_1 + 0x48);
  }
  if (iVar4 == 2) {
    if ((iVar2 == 4) || (iVar2 == 5)) {
      uVar5 = (uint)bVar1;
    }
  }
  else {
    if (iVar4 != 4) {
      FUN_004300d9();
      pcVar6 = "Invalid package expected state.";
LAB_0041e17c:
      FUN_00430a57(0x80070057,pcVar6);
      return 0x80070057;
    }
    if ((iVar2 == 1) || (iVar2 == 2)) {
      uVar5 = 2;
    }
  }
LAB_0041e1a1:
  *(uint *)(param_1 + 0x5c) = uVar3;
  *(uint *)(param_1 + 0x60) = uVar5;
  return 0;
}



/* Function: FUN_0041e1b0 */

int FUN_0041e1b0(uint *param_1,undefined4 param_2,int param_3,int param_4,int param_5)

{
  int iVar1;
  char *pcVar2;
  undefined4 *local_8;
  
  iVar1 = 0;
  local_8 = (undefined4 *)0x0;
  if (param_5 == 0) {
LAB_0041e222:
    if (param_4 == 0) {
      return iVar1;
    }
    if (param_1 == (uint *)0x0) {
      iVar1 = FUN_0040c979(param_3,(int *)&local_8);
      if (iVar1 < 0) {
        pcVar2 = "Failed to append execute action.";
        goto LAB_0041e281;
      }
    }
    else {
      iVar1 = FUN_0040cef6(*param_1,param_3,(int *)&local_8);
      if (iVar1 < 0) {
        pcVar2 = "Failed to insert execute action.";
        goto LAB_0041e281;
      }
      *param_1 = *param_1 + 1;
    }
    *local_8 = 0xb;
    local_8[2] = param_2;
    local_8[4] = param_4;
    iVar1 = FUN_00433f88(local_8 + 3,*(LPCWSTR *)(param_3 + 8),0);
    if (-1 < iVar1) {
      return iVar1;
    }
  }
  else {
    iVar1 = FUN_0040c9c2(param_3,(int *)&local_8);
    if (iVar1 < 0) {
      pcVar2 = "Failed to append rollback action.";
      goto LAB_0041e281;
    }
    *local_8 = 0xb;
    local_8[2] = param_2;
    local_8[4] = param_5;
    iVar1 = FUN_00433f88(local_8 + 3,*(LPCWSTR *)(param_3 + 8),0);
    if (-1 < iVar1) {
      iVar1 = FUN_0040dd6d(param_3);
      if (iVar1 < 0) {
        pcVar2 = "Failed to plan dependency checkpoint action.";
        goto LAB_0041e281;
      }
      goto LAB_0041e222;
    }
  }
  pcVar2 = "Failed to copy the bundle dependency provider.";
LAB_0041e281:
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0041e2a4 */

void FUN_0041e2a4(int param_1,int param_2,int *param_3,undefined4 *param_4)

{
  int iVar1;
  
  if (param_2 == 3) {
switchD_0041e2d6_caseD_1:
    *param_3 = 2;
  }
  else {
    if (param_2 == 4) {
      *param_4 = 2;
    }
    else if ((param_2 != 5) && (param_2 != 6)) goto switchD_0041e2d6_caseD_3;
    switch(*(undefined4 *)(param_1 + 0x5c)) {
    case 0:
      if (((*(int *)(param_1 + 0x50) != 4) && (*(int *)(param_1 + 0x50) != 5)) ||
         ((*(int *)(param_1 + 0x40) != 4 && (*(int *)(param_1 + 0x40) != 5)))) break;
    case 2:
    case 4:
    case 5:
    case 6:
    case 7:
    case 8:
      *param_3 = 1;
      break;
    case 1:
      goto switchD_0041e2d6_caseD_1;
    default:
      break;
    }
  }
switchD_0041e2d6_caseD_3:
  if (*param_3 == 1) {
    iVar1 = *(int *)(param_1 + 0x40);
    if (((iVar1 == 1) || (iVar1 == 2)) || (iVar1 == 3)) {
      *param_4 = 2;
    }
  }
  else if ((*param_3 == 2) && ((*(int *)(param_1 + 0x40) == 4 || (*(int *)(param_1 + 0x40) == 5))))
  {
    *param_4 = 1;
  }
  return;
}



/* Function: FUN_0041e34c */

int FUN_0041e34c(uint param_1,int param_2,undefined4 *param_3)

{
  int iVar1;
  wchar_t *pwVar2;
  uint uVar3;
  char *pcVar4;
  wchar_t *local_c;
  wchar_t *local_8;
  
  local_8 = (wchar_t *)0x0;
  local_c = (wchar_t *)0x0;
  iVar1 = FUN_00437ee1(param_3,0x30,1);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to create the string dictionary.");
    goto LAB_0041e447;
  }
  iVar1 = FUN_00437da1((int *)*param_3,*(LPCWSTR *)(param_2 + 8));
  if (iVar1 < 0) {
    pcVar4 = "Failed to add the bundle provider key \"%ls\" to the list of ignored dependencies.";
  }
  else {
    uVar3 = 0;
    if (*(int *)(param_2 + 0x78) != 0) {
      do {
        iVar1 = FUN_00437da1((int *)*param_3,*(LPCWSTR *)(*(int *)(param_2 + 0x74) + uVar3 * 8));
        if (iVar1 < 0) {
          pcVar4 = 
          "Failed to add the package provider key \"%ls\" to the list of ignored dependencies.";
          goto LAB_0041e439;
        }
        uVar3 = uVar3 + 1;
      } while (uVar3 < *(uint *)(param_2 + 0x78));
    }
    iVar1 = FUN_00408ec2(param_1,L"IGNOREDEPENDENCIES",(int *)&local_8);
    if (iVar1 == -0x7ff8fb70) {
      iVar1 = 0;
      goto LAB_0041e447;
    }
    pwVar2 = local_8;
    if (-1 < iVar1) {
      while (pwVar2 = _wcstok_s(pwVar2,L";",&local_c), pwVar2 != (wchar_t *)0x0) {
        iVar1 = FUN_00437da1((int *)*param_3,pwVar2);
        if (iVar1 < 0) {
          pcVar4 = "Failed to add the provider key \"%ls\" to the list of ignored dependencies.";
          goto LAB_0041e439;
        }
        pwVar2 = (wchar_t *)0x0;
      }
      goto LAB_0041e447;
    }
    pcVar4 = "Failed to get the package property: %ls";
  }
LAB_0041e439:
  FUN_00430a57(iVar1,pcVar4);
LAB_0041e447:
  if (local_8 != (wchar_t *)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_0041e45d */

int FUN_0041e45d(int *param_1,undefined4 *param_2,uint param_3)

{
  uint uVar1;
  int iVar2;
  char *pcVar3;
  int *local_8;
  
  uVar1 = param_3;
  local_8 = (int *)0x0;
  if (param_3 == 0) {
    iVar2 = 0;
  }
  else {
    iVar2 = FUN_00437ee1(&local_8,0x30,1);
    if (iVar2 < 0) {
      FUN_00430a57(iVar2,"Failed to create the string dictionary.");
    }
    else {
      param_3 = 0;
      if (uVar1 != 0) {
        do {
          iVar2 = FUN_0043805f(local_8,(LPCWSTR)*param_2);
          if (iVar2 == -0x7ff8fb70) {
            if ((param_3 == 0) ||
               (iVar2 = FUN_00433c35(param_1,(short *)&DAT_0044a344,1), -1 < iVar2)) {
              iVar2 = FUN_00433c35(param_1,(short *)*param_2,0);
              if (iVar2 < 0) {
                pcVar3 = "Failed to append the key \"%ls\".";
              }
              else {
                iVar2 = FUN_00437da1(local_8,(LPCWSTR)*param_2);
                if (-1 < iVar2) goto LAB_0041e506;
                pcVar3 = "Failed to add \"%ls\" to the string dictionary.";
              }
              FUN_00430a57(iVar2,pcVar3);
            }
            else {
              pcVar3 = "Failed to append the string delimiter.";
LAB_0041e51b:
              FUN_00430a57(iVar2,pcVar3);
            }
            break;
          }
          if (iVar2 < 0) {
            pcVar3 = "Failed to check the dictionary of unique dependencies.";
            goto LAB_0041e51b;
          }
LAB_0041e506:
          param_3 = param_3 + 1;
          param_2 = param_2 + 2;
        } while (param_3 < uVar1);
      }
    }
    if (local_8 != (int *)0x0) {
      FUN_0043800c(local_8);
    }
  }
  return iVar2;
}



/* Function: FUN_0041e553 */

uint FUN_0041e553(uint param_1,int param_2,undefined4 param_3)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  bool bVar4;
  
  iVar2 = param_2;
  bVar4 = param_1 != 0;
  uVar3 = 0;
  if (param_1 == *(uint *)(param_2 + 0x14)) {
    if ((*(int *)(param_2 + 0x84) != 0) && (param_1 = 0, *(int *)(param_2 + 0x88) != 0)) {
      param_2 = 0;
      do {
        iVar1 = *(int *)(iVar2 + 0x84);
        FUN_00402003(3,0x20000145);
        uVar3 = FUN_004390f7(bVar4 + 0x80000001,*(short **)(iVar1 + param_2),param_3,(short *)0x0,
                             (short *)0x0,0);
        if (uVar3 == 0x80070002) {
          if (*(int *)(iVar2 + 0x1c) != 0) {
LAB_0041e634:
            FUN_00430a57(uVar3,
                         "Failed to register the dependency on package dependency provider: %ls");
            return uVar3;
          }
          FUN_00402003(3,0xa0000144);
          uVar3 = 0;
        }
        else if ((int)uVar3 < 0) goto LAB_0041e634;
        param_1 = param_1 + 1;
        param_2 = param_2 + 0x10;
      } while (param_1 < *(uint *)(iVar2 + 0x88));
    }
  }
  else {
    FUN_0040e7bb(*(uint *)(param_2 + 0x14));
    FUN_0040e7bb(param_1);
    FUN_00402003(2,0xa0000142);
  }
  return uVar3;
}



/* Function: FUN_0041e650 */

uint FUN_0041e650(uint param_1)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  undefined4 *puVar4;
  int local_8;
  
  uVar2 = param_1;
  uVar3 = 0;
  iVar1 = *(int *)(param_1 + 0x14);
  if ((*(int *)(param_1 + 0x84) != 0) && (param_1 = 0, *(int *)(uVar2 + 0x88) != 0)) {
    local_8 = 0;
    do {
      puVar4 = (undefined4 *)(*(int *)(uVar2 + 0x84) + local_8);
      if (puVar4[3] == 0) {
        FUN_00402003(3,0x20000143);
        uVar3 = FUN_0043902f((iVar1 != 0) + 0x80000001,(short *)*puVar4,(short *)puVar4[1],
                             (short *)puVar4[2],(short *)0x0,0);
        if ((int)uVar3 < 0) {
          FUN_00430a57(uVar3,"Failed to register the package dependency provider: %ls");
          break;
        }
      }
      param_1 = param_1 + 1;
      local_8 = local_8 + 0x10;
    } while (param_1 < *(uint *)(uVar2 + 0x88));
  }
  if (*(int *)(uVar2 + 0x1c) == 0) {
    uVar3 = 0;
  }
  return uVar3;
}



/* Function: FUN_0041e700 */

int FUN_0041e700(wchar_t *param_1,int *param_2,uint *param_3)

{
  int iVar1;
  wchar_t *pwVar2;
  char *pcVar3;
  wchar_t *local_c;
  int *local_8;
  
  local_c = (wchar_t *)0x0;
  local_8 = (int *)0x0;
  iVar1 = FUN_00437ee1(&local_8,0x30,1);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to create the string dictionary.");
  }
  else {
    while (pwVar2 = _wcstok_s(param_1,L";",&local_c), pwVar2 != (wchar_t *)0x0) {
      iVar1 = FUN_0043805f(local_8,pwVar2);
      if (iVar1 == -0x7ff8fb70) {
        iVar1 = FUN_00438e0c(param_2,param_3,pwVar2,(LPCWSTR)0x0);
        if (iVar1 < 0) {
          pcVar3 = "Failed to add \"%ls\" to the list of dependencies to ignore.";
        }
        else {
          iVar1 = FUN_00437da1(local_8,pwVar2);
          if (-1 < iVar1) goto LAB_0041e78b;
          pcVar3 = "Failed to add \"%ls\" to the string dictionary.";
        }
        FUN_00430a57(iVar1,pcVar3);
        break;
      }
      if (iVar1 < 0) {
        FUN_00430a57(iVar1,"Failed to check the dictionary of unique dependencies.");
        break;
      }
LAB_0041e78b:
      param_1 = (wchar_t *)0x0;
    }
  }
  if (local_8 != (int *)0x0) {
    FUN_0043800c(local_8);
  }
  return iVar1;
}



/* Function: FUN_0041e7d1 */

void FUN_0041e7d1(int param_1,int param_2,LPCWSTR param_3)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  
  iVar1 = param_2;
  if (param_1 == *(int *)(param_2 + 0x14)) {
    uVar3 = 0;
    if ((*(int *)(param_2 + 0x84) != 0) && (*(int *)(param_2 + 0x88) != 0)) {
      param_2 = 0;
      do {
        uVar2 = FUN_00439252((param_1 != 0) + 0x80000001,
                             *(LPCWSTR *)(*(int *)(iVar1 + 0x84) + param_2),param_3);
        if ((int)uVar2 < 0) {
          if (uVar2 != 0x80070002) {
            FUN_00402003(3,0xa000014b);
          }
        }
        else {
          FUN_00402003(3,0x20000146);
        }
        uVar3 = uVar3 + 1;
        param_2 = param_2 + 0x10;
      } while (uVar3 < *(uint *)(iVar1 + 0x88));
    }
  }
  else {
    FUN_0040e7bb(*(int *)(param_2 + 0x14));
    FUN_0040e7bb(param_1);
    FUN_00402003(2,0xa0000142);
  }
  return;
}



/* Function: FUN_0041e898 */

void FUN_0041e898(int param_1)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  undefined4 *puVar4;
  uint local_8;
  
  iVar2 = param_1;
  iVar1 = *(int *)(param_1 + 0x14);
  if ((*(int *)(param_1 + 0x84) != 0) && (local_8 = 0, *(int *)(param_1 + 0x88) != 0)) {
    param_1 = 0;
    do {
      puVar4 = (undefined4 *)(*(int *)(iVar2 + 0x84) + param_1);
      if (puVar4[3] == 0) {
        uVar3 = FUN_00439211((iVar1 != 0) + 0x80000001,(short *)*puVar4);
        if ((int)uVar3 < 0) {
          if (uVar3 != 0x80070002) {
            FUN_00402003(3,0xa000014c);
          }
        }
        else {
          FUN_00402003(3,0x20000149);
        }
      }
      local_8 = local_8 + 1;
      param_1 = param_1 + 0x10;
    } while (local_8 < *(uint *)(iVar2 + 0x88));
  }
  return;
}



/* Function: FUN_0041e934 */

int FUN_0041e934(int *param_1,wchar_t *param_2)

{
  wchar_t *pwVar1;
  int iVar2;
  wchar_t *local_8;
  
  iVar2 = 0;
  local_8 = (wchar_t *)0x0;
  do {
    pwVar1 = _wcstok_s(param_2,L";",&local_8);
    if (pwVar1 == (wchar_t *)0x0) {
      return iVar2;
    }
    iVar2 = FUN_0043805f(param_1,pwVar1);
    if (iVar2 == -0x7ff8fb70) {
      iVar2 = FUN_00437da1(param_1,pwVar1);
      if (iVar2 < 0) {
        FUN_00430a57(iVar2,"Failed to add \"%ls\" to the string dictionary.");
        return iVar2;
      }
    }
    else if (iVar2 < 0) {
      FUN_00430a57(iVar2,"Failed to check the dictionary of unique dependencies.");
      return iVar2;
    }
    param_2 = (wchar_t *)0x0;
  } while( true );
}



/* Function: FUN_0041e9b3 */

int FUN_0041e9b3(int param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = 0;
  if (*(int *)(param_1 + 0x78) != 0) {
    iVar1 = FUN_0041e45d(param_2,*(undefined4 **)(param_1 + 0x74),*(uint *)(param_1 + 0x78));
    if (iVar1 < 0) {
      FUN_00430a57(iVar1,"Failed to join the list of dependencies to ignore.");
    }
  }
  return iVar1;
}



/* Function: FUN_0041e9e9 */

bool FUN_0041e9e9(int param_1)

{
  uint uVar1;
  
  uVar1 = FUN_00438ee3(*(undefined4 *)(param_1 + 0x4c));
  return -1 < (int)uVar1;
}



/* Function: FUN_0041ea0a */

uint FUN_0041ea0a(int param_1)

{
  int *piVar1;
  uint uVar2;
  char *pcVar3;
  
  piVar1 = (int *)(param_1 + 0xbc);
  uVar2 = FUN_00438f58(*(undefined4 *)(param_1 + 0x4c),*(short **)(param_1 + 0x44),piVar1,(int *)0x0
                       ,(uint *)0x0);
  if (uVar2 == 0x80070490) {
    return 0x80070490;
  }
  if ((int)uVar2 < 0) {
    pcVar3 = "Failed to get provider key bundle id.";
  }
  else {
    if (((short *)*piVar1 != (short *)0x0) && (*(short *)*piVar1 != 0)) {
      return uVar2;
    }
    uVar2 = FUN_00433f88(piVar1,*(LPCWSTR *)(param_1 + 0x44),0);
    if (-1 < (int)uVar2) {
      return uVar2;
    }
    pcVar3 = "Failed to initialize provider key bundle id.";
  }
  FUN_00430a57(uVar2,pcVar3);
  return uVar2;
}



/* Function: FUN_0041ea71 */

uint FUN_0041ea71(uint param_1,int param_2)

{
  int iVar1;
  uint uVar2;
  
  uVar2 = 0;
  iVar1 = *(int *)(param_2 + 8);
  if (*(int *)(param_2 + 0x10) == 1) {
    uVar2 = FUN_0041e553(param_1,iVar1,*(undefined4 *)(param_2 + 0xc));
    if ((int)uVar2 < 0) {
      FUN_00430a57(uVar2,"Failed to register the dependency on the package provider.");
    }
  }
  else if (*(int *)(param_2 + 0x10) == 2) {
    FUN_0041e7d1(param_1,iVar1,*(LPCWSTR *)(param_2 + 0xc));
  }
  if (*(int *)(iVar1 + 0x1c) == 0) {
    uVar2 = 0;
  }
  return uVar2;
}



/* Function: FUN_0041eac7 */

uint FUN_0041eac7(int param_1)

{
  uint uVar1;
  uint uVar2;
  
  uVar1 = *(uint *)(param_1 + 8);
  uVar2 = 0;
  if (*(int *)(param_1 + 0xc) == 1) {
    uVar2 = FUN_0041e650(uVar1);
    if ((int)uVar2 < 0) {
      FUN_00430a57(uVar2,"Failed to register the package providers.");
    }
  }
  else if (*(int *)(param_1 + 0xc) == 2) {
    FUN_0041e898(uVar1);
  }
  if (*(int *)(uVar1 + 0x1c) == 0) {
    uVar2 = 0;
  }
  return uVar2;
}



/* Function: FUN_0041eb12 */

uint FUN_0041eb12(int param_1,int *param_2)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  int *piVar4;
  char *pcVar5;
  int *local_10;
  uint local_c;
  int *local_8;
  
  local_10 = (int *)0x0;
  local_c = 0;
  local_8 = (int *)0x0;
  uVar1 = FUN_00435fbe(param_2,L"Provides",(int)&local_10);
  if ((int)uVar1 < 0) {
    pcVar5 = "Failed to select dependency provider nodes.";
  }
  else {
    uVar1 = (**(code **)(*local_10 + 0x20))(local_10,&local_c);
    if ((int)uVar1 < 0) {
      pcVar5 = "Failed to get the dependency provider node count.";
    }
    else {
      if (local_c == 0) {
        uVar1 = 0;
        goto LAB_0041ecb0;
      }
      iVar2 = FUN_00431078(local_c << 4,1);
      *(int *)(param_1 + 0x84) = iVar2;
      if (iVar2 != 0) {
        uVar3 = 0;
        *(uint *)(param_1 + 0x88) = local_c;
        if (local_c != 0) {
          param_2 = (int *)0x0;
          do {
            piVar4 = (int *)(*(int *)(param_1 + 0x84) + (int)param_2);
            uVar1 = FUN_00435f1d(local_10,&local_8,(undefined4 *)0x0);
            if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get the next dependency provider node.";
LAB_0041eca2:
              FUN_00430a57(uVar1,pcVar5);
              goto LAB_0041ecb0;
            }
            uVar1 = FUN_00435b5e(local_8,&DAT_0043dc68,piVar4);
            if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get the Key attribute.";
              goto LAB_0041eca2;
            }
            uVar1 = FUN_00435b5e(local_8,L"Version",piVar4 + 1);
            if ((uVar1 != 0x80070490) && ((int)uVar1 < 0)) {
              pcVar5 = "Failed to get the Version attribute.";
              goto LAB_0041eca2;
            }
            uVar1 = FUN_00435b5e(local_8,L"DisplayName",piVar4 + 2);
            if ((uVar1 != 0x80070490) && ((int)uVar1 < 0)) {
              pcVar5 = "Failed to get the DisplayName attribute.";
              goto LAB_0041eca2;
            }
            uVar1 = FUN_00435d6c(local_8,L"Imported",(uint *)(piVar4 + 3));
            if (uVar1 == 0x80070490) {
              piVar4[3] = 0;
            }
            else if ((int)uVar1 < 0) {
              pcVar5 = "Failed to get the Imported attribute.";
              goto LAB_0041eca2;
            }
            if (local_8 != (int *)0x0) {
              (**(code **)(*local_8 + 8))(local_8);
              local_8 = (int *)0x0;
            }
            uVar3 = uVar3 + 1;
            param_2 = param_2 + 4;
          } while (uVar3 < local_c);
        }
        uVar1 = 0;
        goto LAB_0041ecb0;
      }
      uVar1 = 0x8007000e;
      FUN_004300d9();
      pcVar5 = "Failed to allocate memory for dependency providers.";
    }
  }
  FUN_00430a57(uVar1,pcVar5);
LAB_0041ecb0:
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  return uVar1;
}



/* Function: FUN_0041ecd1 */

int FUN_0041ecd1(int param_1,int param_2)

{
  int iVar1;
  char *pcVar2;
  
  iVar1 = FUN_00438e0c((int *)(param_2 + 0x74),(uint *)(param_2 + 0x78),
                       *(LPCWSTR *)(param_1 + 0x13c),(LPCWSTR)0x0);
  if (iVar1 < 0) {
    pcVar2 = "Failed to add the bundle provider key to the list of dependencies to ignore.";
  }
  else {
    if (*(wchar_t **)(param_1 + 0x4a4) == (wchar_t *)0x0) {
      return iVar1;
    }
    iVar1 = FUN_0041e700(*(wchar_t **)(param_1 + 0x4a4),(int *)(param_2 + 0x74),
                         (uint *)(param_2 + 0x78));
    if (-1 < iVar1) {
      return iVar1;
    }
    pcVar2 = "Failed to split the list of dependencies to ignore.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0041ed32 */

int FUN_0041ed32(uint *param_1,int param_2,int param_3)

{
  int iVar1;
  char *pcVar2;
  undefined4 *local_8;
  
  iVar1 = 0;
  local_8 = (undefined4 *)0x0;
  if ((*(int *)(param_2 + 0x6c) == 2) &&
     (iVar1 = FUN_0041e1b0(param_1,param_2,param_3,2,*(int *)(param_2 + 0x70)), iVar1 < 0)) {
    FUN_00430a57(iVar1,"Failed to plan the dependency actions for package: %ls");
    return iVar1;
  }
  if (*(int *)(param_2 + 0x68) != 0) {
    iVar1 = FUN_0040c9c2(param_3,(int *)&local_8);
    if (iVar1 < 0) {
      pcVar2 = "Failed to append provider rollback action.";
      goto LAB_0041ee1b;
    }
    *local_8 = 10;
    local_8[2] = param_2;
    local_8[3] = *(undefined4 *)(param_2 + 0x68);
    iVar1 = FUN_0040dd6d(param_3);
    if (iVar1 < 0) {
      pcVar2 = "Failed to plan provider checkpoint action.";
      goto LAB_0041ee1b;
    }
  }
  if (*(int *)(param_2 + 100) == 0) {
    return iVar1;
  }
  if (param_1 == (uint *)0x0) {
    iVar1 = FUN_0040c979(param_3,(int *)&local_8);
    if (-1 < iVar1) goto LAB_0041edea;
    pcVar2 = "Failed to append provider execute action.";
  }
  else {
    iVar1 = FUN_0040cef6(*param_1,param_3,(int *)&local_8);
    if (-1 < iVar1) {
      *param_1 = *param_1 + 1;
LAB_0041edea:
      *local_8 = 10;
      local_8[2] = param_2;
      local_8[3] = *(undefined4 *)(param_2 + 100);
      return iVar1;
    }
    pcVar2 = "Failed to insert provider execute action.";
  }
LAB_0041ee1b:
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_0041ee25 */

uint FUN_0041ee25(uint param_1,uint param_2,int *param_3)

{
  int *piVar1;
  int *piVar2;
  uint uVar3;
  uint uVar4;
  char *pcVar5;
  int local_1c;
  undefined4 local_18;
  int local_14;
  LPVOID local_10;
  int *local_c;
  uint local_8;
  
  piVar1 = param_3;
  uVar4 = *(uint *)(param_2 + 0x14);
  uVar3 = 0;
  local_c = (int *)0x0;
  local_10 = (LPVOID)0x0;
  local_8 = 0;
  local_14 = 0;
  local_18 = 0;
  *(undefined4 *)(param_2 + 0x6c) = 0;
  *(undefined4 *)(param_2 + 0x70) = 0;
  if (*(int *)(param_2 + 0x88) == 0) {
    FUN_00402003(3,0xa0000141);
    goto LAB_0041f068;
  }
  if (param_1 != uVar4) {
    FUN_0040e7bb(uVar4);
    FUN_0040e7bb(param_1);
    FUN_00402003(2,0xa0000142);
    goto LAB_0041f068;
  }
  if (*(int *)(param_2 + 0x5c) == 1) {
    uVar3 = FUN_0041e34c(param_2,(int)param_3,&local_c);
    if ((int)uVar3 < 0) {
      pcVar5 = "Failed to build the list of ignored dependents.";
LAB_0041eee7:
      FUN_00430a57(uVar3,pcVar5);
      goto LAB_0041f068;
    }
    uVar3 = FUN_0043805f(local_c,L"ALL");
    if (uVar3 == 0x80070490) {
      param_1 = 0;
      if (*(int *)(param_2 + 0x88) != 0) {
        local_1c = 0;
        do {
          uVar3 = FUN_00438ce4((uVar4 != 0) + 0x80000001,
                               *(short **)(*(int *)(param_2 + 0x84) + local_1c),0,local_c,
                               (int *)&local_10,&local_8);
          if (uVar3 == 0x80070002) {
            uVar3 = 0;
          }
          else if ((int)uVar3 < 0) {
            pcVar5 = "Failed dependents check on package provider: %ls";
            goto LAB_0041f097;
          }
          param_1 = param_1 + 1;
          local_1c = local_1c + 0x10;
        } while (param_1 < *(uint *)(param_2 + 0x88));
      }
    }
    else if ((int)uVar3 < 0) {
      pcVar5 = "Failed to check if \"ALL\" was set in IGNOREDEPENDENCIES.";
      goto LAB_0041eee7;
    }
  }
  FUN_0041e2a4(param_2,*param_3,&local_14,&local_18);
  if (local_8 == 0) {
    uVar4 = 0;
    if (*(uint *)(param_2 + 0x88) != 0) {
      piVar2 = (int *)(*(int *)(param_2 + 0x84) + 0xc);
      do {
        if (*piVar2 == 0) {
          *(int *)(param_2 + 100) = local_14;
          *(undefined4 *)(param_2 + 0x68) = local_18;
          break;
        }
        uVar4 = uVar4 + 1;
        piVar2 = piVar2 + 4;
      } while (uVar4 < *(uint *)(param_2 + 0x88));
    }
  }
  else {
    FUN_00402003(2,0xa0000147);
    if (local_8 != 0) {
      uVar4 = 0;
      do {
        FUN_0040ea12(*(wchar_t **)((int)local_10 + uVar4 * 8 + 4));
        FUN_00402003(3,0xa0000148);
        uVar4 = uVar4 + 1;
      } while (uVar4 < local_8);
    }
    *(undefined4 *)(param_2 + 0x74) = 1;
    *(undefined4 *)(param_2 + 0x5c) = 0;
    *(undefined4 *)(param_2 + 0x60) = 0;
  }
  if ((*(int *)(param_2 + 0x5c) == 1) && (param_1 = 0, *(int *)(param_2 + 0x88) != 0)) {
    param_3 = (int *)0x0;
    do {
      uVar3 = FUN_00438e0c(piVar1 + 0x1d,(uint *)(piVar1 + 0x1e),
                           *(LPCWSTR *)(*(int *)(param_2 + 0x84) + (int)param_3),(LPCWSTR)0x0);
      if ((int)uVar3 < 0) {
        pcVar5 = "Failed to add the package provider key \"%ls\" to the planned list.";
LAB_0041f097:
        FUN_00430a57(uVar3,pcVar5);
        goto LAB_0041f068;
      }
      param_1 = param_1 + 1;
      param_3 = param_3 + 4;
    } while (param_1 < *(uint *)(param_2 + 0x88));
  }
  *(int *)(param_2 + 0x6c) = local_14;
  *(undefined4 *)(param_2 + 0x70) = local_18;
LAB_0041f068:
  if (local_10 != (LPVOID)0x0) {
    FUN_00438ea2(local_10,local_8);
  }
  if (local_c != (int *)0x0) {
    FUN_0043800c(local_c);
  }
  return uVar3;
}



/* Function: FUN_0041f0a2 */

int FUN_0041f0a2(int param_1,int *param_2)

{
  int *piVar1;
  int iVar2;
  
  iVar2 = 0;
  piVar1 = (int *)(param_1 + 0x6c);
  if (*piVar1 == 1) {
    FUN_0041e2a4(param_1,*param_2,piVar1,(undefined4 *)(param_1 + 0x70));
    if (*piVar1 == 1) {
      iVar2 = FUN_0041e1b0((uint *)0x0,param_1,(int)param_2,1,*(int *)(param_1 + 0x70));
      if (iVar2 < 0) {
        FUN_00430a57(iVar2,"Failed to plan the dependency actions for package: %ls");
      }
    }
  }
  return iVar2;
}



/* Function: FUN_0041f0f8 */

uint FUN_0041f0f8(int param_1,int *param_2)

{
  uint uVar1;
  char *pcVar2;
  
  if (*param_2 == 1) {
    uVar1 = FUN_004390f7(*(undefined4 *)(param_1 + 0x4c),*(short **)(param_1 + 0x44),param_2[2],
                         (short *)0x0,(short *)0x0,0);
    if (-1 < (int)uVar1) {
      return uVar1;
    }
    pcVar2 = "Failed to register dependent: %ls";
  }
  else if (*param_2 == 2) {
    uVar1 = FUN_00439252(*(undefined4 *)(param_1 + 0x4c),*(LPCWSTR *)(param_1 + 0x44),
                         (LPCWSTR)param_2[2]);
    if (-1 < (int)uVar1) {
      return uVar1;
    }
    pcVar2 = "Failed to unregister dependent: %ls";
  }
  else {
    uVar1 = 0x80070057;
    FUN_004300d9();
    pcVar2 = "Unrecognized registration action type: %d";
  }
  FUN_00430a57(uVar1,pcVar2);
  return uVar1;
}



/* Function: FUN_0041f17c */

uint FUN_0041f17c(int param_1)

{
  uint uVar1;
  char *pcVar2;
  short *local_8;
  
  local_8 = (short *)0x0;
  uVar1 = FUN_004372e6(*(undefined4 *)(param_1 + 0x38),*(undefined4 *)(param_1 + 0x3c),
                       (int *)&local_8);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to format the registration version string.";
  }
  else {
    FUN_00402003(3,0x20000140);
    uVar1 = FUN_0043902f(*(undefined4 *)(param_1 + 0x4c),*(short **)(param_1 + 0x44),local_8,
                         *(short **)(param_1 + 0x60),*(short **)(param_1 + 0xc),0);
    if (-1 < (int)uVar1) goto LAB_0041f1e3;
    pcVar2 = "Failed to register the bundle dependency provider.";
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_0041f1e3:
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_0041f1f9 */

void FUN_0041f1f9(int *param_1)

{
  if (*param_1 != 0) {
    FUN_004380ab((LPVOID)*param_1);
  }
  if (param_1[1] != 0) {
    FUN_004380ab((LPVOID)param_1[1]);
  }
  if (param_1[2] != 0) {
    FUN_004380ab((LPVOID)param_1[2]);
  }
  *param_1 = 0;
  param_1[1] = 0;
  param_1[2] = 0;
  param_1[3] = 0;
  return;
}



/* Function: FUN_0041f233 */

void FUN_0041f233(int param_1)

{
  uint uVar1;
  
  uVar1 = FUN_00439211(*(undefined4 *)(param_1 + 0x4c),*(short **)(param_1 + 0x44));
  if ((int)uVar1 < 0) {
    if (uVar1 != 0x80070002) {
      FUN_00402003(3,0xa000014d);
    }
  }
  else {
    FUN_00402003(3,0x2000014a);
  }
  return;
}



/* Function: FUN_0041f27c */

uint FUN_0041f27c(undefined4 param_1,int param_2,int *param_3)

{
  uint uVar1;
  char *pcVar2;
  uint local_34;
  uint local_30;
  LPVOID local_2c;
  uint local_28;
  uint local_24;
  LPVOID local_20;
  int *local_1c;
  LPVOID local_18;
  int *local_14;
  int *local_10;
  int *local_c;
  int *local_8;
  
  local_c = (int *)0x0;
  local_24 = 0;
  local_8 = (int *)0x0;
  local_18 = (LPVOID)0x0;
  local_28 = 0;
  local_10 = (int *)0x0;
  local_2c = (LPVOID)0x0;
  local_30 = 0;
  local_1c = (int *)0x0;
  local_20 = (LPVOID)0x0;
  local_34 = 0;
  local_14 = (int *)0x0;
  *param_3 = 0;
  uVar1 = FUN_00432757(param_1,L"BundleUpgradeCode",(int *)&local_c,&local_24);
  if (uVar1 == 0x8007070c) {
    local_c = (int *)FUN_00431078(4,1);
    if (local_c == (int *)0x0) {
      uVar1 = 0x8007000e;
      FUN_004300d9();
      FUN_00430a57(0x8007000e,"Failed to allocate list for a single upgrade code from older bundle."
                  );
      goto LAB_0041f669;
    }
    uVar1 = FUN_00432602(param_1,L"BundleUpgradeCode",local_c);
    if (-1 < (int)uVar1) {
      local_24 = 1;
      goto LAB_0041f329;
    }
LAB_0041f3ee:
    uVar1 = FUN_00432757(param_1,L"BundleAddonCode",(int *)&local_18,&local_28);
    if (-1 < (int)uVar1) {
      uVar1 = FUN_00437f99(&local_10,(int)local_18,local_28,1);
      if (-1 < (int)uVar1) {
        uVar1 = FUN_00437ea7(local_10,*(int *)(param_2 + 0x14),*(uint *)(param_2 + 0x18));
        if ((uVar1 == 0x80070491) &&
           (uVar1 = FUN_00437ea7(local_10,*(int *)(param_2 + 0x1c),*(uint *)(param_2 + 0x20)),
           uVar1 == 0x80070491)) {
          if (local_10 != (int *)0x0) {
            FUN_0043800c(local_10);
            local_10 = (int *)0x0;
          }
          if (local_18 != (LPVOID)0x0) {
            FUN_00434413(local_18,local_28);
            local_28 = 0;
            local_18 = (LPVOID)0x0;
          }
          goto LAB_0041f4a4;
        }
        if (-1 < (int)uVar1) {
          *param_3 = 3;
          goto LAB_0041f65a;
        }
LAB_0041f632:
        pcVar2 = "Failed to do array search for addon code match.";
        goto LAB_0041f637;
      }
LAB_0041f590:
      FUN_00430a57(uVar1,"Failed to create string dictionary for %hs.");
      goto LAB_0041f65a;
    }
LAB_0041f4a4:
    uVar1 = FUN_00432757(param_1,L"BundlePatchCode",(int *)&local_20,&local_34);
    if (-1 < (int)uVar1) {
      uVar1 = FUN_00437f99(&local_14,(int)local_20,local_34,1);
      if ((int)uVar1 < 0) goto LAB_0041f590;
      uVar1 = FUN_00437ea7(local_14,*(int *)(param_2 + 0x14),*(uint *)(param_2 + 0x18));
      if ((uVar1 == 0x80070491) &&
         (uVar1 = FUN_00437ea7(local_14,*(int *)(param_2 + 0x1c),*(uint *)(param_2 + 0x20)),
         uVar1 == 0x80070491)) {
        if (local_14 != (int *)0x0) {
          FUN_0043800c(local_14);
          local_14 = (int *)0x0;
        }
        if (local_20 != (LPVOID)0x0) {
          FUN_00434413(local_20,local_34);
          local_34 = 0;
          local_20 = (LPVOID)0x0;
        }
        goto LAB_0041f555;
      }
      if ((int)uVar1 < 0) {
        pcVar2 = "Failed to do array search for patch code match.";
        goto LAB_0041f637;
      }
      *param_3 = 4;
      goto LAB_0041f65a;
    }
LAB_0041f555:
    uVar1 = FUN_00432757(param_1,L"BundleDetectCode",(int *)&local_2c,&local_30);
    if ((int)uVar1 < 0) goto LAB_0041f669;
    uVar1 = FUN_00437f99(&local_1c,(int)local_2c,local_30,1);
    if ((int)uVar1 < 0) goto LAB_0041f590;
    uVar1 = FUN_00437ea7(local_1c,*(int *)(param_2 + 0x14),*(uint *)(param_2 + 0x18));
    if (uVar1 != 0x80070491) goto LAB_0041f649;
    uVar1 = FUN_00437ea7(local_1c,*(int *)(param_2 + 0x24),*(uint *)(param_2 + 0x28));
    if ((uVar1 != 0x80070491) ||
       (uVar1 = FUN_00437ea7(local_1c,*(int *)(param_2 + 0x2c),*(uint *)(param_2 + 0x30)),
       uVar1 != 0x80070491)) goto LAB_0041f62e;
    uVar1 = 0;
    if (local_1c != (int *)0x0) {
      FUN_0043800c(local_1c);
      local_1c = (int *)0x0;
    }
    if (local_2c != (LPVOID)0x0) {
      FUN_00434413(local_2c,local_30);
      local_30 = 0;
      local_2c = (LPVOID)0x0;
    }
  }
  else {
LAB_0041f329:
    if ((int)uVar1 < 0) goto LAB_0041f3ee;
    uVar1 = FUN_00437f99(&local_8,(int)local_c,local_24,1);
    if ((int)uVar1 < 0) goto LAB_0041f590;
    uVar1 = FUN_00437ea7(local_8,*(int *)(param_2 + 0x1c),*(uint *)(param_2 + 0x20));
    if (uVar1 == 0x80070491) {
      uVar1 = FUN_00437ea7(local_8,*(int *)(param_2 + 0x14),*(uint *)(param_2 + 0x18));
      if (uVar1 == 0x80070491) {
        uVar1 = FUN_00437ea7(local_8,*(int *)(param_2 + 0x24),*(uint *)(param_2 + 0x28));
        if ((uVar1 == 0x80070491) &&
           (uVar1 = FUN_00437ea7(local_8,*(int *)(param_2 + 0x2c),*(uint *)(param_2 + 0x30)),
           uVar1 == 0x80070491)) {
          if (local_8 != (int *)0x0) {
            FUN_0043800c(local_8);
            local_8 = (int *)0x0;
          }
          if (local_c != (int *)0x0) {
            FUN_00434413(local_c,local_24);
            local_24 = 0;
            local_c = (int *)0x0;
          }
          goto LAB_0041f3ee;
        }
LAB_0041f62e:
        if ((int)uVar1 < 0) goto LAB_0041f632;
        *param_3 = 5;
      }
      else {
LAB_0041f649:
        if ((int)uVar1 < 0) {
          pcVar2 = "Failed to do array search for detect code match.";
          goto LAB_0041f637;
        }
        *param_3 = 1;
      }
    }
    else {
      if (-1 < (int)uVar1) {
        *param_3 = 2;
        goto LAB_0041f65a;
      }
      pcVar2 = "Failed to do array search for upgrade code match.";
LAB_0041f637:
      FUN_00430a57(uVar1,pcVar2);
    }
LAB_0041f65a:
    if ((int)uVar1 < 0) goto LAB_0041f669;
  }
  if (*param_3 == 0) {
    uVar1 = 0x80070490;
  }
LAB_0041f669:
  if (local_8 != (int *)0x0) {
    FUN_0043800c(local_8);
  }
  if (local_c != (int *)0x0) {
    FUN_00434413(local_c,local_24);
  }
  if (local_10 != (int *)0x0) {
    FUN_0043800c(local_10);
  }
  if (local_18 != (LPVOID)0x0) {
    FUN_00434413(local_18,local_28);
  }
  if (local_1c != (int *)0x0) {
    FUN_0043800c(local_1c);
  }
  if (local_2c != (LPVOID)0x0) {
    FUN_00434413(local_2c,local_30);
  }
  if (local_14 != (int *)0x0) {
    FUN_0043800c(local_14);
  }
  if (local_20 != (LPVOID)0x0) {
    FUN_00434413(local_20,local_34);
  }
  return uVar1;
}



/* Function: FUN_0041f6ec */

uint FUN_0041f6ec(int param_1,undefined4 param_2,LPCWSTR param_3,int param_4,int *param_5)

{
  uint uVar1;
  char *pcVar2;
  int local_c;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  local_c = 0;
  uVar1 = FUN_004324d5(param_2,param_3,0x20019,&local_8);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to open uninstall key for potential related bundle: %ls";
  }
  else {
    uVar1 = FUN_0041f27c(local_8,param_4,&local_c);
    if (((int)uVar1 < 0) || (local_c == 0)) {
      uVar1 = 0x80070490;
      goto LAB_0041f7a2;
    }
    uVar1 = FUN_0043109a(param_5,param_5[1] + 1,0xe8,5);
    if ((int)uVar1 < 0) {
      FUN_00430a57(uVar1,"Failed to ensure there is space for related bundles.");
      goto LAB_0041f7a2;
    }
    uVar1 = FUN_0041f7b9(param_3,local_8,param_1,local_c,(int *)(param_5[1] * 0xe8 + *param_5));
    if (-1 < (int)uVar1) {
      param_5[1] = param_5[1] + 1;
      goto LAB_0041f7a2;
    }
    pcVar2 = "Failed to initialize package from related bundle id: %ls";
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_0041f7a2:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  return uVar1;
}



/* Function: FUN_0041f7b9 */

uint FUN_0041f7b9(LPCWSTR param_1,undefined4 param_2,int param_3,int param_4,int *param_5)

{
  uint uVar1;
  short **ppsVar2;
  char *pcVar3;
  short *local_28;
  int local_24 [7];
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  local_28 = (short *)0x0;
  local_24[0] = 0;
  local_24[1] = 0;
  local_24[2] = 0;
  local_24[5] = 0;
  local_24[6] = 0;
  local_24[3] = 0;
  local_24[4] = 0;
  uVar1 = FUN_004328d3(param_2,L"EngineVersion",(uint *)(local_24 + 5));
  if ((int)uVar1 < 0) {
    local_24[5] = 0;
    local_24[6] = 0;
  }
  uVar1 = FUN_004328d3(param_2,L"BundleVersion",(uint *)(param_5 + 2));
  if ((int)uVar1 < 0) {
    pcVar3 = "Failed to read version from registry for bundle: %ls";
  }
  else {
    uVar1 = FUN_00432602(param_2,L"BundleCachePath",(int *)&local_8);
    if ((int)uVar1 < 0) {
      pcVar3 = "Failed to read cache path from registry for bundle: %ls";
    }
    else {
      uVar1 = FUN_0043701a(local_8,(DWORD *)(local_24 + 3));
      if ((int)uVar1 < 0) {
        pcVar3 = "Failed to get size of pseudo bundle: %ls";
      }
      else {
        uVar1 = FUN_00432602(param_2,L"BundleProviderKey",(int *)&local_28);
        if (uVar1 == 0x80070002) {
LAB_0041f8dd:
          uVar1 = FUN_00432602(param_2,L"BundleTag",param_5 + 4);
          if (uVar1 == 0x80070002) {
            uVar1 = 0;
          }
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to read tag from registry for bundle: %ls";
          }
          else {
            *param_5 = param_4;
            if ((local_28 == (short *)0x0) || (ppsVar2 = &local_28, *local_28 == 0)) {
              ppsVar2 = (short **)0x0;
            }
            uVar1 = FUN_004229ce(local_24[5],local_24[6],param_5 + 6,param_3,param_1,param_4,4,
                                 local_8,local_8,(LPCWSTR)0x0,local_24[3],local_24[4],0,L"-quiet",
                                 L"-repair -quiet",L"-uninstall -quiet",ppsVar2,(void *)0x0,0);
            if (-1 < (int)uVar1) goto LAB_0041f96e;
            pcVar3 = "Failed to initialize related bundle to represent bundle: %ls";
          }
        }
        else if ((int)uVar1 < 0) {
          pcVar3 = "Failed to read provider key from registry for bundle: %ls";
        }
        else {
          local_24[2] = 1;
          uVar1 = FUN_004372e6(param_5[2],param_5[3],local_24);
          if ((int)uVar1 < 0) {
            pcVar3 = "Failed to copy version for bundle: %ls";
          }
          else {
            uVar1 = FUN_00432602(param_2,L"DisplayName",local_24 + 1);
            if ((uVar1 == 0x80070002) || (-1 < (int)uVar1)) goto LAB_0041f8dd;
            pcVar3 = "Failed to copy display name for bundle: %ls";
          }
        }
      }
    }
  }
  FUN_00430a57(uVar1,pcVar3);
LAB_0041f96e:
  FUN_0041f1f9((int *)&local_28);
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_0041f98e */

uint FUN_0041f98e(int param_1,int param_2,int *param_3)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  char *pcVar4;
  HKEY local_c;
  PCNZWCH local_8;
  
  local_c = (HKEY)0x0;
  local_8 = (PCNZWCH)0x0;
  uVar1 = FUN_004324d5((param_1 != 0) + 0x80000001,
                       L"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall",0x20019,&local_c);
  if ((uVar1 != 0x80070003) && (uVar1 != 0x80070002)) {
    if ((int)uVar1 < 0) {
      pcVar4 = "Failed to open uninstall registry key.";
LAB_0041fa6f:
      FUN_00430a57(uVar1,pcVar4);
      goto LAB_0041fa44;
    }
    iVar3 = 0;
    uVar1 = FUN_004323b4(local_c,0,(int *)&local_8);
    while (uVar1 != 0x80070103) {
      if ((int)uVar1 < 0) {
        pcVar4 = "Failed to enumerate uninstall key for related bundles.";
        goto LAB_0041fa6f;
      }
      iVar2 = CompareStringW(0,1,local_8,-1,*(PCNZWCH *)(param_2 + 0xc),-1);
      if (iVar2 != 2) {
        FUN_0041f6ec(param_1,local_c,local_8,param_2,param_3);
      }
      iVar3 = iVar3 + 1;
      uVar1 = FUN_004323b4(local_c,iVar3,(int *)&local_8);
    }
  }
  uVar1 = 0;
LAB_0041fa44:
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (HKEY)0x0) {
    RegCloseKey(local_c);
  }
  return uVar1;
}



/* Function: FUN_0041fa79 */

void FUN_0041fa79(int *param_1)

{
  LPVOID pvVar1;
  uint uVar2;
  int iVar3;
  
  if (*param_1 != 0) {
    uVar2 = 0;
    if (param_1[1] != 0) {
      iVar3 = 0;
      do {
        FUN_00408f61((int *)(*param_1 + 0x18 + iVar3));
        pvVar1 = *(LPVOID *)(iVar3 + 0x10 + *param_1);
        if (pvVar1 != (LPVOID)0x0) {
          FUN_004380ab(pvVar1);
        }
        uVar2 = uVar2 + 1;
        iVar3 = iVar3 + 0xe8;
      } while (uVar2 < (uint)param_1[1]);
    }
    FUN_00431137((LPVOID)*param_1);
  }
  *param_1 = 0;
  param_1[1] = 0;
  return;
}



/* Function: FUN_0041face */

int FUN_0041face(int param_1,int *param_2,uint param_3)

{
  uint uVar1;
  bool bVar2;
  int iVar3;
  undefined3 extraout_var;
  int iVar4;
  int *piVar5;
  char *pcVar6;
  int local_c;
  
  uVar1 = param_3;
  bVar2 = false;
  if ((*(PCNZWCH *)(param_3 + 0xbc) != (PCNZWCH)0x0) &&
     (iVar3 = CompareStringW(0,1,*(PCNZWCH *)(param_3 + 0xbc),-1,*(PCNZWCH *)(param_3 + 0xc),-1),
     iVar3 != 2)) {
    if ((*(short **)(param_3 + 0x40) != (short *)0x0) && (**(short **)(param_3 + 0x40) != 0)) {
      if (*param_2 == 4) {
        bVar2 = true;
      }
      else if (((*param_2 == 3) || (*param_2 == 5)) || (*param_2 == 6)) {
        bVar2 = FUN_0041e9e9(param_3);
        bVar2 = CONCAT31(extraout_var,bVar2) != 0;
      }
    }
    param_3 = 0;
    if (*(int *)(uVar1 + 0xb8) != 0) {
      local_c = 0;
      do {
        piVar5 = (int *)(*(int *)(uVar1 + 0xb4) + local_c);
        if ((((*piVar5 == 2) && (*(uint *)(uVar1 + 0x3c) <= (uint)piVar5[3])) &&
            ((*(uint *)(uVar1 + 0x3c) < (uint)piVar5[3] ||
             (*(uint *)(uVar1 + 0x38) <= (uint)piVar5[2])))) &&
           (iVar3 = CompareStringW(0,1,*(PCNZWCH *)(uVar1 + 0xbc),-1,(PCNZWCH)piVar5[6],-1),
           iVar3 == 2)) {
          iVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x1c))
                            (*(int **)(param_1 + 0x10),piVar5[6],*piVar5,piVar5[4],piVar5[0xb],
                             piVar5[2],piVar5[3],bVar2);
          iVar4 = FUN_00408843(param_1,1,iVar3);
          if (iVar4 < 0) {
            FUN_004300d9();
            pcVar6 = "BA aborted detect forward compatible bundle.";
LAB_0041fc35:
            FUN_00430a57(iVar4,pcVar6);
            return iVar4;
          }
          if (iVar3 == 1) {
            iVar4 = FUN_00422de3((int *)(uVar1 + 200),param_2,(short *)0x0,*(short **)(uVar1 + 0x40)
                                 ,piVar5 + 6);
            if (iVar4 < 0) {
              pcVar6 = "Failed to initialize update bundle.";
              goto LAB_0041fc35;
            }
            *(undefined4 *)(uVar1 + 0xc0) = 1;
          }
          FUN_0040e33b(*(int *)(uVar1 + 0xc0));
          FUN_0040ea3e();
          FUN_0040e7bb(piVar5[0xb]);
          FUN_0040e82a(*piVar5);
          FUN_00402003(2,0x2000006b);
          return iVar4;
        }
        param_3 = param_3 + 1;
        local_c = local_c + 0xe8;
      } while (param_3 < *(uint *)(uVar1 + 0xb8));
    }
  }
  return 0;
}



/* Function: FUN_0041fc8c */

int FUN_0041fc8c(int param_1,int param_2,int param_3,int param_4)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  int *piVar4;
  int local_c;
  uint local_8;
  
  iVar2 = 0;
  local_8 = 0;
  if (*(int *)(param_2 + 0xb8) != 0) {
    local_c = 0;
    do {
      piVar4 = (int *)(*(int *)(param_2 + 0xb4) + local_c);
      iVar3 = 0;
      iVar2 = *piVar4;
      if (iVar2 != 1) {
        if (iVar2 == 2) {
          if ((param_3 != 2) && (3 < param_4)) {
            uVar1 = *(uint *)(param_2 + 0x3c);
            if (uVar1 < (uint)piVar4[3]) {
LAB_0041fd46:
              iVar3 = 1;
            }
            else if (((uint)piVar4[3] < uVar1) || ((uint)piVar4[2] < *(uint *)(param_2 + 0x38))) {
              iVar3 = 3;
            }
            else if ((uVar1 <= (uint)piVar4[3]) &&
                    ((uVar1 < (uint)piVar4[3] || (*(uint *)(param_2 + 0x38) < (uint)piVar4[2]))))
            goto LAB_0041fd46;
          }
        }
        else if ((iVar2 == 3) || (iVar2 == 4)) {
          if (param_4 == 3) {
            iVar3 = 4;
          }
          else if ((param_4 == 4) || (param_4 == 5)) {
            iVar3 = 5;
          }
          else if (param_4 == 6) {
            iVar3 = 6;
          }
        }
        else if (iVar2 != 5) {
          FUN_004300d9();
          FUN_00430a57(0x80004005,"Unexpected relation type encountered: %d");
          return -0x7fffbffb;
        }
      }
      FUN_0040e7d3(iVar3);
      FUN_0040ea3e();
      FUN_0040e7bb(piVar4[0xb]);
      FUN_0040e82a(*piVar4);
      FUN_00402003(2,0x20000066);
      iVar2 = (**(code **)(**(int **)(param_1 + 0x10) + 0x28))
                        (*(int **)(param_1 + 0x10),piVar4[6],*piVar4,piVar4[4],piVar4[0xb],piVar4[2]
                         ,piVar4[3],iVar3);
      iVar2 = FUN_00408843(param_1,1,iVar2);
      if (iVar2 < 0) {
        FUN_004300d9();
        FUN_00430a57(iVar2,"BA aborted detect related bundle.");
        return iVar2;
      }
      local_8 = local_8 + 1;
      local_c = local_c + 0xe8;
    } while (local_8 < *(uint *)(param_2 + 0xb8));
  }
  return iVar2;
}



/* Function: FUN_0041fdf7 */

void FUN_0041fdf7(int param_1,int param_2)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  
  FUN_0041fa79((int *)(param_1 + 0xb4));
  if (*(LPVOID *)(param_1 + 0xbc) != (LPVOID)0x0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0xbc));
    *(undefined4 *)(param_1 + 0xbc) = 0;
  }
  *(undefined4 *)(param_1 + 0xc0) = 0;
  FUN_00408f61((int *)(param_1 + 200));
  uVar3 = 0;
  if (*(int *)(param_2 + 0xc) != 0) {
    param_1 = 0;
    do {
      iVar4 = *(int *)(param_2 + 8) + param_1;
      uVar2 = 0;
      *(undefined4 *)(iVar4 + 0x40) = 0;
      *(undefined4 *)(iVar4 + 0x44) = 0;
      if (*(int *)(iVar4 + 0x80) != 0) {
        do {
          *(undefined4 *)(*(int *)(iVar4 + 0x7c) + 4 + uVar2 * 8) = 0;
          uVar2 = uVar2 + 1;
        } while (uVar2 < *(uint *)(iVar4 + 0x80));
      }
      if (*(int *)(iVar4 + 0x8c) == 2) {
        uVar2 = 0;
        if (*(int *)(iVar4 + 0xb8) != 0) {
          iVar1 = 0;
          do {
            *(undefined4 *)(iVar1 + 0x1c + *(int *)(iVar4 + 0xb4)) = 0;
            uVar2 = uVar2 + 1;
            iVar1 = iVar1 + 0x28;
          } while (uVar2 < *(uint *)(iVar4 + 0xb8));
        }
      }
      else if (*(int *)(iVar4 + 0x8c) == 3) {
        if (*(LPVOID *)(iVar4 + 0xa4) != (LPVOID)0x0) {
          FUN_00431137(*(LPVOID *)(iVar4 + 0xa4));
          *(undefined4 *)(iVar4 + 0xa4) = 0;
        }
        *(undefined4 *)(iVar4 + 0xa8) = 0;
      }
      uVar3 = uVar3 + 1;
      param_1 = param_1 + 0xd0;
    } while (uVar3 < *(uint *)(param_2 + 0xc));
  }
  uVar3 = 0;
  if (*(int *)(param_2 + 0x20) != 0) {
    iVar4 = 0;
    do {
      iVar1 = *(int *)(param_2 + 0x18) + iVar4;
      iVar4 = iVar4 + 0x10;
      *(undefined4 *)(iVar1 + 8) = 0;
      *(undefined4 *)(iVar1 + 0xc) = 0;
      uVar3 = uVar3 + 1;
    } while (uVar3 < *(uint *)(param_2 + 0x20));
  }
  return;
}



/* Function: FUN_0041ff03 */

int FUN_0041ff03(undefined4 param_1,int param_2,int param_3)

{
  short *psVar1;
  int iVar2;
  int iVar3;
  
  psVar1 = *(short **)(param_3 + 4);
  iVar3 = 0;
  if ((psVar1 != (short *)0x0) && (*psVar1 != 0)) {
    iVar2 = (**(code **)(**(int **)(param_2 + 0x10) + 0x20))(*(int **)(param_2 + 0x10),psVar1,0);
    iVar3 = FUN_00408843(param_2,1,iVar2);
    if (iVar3 < 0) {
      FUN_004300d9();
      FUN_00430a57(iVar3,"UX aborted detect update begin.");
    }
    else if ((iVar2 != 0) && (iVar2 == 1)) {
      iVar3 = -0x7fffbfff;
    }
    (**(code **)(**(int **)(param_2 + 0x10) + 0x24))(*(int **)(param_2 + 0x10),iVar3,0);
  }
  return iVar3;
}



/* Function: FUN_0041ff7e */

undefined4 *
FUN_0041ff7e(int param_1,LPCRITICAL_SECTION param_2,LPCWSTR param_3,undefined4 *param_4,int *param_5
            ,LPCWSTR param_6,undefined4 param_7,uint param_8,undefined4 param_9,int param_10)

{
  LPCWSTR pWVar1;
  undefined4 uVar2;
  LPCWSTR pWVar3;
  undefined4 *puVar4;
  DWORD DVar5;
  int iVar6;
  int *piVar7;
  short *psVar8;
  char *pcVar9;
  int local_48;
  LPCWSTR local_44;
  undefined4 *local_40;
  int *local_3c;
  undefined4 local_38;
  uint local_34;
  undefined4 local_30;
  int local_2c;
  undefined4 local_28;
  PCNZWCH local_20;
  int local_1c;
  int local_18;
  int local_14;
  int local_10;
  undefined4 local_c;
  int local_8;
  
  pWVar1 = param_3;
  local_18 = 0;
  if (param_3 == (LPCWSTR)0x0) {
    if (param_4 == (undefined4 *)0x0) {
      local_c = 0;
    }
    else {
      local_c = *param_4;
    }
  }
  else {
    local_c = *(undefined4 *)param_3;
  }
  if (param_5 == (int *)0x0) {
    local_8 = 0;
  }
  else {
    local_8 = *param_5;
  }
  if (param_3 == (LPCWSTR)0x0) {
    local_20 = (PCNZWCH)param_5[6];
  }
  else {
    local_20 = *(PCNZWCH *)(param_3 + 0x12);
  }
  param_3 = (LPCWSTR)0x0;
  piVar7 = &local_48;
  for (iVar6 = 10; iVar6 != 0; iVar6 = iVar6 + -1) {
    *piVar7 = 0;
    piVar7 = piVar7 + 1;
  }
  local_48 = param_1;
  local_38 = param_7;
  local_34 = param_8;
  local_30 = param_9;
  local_44 = pWVar1;
  local_40 = param_4;
  local_3c = param_5;
  local_2c = param_10;
  do {
    if (pWVar1 == (LPCWSTR)0x0) {
      psVar8 = (short *)param_5[0x10];
      pWVar3 = (LPCWSTR)param_5[0xe];
    }
    else {
      psVar8 = *(short **)(pWVar1 + 0x16);
      pWVar3 = *(LPCWSTR *)(pWVar1 + 0x14);
    }
    local_10 = 0;
    local_1c = 0;
    local_14 = 0;
    param_8 = 0;
    param_10 = 0;
    local_28 = 0;
    puVar4 = (undefined4 *)FUN_004139ed(pWVar3,param_2,&local_14,(int *)&param_3);
    uVar2 = local_c;
    if ((int)puVar4 < 0) {
      pcVar9 = "Failed to search local source.";
      goto LAB_00420296;
    }
    if (local_14 == 0) {
      DVar5 = 0xa0000154;
      if (param_4 != (undefined4 *)0x0) {
        DVar5 = 0xa0000157;
      }
      if (pWVar1 != (LPCWSTR)0x0) {
        DVar5 = (local_8 != 0) + 0xa0000155;
      }
      FUN_00402003(2,DVar5);
      puVar4 = (undefined4 *)FUN_00421b40(param_1,uVar2,local_8,param_3,psVar8,&local_1c,&param_10);
      if (param_10 != 0) {
        if (pWVar1 == (LPCWSTR)0x0) {
          psVar8 = (short *)param_5[0x10];
        }
        else {
          psVar8 = *(short **)(pWVar1 + 0x16);
        }
        if ((psVar8 == (short *)0x0) || (*psVar8 == 0)) {
          puVar4 = (undefined4 *)0x80070057;
        }
      }
      if ((int)puVar4 < 0) {
        FUN_004309f9(puVar4,0xe0000036,(LPCVOID)0x0);
        FUN_00430a57(puVar4,"Failed while prompting for source (original path \'%ls\').");
        goto LAB_0042029e;
      }
      local_10 = local_1c;
    }
    else {
      puVar4 = (undefined4 *)FUN_00431437(param_3,param_6,&local_18);
      if ((int)puVar4 < 0) {
        pcVar9 = 
        "Failed to determine if payload source path was equivalent to the destination path.";
        goto LAB_00420296;
      }
      param_8 = (uint)(local_18 != 2);
    }
    if (param_8 == 0) {
      if (param_10 != 0) {
        iVar6 = (**(code **)(**(int **)(param_1 + 0x10) + 0x80))
                          (*(int **)(param_1 + 0x10),local_c,local_8,1,psVar8);
        puVar4 = (undefined4 *)FUN_004087fa(param_1,0,1,iVar6);
        if (-1 < (int)puVar4) {
          puVar4 = FUN_00420946(&local_48,param_6);
          goto LAB_004201b5;
        }
        FUN_004300d9();
        pcVar9 = "BA aborted cache download payload begin.";
        goto LAB_00420296;
      }
LAB_004201ff:
      if ((int)puVar4 < 0) {
        FUN_00430a57(puVar4,"Failed to acquire payload from: \'%ls\' to working path: \'%ls\'");
        goto LAB_0042029e;
      }
    }
    else {
      iVar6 = (**(code **)(**(int **)(param_1 + 0x10) + 0x80))
                        (*(int **)(param_1 + 0x10),local_c,local_8,0,param_3);
      puVar4 = (undefined4 *)FUN_004087fa(param_1,0,1,iVar6);
      if ((int)puVar4 < 0) {
        FUN_004300d9();
        pcVar9 = "BA aborted cache acquire begin.";
        goto LAB_00420296;
      }
      puVar4 = (undefined4 *)FUN_004203c0(&local_48,param_3,param_6);
      if (-1 < (int)puVar4) {
        FUN_004140c7(param_2,param_3,local_20);
      }
LAB_004201b5:
      if ((param_8 == 0) && (param_10 == 0)) goto LAB_004201ff;
      iVar6 = (**(code **)(**(int **)(param_1 + 0x10) + 0x8c))
                        (*(int **)(param_1 + 0x10),local_c,local_8,puVar4,0);
      iVar6 = FUN_004086ee(param_1,0,5,iVar6);
      if ((int)puVar4 < 0) {
        if (iVar6 == 4) {
          local_10 = 1;
          puVar4 = (undefined4 *)0x0;
        }
        goto LAB_004201ff;
      }
    }
  } while (local_10 != 0);
  if ((int)puVar4 < 0) {
    pcVar9 = "Failed to find external payload to cache.";
LAB_00420296:
    FUN_00430a57(puVar4,pcVar9);
  }
LAB_0042029e:
  if (param_3 != (LPCWSTR)0x0) {
    FUN_004380ab(param_3);
  }
  return puVar4;
}



/* Function: FUN_004202b5 */

undefined4 FUN_004202b5(undefined4 param_1,undefined4 param_2,uint param_3,int param_4)

{
  int *piVar1;
  undefined4 *puVar2;
  int iVar3;
  undefined4 uVar4;
  undefined4 uVar5;
  longlong lVar6;
  undefined8 uVar7;
  int *in_stack_00000034;
  
  piVar1 = in_stack_00000034;
  puVar2 = (undefined4 *)in_stack_00000034[1];
  if ((puVar2 == (undefined4 *)0x0) &&
     (puVar2 = (undefined4 *)in_stack_00000034[2], puVar2 == (undefined4 *)0x0)) {
    uVar5 = 0;
  }
  else {
    uVar5 = *puVar2;
  }
  if ((undefined4 *)in_stack_00000034[3] == (undefined4 *)0x0) {
    in_stack_00000034 = (int *)0x0;
  }
  else {
    in_stack_00000034 = *(int **)in_stack_00000034[3];
  }
  if (piVar1[6] == 0 && piVar1[7] == 0) {
    uVar4 = 0;
  }
  else {
    lVar6 = __allmul(piVar1[4] + param_3,piVar1[5] + param_4 + (uint)CARRY4(piVar1[4],param_3),100,0
                    );
    uVar7 = __aulldiv((uint)lVar6,(uint)((ulonglong)lVar6 >> 0x20),piVar1[6],piVar1[7]);
    uVar4 = (undefined4)uVar7;
  }
  iVar3 = (**(code **)(**(int **)(*piVar1 + 0x10) + 0x84))
                    (*(int **)(*piVar1 + 0x10),uVar5,in_stack_00000034,param_3,param_4,param_1,
                     param_2,uVar4);
  uVar4 = FUN_004086ee(*piVar1,0,1,iVar3);
  uVar5 = 0;
  switch(uVar4) {
  case 0:
  case 1:
  case 4:
  case 5:
  case 6:
  case 10:
  case 0xb:
    break;
  case 2:
  case 3:
  case 7:
    piVar1[8] = 1;
    uVar5 = 1;
    break;
  default:
    piVar1[9] = 1;
    uVar5 = 1;
  }
  return uVar5;
}



/* Function: FUN_00420399 */

void FUN_00420399(HANDLE param_1,undefined4 *param_2)

{
  if (param_2[5] == 0) {
    FUN_00413f37(0,*param_2,(LPCWSTR)param_2[9]);
  }
  else {
    FUN_00416456(param_1,param_2);
  }
  return;
}



/* Function: FUN_004203c0 */

DWORD FUN_004203c0(LPVOID param_1,LPCWSTR param_2,LPCWSTR param_3)

{
  int iVar1;
  BOOL BVar2;
  DWORD DVar3;
  uint uVar4;
  char *pcVar5;
  uint local_8;
  
  uVar4 = 0;
  local_8 = 0;
  if (*(int *)((int)param_1 + 4) == 0) {
    DVar3 = 0x2000014f;
    if (*(int *)((int)param_1 + 8) != 0) {
      DVar3 = 0x20000152;
    }
  }
  else {
    DVar3 = (*(int *)((int)param_1 + 0xc) != 0) + 0x20000150;
  }
  FUN_00402003(2,DVar3);
  iVar1 = FUN_00436af7(param_3,&local_8);
  if ((iVar1 != 0) && ((local_8 & 1) != 0)) {
    local_8 = local_8 & 0xfffffffe;
    BVar2 = SetFileAttributesW(param_3,local_8);
    if (BVar2 == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar4,"Failed to clear readonly bit on payload destination path: %ls");
      return uVar4;
    }
  }
  BVar2 = CopyFileExW(param_2,param_3,FUN_004202b5,param_1,(LPBOOL)((int)param_1 + 0x20),0);
  if (BVar2 == 0) {
    if (*(int *)((int)param_1 + 0x20) == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      if (-1 < (int)uVar4) {
        uVar4 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed attempt to copy payload from: \'%ls\' to: %ls.";
    }
    else {
      uVar4 = 0x80070642;
      FUN_004300d9();
      pcVar5 = "BA aborted copy of payload from: \'%ls\' to: %ls.";
    }
    FUN_00430a57(uVar4,pcVar5);
  }
  return uVar4;
}



/* Function: FUN_0042051a */

DWORD FUN_0042051a(uint param_1,undefined4 *param_2,HANDLE param_3,int *param_4,undefined4 *param_5,
                  undefined4 *param_6,undefined4 *param_7,uint *param_8,int *param_9)

{
  DWORD DVar1;
  BOOL BVar2;
  DWORD DVar3;
  undefined4 *puVar4;
  char *pcVar5;
  HANDLE local_18;
  HANDLE local_14;
  int local_10;
  int local_c;
  DWORD local_8;
  
  DVar3 = 0;
  local_8 = 0;
  local_18 = (HANDLE)0x0;
  local_14 = (HANDLE)0x0;
  local_c = 0;
  local_10 = 0;
  param_4[1] = 0;
  do {
    switch(*param_2) {
    case 1:
      puVar4 = param_6;
      goto LAB_0042055b;
    case 2:
      local_18 = (HANDLE)param_2[2];
      local_14 = param_3;
      DVar1 = WaitForMultipleObjects((param_3 != (HANDLE)0x0) + 1,&local_18,0,0xffffffff);
      DVar3 = local_8;
      if (DVar1 != 0) {
        if (DVar1 == 1) {
          BVar2 = GetExitCodeThread(param_3,&local_8);
          if (BVar2 == 0) {
            DVar3 = GetLastError();
            local_8 = DVar3 & 0xffff | 0x80070000;
            if ((int)DVar3 < 1) {
              local_8 = DVar3;
            }
            if (-1 < (int)local_8) {
              local_8 = 0x80004005;
            }
            FUN_004300d9();
            pcVar5 = "Failed to get cache thread exit code.";
          }
          else {
            if (-1 < (int)local_8) {
              local_8 = 0x8000ffff;
            }
            pcVar5 = "Cache thread exited unexpectedly.";
          }
        }
        else {
          DVar3 = GetLastError();
          local_8 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            local_8 = DVar3;
          }
          if (-1 < (int)local_8) {
            local_8 = 0x80004005;
          }
          FUN_004300d9();
          pcVar5 = "Failed to wait for cache check-point.";
        }
        goto LAB_00420757;
      }
      break;
    default:
      local_8 = 0x8000ffff;
      pcVar5 = "Invalid execute action.";
LAB_00420757:
      FUN_00430a57(local_8,pcVar5);
      return local_8;
    case 4:
      local_8 = FUN_00420b96(param_1,(int)param_2,param_4,0,&local_10,param_8,&local_c);
      DVar3 = local_8;
      if ((int)local_8 < 0) {
        pcVar5 = "Failed to execute EXE package.";
        goto LAB_00420757;
      }
      break;
    case 5:
      local_8 = FUN_00420d99(param_1,(int)param_2,(uint)param_4,0,&local_10,param_8,&local_c);
      DVar3 = local_8;
      if ((int)local_8 < 0) {
        pcVar5 = "Failed to execute MSI package.";
        goto LAB_00420757;
      }
      break;
    case 6:
      local_8 = FUN_00420ef5(param_1,(int)param_2,(uint)param_4,0,&local_10,param_8,&local_c);
      DVar3 = local_8;
      if ((int)local_8 < 0) {
        pcVar5 = "Failed to execute MSP package.";
        goto LAB_00420757;
      }
      break;
    case 7:
      local_8 = FUN_004210b3(param_1,(int)param_2,param_4,0,&local_10,param_8,&local_c);
      DVar3 = local_8;
      if ((int)local_8 < 0) {
        pcVar5 = "Failed to execute MSU package.";
        goto LAB_00420757;
      }
      break;
    case 10:
      local_8 = FUN_00421392(param_1,(int)param_2);
      DVar3 = local_8;
      if ((int)local_8 < 0) {
        pcVar5 = "Failed to execute package provider registration action.";
        goto LAB_00420757;
      }
      break;
    case 0xb:
      local_8 = FUN_00420aec(param_1,(int)param_2);
      DVar3 = local_8;
      if ((int)local_8 < 0) {
        pcVar5 = "Failed to execute dependency action.";
        goto LAB_00420757;
      }
      break;
    case 0xc:
      *param_5 = param_2[2];
      break;
    case 0xd:
      puVar4 = param_7;
LAB_0042055b:
      *puVar4 = param_2[2];
    }
    if (*param_9 < local_c) {
      *param_9 = local_c;
    }
    if (local_10 == 0) {
      return DVar3;
    }
    if (1 < *param_9) {
      return DVar3;
    }
  } while( true );
}



/* Function: FUN_0042079e */

undefined4 FUN_0042079e(uint param_1,int *param_2,uint param_3,undefined4 *param_4,int *param_5)

{
  uint uVar1;
  int *piVar2;
  uint uVar3;
  int iVar4;
  int *piVar5;
  undefined4 *puVar6;
  undefined4 uVar7;
  int local_8;
  
  piVar2 = param_2;
  uVar1 = param_1;
  uVar7 = 0;
  local_8 = 0;
  param_2[1] = 1;
  uVar3 = 0;
  if (*(uint *)(param_1 + 0x440) == 0) {
    return 0;
  }
  piVar5 = *(int **)(param_1 + 0x43c);
  while (((piVar5[1] != 0 || (*piVar5 != 1)) || (piVar5[2] != param_3))) {
    uVar3 = uVar3 + 1;
    piVar5 = piVar5 + 0xc;
    if (*(uint *)(param_1 + 0x440) <= uVar3) {
      return 0;
    }
  }
  if (uVar3 == 0) {
    return 0;
  }
  param_2 = (int *)(uVar3 - 1);
  if ((int)param_2 < 0) {
    return 0;
  }
  iVar4 = (int)param_2 * 0x30;
  do {
    puVar6 = (undefined4 *)(*(int *)(uVar1 + 0x43c) + iVar4);
    if (puVar6[1] != 0) goto LAB_004208d9;
    param_1 = 0;
    switch(*puVar6) {
    case 1:
      goto switchD_00420830_caseD_1;
    default:
      FUN_00430a57(0x8000ffff,"Invalid rollback action: %d.");
      return 0x8000ffff;
    case 3:
      uVar7 = FUN_00420399(*(HANDLE *)(uVar1 + 0x47c),(undefined4 *)puVar6[2]);
      goto switchD_00420830_caseD_1;
    case 4:
      FUN_00420b96(uVar1,(int)puVar6,piVar2,1,&local_8,&param_3,(int *)&param_1);
      break;
    case 5:
      FUN_00420d99(uVar1,(int)puVar6,(uint)piVar2,1,&local_8,&param_3,(int *)&param_1);
      break;
    case 6:
      FUN_00420ef5(uVar1,(int)puVar6,(uint)piVar2,1,&local_8,&param_3,(int *)&param_1);
      break;
    case 7:
      FUN_004210b3(uVar1,(int)puVar6,piVar2,1,&local_8,&param_3,(int *)&param_1);
      break;
    case 10:
      FUN_00421392(uVar1,(int)puVar6);
      break;
    case 0xb:
      FUN_00420aec(uVar1,(int)puVar6);
      break;
    case 0xc:
      return 0;
    case 0xd:
      *param_4 = puVar6[2];
      goto switchD_00420830_caseD_1;
    }
    uVar7 = 0;
switchD_00420830_caseD_1:
    if (*param_5 < (int)param_1) {
      *param_5 = param_1;
    }
LAB_004208d9:
    param_2 = (int *)((int)param_2 + -1);
    iVar4 = iVar4 + -0x30;
    if ((int)param_2 < 0) {
      return uVar7;
    }
  } while( true );
}



/* Function: FUN_00420946 */

undefined4 * FUN_00420946(int *param_1,LPCWSTR param_2)

{
  short *psVar1;
  int *piVar2;
  DWORD DVar3;
  int iVar4;
  BOOL BVar5;
  undefined4 *puVar6;
  undefined4 *puVar7;
  undefined4 *puVar8;
  code *local_20;
  undefined4 local_1c;
  int *local_18;
  uint local_14;
  uint local_10;
  undefined2 *local_c;
  uint local_8;
  
  piVar2 = param_1;
  local_8 = 0;
  puVar8 = (undefined4 *)param_1[1];
  local_c = &DAT_0043b580;
  if (puVar8 == (undefined4 *)0x0) {
    if ((undefined4 *)param_1[2] == (undefined4 *)0x0) {
      param_1 = (int *)&DAT_0043b580;
    }
    else {
      param_1 = *(int **)param_1[2];
    }
  }
  else {
    param_1 = (int *)*puVar8;
  }
  puVar6 = (undefined4 *)piVar2[3];
  if (puVar6 != (undefined4 *)0x0) {
    local_c = (undefined2 *)*puVar6;
  }
  puVar7 = puVar8 + 0xb;
  if (puVar8 == (undefined4 *)0x0) {
    local_14 = puVar6[4];
    local_10 = puVar6[5];
    puVar7 = puVar6 + 0x10;
  }
  else {
    local_14 = puVar8[6];
    local_10 = puVar8[7];
  }
  local_20 = (code *)0x0;
  local_1c = 0;
  local_18 = (int *)0x0;
  if (puVar8 == (undefined4 *)0x0) {
    DVar3 = 0x2000014f;
    if (piVar2[2] != 0) {
      DVar3 = 0x20000152;
    }
  }
  else {
    DVar3 = (puVar6 != (undefined4 *)0x0) + 0x20000150;
  }
  FUN_00402003(2,DVar3);
  iVar4 = FUN_00436af7(param_2,&local_8);
  if ((iVar4 != 0) && ((local_8 & 1) != 0)) {
    local_8 = local_8 & 0xfffffffe;
    BVar5 = SetFileAttributesW(param_2,local_8);
    if (BVar5 == 0) {
      puVar6 = (undefined4 *)GetLastError();
      puVar8 = (undefined4 *)((uint)puVar6 & 0xffff | 0x80070000);
      if ((int)puVar6 < 1) {
        puVar8 = puVar6;
      }
      if (-1 < (int)puVar8) {
        puVar8 = (undefined4 *)0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(puVar8,"Failed to clear readonly bit on payload destination path: %ls");
      return puVar8;
    }
  }
  local_1c = 0;
  local_20 = FUN_004202b5;
  local_18 = piVar2;
  psVar1 = (short *)*puVar7;
  if (((((*psVar1 == 0x62) && (psVar1[1] == 0x69)) && (psVar1[2] == 0x74)) && (psVar1[3] == 0x73))
     && ((psVar1[4] == 0x3a || ((psVar1[4] == 0x73 && (psVar1[5] == 0x3a)))))) {
    puVar8 = FUN_00426408((int)&local_20,puVar7,param_2);
  }
  else {
    puVar8 = (undefined4 *)
             FUN_00425c78(*piVar2,(int *)&local_20,param_1,local_c,puVar7,local_14,local_10,param_2)
    ;
  }
  if ((int)puVar8 < 0) {
    FUN_00430a57(puVar8,"Failed attempt to download URL: \'%ls\' to: \'%ls\'");
  }
  return puVar8;
}



/* Function: FUN_00420aec */

DWORD FUN_00420aec(int param_1,int param_2)

{
  DWORD DVar1;
  char *pcVar2;
  
  if (*(int *)(*(int *)(param_2 + 8) + 0x14) == 0) {
    DVar1 = FUN_0041ea71(0,param_2);
    if (-1 < (int)DVar1) {
      return DVar1;
    }
    pcVar2 = "Failed to register the dependency on per-user package.";
  }
  else {
    DVar1 = FUN_00416bb4(*(HANDLE *)(param_1 + 0x47c),param_2);
    if (-1 < (int)DVar1) {
      return DVar1;
    }
    pcVar2 = "Failed to register the dependency on per-machine package.";
  }
  FUN_00430a57(DVar1,pcVar2);
  return DVar1;
}



/* Function: FUN_00420b39 */

DWORD FUN_00420b39(HANDLE param_1,int *param_2,int *param_3,uint param_4)

{
  uint uVar1;
  DWORD DVar2;
  char *pcVar3;
  
  uVar1 = 0;
  DVar2 = 0;
  if (param_4 != 0) {
    do {
      if (*param_2 == 0) {
        DVar2 = FUN_0041f0f8((int)param_2,param_3);
        if ((int)DVar2 < 0) {
          pcVar3 = "Failed to process dependency registration action.";
          goto LAB_00420b85;
        }
      }
      else {
        DVar2 = FUN_00416da5(param_1,param_3);
        if ((int)DVar2 < 0) {
          pcVar3 = "Failed to execute dependent registration action.";
LAB_00420b85:
          FUN_00430a57(DVar2,pcVar3);
          return DVar2;
        }
      }
      uVar1 = uVar1 + 1;
      param_3 = param_3 + 3;
    } while (uVar1 < param_4);
  }
  return DVar2;
}



/* Function: FUN_00420b96 */

void FUN_00420b96(int param_1,int param_2,int *param_3,int param_4,int *param_5,uint *param_6,
                 int *param_7)

{
  int iVar1;
  int iVar2;
  DWORD DVar3;
  DWORD DVar4;
  DWORD DVar5;
  char *pcVar6;
  int local_14 [4];
  
  local_14[0] = 0;
  local_14[1] = 0;
  local_14[2] = 0;
  local_14[3] = 0;
  DVar3 = 0;
  if (*(int *)(*(int *)(param_2 + 8) + 0x78) < 0) {
    FUN_00402003(2,0xa0000135);
    DVar4 = 0;
    goto LAB_00420d6a;
  }
  param_3[2] = *(int *)(param_2 + 8);
  iVar2 = (**(code **)(**(int **)(param_1 + 200) + 0xa4))
                    (*(int **)(param_1 + 200),**(undefined4 **)(param_2 + 8),param_4 == 0);
  iVar1 = param_1 + 0xb8;
  DVar4 = FUN_004087fa(iVar1,param_4,1,iVar2);
  if ((int)DVar4 < 0) {
    FUN_004300d9();
    pcVar6 = "UX aborted execute EXE package begin.";
    DVar5 = DVar4;
    goto LAB_00420d63;
  }
  local_14[2] = -(uint)(param_4 != 0) & 100;
  local_14[0] = 2;
  local_14[1] = 1;
  iVar2 = FUN_0042153f(local_14,param_3);
  DVar4 = FUN_004087fa(iVar1,param_4,1,iVar2);
  if ((int)DVar4 < 0) {
LAB_00420c6a:
    FUN_004300d9();
    pcVar6 = "UX aborted EXE progress.";
    DVar5 = DVar4;
  }
  else if (*(int *)(*(int *)(param_2 + 8) + 0x14) == 0) {
    DVar3 = FUN_004195ac(param_2,(LPCRITICAL_SECTION)(param_1 + 0x88),param_4,FUN_0042153f,param_3,
                         param_7);
    if (-1 < (int)DVar3) goto LAB_00420cd8;
    pcVar6 = "Failed to configure per-user EXE package.";
    DVar5 = DVar3;
  }
  else {
    DVar3 = FUN_004165ee(*(HANDLE *)(param_1 + 0x47c),param_2,(LPCRITICAL_SECTION)(param_1 + 0x88),
                         param_4,FUN_0042153f,param_3,param_7);
    if ((int)DVar3 < 0) {
      pcVar6 = "Failed to configure per-machine EXE package.";
      DVar5 = DVar3;
    }
    else {
LAB_00420cd8:
      local_14[2] = 100;
      if (param_4 != 0) {
        local_14[2] = 0;
      }
      local_14[0] = 2;
      local_14[1] = 1;
      iVar2 = FUN_0042153f(local_14,param_3);
      DVar4 = FUN_004087fa(iVar1,param_4,1,iVar2);
      if ((int)DVar4 < 0) goto LAB_00420c6a;
      iVar2 = 1;
      if (param_4 != 0) {
        iVar2 = -1;
      }
      param_3[3] = param_3[3] + iVar2;
      *(int *)param_3[5] = *(int *)param_3[5] + iVar2;
      DVar4 = FUN_00421bd3(iVar1,param_4,*(uint *)(param_1 + 0x40c),*(int *)param_3[5]);
      if (-1 < (int)DVar4) goto LAB_00420d6a;
      FUN_004300d9();
      pcVar6 = "UX aborted EXE package execute progress.";
      DVar5 = DVar4;
    }
  }
LAB_00420d63:
  FUN_00430a57(DVar5,pcVar6);
LAB_00420d6a:
  FUN_00421298(param_1 + 0xb8,(LPCRITICAL_SECTION)(param_1 + 0x88),*(int **)(param_2 + 8),DVar4,
               DVar3,param_4,param_7,param_5,param_6);
  return;
}



/* Function: FUN_00420d99 */

void FUN_00420d99(int param_1,int param_2,uint param_3,uint param_4,int *param_5,uint *param_6,
                 int *param_7)

{
  int iVar1;
  DWORD DVar2;
  DWORD DVar3;
  DWORD DVar4;
  char *pcVar5;
  
  DVar2 = 0;
  if (*(int *)(*(int *)(param_2 + 8) + 0x78) < 0) {
    FUN_00402003(2,0xa0000135);
    DVar3 = 0;
    goto LAB_00420ec6;
  }
  *(int *)(param_3 + 8) = *(int *)(param_2 + 8);
  iVar1 = (**(code **)(**(int **)(param_1 + 200) + 0xa4))
                    (*(int **)(param_1 + 200),**(undefined4 **)(param_2 + 8),param_4 == 0);
  DVar3 = FUN_004087fa(param_1 + 0xb8,param_4,1,iVar1);
  if ((int)DVar3 < 0) {
    FUN_004300d9();
    pcVar5 = "UX aborted execute MSI package begin.";
    DVar4 = DVar3;
  }
  else if (*(int *)(*(int *)(param_2 + 8) + 0x14) == 0) {
    DVar2 = FUN_0041b2fa(*(uint *)(param_1 + 0xf0),param_2,(LPCRITICAL_SECTION)(param_1 + 0x88),
                         param_4,0x421a6b,param_3,param_7);
    if (-1 < (int)DVar2) goto LAB_00420e71;
    pcVar5 = "Failed to configure per-user MSI package.";
    DVar4 = DVar2;
  }
  else {
    DVar2 = FUN_00416706(*(HANDLE *)(param_1 + 0x47c),*(uint *)(param_1 + 0xf0),param_2,
                         (LPCRITICAL_SECTION)(param_1 + 0x88),param_4,FUN_00421a6b,param_3,param_7);
    if ((int)DVar2 < 0) {
      pcVar5 = "Failed to configure per-machine MSI package.";
      DVar4 = DVar2;
    }
    else {
LAB_00420e71:
      iVar1 = 1;
      if (param_4 != 0) {
        iVar1 = -1;
      }
      *(int *)(param_3 + 0xc) = *(int *)(param_3 + 0xc) + iVar1;
      **(int **)(param_3 + 0x14) = **(int **)(param_3 + 0x14) + iVar1;
      DVar3 = FUN_00421bd3(param_1 + 0xb8,param_4,*(uint *)(param_1 + 0x40c),
                           **(int **)(param_3 + 0x14));
      if (-1 < (int)DVar3) goto LAB_00420ec6;
      FUN_004300d9();
      pcVar5 = "UX aborted MSI package execute progress.";
      DVar4 = DVar3;
    }
  }
  FUN_00430a57(DVar4,pcVar5);
LAB_00420ec6:
  FUN_00421298(param_1 + 0xb8,(LPCRITICAL_SECTION)(param_1 + 0x88),*(int **)(param_2 + 8),DVar3,
               DVar2,param_4,param_7,param_5,param_6);
  return;
}



/* Function: FUN_00420ef5 */

void FUN_00420ef5(uint param_1,int param_2,uint param_3,uint param_4,int *param_5,uint *param_6,
                 int *param_7)

{
  uint uVar1;
  int iVar2;
  DWORD DVar3;
  DWORD DVar4;
  DWORD DVar5;
  char *pcVar6;
  
  uVar1 = param_1;
  DVar4 = 0;
  if (*(int *)(*(int *)(param_2 + 8) + 0x78) < 0) {
    FUN_00402003(2,0xa0000135);
    DVar3 = 0;
    goto LAB_00421085;
  }
  *(int *)(param_3 + 8) = *(int *)(param_2 + 8);
  iVar2 = (**(code **)(**(int **)(param_1 + 200) + 0xa4))
                    (*(int **)(param_1 + 200),**(undefined4 **)(param_2 + 8),param_4 == 0);
  DVar3 = FUN_004087fa(param_1 + 0xb8,param_4,1,iVar2);
  if ((int)DVar3 < 0) {
    FUN_004300d9();
    pcVar6 = "UX aborted execute MSP package begin.";
    DVar5 = DVar3;
  }
  else {
    param_1 = 0;
    if (*(int *)(param_2 + 0x2c) != 0) {
      do {
        iVar2 = (**(code **)(**(int **)(uVar1 + 200) + 0xa8))
                          (*(int **)(uVar1 + 200),
                           **(undefined4 **)(*(int *)(param_2 + 0x28) + 4 + param_1 * 8),
                           *(undefined4 *)(param_2 + 0xc));
        DVar3 = FUN_004087fa(uVar1 + 0xb8,param_4,1,iVar2);
        if ((int)DVar3 < 0) {
          FUN_004300d9();
          pcVar6 = "BA aborted execute MSP target.";
          DVar5 = DVar3;
          goto LAB_0042107e;
        }
        param_1 = param_1 + 1;
      } while (param_1 < *(uint *)(param_2 + 0x2c));
    }
    if (*(int *)(param_2 + 0x18) == 0) {
      DVar4 = FUN_0041d0bc(*(uint *)(uVar1 + 0xf0),param_2,(LPCRITICAL_SECTION)(uVar1 + 0x88),
                           param_4,0x421a6b,param_3,param_7);
      if (-1 < (int)DVar4) goto LAB_00421030;
      pcVar6 = "Failed to configure per-user MSP package.";
      DVar5 = DVar4;
    }
    else {
      DVar4 = FUN_004168d3(*(HANDLE *)(uVar1 + 0x47c),*(uint *)(uVar1 + 0xf0),param_2,
                           (LPCRITICAL_SECTION)(uVar1 + 0x88),param_4,FUN_00421a6b,param_3,param_7);
      if ((int)DVar4 < 0) {
        pcVar6 = "Failed to configure per-machine MSP package.";
        DVar5 = DVar4;
      }
      else {
LAB_00421030:
        iVar2 = 1;
        if (param_4 != 0) {
          iVar2 = -1;
        }
        *(int *)(param_3 + 0xc) = *(int *)(param_3 + 0xc) + iVar2;
        **(int **)(param_3 + 0x14) = **(int **)(param_3 + 0x14) + iVar2;
        DVar3 = FUN_00421bd3(uVar1 + 0xb8,param_4,*(uint *)(uVar1 + 0x40c),
                             **(int **)(param_3 + 0x14));
        if (-1 < (int)DVar3) goto LAB_00421085;
        FUN_004300d9();
        pcVar6 = "UX aborted MSP package execute progress.";
        DVar5 = DVar3;
      }
    }
  }
LAB_0042107e:
  FUN_00430a57(DVar5,pcVar6);
LAB_00421085:
  FUN_00421298(uVar1 + 0xb8,(LPCRITICAL_SECTION)(uVar1 + 0x88),*(int **)(param_2 + 8),DVar3,DVar4,
               param_4,param_7,param_5,param_6);
  return;
}



/* Function: FUN_004210b3 */

void FUN_004210b3(int param_1,int param_2,int *param_3,int param_4,int *param_5,uint *param_6,
                 int *param_7)

{
  int iVar1;
  int iVar2;
  DWORD DVar3;
  DWORD DVar4;
  DWORD DVar5;
  char *pcVar6;
  int local_14 [4];
  
  local_14[0] = 0;
  local_14[1] = 0;
  local_14[2] = 0;
  local_14[3] = 0;
  DVar3 = 0;
  if (*(int *)(*(int *)(param_2 + 8) + 0x78) < 0) {
    FUN_00402003(2,0xa0000135);
    DVar4 = 0;
    goto LAB_00421269;
  }
  param_3[2] = *(int *)(param_2 + 8);
  iVar2 = (**(code **)(**(int **)(param_1 + 200) + 0xa4))
                    (*(int **)(param_1 + 200),**(undefined4 **)(param_2 + 8),param_4 == 0);
  iVar1 = param_1 + 0xb8;
  DVar4 = FUN_004087fa(iVar1,param_4,1,iVar2);
  if ((int)DVar4 < 0) {
    FUN_004300d9();
    pcVar6 = "UX aborted execute MSU package begin.";
    DVar5 = DVar4;
  }
  else {
    local_14[2] = -(uint)(param_4 != 0) & 100;
    local_14[0] = 2;
    local_14[1] = 1;
    iVar2 = FUN_0042153f(local_14,param_3);
    DVar4 = FUN_004087fa(iVar1,param_4,1,iVar2);
    if (-1 < (int)DVar4) {
      if (*(int *)(*(int *)(param_2 + 8) + 0x14) == 0) {
        DVar3 = 0x8000ffff;
      }
      else {
        DVar3 = FUN_00416abe(*(HANDLE *)(param_1 + 0x47c),param_2,param_4,FUN_0042153f,param_3,
                             param_7);
        if ((int)DVar3 < 0) {
          pcVar6 = "Failed to configure per-machine MSU package.";
          DVar5 = DVar3;
          goto LAB_00421262;
        }
      }
      local_14[2] = 100;
      if (param_4 != 0) {
        local_14[2] = 0;
      }
      local_14[0] = 2;
      local_14[1] = 1;
      iVar2 = FUN_0042153f(local_14,param_3);
      DVar4 = FUN_004087fa(iVar1,param_4,1,iVar2);
      if (-1 < (int)DVar4) {
        iVar2 = 1;
        if (param_4 != 0) {
          iVar2 = -1;
        }
        param_3[3] = param_3[3] + iVar2;
        *(int *)param_3[5] = *(int *)param_3[5] + iVar2;
        DVar4 = FUN_00421bd3(iVar1,param_4,*(uint *)(param_1 + 0x40c),*(int *)param_3[5]);
        if (-1 < (int)DVar4) goto LAB_00421269;
        FUN_004300d9();
        pcVar6 = "UX aborted MSU package execute progress.";
        DVar5 = DVar4;
        goto LAB_00421262;
      }
    }
    FUN_004300d9();
    pcVar6 = "UX aborted MSU progress.";
    DVar5 = DVar4;
  }
LAB_00421262:
  FUN_00430a57(DVar5,pcVar6);
LAB_00421269:
  FUN_00421298(param_1 + 0xb8,(LPCRITICAL_SECTION)(param_1 + 0x88),*(int **)(param_2 + 8),DVar4,
               DVar3,param_4,param_7,param_5,param_6);
  return;
}



/* Function: FUN_00421298 */

int FUN_00421298(int param_1,LPCRITICAL_SECTION param_2,int *param_3,int param_4,int param_5,
                int param_6,int *param_7,int *param_8,uint *param_9)

{
  int iVar1;
  int iVar2;
  int iVar3;
  undefined4 uVar4;
  DWORD DVar5;
  
  iVar1 = param_4;
  if (((param_4 < 0) || (iVar1 = param_5, -1 < param_5)) || (param_3[7] != 0)) {
    uVar4 = 0;
  }
  else {
    uVar4 = 5;
  }
  iVar2 = (**(code **)(**(int **)(param_1 + 0x10) + 0xb8))
                    (*(int **)(param_1 + 0x10),*param_3,iVar1,*param_7,uVar4);
  if (iVar2 == 0x66) {
    *param_7 = 2;
  }
  if ((param_5 < 0) && (iVar2 == 4)) {
    iVar3 = 1;
  }
  else {
    iVar3 = 0;
  }
  *param_8 = iVar3;
  *param_9 = (uint)(iVar2 == 0x67);
  if (*param_7 == 2) {
    FUN_0040461f(param_2,L"WixBundleForcedRestartPackage",*param_3,1);
  }
  if (*param_8 == 0) {
    if (((param_4 < 0) || (-1 < param_5)) || ((iVar2 != 5 || (param_3[7] != 0)))) {
      FUN_0040e8ce(*param_7);
      FUN_0040e8fd(param_6);
      FUN_00402003(2,0x2000013f);
      return iVar1;
    }
    DVar5 = 0xa000015e;
  }
  else {
    DVar5 = 0xa000015c;
  }
  FUN_00402003(2,DVar5);
  return 0;
}



/* Function: FUN_00421392 */

DWORD FUN_00421392(int param_1,int param_2)

{
  DWORD DVar1;
  char *pcVar2;
  
  if (*(int *)(*(int *)(param_2 + 8) + 0x14) == 0) {
    DVar1 = FUN_0041eac7(param_2);
    if (-1 < (int)DVar1) {
      return DVar1;
    }
    pcVar2 = "Failed to register the package provider on per-user package.";
  }
  else {
    DVar1 = FUN_00416c73(*(HANDLE *)(param_1 + 0x47c),param_2);
    if (-1 < (int)DVar1) {
      return DVar1;
    }
    pcVar2 = "Failed to register the package provider on per-machine package.";
  }
  FUN_00430a57(DVar1,pcVar2);
  return DVar1;
}



/* Function: FUN_004213dd */

DWORD FUN_004213dd(HANDLE param_1,undefined4 param_2,int param_3,LPCWSTR param_4,int param_5,
                  uint param_6)

{
  DWORD DVar1;
  int iVar2;
  uint uVar3;
  HANDLE pvVar4;
  int iVar5;
  char *pcVar6;
  HANDLE local_68 [22];
  int local_10;
  LPCWSTR local_c;
  PCNZWCH local_8;
  
  FUN_004267c0((uint *)local_68,0,0x58);
  pvVar4 = (HANDLE)0xffffffff;
  local_c = (LPCWSTR)0x0;
  local_10 = 0;
  local_8 = (PCNZWCH)0x0;
  if ((((*(int *)(param_3 + 8) != 0) &&
       (DVar1 = FUN_00431c19((int *)&local_c,(HMODULE)0x0), -1 < (int)DVar1)) &&
      (DVar1 = FUN_00431437(local_c,param_4,&local_10), -1 < (int)DVar1)) && (local_10 == 2)) {
    pvVar4 = param_1;
  }
  DVar1 = FUN_00418f44(local_68,param_3,pvVar4,param_4);
  if ((int)DVar1 < 0) {
    pcVar6 = "Failed to open container: %ls.";
  }
  else {
    DVar1 = FUN_00418f25((int)local_68,&local_8);
    while (DVar1 == 0) {
      uVar3 = 0;
      iVar5 = param_5;
      if (param_6 != 0) {
        do {
          iVar2 = CompareStringW(0x7f,0,local_8,-1,*(PCNZWCH *)(*(int *)(iVar5 + 4) + 0x38),-1);
          if (iVar2 == 2) {
            DVar1 = FUN_00419196((int)local_68,*(undefined4 *)(iVar5 + 8));
            if (-1 < (int)DVar1) goto LAB_004214a8;
            pcVar6 = "Failed to extract payload: %ls from container: %ls";
            goto LAB_004214e7;
          }
          uVar3 = uVar3 + 1;
          iVar5 = iVar5 + 0xc;
        } while (uVar3 < param_6);
      }
      DVar1 = FUN_00419158((int)local_68);
      if ((int)DVar1 < 0) {
        pcVar6 = "Failed to skip the extraction of payload: %ls from container: %ls";
LAB_004214e7:
        FUN_00430a57(DVar1,pcVar6);
        goto LAB_00421511;
      }
LAB_004214a8:
      DVar1 = FUN_00418f25((int)local_68,&local_8);
    }
    if (DVar1 == 0x80070103) {
      DVar1 = 0;
    }
    if (-1 < (int)DVar1) goto LAB_00421511;
    pcVar6 = "Failed to extract all payloads from container: %ls";
  }
  FUN_00430a57(DVar1,pcVar6);
LAB_00421511:
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  FUN_00418e76((uint *)local_68);
  return DVar1;
}



/* Function: FUN_0042153f */

void FUN_0042153f(int *param_1,int *param_2)

{
  int iVar1;
  uint uVar2;
  
  uVar2 = 0;
  iVar1 = *param_1;
  if (iVar1 == 1) {
    uVar2 = (**(code **)(**(int **)(*param_2 + 0x10) + 0x6c))
                      (*(int **)(*param_2 + 0x10),2,*(undefined4 *)param_2[2],param_1[2],param_1[3],
                       param_1[1],0,0,0);
  }
  else if (iVar1 == 2) {
    if (param_2[4] != 0) {
      uVar2 = (uint)((param_2[3] * 100 + param_1[2]) * 100) / (uint)(param_2[4] * 100);
    }
    uVar2 = (**(code **)(**(int **)(*param_2 + 0x10) + 0xac))
                      (*(int **)(*param_2 + 0x10),*(undefined4 *)param_2[2],param_1[2],uVar2);
  }
  else if (iVar1 == 3) {
    uVar2 = (**(code **)(**(int **)(*param_2 + 0x10) + 0xb4))
                      (*(int **)(*param_2 + 0x10),*(undefined4 *)param_2[2],param_1[2],param_1[3]);
  }
  FUN_004086ee(*param_2,param_2[1],param_1[1],uVar2);
  return;
}



/* Function: FUN_004215dd */

undefined8 FUN_004215dd(int *param_1)

{
  int iVar1;
  int iVar2;
  
  iVar1 = *param_1;
  if (iVar1 != 2) {
    if (iVar1 != 7) {
      if (iVar1 != 8) {
        if (iVar1 != 10) {
          iVar1 = 0;
          iVar2 = 0;
          goto LAB_0042160f;
        }
        param_1 = (int *)param_1[3];
      }
      iVar1 = param_1[4];
      iVar2 = param_1[5];
      goto LAB_0042160f;
    }
    param_1 = (int *)param_1[2];
  }
  iVar1 = param_1[6];
  iVar2 = param_1[7];
LAB_0042160f:
  return CONCAT44(iVar2,iVar1);
}



/* Function: FUN_00421613 */

DWORD FUN_00421613(int param_1,HANDLE param_2,LPCWSTR param_3,LPCWSTR param_4,LPCWSTR param_5,
                  undefined4 param_6,undefined4 param_7,undefined4 param_8,undefined4 param_9)

{
  bool bVar1;
  DWORD DVar2;
  int iVar3;
  int *piVar4;
  char *pcVar5;
  int local_38 [4];
  undefined4 local_28;
  undefined4 local_24;
  undefined4 local_20;
  undefined4 local_1c;
  undefined4 local_18;
  int local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  piVar4 = local_38;
  for (iVar3 = 10; iVar3 != 0; iVar3 = iVar3 + -1) {
    *piVar4 = 0;
    piVar4 = piVar4 + 1;
  }
  local_8 = (LPCWSTR)0x0;
  local_c = (LPCWSTR)0x0;
  local_10 = 0;
  DVar2 = FUN_00431c19((int *)&local_8,(HMODULE)0x0);
  if ((int)DVar2 < 0) {
    pcVar5 = "Failed to get path to bundle to layout.";
  }
  else {
    DVar2 = FUN_004314a9(param_4,param_3,(int *)&local_c);
    if ((int)DVar2 < 0) {
      pcVar5 = "Failed to concat layout path for bundle.";
    }
    else {
      DVar2 = FUN_00431437(local_8,local_c,&local_10);
      if (-1 < (int)DVar2) {
        if (local_10 == 2) {
          DVar2 = 0;
        }
        else {
          local_28 = param_6;
          local_24 = param_7;
          local_20 = param_8;
          local_38[0] = param_1;
          local_1c = param_9;
          do {
            bVar1 = false;
            do {
              local_18 = 0;
              iVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x80))
                                (*(int **)(param_1 + 0x10),0,0,0,local_8);
              DVar2 = FUN_004087fa(param_1,0,1,iVar3);
              if ((int)DVar2 < 0) {
                FUN_004300d9();
                pcVar5 = "BA aborted cache acquire begin.";
                goto LAB_00421839;
              }
              DVar2 = FUN_004203c0(local_38,local_8,param_5);
              iVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x8c))
                                (*(int **)(param_1 + 0x10),0,0,DVar2,0);
              iVar3 = FUN_004086ee(param_1,0,5,iVar3);
              if ((int)DVar2 < 0) {
                if (iVar3 == 4) {
                  DVar2 = 1;
                }
                if ((int)DVar2 < 0) {
                  pcVar5 = "Failed to copy bundle from: \'%ls\' to: \'%ls\'";
                  goto LAB_00421734;
                }
              }
            } while (DVar2 == 1);
            if ((int)DVar2 < 0) goto LAB_004217ec;
LAB_00421755:
            do {
              iVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x90))
                                (*(int **)(param_1 + 0x10),0,0);
              DVar2 = FUN_004087fa(param_1,0,1,iVar3);
              if ((int)DVar2 < 0) {
                FUN_004300d9();
                pcVar5 = "UX aborted cache verify begin.";
                goto LAB_00421839;
              }
              if (param_2 == (HANDLE)0xffffffff) {
                DVar2 = FUN_00413da4(param_3,param_4,param_5);
              }
              else {
                DVar2 = FUN_00416d15(param_2,param_4,param_5);
              }
              iVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x94))
                                (*(int **)(param_1 + 0x10),0,0,DVar2,0);
              if ((int)DVar2 < 0) {
                iVar3 = FUN_004086ee(param_1,0,0xf,iVar3);
                if (iVar3 == 4) goto LAB_00421755;
                if (iVar3 == 10) {
                  bVar1 = true;
                }
              }
            } while (DVar2 == 1);
          } while (bVar1);
          if ((int)DVar2 < 0) {
LAB_004217ec:
            FUN_004309f9(DVar2,0xe000013b,(LPCVOID)0x0);
            pcVar5 = "Failed to layout bundle: %ls to layout directory: %ls";
LAB_00421734:
            FUN_00430a57(DVar2,pcVar5);
          }
        }
        goto LAB_00421841;
      }
      pcVar5 = "Failed to determine if layout bundle path was equivalent with current process path."
      ;
    }
  }
LAB_00421839:
  FUN_00430a57(DVar2,pcVar5);
LAB_00421841:
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar2;
}



/* Function: FUN_00421866 */

DWORD FUN_00421866(int param_1,HANDLE param_2,undefined4 *param_3,undefined4 *param_4,
                  undefined4 *param_5,uint param_6,int param_7,undefined4 param_8,undefined4 param_9
                  ,LPCWSTR param_10,LPCWSTR param_11,int param_12,uint param_13,undefined4 *param_14
                  )

{
  undefined4 *puVar1;
  DWORD DVar2;
  int iVar3;
  undefined2 *puVar4;
  undefined4 uVar5;
  int *piVar6;
  int local_38;
  undefined4 *local_34;
  undefined4 *local_30;
  undefined4 *local_2c;
  int local_28;
  int local_24;
  undefined4 local_20;
  undefined4 local_1c;
  int local_18;
  int local_14;
  uint local_10;
  int local_c;
  undefined2 *local_8;
  
  puVar1 = param_3;
  local_8 = &DAT_0043b580;
  if (param_3 == (undefined4 *)0x0) {
    if (param_4 == (undefined4 *)0x0) {
      param_3 = (undefined4 *)&DAT_0043b580;
    }
    else {
      param_3 = (undefined4 *)*param_4;
    }
  }
  else {
    param_3 = (undefined4 *)*param_3;
  }
  if (param_5 != (undefined4 *)0x0) {
    local_8 = (undefined2 *)*param_5;
  }
  puVar4 = local_8;
  piVar6 = &local_38;
  for (iVar3 = 10; iVar3 != 0; iVar3 = iVar3 + -1) {
    *piVar6 = 0;
    piVar6 = piVar6 + 1;
  }
  if (puVar1 == (undefined4 *)0x0) {
    local_10 = param_5[4];
    local_c = param_5[5];
  }
  else {
    local_10 = puVar1[6];
    local_c = puVar1[7];
  }
  local_30 = param_4;
  local_28 = param_6 - local_10;
  local_24 = (param_7 - local_c) - (uint)(param_6 < local_10);
  local_2c = param_5;
  local_20 = param_8;
  local_1c = param_9;
  *param_14 = 0;
  local_34 = puVar1;
  local_38 = param_1;
LAB_004218fe:
  do {
    iVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x90))
                      (*(int **)(param_1 + 0x10),param_3,puVar4);
    DVar2 = FUN_004087fa(param_1,0,1,iVar3);
    if ((int)DVar2 < 0) {
      FUN_004300d9();
      FUN_00430a57(DVar2,"UX aborted cache verify begin.");
      return DVar2;
    }
    if (param_2 == (HANDLE)0xffffffff) {
      if (param_10 == (LPCWSTR)0x0) {
        DVar2 = FUN_0041376c(param_4[5],param_5,param_4[9],param_11,param_12);
      }
      else if (puVar1 == (undefined4 *)0x0) {
        DVar2 = FUN_00413e98((int)param_5,param_10,param_11,param_12);
      }
      else {
        DVar2 = FUN_00413e2b((int)puVar1,param_10,param_11,param_12);
      }
    }
    else {
      DVar2 = FUN_004161e7(param_2,puVar1,param_4,param_5,param_10,param_11,param_12);
    }
    if ((int)DVar2 < 0) {
      if (1 < param_13) goto LAB_004219ab;
      uVar5 = 10;
    }
    else {
      FUN_004202b5(local_10,local_c,local_10,local_c);
      if (local_18 != 0) {
        DVar2 = 0x80070642;
LAB_00421a0d:
        FUN_004300d9();
        FUN_00430a57(DVar2,"BA aborted verify of %hs: %ls");
        return DVar2;
      }
      if (local_14 != 0) {
        DVar2 = 0x80070643;
      }
      if ((int)DVar2 < 0) goto LAB_00421a0d;
LAB_004219ab:
      uVar5 = 0;
    }
    iVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x94))
                      (*(int **)(param_1 + 0x10),param_3,local_8,DVar2,uVar5);
    iVar3 = FUN_004086ee(param_1,0,0xf,iVar3);
    puVar4 = local_8;
    if ((int)DVar2 < 0) {
      if (iVar3 == 4) goto LAB_004218fe;
      if (iVar3 == 10) {
        *param_14 = 1;
      }
    }
    if (DVar2 != 1) {
      return DVar2;
    }
  } while( true );
}



/* Function: FUN_00421a6b */

void FUN_00421a6b(int *param_1,int *param_2)

{
  int iVar1;
  uint uVar2;
  
  uVar2 = 0;
  iVar1 = *param_1;
  if (iVar1 == 1) {
    if (param_2[4] != 0) {
      uVar2 = (uint)((param_2[3] * 100 + param_1[5]) * 100) / (uint)(param_2[4] * 100);
    }
    uVar2 = (**(code **)(**(int **)(*param_2 + 0x10) + 0xac))
                      (*(int **)(*param_2 + 0x10),*(undefined4 *)param_2[2],param_1[5],uVar2);
  }
  else if (iVar1 == 2) {
    uVar2 = (**(code **)(**(int **)(*param_2 + 0x10) + 0x6c))
                      (*(int **)(*param_2 + 0x10),1,*(undefined4 *)param_2[2],param_1[5],param_1[6],
                       param_1[1],param_1[2],param_1[3],param_1[4]);
  }
  else if (iVar1 == 3) {
    uVar2 = (**(code **)(**(int **)(*param_2 + 0x10) + 0xb0))
                      (*(int **)(*param_2 + 0x10),*(undefined4 *)param_2[2],param_1[5],param_1[1],
                       param_1[6],param_1[2],param_1[3],param_1[4]);
  }
  else if (iVar1 == 4) {
    uVar2 = (**(code **)(**(int **)(*param_2 + 0x10) + 0xb4))
                      (*(int **)(*param_2 + 0x10),*(undefined4 *)param_2[2],param_1[5],param_1[6]);
  }
  FUN_004086ee(*param_2,param_2[1],param_1[1],uVar2);
  return;
}



/* Function: FUN_00421b40 */

undefined4
FUN_00421b40(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,undefined4 param_5
            ,undefined4 *param_6,undefined4 *param_7)

{
  int iVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  FUN_00408728(param_1);
  iVar1 = (**(code **)(**(int **)(param_1 + 0x10) + 0x88))
                    (*(int **)(param_1 + 0x10),param_2,param_3,param_4,param_5);
  if (iVar1 < 4) {
    if (iVar1 != 3) {
      if (iVar1 == -1) {
        uVar2 = 0x80070643;
        goto LAB_00421bc3;
      }
      if ((iVar1 == 0) || (iVar1 == 1)) goto LAB_00421bb3;
      if (iVar1 != 2) goto LAB_00421ba1;
    }
  }
  else {
    if (iVar1 == 4) {
      *param_6 = 1;
      goto LAB_00421bc3;
    }
    if (iVar1 == 6) {
LAB_00421bb3:
      uVar2 = 0x80070002;
      goto LAB_00421bc3;
    }
    if (iVar1 != 7) {
      if (iVar1 == 0x65) {
        *param_7 = 1;
        goto LAB_00421bc3;
      }
LAB_00421ba1:
      uVar2 = 0x80070057;
      goto LAB_00421bc3;
    }
  }
  uVar2 = 0x80070642;
LAB_00421bc3:
  FUN_00408682(param_1,(uint *)0x0);
  return uVar2;
}



/* Function: FUN_00421bd3 */

void FUN_00421bd3(int param_1,int param_2,uint param_3,int param_4)

{
  int iVar1;
  uint uVar2;
  
  uVar2 = 0;
  if (param_3 != 0) {
    uVar2 = (uint)(param_4 * 100) / param_3;
  }
  iVar1 = (**(code **)(**(int **)(param_1 + 0x10) + 0x68))(*(int **)(param_1 + 0x10),uVar2,uVar2);
  FUN_004087fa(param_1,param_2,1,iVar1);
  return;
}



/* Function: FUN_00421c08 */

undefined4 *
FUN_00421c08(HANDLE param_1,int param_2,LPCRITICAL_SECTION param_3,int param_4,HANDLE param_5,
            int *param_6,undefined4 *param_7)

{
  uint *puVar1;
  int iVar2;
  undefined4 *puVar3;
  HANDLE pvVar4;
  BOOL BVar5;
  uint uVar6;
  undefined4 extraout_ECX;
  uint uVar7;
  undefined4 uVar8;
  int iVar9;
  int *piVar10;
  undefined4 *puVar11;
  uint uVar12;
  bool bVar13;
  longlong lVar14;
  undefined8 uVar15;
  DWORD DVar16;
  int local_40;
  int iStack_38;
  int local_34;
  int local_2c;
  uint local_28;
  uint local_20;
  uint local_1c;
  int local_18;
  undefined4 *local_14;
  undefined4 *local_10;
  int local_c;
  uint local_8;
  
  local_40 = 0;
  local_20 = 0x80000000;
  local_28 = 0x80000000;
  local_2c = -0x80000000;
  local_10 = (undefined4 *)0x0;
  iVar2 = (**(code **)(**(int **)(param_2 + 0x10) + 0x78))(*(int **)(param_2 + 0x10));
  puVar3 = (undefined4 *)FUN_004087fa(param_2,0,1,iVar2);
  if ((int)puVar3 < 0) {
    local_14 = puVar3;
    FUN_004300d9();
    FUN_00430a57(puVar3,"UX aborted cache.");
  }
  else {
    iStack_38 = 0;
    local_8 = 0;
    puVar11 = (undefined4 *)0x0;
    local_c = iStack_38;
LAB_00421c81:
    do {
      lVar14 = CONCAT44(local_c,local_8);
      uVar12 = local_20;
      if (local_20 == 0x80000000) {
        uVar12 = 0;
      }
      local_14 = (undefined4 *)0x0;
      local_34 = uVar12 * 0x28;
      puVar3 = (undefined4 *)0x0;
      local_1c = 0x80000000;
      uVar7 = local_8;
      do {
        uVar6 = (uint)((ulonglong)lVar14 >> 0x20);
        local_8 = (uint)lVar14;
        if (*(uint *)(param_4 + 0x50) <= uVar12) break;
        piVar10 = (int *)(*(int *)(param_4 + 0x4c) + local_34);
        local_18 = 0;
        if (piVar10[1] != 0) {
          if (local_20 == uVar12) {
            piVar10[1] = 0;
            goto LAB_00421cd4;
          }
          lVar14 = FUN_004215dd(piVar10);
          lVar14 = lVar14 + CONCAT44(extraout_ECX,local_8);
          local_c = (int)((ulonglong)lVar14 >> 0x20);
          goto LAB_0042206a;
        }
LAB_00421cd4:
        switch(*piVar10) {
        case 1:
          local_40 = piVar10[2];
          goto switchD_00421ce0_caseD_5;
        case 2:
          puVar3 = (undefined4 *)
                   FUN_00421613(param_2,param_5,(LPCWSTR)piVar10[2],(LPCWSTR)piVar10[3],
                                (LPCWSTR)piVar10[4],uVar7,uVar6,*(undefined4 *)(param_4 + 0x20),
                                *(undefined4 *)(param_4 + 0x24));
          local_14 = puVar3;
          if (-1 < (int)puVar3) {
            bVar13 = CARRY4(local_8,piVar10[6]);
            local_8 = local_8 + piVar10[6];
            local_c = local_c + piVar10[7] + (uint)bVar13;
            *param_6 = *param_6 + 1;
            puVar3 = (undefined4 *)FUN_00421bd3(param_2,0,*(uint *)(param_4 + 0x34),*param_6);
            local_14 = puVar3;
            if ((int)puVar3 < 0) goto LAB_00421d6a;
          }
          break;
        case 3:
          local_2c = piVar10[6];
          puVar11 = (undefined4 *)piVar10[2];
          local_10 = puVar11;
          iVar2 = (**(code **)(**(int **)(param_2 + 0x10) + 0x7c))
                            (*(int **)(param_2 + 0x10),*puVar11,piVar10[3],piVar10[4],piVar10[5]);
          puVar3 = (undefined4 *)FUN_004087fa(param_2,0,1,iVar2);
          local_28 = uVar12;
          local_14 = puVar3;
          if ((int)puVar3 < 0) {
            FUN_004309f9(puVar3,0xe0000038,(LPCVOID)0x0);
          }
LAB_00421dd0:
          lVar14 = CONCAT44(local_c,local_8);
          uVar7 = local_8;
          goto LAB_00422070;
        case 4:
          puVar3 = (undefined4 *)FUN_00421bd3(param_2,0,*(uint *)(param_4 + 0x34),*param_6 + 1);
          puVar11 = local_10;
          if (-1 < (int)puVar3) {
            *param_6 = *param_6 + 1;
            local_14 = puVar3;
            (**(code **)(**(int **)(param_2 + 0x10) + 0x98))
                      (*(int **)(param_2 + 0x10),*local_10,puVar3,0);
            puVar11[0x1e] = puVar3;
            puVar11 = (undefined4 *)0x0;
            local_28 = 0x80000000;
            local_2c = -0x80000000;
            local_10 = (undefined4 *)0x0;
            goto LAB_00421dd0;
          }
LAB_00421d6a:
          DVar16 = 0xe0000038;
          local_14 = puVar3;
          goto LAB_00421d6f;
        default:
          goto switchD_00421ce0_caseD_5;
        case 6:
          BVar5 = SetEvent((HANDLE)piVar10[2]);
          if (BVar5 == 0) {
            puVar11 = (undefined4 *)GetLastError();
            puVar3 = (undefined4 *)((uint)puVar11 & 0xffff | 0x80070000);
            if ((int)puVar11 < 1) {
              puVar3 = puVar11;
            }
            if (-1 < (int)puVar3) {
              puVar3 = (undefined4 *)0x80004005;
            }
            local_14 = puVar3;
            FUN_004300d9();
            FUN_00430a57(puVar3,"Failed to set syncpoint event.");
            goto LAB_004221b1;
          }
          break;
        case 7:
          puVar3 = FUN_0041ff7e(param_2,param_3,(LPCWSTR)piVar10[2],(undefined4 *)0x0,(int *)0x0,
                                (LPCWSTR)piVar10[3],uVar7,uVar6,*(undefined4 *)(param_4 + 0x20),
                                *(int *)(param_4 + 0x24));
          local_14 = puVar3;
          if ((int)puVar3 < 0) {
            DVar16 = 0xe0000137;
            goto LAB_00421d6f;
          }
          puVar1 = (uint *)(piVar10[2] + 0x18);
          uVar7 = local_8 + *puVar1;
          local_c = local_c + *(int *)(piVar10[2] + 0x1c) + (uint)CARRY4(local_8,*puVar1);
LAB_00421e10:
          lVar14 = CONCAT44(local_c,uVar7);
          goto switchD_00421ce0_caseD_5;
        case 8:
          if (((piVar10[6] != -0x80000000) &&
              (uVar6 = uVar7, *(int *)(piVar10[6] * 0x28 + 4 + *(int *)(param_4 + 0x4c)) != 0)) ||
             (puVar3 = (undefined4 *)
                       FUN_004213dd(param_1,param_2,piVar10[2],(LPCWSTR)piVar10[7],piVar10[8],
                                    piVar10[9]), uVar6 = local_8, local_14 = puVar3,
             -1 < (int)puVar3)) {
            uVar7 = uVar6 + piVar10[4];
            local_c = local_c + piVar10[5] + (uint)CARRY4(uVar6,piVar10[4]);
            goto LAB_00421e10;
          }
          DVar16 = 0xe0000138;
          goto LAB_00421d6f;
        case 9:
          puVar3 = (undefined4 *)
                   FUN_00421866(param_2,param_5,(undefined4 *)piVar10[3],(undefined4 *)piVar10[2],
                                (undefined4 *)0x0,uVar7,uVar6,*(undefined4 *)(param_4 + 0x20),
                                *(undefined4 *)(param_4 + 0x24),(LPCWSTR)piVar10[6],
                                (LPCWSTR)piVar10[7],piVar10[8],piVar10[5],&local_18);
          local_14 = puVar3;
          if (-1 < (int)puVar3) break;
          DVar16 = 0xe000013c;
LAB_00421ed6:
          puVar3 = local_14;
          FUN_004309f9(local_14,DVar16,(LPCVOID)0x0);
          uVar7 = local_8;
          lVar14 = CONCAT44(local_c,local_8);
          if (local_18 != 0) {
            piVar10[5] = piVar10[5] + 1;
            local_1c = piVar10[4];
            lVar14 = CONCAT44(local_c,local_8);
          }
          goto switchD_00421ce0_caseD_5;
        case 10:
          puVar3 = FUN_0041ff7e(param_2,param_3,(LPCWSTR)0x0,(undefined4 *)piVar10[2],
                                (int *)piVar10[3],(LPCWSTR)piVar10[4],uVar7,uVar6,
                                *(undefined4 *)(param_4 + 0x20),*(int *)(param_4 + 0x24));
          local_14 = puVar3;
          if (-1 < (int)puVar3) {
            puVar1 = (uint *)(piVar10[3] + 0x10);
            uVar7 = local_8 + *puVar1;
            local_c = local_c + *(int *)(piVar10[3] + 0x14) + (uint)CARRY4(local_8,*puVar1);
            goto LAB_00421e10;
          }
          DVar16 = 0xe0000139;
LAB_00421d6f:
          puVar3 = local_14;
          FUN_004309f9(local_14,DVar16,(LPCVOID)0x0);
          break;
        case 0xb:
          pvVar4 = (HANDLE)0xffffffff;
          if (((undefined4 *)piVar10[2])[5] != 0) {
            pvVar4 = param_5;
          }
          puVar3 = (undefined4 *)
                   FUN_00421866(param_2,pvVar4,(undefined4 *)0x0,(undefined4 *)piVar10[2],
                                (undefined4 *)piVar10[3],uVar7,local_c,
                                *(undefined4 *)(param_4 + 0x20),*(undefined4 *)(param_4 + 0x24),
                                (LPCWSTR)0x0,(LPCWSTR)piVar10[6],piVar10[7],piVar10[5],&local_18);
          local_14 = puVar3;
          if ((int)puVar3 < 0) {
            DVar16 = 0xe000013a;
            goto LAB_00421ed6;
          }
          break;
        case 0xc:
          puVar3 = (undefined4 *)
                   FUN_00421866(param_2,param_5,(undefined4 *)0x0,(undefined4 *)piVar10[2],
                                (undefined4 *)piVar10[3],uVar7,uVar6,*(undefined4 *)(param_4 + 0x20)
                                ,*(undefined4 *)(param_4 + 0x24),(LPCWSTR)piVar10[6],
                                (LPCWSTR)piVar10[7],piVar10[8],piVar10[5],&local_18);
          local_14 = puVar3;
          if ((int)puVar3 < 0) {
            DVar16 = 0xe000013d;
            goto LAB_00421ed6;
          }
        }
        lVar14 = CONCAT44(local_c,local_8);
LAB_0042206a:
        local_8 = (uint)lVar14;
        uVar7 = local_8;
switchD_00421ce0_caseD_5:
        puVar11 = local_10;
LAB_00422070:
        local_8 = (uint)lVar14;
        local_34 = local_34 + 0x28;
        uVar12 = uVar12 + 1;
      } while (-1 < (int)puVar3);
      if (local_1c != 0x80000000) {
        FUN_004309f9(puVar3,0xa000015d,(LPCVOID)0x0);
        local_20 = local_1c;
        uVar15 = FUN_004215dd((int *)(local_1c * 0x28 + *(int *)(param_4 + 0x4c)));
        bVar13 = local_8 < (uint)uVar15;
        local_8 = local_8 - (uint)uVar15;
        local_c = (local_c - (int)((ulonglong)uVar15 >> 0x20)) - (uint)bVar13;
        puVar11 = local_10;
        goto LAB_00421c81;
      }
      if (puVar11 == (undefined4 *)0x0) break;
      if (((int)puVar3 < 0) && (puVar11[7] == 0)) {
        uVar8 = 5;
      }
      else {
        uVar8 = 0;
      }
      iVar2 = (**(code **)(**(int **)(param_2 + 0x10) + 0x98))
                        (*(int **)(param_2 + 0x10),*puVar11,puVar3,uVar8);
      iVar2 = FUN_004086ee(param_2,0,2,iVar2);
      if ((int)puVar3 < 0) {
        if (iVar2 == 4) {
          FUN_004309f9(puVar3,0xa000015c,(LPCVOID)0x0);
        }
        else {
          if ((iVar2 != 5) || (puVar11[7] != 0)) goto LAB_0042214e;
          FUN_00402003(2,0xa000015e);
          *param_6 = *param_6 + 1;
          local_28 = local_2c + 1;
        }
        bVar13 = true;
        local_20 = local_28;
      }
      else {
LAB_0042214e:
        bVar13 = false;
      }
      puVar11[0x1e] = puVar3;
      puVar11 = (undefined4 *)0x0;
      local_28 = 0x80000000;
      local_2c = -0x80000000;
      local_10 = (undefined4 *)0x0;
    } while (bVar13);
  }
LAB_004221b1:
  if ((int)puVar3 < 0) {
    uVar12 = 0;
    if (*(int *)(param_4 + 0x58) != 0) {
      piVar10 = *(int **)(param_4 + 0x54);
      do {
        if ((*piVar10 == 1) && (piVar10[2] == local_40)) {
          if ((uVar12 != 0) && (iVar2 = uVar12 - 1, -1 < iVar2)) {
            iVar9 = iVar2 * 0x28;
            do {
              if (*(int *)(*(int *)(param_4 + 0x54) + iVar9) == 5) {
                FUN_00420399(param_5,*(undefined4 **)(*(int *)(param_4 + 0x54) + 8 + iVar9));
              }
              iVar9 = iVar9 + -0x28;
              iVar2 = iVar2 + -1;
              puVar3 = local_14;
            } while (-1 < iVar2);
          }
          break;
        }
        uVar12 = uVar12 + 1;
        piVar10 = piVar10 + 10;
      } while (uVar12 < *(uint *)(param_4 + 0x58));
    }
    *param_7 = 1;
  }
  if (param_5 != (HANDLE)0xffffffff) {
    FUN_004161ac(param_5);
  }
  FUN_00413414(0,*(undefined4 *)(param_4 + 4));
  (**(code **)(**(int **)(param_2 + 0x10) + 0x9c))(*(int **)(param_2 + 0x10),puVar3);
  return puVar3;
}



/* Function: FUN_00422274 */

void FUN_00422274(undefined4 param_1,int param_2,HANDLE param_3)

{
  uint uVar1;
  
  uVar1 = 0;
  if (*(int *)(param_2 + 0x70) != 0) {
    do {
      FUN_00420399(param_3,*(undefined4 **)(*(int *)(param_2 + 0x6c) + uVar1 * 4));
      uVar1 = uVar1 + 1;
    } while (uVar1 < *(uint *)(param_2 + 0x70));
  }
  return;
}



/* Function: FUN_0042229d */

DWORD FUN_0042229d(uint param_1,HANDLE param_2,undefined4 param_3,undefined4 *param_4,
                  undefined4 *param_5,uint *param_6,int *param_7)

{
  uint uVar1;
  DWORD DVar2;
  int *piVar3;
  int iVar4;
  uint uVar5;
  int local_28 [4];
  undefined4 local_18;
  undefined4 local_14;
  int local_10;
  uint local_c;
  int local_8;
  
  uVar1 = param_1;
  piVar3 = local_28;
  for (iVar4 = 6; iVar4 != 0; iVar4 = iVar4 + -1) {
    *piVar3 = 0;
    piVar3 = piVar3 + 1;
  }
  local_18 = *(undefined4 *)(param_1 + 0x408);
  local_14 = param_3;
  uVar5 = 0;
  local_c = 0;
  local_10 = 0;
  local_8 = 0;
  local_28[0] = param_1 + 0xb8;
  iVar4 = (**(code **)(**(int **)(param_1 + 200) + 0xa0))(*(int **)(param_1 + 200),local_18);
  DVar2 = FUN_004087fa(param_1 + 0xb8,0,1,iVar4);
  if ((int)DVar2 < 0) {
    FUN_004300d9();
    FUN_00430a57(DVar2,"BA aborted execute begin.");
  }
  else if (*(int *)(param_1 + 0x438) != 0) {
    param_1 = 0;
    do {
      piVar3 = (int *)(*(int *)(uVar1 + 0x434) + param_1);
      if (piVar3[1] == 0) {
        if (local_8 != 0) {
          if (*piVar3 == 0xc) goto LAB_004223ac;
          local_8 = 0;
        }
        DVar2 = FUN_0042051a(uVar1,piVar3,param_2,local_28,&local_10,&local_c,param_4,param_6,
                             param_7);
        if ((*param_6 != 0) || (*param_7 == 2)) break;
        if ((int)DVar2 < 0) {
          if ((*(int *)(uVar1 + 0x3b0) != 0) ||
             ((FUN_0042079e(uVar1,local_28,local_c,param_4,param_7), local_10 != 0 &&
              (*(int *)(local_10 + 4) != 0)))) {
            *param_5 = 1;
            break;
          }
          local_8 = 1;
        }
      }
LAB_004223ac:
      uVar5 = uVar5 + 1;
      param_1 = param_1 + 0x30;
    } while (uVar5 < *(uint *)(uVar1 + 0x438));
  }
  (**(code **)(**(int **)(uVar1 + 200) + 0xbc))(*(int **)(uVar1 + 200),DVar2);
  return DVar2;
}



/* Function: FUN_004223e3 */

void FUN_004223e3(void)

{
  SetThreadExecutionState(0x80000001);
  return;
}



/* Function: FUN_004223ef */

undefined4 FUN_004223ef(void)

{
  return 0;
}



/* Function: FUN_004223f4 */

DWORD FUN_004223f4(int param_1)

{
  int iVar1;
  DWORD DVar2;
  char *pcVar3;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  iVar1 = (**(code **)(**(int **)(param_1 + 200) + 0x70))(*(int **)(param_1 + 200));
  DVar2 = FUN_004087fa(param_1 + 0xb8,0,1,iVar1);
  if ((int)DVar2 < 0) {
    FUN_004300d9();
    FUN_00430a57(DVar2,"UX aborted register begin.");
    goto LAB_00422568;
  }
  if (*(int *)(param_1 + 0x30) < 4) {
    DVar2 = FUN_0041334a(*(undefined4 *)(param_1 + 0x104),*(undefined4 *)(param_1 + 0x140),
                         (int *)&local_8);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to calculate working path for engine.";
      goto LAB_00422526;
    }
    if (*(int *)(param_1 + 0xf8) == 0) {
      DVar2 = FUN_0040ad55(local_8,(int *)(param_1 + 0xf8),(LPCRITICAL_SECTION)(param_1 + 0x88),
                           param_1 + 0xb8,(byte)*(undefined4 *)(param_1 + 0x3ec),
                           *(int *)(param_1 + 0x410),*(uint *)(param_1 + 0x400),
                           *(uint *)(param_1 + 0x404));
      if ((int)DVar2 < 0) {
        pcVar3 = "Failed to begin registration session.";
        goto LAB_00422526;
      }
    }
    else {
      DVar2 = FUN_00416e95(*(HANDLE *)(param_1 + 0x47c),local_8,*(LPCWSTR *)(param_1 + 0x150),
                           (LPCRITICAL_SECTION)(param_1 + 0x88),*(undefined4 *)(param_1 + 0x3ec),
                           *(int *)(param_1 + 0x410),*(uint *)(param_1 + 0x400),
                           *(uint *)(param_1 + 0x404));
      if ((int)DVar2 < 0) {
        pcVar3 = "Failed to begin registration session in per-machine process.";
        goto LAB_00422526;
      }
    }
  }
  else if (*(int *)(param_1 + 0xf8) == 0) {
    DVar2 = FUN_0040b468(param_1 + 0xf8);
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to resume registration session.";
      goto LAB_00422526;
    }
  }
  else {
    DVar2 = FUN_00417050(*(HANDLE *)(param_1 + 0x47c),*(LPCWSTR *)(param_1 + 0x150));
    if ((int)DVar2 < 0) {
      pcVar3 = "Failed to resume registration session in per-machine process.";
LAB_00422526:
      FUN_00430a57(DVar2,pcVar3);
      goto LAB_00422568;
    }
  }
  FUN_00420b39(*(HANDLE *)(param_1 + 0x47c),(int *)(param_1 + 0xf8),*(int **)(param_1 + 0x414),
               *(uint *)(param_1 + 0x418));
  DVar2 = FUN_00411ea8(param_1);
  if ((int)DVar2 < 0) {
    FUN_004309f9(DVar2,0xa00001f5,(LPCVOID)0x0);
    DVar2 = 0;
  }
LAB_00422568:
  (**(code **)(**(int **)(param_1 + 200) + 0x74))(*(int **)(param_1 + 200),DVar2);
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar2;
}



/* Function: FUN_0042258b */

void FUN_0042258b(int param_1,int param_2)

{
  uint uVar1;
  int iVar2;
  
  FUN_004087e8(param_1);
  uVar1 = 0;
  if (*(int *)(param_2 + 0xc) != 0) {
    iVar2 = 0;
    do {
      iVar2 = iVar2 + 0xd0;
      *(undefined4 *)(*(int *)(param_2 + 8) + -0x58 + iVar2) = 0;
      uVar1 = uVar1 + 1;
    } while (uVar1 < *(uint *)(param_2 + 0xc));
  }
  return;
}



/* Function: FUN_004225bc */

int FUN_004225bc(LPCRITICAL_SECTION param_1)

{
  int iVar1;
  
  iVar1 = FUN_0040461f(param_1,L"WixBundleForcedRestartPackage",0,1);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to set the bundle forced restart package built-in variable.");
  }
  return iVar1;
}



/* Function: FUN_004225eb */

void FUN_004225eb(void)

{
  SetThreadExecutionState(0x80000000);
  return;
}



/* Function: FUN_004225f7 */

DWORD FUN_004225f7(int param_1,int param_2,int param_3,int param_4,int param_5)

{
  DWORD DVar1;
  int iVar2;
  char *pcVar3;
  
  (**(code **)(**(int **)(param_1 + 200) + 0xc0))(*(int **)(param_1 + 200));
  if (param_5 == 2) {
    iVar2 = 4;
  }
  else {
    iVar2 = 2;
    if (param_4 == 0) {
      iVar2 = 0;
      if (param_3 != 0) {
        iVar2 = 3;
      }
    }
  }
  if ((param_2 != 0) && (param_3 != 0)) {
    FUN_00420b39(*(HANDLE *)(param_1 + 0x47c),(int *)(param_1 + 0xf8),*(int **)(param_1 + 0x41c),
                 *(uint *)(param_1 + 0x420));
  }
  if (*(int *)(param_1 + 0xf8) == 0) {
    DVar1 = FUN_0040b31f((int *)(param_1 + 0xf8),iVar2,param_5,*(int *)(param_1 + 0x410));
    if (-1 < (int)DVar1) goto LAB_0042269f;
    pcVar3 = "Failed to end session in per-user process.";
  }
  else {
    DVar1 = FUN_00416fa3(*(HANDLE *)(param_1 + 0x47c),iVar2,param_5,*(int *)(param_1 + 0x410));
    if (-1 < (int)DVar1) {
LAB_0042269f:
      *(int *)(param_1 + 0x49c) = iVar2;
      goto LAB_004226a5;
    }
    pcVar3 = "Failed to end session in per-machine process.";
  }
  FUN_00430a57(DVar1,pcVar3);
LAB_004226a5:
  (**(code **)(**(int **)(param_1 + 200) + 0xc4))(*(int **)(param_1 + 200),DVar1);
  return DVar1;
}



/* Function: FUN_004226be */

uint FUN_004226be(undefined4 param_1,undefined4 param_2,int param_3)

{
  uint uVar1;
  char *pcVar2;
  int *local_14;
  int *local_10;
  int *local_c;
  int *local_8;
  
  local_14 = (int *)0x0;
  local_8 = (int *)0x0;
  local_10 = (int *)0x0;
  local_c = (int *)0x0;
  uVar1 = FUN_00435e28(param_1,param_2,&local_14);
  if ((int)uVar1 < 0) {
    pcVar2 = "Failed to load manifest as XML document.";
  }
  else {
    uVar1 = (**(code **)(*local_14 + 0xb4))(local_14,&local_8);
    if ((int)uVar1 < 0) {
      pcVar2 = "Failed to get bundle element.";
    }
    else {
      uVar1 = FUN_00436045(local_8,(undefined2 *)&DAT_0044c8a0,(int)&local_10);
      if (-1 < (int)uVar1) {
        if (uVar1 == 0) {
          uVar1 = FUN_00435b5e(local_10,L"PathVariable",(int *)(param_3 + 0x3c0));
          if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
            uVar1 = FUN_00435b5e(local_10,L"Prefix",(int *)(param_3 + 0x3cc));
            if ((int)uVar1 < 0) {
              pcVar2 = "Failed to get Log/@Prefix attribute.";
            }
            else {
              uVar1 = FUN_00435b5e(local_10,L"Extension",(int *)(param_3 + 0x3d0));
              if (-1 < (int)uVar1) goto LAB_004227b3;
              pcVar2 = "Failed to get Log/@Extension attribute.";
            }
          }
          else {
            pcVar2 = "Failed to get Log/@PathVariable.";
          }
        }
        else {
LAB_004227b3:
          uVar1 = FUN_00436045(local_8,L"Chain",(int)&local_c);
          if ((int)uVar1 < 0) {
            pcVar2 = "Failed to get chain element.";
          }
          else if (uVar1 == 0) {
            uVar1 = FUN_00435d6c(local_c,L"DisableRollback",(uint *)(param_3 + 0x3b0));
            if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
              uVar1 = FUN_00435d6c(local_c,L"DisableSystemRestore",(uint *)(param_3 + 0x3b4));
              if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) {
                uVar1 = FUN_00435d6c(local_c,L"ParallelCache",(uint *)(param_3 + 0x3b8));
                if ((uVar1 == 0x80070490) || (-1 < (int)uVar1)) goto LAB_0042284e;
                pcVar2 = "Failed to to get Chain/@ParallelCache";
              }
              else {
                pcVar2 = "Failed to to get Chain/@DisableSystemRestore";
              }
            }
            else {
              pcVar2 = "Failed to to get Chain/@DisableRollback";
            }
          }
          else {
LAB_0042284e:
            uVar1 = FUN_00405ab1((int *)(param_3 + 0xac),local_8);
            if ((int)uVar1 < 0) {
              pcVar2 = "Failed to parse global condition.";
            }
            else {
              uVar1 = FUN_00404769((LPCRITICAL_SECTION)(param_3 + 0x88),local_8);
              if ((int)uVar1 < 0) {
                pcVar2 = "Failed to parse variables.";
              }
              else {
                uVar1 = FUN_004068e6((int *)(param_3 + 0xb0),local_8);
                if ((int)uVar1 < 0) {
                  pcVar2 = "Failed to parse searches.";
                }
                else {
                  uVar1 = FUN_0040892e((uint *)(param_3 + 0xb8),local_8);
                  if ((int)uVar1 < 0) {
                    pcVar2 = "Failed to parse user experience.";
                  }
                  else {
                    uVar1 = FUN_00407c43((int *)(param_3 + 0x298),local_8);
                    if ((int)uVar1 < 0) {
                      pcVar2 = "Failed to parse catalog files.";
                    }
                    else {
                      uVar1 = FUN_0040a79f((uint *)(param_3 + 0xf8),local_8);
                      if ((int)uVar1 < 0) {
                        pcVar2 = "Failed to parse registration.";
                      }
                      else {
                        uVar1 = FUN_00409897(param_3 + 0x2d0,local_8);
                        if ((int)uVar1 < 0) {
                          pcVar2 = "Failed to parse update.";
                        }
                        else {
                          uVar1 = FUN_004191b5(param_3 + 0x48,(int *)(param_3 + 0x290),local_8);
                          if ((int)uVar1 < 0) {
                            pcVar2 = "Failed to parse containers.";
                          }
                          else {
                            uVar1 = FUN_00407fa7((int *)(param_3 + 0x2a0),(int *)(param_3 + 0x290),
                                                 (int *)(param_3 + 0x298),local_8);
                            if ((int)uVar1 < 0) {
                              pcVar2 = "Failed to parse payloads.";
                            }
                            else {
                              uVar1 = FUN_0040903a((int *)(param_3 + 0x2a8),(int *)(param_3 + 0x2a0)
                                                   ,local_8);
                              if (-1 < (int)uVar1) goto LAB_00422993;
                              pcVar2 = "Failed to parse packages.";
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
        FUN_00430a57(uVar1,pcVar2);
        goto LAB_00422993;
      }
      pcVar2 = "Failed to get Log element.";
    }
  }
  FUN_00430a57(uVar1,pcVar2);
LAB_00422993:
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  if (local_10 != (int *)0x0) {
    (**(code **)(*local_10 + 8))(local_10);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_14 != (int *)0x0) {
    (**(code **)(*local_14 + 8))(local_14);
  }
  return uVar1;
}



/* Function: FUN_004229ce */

int FUN_004229ce(uint param_1,int param_2,int *param_3,int param_4,LPCWSTR param_5,int param_6,
                int param_7,LPCWSTR param_8,LPCWSTR param_9,LPCWSTR param_10,int param_11,
                int param_12,int param_13,LPCWSTR param_14,LPCWSTR param_15,LPCWSTR param_16,
                undefined4 *param_17,void *param_18,SIZE_T param_19)

{
  wchar_t *pwVar1;
  int iVar2;
  undefined4 uVar3;
  uint uVar4;
  int iVar5;
  char *pcVar6;
  short *local_8;
  
  local_8 = (short *)0x0;
  pwVar1 = FUN_00411e63(param_6);
  if (pwVar1 != (wchar_t *)0x0) {
    FUN_00433cea((int *)&local_8,L" -%ls");
  }
  iVar2 = FUN_00431078(8,1);
  param_3[0x1f] = iVar2;
  if (iVar2 == 0) {
    FUN_004300d9();
    pcVar6 = "Failed to allocate space for burn package payload inside of related bundle struct";
LAB_00422a26:
    iVar2 = -0x7ff8fff2;
  }
  else {
    param_3[0x20] = 1;
    uVar3 = FUN_00431078(0x58,1);
    *(undefined4 *)param_3[0x1f] = uVar3;
    if ((int *)param_3[0x1f] == (int *)0x0) {
      FUN_004300d9();
      pcVar6 = "Failed to allocate space for burn payload inside of related bundle struct";
      goto LAB_00422a26;
    }
    *(undefined4 *)(*(int *)param_3[0x1f] + 4) = 3;
    iVar2 = *(int *)param_3[0x1f];
    *(int *)(iVar2 + 0x10) = param_11;
    *(int *)(iVar2 + 0x14) = param_12;
    iVar2 = FUN_00433f88(*(int **)param_3[0x1f],param_5,0);
    if (iVar2 < 0) {
      pcVar6 = "Failed to copy key for pseudo bundle payload.";
    }
    else {
      iVar2 = FUN_00433f88((int *)(*(int *)param_3[0x1f] + 0x18),param_8,0);
      if (iVar2 < 0) {
        pcVar6 = "Failed to copy filename for pseudo bundle.";
      }
      else {
        iVar2 = FUN_00433f88((int *)(*(int *)param_3[0x1f] + 0x38),param_9,0);
        if (iVar2 < 0) {
          pcVar6 = "Failed to copy local source path for pseudo bundle.";
        }
        else if (((param_10 == (LPCWSTR)0x0) || (*param_10 == L'\0')) ||
                (iVar2 = FUN_00433f88((int *)(*(int *)param_3[0x1f] + 0x40),param_10,0), -1 < iVar2)
                ) {
          if (param_18 != (void *)0x0) {
            uVar3 = FUN_00431078(param_19,0);
            *(undefined4 *)(*(int *)param_3[0x1f] + 0x30) = uVar3;
            if (*(int *)(*(int *)param_3[0x1f] + 0x30) == 0) {
              FUN_004300d9();
              pcVar6 = "Failed to allocate memory for pseudo bundle payload hash.";
              goto LAB_00422a26;
            }
            *(SIZE_T *)(*(int *)param_3[0x1f] + 0x34) = param_19;
            _memcpy_s(*(void **)(*(int *)param_3[0x1f] + 0x30),
                      *(rsize_t *)(*(int *)param_3[0x1f] + 0x34),param_18,param_19);
          }
          if ((param_7 == 4) || (param_7 == 3)) {
            uVar3 = 1;
          }
          else {
            uVar3 = 0;
          }
          *(undefined4 *)(param_3[0x1f] + 4) = uVar3;
          param_3[0x29] = 1;
          param_3[0x23] = 1;
          param_3[5] = param_4;
          param_3[0x10] = param_7;
          if ((param_7 == 4) || (param_7 == 3)) {
            iVar2 = 2;
          }
          else {
            iVar2 = 0;
          }
          param_3[0x11] = iVar2;
          param_3[0xb] = param_12;
          param_3[0xd] = param_12;
          param_3[10] = param_11;
          param_3[0xc] = param_11;
          param_3[7] = param_13;
          iVar2 = FUN_00433f88(param_3,param_5,0);
          if (iVar2 < 0) {
LAB_00422bdc:
            pcVar6 = "Failed to copy key for pseudo bundle.";
          }
          else {
            iVar2 = FUN_00433f88(param_3 + 9,param_5,0);
            if (iVar2 < 0) {
              pcVar6 = "Failed to copy cache id for pseudo bundle.";
            }
            else {
              iVar2 = FUN_00433f88(param_3 + 0x25,param_14,0);
              if (iVar2 < 0) {
                pcVar6 = "Failed to copy install arguments for related bundle package";
              }
              else if ((local_8 == (short *)0x0) ||
                      (iVar2 = FUN_00433c35(param_3 + 0x25,local_8,0), -1 < iVar2)) {
                if (param_15 == (LPCWSTR)0x0) {
LAB_00422c9b:
                  if (param_16 == (LPCWSTR)0x0) {
LAB_00422ceb:
                    uVar4 = param_2 + -0x30007 + (uint)(0x8acffff < param_1);
                    if ((uVar4 < 2) && ((uVar4 == 0 || (param_1 + 0xf7530000 < 0xfbbb0001)))) {
                      iVar5 = 1;
                    }
                    else {
                      iVar5 = 0;
                    }
                    param_3[0x2b] = iVar5;
                    if (param_17 == (undefined4 *)0x0) goto LAB_00422dcd;
                    iVar2 = FUN_00431078(0x10,1);
                    param_3[0x21] = iVar2;
                    if (iVar2 == 0) {
                      FUN_004300d9();
                      pcVar6 = "Failed to allocate memory for dependency providers.";
                      goto LAB_00422a26;
                    }
                    param_3[0x22] = 1;
                    *(undefined4 *)(iVar2 + 0xc) = param_17[3];
                    iVar2 = FUN_00433f88((int *)param_3[0x21],(LPCWSTR)*param_17,0);
                    if (iVar2 < 0) goto LAB_00422bdc;
                    iVar2 = FUN_00433f88((int *)(param_3[0x21] + 4),(LPCWSTR)param_17[1],0);
                    if (iVar2 < 0) {
                      pcVar6 = "Failed to copy version for pseudo bundle.";
                    }
                    else {
                      iVar2 = FUN_00433f88((int *)(param_3[0x21] + 8),(LPCWSTR)param_17[2],0);
                      if (-1 < iVar2) goto LAB_00422dcd;
                      pcVar6 = "Failed to copy display name for pseudo bundle.";
                    }
                  }
                  else {
                    iVar2 = FUN_00433f88(param_3 + 0x27,param_16,0);
                    if (iVar2 < 0) {
                      pcVar6 = "Failed to copy uninstall arguments for related bundle package";
                    }
                    else {
                      if ((local_8 == (short *)0x0) ||
                         (iVar2 = FUN_00433c35(param_3 + 0x27,local_8,0), -1 < iVar2)) {
                        param_3[6] = 1;
                        goto LAB_00422ceb;
                      }
                      pcVar6 = 
                      "Failed to append relation type to uninstall arguments for related bundle package"
                      ;
                    }
                  }
                }
                else {
                  iVar2 = FUN_00433f88(param_3 + 0x26,param_15,0);
                  if (iVar2 < 0) {
                    pcVar6 = "Failed to copy repair arguments for related bundle package";
                  }
                  else {
                    if ((local_8 == (short *)0x0) ||
                       (iVar2 = FUN_00433c35(param_3 + 0x26,local_8,0), -1 < iVar2)) {
                      param_3[0x2a] = 1;
                      goto LAB_00422c9b;
                    }
                    pcVar6 = 
                    "Failed to append relation type to repair arguments for related bundle package";
                  }
                }
              }
              else {
                pcVar6 = 
                "Failed to append relation type to install arguments for related bundle package";
              }
            }
          }
        }
        else {
          pcVar6 = "Failed to copy download source for pseudo bundle.";
        }
      }
    }
  }
  FUN_00430a57(iVar2,pcVar6);
LAB_00422dcd:
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar2;
}



/* Function: FUN_00422de3 */

int FUN_00422de3(int *param_1,int *param_2,short *param_3,short *param_4,undefined4 *param_5)

{
  int iVar1;
  int iVar2;
  int *piVar3;
  int iVar4;
  int *piVar5;
  undefined4 uVar6;
  char *pcVar7;
  LPCWSTR local_8;
  
  piVar3 = param_1;
  local_8 = (LPCWSTR)0x0;
  iVar4 = FUN_00431078(param_5[0x20] << 3,1);
  param_1[0x1f] = iVar4;
  if (iVar4 == 0) {
    FUN_004300d9();
    pcVar7 = "Failed to allocate space for burn package payload inside of passthrough bundle.";
LAB_0042301f:
    iVar4 = -0x7ff8fff2;
  }
  else {
    param_1[0x20] = param_5[0x20];
    param_1 = (int *)0x0;
    if (param_5[0x20] != 0) {
      do {
        iVar4 = (int)param_1 * 8;
        piVar5 = (int *)(param_5[0x1f] + iVar4);
        uVar6 = FUN_00431078(0x58,1);
        *(undefined4 *)(iVar4 + piVar3[0x1f]) = uVar6;
        if (*(int *)(iVar4 + piVar3[0x1f]) == 0) {
          FUN_004300d9();
          pcVar7 = "Failed to allocate space for burn payload inside of related bundle struct";
          goto LAB_0042301f;
        }
        *(undefined4 *)(*(int *)(iVar4 + piVar3[0x1f]) + 4) = *(undefined4 *)(*piVar5 + 4);
        iVar1 = *piVar5;
        iVar2 = *(int *)(iVar4 + piVar3[0x1f]);
        *(undefined4 *)(iVar2 + 0x10) = *(undefined4 *)(iVar1 + 0x10);
        *(undefined4 *)(iVar2 + 0x14) = *(undefined4 *)(iVar1 + 0x14);
        iVar4 = FUN_00433f88(*(int **)(iVar4 + piVar3[0x1f]),*(LPCWSTR *)*piVar5,0);
        if (iVar4 < 0) {
          pcVar7 = "Failed to copy key for passthrough pseudo bundle payload.";
          goto LAB_0042311c;
        }
        iVar4 = FUN_00433f88((int *)(*(int *)(piVar3[0x1f] + (int)param_1 * 8) + 0x18),
                             *(LPCWSTR *)(*piVar5 + 0x18),0);
        if (iVar4 < 0) {
          pcVar7 = "Failed to copy filename for passthrough pseudo bundle.";
          goto LAB_0042311c;
        }
        iVar4 = FUN_00433f88((int *)(*(int *)(piVar3[0x1f] + (int)param_1 * 8) + 0x38),
                             *(LPCWSTR *)(*piVar5 + 0x38),0);
        if (iVar4 < 0) {
          pcVar7 = "Failed to copy local source path for passthrough pseudo bundle.";
          goto LAB_0042311c;
        }
        if ((*(int *)(*piVar5 + 0x40) != 0) &&
           (iVar4 = FUN_00433f88((int *)(*(int *)(piVar3[0x1f] + (int)param_1 * 8) + 0x40),
                                 *(LPCWSTR *)(*piVar5 + 0x40),0), iVar4 < 0)) {
          pcVar7 = "Failed to copy download source for passthrough pseudo bundle.";
          goto LAB_0042311c;
        }
        if (*(int *)(*piVar5 + 0x30) != 0) {
          uVar6 = FUN_00431078(*(SIZE_T *)(*piVar5 + 0x34),0);
          *(undefined4 *)(*(int *)(piVar3[0x1f] + (int)param_1 * 8) + 0x30) = uVar6;
          iVar4 = *(int *)(piVar3[0x1f] + (int)param_1 * 8);
          if (*(int *)(iVar4 + 0x30) == 0) {
            FUN_004300d9();
            pcVar7 = "Failed to allocate memory for pseudo bundle payload hash.";
            goto LAB_0042301f;
          }
          *(undefined4 *)(iVar4 + 0x34) = *(undefined4 *)(*piVar5 + 0x34);
          iVar4 = *(int *)(piVar3[0x1f] + (int)param_1 * 8);
          _memcpy_s(*(void **)(iVar4 + 0x30),*(rsize_t *)(iVar4 + 0x34),*(void **)(*piVar5 + 0x30),
                    *(rsize_t *)(*piVar5 + 0x34));
        }
        *(int *)(piVar3[0x1f] + 4 + (int)param_1 * 8) = piVar5[1];
        param_1 = (int *)((int)param_1 + 1);
      } while (param_1 < (int *)param_5[0x20]);
    }
    piVar3[5] = 0;
    piVar3[0x29] = 1;
    piVar3[0x23] = param_5[0x23];
    piVar3[0x10] = param_5[0x10];
    piVar3[0x11] = param_5[0x11];
    piVar3[10] = param_5[10];
    piVar3[0xb] = param_5[0xb];
    piVar3[0xc] = param_5[0xc];
    piVar3[0xd] = param_5[0xd];
    piVar3[7] = param_5[7];
    iVar4 = FUN_00433f88(piVar3,(LPCWSTR)*param_5,0);
    if (iVar4 < 0) {
      pcVar7 = "Failed to copy key for passthrough pseudo bundle.";
    }
    else {
      iVar4 = FUN_00433f88(piVar3 + 9,(LPCWSTR)param_5[9],0);
      if (iVar4 < 0) {
        pcVar7 = "Failed to copy cache id for passthrough pseudo bundle.";
      }
      else {
        piVar3[0x2b] = param_5[0x2b];
        iVar4 = FUN_00411c05((int *)&local_8,*param_2,param_2[1],param_2[2],param_2[7],1,param_4,
                             param_3,(short *)param_2[3]);
        if (iVar4 < 0) {
          pcVar7 = "Failed to recreate command-line arguments.";
        }
        else {
          iVar4 = FUN_00433f88(piVar3 + 0x25,local_8,0);
          if (iVar4 < 0) {
            pcVar7 = "Failed to copy install arguments for passthrough bundle package";
          }
          else {
            iVar4 = FUN_00433f88(piVar3 + 0x26,local_8,0);
            if (iVar4 < 0) {
              pcVar7 = "Failed to copy related arguments for passthrough bundle package";
            }
            else {
              piVar3[0x2a] = 1;
              iVar4 = FUN_00433f88(piVar3 + 0x27,local_8,0);
              if (-1 < iVar4) {
                piVar3[6] = 1;
                goto LAB_0042312c;
              }
              pcVar7 = "Failed to copy uninstall arguments for passthrough bundle package";
            }
          }
        }
      }
    }
  }
LAB_0042311c:
  FUN_00430a57(iVar4,pcVar7);
LAB_0042312c:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar4;
}



/* Function: FUN_00423143 */

int FUN_00423143(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)

{
  int *piVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  
  piVar1 = (int *)(param_1 + 0x30);
  iVar4 = FUN_0043109a(piVar1,*(uint *)(param_1 + 0x34),0x10,2);
  if (iVar4 < 0) {
    FUN_00430a57(iVar4,"Failed to allocate memory for the virtual file pointer array.");
  }
  else {
    *(undefined4 *)(*piVar1 + *(int *)(param_1 + 0x34) * 0x10) = param_2;
    iVar2 = *(int *)(param_1 + 0x34);
    iVar3 = *piVar1;
    *(undefined4 *)(iVar3 + 8 + iVar2 * 0x10) = param_3;
    *(undefined4 *)(iVar3 + 0xc + iVar2 * 0x10) = param_4;
    *(int *)(param_1 + 0x34) = *(int *)(param_1 + 0x34) + 1;
  }
  return iVar4;
}



/* Function: FUN_0042319f */

DWORD FUN_0042319f(int param_1)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  
  BVar1 = SetEvent(*(HANDLE *)(param_1 + 0x24));
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar3,"Failed to set begin operation event.");
  }
  else {
    uVar3 = FUN_00423e70(param_1);
  }
  return uVar3;
}



/* Function: FUN_004231ff */

void __cdecl FUN_004231ff(SIZE_T param_1)

{
  FUN_00431078(param_1,0);
  return;
}



/* Function: FUN_0042320e */

undefined4 __cdecl FUN_0042320e(HANDLE param_1)

{
  int *piVar1;
  
  piVar1 = FUN_00423d74(*(int *)(*(int *)((int)ThreadLocalStoragePointer + _tls_index * 4) + 4) +
                        0x1c,(int)param_1);
  if (piVar1 != (int *)0x0) {
    *piVar1 = -1;
    piVar1[2] = 0;
    piVar1[3] = 0;
  }
  if (param_1 != (HANDLE)0xffffffff) {
    CloseHandle(param_1);
  }
  return 0;
}



/* Function: FUN_00423254 */

void __cdecl FUN_00423254(LPVOID param_1)

{
  FUN_00431137(param_1);
  return;
}



/* Function: FUN_00423261 */

undefined4 __cdecl FUN_00423261(int param_1,SIZE_T *param_2)

{
  int iVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  iVar1 = *(int *)(*(int *)((int)ThreadLocalStoragePointer + _tls_index * 4) + 4);
  if (param_1 != 1) {
    if (param_1 == 2) {
      uVar2 = FUN_004236dc(iVar1,param_2);
    }
    else if (param_1 == 3) {
      uVar2 = FUN_00423625(iVar1,(int)param_2);
    }
  }
  return uVar2;
}



/* Function: FUN_004232a4 */

HANDLE __cdecl FUN_004232a4(LPCSTR param_1)

{
  undefined4 *puVar1;
  DWORD DVar2;
  HANDLE hTargetProcessHandle;
  HANDLE hSourceProcessHandle;
  uint uVar3;
  HANDLE hSourceHandle;
  HANDLE *lpTargetHandle;
  DWORD dwDesiredAccess;
  BOOL BVar4;
  char *pcVar5;
  HANDLE local_8;
  
  puVar1 = *(undefined4 **)(*(int *)((int)ThreadLocalStoragePointer + _tls_index * 4) + 4);
  uVar3 = 0;
  local_8 = (HANDLE)0xffffffff;
  DVar2 = CompareStringA(0,0,"<the>.cab",-1,param_1,-1);
  if (DVar2 == 2) {
    BVar4 = 0;
    dwDesiredAccess = 0;
    lpTargetHandle = &local_8;
    hTargetProcessHandle = GetCurrentProcess();
    hSourceHandle = (HANDLE)*puVar1;
    hSourceProcessHandle = GetCurrentProcess();
    BVar4 = DuplicateHandle(hSourceProcessHandle,hSourceHandle,hTargetProcessHandle,lpTargetHandle,
                            dwDesiredAccess,BVar4,DVar2);
    if (BVar4 == 0) {
      DVar2 = GetLastError();
      uVar3 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar3 = DVar2;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
      FUN_004300d9();
      pcVar5 = "Failed to duplicate handle to cab container.";
    }
    else {
      uVar3 = FUN_00423143((int)(puVar1 + 7),local_8,puVar1[2],puVar1[3]);
      if (-1 < (int)uVar3) goto LAB_004233b9;
      pcVar5 = "Failed to add virtual file pointer for cab container.";
    }
    FUN_00430a57(uVar3,pcVar5);
  }
  else {
    local_8 = CreateFileA(param_1,0x80000000,1,(LPSECURITY_ATTRIBUTES)0x0,3,0x8000080,(HANDLE)0x0);
    if (local_8 == (HANDLE)0xffffffff) {
      DVar2 = GetLastError();
      uVar3 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar3 = DVar2;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar3,"Failed to open cabinet file: %hs");
    }
  }
LAB_004233b9:
  puVar1[0xc] = uVar3;
  if ((int)uVar3 < 0) {
    local_8 = (HANDLE)0xffffffff;
  }
  return local_8;
}



/* Function: FUN_004233c9 */

DWORD __cdecl FUN_004233c9(HANDLE param_1,LPVOID param_2,uint param_3)

{
  int iVar1;
  BOOL BVar2;
  DWORD DVar3;
  uint uVar4;
  DWORD local_8;
  
  iVar1 = *(int *)(*(int *)((int)ThreadLocalStoragePointer + _tls_index * 4) + 4);
  uVar4 = 0;
  local_8 = 0;
  FUN_00423d9d(iVar1 + 0x1c,param_1,param_3);
  BVar2 = ReadFile(param_1,param_2,param_3,&local_8,(LPOVERLAPPED)0x0);
  if (BVar2 == 0) {
    DVar3 = GetLastError();
    uVar4 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar4 = DVar3;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar4,"Failed to read during cabinet extraction.");
  }
  *(uint *)(iVar1 + 0x30) = uVar4;
  if ((int)uVar4 < 0) {
    local_8 = 0xffffffff;
  }
  return local_8;
}



/* Function: FUN_0042345d */

int __cdecl FUN_0042345d(HANDLE param_1,uint param_2,PLARGE_INTEGER param_3)

{
  int iVar1;
  LARGE_INTEGER liDistanceToMove;
  int iVar2;
  BOOL BVar3;
  DWORD DVar4;
  uint uVar5;
  uint uVar6;
  DWORD unaff_EDI;
  bool bVar7;
  int local_10 [3];
  
  iVar1 = *(int *)(*(int *)((int)ThreadLocalStoragePointer + _tls_index * 4) + 4);
  uVar6 = 0;
  local_10[0] = 0;
  local_10[1] = 0;
  local_10[2] = (int)param_2 >> 0x1f;
  if (param_3 == (PLARGE_INTEGER)0x0) {
    bVar7 = CARRY4(param_2,*(uint *)(iVar1 + 8));
    param_2 = param_2 + *(uint *)(iVar1 + 8);
    local_10[2] = local_10[2] + *(int *)(iVar1 + 0xc) + (uint)bVar7;
  }
  else if (param_3 != (PLARGE_INTEGER)0x1) {
    if (param_3 != (PLARGE_INTEGER)0x2) {
      uVar6 = 0x80070057;
      FUN_00430a57(0x80070057,"Invalid seek type.");
      goto LAB_00423550;
    }
    uVar5 = *(uint *)(iVar1 + 0x10) + *(uint *)(iVar1 + 8);
    bVar7 = CARRY4(uVar5,param_2);
    param_2 = uVar5 + param_2;
    local_10[2] = *(int *)(iVar1 + 0x14) + *(int *)(iVar1 + 0xc) +
                  (uint)CARRY4(*(uint *)(iVar1 + 0x10),*(uint *)(iVar1 + 8)) + local_10[2] +
                  (uint)bVar7;
  }
  iVar2 = FUN_00423e1d(iVar1 + 0x1c,(int)param_1,param_2,local_10[2],local_10,(int)param_3);
  if ((iVar2 == 0) ||
     (liDistanceToMove.s.HighPart = (LONG)local_10, liDistanceToMove.s.LowPart = local_10[2],
     BVar3 = SetFilePointerEx(param_1,liDistanceToMove,param_3,unaff_EDI), BVar3 != 0)) {
    local_10[0] = local_10[0] - *(int *)(iVar1 + 8);
  }
  else {
    DVar4 = GetLastError();
    uVar6 = DVar4 & 0xffff | 0x80070000;
    if ((int)DVar4 < 1) {
      uVar6 = DVar4;
    }
    if (-1 < (int)uVar6) {
      uVar6 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar6,"Failed to move file pointer 0x%x bytes.");
  }
LAB_00423550:
  *(uint *)(iVar1 + 0x30) = uVar6;
  if ((int)uVar6 < 0) {
    local_10[0] = -1;
  }
  return local_10[0];
}



/* Function: FUN_00423563 */

DWORD __cdecl FUN_00423563(undefined4 param_1,LPCVOID param_2,DWORD param_3)

{
  int iVar1;
  BOOL BVar2;
  DWORD DVar3;
  uint uVar4;
  char *pcVar5;
  DWORD local_8;
  
  iVar1 = *(int *)(*(int *)((int)ThreadLocalStoragePointer + _tls_index * 4) + 4);
  uVar4 = 0;
  local_8 = 0;
  if (*(int *)(iVar1 + 0x2c) == 2) {
    BVar2 = WriteFile(*(HANDLE *)(iVar1 + 0x3c),param_2,param_3,&local_8,(LPOVERLAPPED)0x0);
    if (BVar2 != 0) goto LAB_00423613;
    DVar3 = GetLastError();
    uVar4 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar4 = DVar3;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    pcVar5 = "Failed to write during cabinet extraction.";
  }
  else {
    if (*(int *)(iVar1 + 0x2c) == 3) {
      _memcpy_s((void *)(*(int *)(iVar1 + 0x40) + *(int *)(iVar1 + 0x48)),
                *(int *)(iVar1 + 0x44) - *(int *)(iVar1 + 0x48),param_2,param_3);
      *(int *)(iVar1 + 0x48) = *(int *)(iVar1 + 0x48) + param_3;
      local_8 = param_3;
      goto LAB_00423613;
    }
    uVar4 = 0x8007139f;
    pcVar5 = "Unexpected call to CabWrite().";
  }
  FUN_00430a57(uVar4,pcVar5);
LAB_00423613:
  *(uint *)(iVar1 + 0x30) = uVar4;
  if ((int)uVar4 < 0) {
    local_8 = 0xffffffff;
  }
  return local_8;
}



/* Function: FUN_00423625 */

undefined4 FUN_00423625(int param_1,int param_2)

{
  int iVar1;
  BOOL BVar2;
  int iVar3;
  undefined4 uVar4;
  _FILETIME local_14;
  _FILETIME local_c;
  
  iVar1 = *(int *)(param_1 + 0x2c);
  iVar3 = 0;
  local_14.dwLowDateTime = 0;
  local_14.dwHighDateTime = 0;
  local_c.dwLowDateTime = 0;
  local_c.dwHighDateTime = 0;
  uVar4 = 0xffffffff;
  if (iVar1 == 2) {
    BVar2 = DosDateTimeToFileTime(*(WORD *)(param_2 + 0x18),*(WORD *)(param_2 + 0x1a),&local_14);
    if (BVar2 != 0) {
      BVar2 = LocalFileTimeToFileTime(&local_14,&local_c);
      if (BVar2 != 0) {
        SetFileTime(*(HANDLE *)(param_1 + 0x3c),&local_c,&local_c,&local_c);
      }
    }
    if (*(int *)(param_1 + 0x3c) != -1) {
      CloseHandle(*(HANDLE *)(param_1 + 0x3c));
      *(undefined4 *)(param_1 + 0x3c) = 0xffffffff;
    }
  }
  else if (iVar1 != 3) {
    if (iVar1 == 5) {
      iVar3 = -0x7fffbffc;
    }
    else {
      iVar3 = -0x7ff8ec61;
      FUN_004300d9();
      FUN_00430a57(0x8007139f,"Invalid operation for this state.");
    }
  }
  if (-1 < iVar3) {
    uVar4 = 1;
  }
  *(int *)(param_1 + 0x30) = iVar3;
  return uVar4;
}



/* Function: FUN_004236dc */

undefined4 FUN_004236dc(int param_1,SIZE_T *param_2)

{
  SIZE_T SVar1;
  LARGE_INTEGER liDistanceToMove;
  BOOL BVar2;
  DWORD DVar3;
  int iVar4;
  HANDLE hFile;
  undefined4 uVar5;
  undefined4 uVar6;
  char *unaff_ESI;
  uint uVar7;
  DWORD unaff_EDI;
  char *pcVar8;
  
  BVar2 = SetEvent(*(HANDLE *)(param_1 + 0x28));
  if (BVar2 == 0) {
    DVar3 = GetLastError();
    uVar7 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar7 = DVar3;
    }
    if (-1 < (int)uVar7) {
      uVar7 = 0x80004005;
    }
LAB_0042371b:
    FUN_004300d9();
    unaff_ESI = "Failed to set operation complete event.";
LAB_00423a80:
    FUN_00430a57(uVar7,unaff_ESI);
  }
  else {
    DVar3 = WaitForSingleObject(*(HANDLE *)(param_1 + 0x24),0xffffffff);
    if (DVar3 == 0xffffffff) {
      DVar3 = GetLastError();
      uVar7 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar7 = DVar3;
      }
      if (-1 < (int)uVar7) {
        uVar7 = 0x80004005;
      }
LAB_00423761:
      FUN_004300d9();
      unaff_ESI = "Failed to wait for begin operation event.";
      goto LAB_00423a80;
    }
    BVar2 = ResetEvent(*(HANDLE *)(param_1 + 0x24));
    if (BVar2 == 0) {
      DVar3 = GetLastError();
      uVar7 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar7 = DVar3;
      }
      if (-1 < (int)uVar7) {
        uVar7 = 0x80004005;
      }
LAB_004237a6:
      FUN_004300d9();
      unaff_ESI = "Failed to reset begin operation event.";
      goto LAB_00423a80;
    }
    iVar4 = *(int *)(param_1 + 0x2c);
    if (iVar4 == 1) {
      uVar7 = FUN_00434004(*(int **)(param_1 + 0x34),(LPCSTR)param_2[1],0,0xfde9);
      if (-1 < (int)uVar7) {
        BVar2 = SetEvent(*(HANDLE *)(param_1 + 0x28));
        if (BVar2 == 0) {
          DVar3 = GetLastError();
          uVar7 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            uVar7 = DVar3;
          }
          if (-1 < (int)uVar7) {
            uVar7 = 0x80004005;
          }
          goto LAB_0042371b;
        }
        DVar3 = WaitForSingleObject(*(HANDLE *)(param_1 + 0x24),0xffffffff);
        if (DVar3 == 0xffffffff) {
          DVar3 = GetLastError();
          uVar7 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            uVar7 = DVar3;
          }
          if (-1 < (int)uVar7) {
            uVar7 = 0x80004005;
          }
          goto LAB_00423761;
        }
        BVar2 = ResetEvent(*(HANDLE *)(param_1 + 0x24));
        if (BVar2 == 0) {
          DVar3 = GetLastError();
          uVar7 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            uVar7 = DVar3;
          }
          if (-1 < (int)uVar7) {
            uVar7 = 0x80004005;
          }
          goto LAB_004237a6;
        }
        iVar4 = *(int *)(param_1 + 0x2c);
        if (iVar4 == 2) {
          hFile = CreateFileW(*(LPCWSTR *)(param_1 + 0x38),0x40000000,1,(LPSECURITY_ATTRIBUTES)0x0,2
                              ,0x80,(HANDLE)0x0);
          *(HANDLE *)(param_1 + 0x3c) = hFile;
          if (hFile == (HANDLE)0xffffffff) {
            DVar3 = GetLastError();
            uVar7 = DVar3 & 0xffff | 0x80070000;
            if ((int)DVar3 < 1) {
              uVar7 = DVar3;
            }
            if (-1 < (int)uVar7) {
              uVar7 = 0x80004005;
            }
            FUN_004300d9();
            pcVar8 = "Failed to create file: %ls";
            goto LAB_0042381f;
          }
          liDistanceToMove.s.HighPart = 0;
          liDistanceToMove.s.LowPart = (int)*param_2 >> 0x1f;
          BVar2 = SetFilePointerEx(hFile,liDistanceToMove,(PLARGE_INTEGER)0x0,unaff_EDI);
          if (BVar2 == 0) {
            DVar3 = GetLastError();
            uVar7 = DVar3 & 0xffff | 0x80070000;
            if ((int)DVar3 < 1) {
              uVar7 = DVar3;
            }
            if (-1 < (int)uVar7) {
              uVar7 = 0x80004005;
            }
            FUN_004300d9();
            unaff_ESI = "Failed to set file pointer to end of file.";
          }
          else {
            BVar2 = SetEndOfFile(*(HANDLE *)(param_1 + 0x3c));
            if (BVar2 == 0) {
              DVar3 = GetLastError();
              uVar7 = DVar3 & 0xffff | 0x80070000;
              if ((int)DVar3 < 1) {
                uVar7 = DVar3;
              }
              if (-1 < (int)uVar7) {
                uVar7 = 0x80004005;
              }
              FUN_004300d9();
              unaff_ESI = "Failed to set end of file.";
            }
            else {
              BVar2 = SetFilePointerEx(*(HANDLE *)(param_1 + 0x3c),(LARGE_INTEGER)0x0,
                                       (PLARGE_INTEGER)0x0,(DWORD)unaff_ESI);
              if (BVar2 != 0) goto LAB_00423a88;
              DVar3 = GetLastError();
              uVar7 = DVar3 & 0xffff | 0x80070000;
              if ((int)DVar3 < 1) {
                uVar7 = DVar3;
              }
              if (-1 < (int)uVar7) {
                uVar7 = 0x80004005;
              }
              FUN_004300d9();
              unaff_ESI = "Failed to set file pointer to beginning of file.";
            }
          }
        }
        else {
          if (iVar4 != 3) {
            if (iVar4 == 4) {
              uVar5 = 0;
              goto LAB_00423a8b;
            }
            goto joined_r0x004237c3;
          }
          iVar4 = FUN_00431078(*param_2,1);
          *(int *)(param_1 + 0x40) = iVar4;
          if (iVar4 != 0) {
            SVar1 = *param_2;
            *(undefined4 *)(param_1 + 0x48) = 0;
            *(SIZE_T *)(param_1 + 0x44) = SVar1;
            goto LAB_00423a88;
          }
          uVar7 = 0x8007000e;
          FUN_004300d9();
        }
        goto LAB_00423a80;
      }
      pcVar8 = "Failed to copy stream name: %ls";
LAB_0042381f:
      FUN_00430a57(uVar7,pcVar8);
    }
    else {
joined_r0x004237c3:
      if (iVar4 == 5) {
        uVar7 = 0x80004004;
      }
      else {
        uVar7 = 0x8007139f;
        FUN_004300d9();
        FUN_00430a57(0x8007139f,"Invalid operation for this state.");
      }
    }
  }
LAB_00423a88:
  uVar5 = 1;
LAB_00423a8b:
  *(uint *)(param_1 + 0x30) = uVar7;
  uVar6 = 0xffffffff;
  if (-1 < (int)uVar7) {
    uVar6 = uVar5;
  }
  return uVar6;
}



/* Function: FUN_00423a9c */

void FUN_00423a9c(int param_1)

{
  HRESULT HVar1;
  int iVar2;
  int iVar3;
  BOOL BVar4;
  DWORD DVar5;
  uint uVar6;
  char *pcVar7;
  undefined4 local_14;
  uint local_10;
  undefined4 local_c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_14 = 0;
  local_10 = 0;
  local_c = 0;
  HVar1 = CoInitializeEx((LPVOID)0x0,0);
  if (HVar1 < 0) {
    FUN_00430a57(HVar1,"Failed to initialize COM.");
    goto LAB_00423d30;
  }
  *(int *)(*(int *)((int)ThreadLocalStoragePointer + _tls_index * 4) + 4) = param_1;
  iVar2 = Ordinal_20(FUN_004231ff,FUN_00423254,FUN_004232a4,FUN_004233c9,FUN_00423563,FUN_0042320e,
                     FUN_0042345d,0xffffffff,&local_14);
  if (iVar2 == 0) {
    FUN_004300d9();
    FUN_00430a57(0x80004005,"Failed to initialize cabinet.dll.");
  }
  else {
    iVar3 = Ordinal_22(iVar2,"<the>.cab",&DAT_00442775,0,FUN_00423261,0,0);
    if (iVar3 == 0) {
      uVar6 = *(uint *)(param_1 + 0x30);
      if ((uVar6 != 0x80004004) && (uVar6 != 0x80070103)) {
        if ((int)uVar6 < 0) goto LAB_00423c14;
        if (local_10 == 0) {
          switch(local_14) {
          case 0:
            uVar6 = 0x8000ffff;
            break;
          case 1:
            uVar6 = 0x80070002;
            break;
          case 2:
            uVar6 = 0x80070001;
            break;
          case 3:
            uVar6 = 0x80070309;
            break;
          case 4:
            uVar6 = 0x80070570;
            break;
          case 5:
            uVar6 = 0x8007000e;
            break;
          case 6:
            uVar6 = 0x8007026a;
            break;
          case 7:
            uVar6 = 0x8007025d;
            break;
          case 8:
            uVar6 = 0x8007001d;
            break;
          case 9:
            uVar6 = 0x8007000d;
            break;
          case 10:
            uVar6 = 0x8007065d;
            break;
          case 0xb:
            uVar6 = 0x80004004;
            break;
          default:
            uVar6 = 0x80004005;
            goto LAB_00423c10;
          }
        }
        else {
          uVar6 = local_10 & 0xffff | 0x80070000;
          if ((int)local_10 < 1) {
            uVar6 = local_10;
          }
LAB_00423c10:
          if (-1 < (int)uVar6) goto LAB_00423c2c;
        }
LAB_00423c14:
        FUN_00430a57(uVar6,"Failed to extract all files from container, erf: %d:%X:%d");
      }
    }
    else {
LAB_00423c2c:
      BVar4 = SetEvent(*(HANDLE *)(param_1 + 0x28));
      if (BVar4 == 0) {
        DVar5 = GetLastError();
        uVar6 = DVar5 & 0xffff | 0x80070000;
        if ((int)DVar5 < 1) {
          uVar6 = DVar5;
        }
        if (-1 < (int)uVar6) {
          uVar6 = 0x80004005;
        }
        FUN_004300d9();
        pcVar7 = "Failed to set operation complete event.";
      }
      else {
        DVar5 = WaitForSingleObject(*(HANDLE *)(param_1 + 0x24),0xffffffff);
        if (DVar5 == 0xffffffff) {
          DVar5 = GetLastError();
          uVar6 = DVar5 & 0xffff | 0x80070000;
          if ((int)DVar5 < 1) {
            uVar6 = DVar5;
          }
          if (-1 < (int)uVar6) {
            uVar6 = 0x80004005;
          }
          FUN_004300d9();
          pcVar7 = "Failed to wait for begin operation event.";
        }
        else {
          BVar4 = ResetEvent(*(HANDLE *)(param_1 + 0x24));
          if (BVar4 == 0) {
            DVar5 = GetLastError();
            uVar6 = DVar5 & 0xffff | 0x80070000;
            if ((int)DVar5 < 1) {
              uVar6 = DVar5;
            }
            if (-1 < (int)uVar6) {
              uVar6 = 0x80004005;
            }
            FUN_004300d9();
            pcVar7 = "Failed to reset begin operation event.";
          }
          else {
            if ((*(int *)(param_1 + 0x2c) == 1) || (*(int *)(param_1 + 0x2c) == 5))
            goto LAB_00423d21;
            uVar6 = 0x8007139f;
            FUN_004300d9();
            pcVar7 = "Invalid operation for this state.";
          }
        }
      }
      FUN_00430a57(uVar6,pcVar7);
    }
LAB_00423d21:
    Ordinal_23(iVar2);
  }
  CoUninitialize();
LAB_00423d30:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00423d74 */

int * FUN_00423d74(int param_1,int param_2)

{
  int *piVar1;
  uint uVar2;
  
  uVar2 = 0;
  if (*(uint *)(param_1 + 0x34) != 0) {
    piVar1 = *(int **)(param_1 + 0x30);
    do {
      if (*piVar1 == param_2) {
        return piVar1;
      }
      uVar2 = uVar2 + 1;
      piVar1 = piVar1 + 4;
    } while (uVar2 < *(uint *)(param_1 + 0x34));
  }
  return (int *)0x0;
}



/* Function: FUN_00423d9d */

DWORD FUN_00423d9d(int param_1,HANDLE param_2,uint param_3)

{
  uint *puVar1;
  uint uVar2;
  LARGE_INTEGER liDistanceToMove;
  int *piVar3;
  BOOL BVar4;
  DWORD DVar5;
  uint uVar6;
  DWORD unaff_EDI;
  
  uVar6 = 0x80070490;
  piVar3 = FUN_00423d74(param_1,(int)param_2);
  if (piVar3 != (int *)0x0) {
    uVar6 = 0;
    liDistanceToMove.s.HighPart = 0;
    liDistanceToMove.s.LowPart = piVar3[3];
    BVar4 = SetFilePointerEx(param_2,liDistanceToMove,(PLARGE_INTEGER)0x0,unaff_EDI);
    if (BVar4 == 0) {
      DVar5 = GetLastError();
      uVar6 = DVar5 & 0xffff | 0x80070000;
      if ((int)DVar5 < 1) {
        uVar6 = DVar5;
      }
      if (-1 < (int)uVar6) {
        uVar6 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar6,"Failed to move to virtual file pointer.");
    }
    else {
      puVar1 = (uint *)(piVar3 + 2);
      uVar2 = *puVar1;
      *puVar1 = *puVar1 + param_3;
      piVar3[3] = piVar3[3] + (uint)CARRY4(uVar2,param_3);
    }
  }
  return uVar6;
}



/* Function: FUN_00423e1d */

undefined4 FUN_00423e1d(int param_1,int param_2,uint param_3,int param_4,int *param_5,int param_6)

{
  uint *puVar1;
  uint uVar2;
  int *piVar3;
  undefined4 uVar4;
  
  uVar4 = 0;
  piVar3 = FUN_00423d74(param_1,param_2);
  if (piVar3 != (int *)0x0) {
    if (param_6 == 0) {
      piVar3[2] = param_3;
      piVar3[3] = param_4;
    }
    else if (param_6 == 1) {
      puVar1 = (uint *)(piVar3 + 2);
      uVar2 = *puVar1;
      *puVar1 = *puVar1 + param_3;
      piVar3[3] = piVar3[3] + param_4 + (uint)CARRY4(uVar2,param_3);
    }
    *param_5 = piVar3[2];
    param_5[1] = piVar3[3];
    uVar4 = 1;
  }
  return uVar4;
}



/* Function: FUN_00423e70 */

DWORD FUN_00423e70(int param_1)

{
  DWORD DVar1;
  BOOL BVar2;
  char *pcVar3;
  HANDLE local_10;
  undefined4 local_c;
  DWORD local_8;
  
  local_10 = *(HANDLE *)(param_1 + 0x28);
  local_c = *(undefined4 *)(param_1 + 0x20);
  local_8 = 0;
  DVar1 = WaitForMultipleObjects(2,&local_10,0,0xffffffff);
  if (DVar1 == 0) {
    BVar2 = ResetEvent(*(HANDLE *)(param_1 + 0x28));
    if (BVar2 != 0) {
      *(undefined4 *)(param_1 + 0x2c) = 0;
      return local_8;
    }
    DVar1 = GetLastError();
    local_8 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      local_8 = DVar1;
    }
    if (-1 < (int)local_8) {
      local_8 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to reset operation complete event.";
  }
  else if (DVar1 == 1) {
    BVar2 = GetExitCodeThread(*(HANDLE *)(param_1 + 0x20),&local_8);
    if (BVar2 != 0) {
      return local_8;
    }
    DVar1 = GetLastError();
    local_8 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      local_8 = DVar1;
    }
    if (-1 < (int)local_8) {
      local_8 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to get extraction thread exit code.";
  }
  else {
    DVar1 = GetLastError();
    local_8 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      local_8 = DVar1;
    }
    if (-1 < (int)local_8) {
      local_8 = 0x80004005;
    }
    FUN_004300d9();
    pcVar3 = "Failed to wait for operation complete event.";
  }
  FUN_00430a57(local_8,pcVar3);
  return local_8;
}



/* Function: FUN_00423f94 */

DWORD FUN_00423f94(int param_1)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  char *pcVar4;
  
  uVar3 = 0;
  if (*(int *)(param_1 + 0x20) != 0) {
    *(undefined4 *)(param_1 + 0x2c) = 5;
    BVar1 = SetEvent(*(HANDLE *)(param_1 + 0x24));
    if (BVar1 == 0) {
      DVar2 = GetLastError();
      uVar3 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar3 = DVar2;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
      FUN_004300d9();
      pcVar4 = "Failed to set begin operation event.";
    }
    else {
      DVar2 = WaitForSingleObject(*(HANDLE *)(param_1 + 0x20),0xffffffff);
      if (DVar2 == 0) goto LAB_0042403a;
      DVar2 = GetLastError();
      uVar3 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar3 = DVar2;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
      FUN_004300d9();
      pcVar4 = "Failed to wait for thread to terminate.";
    }
    FUN_00430a57(uVar3,pcVar4);
  }
LAB_0042403a:
  if (*(int *)(param_1 + 0x20) != 0) {
    CloseHandle(*(HANDLE *)(param_1 + 0x20));
    *(undefined4 *)(param_1 + 0x20) = 0;
  }
  if (*(int *)(param_1 + 0x24) != 0) {
    CloseHandle(*(HANDLE *)(param_1 + 0x24));
    *(undefined4 *)(param_1 + 0x24) = 0;
  }
  if (*(int *)(param_1 + 0x28) != 0) {
    CloseHandle(*(HANDLE *)(param_1 + 0x28));
    *(undefined4 *)(param_1 + 0x28) = 0;
  }
  if (*(int *)(param_1 + 0x4c) != 0) {
    FUN_00431137(*(LPVOID *)(param_1 + 0x4c));
  }
  if (*(int *)(param_1 + 0x1c) != 0) {
    FUN_004380ab(*(LPVOID *)(param_1 + 0x1c));
  }
  return uVar3;
}



/* Function: FUN_00424093 */

DWORD FUN_00424093(int param_1,undefined4 param_2)

{
  DWORD DVar1;
  
  *(undefined4 *)(param_1 + 0x2c) = 1;
  *(undefined4 *)(param_1 + 0x34) = param_2;
  DVar1 = FUN_0042319f(param_1);
  if (((DVar1 != 0x80004004) && (DVar1 != 0x80070103)) && ((int)DVar1 < 0)) {
    FUN_00430a57(DVar1,"Failed to begin and wait for operation.");
  }
  return DVar1;
}



/* Function: FUN_004240d7 */

DWORD FUN_004240d7(LPVOID param_1,LPCWSTR param_2)

{
  uint uVar1;
  HANDLE pvVar2;
  DWORD DVar3;
  char *pcVar4;
  
  *(undefined4 *)((int)param_1 + 0x3c) = 0xffffffff;
  uVar1 = FUN_00433f88((int *)((int)param_1 + 0x1c),param_2,0);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to copy file name.";
  }
  else {
    pvVar2 = CreateEventW((LPSECURITY_ATTRIBUTES)0x0,1,0,(LPCWSTR)0x0);
    *(HANDLE *)((int)param_1 + 0x24) = pvVar2;
    if (pvVar2 == (HANDLE)0x0) {
      DVar3 = GetLastError();
      uVar1 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar1 = DVar3;
      }
      if (-1 < (int)uVar1) {
        uVar1 = 0x80004005;
      }
      FUN_004300d9();
      pcVar4 = "Failed to create begin operation event.";
    }
    else {
      pvVar2 = CreateEventW((LPSECURITY_ATTRIBUTES)0x0,1,0,(LPCWSTR)0x0);
      *(HANDLE *)((int)param_1 + 0x28) = pvVar2;
      if (pvVar2 == (HANDLE)0x0) {
        DVar3 = GetLastError();
        uVar1 = DVar3 & 0xffff | 0x80070000;
        if ((int)DVar3 < 1) {
          uVar1 = DVar3;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        FUN_004300d9();
        pcVar4 = "Failed to create operation complete event.";
      }
      else {
        pvVar2 = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,FUN_00423a9c,param_1,0,(LPDWORD)0x0);
        *(HANDLE *)((int)param_1 + 0x20) = pvVar2;
        if (pvVar2 == (HANDLE)0x0) {
          DVar3 = GetLastError();
          uVar1 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            uVar1 = DVar3;
          }
          if (-1 < (int)uVar1) {
            uVar1 = 0x80004005;
          }
          FUN_004300d9();
          pcVar4 = "Failed to create extraction thread.";
        }
        else {
          uVar1 = FUN_00423e70((int)param_1);
          if (-1 < (int)uVar1) {
            return uVar1;
          }
          pcVar4 = "Failed to wait for operation complete.";
        }
      }
    }
  }
  FUN_00430a57(uVar1,pcVar4);
  return uVar1;
}



/* Function: FUN_00424200 */

DWORD FUN_00424200(int param_1)

{
  DWORD DVar1;
  
  *(undefined4 *)(param_1 + 0x2c) = 4;
  DVar1 = FUN_0042319f(param_1);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to begin and wait for operation.");
  }
  return DVar1;
}



/* Function: FUN_0042422e */

DWORD FUN_0042422e(int param_1,undefined4 *param_2,undefined4 *param_3)

{
  DWORD DVar1;
  
  *(undefined4 *)(param_1 + 0x2c) = 3;
  DVar1 = FUN_0042319f(param_1);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to begin and wait for operation.");
  }
  else {
    *param_2 = *(undefined4 *)(param_1 + 0x40);
    *param_3 = *(undefined4 *)(param_1 + 0x44);
    *(undefined4 *)(param_1 + 0x40) = 0;
    *(undefined4 *)(param_1 + 0x44) = 0;
    *(undefined4 *)(param_1 + 0x48) = 0;
  }
  return DVar1;
}



/* Function: FUN_0042427b */

DWORD FUN_0042427b(int param_1,undefined4 param_2)

{
  DWORD DVar1;
  
  *(undefined4 *)(param_1 + 0x2c) = 2;
  *(undefined4 *)(param_1 + 0x38) = param_2;
  DVar1 = FUN_0042319f(param_1);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to begin and wait for operation.");
  }
  else {
    *(undefined4 *)(param_1 + 0x38) = 0;
  }
  return DVar1;
}



/* Function: FUN_004242b7 */

int FUN_004242b7(undefined *param_1,undefined4 param_2,int param_3,uint param_4,undefined4 *param_5)

{
  int iVar1;
  undefined4 uVar2;
  char *pcVar3;
  undefined4 local_1c;
  undefined4 local_18;
  undefined4 local_14;
  LPVOID local_10;
  uint local_c;
  LPVOID local_8;
  
  local_c = 0;
  local_8 = (LPVOID)0x0;
  local_18 = 0;
  local_14 = 0;
  local_10 = (LPVOID)0x0;
  local_1c = 1;
  iVar1 = FUN_004302f8(param_3,param_4,&local_c,&local_14);
  if (iVar1 < 0) {
    pcVar3 = "Failed to read error code from buffer.";
  }
  else {
    iVar1 = FUN_00430351(param_3,param_4,&local_c,(int *)&local_8);
    if (iVar1 < 0) {
      pcVar3 = "Failed to read error message from buffer.";
    }
    else {
      local_10 = local_8;
      iVar1 = FUN_004302f8(param_3,param_4,&local_c,&local_18);
      if (-1 < iVar1) {
        uVar2 = (*(code *)param_1)(&local_1c,param_2);
        *param_5 = uVar2;
        goto LAB_00424354;
      }
      pcVar3 = "Failed to read UI hint from buffer.";
    }
  }
  FUN_00430a57(iVar1,pcVar3);
LAB_00424354:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_0042436a */

int FUN_0042436a(undefined *param_1,undefined4 param_2,int param_3,uint param_4,undefined4 *param_5)

{
  int iVar1;
  undefined4 uVar2;
  undefined4 local_18;
  undefined4 local_14;
  undefined4 local_10;
  undefined4 uStack_c;
  uint local_8;
  
  local_8 = 0;
  local_10 = 0;
  uStack_c = 0;
  local_18 = 2;
  local_14 = 1;
  iVar1 = FUN_004302f8(param_3,param_4,&local_8,&local_10);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to read progress from buffer.");
  }
  else {
    uVar2 = (*(code *)param_1)(&local_18,param_2);
    *param_5 = uVar2;
  }
  return iVar1;
}



/* Function: FUN_004243cc */

int FUN_004243cc(int *param_1,undefined4 *param_2,undefined4 *param_3)

{
  int iVar1;
  char *pcVar2;
  undefined4 local_8;
  
  local_8 = 0;
  if (*param_1 == 1) {
    iVar1 = FUN_004242b7((undefined *)*param_2,param_2[1],param_1[3],param_1[1],&local_8);
    if (-1 < iVar1) goto LAB_00424458;
    pcVar2 = "Failed to process embedded error message.";
  }
  else {
    if (*param_1 != 2) {
      FUN_004300d9();
      FUN_00430a57(0x80070057,"Unexpected embedded message sent to child process, msg: %u");
      return -0x7ff8ffa9;
    }
    iVar1 = FUN_0042436a((undefined *)*param_2,param_2[1],param_1[3],param_1[1],&local_8);
    if (-1 < iVar1) {
LAB_00424458:
      *param_3 = local_8;
      return iVar1;
    }
    pcVar2 = "Failed to process embedded progress message.";
  }
  FUN_00430a57(iVar1,pcVar2);
  return iVar1;
}



/* Function: FUN_00424468 */

DWORD FUN_00424468(LPCWSTR param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
                  DWORD *param_5)

{
  uint uVar1;
  BOOL BVar2;
  DWORD DVar3;
  int iVar4;
  int *piVar5;
  char *pcVar6;
  _STARTUPINFOW local_88;
  undefined4 local_44;
  undefined4 local_40;
  int local_3c [3];
  HANDLE local_30;
  HANDLE local_2c;
  undefined4 local_24;
  undefined4 local_20;
  _PROCESS_INFORMATION local_1c;
  LPWSTR local_c;
  HANDLE local_8;
  
  GetCurrentProcessId();
  local_8 = (HANDLE)0x0;
  local_c = (LPWSTR)0x0;
  FUN_004267c0(&local_88.cb,0,0x44);
  local_1c.hProcess = (HANDLE)0x0;
  local_1c.hThread = (HANDLE)0x0;
  local_1c.dwProcessId = 0;
  local_1c.dwThreadId = 0;
  piVar5 = local_3c;
  for (iVar4 = 6; iVar4 != 0; iVar4 = iVar4 + -1) {
    *piVar5 = 0;
    piVar5 = piVar5 + 1;
  }
  local_44 = 0;
  local_40 = 0;
  FUN_0040f14d(local_3c);
  local_24 = param_3;
  local_20 = param_4;
  uVar1 = FUN_0040f1d5(local_3c,local_3c + 1);
  if ((int)uVar1 < 0) {
    pcVar6 = "Failed to create embedded pipe name and client token.";
  }
  else {
    uVar1 = FUN_0040f31a((int)local_3c,0,&local_8);
    if ((int)uVar1 < 0) {
      pcVar6 = "Failed to create embedded pipe.";
    }
    else {
      uVar1 = FUN_00433cea((int *)&local_c,L"%ls -%ls %ls %ls %u");
      if (-1 < (int)uVar1) {
        BVar2 = CreateProcessW(param_1,local_c,(LPSECURITY_ATTRIBUTES)0x0,(LPSECURITY_ATTRIBUTES)0x0
                               ,0,0x8000000,(LPVOID)0x0,(LPCWSTR)0x0,&local_88,&local_1c);
        if (BVar2 == 0) {
          DVar3 = GetLastError();
          uVar1 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            uVar1 = DVar3;
          }
          if (-1 < (int)uVar1) {
            uVar1 = 0x80004005;
          }
          FUN_004300d9();
          pcVar6 = "Failed to create embedded process atpath: %ls";
LAB_00424606:
          FUN_00430a57(uVar1,pcVar6);
        }
        else {
          local_3c[2] = GetProcessId(local_1c.hProcess);
          local_30 = local_1c.hProcess;
          local_1c.hProcess = (HANDLE)0x0;
          uVar1 = FUN_0040f9dc((DWORD)local_3c);
          if ((int)uVar1 < 0) {
            pcVar6 = "Failed to wait for embedded process to connect to pipe.";
          }
          else {
            uVar1 = FUN_0040f6a6(local_2c,FUN_004243cc,&local_24,&local_44);
            if (-1 < (int)uVar1) {
              uVar1 = FUN_00431fb6(local_30,0xffffffff,param_5);
              if (-1 < (int)uVar1) goto LAB_0042460f;
              pcVar6 = "Failed to wait for embedded executable: %ls";
              goto LAB_00424606;
            }
            pcVar6 = "Failed to process messages from embedded message.";
          }
          FUN_00430a57(uVar1,pcVar6);
        }
        goto LAB_0042460f;
      }
      pcVar6 = "Failed to allocate embedded command.";
    }
  }
  FUN_00430a57(uVar1,pcVar6);
LAB_0042460f:
  if (local_1c.hThread != (HANDLE)0x0) {
    CloseHandle(local_1c.hThread);
    local_1c.hThread = (HANDLE)0x0;
  }
  if (local_1c.hProcess != (HANDLE)0x0) {
    CloseHandle(local_1c.hProcess);
    local_1c.hProcess = (HANDLE)0x0;
  }
  if (local_c != (LPWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (HANDLE)0x0) {
    CloseHandle(local_8);
    local_8 = (HANDLE)0x0;
  }
  FUN_0040f16a(local_3c);
  return uVar1;
}



/* Function: FUN_0042465f */

DWORD FUN_0042465f(LPCWSTR param_1,LPCWSTR param_2,int *param_3)

{
  int *piVar1;
  HANDLE pvVar2;
  DWORD DVar3;
  LPVOID pvVar4;
  uint uVar5;
  char *pcVar6;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  piVar1 = (int *)FUN_00431078(0x18,1);
  if (piVar1 == (int *)0x0) {
    uVar5 = 0x8007000e;
    FUN_004300d9();
    FUN_00430a57(0x8007000e,"Failed to allocate memory for NetFxChainer struct.");
    goto LAB_004248ff;
  }
  pvVar2 = CreateEventW((LPSECURITY_ATTRIBUTES)0x0,0,0,param_2);
  piVar1[1] = (int)pvVar2;
  if (pvVar2 == (HANDLE)0x0) {
    DVar3 = GetLastError();
    uVar5 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar5 = DVar3;
    }
    if (-1 < (int)uVar5) {
      uVar5 = 0x80004005;
    }
    FUN_004300d9();
LAB_00424745:
    pcVar6 = "Failed to create event: %ls";
  }
  else {
    uVar5 = FUN_00433cea((int *)&local_8,L"%ls_send");
    if ((int)uVar5 < 0) {
      pcVar6 = "failed to allocate memory for event name";
LAB_0042487d:
      FUN_00430a57(uVar5,pcVar6);
      goto LAB_004248ff;
    }
    pvVar2 = CreateEventW((LPSECURITY_ATTRIBUTES)0x0,0,0,local_8);
    piVar1[2] = (int)pvVar2;
    if (pvVar2 == (HANDLE)0x0) {
      DVar3 = GetLastError();
      uVar5 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar5 = DVar3;
      }
      if (-1 < (int)uVar5) {
        uVar5 = 0x80004005;
      }
      FUN_004300d9();
      goto LAB_00424745;
    }
    uVar5 = FUN_00433cea((int *)&local_8,L"%ls_mutex");
    if ((int)uVar5 < 0) {
      pcVar6 = "failed to allocate memory for mutex name";
      goto LAB_0042487d;
    }
    pvVar2 = CreateMutexW((LPSECURITY_ATTRIBUTES)0x0,1,local_8);
    piVar1[3] = (int)pvVar2;
    if (pvVar2 == (HANDLE)0x0) {
      DVar3 = GetLastError();
      uVar5 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar5 = DVar3;
      }
      if (-1 < (int)uVar5) {
        uVar5 = 0x80004005;
      }
      FUN_004300d9();
      pcVar6 = "Failed to create mutex: %ls";
    }
    else {
      pvVar2 = CreateFileMappingW((HANDLE)0xffffffff,(LPSECURITY_ATTRIBUTES)0x0,4,0,0x10000,param_1)
      ;
      *piVar1 = (int)pvVar2;
      if (pvVar2 == (HANDLE)0x0) {
        DVar3 = GetLastError();
        uVar5 = DVar3 & 0xffff | 0x80070000;
        if ((int)DVar3 < 1) {
          uVar5 = DVar3;
        }
        if (-1 < (int)uVar5) {
          uVar5 = 0x80004005;
        }
        FUN_004300d9();
        pcVar6 = "Failed to memory map cabinet file: %ls";
      }
      else {
        pvVar4 = MapViewOfFile(pvVar2,2,0,0,0);
        piVar1[4] = (int)pvVar4;
        if (pvVar4 != (LPVOID)0x0) {
          uVar5 = FUN_0041cddb((short *)((int)pvVar4 + 0x21a),0x104,(int)param_2);
          if (-1 < (int)uVar5) {
            *(undefined1 *)piVar1[4] = 0;
            *(undefined1 *)(piVar1[4] + 0x218) = 0;
            *(undefined4 *)(piVar1[4] + 4) = 0x8000000a;
            *(undefined1 *)(piVar1[4] + 2) = 0;
            *(undefined1 *)(piVar1[4] + 1) = 0;
            *(undefined1 *)(piVar1[4] + 0x219) = 0;
            *(undefined4 *)(piVar1[4] + 8) = 0x8000000a;
            *(undefined1 *)(piVar1[4] + 3) = 0;
            *(undefined4 *)(piVar1[4] + 0xc) = 0;
            *(undefined1 *)(piVar1[4] + 0x422) = 1;
            *(undefined4 *)(piVar1[4] + 0x424) = 0;
            *(undefined4 *)(piVar1[4] + 0x428) = 0;
            *(undefined4 *)(piVar1[4] + 0x42c) = 0;
            ReleaseMutex((HANDLE)piVar1[3]);
            *param_3 = (int)piVar1;
            piVar1 = (int *)0x0;
            goto LAB_004248ff;
          }
          pcVar6 = "failed to copy event name to shared memory structure.";
          goto LAB_0042487d;
        }
        DVar3 = GetLastError();
        uVar5 = DVar3 & 0xffff | 0x80070000;
        if ((int)DVar3 < 1) {
          uVar5 = DVar3;
        }
        if (-1 < (int)uVar5) {
          uVar5 = 0x80004005;
        }
        FUN_004300d9();
        pcVar6 = "Failed to MapViewOfFile for %ls.";
      }
    }
  }
  FUN_00430a57(uVar5,pcVar6);
LAB_004248ff:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (piVar1 != (int *)0x0) {
    if (piVar1[3] != 0) {
      ReleaseMutex((HANDLE)piVar1[3]);
    }
    FUN_0042492e(piVar1);
  }
  return uVar5;
}



/* Function: FUN_0042492e */

void FUN_0042492e(int *param_1)

{
  if (param_1 != (int *)0x0) {
    if (*param_1 != 0) {
      CloseHandle((HANDLE)*param_1);
      *param_1 = 0;
    }
    if (param_1[1] != 0) {
      CloseHandle((HANDLE)param_1[1]);
      param_1[1] = 0;
    }
    if (param_1[2] != 0) {
      CloseHandle((HANDLE)param_1[2]);
      param_1[2] = 0;
    }
    if (param_1[3] != 0) {
      CloseHandle((HANDLE)param_1[3]);
      param_1[3] = 0;
    }
    if (param_1[4] != 0) {
      UnmapViewOfFile((LPCVOID)param_1[4]);
    }
    FUN_00431137(param_1);
  }
  return;
}



/* Function: FUN_0042498f */

undefined4 FUN_0042498f(int param_1,int *param_2,undefined4 *param_3,undefined4 *param_4)

{
  undefined8 *puVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  WaitForSingleObject(*(HANDLE *)(param_1 + 0xc),0xffffffff);
  *param_2 = *(int *)(*(int *)(param_1 + 0x10) + 0x424);
  *param_3 = 0;
  *param_4 = 0;
  if (*param_2 != 0) {
    puVar1 = (undefined8 *)FUN_00431078(*(SIZE_T *)(*(int *)(param_1 + 0x10) + 0x42c),1);
    *param_3 = puVar1;
    if (puVar1 == (undefined8 *)0x0) {
      uVar2 = 0x8007000e;
      FUN_004300d9();
      FUN_00430a57(0x8007000e,"Failed to allocate memory for message data");
    }
    else {
      FUN_004270c0(puVar1,(undefined8 *)(*(int *)(param_1 + 0x10) + 0x430),
                   *(uint *)(*(int *)(param_1 + 0x10) + 0x42c));
      *param_4 = *(undefined4 *)(*(int *)(param_1 + 0x10) + 0x42c);
    }
  }
  ReleaseMutex(*(HANDLE *)(param_1 + 0xc));
  return uVar2;
}



/* Function: FUN_00424a32 */

int FUN_00424a32(int param_1,undefined4 *param_2)

{
  int iVar1;
  int iVar2;
  
  WaitForSingleObject(*(HANDLE *)(param_1 + 0xc),0xffffffff);
  iVar1 = *(int *)(param_1 + 0x10);
  iVar2 = *(int *)(iVar1 + 8);
  if ((*(int *)(iVar1 + 4) < 0) && ((iVar2 == 0 || (iVar2 == -0x7fffbffc)))) {
    iVar2 = *(int *)(iVar1 + 4);
  }
  if (param_2 != (undefined4 *)0x0) {
    *param_2 = *(undefined4 *)(iVar1 + 0xc);
  }
  ReleaseMutex(*(HANDLE *)(param_1 + 0xc));
  return iVar2;
}



/* Function: FUN_00424a7d */

undefined4 FUN_00424a7d(int param_1,uint *param_2,undefined *param_3,undefined4 param_4)

{
  uint uVar1;
  LPVOID pvVar2;
  uint uVar3;
  int iVar4;
  uint *puVar5;
  undefined4 uVar6;
  undefined4 local_14;
  undefined4 local_10;
  uint local_c;
  LPVOID local_8;
  
  local_14 = 0;
  local_10 = 0;
  local_c = 0;
  local_8 = (LPVOID)0x0;
  uVar1 = *param_2;
  uVar6 = 0;
  pvVar2 = (LPVOID)FUN_00431078(uVar1 << 2,1);
  if (pvVar2 == (LPVOID)0x0) {
    uVar6 = 0x8007000e;
    FUN_004300d9();
    FUN_00430a57(0x8007000e,"Failed to allocate buffer.");
  }
  else {
    uVar3 = 0;
    if (*param_2 != 0) {
      puVar5 = param_2 + 1;
      do {
        *(uint **)((int)pvVar2 + uVar3 * 4) = puVar5;
        uVar3 = uVar3 + 1;
        puVar5 = puVar5 + 0x83;
      } while (uVar3 < *param_2);
    }
    local_14 = 3;
    local_10 = 2;
    local_c = uVar1;
    local_8 = pvVar2;
    iVar4 = (*(code *)param_3)(&local_14,param_4);
    WaitForSingleObject(*(HANDLE *)(param_1 + 0xc),0xffffffff);
    *(undefined4 *)(*(int *)(param_1 + 0x10) + 0x424) = 0;
    *(int *)(*(int *)(param_1 + 0x10) + 0x428) = iVar4;
    if (iVar4 == 2) {
      *(undefined1 *)(*(int *)(param_1 + 0x10) + 2) = 1;
      *(undefined1 *)(*(int *)(param_1 + 0x10) + 3) = 1;
    }
    ReleaseMutex(*(HANDLE *)(param_1 + 0xc));
    SetEvent(*(HANDLE *)(param_1 + 8));
    FUN_00431137(pvVar2);
  }
  return uVar6;
}



/* Function: FUN_00424b60 */

int FUN_00424b60(int param_1,undefined *param_2,undefined4 param_3)

{
  byte bVar1;
  byte bVar2;
  uint *puVar3;
  int iVar4;
  char *pcVar5;
  undefined4 local_20;
  undefined4 local_1c;
  uint local_18;
  undefined4 uStack_14;
  undefined4 local_10;
  int local_c;
  uint *local_8;
  
  local_c = 0;
  local_8 = (uint *)0x0;
  WaitForSingleObject(*(HANDLE *)(param_1 + 0xc),0xffffffff);
  bVar1 = *(byte *)(*(int *)(param_1 + 0x10) + 0x219);
  bVar2 = *(byte *)(*(int *)(param_1 + 0x10) + 0x218);
  ReleaseMutex(*(HANDLE *)(param_1 + 0xc));
  uStack_14 = 0;
  local_18 = ((((uint)bVar1 + (uint)bVar2) / 2) * 100) / 0xff;
  local_20 = 2;
  local_1c = 1;
  iVar4 = (*(code *)param_2)(&local_20,param_3);
  if (iVar4 == 2) {
    WaitForSingleObject(*(HANDLE *)(param_1 + 0xc),0xffffffff);
    *(undefined1 *)(*(int *)(param_1 + 0x10) + 2) = 1;
    *(undefined1 *)(*(int *)(param_1 + 0x10) + 3) = 1;
    ReleaseMutex(*(HANDLE *)(param_1 + 0xc));
    SetEvent(*(HANDLE *)(param_1 + 8));
  }
  iVar4 = FUN_0042498f(param_1,&local_c,&local_8,&local_10);
  puVar3 = local_8;
  if (iVar4 < 0) {
    pcVar5 = "Failed to get message from netfx chainer.";
  }
  else {
    if (local_c != 0x1070001) goto LAB_00424c50;
    iVar4 = FUN_00424a7d(param_1,local_8,param_2,param_3);
    if (-1 < iVar4) goto LAB_00424c50;
    pcVar5 = "Failed to send files in use message from netfx chainer.";
  }
  FUN_00430a57(iVar4,pcVar5);
LAB_00424c50:
  if (puVar3 != (uint *)0x0) {
    FUN_00431137(puVar3);
  }
  return iVar4;
}



/* Function: FUN_00424c63 */

void FUN_00424c63(LPCWSTR param_1,undefined4 param_2,undefined *param_3,undefined4 param_4,
                 LPDWORD param_5)

{
  uint uVar1;
  int iVar2;
  DWORD DVar3;
  BOOL BVar4;
  int *piVar5;
  char *pcVar6;
  _STARTUPINFOW local_fc;
  undefined4 local_b8;
  undefined4 local_b4;
  int local_b0;
  undefined4 local_ac;
  HANDLE local_a8;
  int local_a4;
  LPCWSTR local_a0;
  LPDWORD local_9c;
  undefined4 local_98;
  _PROCESS_INFORMATION local_94;
  undefined4 local_84;
  code *local_80;
  int local_7c;
  LPWSTR local_78;
  LPCWSTR local_74;
  int *local_70;
  LPCWSTR local_6c;
  UUID local_68;
  OLECHAR local_58 [40];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_a0 = param_1;
  local_98 = param_2;
  local_80 = (code *)param_3;
  local_84 = param_4;
  local_9c = param_5;
  local_68.Data1 = 0;
  local_68.Data2 = 0;
  local_68.Data3 = 0;
  local_68.Data4[0] = '\0';
  local_68.Data4[1] = '\0';
  local_68.Data4[2] = '\0';
  local_68.Data4[3] = '\0';
  local_68.Data4[4] = '\0';
  local_68.Data4[5] = '\0';
  local_68.Data4[6] = '\0';
  local_68.Data4[7] = '\0';
  piVar5 = (int *)0x0;
  local_74 = (LPCWSTR)0x0;
  local_6c = (LPCWSTR)0x0;
  local_78 = (LPWSTR)0x0;
  local_70 = (int *)0x0;
  FUN_004267c0(&local_fc.cb,0,0x44);
  local_94.hProcess = (HANDLE)0x0;
  local_94.hThread = (HANDLE)0x0;
  local_94.dwProcessId = 0;
  local_94.dwThreadId = 0;
  local_7c = 0;
  uVar1 = UuidCreate(&local_68);
  uVar1 = uVar1 | 1;
  if ((int)uVar1 < 0) {
    pcVar6 = "Failed to create netfx chainer guid.";
  }
  else {
    iVar2 = StringFromGUID2(&local_68,local_58,0x27);
    if (iVar2 == 0) {
      uVar1 = 0x8007000e;
      FUN_004300d9();
      pcVar6 = "Failed to convert netfx chainer guid into string.";
    }
    else {
      uVar1 = FUN_00433cea((int *)&local_6c,L"NetFxSection.%ls");
      if ((int)uVar1 < 0) {
        pcVar6 = "Failed to allocate section name.";
      }
      else {
        uVar1 = FUN_00433cea((int *)&local_74,L"NetFxEvent.%ls");
        if (-1 < (int)uVar1) {
          DVar3 = FUN_0042465f(local_6c,local_74,(int *)&local_70);
          if ((int)DVar3 < 0) {
            pcVar6 = "Failed to create netfx chainer.";
          }
          else {
            DVar3 = FUN_00433cea((int *)&local_78,L"%ls /pipe %ls");
            if (-1 < (int)DVar3) {
              local_fc.cb = 0x44;
              BVar4 = CreateProcessW(local_a0,local_78,(LPSECURITY_ATTRIBUTES)0x0,
                                     (LPSECURITY_ATTRIBUTES)0x0,0,0x8000000,(LPVOID)0x0,(LPCWSTR)0x0
                                     ,&local_fc,&local_94);
              piVar5 = local_70;
              if (BVar4 == 0) {
                DVar3 = GetLastError();
                uVar1 = DVar3 & 0xffff | 0x80070000;
                if ((int)DVar3 < 1) {
                  uVar1 = DVar3;
                }
                if (-1 < (int)uVar1) {
                  uVar1 = 0x80004005;
                }
                FUN_004300d9();
                FUN_00430a57(uVar1,"Failed to CreateProcess on path: %ls");
                piVar5 = local_70;
                goto LAB_00424f7b;
              }
              local_a8 = local_94.hProcess;
              local_a4 = local_70[1];
              do {
                while( true ) {
                  DVar3 = WaitForMultipleObjects(2,&local_a8,0,100);
                  if (DVar3 == 0) {
                    DVar3 = FUN_00424a32((int)piVar5,&local_7c);
                    *local_9c = DVar3;
                    if (DVar3 != 0x8000000a) {
                      if (local_7c < 0) {
                        local_b4 = 0;
                        local_ac = 0;
                        local_b8 = 1;
                        local_b0 = local_7c;
                        (*local_80)(&local_b8,local_84);
                      }
                      goto LAB_00424f7b;
                    }
                    BVar4 = GetExitCodeProcess(local_94.hProcess,local_9c);
                    if (BVar4 != 0) goto LAB_00424f7b;
                    DVar3 = GetLastError();
                    uVar1 = DVar3 & 0xffff | 0x80070000;
                    if ((int)DVar3 < 1) {
                      uVar1 = DVar3;
                    }
                    if (-1 < (int)uVar1) {
                      uVar1 = 0x80004005;
                    }
                    FUN_004300d9();
                    pcVar6 = "Failed to get netfx return code.";
                    goto LAB_00424e76;
                  }
                  if (DVar3 != 1) break;
                  uVar1 = FUN_00424b60((int)piVar5,local_80,local_84);
                  if ((int)uVar1 < 0) {
                    pcVar6 = "Failed to process netfx chainer message.";
                    goto LAB_00424e76;
                  }
                }
              } while (DVar3 != 0xffffffff);
              DVar3 = GetLastError();
              uVar1 = DVar3 & 0xffff | 0x80070000;
              if ((int)DVar3 < 1) {
                uVar1 = DVar3;
              }
              if (-1 < (int)uVar1) {
                uVar1 = 0x80004005;
              }
              FUN_004300d9();
              pcVar6 = "Failed to wait for netfx chainer process to complete";
              goto LAB_00424e76;
            }
            pcVar6 = "Failed to allocate netfx chainer arguments.";
          }
          FUN_00430a57(DVar3,pcVar6);
          piVar5 = local_70;
          goto LAB_00424f7b;
        }
        pcVar6 = "Failed to allocate event name.";
      }
    }
  }
LAB_00424e76:
  FUN_00430a57(uVar1,pcVar6);
LAB_00424f7b:
  if (local_6c != (LPCWSTR)0x0) {
    FUN_004380ab(local_6c);
  }
  if (local_74 != (LPCWSTR)0x0) {
    FUN_004380ab(local_74);
  }
  if (local_78 != (LPWSTR)0x0) {
    FUN_004380ab(local_78);
  }
  FUN_0042492e(piVar5);
  if (local_94.hThread != (HANDLE)0x0) {
    CloseHandle(local_94.hThread);
    local_94.hThread = (HANDLE)0x0;
  }
  if (local_94.hProcess != (HANDLE)0x0) {
    CloseHandle(local_94.hProcess);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00424fed */

int FUN_00424fed(uint param_1,int param_2,uint param_3,int param_4,int *param_5)

{
  int iVar1;
  
  if ((param_4 - param_2 == (uint)(param_3 < param_1)) && (param_3 - param_1 < 0x80000000)) {
    if ((param_2 == 0) && (param_1 == 0)) {
      if (*param_5 == 0) {
        return 0;
      }
      FUN_004380ab((LPVOID)*param_5);
      *param_5 = 0;
      return 0;
    }
    iVar1 = FUN_00433cea(param_5,L"Range: bytes=%I64u-");
  }
  else {
    iVar1 = FUN_00433cea(param_5,L"Range: bytes=%I64u-%I64u");
  }
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to add range read header.");
  }
  return iVar1;
}



/* Function: FUN_0042507a */

DWORD FUN_0042507a(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,int param_5,
                  undefined4 *param_6,undefined4 *param_7)

{
  DWORD DVar1;
  int iVar2;
  LPVOID local_8;
  
  *param_6 = 0;
  local_8 = (LPVOID)0x0;
  *param_7 = 0;
  DVar1 = FUN_00433da8((int *)&local_8,0x80070005,(LPCVOID)0x0);
  if ((int)DVar1 < 0) {
    FUN_00430a57(DVar1,"Failed to allocation error string.");
    goto LAB_00425143;
  }
  iVar2 = (**(code **)(**(int **)(param_1 + 0x10) + 0x6c))
                    (*(int **)(param_1 + 0x10),(param_5 != 0x191) + '\x03',param_2,5,local_8,0xf,0,0
                     ,0);
  iVar2 = FUN_004086ee(param_1,0,0xf,iVar2);
  if (iVar2 == 10) {
    if (*(int *)(param_1 + 0x38) != 0) {
      iVar2 = InternetErrorDlg(*(undefined4 *)(param_1 + 0x38),param_4,0x2eee,7,0);
      if ((iVar2 == 0) || (iVar2 == 0x4c7)) {
        DVar1 = 0x80070642;
        goto LAB_00425143;
      }
      if (iVar2 == 0x2f00) {
        *param_6 = 1;
        goto LAB_0042513a;
      }
    }
  }
  else if (iVar2 == 4) {
    *param_7 = 1;
LAB_0042513a:
    DVar1 = 0;
    goto LAB_00425143;
  }
  DVar1 = 0x80070005;
LAB_00425143:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_0042515a */

DWORD FUN_0042515a(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,int *param_5
                  ,LPCWSTR param_6,LPCWSTR param_7,LPCWSTR param_8,uint param_9,uint param_10,
                  uint param_11,uint param_12,undefined8 param_13,HANDLE param_14,int *param_15)

{
  int iVar1;
  DWORD DVar2;
  uint uVar3;
  uint uVar4;
  int iVar5;
  uint uVar6;
  int iVar7;
  undefined8 local_28;
  HANDLE local_20;
  LPVOID local_1c;
  short *local_18;
  int local_14;
  int local_10;
  uint local_c;
  int local_8;
  
  iVar5 = 0;
  uVar6 = 0;
  local_1c = (LPVOID)0x0;
  local_10 = 1;
  local_18 = (short *)0x0;
  local_8 = 0;
  local_14 = 0;
  local_28 = 0;
  local_20 = CreateFileW(param_8,0xc0000000,4,(LPSECURITY_ATTRIBUTES)0x0,4,0x80,(HANDLE)0x0);
  if (local_20 == (HANDLE)0xffffffff) {
    DVar2 = GetLastError();
    uVar6 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar6 = DVar2;
    }
    if (-1 < (int)uVar6) {
      uVar6 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar6,"Failed to create download destination file: %ls");
  }
  else {
    local_1c = VirtualAlloc((LPVOID)0x0,0x10000,0x3000,4);
    if (local_1c == (LPVOID)0x0) {
      DVar2 = GetLastError();
      uVar6 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar6 = DVar2;
      }
      if (-1 < (int)uVar6) {
        uVar6 = 0x80004005;
      }
      FUN_004300d9();
      FUN_00430a57(uVar6,"Failed to allocate buffer to download files into.");
    }
    else {
      local_c = param_12;
      param_12 = param_11;
      iVar7 = 0;
      do {
        if (((param_12 != 0) || (uVar3 = param_10, uVar4 = param_9, local_c != 0)) &&
           ((local_c < param_13._4_4_ ||
            ((uVar3 = local_c, uVar4 = param_12, local_c <= param_13._4_4_ &&
             (param_12 <= (uint)param_13)))))) break;
        uVar6 = FUN_00424fed((uint)param_13,param_13._4_4_,uVar4,uVar3,(int *)&local_18);
        if ((int)uVar6 < 0) {
          FUN_00430a57(uVar6,"Failed to allocate range request header.");
          break;
        }
        if (iVar7 != 0) {
          InternetCloseHandle(iVar7);
          local_8 = 0;
        }
        if (iVar5 != 0) {
          InternetCloseHandle(iVar5);
          local_14 = 0;
        }
        uVar6 = FUN_004255ef(param_1,param_2,param_3,param_4,param_5,&DAT_0044e0a4,local_18,param_6,
                             param_7,&local_8,&local_14,&local_10);
        iVar5 = local_14;
        if ((int)uVar6 < 0) {
          FUN_00430a57(uVar6,"Failed to request URL for download: %ls");
          iVar5 = local_14;
          iVar7 = local_8;
          break;
        }
        if ((param_12 == 0) && (local_c == 0)) {
          DVar2 = FUN_00438698(local_14,(undefined4 *)&local_28);
          if ((int)DVar2 < 0) {
            param_12 = param_9;
            local_c = param_10;
            local_10 = 0;
          }
          else {
            param_12 = (uint)local_28;
            local_c = local_28._4_4_;
          }
        }
        iVar1 = local_10;
        if (local_10 == 0) {
          param_13 = 0;
        }
        uVar6 = FUN_00425ada(iVar5,local_20,(uint *)&param_13,param_14,param_12,local_c,
                             (int)local_1c,0x10000,param_15);
        if ((int)uVar6 < 0) {
          FUN_00430a57(uVar6,"Failed while reading from internet and writing to: %ls");
          iVar7 = local_8;
          break;
        }
        iVar7 = local_8;
      } while (iVar1 != 0);
      if (iVar5 != 0) {
        InternetCloseHandle(iVar5);
      }
      if (iVar7 != 0) {
        InternetCloseHandle(iVar7);
      }
    }
  }
  if (local_18 != (short *)0x0) {
    FUN_004380ab(local_18);
  }
  if (local_1c != (LPVOID)0x0) {
    VirtualFree(local_1c,0,0x8000);
  }
  if (local_20 != (HANDLE)0xffffffff) {
    CloseHandle(local_20);
  }
  return uVar6;
}



/* Function: FUN_004253f6 */

DWORD FUN_004253f6(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,int *param_5
                  ,LPCWSTR param_6,LPCWSTR param_7,undefined4 *param_8,LPFILETIME param_9)

{
  int iVar1;
  DWORD DVar2;
  undefined8 local_18;
  undefined4 local_10;
  int local_c;
  int local_8;
  
  local_8 = 0;
  local_c = 0;
  local_18 = 0;
  DVar2 = FUN_004255ef(param_1,param_2,param_3,param_4,param_5,L"HEAD",(short *)0x0,param_6,param_7,
                       &local_8,&local_c,&local_10);
  iVar1 = local_c;
  if ((int)DVar2 < 0) {
    FUN_00430a57(DVar2,"Failed to connect to URL: %ls");
  }
  else {
    DVar2 = FUN_00438698(local_c,(undefined4 *)&local_18);
    if ((int)DVar2 < 0) {
      local_18 = 0;
    }
    *param_8 = (undefined4)local_18;
    param_8[1] = local_18._4_4_;
    DVar2 = FUN_004385df(iVar1,param_9);
    if ((int)DVar2 < 0) {
      GetSystemTimeAsFileTime(param_9);
      DVar2 = 0;
    }
  }
  if (iVar1 != 0) {
    InternetCloseHandle(iVar1);
  }
  if (local_8 != 0) {
    InternetCloseHandle(local_8);
  }
  return DVar2;
}



/* Function: FUN_004254b6 */

DWORD FUN_004254b6(undefined4 param_1,int *param_2,undefined4 *param_3,undefined4 *param_4)

{
  uint uVar1;
  HANDLE hFile;
  DWORD DVar2;
  BOOL BVar3;
  char *pcVar4;
  DWORD local_c;
  uint local_8;
  
  local_8 = 0;
  local_c = 0;
  *param_4 = 0;
  param_4[1] = 0;
  uVar1 = FUN_00413c6f(param_1,param_2);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to calculate resume path from working path: %ls";
  }
  else {
    hFile = CreateFileW((LPCWSTR)*param_2,0xc0000000,4,(LPSECURITY_ATTRIBUTES)0x0,4,0x80,(HANDLE)0x0
                       );
    if (hFile != (HANDLE)0xffffffff) {
      do {
        BVar3 = ReadFile(hFile,(LPVOID)(local_8 + (int)param_4),8 - local_8,&local_c,
                         (LPOVERLAPPED)0x0);
        if (BVar3 == 0) {
          DVar2 = GetLastError();
          uVar1 = DVar2 & 0xffff | 0x80070000;
          if ((int)DVar2 < 1) {
            uVar1 = DVar2;
          }
          if (-1 < (int)uVar1) {
            uVar1 = 0x80004005;
          }
          FUN_004300d9();
          FUN_00430a57(uVar1,"Failed to read resume file: %ls");
          goto LAB_004255da;
        }
        local_8 = local_8 + local_c;
      } while ((local_c != 0) && (local_8 < 8));
      if (local_8 != 8) {
        *param_4 = 0;
        param_4[1] = 0;
      }
      *param_3 = hFile;
      hFile = (HANDLE)0xffffffff;
LAB_004255da:
      if (hFile == (HANDLE)0xffffffff) {
        return uVar1;
      }
      CloseHandle(hFile);
      return uVar1;
    }
    DVar2 = GetLastError();
    uVar1 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar1 = DVar2;
    }
    if (-1 < (int)uVar1) {
      uVar1 = 0x80004005;
    }
    FUN_004300d9();
    pcVar4 = "Failed to create resume file: %ls";
  }
  FUN_00430a57(uVar1,pcVar4);
  return uVar1;
}



/* Function: FUN_004255ef */

DWORD FUN_004255ef(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,int *param_5
                  ,undefined4 param_6,short *param_7,LPCWSTR param_8,LPCWSTR param_9,int *param_10,
                  int *param_11,undefined4 *param_12)

{
  uint uVar1;
  undefined4 uVar2;
  DWORD DVar3;
  int iVar4;
  LPCWSTR pWVar5;
  LPCWSTR pWVar6;
  int iVar7;
  int *piVar8;
  char *pcVar9;
  int local_28 [3];
  LPCWSTR local_1c;
  LPCWSTR local_18;
  LPCWSTR local_14;
  short *local_10;
  int local_c;
  int local_8;
  
  iVar7 = 0;
  piVar8 = local_28;
  for (iVar4 = 7; iVar4 != 0; iVar4 = iVar4 + -1) {
    *piVar8 = 0;
    piVar8 = piVar8 + 1;
  }
  local_8 = 0;
  iVar4 = 0;
  while( true ) {
    local_c = 0;
    if (iVar7 != 0) {
      InternetCloseHandle(iVar7);
      iVar7 = 0;
      local_8 = 0;
    }
    if (iVar4 != 0) {
      InternetCloseHandle(iVar4);
      iVar4 = 0;
    }
    uVar1 = FUN_00438a49(*param_5,local_28);
    if ((int)uVar1 < 0) {
      FUN_00430a57(uVar1,"Failed to break URL into server and resource parts.");
      goto LAB_004257a1;
    }
    if ((param_9 == (LPCWSTR)0x0) || (pWVar6 = param_9, *param_9 == L'\0')) {
      pWVar6 = local_18;
    }
    if ((param_8 == (LPCWSTR)0x0) || (pWVar5 = param_8, *param_8 == L'\0')) {
      pWVar5 = local_1c;
    }
    uVar2 = 3;
    if (local_28[0] == 1) {
      uVar2 = 1;
    }
    iVar4 = InternetConnectW(param_4,local_28[1],local_28[2],pWVar5,pWVar6,uVar2,0,0);
    if (iVar4 == 0) break;
    if ((((param_8 != (LPCWSTR)0x0) && (*param_8 != L'\0')) && (param_9 != (LPCWSTR)0x0)) &&
       (*param_9 != L'\0')) {
      iVar7 = lstrlenW(param_8);
      iVar7 = InternetSetOptionW(iVar4,0x2b,param_8,iVar7);
      if (iVar7 != 0) {
        iVar7 = lstrlenW(param_9);
        InternetSetOptionW(iVar4,0x2c,param_9,iVar7);
      }
    }
    uVar1 = FUN_004257c9(iVar4,param_6,local_28[0],local_14,local_10,param_7,&local_8);
    iVar7 = local_8;
    if ((int)uVar1 < 0) {
      FUN_00430a57(uVar1,"Failed to open internet URL: %ls");
      iVar7 = local_8;
      goto LAB_004257a1;
    }
    uVar1 = FUN_00425909(param_1,param_2,param_3,local_8,param_5,&local_c,param_12);
    if ((int)uVar1 < 0) {
      pcVar9 = "Failed to send request to URL: %ls";
      goto LAB_00425737;
    }
    if (local_c == 0) {
      *param_10 = iVar4;
      iVar4 = 0;
      *param_11 = iVar7;
      iVar7 = 0;
LAB_004257a1:
      FUN_00438a74(local_28);
      if (iVar7 != 0) {
        InternetCloseHandle(iVar7);
      }
      if (iVar4 != 0) {
        InternetCloseHandle(iVar4);
      }
      return uVar1;
    }
  }
  DVar3 = GetLastError();
  uVar1 = DVar3 & 0xffff | 0x80070000;
  if ((int)DVar3 < 1) {
    uVar1 = DVar3;
  }
  if (-1 < (int)uVar1) {
    uVar1 = 0x80004005;
  }
  FUN_004300d9();
  pcVar9 = "Failed to connect to URL: %ls";
LAB_00425737:
  FUN_00430a57(uVar1,pcVar9);
  goto LAB_004257a1;
}



/* Function: FUN_004257c9 */

DWORD FUN_004257c9(undefined4 param_1,undefined4 param_2,int param_3,LPCWSTR param_4,short *param_5,
                  short *param_6,int *param_7)

{
  uint uVar1;
  int iVar2;
  DWORD DVar3;
  int iVar4;
  undefined4 uVar5;
  char *pcVar6;
  LPVOID local_8;
  
  uVar5 = 0x84400200;
  if (param_3 == 4) {
    uVar5 = 0x84c00200;
  }
  local_8 = (LPVOID)0x0;
  uVar1 = FUN_00433f88((int *)&local_8,param_4,0);
  if ((int)uVar1 < 0) {
    pcVar6 = "Failed to allocate string for resource URI.";
  }
  else {
    if ((param_5 != (short *)0x0) && (*param_5 != 0)) {
      uVar1 = FUN_00433c35((int *)&local_8,param_5,0);
      if ((int)uVar1 < 0) {
        pcVar6 = "Failed to append query strong to resource from URI.";
        goto LAB_004257fe;
      }
    }
    iVar2 = HttpOpenRequestW(param_1,param_2,local_8,0,0,&PTR_DAT_00456078,uVar5,0);
    if (iVar2 != 0) {
      if ((param_6 == (short *)0x0) || (*param_6 == 0)) {
LAB_004258e1:
        *param_7 = iVar2;
        iVar2 = 0;
      }
      else {
        iVar4 = HttpAddRequestHeadersW(iVar2,param_6,0xffffffff,0x40000000);
        if (iVar4 != 0) goto LAB_004258e1;
        DVar3 = GetLastError();
        uVar1 = DVar3 & 0xffff | 0x80070000;
        if ((int)DVar3 < 1) {
          uVar1 = DVar3;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        FUN_004300d9();
        FUN_00430a57(uVar1,"Failed to add header to HTTP request.");
      }
      if (iVar2 != 0) {
        InternetCloseHandle(iVar2);
      }
      goto LAB_004258f3;
    }
    DVar3 = GetLastError();
    uVar1 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar1 = DVar3;
    }
    if (-1 < (int)uVar1) {
      uVar1 = 0x80004005;
    }
    FUN_004300d9();
    pcVar6 = "Failed to open internet request.";
  }
LAB_004257fe:
  FUN_00430a57(uVar1,pcVar6);
LAB_004258f3:
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00425909 */

DWORD FUN_00425909(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,int *param_5
                  ,undefined4 *param_6,undefined4 *param_7)

{
  int *piVar1;
  int iVar2;
  DWORD DVar3;
  uint uVar4;
  char *pcVar5;
  int local_8;
  
  piVar1 = param_5;
  local_8 = 0;
  do {
    param_5 = (int *)0x0;
    iVar2 = HttpSendRequestW(param_4,0,0,0,0);
    if (iVar2 == 0) {
      DVar3 = GetLastError();
      uVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar4 = DVar3;
      }
      FUN_00430a57(uVar4,
                   "Failed to send request to URL: %ls, trying to process HTTP status code anyway.")
      ;
      DVar3 = FUN_004386fc(param_4,0x13,&local_8);
      if ((int)DVar3 < 0) {
        pcVar5 = "Failed to get HTTP status code for failed request to URL: %ls";
        goto LAB_00425ac9;
      }
    }
    else {
      uVar4 = FUN_004386fc(param_4,0x13,&local_8);
      if ((int)uVar4 < 0) {
        pcVar5 = "Failed to get HTTP status code for request to URL: %ls";
        DVar3 = uVar4;
        goto LAB_00425ac9;
      }
    }
    if (local_8 < 0x195) {
      if (local_8 == 0x194) {
        return 0x80070002;
      }
      if (local_8 < 0x130) {
        if (local_8 != 0x12f) {
          if (local_8 == 200) {
            *param_7 = 0;
            return 0;
          }
          if (local_8 == 0xce) {
            *param_7 = 1;
            return 0;
          }
          if ((local_8 != 0x12d) && (local_8 != 0x12e)) goto LAB_00425a9d;
        }
        uVar4 = FUN_00438764(param_4,0x33,piVar1);
        if (-1 < (int)uVar4) {
          *param_6 = 1;
          return uVar4;
        }
        pcVar5 = "Failed to get redirect url: %ls";
        DVar3 = uVar4;
LAB_00425ac9:
        FUN_00430a57(DVar3,pcVar5);
        return uVar4;
      }
      if (local_8 == 400) {
        return 0x800700a1;
      }
      if (local_8 != 0x191) {
        if (local_8 == 0x193) {
          return 0x80070005;
        }
        goto LAB_00425a9d;
      }
LAB_004259e3:
      DVar3 = FUN_0042507a(param_1,param_2,param_3,param_4,local_8,&param_5,param_6);
    }
    else {
      if (local_8 < 0x19f) {
        if (local_8 == 0x19e) {
          return 0x80010135;
        }
        if (local_8 == 0x195) {
          return 0x80070032;
        }
        if (local_8 != 0x197) {
          if (local_8 == 0x198) {
            return 0x80070102;
          }
          if (local_8 == 0x19a) {
            return 0x80070002;
          }
          goto LAB_00425a9d;
        }
        goto LAB_004259e3;
      }
      if ((local_8 != 0x1f6) && (local_8 != 0x1f7)) {
        if (local_8 == 0x1f8) {
          return 0x80070102;
        }
LAB_00425a9d:
        if (-1 < (int)uVar4) {
          uVar4 = 0x8000ffff;
        }
        FUN_00430a57(uVar4,"Unknown HTTP status code %d, returned from URL: %ls");
        return uVar4;
      }
      DVar3 = 0x80070003;
    }
    if (param_5 == (int *)0x0) {
      return DVar3;
    }
  } while( true );
}



/* Function: FUN_00425ada */

DWORD FUN_00425ada(undefined4 param_1,HANDLE param_2,uint *param_3,HANDLE param_4,undefined4 param_5
                  ,undefined4 param_6,int param_7,undefined4 param_8,int *param_9)

{
  uint uVar1;
  uint *puVar2;
  uint uVar3;
  int iVar4;
  BOOL BVar5;
  DWORD DVar6;
  uint uVar7;
  uint uVar8;
  char *pcVar9;
  DWORD local_c;
  uint local_8;
  
  puVar2 = param_3;
  local_8 = 0;
  uVar3 = FUN_00436faf(param_2,*param_3,param_3[1],(undefined4 *)0x0,(PLARGE_INTEGER)0x0);
  if ((int)uVar3 < 0) {
    FUN_00430a57(uVar3,"Failed to seek to start point in file.");
  }
  else {
    do {
      iVar4 = InternetReadFile(param_1,param_7,param_8,&local_8);
      if (iVar4 == 0) {
        DVar6 = GetLastError();
        uVar3 = DVar6 & 0xffff | 0x80070000;
        if ((int)DVar6 < 1) {
          uVar3 = DVar6;
        }
        if (-1 < (int)uVar3) {
          uVar3 = 0x80004005;
        }
        FUN_004300d9();
        pcVar9 = "Failed while reading from internet.";
LAB_00425c67:
        FUN_00430a57(uVar3,pcVar9);
        return uVar3;
      }
      if (local_8 == 0) {
        return uVar3;
      }
      uVar7 = 0;
      param_3 = (uint *)0x0;
      do {
        BVar5 = WriteFile(param_2,(LPCVOID)(param_7 + uVar7),local_8 - uVar7,(LPDWORD)&param_3,
                          (LPOVERLAPPED)0x0);
        if (BVar5 == 0) {
          DVar6 = GetLastError();
          uVar3 = DVar6 & 0xffff | 0x80070000;
          if ((int)DVar6 < 1) {
            uVar3 = DVar6;
          }
          if (-1 < (int)uVar3) {
            uVar3 = 0x80004005;
          }
          FUN_004300d9();
          pcVar9 = "Failed to write data from internet.";
          goto LAB_00425c67;
        }
        uVar7 = uVar7 + (int)param_3;
      } while ((param_3 != (uint *)0x0) && (uVar7 < local_8));
      uVar1 = *puVar2;
      *puVar2 = *puVar2 + uVar7;
      uVar8 = 0;
      puVar2[1] = puVar2[1] + (uint)CARRY4(uVar1,uVar7);
      if (param_4 != (HANDLE)0xffffffff) {
        local_c = 0;
        DVar6 = FUN_00436faf(param_4,0,0,(undefined4 *)0x0,(PLARGE_INTEGER)0x0);
        if ((int)DVar6 < 0) {
          FUN_00430a57(DVar6,"Failed to seek to start point in file.");
        }
        else {
          do {
            WriteFile(param_4,puVar2 + uVar8 * 2,8 - uVar8,&local_c,(LPOVERLAPPED)0x0);
            uVar8 = uVar8 + local_c;
            if (local_c == 0) break;
          } while (uVar8 < 8);
        }
      }
      if (((param_9 != (int *)0x0) && (*param_9 != 0)) &&
         (uVar3 = FUN_00414038(param_9,*puVar2,puVar2[1],param_5,param_6,param_2), (int)uVar3 < 0))
      {
        pcVar9 = "UX aborted on cache progress.";
        goto LAB_00425c67;
      }
    } while (local_8 != 0);
  }
  return uVar3;
}



/* Function: FUN_00425c78 */

DWORD FUN_00425c78(int param_1,int *param_2,undefined4 param_3,undefined4 param_4,
                  undefined4 *param_5,uint param_6,uint param_7,LPCWSTR param_8)

{
  uint uVar1;
  DWORD DVar2;
  int iVar3;
  char *pcVar4;
  _FILETIME local_2c;
  undefined8 local_24;
  undefined8 local_1c;
  LPCWSTR local_14;
  HANDLE local_10;
  int local_c;
  LPVOID local_8;
  
  local_10 = (HANDLE)0xffffffff;
  local_8 = (LPVOID)0x0;
  iVar3 = 0;
  local_c = 0;
  local_14 = (LPCWSTR)0x0;
  local_2c.dwLowDateTime = 0;
  local_2c.dwHighDateTime = 0;
  local_1c = 0;
  local_24 = 0;
  uVar1 = FUN_00433f88((int *)&local_8,(LPCWSTR)*param_5,0);
  if ((int)uVar1 < 0) {
    pcVar4 = "Failed to copy download source URL.";
  }
  else {
    iVar3 = InternetOpenW(L"Burn",0,0,0,0);
    if (iVar3 != 0) {
      FUN_0043856b(L"WiX\\Burn",L"DownloadTimeout",0x78,&local_c);
      if (local_c != 0) {
        local_c = local_c * 1000;
        InternetSetOptionW(iVar3,2,&local_c,4);
        InternetSetOptionW(iVar3,6,&local_c,4);
        InternetSetOptionW(iVar3,5,&local_c,4);
      }
      uVar1 = FUN_004253f6(param_1,param_3,param_4,iVar3,(int *)&local_8,(LPCWSTR)param_5[1],
                           (LPCWSTR)param_5[2],(undefined4 *)&local_24,&local_2c);
      if ((int)uVar1 < 0) {
        FUN_00430a57(uVar1,"Failed to get size and time for URL: %ls");
      }
      else {
        FUN_004254b6(param_8,(int *)&local_14,&local_10,(undefined4 *)&local_1c);
        uVar1 = FUN_0042515a(param_1,param_3,param_4,iVar3,(int *)&local_8,(LPCWSTR)param_5[1],
                             (LPCWSTR)param_5[2],param_8,param_6,param_7,(uint)local_24,
                             local_24._4_4_,local_1c,local_10,param_2);
        if ((int)uVar1 < 0) {
          FUN_00430a57(uVar1,"Failed to download URL: %ls");
        }
        else if ((local_14 != (LPCWSTR)0x0) && (*local_14 != L'\0')) {
          DeleteFileW(local_14);
        }
        if (local_10 != (HANDLE)0xffffffff) {
          CloseHandle(local_10);
        }
      }
      goto LAB_00425e26;
    }
    DVar2 = GetLastError();
    uVar1 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar1 = DVar2;
    }
    if (-1 < (int)uVar1) {
      uVar1 = 0x80004005;
    }
    FUN_004300d9();
    pcVar4 = "Failed to open internet session";
  }
  FUN_00430a57(uVar1,pcVar4);
LAB_00425e26:
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  if (iVar3 != 0) {
    InternetCloseHandle(iVar3);
  }
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00425e55 */

undefined4 * __thiscall FUN_00425e55(void *this,undefined4 param_1,DWORD *param_2)

{
  HANDLE pvVar1;
  DWORD DVar2;
  uint uVar3;
  
  uVar3 = 0;
  *(undefined ***)this = CBurnBitsCallback::vftable;
  *(undefined4 *)((int)this + 4) = 1;
  InitializeCriticalSection((LPCRITICAL_SECTION)((int)this + 8));
  pvVar1 = CreateEventW((LPSECURITY_ATTRIBUTES)0x0,1,0,(LPCWSTR)0x0);
  *(HANDLE *)((int)this + 0x28) = pvVar1;
  if (pvVar1 == (HANDLE)0x0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    FUN_00430a57(uVar3,"Failed to create BITS job complete event.");
  }
  else {
    *(undefined4 *)((int)this + 0x20) = 0;
    *(undefined4 *)((int)this + 0x24) = 0;
    *(undefined4 *)((int)this + 0x2c) = param_1;
  }
  *param_2 = uVar3;
  return (undefined4 *)this;
}



/* Function: FUN_00425edd */

void __fastcall FUN_00425edd(undefined4 *param_1)

{
  param_1[0xb] = 0;
  *param_1 = CBurnBitsCallback::vftable;
  if (param_1[10] != 0) {
    CloseHandle((HANDLE)param_1[10]);
    param_1[10] = 0;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)(param_1 + 2));
  return;
}



/* Function: FUN_00425f09 */

void FUN_00425f09(int param_1)

{
  InterlockedIncrement((LONG *)(param_1 + 4));
  return;
}



/* Function: FUN_00425f1d */

void FUN_00425f1d(undefined4 *param_1)

{
  HRESULT HVar1;
  char *pcVar2;
  int *local_20;
  int *local_1c;
  undefined4 local_18;
  undefined4 uStack_14;
  undefined4 uStack_10;
  undefined4 uStack_c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_18 = 0;
  uStack_14 = 0;
  uStack_10 = 0;
  uStack_c = 0;
  local_20 = (int *)0x0;
  local_1c = (int *)0x0;
  HVar1 = CoCreateInstance((IID *)&DAT_0044e498,(LPUNKNOWN)0x0,0x17,(IID *)&DAT_0044e4a8,&local_20);
  if (HVar1 < 0) {
    pcVar2 = "Failed to create IBackgroundCopyManager.";
  }
  else {
    HVar1 = (**(code **)(*local_20 + 0xc))(local_20,L"WixBurn",0,&local_18,&local_1c);
    if (HVar1 < 0) {
      pcVar2 = "Failed to create BITS job.";
    }
    else {
      HVar1 = (**(code **)(*local_1c + 0x5c))(local_1c,0xb);
      if (HVar1 < 0) {
        pcVar2 = "Failed to set notification flags for BITS job.";
      }
      else {
        HVar1 = (**(code **)(*local_1c + 0x74))(local_1c,0x78);
        if (HVar1 < 0) {
          pcVar2 = "Failed to set progress timeout.";
        }
        else {
          HVar1 = (**(code **)(*local_1c + 0x54))(local_1c,0);
          if (-1 < HVar1) {
            *param_1 = local_1c;
            local_1c = (int *)0x0;
            goto LAB_00425fe5;
          }
          pcVar2 = "Failed to set BITS job to foreground.";
        }
      }
    }
  }
  FUN_00430a57(HVar1,pcVar2);
LAB_00425fe5:
  if (local_1c != (int *)0x0) {
    (**(code **)(*local_1c + 8))(local_1c);
  }
  if (local_20 != (int *)0x0) {
    (**(code **)(*local_20 + 8))(local_20);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00426012 */

undefined4 FUN_00426012(void *param_1,undefined4 param_2,int *param_3)

{
  int iVar1;
  undefined4 local_c;
  int local_8;
  
  local_c = 0;
  local_8 = 0;
  iVar1 = (**(code **)(*param_3 + 0xc))(param_3,&local_c,&local_8);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failed to get error context.");
  }
  else if (-1 < local_8) {
    iVar1 = -0x7fff0001;
  }
  if (local_8 < 0) {
    iVar1 = local_8;
  }
  FUN_00426128(param_1,local_c,iVar1);
  return 0;
}



/* Function: FUN_0042606e */

undefined4 FUN_0042606e(void *param_1,int *param_2)

{
  int iVar1;
  char *pcVar2;
  int local_8;
  
  local_8 = 4;
  EnterCriticalSection((LPCRITICAL_SECTION)((int)param_1 + 8));
  iVar1 = (**(code **)(*param_2 + 0x38))(param_2,&local_8);
  if (iVar1 < 0) {
    pcVar2 = "Failed to get state during job modification.";
  }
  else {
    if (local_8 != 2) goto LAB_004260c4;
    iVar1 = FUN_0042625c(param_1,param_2);
    if (-1 < iVar1) goto LAB_004260c4;
    pcVar2 = "Failure while sending progress during BITS job modification.";
  }
  FUN_00430a57(iVar1,pcVar2);
LAB_004260c4:
  LeaveCriticalSection((LPCRITICAL_SECTION)((int)param_1 + 8));
  if (iVar1 < 0) {
    *(undefined4 *)((int)param_1 + 0x20) = 0;
    *(int *)((int)param_1 + 0x24) = iVar1;
    SetEvent(*(HANDLE *)((int)param_1 + 0x28));
  }
  return 0;
}



/* Function: FUN_004260eb */

undefined4 FUN_004260eb(void *param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_0042625c(param_1,param_2);
  if (iVar1 < 0) {
    FUN_00430a57(iVar1,"Failure while sending progress during BITS job transferred.");
    *(undefined4 *)((int)param_1 + 0x20) = 0;
    *(int *)((int)param_1 + 0x24) = iVar1;
  }
  SetEvent(*(HANDLE *)((int)param_1 + 0x28));
  return 0;
}



/* Function: FUN_00426128 */

void __thiscall FUN_00426128(void *this,undefined4 param_1,int param_2)

{
  if (param_2 < 0) {
    *(undefined4 *)((int)this + 0x20) = param_1;
    *(int *)((int)this + 0x24) = param_2;
    SetEvent(*(HANDLE *)((int)this + 0x28));
  }
  return;
}



/* Function: FUN_00426148 */

undefined4 FUN_00426148(int *param_1,int param_2,undefined4 *param_3)

{
  int iVar1;
  
  if (param_3 == (undefined4 *)0x0) {
    FUN_004300d9();
    FUN_00430a57(0x80070057,"Invalid argument ppvObject");
    return 0x80070057;
  }
  *param_3 = 0;
  iVar1 = 0;
  while ((&DAT_0044e488)[iVar1] == *(int *)(param_2 + iVar1 * 4)) {
    iVar1 = iVar1 + 1;
    if (iVar1 == 4) goto LAB_004261a9;
  }
  iVar1 = 0;
  do {
    if ((&DAT_0044e92c)[iVar1] != *(int *)(param_2 + iVar1 * 4)) {
      return 0x80004002;
    }
    iVar1 = iVar1 + 1;
  } while (iVar1 != 4);
LAB_004261a9:
  *param_3 = param_1;
  (**(code **)(*param_1 + 4))(param_1);
  return 0;
}



/* Function: FUN_004261c4 */

LONG FUN_004261c4(undefined4 *param_1)

{
  LONG LVar1;
  
  LVar1 = InterlockedDecrement(param_1 + 1);
  if (LVar1 < 1) {
    if (param_1 != (undefined4 *)0x0) {
      FUN_00425edd(param_1);
      FID_conflict__free(param_1);
    }
    LVar1 = 0;
  }
  return LVar1;
}



/* Function: FUN_004261f2 */

void FUN_004261f2(int param_1,int *param_2,undefined4 param_3,undefined4 param_4,undefined4 *param_5
                 )

{
  int iVar1;
  LCID LVar2;
  LPVOID *ppvVar3;
  int *local_c;
  LPVOID local_8;
  
  local_c = (int *)0x0;
  local_8 = (LPVOID)0x0;
  iVar1 = (**(code **)(*param_2 + 0x3c))(param_2,&local_c);
  if (-1 < iVar1) {
    iVar1 = *local_c;
    ppvVar3 = &local_8;
    LVar2 = GetThreadLocale();
    (**(code **)(iVar1 + 0x14))(local_c,LVar2 & 0xffff,ppvVar3);
  }
  FUN_00413ff9(param_1,param_3,local_8,param_5);
  if (local_8 != (LPVOID)0x0) {
    CoTaskMemFree(local_8);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  return;
}



/* Function: FUN_0042625c */

void __thiscall FUN_0042625c(void *this,int *param_1)

{
  int iVar1;
  undefined4 *puVar2;
  char *pcVar3;
  undefined4 local_20 [6];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  puVar2 = local_20;
  for (iVar1 = 6; iVar1 != 0; iVar1 = iVar1 + -1) {
    *puVar2 = 0;
    puVar2 = puVar2 + 1;
  }
  if ((*(int **)((int)this + 0x2c) != (int *)0x0) && (**(int **)((int)this + 0x2c) != 0)) {
    iVar1 = (**(code **)(*param_1 + 0x30))(param_1,local_20);
    if (iVar1 < 0) {
      pcVar3 = "Failed to get progress when BITS job was transferred.";
    }
    else {
      iVar1 = FUN_00414038(*(undefined4 **)((int)this + 0x2c),local_20[2],local_20[3],local_20[0],
                           local_20[1],0xffffffff);
      if (-1 < iVar1) goto LAB_004262cb;
      pcVar3 = "Failed to send progress from BITS job.";
    }
    FUN_00430a57(iVar1,pcVar3);
  }
LAB_004262cb:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004262de */

int FUN_004262de(undefined4 *param_1,undefined4 param_2,undefined4 param_3)

{
  int iVar1;
  char *pcVar2;
  undefined4 local_18;
  undefined4 local_14;
  undefined4 local_10;
  undefined4 local_c;
  int *local_8;
  
  local_8 = (int *)0x0;
  local_18 = 0;
  local_14 = 0;
  local_10 = 0;
  local_c = 0;
  iVar1 = (**(code **)*param_1)(param_1,&DAT_0044e4b8,&local_8);
  if (iVar1 < 0) {
LAB_0042636b:
    iVar1 = 0;
  }
  else {
    local_10 = param_2;
    local_c = param_3;
    local_18 = 2;
    local_14 = 3;
    iVar1 = (**(code **)(*local_8 + 0xa4))(local_8,&local_18);
    if (iVar1 < 0) {
      pcVar2 = "Failed to set background copy NTLM credentials";
    }
    else {
      local_14 = 4;
      iVar1 = (**(code **)(*local_8 + 0xa4))(local_8,&local_18);
      if (-1 < iVar1) goto LAB_0042636b;
      pcVar2 = "Failed to set background copy negotiate credentials";
    }
    FUN_00430a57(iVar1,pcVar2);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return iVar1;
}



/* Function: FUN_00426382 */

DWORD __fastcall FUN_00426382(int param_1)

{
  DWORD DVar1;
  int iVar2;
  uint uVar3;
  tagMSG *ptVar4;
  tagMSG local_24;
  HANDLE local_8;
  
  local_8 = *(HANDLE *)(param_1 + 0x28);
  ptVar4 = &local_24;
  for (iVar2 = 7; iVar2 != 0; iVar2 = iVar2 + -1) {
    ptVar4->hwnd = (HWND)0x0;
    ptVar4 = (tagMSG *)&ptVar4->message;
  }
  while( true ) {
    DVar1 = MsgWaitForMultipleObjects(1,&local_8,0,0xffffffff,0x4ff);
    if (DVar1 == 0) {
      return 0;
    }
    if (DVar1 != 1) break;
    PeekMessageW(&local_24,(HWND)0x0,0,0,0);
  }
  DVar1 = GetLastError();
  uVar3 = DVar1 & 0xffff | 0x80070000;
  if ((int)DVar1 < 1) {
    uVar3 = DVar1;
  }
  if (-1 < (int)uVar3) {
    uVar3 = 0x80004005;
  }
  FUN_004300d9();
  FUN_00430a57(uVar3,"Failed while waiting for download.");
  return uVar3;
}



/* Function: FUN_00426408 */

undefined4 * FUN_00426408(int param_1,undefined4 *param_2,undefined4 param_3)

{
  int *piVar1;
  int iVar2;
  void *this;
  int *piVar3;
  undefined4 *puVar4;
  char *pcVar5;
  int *local_10;
  int local_c;
  undefined2 *local_8;
  
  puVar4 = param_2;
  local_8 = (undefined2 *)0x0;
  piVar3 = (int *)0x0;
  local_10 = (int *)0x0;
  local_c = 0;
  iVar2 = lstrlenW((LPCWSTR)*param_2);
  if (iVar2 < 8) {
    puVar4 = (undefined4 *)0x80070057;
    FUN_004300d9();
    FUN_00430a57(0x80070057,"Invalid BITS engine URL: %ls");
    goto LAB_00426611;
  }
  puVar4 = (undefined4 *)FUN_00433f88((int *)&local_8,(LPCWSTR)*puVar4,0);
  if ((int)puVar4 < 0) {
    FUN_00430a57(puVar4,"Failed to copy download URL.");
    goto LAB_00426611;
  }
  *local_8 = 0x68;
  local_8[1] = 0x74;
  local_8[2] = 0x74;
  local_8[3] = 0x70;
  puVar4 = (undefined4 *)FUN_00425f1d(&local_10);
  piVar1 = local_10;
  if ((int)puVar4 < 0) {
    pcVar5 = "Failed to create BITS job.";
LAB_004265df:
    FUN_00430a57(puVar4,pcVar5);
  }
  else {
    puVar4 = (undefined4 *)FUN_004262de(local_10,param_2[1],param_2[2]);
    if ((int)puVar4 < 0) {
      pcVar5 = "Failed to set credentials for BITS job.";
      goto LAB_004265df;
    }
    puVar4 = (undefined4 *)(**(code **)(*piVar1 + 0x10))(piVar1,local_8,param_3);
    param_2 = puVar4;
    if ((int)puVar4 < 0) {
      pcVar5 = "Failed to add file to BITS job.";
      goto LAB_004265df;
    }
    this = operator_new(0x30);
    if (this == (void *)0x0) {
      piVar3 = (int *)0x0;
    }
    else {
      piVar3 = FUN_00425e55(this,param_1,(DWORD *)&param_2);
      puVar4 = param_2;
    }
    if (piVar3 == (int *)0x0) {
      puVar4 = (undefined4 *)0x8007000e;
      FUN_004300d9();
      pcVar5 = "Failed to create BITS job callback.";
      goto LAB_004265df;
    }
    if ((int)puVar4 < 0) {
      pcVar5 = "Failed to initialize BITS job callback.";
      goto LAB_004265df;
    }
    puVar4 = (undefined4 *)(**(code **)(*piVar1 + 100))(piVar1,piVar3);
    if ((int)puVar4 < 0) {
      pcVar5 = "Failed to set callback interface for BITS job.";
      goto LAB_004265df;
    }
    do {
      local_c = 0;
      piVar3[9] = 0;
      piVar3[8] = 0;
      ResetEvent((HANDLE)piVar3[10]);
      puVar4 = (undefined4 *)(**(code **)(*piVar1 + 0x1c))(piVar1);
      if ((int)puVar4 < 0) {
        pcVar5 = "Falied to start BITS job.";
        goto LAB_004265df;
      }
      puVar4 = (undefined4 *)FUN_00426382((int)piVar3);
      if ((int)puVar4 < 0) {
        pcVar5 = "Failed while waiting for BITS download.";
        goto LAB_004265df;
      }
      puVar4 = (undefined4 *)piVar3[9];
      if (puVar4 == (undefined4 *)0x80070642) goto LAB_004265e7;
      if ((int)puVar4 < 0) {
        FUN_004261f2(param_1,piVar1,puVar4,piVar3[8],&local_c);
      }
    } while (local_c != 0);
    if ((int)puVar4 < 0) {
      pcVar5 = "Failed to download BITS job.";
      goto LAB_004265df;
    }
    puVar4 = (undefined4 *)(**(code **)(*piVar1 + 0x24))(piVar1);
    if ((int)puVar4 < 0) {
      pcVar5 = "Failed to complete BITS job.";
      goto LAB_004265df;
    }
  }
LAB_004265e7:
  if (piVar1 != (int *)0x0) {
    (**(code **)(*piVar1 + 100))(piVar1,0);
    if ((int)puVar4 < 0) {
      (**(code **)(*piVar1 + 0x20))(piVar1);
    }
  }
  if (piVar3 != (int *)0x0) {
    (**(code **)(*piVar3 + 8))(piVar3);
  }
  if (piVar1 != (int *)0x0) {
    (**(code **)(*piVar1 + 8))(piVar1);
  }
LAB_00426611:
  if (local_8 != (undefined2 *)0x0) {
    FUN_004380ab(local_8);
  }
  return puVar4;
}



/* Function: ConvertStringSecurityDescriptorToSecurityDescriptorW */

void ConvertStringSecurityDescriptorToSecurityDescriptorW(void)

{
                    /* WARNING: Could not recover jumptable at 0x00426628. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  ConvertStringSecurityDescriptorToSecurityDescriptorW();
  return;
}



/* Function: FUN_0042662e */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

int FUN_0042662e(void)

{
  bool bVar1;
  WORD WVar2;
  undefined3 extraout_var;
  int iVar3;
  LPCWSTR pWVar4;
  bool bVar5;
  
  WVar2 = ___crtGetShowWindowMode();
  FUN_0042a126(2);
  if (((IMAGE_DOS_HEADER_00400000.e_magic == (char  [2])0x5a4d) &&
      (*(int *)(IMAGE_DOS_HEADER_00400000.e_lfanew + 0x400000) == 0x4550)) &&
     (*(short *)((int)IMAGE_DOS_HEADER_00400000.e_res_4_ + (IMAGE_DOS_HEADER_00400000.e_lfanew - 4))
      == 0x10b)) {
    bVar5 = false;
    if (0xe < *(uint *)(IMAGE_DOS_HEADER_00400000.e_program +
                       IMAGE_DOS_HEADER_00400000.e_lfanew + 0x34)) {
      bVar5 = *(int *)(&UNK_004000e8 + IMAGE_DOS_HEADER_00400000.e_lfanew) != 0;
    }
  }
  else {
    bVar5 = false;
  }
  bVar1 = FUN_00429b48();
  if (CONCAT31(extraout_var,bVar1) == 0) {
    fast_error_exit(0x1c);
  }
  iVar3 = __mtinit();
  if (iVar3 == 0) {
    fast_error_exit(0x10);
  }
  FUN_0042a20d();
  iVar3 = FUN_00429b5d();
  if (iVar3 < 0) {
    fast_error_exit(0x1b);
  }
  DAT_00459070 = GetCommandLineW();
  DAT_00456f9c = ___crtGetEnvironmentStringsW();
  iVar3 = __wsetargv();
  if (iVar3 < 0) {
    __amsg_exit(8);
  }
  iVar3 = __wsetenvp();
  if (iVar3 < 0) {
    __amsg_exit(9);
  }
  iVar3 = __cinit(1);
  if (iVar3 != 0) {
    __amsg_exit(iVar3);
  }
  pWVar4 = (LPCWSTR)__wwincmdln();
  iVar3 = FUN_00401000(0x400000,0,pWVar4,(uint)WVar2);
  if (!bVar5) {
                    /* WARNING: Subroutine does not return */
    _exit(iVar3);
  }
  __cexit();
  return iVar3;
}



/* Function: fast_error_exit */

/* Library Function - Single Match
    _fast_error_exit
   
   Library: Visual Studio 2012 Release */

void __cdecl fast_error_exit(int param_1)

{
  if (DAT_0045791c == 1) {
    __FF_MSGBANNER();
  }
  __NMSG_WRITE(param_1);
  ___crtExitProcess(0xff);
  return;
}



/* Function: entry */

void entry(void)

{
  ___security_init_cookie();
  FUN_0042662e();
  return;
}



/* Function: __security_check_cookie */

/* Library Function - Single Match
    @__security_check_cookie@4
   
   Library: Visual Studio 2012 Release
   __fastcall __security_check_cookie,4 */

void __fastcall __security_check_cookie(int param_1)

{
  if (param_1 == DAT_004560d0) {
    return;
  }
                    /* WARNING: Subroutine does not return */
  ___report_gsfailure();
}



/* Function: FUN_004267c0 */

uint * __cdecl FUN_004267c0(uint *param_1,byte param_2,uint param_3)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  uint *puVar4;
  
  if (param_3 == 0) {
    return param_1;
  }
  uVar1 = (uint)param_2;
  puVar4 = param_1;
  if ((DAT_00457c44 >> 1 & 1) == 0) {
    if ((0x7f < (int)param_3) && ((DAT_00456180 >> 1 & 1) != 0)) {
      if (uVar1 == 0) {
        uVar1 = 0;
      }
      else {
        uVar1 = CONCAT22(CONCAT11(param_2,param_2),CONCAT11(param_2,param_2));
      }
      if (((uint)param_1 & 0xf) != 0) {
        uVar2 = 0x10 - ((uint)param_1 & 0xf);
        param_3 = param_3 - uVar2;
        for (uVar3 = uVar2 & 3; uVar3 != 0; uVar3 = uVar3 - 1) {
          *(byte *)puVar4 = param_2;
          puVar4 = (uint *)((int)puVar4 + 1);
        }
        for (uVar2 = uVar2 >> 2; uVar2 != 0; uVar2 = uVar2 - 1) {
          *puVar4 = uVar1;
          puVar4 = puVar4 + 1;
        }
      }
      for (uVar3 = param_3 >> 7; uVar3 != 0; uVar3 = uVar3 - 1) {
        *puVar4 = uVar1;
        puVar4[1] = uVar1;
        puVar4[2] = uVar1;
        puVar4[3] = uVar1;
        puVar4[4] = uVar1;
        puVar4[5] = uVar1;
        puVar4[6] = uVar1;
        puVar4[7] = uVar1;
        puVar4[8] = uVar1;
        puVar4[9] = uVar1;
        puVar4[10] = uVar1;
        puVar4[0xb] = uVar1;
        puVar4[0xc] = uVar1;
        puVar4[0xd] = uVar1;
        puVar4[0xe] = uVar1;
        puVar4[0xf] = uVar1;
        puVar4[0x10] = uVar1;
        puVar4[0x11] = uVar1;
        puVar4[0x12] = uVar1;
        puVar4[0x13] = uVar1;
        puVar4[0x14] = uVar1;
        puVar4[0x15] = uVar1;
        puVar4[0x16] = uVar1;
        puVar4[0x17] = uVar1;
        puVar4[0x18] = uVar1;
        puVar4[0x19] = uVar1;
        puVar4[0x1a] = uVar1;
        puVar4[0x1b] = uVar1;
        puVar4[0x1c] = uVar1;
        puVar4[0x1d] = uVar1;
        puVar4[0x1e] = uVar1;
        puVar4[0x1f] = uVar1;
        puVar4 = puVar4 + 0x20;
      }
      if ((param_3 & 0x7f) != 0) {
        for (uVar3 = (param_3 & 0x7f) >> 4; uVar3 != 0; uVar3 = uVar3 - 1) {
          *puVar4 = uVar1;
          puVar4[1] = uVar1;
          puVar4[2] = uVar1;
          puVar4[3] = uVar1;
          puVar4 = puVar4 + 4;
        }
        if ((param_3 & 0xf) != 0) {
          for (uVar3 = (param_3 & 0xf) >> 2; uVar3 != 0; uVar3 = uVar3 - 1) {
            *puVar4 = uVar1;
            puVar4 = puVar4 + 1;
          }
          for (uVar1 = param_3 & 3; uVar1 != 0; uVar1 = uVar1 - 1) {
            *(byte *)puVar4 = param_2;
            puVar4 = (uint *)((int)puVar4 + 1);
          }
        }
      }
      return param_1;
    }
    if (3 < param_3) {
      uVar2 = -(int)param_1 & 3;
      uVar3 = param_3;
      if (uVar2 != 0) {
        uVar3 = param_3 - uVar2;
        do {
          *(byte *)puVar4 = param_2;
          puVar4 = (uint *)((int)puVar4 + 1);
          uVar2 = uVar2 - 1;
        } while (uVar2 != 0);
      }
      uVar1 = uVar1 * 0x1010101;
      param_3 = uVar3 & 3;
      uVar3 = uVar3 >> 2;
      if (uVar3 != 0) {
        for (; uVar3 != 0; uVar3 = uVar3 - 1) {
          *puVar4 = uVar1;
          puVar4 = puVar4 + 1;
        }
        if (param_3 == 0) {
          return param_1;
        }
      }
    }
    do {
      *(char *)puVar4 = (char)uVar1;
      puVar4 = (uint *)((int)puVar4 + 1);
      param_3 = param_3 - 1;
    } while (param_3 != 0);
  }
  else {
    for (; param_3 != 0; param_3 = param_3 - 1) {
      *(byte *)puVar4 = param_2;
      puVar4 = (uint *)((int)puVar4 + 1);
    }
  }
  return param_1;
}



/* Function: FUN_00426850 */

/* WARNING: Control flow encountered bad instruction data */

undefined8 * __cdecl FUN_00426850(undefined8 *param_1,undefined8 *param_2,uint param_3)

{
  undefined8 uVar1;
  undefined4 uVar2;
  undefined4 uVar3;
  undefined4 uVar4;
  undefined4 uVar5;
  undefined4 uVar6;
  undefined4 uVar7;
  undefined4 uVar8;
  undefined4 uVar9;
  undefined4 uVar10;
  undefined4 uVar11;
  undefined4 uVar12;
  undefined4 uVar13;
  int iVar14;
  undefined8 *puVar15;
  uint uVar16;
  uint uVar17;
  int iVar18;
  undefined8 *puVar19;
  undefined4 *puVar20;
  undefined4 *puVar21;
  undefined4 uVar22;
  undefined4 uVar23;
  undefined4 uVar24;
  
  if ((param_2 < param_1) && (param_1 < (undefined8 *)(param_3 + (int)param_2))) {
    puVar20 = (undefined4 *)((param_3 - 4) + (int)param_2);
    puVar21 = (undefined4 *)((param_3 - 4) + (int)param_1);
    if (((uint)puVar21 & 3) == 0) {
      uVar16 = param_3 >> 2;
      uVar17 = param_3 & 3;
      if (7 < uVar16) {
        for (; uVar16 != 0; uVar16 = uVar16 - 1) {
          *puVar21 = *puVar20;
          puVar20 = puVar20 + -1;
          puVar21 = puVar21 + -1;
        }
        switch(uVar17) {
        case 0:
          return param_1;
        case 2:
          goto switchD_00426bf7_caseD_2;
        case 3:
          goto switchD_00426bf7_caseD_3;
        }
        goto switchD_00426bf7_caseD_1;
      }
    }
    else {
      switch(param_3) {
      case 0:
        goto switchD_00426bf7_caseD_0;
      case 1:
        goto switchD_00426bf7_caseD_1;
      case 2:
        goto switchD_00426bf7_caseD_2;
      case 3:
        goto switchD_00426bf7_caseD_3;
      default:
        uVar16 = param_3 - ((uint)puVar21 & 3);
        switch((uint)puVar21 & 3) {
        case 1:
          uVar17 = uVar16 & 3;
          *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
          puVar20 = (undefined4 *)((int)puVar20 + -1);
          uVar16 = uVar16 >> 2;
          puVar21 = (undefined4 *)((int)puVar21 - 1);
          if (7 < uVar16) {
            for (; uVar16 != 0; uVar16 = uVar16 - 1) {
              *puVar21 = *puVar20;
              puVar20 = puVar20 + -1;
              puVar21 = puVar21 + -1;
            }
            switch(uVar17) {
            case 0:
              return param_1;
            case 2:
              goto switchD_00426bf7_caseD_2;
            case 3:
              goto switchD_00426bf7_caseD_3;
            }
            goto switchD_00426bf7_caseD_1;
          }
          break;
        case 2:
          uVar17 = uVar16 & 3;
          *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
          uVar16 = uVar16 >> 2;
          *(undefined1 *)((int)puVar21 + 2) = *(undefined1 *)((int)puVar20 + 2);
          puVar20 = (undefined4 *)((int)puVar20 + -2);
          puVar21 = (undefined4 *)((int)puVar21 - 2);
          if (7 < uVar16) {
            for (; uVar16 != 0; uVar16 = uVar16 - 1) {
              *puVar21 = *puVar20;
              puVar20 = puVar20 + -1;
              puVar21 = puVar21 + -1;
            }
            switch(uVar17) {
            case 0:
              return param_1;
            case 2:
              goto switchD_00426bf7_caseD_2;
            case 3:
              goto switchD_00426bf7_caseD_3;
            }
            goto switchD_00426bf7_caseD_1;
          }
          break;
        case 3:
          uVar17 = uVar16 & 3;
          *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
          *(undefined1 *)((int)puVar21 + 2) = *(undefined1 *)((int)puVar20 + 2);
          uVar16 = uVar16 >> 2;
          *(undefined1 *)((int)puVar21 + 1) = *(undefined1 *)((int)puVar20 + 1);
          puVar20 = (undefined4 *)((int)puVar20 + -3);
          puVar21 = (undefined4 *)((int)puVar21 - 3);
          if (7 < uVar16) {
            for (; uVar16 != 0; uVar16 = uVar16 - 1) {
              *puVar21 = *puVar20;
              puVar20 = puVar20 + -1;
              puVar21 = puVar21 + -1;
            }
            switch(uVar17) {
            case 0:
              return param_1;
            case 2:
              goto switchD_00426bf7_caseD_2;
            case 3:
              goto switchD_00426bf7_caseD_3;
            }
            goto switchD_00426bf7_caseD_1;
          }
        }
      }
    }
    switch(uVar16) {
    case 7:
      puVar21[7 - uVar16] = puVar20[7 - uVar16];
    case 6:
      puVar21[6 - uVar16] = puVar20[6 - uVar16];
    case 5:
      puVar21[5 - uVar16] = puVar20[5 - uVar16];
    case 4:
      puVar21[4 - uVar16] = puVar20[4 - uVar16];
    case 3:
      puVar21[3 - uVar16] = puVar20[3 - uVar16];
    case 2:
      puVar21[2 - uVar16] = puVar20[2 - uVar16];
    case 1:
      puVar21[1 - uVar16] = puVar20[1 - uVar16];
      puVar20 = puVar20 + -uVar16;
      puVar21 = puVar21 + -uVar16;
    }
    switch(uVar17) {
    case 1:
switchD_00426bf7_caseD_1:
      *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
      return param_1;
    case 2:
switchD_00426bf7_caseD_2:
      *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
      *(undefined1 *)((int)puVar21 + 2) = *(undefined1 *)((int)puVar20 + 2);
      return param_1;
    case 3:
switchD_00426bf7_caseD_3:
      *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
      *(undefined1 *)((int)puVar21 + 2) = *(undefined1 *)((int)puVar20 + 2);
      *(undefined1 *)((int)puVar21 + 1) = *(undefined1 *)((int)puVar20 + 1);
      return param_1;
    }
switchD_00426bf7_caseD_0:
    return param_1;
  }
  puVar15 = param_1;
  if ((DAT_00457c44 >> 1 & 1) != 0) {
    for (; param_3 != 0; param_3 = param_3 - 1) {
      *(undefined1 *)puVar15 = *(undefined1 *)param_2;
      param_2 = (undefined8 *)((int)param_2 + 1);
      puVar15 = (undefined8 *)((int)puVar15 + 1);
    }
    return param_1;
  }
  if (param_3 < 0x80) {
LAB_00426a5b:
    if (((uint)param_1 & 3) == 0) goto LAB_00426a63;
LAB_00426a78:
    switch(param_3) {
    case 0:
      goto switchD_00426a70_caseD_0;
    case 1:
      goto switchD_00426a70_caseD_1;
    case 2:
      goto switchD_00426a70_caseD_2;
    case 3:
      goto switchD_00426a70_caseD_3;
    default:
      uVar16 = (param_3 - 4) + ((uint)param_1 & 3);
      switch((uint)param_1 & 3) {
      case 0:
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      case 1:
        uVar17 = uVar16 & 3;
        *(undefined1 *)param_1 = *(undefined1 *)param_2;
        *(undefined1 *)((int)param_1 + 1) = *(undefined1 *)((int)param_2 + 1);
        uVar16 = uVar16 >> 2;
        *(undefined1 *)((int)param_1 + 2) = *(undefined1 *)((int)param_2 + 2);
        param_2 = (undefined8 *)((int)param_2 + 3);
        puVar15 = (undefined8 *)((int)param_1 + 3);
        if (7 < uVar16) {
          for (; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined4 *)puVar15 = *(undefined4 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 4);
            puVar15 = (undefined8 *)((int)puVar15 + 4);
          }
          switch(uVar17) {
          case 0:
            return param_1;
          case 2:
            goto switchD_00426a70_caseD_2;
          case 3:
            goto switchD_00426a70_caseD_3;
          }
          goto switchD_00426a70_caseD_1;
        }
        break;
      case 2:
        uVar17 = uVar16 & 3;
        *(undefined1 *)param_1 = *(undefined1 *)param_2;
        uVar16 = uVar16 >> 2;
        *(undefined1 *)((int)param_1 + 1) = *(undefined1 *)((int)param_2 + 1);
        param_2 = (undefined8 *)((int)param_2 + 2);
        puVar15 = (undefined8 *)((int)param_1 + 2);
        if (7 < uVar16) {
          for (; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined4 *)puVar15 = *(undefined4 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 4);
            puVar15 = (undefined8 *)((int)puVar15 + 4);
          }
          switch(uVar17) {
          case 0:
            return param_1;
          case 2:
            goto switchD_00426a70_caseD_2;
          case 3:
            goto switchD_00426a70_caseD_3;
          }
          goto switchD_00426a70_caseD_1;
        }
        break;
      case 3:
        uVar17 = uVar16 & 3;
        *(undefined1 *)param_1 = *(undefined1 *)param_2;
        param_2 = (undefined8 *)((int)param_2 + 1);
        uVar16 = uVar16 >> 2;
        puVar15 = (undefined8 *)((int)param_1 + 1);
        if (7 < uVar16) {
          for (; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined4 *)puVar15 = *(undefined4 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 4);
            puVar15 = (undefined8 *)((int)puVar15 + 4);
          }
          switch(uVar17) {
          case 0:
            return param_1;
          case 2:
            goto switchD_00426a70_caseD_2;
          case 3:
            goto switchD_00426a70_caseD_3;
          }
          goto switchD_00426a70_caseD_1;
        }
      }
    }
  }
  else {
    if (((((uint)param_1 ^ (uint)param_2) & 0xf) == 0) && ((DAT_00456180 >> 1 & 1) != 0)) {
      if (((uint)param_2 & 0xf) != 0) {
        uVar17 = 0x10 - ((uint)param_2 & 0xf);
        param_3 = param_3 - uVar17;
        for (uVar16 = uVar17 & 3; uVar16 != 0; uVar16 = uVar16 - 1) {
          *(undefined1 *)puVar15 = *(undefined1 *)param_2;
          param_2 = (undefined8 *)((int)param_2 + 1);
          puVar15 = (undefined8 *)((int)puVar15 + 1);
        }
        for (uVar17 = uVar17 >> 2; uVar17 != 0; uVar17 = uVar17 - 1) {
          *(undefined4 *)puVar15 = *(undefined4 *)param_2;
          param_2 = (undefined8 *)((int)param_2 + 4);
          puVar15 = (undefined8 *)((int)puVar15 + 4);
        }
      }
      for (uVar16 = param_3 >> 7; uVar16 != 0; uVar16 = uVar16 - 1) {
        uVar22 = *(undefined4 *)((int)param_2 + 4);
        uVar23 = *(undefined4 *)(param_2 + 1);
        uVar24 = *(undefined4 *)((int)param_2 + 0xc);
        uVar2 = *(undefined4 *)(param_2 + 2);
        uVar3 = *(undefined4 *)((int)param_2 + 0x14);
        uVar4 = *(undefined4 *)(param_2 + 3);
        uVar5 = *(undefined4 *)((int)param_2 + 0x1c);
        uVar6 = *(undefined4 *)(param_2 + 4);
        uVar7 = *(undefined4 *)((int)param_2 + 0x24);
        uVar8 = *(undefined4 *)(param_2 + 5);
        uVar9 = *(undefined4 *)((int)param_2 + 0x2c);
        uVar10 = *(undefined4 *)(param_2 + 6);
        uVar11 = *(undefined4 *)((int)param_2 + 0x34);
        uVar12 = *(undefined4 *)(param_2 + 7);
        uVar13 = *(undefined4 *)((int)param_2 + 0x3c);
        *(undefined4 *)puVar15 = *(undefined4 *)param_2;
        *(undefined4 *)((int)puVar15 + 4) = uVar22;
        *(undefined4 *)(puVar15 + 1) = uVar23;
        *(undefined4 *)((int)puVar15 + 0xc) = uVar24;
        *(undefined4 *)(puVar15 + 2) = uVar2;
        *(undefined4 *)((int)puVar15 + 0x14) = uVar3;
        *(undefined4 *)(puVar15 + 3) = uVar4;
        *(undefined4 *)((int)puVar15 + 0x1c) = uVar5;
        *(undefined4 *)(puVar15 + 4) = uVar6;
        *(undefined4 *)((int)puVar15 + 0x24) = uVar7;
        *(undefined4 *)(puVar15 + 5) = uVar8;
        *(undefined4 *)((int)puVar15 + 0x2c) = uVar9;
        *(undefined4 *)(puVar15 + 6) = uVar10;
        *(undefined4 *)((int)puVar15 + 0x34) = uVar11;
        *(undefined4 *)(puVar15 + 7) = uVar12;
        *(undefined4 *)((int)puVar15 + 0x3c) = uVar13;
        uVar22 = *(undefined4 *)((int)param_2 + 0x44);
        uVar23 = *(undefined4 *)(param_2 + 9);
        uVar24 = *(undefined4 *)((int)param_2 + 0x4c);
        uVar2 = *(undefined4 *)(param_2 + 10);
        uVar3 = *(undefined4 *)((int)param_2 + 0x54);
        uVar4 = *(undefined4 *)(param_2 + 0xb);
        uVar5 = *(undefined4 *)((int)param_2 + 0x5c);
        uVar6 = *(undefined4 *)(param_2 + 0xc);
        uVar7 = *(undefined4 *)((int)param_2 + 100);
        uVar8 = *(undefined4 *)(param_2 + 0xd);
        uVar9 = *(undefined4 *)((int)param_2 + 0x6c);
        uVar10 = *(undefined4 *)(param_2 + 0xe);
        uVar11 = *(undefined4 *)((int)param_2 + 0x74);
        uVar12 = *(undefined4 *)(param_2 + 0xf);
        uVar13 = *(undefined4 *)((int)param_2 + 0x7c);
        *(undefined4 *)(puVar15 + 8) = *(undefined4 *)(param_2 + 8);
        *(undefined4 *)((int)puVar15 + 0x44) = uVar22;
        *(undefined4 *)(puVar15 + 9) = uVar23;
        *(undefined4 *)((int)puVar15 + 0x4c) = uVar24;
        *(undefined4 *)(puVar15 + 10) = uVar2;
        *(undefined4 *)((int)puVar15 + 0x54) = uVar3;
        *(undefined4 *)(puVar15 + 0xb) = uVar4;
        *(undefined4 *)((int)puVar15 + 0x5c) = uVar5;
        *(undefined4 *)(puVar15 + 0xc) = uVar6;
        *(undefined4 *)((int)puVar15 + 100) = uVar7;
        *(undefined4 *)(puVar15 + 0xd) = uVar8;
        *(undefined4 *)((int)puVar15 + 0x6c) = uVar9;
        *(undefined4 *)(puVar15 + 0xe) = uVar10;
        *(undefined4 *)((int)puVar15 + 0x74) = uVar11;
        *(undefined4 *)(puVar15 + 0xf) = uVar12;
        *(undefined4 *)((int)puVar15 + 0x7c) = uVar13;
        param_2 = param_2 + 0x10;
        puVar15 = puVar15 + 0x10;
      }
      if ((param_3 & 0x7f) != 0) {
        for (uVar16 = (param_3 & 0x7f) >> 4; uVar16 != 0; uVar16 = uVar16 - 1) {
          uVar22 = *(undefined4 *)((int)param_2 + 4);
          uVar23 = *(undefined4 *)(param_2 + 1);
          uVar24 = *(undefined4 *)((int)param_2 + 0xc);
          *(undefined4 *)puVar15 = *(undefined4 *)param_2;
          *(undefined4 *)((int)puVar15 + 4) = uVar22;
          *(undefined4 *)(puVar15 + 1) = uVar23;
          *(undefined4 *)((int)puVar15 + 0xc) = uVar24;
          param_2 = param_2 + 2;
          puVar15 = puVar15 + 2;
        }
        if ((param_3 & 0xf) != 0) {
          for (uVar16 = (param_3 & 0xf) >> 2; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined4 *)puVar15 = *(undefined4 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 4);
            puVar15 = (undefined8 *)((int)puVar15 + 4);
          }
          for (uVar16 = param_3 & 3; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined1 *)puVar15 = *(undefined1 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 1);
            puVar15 = (undefined8 *)((int)puVar15 + 1);
          }
        }
      }
      return param_1;
    }
    if ((DAT_00457c44 & 1) == 0) goto LAB_00426a5b;
    if (((uint)param_1 & 3) != 0) goto LAB_00426a78;
    if (((uint)param_2 & 3) == 0) {
      if (((uint)param_1 >> 2 & 1) != 0) {
        uVar22 = *(undefined4 *)param_2;
        param_3 = param_3 - 4;
        param_2 = (undefined8 *)((int)param_2 + 4);
        *(undefined4 *)param_1 = uVar22;
        param_1 = (undefined8 *)((int)param_1 + 4);
      }
      if (((uint)param_1 >> 3 & 1) != 0) {
        uVar1 = *param_2;
        param_3 = param_3 - 8;
        param_2 = param_2 + 1;
        *param_1 = uVar1;
        param_1 = param_1 + 1;
      }
      if (((uint)param_2 & 7) == 0) {
        puVar15 = param_2 + -1;
        uVar22 = *(undefined4 *)param_2;
        uVar23 = *(undefined4 *)((int)param_2 + 4);
        do {
          puVar19 = puVar15;
          uVar3 = *(undefined4 *)(puVar19 + 4);
          uVar4 = *(undefined4 *)((int)puVar19 + 0x24);
          param_3 = param_3 - 0x30;
          uVar5 = *(undefined4 *)(puVar19 + 3);
          uVar6 = *(undefined4 *)((int)puVar19 + 0x1c);
          uVar7 = *(undefined4 *)(puVar19 + 4);
          uVar8 = *(undefined4 *)((int)puVar19 + 0x24);
          uVar24 = *(undefined4 *)(puVar19 + 7);
          uVar2 = *(undefined4 *)((int)puVar19 + 0x3c);
          uVar9 = *(undefined4 *)(puVar19 + 5);
          uVar10 = *(undefined4 *)((int)puVar19 + 0x2c);
          uVar11 = *(undefined4 *)(puVar19 + 6);
          uVar12 = *(undefined4 *)((int)puVar19 + 0x34);
          *(undefined4 *)(param_1 + 1) = uVar22;
          *(undefined4 *)((int)param_1 + 0xc) = uVar23;
          *(undefined4 *)(param_1 + 2) = uVar3;
          *(undefined4 *)((int)param_1 + 0x14) = uVar4;
          *(undefined4 *)(param_1 + 3) = uVar5;
          *(undefined4 *)((int)param_1 + 0x1c) = uVar6;
          *(undefined4 *)(param_1 + 4) = uVar7;
          *(undefined4 *)((int)param_1 + 0x24) = uVar8;
          *(undefined4 *)(param_1 + 5) = uVar9;
          *(undefined4 *)((int)param_1 + 0x2c) = uVar10;
          *(undefined4 *)(param_1 + 6) = uVar11;
          *(undefined4 *)((int)param_1 + 0x34) = uVar12;
          param_1 = param_1 + 6;
          puVar15 = puVar19 + 6;
          uVar22 = uVar24;
          uVar23 = uVar2;
        } while (0x2f < (int)param_3);
        puVar19 = puVar19 + 7;
      }
      else if (((uint)param_2 >> 3 & 1) == 0) {
        iVar14 = (int)param_2 + -4;
        uVar22 = *(undefined4 *)param_2;
        uVar23 = *(undefined4 *)((int)param_2 + 4);
        uVar24 = *(undefined4 *)(param_2 + 1);
        do {
          iVar18 = iVar14;
          uVar5 = *(undefined4 *)(iVar18 + 0x20);
          param_3 = param_3 - 0x30;
          uVar6 = *(undefined4 *)(iVar18 + 0x14);
          uVar7 = *(undefined4 *)(iVar18 + 0x18);
          uVar8 = *(undefined4 *)(iVar18 + 0x1c);
          uVar9 = *(undefined4 *)(iVar18 + 0x20);
          uVar2 = *(undefined4 *)(iVar18 + 0x34);
          uVar3 = *(undefined4 *)(iVar18 + 0x38);
          uVar4 = *(undefined4 *)(iVar18 + 0x3c);
          uVar10 = *(undefined4 *)(iVar18 + 0x24);
          uVar11 = *(undefined4 *)(iVar18 + 0x28);
          uVar12 = *(undefined4 *)(iVar18 + 0x2c);
          uVar13 = *(undefined4 *)(iVar18 + 0x30);
          *(undefined4 *)((int)param_1 + 4) = uVar22;
          *(undefined4 *)(param_1 + 1) = uVar23;
          *(undefined4 *)((int)param_1 + 0xc) = uVar24;
          *(undefined4 *)(param_1 + 2) = uVar5;
          *(undefined4 *)((int)param_1 + 0x14) = uVar6;
          *(undefined4 *)(param_1 + 3) = uVar7;
          *(undefined4 *)((int)param_1 + 0x1c) = uVar8;
          *(undefined4 *)(param_1 + 4) = uVar9;
          *(undefined4 *)((int)param_1 + 0x24) = uVar10;
          *(undefined4 *)(param_1 + 5) = uVar11;
          *(undefined4 *)((int)param_1 + 0x2c) = uVar12;
          *(undefined4 *)(param_1 + 6) = uVar13;
          param_1 = param_1 + 6;
          iVar14 = iVar18 + 0x30;
          uVar22 = uVar2;
          uVar23 = uVar3;
          uVar24 = uVar4;
        } while (0x2f < (int)param_3);
        puVar19 = (undefined8 *)(iVar18 + 0x34);
      }
      else {
        iVar14 = (int)param_2 + -0xc;
        uVar22 = *(undefined4 *)param_2;
        do {
          iVar18 = iVar14;
          uVar24 = *(undefined4 *)(iVar18 + 0x20);
          uVar2 = *(undefined4 *)(iVar18 + 0x24);
          uVar3 = *(undefined4 *)(iVar18 + 0x28);
          param_3 = param_3 - 0x30;
          uVar4 = *(undefined4 *)(iVar18 + 0x1c);
          uVar5 = *(undefined4 *)(iVar18 + 0x20);
          uVar6 = *(undefined4 *)(iVar18 + 0x24);
          uVar7 = *(undefined4 *)(iVar18 + 0x28);
          uVar23 = *(undefined4 *)(iVar18 + 0x3c);
          uVar8 = *(undefined4 *)(iVar18 + 0x2c);
          uVar9 = *(undefined4 *)(iVar18 + 0x30);
          uVar10 = *(undefined4 *)(iVar18 + 0x34);
          uVar11 = *(undefined4 *)(iVar18 + 0x38);
          *(undefined4 *)((int)param_1 + 0xc) = uVar22;
          *(undefined4 *)(param_1 + 2) = uVar24;
          *(undefined4 *)((int)param_1 + 0x14) = uVar2;
          *(undefined4 *)(param_1 + 3) = uVar3;
          *(undefined4 *)((int)param_1 + 0x1c) = uVar4;
          *(undefined4 *)(param_1 + 4) = uVar5;
          *(undefined4 *)((int)param_1 + 0x24) = uVar6;
          *(undefined4 *)(param_1 + 5) = uVar7;
          *(undefined4 *)((int)param_1 + 0x2c) = uVar8;
          *(undefined4 *)(param_1 + 6) = uVar9;
          *(undefined4 *)((int)param_1 + 0x34) = uVar10;
          *(undefined4 *)(param_1 + 7) = uVar11;
          param_1 = param_1 + 6;
          iVar14 = iVar18 + 0x30;
          uVar22 = uVar23;
        } while (0x2f < (int)param_3);
        puVar19 = (undefined8 *)(iVar18 + 0x3c);
      }
      for (; 0xf < (int)param_3; param_3 = param_3 - 0x10) {
        uVar22 = *(undefined4 *)puVar19;
        uVar23 = *(undefined4 *)((int)puVar19 + 4);
        uVar24 = *(undefined4 *)(puVar19 + 1);
        uVar2 = *(undefined4 *)((int)puVar19 + 0xc);
        puVar19 = puVar19 + 2;
        *(undefined4 *)param_1 = uVar22;
        *(undefined4 *)((int)param_1 + 4) = uVar23;
        *(undefined4 *)(param_1 + 1) = uVar24;
        *(undefined4 *)((int)param_1 + 0xc) = uVar2;
        param_1 = param_1 + 2;
      }
      if ((param_3 >> 2 & 1) != 0) {
        uVar22 = *(undefined4 *)puVar19;
        param_3 = param_3 - 4;
        puVar19 = (undefined8 *)((int)puVar19 + 4);
        *(undefined4 *)param_1 = uVar22;
        param_1 = (undefined8 *)((int)param_1 + 4);
      }
      if ((param_3 >> 3 & 1) != 0) {
        param_3 = param_3 - 8;
        *param_1 = *puVar19;
      }
                    /* WARNING: Could not recover jumptable at 0x00426a59. Too many branches */
                    /* WARNING: Treating indirect jump as call */
      puVar15 = (undefined8 *)(*(code *)(&switchD_00426a70::switchdataD_00426b88)[param_3])();
      return puVar15;
    }
LAB_00426a63:
    uVar16 = param_3 >> 2;
    uVar17 = param_3 & 3;
    if (7 < uVar16) {
      for (; uVar16 != 0; uVar16 = uVar16 - 1) {
        *(undefined4 *)puVar15 = *(undefined4 *)param_2;
        param_2 = (undefined8 *)((int)param_2 + 4);
        puVar15 = (undefined8 *)((int)puVar15 + 4);
      }
      switch(uVar17) {
      case 0:
        return param_1;
      case 2:
        goto switchD_00426a70_caseD_2;
      case 3:
        goto switchD_00426a70_caseD_3;
      }
      goto switchD_00426a70_caseD_1;
    }
  }
  switch(uVar16) {
  case 7:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0x1c) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0x1c);
  case 6:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0x18) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0x18);
  case 5:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0x14) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0x14);
  case 4:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0x10) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0x10);
  case 3:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0xc) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0xc);
  case 2:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -8) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -8);
  case 1:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -4) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -4);
    param_2 = (undefined8 *)((int)param_2 + uVar16 * 4);
    puVar15 = (undefined8 *)((int)puVar15 + uVar16 * 4);
  }
  switch(uVar17) {
  case 0:
switchD_00426a70_caseD_0:
    return param_1;
  case 2:
switchD_00426a70_caseD_2:
    *(undefined1 *)puVar15 = *(undefined1 *)param_2;
    *(undefined1 *)((int)puVar15 + 1) = *(undefined1 *)((int)param_2 + 1);
    return param_1;
  case 3:
switchD_00426a70_caseD_3:
    *(undefined1 *)puVar15 = *(undefined1 *)param_2;
    *(undefined1 *)((int)puVar15 + 1) = *(undefined1 *)((int)param_2 + 1);
    *(undefined1 *)((int)puVar15 + 2) = *(undefined1 *)((int)param_2 + 2);
    return param_1;
  }
switchD_00426a70_caseD_1:
  *(undefined1 *)puVar15 = *(undefined1 *)param_2;
  return param_1;
}



/* Function: FUN_00426e94 */

ushort * __cdecl FUN_00426e94(ushort *param_1,ushort param_2)

{
  int iVar1;
  undefined1 auVar2 [16];
  undefined1 auVar3 [16];
  undefined1 auVar4 [16];
  ushort uVar5;
  ushort uVar6;
  
  if (DAT_00457c40 < 1) {
    for (; (*param_1 != 0 && (*param_1 != param_2)); param_1 = param_1 + 1) {
    }
  }
  else {
    auVar2 = pshuflw(ZEXT216(param_2),ZEXT216(param_2),0);
    while( true ) {
      for (; 0xff0 < ((uint)param_1 & 0xfff); param_1 = param_1 + 1) {
        if (*param_1 == param_2) {
          return param_1;
        }
        if (*param_1 == 0) {
          return (ushort *)0x0;
        }
      }
      auVar4._0_2_ = -(ushort)(*param_1 == 0);
      auVar4._2_2_ = -(ushort)(param_1[1] == 0);
      auVar4._4_2_ = -(ushort)(param_1[2] == 0);
      auVar4._6_2_ = -(ushort)(param_1[3] == 0);
      auVar4._8_2_ = -(ushort)(param_1[4] == 0);
      auVar4._10_2_ = -(ushort)(param_1[5] == 0);
      auVar4._12_2_ = -(ushort)(param_1[6] == 0);
      auVar4._14_2_ = -(ushort)(param_1[7] == 0);
      uVar5 = auVar2._0_2_;
      auVar3._0_2_ = -(ushort)(*param_1 == uVar5);
      uVar6 = auVar2._2_2_;
      auVar3._2_2_ = -(ushort)(param_1[1] == uVar6);
      auVar3._4_2_ = -(ushort)(param_1[2] == uVar5);
      auVar3._6_2_ = -(ushort)(param_1[3] == uVar6);
      auVar3._8_2_ = -(ushort)(param_1[4] == uVar5);
      auVar3._10_2_ = -(ushort)(param_1[5] == uVar6);
      auVar3._12_2_ = -(ushort)(param_1[6] == uVar5);
      auVar3._14_2_ = -(ushort)(param_1[7] == uVar6);
      auVar4 = auVar4 | auVar3;
      uVar5 = (ushort)(SUB161(auVar4 >> 7,0) & 1) | (ushort)(SUB161(auVar4 >> 0xf,0) & 1) << 1 |
              (ushort)(SUB161(auVar4 >> 0x17,0) & 1) << 2 |
              (ushort)(SUB161(auVar4 >> 0x1f,0) & 1) << 3 |
              (ushort)(SUB161(auVar4 >> 0x27,0) & 1) << 4 |
              (ushort)(SUB161(auVar4 >> 0x2f,0) & 1) << 5 |
              (ushort)(SUB161(auVar4 >> 0x37,0) & 1) << 6 |
              (ushort)(SUB161(auVar4 >> 0x3f,0) & 1) << 7 |
              (ushort)(SUB161(auVar4 >> 0x47,0) & 1) << 8 |
              (ushort)(SUB161(auVar4 >> 0x4f,0) & 1) << 9 |
              (ushort)(SUB161(auVar4 >> 0x57,0) & 1) << 10 |
              (ushort)(SUB161(auVar4 >> 0x5f,0) & 1) << 0xb |
              (ushort)(SUB161(auVar4 >> 0x67,0) & 1) << 0xc |
              (ushort)(SUB161(auVar4 >> 0x6f,0) & 1) << 0xd |
              (ushort)(SUB161(auVar4 >> 0x77,0) & 1) << 0xe |
              (ushort)(byte)(auVar4[0xf] >> 7) << 0xf;
      if (uVar5 != 0) break;
      param_1 = param_1 + 8;
    }
    iVar1 = 0;
    if (uVar5 != 0) {
      for (; (uVar5 >> iVar1 & 1) == 0; iVar1 = iVar1 + 1) {
      }
    }
    param_1 = (ushort *)((int)param_1 + iVar1);
  }
  return (ushort *)((*param_1 != param_2) - 1 & (uint)param_1);
}



/* Function: _wcscspn */

/* Library Function - Single Match
    _wcscspn
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2019 Release */

size_t __cdecl _wcscspn(wchar_t *_Str,wchar_t *_Control)

{
  wchar_t *pwVar1;
  wchar_t wVar2;
  wchar_t *pwVar3;
  
  pwVar1 = _Str;
  if (*_Str != L'\0') {
    do {
      if (*_Control != L'\0') {
        pwVar3 = _Control;
        wVar2 = *_Control;
        do {
          if (wVar2 == *pwVar1) goto LAB_00426f88;
          pwVar3 = pwVar3 + 1;
          wVar2 = *pwVar3;
        } while (wVar2 != L'\0');
      }
      pwVar1 = pwVar1 + 1;
    } while (*pwVar1 != L'\0');
  }
LAB_00426f88:
  return (int)pwVar1 - (int)_Str >> 1;
}



/* Function: _memcpy_s */

/* Library Function - Single Match
    _memcpy_s
   
   Libraries: Visual Studio 2012, Visual Studio 2015, Visual Studio 2017, Visual Studio 2019 */

errno_t __cdecl _memcpy_s(void *_Dst,rsize_t _DstSize,void *_Src,rsize_t _MaxCount)

{
  errno_t eVar1;
  int *piVar2;
  
  if (_MaxCount == 0) {
    eVar1 = 0;
  }
  else if (_Dst == (void *)0x0) {
    piVar2 = __errno();
    eVar1 = 0x16;
    *piVar2 = 0x16;
    FUN_0042acd7();
  }
  else if ((_Src == (void *)0x0) || (_DstSize < _MaxCount)) {
    FUN_004267c0((uint *)_Dst,0,_DstSize);
    if (_Src == (void *)0x0) {
      piVar2 = __errno();
      eVar1 = 0x16;
    }
    else {
      if (_MaxCount <= _DstSize) {
        return 0x16;
      }
      piVar2 = __errno();
      eVar1 = 0x22;
    }
    *piVar2 = eVar1;
    FUN_0042acd7();
  }
  else {
    FUN_004270c0((undefined8 *)_Dst,(undefined8 *)_Src,_MaxCount);
    eVar1 = 0;
  }
  return eVar1;
}



/* Function: FUN_00427010 */

undefined1 (*) [16] __cdecl FUN_00427010(undefined1 (*param_1) [16],ushort param_2)

{
  undefined1 *puVar1;
  undefined1 (*pauVar2) [16];
  int iVar3;
  undefined1 (*pauVar4) [16];
  bool bVar5;
  bool bVar6;
  
  pauVar4 = (undefined1 (*) [16])0x0;
  pauVar2 = param_1;
  if (DAT_00457c40 < 2) {
    do {
      puVar1 = *pauVar2;
      pauVar4 = (undefined1 (*) [16])(*pauVar2 + 2);
      pauVar2 = pauVar4;
    } while (*(short *)puVar1 != 0);
    do {
      pauVar4 = (undefined1 (*) [16])(pauVar4[-1] + 0xe);
      if (pauVar4 == param_1) break;
    } while (*(ushort *)*pauVar4 != param_2);
    if (*(ushort *)*pauVar4 != param_2) {
      pauVar4 = (undefined1 (*) [16])0x0;
    }
  }
  else {
    for (; ((uint)(*param_1 + 1) & 0xe) != 0; param_1 = (undefined1 (*) [16])(*param_1 + 2)) {
      if (*(ushort *)*param_1 == param_2) {
        pauVar4 = param_1;
      }
      if (*(ushort *)*param_1 == 0) {
        return pauVar4;
      }
    }
    bVar5 = param_2 != 0;
    bVar6 = param_2 == 0;
    if (bVar6) {
      while (iVar3 = pcmpistri(ZEXT416(0xffff0001),*param_1,0x15), !bVar6) {
        param_1 = param_1 + 1;
        bVar6 = param_1 == (undefined1 (*) [16])0x0;
      }
      pauVar4 = (undefined1 (*) [16])(*param_1 + iVar3 * 2);
    }
    else {
      while( true ) {
        iVar3 = pcmpistri(ZEXT216(param_2),*param_1,0x41);
        if (bVar5) {
          pauVar4 = (undefined1 (*) [16])(*param_1 + iVar3 * 2);
        }
        if (bVar6) break;
        bVar5 = (undefined1 (*) [16])0xffffffef < param_1;
        param_1 = param_1 + 1;
        bVar6 = param_1 == (undefined1 (*) [16])0x0;
      }
    }
  }
  return pauVar4;
}



/* Function: FUN_004270c0 */

/* WARNING: Control flow encountered bad instruction data */

undefined8 * __cdecl FUN_004270c0(undefined8 *param_1,undefined8 *param_2,uint param_3)

{
  undefined8 uVar1;
  undefined4 uVar2;
  undefined4 uVar3;
  undefined4 uVar4;
  undefined4 uVar5;
  undefined4 uVar6;
  undefined4 uVar7;
  undefined4 uVar8;
  undefined4 uVar9;
  undefined4 uVar10;
  undefined4 uVar11;
  undefined4 uVar12;
  undefined4 uVar13;
  int iVar14;
  undefined8 *puVar15;
  uint uVar16;
  uint uVar17;
  int iVar18;
  undefined8 *puVar19;
  undefined4 *puVar20;
  undefined4 *puVar21;
  undefined4 uVar22;
  undefined4 uVar23;
  undefined4 uVar24;
  
  if ((param_2 < param_1) && (param_1 < (undefined8 *)(param_3 + (int)param_2))) {
    puVar20 = (undefined4 *)((param_3 - 4) + (int)param_2);
    puVar21 = (undefined4 *)((param_3 - 4) + (int)param_1);
    if (((uint)puVar21 & 3) == 0) {
      uVar16 = param_3 >> 2;
      uVar17 = param_3 & 3;
      if (7 < uVar16) {
        for (; uVar16 != 0; uVar16 = uVar16 - 1) {
          *puVar21 = *puVar20;
          puVar20 = puVar20 + -1;
          puVar21 = puVar21 + -1;
        }
        switch(uVar17) {
        case 0:
          return param_1;
        case 2:
          goto switchD_00427467_caseD_2;
        case 3:
          goto switchD_00427467_caseD_3;
        }
        goto switchD_00427467_caseD_1;
      }
    }
    else {
      switch(param_3) {
      case 0:
        goto switchD_00427467_caseD_0;
      case 1:
        goto switchD_00427467_caseD_1;
      case 2:
        goto switchD_00427467_caseD_2;
      case 3:
        goto switchD_00427467_caseD_3;
      default:
        uVar16 = param_3 - ((uint)puVar21 & 3);
        switch((uint)puVar21 & 3) {
        case 1:
          uVar17 = uVar16 & 3;
          *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
          puVar20 = (undefined4 *)((int)puVar20 + -1);
          uVar16 = uVar16 >> 2;
          puVar21 = (undefined4 *)((int)puVar21 - 1);
          if (7 < uVar16) {
            for (; uVar16 != 0; uVar16 = uVar16 - 1) {
              *puVar21 = *puVar20;
              puVar20 = puVar20 + -1;
              puVar21 = puVar21 + -1;
            }
            switch(uVar17) {
            case 0:
              return param_1;
            case 2:
              goto switchD_00427467_caseD_2;
            case 3:
              goto switchD_00427467_caseD_3;
            }
            goto switchD_00427467_caseD_1;
          }
          break;
        case 2:
          uVar17 = uVar16 & 3;
          *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
          uVar16 = uVar16 >> 2;
          *(undefined1 *)((int)puVar21 + 2) = *(undefined1 *)((int)puVar20 + 2);
          puVar20 = (undefined4 *)((int)puVar20 + -2);
          puVar21 = (undefined4 *)((int)puVar21 - 2);
          if (7 < uVar16) {
            for (; uVar16 != 0; uVar16 = uVar16 - 1) {
              *puVar21 = *puVar20;
              puVar20 = puVar20 + -1;
              puVar21 = puVar21 + -1;
            }
            switch(uVar17) {
            case 0:
              return param_1;
            case 2:
              goto switchD_00427467_caseD_2;
            case 3:
              goto switchD_00427467_caseD_3;
            }
            goto switchD_00427467_caseD_1;
          }
          break;
        case 3:
          uVar17 = uVar16 & 3;
          *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
          *(undefined1 *)((int)puVar21 + 2) = *(undefined1 *)((int)puVar20 + 2);
          uVar16 = uVar16 >> 2;
          *(undefined1 *)((int)puVar21 + 1) = *(undefined1 *)((int)puVar20 + 1);
          puVar20 = (undefined4 *)((int)puVar20 + -3);
          puVar21 = (undefined4 *)((int)puVar21 - 3);
          if (7 < uVar16) {
            for (; uVar16 != 0; uVar16 = uVar16 - 1) {
              *puVar21 = *puVar20;
              puVar20 = puVar20 + -1;
              puVar21 = puVar21 + -1;
            }
            switch(uVar17) {
            case 0:
              return param_1;
            case 2:
              goto switchD_00427467_caseD_2;
            case 3:
              goto switchD_00427467_caseD_3;
            }
            goto switchD_00427467_caseD_1;
          }
        }
      }
    }
    switch(uVar16) {
    case 7:
      puVar21[7 - uVar16] = puVar20[7 - uVar16];
    case 6:
      puVar21[6 - uVar16] = puVar20[6 - uVar16];
    case 5:
      puVar21[5 - uVar16] = puVar20[5 - uVar16];
    case 4:
      puVar21[4 - uVar16] = puVar20[4 - uVar16];
    case 3:
      puVar21[3 - uVar16] = puVar20[3 - uVar16];
    case 2:
      puVar21[2 - uVar16] = puVar20[2 - uVar16];
    case 1:
      puVar21[1 - uVar16] = puVar20[1 - uVar16];
      puVar20 = puVar20 + -uVar16;
      puVar21 = puVar21 + -uVar16;
    }
    switch(uVar17) {
    case 1:
switchD_00427467_caseD_1:
      *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
      return param_1;
    case 2:
switchD_00427467_caseD_2:
      *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
      *(undefined1 *)((int)puVar21 + 2) = *(undefined1 *)((int)puVar20 + 2);
      return param_1;
    case 3:
switchD_00427467_caseD_3:
      *(undefined1 *)((int)puVar21 + 3) = *(undefined1 *)((int)puVar20 + 3);
      *(undefined1 *)((int)puVar21 + 2) = *(undefined1 *)((int)puVar20 + 2);
      *(undefined1 *)((int)puVar21 + 1) = *(undefined1 *)((int)puVar20 + 1);
      return param_1;
    }
switchD_00427467_caseD_0:
    return param_1;
  }
  puVar15 = param_1;
  if ((DAT_00457c44 >> 1 & 1) != 0) {
    for (; param_3 != 0; param_3 = param_3 - 1) {
      *(undefined1 *)puVar15 = *(undefined1 *)param_2;
      param_2 = (undefined8 *)((int)param_2 + 1);
      puVar15 = (undefined8 *)((int)puVar15 + 1);
    }
    return param_1;
  }
  if (param_3 < 0x80) {
LAB_004272cb:
    if (((uint)param_1 & 3) == 0) goto LAB_004272d3;
LAB_004272e8:
    switch(param_3) {
    case 0:
      goto switchD_004272e0_caseD_0;
    case 1:
      goto switchD_004272e0_caseD_1;
    case 2:
      goto switchD_004272e0_caseD_2;
    case 3:
      goto switchD_004272e0_caseD_3;
    default:
      uVar16 = (param_3 - 4) + ((uint)param_1 & 3);
      switch((uint)param_1 & 3) {
      case 0:
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      case 1:
        uVar17 = uVar16 & 3;
        *(undefined1 *)param_1 = *(undefined1 *)param_2;
        *(undefined1 *)((int)param_1 + 1) = *(undefined1 *)((int)param_2 + 1);
        uVar16 = uVar16 >> 2;
        *(undefined1 *)((int)param_1 + 2) = *(undefined1 *)((int)param_2 + 2);
        param_2 = (undefined8 *)((int)param_2 + 3);
        puVar15 = (undefined8 *)((int)param_1 + 3);
        if (7 < uVar16) {
          for (; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined4 *)puVar15 = *(undefined4 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 4);
            puVar15 = (undefined8 *)((int)puVar15 + 4);
          }
          switch(uVar17) {
          case 0:
            return param_1;
          case 2:
            goto switchD_004272e0_caseD_2;
          case 3:
            goto switchD_004272e0_caseD_3;
          }
          goto switchD_004272e0_caseD_1;
        }
        break;
      case 2:
        uVar17 = uVar16 & 3;
        *(undefined1 *)param_1 = *(undefined1 *)param_2;
        uVar16 = uVar16 >> 2;
        *(undefined1 *)((int)param_1 + 1) = *(undefined1 *)((int)param_2 + 1);
        param_2 = (undefined8 *)((int)param_2 + 2);
        puVar15 = (undefined8 *)((int)param_1 + 2);
        if (7 < uVar16) {
          for (; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined4 *)puVar15 = *(undefined4 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 4);
            puVar15 = (undefined8 *)((int)puVar15 + 4);
          }
          switch(uVar17) {
          case 0:
            return param_1;
          case 2:
            goto switchD_004272e0_caseD_2;
          case 3:
            goto switchD_004272e0_caseD_3;
          }
          goto switchD_004272e0_caseD_1;
        }
        break;
      case 3:
        uVar17 = uVar16 & 3;
        *(undefined1 *)param_1 = *(undefined1 *)param_2;
        param_2 = (undefined8 *)((int)param_2 + 1);
        uVar16 = uVar16 >> 2;
        puVar15 = (undefined8 *)((int)param_1 + 1);
        if (7 < uVar16) {
          for (; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined4 *)puVar15 = *(undefined4 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 4);
            puVar15 = (undefined8 *)((int)puVar15 + 4);
          }
          switch(uVar17) {
          case 0:
            return param_1;
          case 2:
            goto switchD_004272e0_caseD_2;
          case 3:
            goto switchD_004272e0_caseD_3;
          }
          goto switchD_004272e0_caseD_1;
        }
      }
    }
  }
  else {
    if (((((uint)param_1 ^ (uint)param_2) & 0xf) == 0) && ((DAT_00456180 >> 1 & 1) != 0)) {
      if (((uint)param_2 & 0xf) != 0) {
        uVar17 = 0x10 - ((uint)param_2 & 0xf);
        param_3 = param_3 - uVar17;
        for (uVar16 = uVar17 & 3; uVar16 != 0; uVar16 = uVar16 - 1) {
          *(undefined1 *)puVar15 = *(undefined1 *)param_2;
          param_2 = (undefined8 *)((int)param_2 + 1);
          puVar15 = (undefined8 *)((int)puVar15 + 1);
        }
        for (uVar17 = uVar17 >> 2; uVar17 != 0; uVar17 = uVar17 - 1) {
          *(undefined4 *)puVar15 = *(undefined4 *)param_2;
          param_2 = (undefined8 *)((int)param_2 + 4);
          puVar15 = (undefined8 *)((int)puVar15 + 4);
        }
      }
      for (uVar16 = param_3 >> 7; uVar16 != 0; uVar16 = uVar16 - 1) {
        uVar22 = *(undefined4 *)((int)param_2 + 4);
        uVar23 = *(undefined4 *)(param_2 + 1);
        uVar24 = *(undefined4 *)((int)param_2 + 0xc);
        uVar2 = *(undefined4 *)(param_2 + 2);
        uVar3 = *(undefined4 *)((int)param_2 + 0x14);
        uVar4 = *(undefined4 *)(param_2 + 3);
        uVar5 = *(undefined4 *)((int)param_2 + 0x1c);
        uVar6 = *(undefined4 *)(param_2 + 4);
        uVar7 = *(undefined4 *)((int)param_2 + 0x24);
        uVar8 = *(undefined4 *)(param_2 + 5);
        uVar9 = *(undefined4 *)((int)param_2 + 0x2c);
        uVar10 = *(undefined4 *)(param_2 + 6);
        uVar11 = *(undefined4 *)((int)param_2 + 0x34);
        uVar12 = *(undefined4 *)(param_2 + 7);
        uVar13 = *(undefined4 *)((int)param_2 + 0x3c);
        *(undefined4 *)puVar15 = *(undefined4 *)param_2;
        *(undefined4 *)((int)puVar15 + 4) = uVar22;
        *(undefined4 *)(puVar15 + 1) = uVar23;
        *(undefined4 *)((int)puVar15 + 0xc) = uVar24;
        *(undefined4 *)(puVar15 + 2) = uVar2;
        *(undefined4 *)((int)puVar15 + 0x14) = uVar3;
        *(undefined4 *)(puVar15 + 3) = uVar4;
        *(undefined4 *)((int)puVar15 + 0x1c) = uVar5;
        *(undefined4 *)(puVar15 + 4) = uVar6;
        *(undefined4 *)((int)puVar15 + 0x24) = uVar7;
        *(undefined4 *)(puVar15 + 5) = uVar8;
        *(undefined4 *)((int)puVar15 + 0x2c) = uVar9;
        *(undefined4 *)(puVar15 + 6) = uVar10;
        *(undefined4 *)((int)puVar15 + 0x34) = uVar11;
        *(undefined4 *)(puVar15 + 7) = uVar12;
        *(undefined4 *)((int)puVar15 + 0x3c) = uVar13;
        uVar22 = *(undefined4 *)((int)param_2 + 0x44);
        uVar23 = *(undefined4 *)(param_2 + 9);
        uVar24 = *(undefined4 *)((int)param_2 + 0x4c);
        uVar2 = *(undefined4 *)(param_2 + 10);
        uVar3 = *(undefined4 *)((int)param_2 + 0x54);
        uVar4 = *(undefined4 *)(param_2 + 0xb);
        uVar5 = *(undefined4 *)((int)param_2 + 0x5c);
        uVar6 = *(undefined4 *)(param_2 + 0xc);
        uVar7 = *(undefined4 *)((int)param_2 + 100);
        uVar8 = *(undefined4 *)(param_2 + 0xd);
        uVar9 = *(undefined4 *)((int)param_2 + 0x6c);
        uVar10 = *(undefined4 *)(param_2 + 0xe);
        uVar11 = *(undefined4 *)((int)param_2 + 0x74);
        uVar12 = *(undefined4 *)(param_2 + 0xf);
        uVar13 = *(undefined4 *)((int)param_2 + 0x7c);
        *(undefined4 *)(puVar15 + 8) = *(undefined4 *)(param_2 + 8);
        *(undefined4 *)((int)puVar15 + 0x44) = uVar22;
        *(undefined4 *)(puVar15 + 9) = uVar23;
        *(undefined4 *)((int)puVar15 + 0x4c) = uVar24;
        *(undefined4 *)(puVar15 + 10) = uVar2;
        *(undefined4 *)((int)puVar15 + 0x54) = uVar3;
        *(undefined4 *)(puVar15 + 0xb) = uVar4;
        *(undefined4 *)((int)puVar15 + 0x5c) = uVar5;
        *(undefined4 *)(puVar15 + 0xc) = uVar6;
        *(undefined4 *)((int)puVar15 + 100) = uVar7;
        *(undefined4 *)(puVar15 + 0xd) = uVar8;
        *(undefined4 *)((int)puVar15 + 0x6c) = uVar9;
        *(undefined4 *)(puVar15 + 0xe) = uVar10;
        *(undefined4 *)((int)puVar15 + 0x74) = uVar11;
        *(undefined4 *)(puVar15 + 0xf) = uVar12;
        *(undefined4 *)((int)puVar15 + 0x7c) = uVar13;
        param_2 = param_2 + 0x10;
        puVar15 = puVar15 + 0x10;
      }
      if ((param_3 & 0x7f) != 0) {
        for (uVar16 = (param_3 & 0x7f) >> 4; uVar16 != 0; uVar16 = uVar16 - 1) {
          uVar22 = *(undefined4 *)((int)param_2 + 4);
          uVar23 = *(undefined4 *)(param_2 + 1);
          uVar24 = *(undefined4 *)((int)param_2 + 0xc);
          *(undefined4 *)puVar15 = *(undefined4 *)param_2;
          *(undefined4 *)((int)puVar15 + 4) = uVar22;
          *(undefined4 *)(puVar15 + 1) = uVar23;
          *(undefined4 *)((int)puVar15 + 0xc) = uVar24;
          param_2 = param_2 + 2;
          puVar15 = puVar15 + 2;
        }
        if ((param_3 & 0xf) != 0) {
          for (uVar16 = (param_3 & 0xf) >> 2; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined4 *)puVar15 = *(undefined4 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 4);
            puVar15 = (undefined8 *)((int)puVar15 + 4);
          }
          for (uVar16 = param_3 & 3; uVar16 != 0; uVar16 = uVar16 - 1) {
            *(undefined1 *)puVar15 = *(undefined1 *)param_2;
            param_2 = (undefined8 *)((int)param_2 + 1);
            puVar15 = (undefined8 *)((int)puVar15 + 1);
          }
        }
      }
      return param_1;
    }
    if ((DAT_00457c44 & 1) == 0) goto LAB_004272cb;
    if (((uint)param_1 & 3) != 0) goto LAB_004272e8;
    if (((uint)param_2 & 3) == 0) {
      if (((uint)param_1 >> 2 & 1) != 0) {
        uVar22 = *(undefined4 *)param_2;
        param_3 = param_3 - 4;
        param_2 = (undefined8 *)((int)param_2 + 4);
        *(undefined4 *)param_1 = uVar22;
        param_1 = (undefined8 *)((int)param_1 + 4);
      }
      if (((uint)param_1 >> 3 & 1) != 0) {
        uVar1 = *param_2;
        param_3 = param_3 - 8;
        param_2 = param_2 + 1;
        *param_1 = uVar1;
        param_1 = param_1 + 1;
      }
      if (((uint)param_2 & 7) == 0) {
        puVar15 = param_2 + -1;
        uVar22 = *(undefined4 *)param_2;
        uVar23 = *(undefined4 *)((int)param_2 + 4);
        do {
          puVar19 = puVar15;
          uVar3 = *(undefined4 *)(puVar19 + 4);
          uVar4 = *(undefined4 *)((int)puVar19 + 0x24);
          param_3 = param_3 - 0x30;
          uVar5 = *(undefined4 *)(puVar19 + 3);
          uVar6 = *(undefined4 *)((int)puVar19 + 0x1c);
          uVar7 = *(undefined4 *)(puVar19 + 4);
          uVar8 = *(undefined4 *)((int)puVar19 + 0x24);
          uVar24 = *(undefined4 *)(puVar19 + 7);
          uVar2 = *(undefined4 *)((int)puVar19 + 0x3c);
          uVar9 = *(undefined4 *)(puVar19 + 5);
          uVar10 = *(undefined4 *)((int)puVar19 + 0x2c);
          uVar11 = *(undefined4 *)(puVar19 + 6);
          uVar12 = *(undefined4 *)((int)puVar19 + 0x34);
          *(undefined4 *)(param_1 + 1) = uVar22;
          *(undefined4 *)((int)param_1 + 0xc) = uVar23;
          *(undefined4 *)(param_1 + 2) = uVar3;
          *(undefined4 *)((int)param_1 + 0x14) = uVar4;
          *(undefined4 *)(param_1 + 3) = uVar5;
          *(undefined4 *)((int)param_1 + 0x1c) = uVar6;
          *(undefined4 *)(param_1 + 4) = uVar7;
          *(undefined4 *)((int)param_1 + 0x24) = uVar8;
          *(undefined4 *)(param_1 + 5) = uVar9;
          *(undefined4 *)((int)param_1 + 0x2c) = uVar10;
          *(undefined4 *)(param_1 + 6) = uVar11;
          *(undefined4 *)((int)param_1 + 0x34) = uVar12;
          param_1 = param_1 + 6;
          puVar15 = puVar19 + 6;
          uVar22 = uVar24;
          uVar23 = uVar2;
        } while (0x2f < (int)param_3);
        puVar19 = puVar19 + 7;
      }
      else if (((uint)param_2 >> 3 & 1) == 0) {
        iVar14 = (int)param_2 + -4;
        uVar22 = *(undefined4 *)param_2;
        uVar23 = *(undefined4 *)((int)param_2 + 4);
        uVar24 = *(undefined4 *)(param_2 + 1);
        do {
          iVar18 = iVar14;
          uVar5 = *(undefined4 *)(iVar18 + 0x20);
          param_3 = param_3 - 0x30;
          uVar6 = *(undefined4 *)(iVar18 + 0x14);
          uVar7 = *(undefined4 *)(iVar18 + 0x18);
          uVar8 = *(undefined4 *)(iVar18 + 0x1c);
          uVar9 = *(undefined4 *)(iVar18 + 0x20);
          uVar2 = *(undefined4 *)(iVar18 + 0x34);
          uVar3 = *(undefined4 *)(iVar18 + 0x38);
          uVar4 = *(undefined4 *)(iVar18 + 0x3c);
          uVar10 = *(undefined4 *)(iVar18 + 0x24);
          uVar11 = *(undefined4 *)(iVar18 + 0x28);
          uVar12 = *(undefined4 *)(iVar18 + 0x2c);
          uVar13 = *(undefined4 *)(iVar18 + 0x30);
          *(undefined4 *)((int)param_1 + 4) = uVar22;
          *(undefined4 *)(param_1 + 1) = uVar23;
          *(undefined4 *)((int)param_1 + 0xc) = uVar24;
          *(undefined4 *)(param_1 + 2) = uVar5;
          *(undefined4 *)((int)param_1 + 0x14) = uVar6;
          *(undefined4 *)(param_1 + 3) = uVar7;
          *(undefined4 *)((int)param_1 + 0x1c) = uVar8;
          *(undefined4 *)(param_1 + 4) = uVar9;
          *(undefined4 *)((int)param_1 + 0x24) = uVar10;
          *(undefined4 *)(param_1 + 5) = uVar11;
          *(undefined4 *)((int)param_1 + 0x2c) = uVar12;
          *(undefined4 *)(param_1 + 6) = uVar13;
          param_1 = param_1 + 6;
          iVar14 = iVar18 + 0x30;
          uVar22 = uVar2;
          uVar23 = uVar3;
          uVar24 = uVar4;
        } while (0x2f < (int)param_3);
        puVar19 = (undefined8 *)(iVar18 + 0x34);
      }
      else {
        iVar14 = (int)param_2 + -0xc;
        uVar22 = *(undefined4 *)param_2;
        do {
          iVar18 = iVar14;
          uVar24 = *(undefined4 *)(iVar18 + 0x20);
          uVar2 = *(undefined4 *)(iVar18 + 0x24);
          uVar3 = *(undefined4 *)(iVar18 + 0x28);
          param_3 = param_3 - 0x30;
          uVar4 = *(undefined4 *)(iVar18 + 0x1c);
          uVar5 = *(undefined4 *)(iVar18 + 0x20);
          uVar6 = *(undefined4 *)(iVar18 + 0x24);
          uVar7 = *(undefined4 *)(iVar18 + 0x28);
          uVar23 = *(undefined4 *)(iVar18 + 0x3c);
          uVar8 = *(undefined4 *)(iVar18 + 0x2c);
          uVar9 = *(undefined4 *)(iVar18 + 0x30);
          uVar10 = *(undefined4 *)(iVar18 + 0x34);
          uVar11 = *(undefined4 *)(iVar18 + 0x38);
          *(undefined4 *)((int)param_1 + 0xc) = uVar22;
          *(undefined4 *)(param_1 + 2) = uVar24;
          *(undefined4 *)((int)param_1 + 0x14) = uVar2;
          *(undefined4 *)(param_1 + 3) = uVar3;
          *(undefined4 *)((int)param_1 + 0x1c) = uVar4;
          *(undefined4 *)(param_1 + 4) = uVar5;
          *(undefined4 *)((int)param_1 + 0x24) = uVar6;
          *(undefined4 *)(param_1 + 5) = uVar7;
          *(undefined4 *)((int)param_1 + 0x2c) = uVar8;
          *(undefined4 *)(param_1 + 6) = uVar9;
          *(undefined4 *)((int)param_1 + 0x34) = uVar10;
          *(undefined4 *)(param_1 + 7) = uVar11;
          param_1 = param_1 + 6;
          iVar14 = iVar18 + 0x30;
          uVar22 = uVar23;
        } while (0x2f < (int)param_3);
        puVar19 = (undefined8 *)(iVar18 + 0x3c);
      }
      for (; 0xf < (int)param_3; param_3 = param_3 - 0x10) {
        uVar22 = *(undefined4 *)puVar19;
        uVar23 = *(undefined4 *)((int)puVar19 + 4);
        uVar24 = *(undefined4 *)(puVar19 + 1);
        uVar2 = *(undefined4 *)((int)puVar19 + 0xc);
        puVar19 = puVar19 + 2;
        *(undefined4 *)param_1 = uVar22;
        *(undefined4 *)((int)param_1 + 4) = uVar23;
        *(undefined4 *)(param_1 + 1) = uVar24;
        *(undefined4 *)((int)param_1 + 0xc) = uVar2;
        param_1 = param_1 + 2;
      }
      if ((param_3 >> 2 & 1) != 0) {
        uVar22 = *(undefined4 *)puVar19;
        param_3 = param_3 - 4;
        puVar19 = (undefined8 *)((int)puVar19 + 4);
        *(undefined4 *)param_1 = uVar22;
        param_1 = (undefined8 *)((int)param_1 + 4);
      }
      if ((param_3 >> 3 & 1) != 0) {
        param_3 = param_3 - 8;
        *param_1 = *puVar19;
      }
                    /* WARNING: Could not recover jumptable at 0x004272c9. Too many branches */
                    /* WARNING: Treating indirect jump as call */
      puVar15 = (undefined8 *)(*(code *)(&switchD_004272e0::switchdataD_004273f8)[param_3])();
      return puVar15;
    }
LAB_004272d3:
    uVar16 = param_3 >> 2;
    uVar17 = param_3 & 3;
    if (7 < uVar16) {
      for (; uVar16 != 0; uVar16 = uVar16 - 1) {
        *(undefined4 *)puVar15 = *(undefined4 *)param_2;
        param_2 = (undefined8 *)((int)param_2 + 4);
        puVar15 = (undefined8 *)((int)puVar15 + 4);
      }
      switch(uVar17) {
      case 0:
        return param_1;
      case 2:
        goto switchD_004272e0_caseD_2;
      case 3:
        goto switchD_004272e0_caseD_3;
      }
      goto switchD_004272e0_caseD_1;
    }
  }
  switch(uVar16) {
  case 7:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0x1c) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0x1c);
  case 6:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0x18) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0x18);
  case 5:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0x14) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0x14);
  case 4:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0x10) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0x10);
  case 3:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -0xc) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -0xc);
  case 2:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -8) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -8);
  case 1:
    *(undefined4 *)((int)puVar15 + uVar16 * 4 + -4) =
         *(undefined4 *)((int)param_2 + uVar16 * 4 + -4);
    param_2 = (undefined8 *)((int)param_2 + uVar16 * 4);
    puVar15 = (undefined8 *)((int)puVar15 + uVar16 * 4);
  }
  switch(uVar17) {
  case 0:
switchD_004272e0_caseD_0:
    return param_1;
  case 2:
switchD_004272e0_caseD_2:
    *(undefined1 *)puVar15 = *(undefined1 *)param_2;
    *(undefined1 *)((int)puVar15 + 1) = *(undefined1 *)((int)param_2 + 1);
    return param_1;
  case 3:
switchD_004272e0_caseD_3:
    *(undefined1 *)puVar15 = *(undefined1 *)param_2;
    *(undefined1 *)((int)puVar15 + 1) = *(undefined1 *)((int)param_2 + 1);
    *(undefined1 *)((int)puVar15 + 2) = *(undefined1 *)((int)param_2 + 2);
    return param_1;
  }
switchD_004272e0_caseD_1:
  *(undefined1 *)puVar15 = *(undefined1 *)param_2;
  return param_1;
}



/* Function: __vsnprintf */

/* Library Function - Single Match
    __vsnprintf
   
   Library: Visual Studio 2012 Release */

int __cdecl __vsnprintf(char *_Dest,size_t _Count,char *_Format,va_list _Args)

{
  int iVar1;
  
  iVar1 = __vsnprintf_l(_Dest,_Count,_Format,(_locale_t)0x0,_Args);
  return iVar1;
}



/* Function: __vsnprintf_l */

/* Library Function - Single Match
    __vsnprintf_l
   
   Library: Visual Studio 2012 Release */

int __cdecl
__vsnprintf_l(char *_DstBuf,size_t _MaxCount,char *_Format,_locale_t _Locale,va_list _ArgList)

{
  int *piVar1;
  int iVar2;
  char **ppcVar3;
  FILE local_24;
  
  local_24._ptr = (char *)0x0;
  ppcVar3 = (char **)&local_24._cnt;
  for (iVar2 = 7; iVar2 != 0; iVar2 = iVar2 + -1) {
    *ppcVar3 = (char *)0x0;
    ppcVar3 = ppcVar3 + 1;
  }
  if (_Format == (char *)0x0) {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
    iVar2 = -1;
  }
  else if ((_MaxCount == 0) || (_DstBuf != (char *)0x0)) {
    local_24._cnt = 0x7fffffff;
    if (_MaxCount < 0x80000000) {
      local_24._cnt = _MaxCount;
    }
    local_24._flag = 0x42;
    local_24._base = _DstBuf;
    local_24._ptr = _DstBuf;
    iVar2 = FUN_0042af6f(&local_24,(byte *)_Format,_Locale,(wchar_t *)_ArgList);
    if (_DstBuf != (char *)0x0) {
      local_24._cnt = local_24._cnt - 1;
      if (local_24._cnt < 0) {
        FUN_0042ad9a(0,&local_24);
      }
      else {
        *local_24._ptr = '\0';
      }
    }
  }
  else {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
    iVar2 = -1;
  }
  return iVar2;
}



/* Function: _memcmp */

/* Library Function - Single Match
    _memcmp
   
   Library: Visual Studio 2012 Release */

int __cdecl _memcmp(void *_Buf1,void *_Buf2,size_t _Size)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  
  if (_Size == 0) {
    return 0;
  }
  if (_Size == 1) {
                    /* WARNING: Load size is inaccurate */
    uVar3 = (uint)*_Buf1;
                    /* WARNING: Load size is inaccurate */
    uVar1 = (uint)*_Buf2;
LAB_00428e15:
    if (uVar3 == uVar1) {
      return 0;
    }
    return (uint)(0 < (int)(uVar3 - uVar1)) * 2 + -1;
  }
  if (_Size == 2) {
                    /* WARNING: Load size is inaccurate */
    uVar3 = (uint)*_Buf1;
                    /* WARNING: Load size is inaccurate */
    uVar1 = (uint)*_Buf2;
    if ((uVar3 != uVar1) &&
       (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
      return iVar2;
    }
    uVar3 = (uint)*(byte *)((int)_Buf1 + 1);
    uVar1 = (uint)*(byte *)((int)_Buf2 + 1);
    goto LAB_00428e15;
  }
  if (_Size == 3) {
                    /* WARNING: Load size is inaccurate */
    uVar3 = (uint)*_Buf1;
                    /* WARNING: Load size is inaccurate */
    uVar1 = (uint)*_Buf2;
    if ((uVar3 != uVar1) &&
       (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
      return iVar2;
    }
    uVar3 = (uint)*(byte *)((int)_Buf1 + 1);
    uVar1 = (uint)*(byte *)((int)_Buf2 + 1);
    if ((uVar3 != uVar1) &&
       (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
      return iVar2;
    }
    uVar3 = (uint)*(byte *)((int)_Buf1 + 2);
    uVar1 = (uint)*(byte *)((int)_Buf2 + 2);
    goto LAB_00428e15;
  }
  if (_Size == 4) {
                    /* WARNING: Load size is inaccurate */
    uVar1 = (uint)*_Buf2;
                    /* WARNING: Load size is inaccurate */
    uVar3 = (uint)*_Buf1;
    if ((uVar3 != uVar1) &&
       (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
      return iVar2;
    }
    uVar3 = (uint)*(byte *)((int)_Buf1 + 1);
    uVar1 = (uint)*(byte *)((int)_Buf2 + 1);
    if ((uVar3 != uVar1) &&
       (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
      return iVar2;
    }
    uVar3 = (uint)*(byte *)((int)_Buf1 + 2);
    uVar1 = (uint)*(byte *)((int)_Buf2 + 2);
    if ((uVar3 != uVar1) &&
       (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
      return iVar2;
    }
    uVar3 = (uint)*(byte *)((int)_Buf1 + 3);
    uVar1 = (uint)*(byte *)((int)_Buf2 + 3);
    goto LAB_00428e15;
  }
  if (0x1f < _Size) {
    do {
                    /* WARNING: Load size is inaccurate */
                    /* WARNING: Load size is inaccurate */
      if (*_Buf1 == *_Buf2) {
        iVar2 = 0;
      }
      else {
        uVar3 = *_Buf1 & 0xff;
                    /* WARNING: Load size is inaccurate */
        uVar1 = (uint)(byte)*_Buf2;
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 1);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 1);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 2);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 2);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        iVar2 = (uint)*(byte *)((int)_Buf1 + 3) - (uint)*(byte *)((int)_Buf2 + 3);
        if (iVar2 != 0) {
          iVar2 = (uint)(0 < iVar2) * 2 + -1;
        }
      }
      if (iVar2 != 0) {
        return iVar2;
      }
      if (*(uint *)((int)_Buf1 + 4) == *(uint *)((int)_Buf2 + 4)) {
        iVar2 = 0;
      }
      else {
        uVar3 = *(uint *)((int)_Buf1 + 4) & 0xff;
        uVar1 = (uint)(byte)*(uint *)((int)_Buf2 + 4);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 5);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 5);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 6);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 6);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        iVar2 = (uint)*(byte *)((int)_Buf1 + 7) - (uint)*(byte *)((int)_Buf2 + 7);
        if (iVar2 != 0) {
          iVar2 = (uint)(0 < iVar2) * 2 + -1;
        }
      }
      if (iVar2 != 0) {
        return iVar2;
      }
      if (*(uint *)((int)_Buf1 + 8) == *(uint *)((int)_Buf2 + 8)) {
        iVar2 = 0;
      }
      else {
        uVar3 = *(uint *)((int)_Buf1 + 8) & 0xff;
        uVar1 = (uint)(byte)*(uint *)((int)_Buf2 + 8);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 9);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 9);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 10);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 10);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        iVar2 = (uint)*(byte *)((int)_Buf1 + 0xb) - (uint)*(byte *)((int)_Buf2 + 0xb);
        if (iVar2 != 0) {
          iVar2 = (uint)(0 < iVar2) * 2 + -1;
        }
      }
      if (iVar2 != 0) {
        return iVar2;
      }
      if (*(uint *)((int)_Buf1 + 0xc) == *(uint *)((int)_Buf2 + 0xc)) {
        iVar2 = 0;
      }
      else {
        uVar3 = *(uint *)((int)_Buf1 + 0xc) & 0xff;
        uVar1 = (uint)(byte)*(uint *)((int)_Buf2 + 0xc);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0xd);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0xd);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0xe);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0xe);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        iVar2 = (uint)*(byte *)((int)_Buf1 + 0xf) - (uint)*(byte *)((int)_Buf2 + 0xf);
        if (iVar2 != 0) {
          iVar2 = (uint)(0 < iVar2) * 2 + -1;
        }
      }
      if (iVar2 != 0) {
        return iVar2;
      }
      if (*(uint *)((int)_Buf1 + 0x10) == *(uint *)((int)_Buf2 + 0x10)) {
        iVar2 = 0;
      }
      else {
        uVar1 = (uint)(byte)*(uint *)((int)_Buf2 + 0x10);
        uVar3 = (uint)(byte)*(uint *)((int)_Buf1 + 0x10);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0x11);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0x11);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0x12);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0x12);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        iVar2 = (uint)*(byte *)((int)_Buf1 + 0x13) - (uint)*(byte *)((int)_Buf2 + 0x13);
        if (iVar2 != 0) {
          iVar2 = (uint)(0 < iVar2) * 2 + -1;
        }
      }
      if (iVar2 != 0) {
        return iVar2;
      }
      if (*(uint *)((int)_Buf1 + 0x14) == *(uint *)((int)_Buf2 + 0x14)) {
        iVar2 = 0;
      }
      else {
        uVar3 = *(uint *)((int)_Buf1 + 0x14) & 0xff;
        uVar1 = (uint)(byte)*(uint *)((int)_Buf2 + 0x14);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0x15);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0x15);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0x16);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0x16);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        iVar2 = (uint)*(byte *)((int)_Buf1 + 0x17) - (uint)*(byte *)((int)_Buf2 + 0x17);
        if (iVar2 != 0) {
          iVar2 = (uint)(0 < iVar2) * 2 + -1;
        }
      }
      if (iVar2 != 0) {
        return iVar2;
      }
      if (*(uint *)((int)_Buf1 + 0x18) == *(uint *)((int)_Buf2 + 0x18)) {
        iVar2 = 0;
      }
      else {
        uVar3 = *(uint *)((int)_Buf1 + 0x18) & 0xff;
        uVar1 = (uint)(byte)*(uint *)((int)_Buf2 + 0x18);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0x19);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0x19);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0x1a);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0x1a);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        iVar2 = (uint)*(byte *)((int)_Buf1 + 0x1b) - (uint)*(byte *)((int)_Buf2 + 0x1b);
        if (iVar2 != 0) {
          iVar2 = (uint)(0 < iVar2) * 2 + -1;
        }
      }
      if (iVar2 != 0) {
        return iVar2;
      }
      if (*(uint *)((int)_Buf1 + 0x1c) == *(uint *)((int)_Buf2 + 0x1c)) {
        iVar2 = 0;
      }
      else {
        uVar3 = *(uint *)((int)_Buf1 + 0x1c) & 0xff;
        uVar1 = (uint)(byte)*(uint *)((int)_Buf2 + 0x1c);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0x1d);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0x1d);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        uVar3 = (uint)*(byte *)((int)_Buf1 + 0x1e);
        uVar1 = (uint)*(byte *)((int)_Buf2 + 0x1e);
        if ((uVar3 != uVar1) &&
           (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
          return iVar2;
        }
        iVar2 = (uint)*(byte *)((int)_Buf1 + 0x1f) - (uint)*(byte *)((int)_Buf2 + 0x1f);
        if (iVar2 != 0) {
          iVar2 = (uint)(0 < iVar2) * 2 + -1;
        }
      }
      if (iVar2 != 0) {
        return iVar2;
      }
      _Size = _Size - 0x20;
      _Buf1 = (void *)((int)_Buf1 + 0x20);
      _Buf2 = (void *)((int)_Buf2 + 0x20);
    } while (0x1f < _Size);
  }
  switch(_Size) {
  default:
    goto switchD_00427cb6_caseD_0;
  case 1:
    goto switchD_00427cb6_caseD_1;
  case 2:
    goto switchD_00427cb6_caseD_2;
  case 3:
    goto switchD_00427cb6_caseD_3;
  case 4:
    goto switchD_00427cb6_caseD_4;
  case 5:
    goto switchD_00427cb6_caseD_5;
  case 6:
    goto switchD_00427cb6_caseD_6;
  case 7:
    goto switchD_00427cb6_caseD_7;
  case 8:
    goto switchD_00427cb6_caseD_8;
  case 9:
    goto switchD_00427cb6_caseD_9;
  case 10:
    goto switchD_00427cb6_caseD_a;
  case 0xb:
    goto switchD_00427cb6_caseD_b;
  case 0xc:
    goto switchD_00427cb6_caseD_c;
  case 0xd:
    goto switchD_00427cb6_caseD_d;
  case 0xe:
    goto switchD_00427cb6_caseD_e;
  case 0xf:
    goto switchD_00427cb6_caseD_f;
  case 0x10:
    goto switchD_00427cb6_caseD_10;
  case 0x11:
    goto switchD_00427cb6_caseD_11;
  case 0x12:
    goto switchD_00427cb6_caseD_12;
  case 0x13:
    goto switchD_00427cb6_caseD_13;
  case 0x14:
    goto switchD_00427cb6_caseD_14;
  case 0x15:
    goto switchD_00427cb6_caseD_15;
  case 0x16:
    goto switchD_00427cb6_caseD_16;
  case 0x17:
    goto switchD_00427cb6_caseD_17;
  case 0x18:
    goto switchD_00427cb6_caseD_18;
  case 0x1a:
    goto switchD_00427cb6_caseD_1a;
  case 0x1b:
    goto switchD_00427cb6_caseD_1b;
  case 0x1c:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x1c));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x1c))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1c));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1b));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1b));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1a));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1a));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x19)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x19));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_18:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x18));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x18))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x18));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x17));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x17));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x16));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x16));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x15)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x15));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_14:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x14));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x14))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x14));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x13));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x13));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x12));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x12));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x11)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x11));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_10:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x10));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x10))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x10));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xf));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xf));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xe));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xe));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xd)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0xd));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_c:
    if (*(int *)((int)_Buf1 + (_Size - 0xc)) == *(int *)((int)_Buf2 + (_Size - 0xc))) {
      iVar2 = 0;
    }
    else {
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xc));
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xc));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xb));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xb));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 10));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 10));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 9)) - (uint)*(byte *)((int)_Buf2 + (_Size - 9));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_8:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 8));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 8))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 8));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 7));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 7));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 6));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 6));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 5)) - (uint)*(byte *)((int)_Buf2 + (_Size - 5));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_4:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 4));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 4))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 4));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 3));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 3));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 2));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 2));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 1)) - (uint)*(byte *)((int)_Buf2 + (_Size - 1));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 == 0) {
switchD_00427cb6_caseD_0:
      iVar2 = 0;
    }
    return iVar2;
  case 0x1d:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x1d));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x1d))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1d));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1c));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1c));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1b));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1b));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1a)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x1a));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
  case 0x19:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x19));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x19))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x19));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x18));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x18));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x17));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x17));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x16)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x16));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_15:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x15));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x15))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x15));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x14));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x14));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x13));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x13));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x12)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x12));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_11:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x11));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x11))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x11));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x10));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x10));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xf));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xf));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xe)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0xe));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_d:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0xd));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0xd))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xd));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xc));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xc));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xb));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xb));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 10)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 10));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_9:
    if (*(int *)((int)_Buf1 + (_Size - 9)) == *(int *)((int)_Buf2 + (_Size - 9))) {
      iVar2 = 0;
    }
    else {
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 9));
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 9));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 8));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 8));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 7));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 7));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 6)) - (uint)*(byte *)((int)_Buf2 + (_Size - 6));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_5:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 5));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 5))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 5));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 4));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 4));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 3));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 3));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 2)) - (uint)*(byte *)((int)_Buf2 + (_Size - 2));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
LAB_004284df:
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_1:
    uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 1));
    uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 1));
    if (uVar3 == uVar1) {
      return 0;
    }
    return (uint)(0 < (int)(uVar3 - uVar1)) * 2 + -1;
  case 0x1e:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x1e));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x1e))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1e));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1d));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1d));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1c));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1c));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1b)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x1b));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_1a:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x1a));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x1a))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1a));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x19));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x19));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x18));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x18));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x17)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x17));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_16:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x16));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x16))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x16));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x15));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x15));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x14));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x14));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x13)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x13));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_12:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x12));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x12))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x12));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x11));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x11));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x10));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x10));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xf)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0xf));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_e:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0xe));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0xe))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xe));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xd));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xd));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xc));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xc));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xb)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0xb));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_a:
    if (*(int *)((int)_Buf1 + (_Size - 10)) == *(int *)((int)_Buf2 + (_Size - 10))) {
      iVar2 = 0;
    }
    else {
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 10));
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 10));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 9));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 9));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 8));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 8));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 7)) - (uint)*(byte *)((int)_Buf2 + (_Size - 7));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_6:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 6));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 6))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 6));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 5));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 5));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 4));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 4));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 3)) - (uint)*(byte *)((int)_Buf2 + (_Size - 3));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_2:
    if (*(short *)((int)_Buf1 + (_Size - 2)) != *(short *)((int)_Buf2 + (_Size - 2))) {
LAB_00428d83:
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 2));
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 2));
      if (uVar3 == uVar1) goto switchD_00427cb6_caseD_1;
      iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1;
      goto LAB_004284df;
    }
    goto switchD_00427cb6_caseD_0;
  case 0x1f:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x1f));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x1f))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1f));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1e));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1e));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1d));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1d));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1c)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x1c));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_1b:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x1b));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x1b))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1b));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x1a));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x1a));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x19));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x19));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x18)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x18));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_17:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x17));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x17))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x17));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x16));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x16));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x15));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x15));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x14)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x14));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_13:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0x13));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0x13))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x13));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x12));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x12));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x11));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0x11));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0x10)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0x10));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_f:
    if (*(int *)((int)_Buf1 + (_Size - 0xf)) == *(int *)((int)_Buf2 + (_Size - 0xf))) {
      iVar2 = 0;
    }
    else {
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xf));
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xf));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xe));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xe));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xd));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xd));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 0xc)) -
              (uint)*(byte *)((int)_Buf2 + (_Size - 0xc));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_b:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 0xb));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 0xb))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 0xb));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 10));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 10));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 9));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 9));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 8)) - (uint)*(byte *)((int)_Buf2 + (_Size - 8));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_7:
    uVar1 = *(uint *)((int)_Buf1 + (_Size - 7));
    if (uVar1 == *(uint *)((int)_Buf2 + (_Size - 7))) {
      iVar2 = 0;
    }
    else {
      uVar1 = uVar1 & 0xff;
      uVar3 = (uint)*(byte *)((int)_Buf2 + (_Size - 7));
      if ((uVar1 != uVar3) &&
         (iVar2 = (uint)(uVar1 != uVar3 && -1 < (int)(uVar1 - uVar3)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 6));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 6));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 5));
      uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 5));
      if ((uVar3 != uVar1) &&
         (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
        return iVar2;
      }
      iVar2 = (uint)*(byte *)((int)_Buf1 + (_Size - 4)) - (uint)*(byte *)((int)_Buf2 + (_Size - 4));
      if (iVar2 != 0) {
        iVar2 = (uint)(0 < iVar2) * 2 + -1;
      }
    }
    if (iVar2 != 0) {
      return iVar2;
    }
switchD_00427cb6_caseD_3:
    uVar3 = (uint)*(byte *)((int)_Buf1 + (_Size - 3));
    uVar1 = (uint)*(byte *)((int)_Buf2 + (_Size - 3));
    if ((uVar3 != uVar1) &&
       (iVar2 = (uint)(uVar3 != uVar1 && -1 < (int)(uVar3 - uVar1)) * 2 + -1, iVar2 != 0)) {
      return iVar2;
    }
    goto LAB_00428d83;
  }
}



/* Function: FUN_00428f41 */

exception * __thiscall FUN_00428f41(void *this,exception *param_1)

{
  std::exception::exception((exception *)this,param_1);
  *(undefined ***)this = std::bad_alloc::vftable;
  return (exception *)this;
}



/* Function: operator_new */

/* Library Function - Single Match
    void * __cdecl operator new(unsigned int)
   
   Library: Visual Studio 2012 Release */

void * __cdecl operator_new(uint param_1)

{
  code *pcVar1;
  int iVar2;
  void *pvVar3;
  undefined **local_14 [3];
  char *local_8;
  
  do {
    pvVar3 = _malloc(param_1);
    if (pvVar3 != (void *)0x0) {
      return pvVar3;
    }
    iVar2 = __callnewh(param_1);
  } while (iVar2 != 0);
  local_8 = "bad allocation";
  std::exception::exception((exception *)local_14,&local_8,1);
  local_14[0] = std::bad_alloc::vftable;
  __CxxThrowException_8((int *)local_14,&DAT_0045403c);
  pcVar1 = (code *)swi(3);
  pvVar3 = (void *)(*pcVar1)();
  return pvVar3;
}



/* Function: FUN_00428fb6 */

exception * __thiscall FUN_00428fb6(void *this,byte param_1)

{
  *(undefined ***)this = std::bad_alloc::vftable;
  FUN_0042bcb1((exception *)this);
  if ((param_1 & 1) != 0) {
    FID_conflict__free(this);
  }
  return (exception *)this;
}



/* Function: FID_conflict:_free */

void __cdecl FID_conflict__free(void *_Memory)

{
  BOOL BVar1;
  int *piVar2;
  DWORD DVar3;
  int iVar4;
  
  if (_Memory != (void *)0x0) {
    BVar1 = HeapFree(DAT_00457608,0,_Memory);
    if (BVar1 == 0) {
      piVar2 = __errno();
      DVar3 = GetLastError();
      iVar4 = __get_errno_from_oserr(DVar3);
      *piVar2 = iVar4;
    }
  }
  return;
}



/* Function: ~type_info */

/* Library Function - Single Match
    public: virtual __thiscall type_info::~type_info(void)
   
   Library: Visual Studio 2012 Release */

void __thiscall type_info::~type_info(type_info *this)

{
  *(undefined ***)this = vftable;
  _Type_info_dtor(this);
  return;
}



/* Function: `scalar_deleting_destructor' */

/* Library Function - Single Match
    public: virtual void * __thiscall type_info::`scalar deleting destructor'(unsigned int)
   
   Libraries: Visual Studio 2008 Release, Visual Studio 2010 Release, Visual Studio 2012 Release */

void * __thiscall type_info::_scalar_deleting_destructor_(type_info *this,uint param_1)

{
  ~type_info(this);
  if ((param_1 & 1) != 0) {
    FID_conflict__free(this);
  }
  return this;
}



/* Function: _wcstok_s */

/* Library Function - Single Match
    _wcstok_s
   
   Library: Visual Studio 2012 Release */

wchar_t * __cdecl _wcstok_s(wchar_t *_Str,wchar_t *_Delim,wchar_t **_Context)

{
  wchar_t wVar1;
  int *piVar2;
  wchar_t *pwVar3;
  wchar_t *pwVar4;
  wchar_t wVar5;
  
  if (((_Context == (wchar_t **)0x0) || (_Delim == (wchar_t *)0x0)) ||
     ((_Str == (wchar_t *)0x0 && (_Str = *_Context, _Str == (wchar_t *)0x0)))) {
    piVar2 = __errno();
    *piVar2 = 0x16;
    FUN_0042acd7();
    pwVar3 = (wchar_t *)0x0;
  }
  else {
    wVar5 = *_Str;
    if (wVar5 != L'\0') {
      wVar1 = *_Delim;
      pwVar3 = _Delim;
      do {
        while ((wVar1 != L'\0' && (wVar1 != wVar5))) {
          wVar1 = pwVar3[1];
          pwVar3 = pwVar3 + 1;
        }
        if (*pwVar3 == L'\0') break;
        _Str = _Str + 1;
        wVar5 = *_Str;
        wVar1 = *_Delim;
        pwVar3 = _Delim;
      } while (wVar5 != L'\0');
    }
    pwVar4 = _Str;
    if (*_Str != L'\0') {
      wVar5 = *_Delim;
      do {
        pwVar3 = _Delim;
        if (wVar5 != L'\0') {
          do {
            if (wVar5 == *pwVar4) break;
            pwVar3 = pwVar3 + 1;
            wVar5 = *pwVar3;
          } while (wVar5 != L'\0');
          wVar5 = *_Delim;
        }
        if (*pwVar3 != L'\0') {
          *pwVar4 = L'\0';
          pwVar4 = pwVar4 + 1;
          break;
        }
        pwVar4 = pwVar4 + 1;
      } while (*pwVar4 != L'\0');
    }
    pwVar3 = (wchar_t *)(-(uint)(_Str != pwVar4) & (uint)_Str);
    *_Context = pwVar4;
  }
  return pwVar3;
}



/* Function: __allmul */

/* Library Function - Single Match
    __allmul
   
   Library: Visual Studio */

longlong __allmul(uint param_1,int param_2,uint param_3,int param_4)

{
  if (param_4 == 0 && param_2 == 0) {
    return (ulonglong)param_1 * (ulonglong)param_3;
  }
  return CONCAT44((int)((ulonglong)param_1 * (ulonglong)param_3 >> 0x20) +
                  param_2 * param_3 + param_1 * param_4,
                  (int)((ulonglong)param_1 * (ulonglong)param_3));
}



/* Function: __aulldiv */

/* Library Function - Single Match
    __aulldiv
   
   Library: Visual Studio */

undefined8 __aulldiv(uint param_1,uint param_2,uint param_3,uint param_4)

{
  ulonglong uVar1;
  longlong lVar2;
  uint uVar3;
  int iVar4;
  uint uVar5;
  uint uVar6;
  uint uVar7;
  uint uVar8;
  uint uVar9;
  
  uVar3 = param_1;
  uVar8 = param_4;
  uVar6 = param_2;
  uVar9 = param_3;
  if (param_4 == 0) {
    uVar3 = param_2 / param_3;
    iVar4 = (int)(((ulonglong)param_2 % (ulonglong)param_3 << 0x20 | (ulonglong)param_1) /
                 (ulonglong)param_3);
  }
  else {
    do {
      uVar5 = uVar8 >> 1;
      uVar9 = uVar9 >> 1 | (uint)((uVar8 & 1) != 0) << 0x1f;
      uVar7 = uVar6 >> 1;
      uVar3 = uVar3 >> 1 | (uint)((uVar6 & 1) != 0) << 0x1f;
      uVar8 = uVar5;
      uVar6 = uVar7;
    } while (uVar5 != 0);
    uVar1 = CONCAT44(uVar7,uVar3) / (ulonglong)uVar9;
    iVar4 = (int)uVar1;
    lVar2 = (ulonglong)param_3 * (uVar1 & 0xffffffff);
    uVar3 = (uint)((ulonglong)lVar2 >> 0x20);
    uVar8 = uVar3 + iVar4 * param_4;
    if (((CARRY4(uVar3,iVar4 * param_4)) || (param_2 < uVar8)) ||
       ((param_2 <= uVar8 && (param_1 < (uint)lVar2)))) {
      iVar4 = iVar4 + -1;
    }
    uVar3 = 0;
  }
  return CONCAT44(uVar3,iVar4);
}



/* Function: __CxxUnhandledExceptionFilter */

/* Library Function - Single Match
    long __stdcall __CxxUnhandledExceptionFilter(struct _EXCEPTION_POINTERS *)
   
   Library: Visual Studio 2012 Release */

long __CxxUnhandledExceptionFilter(_EXCEPTION_POINTERS *param_1)

{
  PEXCEPTION_RECORD pEVar1;
  ULONG_PTR UVar2;
  code *pcVar3;
  long lVar4;
  
  pEVar1 = param_1->ExceptionRecord;
  if (((pEVar1->ExceptionCode == 0xe06d7363) && (pEVar1->NumberParameters == 3)) &&
     ((UVar2 = pEVar1->ExceptionInformation[0], UVar2 == 0x19930520 ||
      (((UVar2 == 0x19930521 || (UVar2 == 0x19930522)) || (UVar2 == 0x1994000)))))) {
    terminate();
    pcVar3 = (code *)swi(3);
    lVar4 = (*pcVar3)();
    return lVar4;
  }
  return 0;
}



/* Function: __XcptFilter */

/* Library Function - Single Match
    __XcptFilter
   
   Library: Visual Studio 2012 Release */

int __cdecl __XcptFilter(ulong _ExceptionNum,_EXCEPTION_POINTERS *_ExceptionPtr)

{
  ulong *puVar1;
  code *pcVar2;
  void *pvVar3;
  _ptiddata p_Var4;
  ulong *puVar5;
  int iVar6;
  int iVar7;
  
  p_Var4 = __getptd_noexit();
  if (p_Var4 != (_ptiddata)0x0) {
    puVar1 = (ulong *)p_Var4->_pxcptacttab;
    puVar5 = puVar1;
    do {
      if (*puVar5 == _ExceptionNum) break;
      puVar5 = puVar5 + 3;
    } while (puVar5 < puVar1 + 0x24);
    if ((puVar1 + 0x24 <= puVar5) || (*puVar5 != _ExceptionNum)) {
      puVar5 = (ulong *)0x0;
    }
    if ((puVar5 == (ulong *)0x0) || (pcVar2 = (code *)puVar5[2], pcVar2 == (code *)0x0)) {
      p_Var4 = (_ptiddata)0x0;
    }
    else if (pcVar2 == (code *)0x5) {
      puVar5[2] = 0;
      p_Var4 = (_ptiddata)0x1;
    }
    else if (pcVar2 == (code *)0x1) {
      p_Var4 = (_ptiddata)0xffffffff;
    }
    else {
      pvVar3 = p_Var4->_tpxcptinfoptrs;
      p_Var4->_tpxcptinfoptrs = _ExceptionPtr;
      if (puVar5[1] == 8) {
        iVar6 = 0x24;
        do {
          iVar7 = iVar6 + 0xc;
          *(undefined4 *)(iVar6 + 8 + (int)p_Var4->_pxcptacttab) = 0;
          iVar6 = iVar7;
        } while (iVar7 < 0x90);
        iVar6 = p_Var4->_tfpecode;
        if (*puVar5 == 0xc000008e) {
          p_Var4->_tfpecode = 0x83;
        }
        else if (*puVar5 == 0xc0000090) {
          p_Var4->_tfpecode = 0x81;
        }
        else if (*puVar5 == 0xc0000091) {
          p_Var4->_tfpecode = 0x84;
        }
        else if (*puVar5 == 0xc0000093) {
          p_Var4->_tfpecode = 0x85;
        }
        else if (*puVar5 == 0xc000008d) {
          p_Var4->_tfpecode = 0x82;
        }
        else if (*puVar5 == 0xc000008f) {
          p_Var4->_tfpecode = 0x86;
        }
        else if (*puVar5 == 0xc0000092) {
          p_Var4->_tfpecode = 0x8a;
        }
        else if (*puVar5 == 0xc00002b5) {
          p_Var4->_tfpecode = 0x8d;
        }
        else if (*puVar5 == 0xc00002b4) {
          p_Var4->_tfpecode = 0x8e;
        }
        (*pcVar2)(8,p_Var4->_tfpecode);
        p_Var4->_tfpecode = iVar6;
      }
      else {
        puVar5[2] = 0;
        (*pcVar2)(puVar5[1]);
      }
      p_Var4->_tpxcptinfoptrs = pvVar3;
      p_Var4 = (_ptiddata)0xffffffff;
    }
  }
  return (int)p_Var4;
}



/* Function: FUN_0042945c */

void FUN_0042945c(void)

{
  FUN_0042c0f6(0xd);
  return;
}



/* Function: FUN_00429468 */

void FUN_00429468(void)

{
  FUN_0042c0f6(0xc);
  return;
}



/* Function: __getptd */

/* Library Function - Single Match
    __getptd
   
   Library: Visual Studio 2012 Release */

_ptiddata __cdecl __getptd(void)

{
  _ptiddata p_Var1;
  
  p_Var1 = __getptd_noexit();
  if (p_Var1 == (_ptiddata)0x0) {
    __amsg_exit(0x10);
  }
  return p_Var1;
}



/* Function: __getptd_noexit */

/* Library Function - Single Match
    __getptd_noexit
   
   Library: Visual Studio 2012 Release */

_ptiddata __cdecl __getptd_noexit(void)

{
  DWORD dwErrCode;
  _ptiddata _Memory;
  int iVar1;
  DWORD DVar2;
  
  dwErrCode = GetLastError();
  _Memory = (_ptiddata)FUN_0042a2e5(DAT_00456130);
  if (_Memory == (_ptiddata)0x0) {
    _Memory = (_ptiddata)__calloc_crt(1,0x3bc);
    if (_Memory != (_ptiddata)0x0) {
      iVar1 = FUN_0042a304(DAT_00456130,_Memory);
      if (iVar1 == 0) {
        FID_conflict__free(_Memory);
        _Memory = (_ptiddata)0x0;
      }
      else {
        FUN_004294f8((int)_Memory,0);
        DVar2 = GetCurrentThreadId();
        _Memory->_thandle = 0xffffffff;
        _Memory->_tid = DVar2;
      }
    }
  }
  SetLastError(dwErrCode);
  return _Memory;
}



/* Function: FUN_004294f8 */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

void __cdecl FUN_004294f8(int param_1,int param_2)

{
  *(undefined **)(param_1 + 0x5c) = &DAT_0044e970;
  *(undefined4 *)(param_1 + 8) = 0;
  *(undefined4 *)(param_1 + 0x14) = 1;
  *(undefined4 *)(param_1 + 0x70) = 1;
  *(undefined2 *)(param_1 + 0xb8) = 0x43;
  *(undefined2 *)(param_1 + 0x1be) = 0x43;
  *(undefined **)(param_1 + 0x68) = &DAT_00456950;
  *(undefined4 *)(param_1 + 0x3b8) = 0;
  __lock(0xd);
  InterlockedIncrement(*(LONG **)(param_1 + 0x68));
  FUN_00429599();
  __lock(0xc);
  *(int *)(param_1 + 0x6c) = param_2;
  if (param_2 == 0) {
    *(undefined **)(param_1 + 0x6c) = PTR_DAT_0045658c;
  }
  ___addlocaleref(*(LONG **)(param_1 + 0x6c));
  FUN_004295a2();
  return;
}



/* Function: FUN_00429599 */

void FUN_00429599(void)

{
  FUN_0042c0f6(0xd);
  return;
}



/* Function: FUN_004295a2 */

void FUN_004295a2(void)

{
  FUN_0042c0f6(0xc);
  return;
}



/* Function: __mtinit */

/* Library Function - Single Match
    __mtinit
   
   Library: Visual Studio 2012 Release */

int __cdecl __mtinit(void)

{
  int iVar1;
  DWORD *pDVar2;
  DWORD DVar3;
  
  FUN_00429765();
  iVar1 = __mtinitlocks();
  if (iVar1 != 0) {
    DAT_00456130 = FUN_0042a2a8(&LAB_0042933a);
    if (DAT_00456130 != 0xffffffff) {
      pDVar2 = (DWORD *)__calloc_crt(1,0x3bc);
      if (pDVar2 != (DWORD *)0x0) {
        iVar1 = FUN_0042a304(DAT_00456130,pDVar2);
        if (iVar1 != 0) {
          FUN_004294f8((int)pDVar2,0);
          DVar3 = GetCurrentThreadId();
          pDVar2[1] = 0xffffffff;
          *pDVar2 = DVar3;
          return 1;
        }
      }
      __mtterm();
      return 0;
    }
  }
  __mtterm();
  return 0;
}



/* Function: __mtterm */

/* Library Function - Single Match
    __mtterm
   
   Library: Visual Studio 2012 Release */

void __cdecl __mtterm(void)

{
  if (DAT_00456130 != 0xffffffff) {
    FUN_0042a2c6(DAT_00456130);
    DAT_00456130 = 0xffffffff;
  }
  __mtdeletelocks();
  return;
}



/* Function: ___crtCorExitProcess */

/* Library Function - Single Match
    ___crtCorExitProcess
   
   Library: Visual Studio 2012 Release */

void __cdecl ___crtCorExitProcess(int param_1)

{
  BOOL BVar1;
  FARPROC pFVar2;
  HMODULE local_8;
  
  BVar1 = GetModuleHandleExW(0,L"mscoree.dll",&local_8);
  if (BVar1 != 0) {
    pFVar2 = GetProcAddress(local_8,"CorExitProcess");
    if (pFVar2 != (FARPROC)0x0) {
      (*pFVar2)(param_1);
    }
  }
  return;
}



/* Function: ___crtExitProcess */

/* Library Function - Single Match
    ___crtExitProcess
   
   Library: Visual Studio 2012 Release */

void __cdecl ___crtExitProcess(int param_1)

{
  ___crtCorExitProcess(param_1);
                    /* WARNING: Subroutine does not return */
  ExitProcess(param_1);
}



/* Function: __amsg_exit */

/* Library Function - Single Match
    __amsg_exit
   
   Library: Visual Studio 2012 Release */

void __cdecl __amsg_exit(int param_1)

{
  code *pcVar1;
  
  __FF_MSGBANNER();
  __NMSG_WRITE(param_1);
  __exit(0xff);
  pcVar1 = (code *)swi(3);
  (*pcVar1)();
  return;
}



/* Function: __cexit */

/* Library Function - Single Match
    __cexit
   
   Library: Visual Studio 2012 Release */

void __cdecl __cexit(void)

{
  doexit(0,0,1);
  return;
}



/* Function: __cinit */

/* Library Function - Single Match
    __cinit
   
   Library: Visual Studio 2012 Release */

int __cdecl __cinit(int param_1)

{
  BOOL BVar1;
  int iVar2;
  undefined4 *puVar3;
  
  if (DAT_00459064 != (code *)0x0) {
    BVar1 = __IsNonwritableInCurrentImage((PBYTE)&DAT_00459064);
    if (BVar1 != 0) {
      (*DAT_00459064)(param_1);
    }
  }
  __initp_misc_cfltcvt_tab();
  iVar2 = __initterm_e((undefined4 *)&DAT_0043b4a4,(undefined4 *)&DAT_0043b4bc);
  if (iVar2 == 0) {
    _atexit((_func_4879 *)&LAB_0042a22d);
    for (puVar3 = &DAT_0043b474; puVar3 < &DAT_0043b4a0; puVar3 = puVar3 + 1) {
      if ((code *)*puVar3 != (code *)0x0) {
        (*(code *)*puVar3)();
      }
    }
    if (DAT_00459058 != (code *)0x0) {
      BVar1 = __IsNonwritableInCurrentImage((PBYTE)&DAT_00459058);
      if (BVar1 != 0) {
        (*DAT_00459058)(0,2,0);
      }
    }
    iVar2 = 0;
  }
  return iVar2;
}



/* Function: __exit */

/* Library Function - Single Match
    __exit
   
   Library: Visual Studio 2012 Release */

void __cdecl __exit(int param_1)

{
  doexit(param_1,1,0);
  return;
}



/* Function: FUN_00429765 */

void FUN_00429765(void)

{
  PVOID pvVar1;
  
  pvVar1 = EncodePointer((PVOID)0x0);
  FUN_0042bda1(pvVar1);
  FUN_0042ac9f(pvVar1);
  FUN_0042ceda(pvVar1);
  FUN_0042cee7(pvVar1);
  FUN_0042cf01(pvVar1);
  FUN_0042bf81();
  FUN_0042a385();
  return;
}



/* Function: __initterm */

/* Library Function - Single Match
    __initterm
   
   Library: Visual Studio 2012 Release */

void __cdecl __initterm(undefined4 *param_1,undefined4 *param_2)

{
  for (; param_1 < param_2; param_1 = param_1 + 1) {
    if ((code *)*param_1 != (code *)0x0) {
      (*(code *)*param_1)();
    }
  }
  return;
}



/* Function: __initterm_e */

/* Library Function - Single Match
    __initterm_e
   
   Library: Visual Studio 2012 Release */

void __cdecl __initterm_e(undefined4 *param_1,undefined4 *param_2)

{
  int iVar1;
  
  iVar1 = 0;
  while ((param_1 < param_2 && (iVar1 == 0))) {
    if ((code *)*param_1 != (code *)0x0) {
      iVar1 = (*(code *)*param_1)();
    }
    param_1 = param_1 + 1;
  }
  return;
}



/* Function: FUN_004297db */

void FUN_004297db(void)

{
  __lock(8);
  return;
}



/* Function: FUN_004297e4 */

void FUN_004297e4(void)

{
  FUN_0042c0f6(8);
  return;
}



/* Function: doexit */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* WARNING: Removing unreachable block (ram,0x0042990d) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */
/* Library Function - Single Match
    _doexit
   
   Library: Visual Studio 2012 Release */

void __cdecl doexit(int param_1,int param_2,int param_3)

{
  int *piVar1;
  PVOID pvVar2;
  code *pcVar3;
  int *piVar4;
  int *piVar5;
  int *piVar6;
  int *local_20;
  
  __lock(8);
  pcVar3 = DecodePointer_exref;
  if (DAT_00456fb8 != 1) {
    _DAT_00456fac = 1;
    DAT_00456fa8 = (undefined1)param_3;
    if (param_2 == 0) {
      local_20 = (int *)DecodePointer(DAT_00459060);
      if (local_20 != (int *)0x0) {
        piVar1 = (int *)DecodePointer(DAT_0045905c);
        piVar6 = piVar1;
        while (piVar1 = piVar1 + -1, local_20 <= piVar1) {
          pvVar2 = EncodePointer((PVOID)0x0);
          if ((PVOID)*piVar1 != pvVar2) {
            if (piVar1 < local_20) break;
            pcVar3 = (code *)(*pcVar3)(*piVar1);
            pvVar2 = EncodePointer((PVOID)0x0);
            *piVar1 = (int)pvVar2;
            (*pcVar3)();
            pcVar3 = DecodePointer_exref;
            piVar4 = (int *)DecodePointer(DAT_00459060);
            piVar5 = (int *)DecodePointer(DAT_0045905c);
            if ((local_20 != piVar4) || (piVar6 != piVar5)) {
              piVar1 = piVar5;
              local_20 = piVar4;
              piVar6 = piVar5;
            }
          }
        }
      }
      __initterm((undefined4 *)&DAT_0043b4c8,(undefined4 *)&DAT_0043b4d8);
    }
    __initterm((undefined4 *)&DAT_0043b4dc,(undefined4 *)&DAT_0043b4e0);
  }
  FUN_00429907();
  if (param_3 == 0) {
    DAT_00456fb8 = 1;
    FUN_0042c0f6(8);
    ___crtExitProcess(param_1);
    return;
  }
  return;
}



/* Function: FUN_00429907 */

void FUN_00429907(void)

{
  int unaff_EBP;
  
  if (*(int *)(unaff_EBP + 0x10) != 0) {
    FUN_0042c0f6(8);
  }
  return;
}



/* Function: _exit */

/* Library Function - Single Match
    _exit
   
   Library: Visual Studio 2012 Release */

void __cdecl _exit(int _Code)

{
  doexit(_Code,0,0);
  return;
}



/* Function: __FF_MSGBANNER */

/* Library Function - Single Match
    __FF_MSGBANNER
   
   Library: Visual Studio 2012 Release */

void __cdecl __FF_MSGBANNER(void)

{
  int iVar1;
  
  iVar1 = __set_error_mode(3);
  if (iVar1 != 1) {
    iVar1 = __set_error_mode(3);
    if (iVar1 != 0) {
      return;
    }
    if (DAT_00456fd8 != 1) {
      return;
    }
  }
  __NMSG_WRITE(0xfc);
  __NMSG_WRITE(0xff);
  return;
}



/* Function: __GET_RTERRMSG */

/* Library Function - Single Match
    __GET_RTERRMSG
   
   Library: Visual Studio 2012 Release */

wchar_t * __cdecl __GET_RTERRMSG(int param_1)

{
  uint uVar1;
  
  uVar1 = 0;
  do {
    if (param_1 == (&DAT_0044f2c0)[uVar1 * 2]) {
      return *(wchar_t **)(&UNK_0044f2c4 + uVar1 * 8);
    }
    uVar1 = uVar1 + 1;
  } while (uVar1 < 0x17);
  return (wchar_t *)0x0;
}



/* Function: __NMSG_WRITE */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */
/* Library Function - Single Match
    __NMSG_WRITE
   
   Library: Visual Studio 2012 Release */

void __cdecl __NMSG_WRITE(int param_1)

{
  wchar_t *_Src;
  int iVar1;
  errno_t eVar2;
  DWORD DVar3;
  size_t sVar4;
  HANDLE hFile;
  uint uVar5;
  DWORD *lpNumberOfBytesWritten;
  LPOVERLAPPED lpOverlapped;
  DWORD local_200;
  char local_1fc [500];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  _Src = __GET_RTERRMSG(param_1);
  if (_Src != (wchar_t *)0x0) {
    iVar1 = __set_error_mode(3);
    if ((iVar1 == 1) || ((iVar1 = __set_error_mode(3), iVar1 == 0 && (DAT_00456fd8 == 1)))) {
      hFile = GetStdHandle(0xfffffff4);
      if ((hFile != (HANDLE)0x0) && (hFile != (HANDLE)0xffffffff)) {
        uVar5 = 0;
        do {
          local_1fc[uVar5] = (char)_Src[uVar5];
          if (_Src[uVar5] == L'\0') break;
          uVar5 = uVar5 + 1;
        } while (uVar5 < 500);
        lpOverlapped = (LPOVERLAPPED)0x0;
        lpNumberOfBytesWritten = &local_200;
        local_1fc[499] = 0;
        sVar4 = _strlen(local_1fc);
        WriteFile(hFile,local_1fc,sVar4,lpNumberOfBytesWritten,lpOverlapped);
      }
    }
    else if (param_1 != 0xfc) {
      eVar2 = _wcscpy_s((wchar_t *)&DAT_00456fe0,0x314,L"Runtime Error!\n\nProgram: ");
      if (eVar2 == 0) {
        _DAT_0045721a = 0;
        DVar3 = GetModuleFileNameW((HMODULE)0x0,(LPWSTR)&DAT_00457012,0x104);
        if ((DVar3 != 0) ||
           (eVar2 = _wcscpy_s((wchar_t *)&DAT_00457012,0x2fb,L"<program name unknown>"), eVar2 == 0)
           ) {
          sVar4 = _wcslen((wchar_t *)&DAT_00457012);
          if (0x3c < sVar4 + 1) {
            sVar4 = _wcslen((wchar_t *)&DAT_00457012);
            eVar2 = _wcsncpy_s((wchar_t *)((int)&DAT_00456f9c + sVar4 * 2),
                               0x2fb - ((int)(sVar4 * 2 + -0x76) >> 1),L"...",3);
            if (eVar2 != 0) goto LAB_00429b3d;
          }
          eVar2 = _wcscat_s((wchar_t *)&DAT_00456fe0,0x314,L"\n\n");
          if ((eVar2 == 0) && (eVar2 = _wcscat_s((wchar_t *)&DAT_00456fe0,0x314,_Src), eVar2 == 0))
          {
            ___crtMessageBoxW((LPCWSTR)&DAT_00456fe0,L"Microsoft Visual C++ Runtime Library",0x12010
                             );
            goto LAB_00429b2f;
          }
        }
      }
LAB_00429b3d:
                    /* WARNING: Subroutine does not return */
      __invoke_watson((wchar_t *)0x0,(wchar_t *)0x0,(wchar_t *)0x0,0,0);
    }
  }
LAB_00429b2f:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00429b48 */

bool FUN_00429b48(void)

{
  DAT_00457608 = GetProcessHeap();
  return DAT_00457608 != (HANDLE)0x0;
}



/* Function: FUN_00429b5d */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

undefined4 FUN_00429b5d(void)

{
  uint uVar1;
  byte bVar2;
  undefined4 uVar3;
  DWORD DVar4;
  HANDLE pvVar5;
  int iVar6;
  int iVar7;
  int *piVar8;
  _STARTUPINFOW local_78;
  int local_34;
  uint local_30;
  byte *local_2c;
  int *local_28;
  byte *local_24;
  int local_20;
  undefined1 local_14 [8];
  undefined4 uStack_c;
  undefined *local_8;
  
  local_8 = &DAT_00454100;
  uStack_c = 0x429b69;
  __lock(0xb);
  iVar7 = 0;
  local_8 = (undefined *)0x0;
  local_28 = (int *)__calloc_crt(0x20,0x40);
  if (local_28 == (int *)0x0) {
    __local_unwind4(&DAT_004560d0,(int)local_14,0xfffffffe);
    uVar3 = 0xffffffff;
  }
  else {
    DAT_00459054 = 0x20;
    DAT_00457610 = local_28;
    for (; local_28 < DAT_00457610 + 0x200; local_28 = local_28 + 0x10) {
      *(undefined2 *)(local_28 + 1) = 0xa00;
      *local_28 = -1;
      local_28[2] = 0;
      *(byte *)(local_28 + 9) = *(byte *)(local_28 + 9) & 0x80;
      *(byte *)(local_28 + 9) = *(byte *)(local_28 + 9) & 0x7f;
      *(undefined2 *)((int)local_28 + 0x25) = 0xa0a;
      local_28[0xe] = 0;
      *(undefined1 *)(local_28 + 0xd) = 0;
    }
    GetStartupInfoW(&local_78);
    if ((local_78.cbReserved2 != 0) && ((int *)local_78.lpReserved2 != (int *)0x0)) {
      local_20 = *(int *)local_78.lpReserved2;
      local_2c = (byte *)((int)local_78.lpReserved2 + 4);
      local_24 = local_2c + local_20;
      if (0x7ff < local_20) {
        local_20 = 0x800;
      }
      local_34 = 1;
      while (iVar6 = local_34, DAT_00459054 < local_20) {
        local_28 = (int *)__calloc_crt(0x20,0x40);
        if (local_28 == (int *)0x0) {
          local_20 = DAT_00459054;
          break;
        }
        (&DAT_00457610)[iVar6] = local_28;
        DAT_00459054 = DAT_00459054 + 0x20;
        for (; local_28 < (int *)((int)(&DAT_00457610)[iVar6] + 0x800); local_28 = local_28 + 0x10)
        {
          *(undefined2 *)(local_28 + 1) = 0xa00;
          *local_28 = -1;
          local_28[2] = 0;
          *(byte *)(local_28 + 9) = *(byte *)(local_28 + 9) & 0x80;
          *(undefined2 *)((int)local_28 + 0x25) = 0xa0a;
          local_28[0xe] = 0;
          *(undefined1 *)(local_28 + 0xd) = 0;
        }
        local_34 = iVar6 + 1;
      }
      local_30 = 0;
      iVar6 = local_20;
      while (uVar1 = local_30, (int)local_30 < iVar6) {
        pvVar5 = *(HANDLE *)local_24;
        if ((((pvVar5 != (HANDLE)0xffffffff) && (pvVar5 != (HANDLE)0xfffffffe)) &&
            ((*local_2c & 1) != 0)) &&
           (((*local_2c & 8) != 0 || (DVar4 = GetFileType(pvVar5), iVar6 = local_20, DVar4 != 0))))
        {
          piVar8 = (int *)((uVar1 & 0x1f) * 0x40 + (int)(&DAT_00457610)[(int)uVar1 >> 5]);
          *piVar8 = *(int *)local_24;
          *(byte *)(piVar8 + 1) = *local_2c;
          local_28 = piVar8;
          InitializeCriticalSectionAndSpinCount((LPCRITICAL_SECTION)(piVar8 + 3),4000);
          piVar8[2] = piVar8[2] + 1;
          iVar6 = local_20;
        }
        local_2c = local_2c + 1;
        local_24 = local_24 + 4;
        local_30 = uVar1 + 1;
      }
    }
    for (; local_30 = iVar7, iVar7 < 3; iVar7 = iVar7 + 1) {
      piVar8 = DAT_00457610 + iVar7 * 0x10;
      local_28 = piVar8;
      if ((*piVar8 == -1) || (*piVar8 == -2)) {
        *(undefined1 *)(piVar8 + 1) = 0x81;
        if (iVar7 == 0) {
          DVar4 = 0xfffffff6;
        }
        else {
          DVar4 = 0xfffffff5 - (iVar7 != 1);
        }
        pvVar5 = GetStdHandle(DVar4);
        if (((pvVar5 == (HANDLE)0xffffffff) || (pvVar5 == (HANDLE)0x0)) ||
           (DVar4 = GetFileType(pvVar5), DVar4 == 0)) {
          *(byte *)(piVar8 + 1) = *(byte *)(piVar8 + 1) | 0x40;
          *piVar8 = -2;
          if (DAT_00457fa0 != 0) {
            *(undefined4 *)(*(int *)(DAT_00457fa0 + iVar7 * 4) + 0x10) = 0xfffffffe;
          }
        }
        else {
          *piVar8 = (int)pvVar5;
          if ((DVar4 & 0xff) == 2) {
            bVar2 = *(byte *)(piVar8 + 1) | 0x40;
LAB_00429daf:
            *(byte *)(piVar8 + 1) = bVar2;
          }
          else if ((DVar4 & 0xff) == 3) {
            bVar2 = *(byte *)(piVar8 + 1) | 8;
            goto LAB_00429daf;
          }
          InitializeCriticalSectionAndSpinCount((LPCRITICAL_SECTION)(piVar8 + 3),4000);
          piVar8[2] = piVar8[2] + 1;
        }
      }
      else {
        *(byte *)(piVar8 + 1) = *(byte *)(piVar8 + 1) | 0x80;
      }
    }
    local_8 = (undefined *)0xfffffffe;
    FUN_00429e02();
    uVar3 = 0;
  }
  return uVar3;
}



/* Function: FUN_00429e02 */

void FUN_00429e02(void)

{
  FUN_0042c0f6(0xb);
  return;
}



/* Function: __wsetargv */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */
/* Library Function - Single Match
    __wsetargv
   
   Library: Visual Studio 2012 Release */

int __cdecl __wsetargv(void)

{
  uint _Size;
  uint uVar1;
  undefined4 *puVar2;
  short *psVar3;
  uint local_c;
  uint local_8;
  
  _DAT_00457918 = 0;
  GetModuleFileNameW((HMODULE)0x0,(LPWSTR)&DAT_00457710,0x104);
  _DAT_00456fd4 = &DAT_00457710;
  if ((DAT_00459070 == (short *)0x0) || (psVar3 = DAT_00459070, *DAT_00459070 == 0)) {
    psVar3 = (short *)&DAT_00457710;
  }
  wparse_cmdline(psVar3,(undefined4 *)0x0,(short *)0x0,(int *)&local_8,(int *)&local_c);
  uVar1 = local_8;
  if ((((local_8 < 0x3fffffff) && (local_c < 0x7fffffff)) &&
      (_Size = (local_c + local_8 * 2) * 2, local_c * 2 <= _Size)) &&
     (puVar2 = (undefined4 *)__malloc_crt(_Size), puVar2 != (undefined4 *)0x0)) {
    wparse_cmdline(psVar3,puVar2,(short *)(puVar2 + uVar1),(int *)&local_8,(int *)&local_c);
    _DAT_00456fbc = local_8 - 1;
    _DAT_00456fc4 = puVar2;
    return 0;
  }
  return -1;
}



/* Function: wparse_cmdline */

/* Library Function - Single Match
    _wparse_cmdline
   
   Library: Visual Studio 2012 Release */

void __cdecl
wparse_cmdline(short *param_1,undefined4 *param_2,short *param_3,int *param_4,int *param_5)

{
  bool bVar1;
  bool bVar2;
  short sVar3;
  uint uVar4;
  
  bVar1 = false;
  *param_5 = 0;
  *param_4 = 1;
  if (param_2 != (undefined4 *)0x0) {
    *param_2 = param_3;
    param_2 = param_2 + 1;
  }
  do {
    if (*param_1 == 0x22) {
      bVar1 = !bVar1;
      sVar3 = 0x22;
    }
    else {
      *param_5 = *param_5 + 1;
      if (param_3 != (short *)0x0) {
        *param_3 = *param_1;
        param_3 = param_3 + 1;
      }
      sVar3 = *param_1;
      if (sVar3 == 0) goto LAB_00429f44;
    }
    param_1 = param_1 + 1;
  } while ((bVar1) || ((sVar3 != 0x20 && (sVar3 != 9))));
  if (param_3 != (short *)0x0) {
    param_3[-1] = 0;
  }
LAB_00429f44:
  bVar1 = false;
  while (*param_1 != 0) {
    for (; (*param_1 == 0x20 || (*param_1 == 9)); param_1 = param_1 + 1) {
    }
    if (*param_1 == 0) break;
    if (param_2 != (undefined4 *)0x0) {
      *param_2 = param_3;
      param_2 = param_2 + 1;
    }
    *param_4 = *param_4 + 1;
    while( true ) {
      uVar4 = 0;
      bVar2 = true;
      for (; *param_1 == 0x5c; param_1 = param_1 + 1) {
        uVar4 = uVar4 + 1;
      }
      if (*param_1 == 0x22) {
        if ((uVar4 & 1) == 0) {
          if ((bVar1) && (param_1[1] == 0x22)) {
            param_1 = param_1 + 1;
          }
          else {
            bVar2 = false;
            bVar1 = !bVar1;
          }
        }
        uVar4 = uVar4 >> 1;
      }
      while (uVar4 != 0) {
        uVar4 = uVar4 - 1;
        if (param_3 != (short *)0x0) {
          *param_3 = 0x5c;
          param_3 = param_3 + 1;
        }
        *param_5 = *param_5 + 1;
      }
      sVar3 = *param_1;
      if ((sVar3 == 0) || ((!bVar1 && ((sVar3 == 0x20 || (sVar3 == 9)))))) break;
      if (bVar2) {
        if (param_3 != (short *)0x0) {
          *param_3 = sVar3;
          param_3 = param_3 + 1;
        }
        *param_5 = *param_5 + 1;
      }
      param_1 = param_1 + 1;
    }
    if (param_3 != (short *)0x0) {
      *param_3 = 0;
      param_3 = param_3 + 1;
    }
    *param_5 = *param_5 + 1;
  }
  if (param_2 != (undefined4 *)0x0) {
    *param_2 = 0;
  }
  *param_4 = *param_4 + 1;
  return;
}



/* Function: __wsetenvp */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */
/* Library Function - Single Match
    __wsetenvp
   
   Library: Visual Studio 2012 Release */

int __cdecl __wsetenvp(void)

{
  wchar_t wVar1;
  size_t sVar2;
  wchar_t *_Dst;
  errno_t eVar3;
  wchar_t *pwVar4;
  int iVar5;
  undefined4 *puVar6;
  
  iVar5 = 0;
  pwVar4 = DAT_00456f9c;
  if (DAT_00456f9c != (wchar_t *)0x0) {
    for (; *pwVar4 != L'\0'; pwVar4 = pwVar4 + sVar2 + 1) {
      if (*pwVar4 != L'=') {
        iVar5 = iVar5 + 1;
      }
      sVar2 = _wcslen(pwVar4);
    }
    DAT_00456fcc = (undefined4 *)__calloc_crt(iVar5 + 1,4);
    if (DAT_00456fcc != (undefined4 *)0x0) {
      wVar1 = *DAT_00456f9c;
      puVar6 = DAT_00456fcc;
      pwVar4 = DAT_00456f9c;
      do {
        if (wVar1 == L'\0') {
          FID_conflict__free(DAT_00456f9c);
          DAT_00456f9c = (wchar_t *)0x0;
          *puVar6 = 0;
          _DAT_0045906c = 1;
          return 0;
        }
        sVar2 = _wcslen(pwVar4);
        sVar2 = sVar2 + 1;
        if (*pwVar4 != L'=') {
          _Dst = (wchar_t *)__calloc_crt(sVar2,2);
          *puVar6 = _Dst;
          if (_Dst == (wchar_t *)0x0) {
            FID_conflict__free(DAT_00456fcc);
            DAT_00456fcc = (undefined4 *)0x0;
            return -1;
          }
          eVar3 = _wcscpy_s(_Dst,sVar2,pwVar4);
          if (eVar3 != 0) {
                    /* WARNING: Subroutine does not return */
            __invoke_watson((wchar_t *)0x0,(wchar_t *)0x0,(wchar_t *)0x0,0,0);
          }
          puVar6 = puVar6 + 1;
        }
        pwVar4 = pwVar4 + sVar2;
        wVar1 = *pwVar4;
      } while( true );
    }
  }
  return -1;
}



/* Function: FUN_0042a126 */

void __cdecl FUN_0042a126(undefined4 param_1)

{
  DAT_00456fd8 = param_1;
  return;
}



/* Function: __set_error_mode */

/* Library Function - Single Match
    __set_error_mode
   
   Library: Visual Studio 2012 Release */

int __cdecl __set_error_mode(int _Mode)

{
  int iVar1;
  int *piVar2;
  
  iVar1 = DAT_0045791c;
  if (_Mode < 0) {
LAB_0042a15e:
    piVar2 = __errno();
    *piVar2 = 0x16;
    FUN_0042acd7();
    return -1;
  }
  if (_Mode < 3) {
    DAT_0045791c = _Mode;
  }
  else if (_Mode != 3) goto LAB_0042a15e;
  return iVar1;
}



/* Function: ___security_init_cookie */

/* Library Function - Single Match
    ___security_init_cookie
   
   Library: Visual Studio 2012 Release */

void __cdecl ___security_init_cookie(void)

{
  DWORD DVar1;
  LARGE_INTEGER local_18;
  _FILETIME local_10;
  uint local_8;
  
  local_10.dwLowDateTime = 0;
  local_10.dwHighDateTime = 0;
  if ((DAT_004560d0 == 0xbb40e64e) || ((DAT_004560d0 & 0xffff0000) == 0)) {
    GetSystemTimeAsFileTime(&local_10);
    local_8 = local_10.dwHighDateTime ^ local_10.dwLowDateTime;
    DVar1 = GetCurrentThreadId();
    local_8 = local_8 ^ DVar1;
    DVar1 = GetCurrentProcessId();
    local_8 = local_8 ^ DVar1;
    QueryPerformanceCounter(&local_18);
    DAT_004560d0 = local_18.s.HighPart ^ local_18.s.LowPart ^ local_8 ^ (uint)&local_8;
    if (DAT_004560d0 == 0xbb40e64e) {
      DAT_004560d0 = 0xbb40e64f;
    }
    else if ((DAT_004560d0 & 0xffff0000) == 0) {
      DAT_004560d0 = DAT_004560d0 | (DAT_004560d0 | 0x4711) << 0x10;
    }
    DAT_004560d4 = ~DAT_004560d0;
  }
  else {
    DAT_004560d4 = ~DAT_004560d0;
  }
  return;
}



/* Function: FUN_0042a20d */

void FUN_0042a20d(void)

{
  undefined4 *puVar1;
  
  for (puVar1 = &DAT_00454010; puVar1 < &DAT_00454010; puVar1 = puVar1 + 1) {
    if ((code *)*puVar1 != (code *)0x0) {
      (*(code *)*puVar1)();
    }
  }
  return;
}



/* Function: ___crtGetEnvironmentStringsW */

/* Library Function - Single Match
    ___crtGetEnvironmentStringsW
   
   Library: Visual Studio 2012 Release */

LPVOID __cdecl ___crtGetEnvironmentStringsW(void)

{
  WCHAR WVar1;
  LPWCH pWVar2;
  LPWCH pWVar3;
  LPWCH pWVar4;
  WCHAR *pWVar5;
  size_t _Size;
  WCHAR *pWVar6;
  
  pWVar2 = GetEnvironmentStringsW();
  pWVar4 = pWVar2;
  if (pWVar2 != (LPWCH)0x0) {
    WVar1 = *pWVar2;
    pWVar5 = pWVar2;
    while (WVar1 != L'\0') {
      do {
        pWVar6 = pWVar5;
        pWVar5 = pWVar6 + 1;
      } while (*pWVar5 != L'\0');
      pWVar5 = pWVar6 + 2;
      WVar1 = *pWVar5;
    }
    _Size = (int)pWVar5 + (2 - (int)pWVar2);
    pWVar3 = (LPWCH)__malloc_crt(_Size);
    pWVar4 = (LPWCH)0x0;
    if (pWVar3 != (LPWCH)0x0) {
      FUN_004270c0((undefined8 *)pWVar3,(undefined8 *)pWVar2,_Size);
      pWVar4 = pWVar3;
    }
    FreeEnvironmentStringsW(pWVar2);
  }
  return pWVar4;
}



/* Function: FUN_0042a2a8 */

void __cdecl FUN_0042a2a8(undefined4 param_1)

{
  if ((code *)(DAT_00458fe0 ^ DAT_004560d0) != (code *)0x0) {
    (*(code *)(DAT_00458fe0 ^ DAT_004560d0))(param_1);
    return;
  }
                    /* WARNING: Could not recover jumptable at 0x0042a2c0. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  TlsAlloc();
  return;
}



/* Function: FUN_0042a2c6 */

void __cdecl FUN_0042a2c6(DWORD param_1)

{
  if ((code *)(DAT_00458fe4 ^ DAT_004560d0) != (code *)0x0) {
    (*(code *)(DAT_00458fe4 ^ DAT_004560d0))();
    return;
  }
  TlsFree(param_1);
  return;
}



/* Function: FUN_0042a2e5 */

void __cdecl FUN_0042a2e5(DWORD param_1)

{
  if ((code *)(DAT_00458fe8 ^ DAT_004560d0) != (code *)0x0) {
    (*(code *)(DAT_00458fe8 ^ DAT_004560d0))();
    return;
  }
  TlsGetValue(param_1);
  return;
}



/* Function: FUN_0042a304 */

void __cdecl FUN_0042a304(DWORD param_1,LPVOID param_2)

{
  if ((code *)(DAT_00458fec ^ DAT_004560d0) != (code *)0x0) {
    (*(code *)(DAT_00458fec ^ DAT_004560d0))();
    return;
  }
  TlsSetValue(param_1,param_2);
  return;
}



/* Function: ___crtGetShowWindowMode */

/* Library Function - Single Match
    ___crtGetShowWindowMode
   
   Library: Visual Studio 2012 Release */

WORD __cdecl ___crtGetShowWindowMode(void)

{
  _STARTUPINFOW local_48;
  
  GetStartupInfoW(&local_48);
  if (((byte)local_48.dwFlags & 1) != 0) {
    return local_48.wShowWindow;
  }
  return 10;
}



/* Function: FUN_0042a347 */

bool FUN_0042a347(void)

{
  int iVar1;
  int iVar2;
  undefined4 local_8;
  
  iVar1 = DAT_00456178;
  if (DAT_00456178 < 0) {
    local_8 = 0;
    iVar1 = 0;
    if (((code *)(DAT_00459050 ^ DAT_004560d0) != (code *)0x0) &&
       (iVar2 = (*(code *)(DAT_00459050 ^ DAT_004560d0))(&local_8,0), iVar2 == 0x7a)) {
      iVar1 = 1;
    }
  }
  DAT_00456178 = iVar1;
  return 0 < DAT_00456178;
}



/* Function: FUN_0042a385 */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void FUN_0042a385(void)

{
  HMODULE hModule;
  FARPROC pFVar1;
  
  hModule = GetModuleHandleW(L"kernel32.dll");
  pFVar1 = GetProcAddress(hModule,"FlsAlloc");
  DAT_00458fe0 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"FlsFree");
  DAT_00458fe4 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"FlsGetValue");
  DAT_00458fe8 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"FlsSetValue");
  DAT_00458fec = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"InitializeCriticalSectionEx");
  _DAT_00458ff0 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"CreateSemaphoreExW");
  _DAT_00458ff4 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"SetThreadStackGuarantee");
  _DAT_00458ff8 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"CreateThreadpoolTimer");
  _DAT_00458ffc = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"SetThreadpoolTimer");
  _DAT_00459000 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"WaitForThreadpoolTimerCallbacks");
  _DAT_00459004 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"CloseThreadpoolTimer");
  _DAT_00459008 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"CreateThreadpoolWait");
  _DAT_0045900c = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"SetThreadpoolWait");
  _DAT_00459010 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"CloseThreadpoolWait");
  _DAT_00459014 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"FlushProcessWriteBuffers");
  _DAT_00459018 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"FreeLibraryWhenCallbackReturns");
  _DAT_0045901c = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"GetCurrentProcessorNumber");
  _DAT_00459020 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"GetLogicalProcessorInformation");
  _DAT_00459024 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"CreateSymbolicLinkW");
  _DAT_00459028 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"SetDefaultDllDirectories");
  _DAT_0045902c = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"EnumSystemLocalesEx");
  _DAT_00459034 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"CompareStringEx");
  _DAT_00459030 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"GetDateFormatEx");
  _DAT_00459038 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"GetLocaleInfoEx");
  _DAT_0045903c = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"GetTimeFormatEx");
  _DAT_00459040 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"GetUserDefaultLocaleName");
  _DAT_00459044 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"IsValidLocaleName");
  _DAT_00459048 = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"LCMapStringEx");
  DAT_0045904c = (uint)pFVar1 ^ DAT_004560d0;
  pFVar1 = GetProcAddress(hModule,"GetCurrentPackageId");
  DAT_00459050 = (uint)pFVar1 ^ DAT_004560d0;
  return;
}



/* Function: FUN_0042a5c4 */

void __cdecl FUN_0042a5c4(LPTOP_LEVEL_EXCEPTION_FILTER param_1)

{
  SetUnhandledExceptionFilter(param_1);
  return;
}



/* Function: ___crtTerminateProcess */

/* Library Function - Single Match
    ___crtTerminateProcess
   
   Library: Visual Studio 2012 Release */

void __cdecl ___crtTerminateProcess(UINT uExitCode)

{
  HANDLE hProcess;
  
  hProcess = GetCurrentProcess();
  TerminateProcess(hProcess,uExitCode);
  return;
}



/* Function: ___crtUnhandledException */

/* Library Function - Single Match
    ___crtUnhandledException
   
   Library: Visual Studio 2012 Release */

LONG __cdecl ___crtUnhandledException(EXCEPTION_POINTERS *exceptionInfo)

{
  LONG LVar1;
  
  SetUnhandledExceptionFilter((LPTOP_LEVEL_EXCEPTION_FILTER)0x0);
  LVar1 = UnhandledExceptionFilter(exceptionInfo);
  return LVar1;
}



/* Function: __wwincmdln */

/* Library Function - Single Match
    __wwincmdln
   
   Library: Visual Studio 2012 Release */

ushort * __wwincmdln(void)

{
  ushort uVar1;
  bool bVar2;
  ushort *puVar3;
  
  bVar2 = false;
  puVar3 = DAT_00459070;
  if (DAT_00459070 == (ushort *)0x0) {
    puVar3 = &DAT_0043b580;
  }
  do {
    uVar1 = *puVar3;
    if (uVar1 < 0x21) {
      if (uVar1 == 0) {
        return puVar3;
      }
      if (!bVar2) {
        for (; (*puVar3 != 0 && (*puVar3 < 0x21)); puVar3 = puVar3 + 1) {
        }
        return puVar3;
      }
    }
    if (uVar1 == 0x22) {
      bVar2 = !bVar2;
    }
    puVar3 = puVar3 + 1;
  } while( true );
}



/* Function: __SEH_prolog4 */

/* WARNING: This is an inlined function */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Variable defined which should be unmapped: param_2 */
/* Library Function - Single Match
    __SEH_prolog4
   
   Library: Visual Studio */

void __cdecl __SEH_prolog4(undefined4 param_1,int param_2)

{
  int iVar1;
  undefined4 unaff_EBX;
  undefined4 unaff_ESI;
  undefined4 unaff_EDI;
  undefined4 unaff_retaddr;
  uint auStack_1c [5];
  undefined1 local_8 [8];
  
  iVar1 = -param_2;
  *(undefined4 *)((int)auStack_1c + iVar1 + 0x10) = unaff_EBX;
  *(undefined4 *)((int)auStack_1c + iVar1 + 0xc) = unaff_ESI;
  *(undefined4 *)((int)auStack_1c + iVar1 + 8) = unaff_EDI;
  *(uint *)((int)auStack_1c + iVar1 + 4) = DAT_004560d0 ^ (uint)&param_2;
  *(undefined4 *)((int)auStack_1c + iVar1) = unaff_retaddr;
  ExceptionList = local_8;
  return;
}



/* Function: __SEH_epilog4 */

/* WARNING: This is an inlined function */
/* Library Function - Single Match
    __SEH_epilog4
   
   Library: Visual Studio */

void __SEH_epilog4(void)

{
  undefined4 *unaff_EBP;
  undefined4 unaff_retaddr;
  
  ExceptionList = (void *)unaff_EBP[-4];
  *unaff_EBP = unaff_retaddr;
  return;
}



/* Function: __except_handler4 */

/* Library Function - Single Match
    __except_handler4
   
   Library: Visual Studio 2012 Release */

undefined4 __cdecl __except_handler4(PEXCEPTION_RECORD param_1,PVOID param_2,undefined4 param_3)

{
  int iVar1;
  uint uVar2;
  code *pcVar3;
  int iVar4;
  BOOL BVar5;
  undefined4 uVar6;
  int *piVar7;
  PEXCEPTION_RECORD local_1c;
  undefined4 local_18;
  int *local_14;
  undefined4 local_10;
  uint local_c;
  char local_5;
  
  piVar7 = (int *)(*(uint *)((int)param_2 + 8) ^ DAT_004560d0);
  local_5 = '\0';
  local_10 = 1;
  iVar1 = (int)param_2 + 0x10;
  if (*piVar7 != -2) {
    __security_check_cookie(piVar7[1] + iVar1 ^ *(uint *)(*piVar7 + iVar1));
  }
  __security_check_cookie(piVar7[3] + iVar1 ^ *(uint *)(piVar7[2] + iVar1));
  if ((param_1->ExceptionFlags & 0x66) == 0) {
    local_1c = param_1;
    local_18 = param_3;
    *(PEXCEPTION_RECORD **)((int)param_2 + -4) = &local_1c;
    local_c = *(uint *)((int)param_2 + 0xc);
    if (*(uint *)((int)param_2 + 0xc) == 0xfffffffe) {
      return local_10;
    }
    do {
      iVar4 = local_c * 3 + 4;
      uVar2 = piVar7[iVar4];
      local_14 = piVar7 + iVar4;
      if ((undefined *)piVar7[local_c * 3 + 5] != (undefined *)0x0) {
        iVar4 = _EH4_CallFilterFunc((undefined *)piVar7[local_c * 3 + 5]);
        local_5 = '\x01';
        if (iVar4 < 0) {
          local_10 = 0;
          goto LAB_0042a7ec;
        }
        if (0 < iVar4) {
          if (((param_1->ExceptionCode == 0xe06d7363) && (DAT_00458fc0 != (code *)0x0)) &&
             (BVar5 = __IsNonwritableInCurrentImage((PBYTE)&DAT_00458fc0), BVar5 != 0)) {
            (*DAT_00458fc0)(param_1,1);
          }
          _EH4_GlobalUnwind2(param_2,param_1);
          if (*(uint *)((int)param_2 + 0xc) != local_c) {
            _EH4_LocalUnwind((int)param_2,local_c,iVar1,&DAT_004560d0);
          }
          *(uint *)((int)param_2 + 0xc) = uVar2;
          if (*piVar7 != -2) {
            __security_check_cookie(piVar7[1] + iVar1 ^ *(uint *)(*piVar7 + iVar1));
          }
          __security_check_cookie(piVar7[3] + iVar1 ^ *(uint *)(piVar7[2] + iVar1));
          _EH4_TransferToHandler((undefined *)local_14[2]);
          pcVar3 = (code *)swi(3);
          uVar6 = (*pcVar3)();
          return uVar6;
        }
      }
      local_c = uVar2;
    } while (uVar2 != 0xfffffffe);
    if (local_5 == '\0') {
      return local_10;
    }
  }
  else {
    if (*(int *)((int)param_2 + 0xc) == -2) {
      return local_10;
    }
    _EH4_LocalUnwind((int)param_2,0xfffffffe,iVar1,&DAT_004560d0);
  }
LAB_0042a7ec:
  if (*piVar7 != -2) {
    __security_check_cookie(piVar7[1] + iVar1 ^ *(uint *)(*piVar7 + iVar1));
  }
  __security_check_cookie(piVar7[3] + iVar1 ^ *(uint *)(piVar7[2] + iVar1));
  return local_10;
}



/* Function: ___raise_securityfailure */

/* Library Function - Single Match
    ___raise_securityfailure
   
   Library: Visual Studio 2012 Release */

void __cdecl ___raise_securityfailure(EXCEPTION_POINTERS *param_1)

{
  DAT_00457c3c = IsDebuggerPresent();
  FUN_0042d7e8();
  ___crtUnhandledException(param_1);
  if (DAT_00457c3c == 0) {
    FUN_0042d7e8();
  }
  ___crtTerminateProcess(0xc0000409);
  return;
}



/* Function: ___report_gsfailure */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */
/* Library Function - Single Match
    ___report_gsfailure
   
   Library: Visual Studio 2012 Release */

void __cdecl ___report_gsfailure(void)

{
  code *pcVar1;
  uint uVar2;
  undefined4 extraout_ECX;
  undefined4 extraout_ECX_00;
  undefined4 uVar3;
  undefined4 extraout_EDX;
  undefined4 unaff_EBX;
  undefined4 unaff_EBP;
  undefined4 unaff_ESI;
  undefined4 unaff_EDI;
  undefined2 in_ES;
  undefined2 in_CS;
  undefined2 in_SS;
  undefined2 in_DS;
  undefined2 in_FS;
  undefined2 in_GS;
  byte bVar4;
  byte bVar5;
  byte in_AF;
  byte bVar6;
  byte bVar7;
  byte in_TF;
  byte in_IF;
  byte bVar8;
  byte in_NT;
  byte in_AC;
  byte in_VIF;
  byte in_VIP;
  byte in_ID;
  undefined8 uVar9;
  undefined4 unaff_retaddr;
  
  uVar2 = IsProcessorFeaturePresent(0x17);
  uVar9 = CONCAT44(extraout_EDX,uVar2);
  bVar4 = 0;
  bVar8 = 0;
  bVar7 = (int)uVar2 < 0;
  bVar6 = uVar2 == 0;
  bVar5 = (POPCOUNT(uVar2 & 0xff) & 1U) == 0;
  uVar3 = extraout_ECX;
  if (!(bool)bVar6) {
    pcVar1 = (code *)swi(0x29);
    uVar9 = (*pcVar1)();
    uVar3 = extraout_ECX_00;
  }
  _DAT_00457a18 = (undefined4)((ulonglong)uVar9 >> 0x20);
  _DAT_00457a20 = (undefined4)uVar9;
  _DAT_00457a30 =
       (uint)(in_NT & 1) * 0x4000 | (uint)(bVar8 & 1) * 0x800 | (uint)(in_IF & 1) * 0x200 |
       (uint)(in_TF & 1) * 0x100 | (uint)(bVar7 & 1) * 0x80 | (uint)(bVar6 & 1) * 0x40 |
       (uint)(in_AF & 1) * 0x10 | (uint)(bVar5 & 1) * 4 | (uint)(bVar4 & 1) |
       (uint)(in_ID & 1) * 0x200000 | (uint)(in_VIP & 1) * 0x100000 | (uint)(in_VIF & 1) * 0x80000 |
       (uint)(in_AC & 1) * 0x40000;
  _DAT_00457a34 = &stack0x00000004;
  _DAT_00457970 = 0x10001;
  _DAT_00457920 = 0xc0000409;
  _DAT_00457924 = 1;
  _DAT_00457930 = 1;
  DAT_00457934 = 2;
  _DAT_0045792c = unaff_retaddr;
  _DAT_004579fc = in_GS;
  _DAT_00457a00 = in_FS;
  _DAT_00457a04 = in_ES;
  _DAT_00457a08 = in_DS;
  _DAT_00457a0c = unaff_EDI;
  _DAT_00457a10 = unaff_ESI;
  _DAT_00457a14 = unaff_EBX;
  _DAT_00457a1c = uVar3;
  _DAT_00457a24 = unaff_EBP;
  DAT_00457a28 = unaff_retaddr;
  _DAT_00457a2c = in_CS;
  _DAT_00457a38 = in_SS;
  ___raise_securityfailure((EXCEPTION_POINTERS *)&PTR_DAT_0044f718);
  return;
}



/* Function: ___isa_available_init */

/* WARNING: Removing unreachable block (ram,0x0042ab2d) */
/* WARNING: Removing unreachable block (ram,0x0042aafd) */
/* WARNING: Removing unreachable block (ram,0x0042aa73) */
/* WARNING: Removing unreachable block (ram,0x0042aad1) */
/* Library Function - Single Match
    ___isa_available_init
   
   Library: Visual Studio 2012 Release */

undefined4 ___isa_available_init(void)

{
  int iVar1;
  uint *puVar2;
  BOOL BVar3;
  uint uVar4;
  
  DAT_00457c40 = 0;
  DAT_00456180 = DAT_00456180 | 1;
  BVar3 = IsProcessorFeaturePresent(10);
  if (BVar3 != 0) {
    DAT_00457c40 = 1;
    iVar1 = cpuid_Version_info(1);
    uVar4 = DAT_00456180 | 2;
    if ((*(uint *)(iVar1 + 0xc) & 0x100000) != 0) {
      uVar4 = DAT_00456180 | 6;
      DAT_00457c40 = 2;
    }
    DAT_00456180 = uVar4;
    if ((*(uint *)(iVar1 + 0xc) & 0x10000000) != 0) {
      DAT_00456180 = uVar4 | 8;
      DAT_00457c40 = 3;
    }
    iVar1 = cpuid_Extended_Feature_Enumeration_info(7);
    if ((*(uint *)(iVar1 + 4) & 0x200) != 0) {
      DAT_00457c44 = DAT_00457c44 | 2;
    }
    iVar1 = cpuid_basic_info(0);
    if (((*(int *)(iVar1 + 4) == 0x756e6547) && (*(int *)(iVar1 + 8) == 0x49656e69)) &&
       (*(int *)(iVar1 + 0xc) == 0x6c65746e)) {
      puVar2 = (uint *)cpuid_Version_info(1);
      uVar4 = *puVar2 & 0xfff3ff0;
      if ((((uVar4 == 0x106c0) || (uVar4 == 0x20660)) ||
          ((uVar4 == 0x20670 || ((uVar4 == 0x30650 || (uVar4 == 0x30660)))))) || (uVar4 == 0x30670))
      {
        DAT_00457c44 = DAT_00457c44 | 1;
      }
    }
  }
  return 0;
}



/* Function: __call_reportfault */

/* Library Function - Single Match
    __call_reportfault
   
   Library: Visual Studio 2012 Release */

void __cdecl __call_reportfault(int nDbgHookCode,DWORD dwExceptionCode,DWORD dwExceptionFlags)

{
  uint uVar1;
  BOOL BVar2;
  LONG LVar3;
  EXCEPTION_POINTERS local_32c;
  EXCEPTION_RECORD local_324;
  undefined4 local_2d4;
  
  uVar1 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  if (nDbgHookCode != -1) {
    FUN_0042d7e8();
  }
  local_324.ExceptionCode = 0;
  FUN_004267c0(&local_324.ExceptionFlags,0,0x4c);
  local_32c.ExceptionRecord = &local_324;
  local_32c.ContextRecord = (PCONTEXT)&local_2d4;
  local_2d4 = 0x10001;
  local_324.ExceptionCode = dwExceptionCode;
  local_324.ExceptionFlags = dwExceptionFlags;
  BVar2 = IsDebuggerPresent();
  LVar3 = ___crtUnhandledException(&local_32c);
  if (((LVar3 == 0) && (BVar2 == 0)) && (nDbgHookCode != -1)) {
    FUN_0042d7e8();
  }
  __security_check_cookie(uVar1 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0042ac9f */

void __cdecl FUN_0042ac9f(undefined4 param_1)

{
  DAT_00457c48 = param_1;
  return;
}



/* Function: __invalid_parameter */

/* Library Function - Single Match
    __invalid_parameter
   
   Libraries: Visual Studio 2010 Release, Visual Studio 2012 Release */

void __invalid_parameter(wchar_t *param_1,wchar_t *param_2,wchar_t *param_3,uint param_4,
                        uintptr_t param_5)

{
  code *UNRECOVERED_JUMPTABLE;
  
  UNRECOVERED_JUMPTABLE = (code *)DecodePointer(DAT_00457c48);
  if (UNRECOVERED_JUMPTABLE != (code *)0x0) {
                    /* WARNING: Could not recover jumptable at 0x0042acc0. Too many branches */
                    /* WARNING: Treating indirect jump as call */
    (*UNRECOVERED_JUMPTABLE)();
    return;
  }
                    /* WARNING: Subroutine does not return */
  __invoke_watson(param_1,param_2,param_3,param_4,param_5);
}



/* Function: FUN_0042acd7 */

void FUN_0042acd7(void)

{
  __invalid_parameter((wchar_t *)0x0,(wchar_t *)0x0,(wchar_t *)0x0,0,0);
  return;
}



/* Function: __invoke_watson */

/* Library Function - Single Match
    __invoke_watson
   
   Library: Visual Studio 2012 Release */

void __cdecl
__invoke_watson(wchar_t *param_1,wchar_t *param_2,wchar_t *param_3,uint param_4,uintptr_t param_5)

{
  code *pcVar1;
  BOOL BVar2;
  
  BVar2 = IsProcessorFeaturePresent(0x17);
  if (BVar2 != 0) {
    pcVar1 = (code *)swi(0x29);
    (*pcVar1)();
  }
  __call_reportfault(2,0xc0000417,1);
  ___crtTerminateProcess(0xc0000417);
  return;
}



/* Function: ___doserrno */

/* Library Function - Single Match
    ___doserrno
   
   Library: Visual Studio 2012 Release */

ulong * __cdecl ___doserrno(void)

{
  _ptiddata p_Var1;
  
  p_Var1 = __getptd_noexit();
  if (p_Var1 == (_ptiddata)0x0) {
    return (ulong *)&DAT_004562f4;
  }
  return &p_Var1->_tdoserrno;
}



/* Function: FID_conflict:__dosmaperr */

/* Library Function - Multiple Matches With Different Base Names
    ___acrt_errno_map_os_error
    __dosmaperr
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release, Visual Studio 2017 Release,
   Visual Studio 2019 Release */

void __cdecl FID_conflict___dosmaperr(ulong param_1)

{
  ulong *puVar1;
  int iVar2;
  int *piVar3;
  
  puVar1 = ___doserrno();
  *puVar1 = param_1;
  iVar2 = __get_errno_from_oserr(param_1);
  piVar3 = __errno();
  *piVar3 = iVar2;
  return;
}



/* Function: __errno */

/* Library Function - Single Match
    __errno
   
   Library: Visual Studio 2012 Release */

int * __cdecl __errno(void)

{
  _ptiddata p_Var1;
  
  p_Var1 = __getptd_noexit();
  if (p_Var1 == (_ptiddata)0x0) {
    return (int *)&DAT_004562f0;
  }
  return &p_Var1->_terrno;
}



/* Function: __get_errno_from_oserr */

/* Library Function - Single Match
    __get_errno_from_oserr
   
   Library: Visual Studio 2012 Release */

int __cdecl __get_errno_from_oserr(ulong param_1)

{
  uint uVar1;
  
  uVar1 = 0;
  do {
    if (param_1 == (&DAT_00456188)[uVar1 * 2]) {
      return *(int *)(uVar1 * 8 + 0x45618c);
    }
    uVar1 = uVar1 + 1;
  } while (uVar1 < 0x2d);
  if (param_1 - 0x13 < 0x12) {
    return 0xd;
  }
  return (-(uint)(0xe < param_1 - 0xbc) & 0xe) + 8;
}



/* Function: FUN_0042ad9a */

uint __cdecl FUN_0042ad9a(byte param_1,FILE *param_2)

{
  uint uVar1;
  WCHAR *pWVar2;
  char *pcVar3;
  FILE *_File;
  byte bVar4;
  WCHAR *pWVar5;
  int *piVar6;
  undefined **ppuVar7;
  undefined3 extraout_var;
  undefined *puVar8;
  FILE *pFVar9;
  longlong lVar10;
  
  _File = param_2;
  pWVar5 = (WCHAR *)__fileno(param_2);
  uVar1 = _File->_flag;
  if ((uVar1 & 0x82) == 0) {
    piVar6 = __errno();
    *piVar6 = 9;
LAB_0042adbe:
    _File->_flag = _File->_flag | 0x20;
    return 0xffffffff;
  }
  if ((uVar1 & 0x40) != 0) {
    piVar6 = __errno();
    *piVar6 = 0x22;
    goto LAB_0042adbe;
  }
  pFVar9 = (FILE *)0x0;
  if ((uVar1 & 1) != 0) {
    _File->_cnt = 0;
    if ((uVar1 & 0x10) == 0) {
      _File->_flag = uVar1 | 0x20;
      return 0xffffffff;
    }
    _File->_ptr = _File->_base;
    _File->_flag = uVar1 & 0xfffffffe;
  }
  uVar1 = _File->_flag;
  _File->_flag = uVar1 & 0xffffffef | 2;
  _File->_cnt = 0;
  if (((uVar1 & 0x10c) == 0) &&
     (((ppuVar7 = FUN_0042d70c(), _File != (FILE *)(ppuVar7 + 8) &&
       (ppuVar7 = FUN_0042d70c(), _File != (FILE *)(ppuVar7 + 0x10))) ||
      (bVar4 = FUN_0042d814((uint)pWVar5), CONCAT31(extraout_var,bVar4) == 0)))) {
    __getbuf(_File);
  }
  if ((_File->_flag & 0x108U) == 0) {
    param_2 = (FILE *)0x1;
    pFVar9 = (FILE *)FUN_0042d868(pWVar5,(WCHAR *)&param_1,(WCHAR *)0x1);
  }
  else {
    pWVar2 = (WCHAR *)_File->_base;
    pcVar3 = _File->_ptr;
    _File->_ptr = (char *)((int)pWVar2 + 1);
    param_2 = (FILE *)(pcVar3 + -(int)pWVar2);
    _File->_cnt = _File->_bufsiz + -1;
    if ((int)param_2 < 1) {
      if ((pWVar5 == (WCHAR *)0xffffffff) || (pWVar5 == (WCHAR *)0xfffffffe)) {
        puVar8 = &DAT_00456138;
      }
      else {
        puVar8 = (undefined *)(((uint)pWVar5 & 0x1f) * 0x40 + (&DAT_00457610)[(int)pWVar5 >> 5]);
      }
      if (((puVar8[4] & 0x20) != 0) && (lVar10 = FUN_0042e174((uint)pWVar5,0,0,2), lVar10 == -1))
      goto LAB_0042aed5;
    }
    else {
      pFVar9 = (FILE *)FUN_0042d868(pWVar5,pWVar2,(WCHAR *)param_2);
    }
    *_File->_base = param_1;
  }
  if (pFVar9 == param_2) {
    return (uint)param_1;
  }
LAB_0042aed5:
  _File->_flag = _File->_flag | 0x20;
  return 0xffffffff;
}



/* Function: _LocaleUpdate */

/* Library Function - Single Match
    public: __thiscall _LocaleUpdate::_LocaleUpdate(struct localeinfo_struct *)
   
   Library: Visual Studio 2012 Release */

_LocaleUpdate * __thiscall
_LocaleUpdate::_LocaleUpdate(_LocaleUpdate *this,localeinfo_struct *param_1)

{
  uint uVar1;
  _ptiddata p_Var2;
  pthreadlocinfo ptVar3;
  pthreadmbcinfo ptVar4;
  
  this[0xc] = (_LocaleUpdate)0x0;
  if (param_1 == (localeinfo_struct *)0x0) {
    p_Var2 = __getptd();
    *(_ptiddata *)(this + 8) = p_Var2;
    *(pthreadlocinfo *)this = p_Var2->ptlocinfo;
    *(pthreadmbcinfo *)(this + 4) = p_Var2->ptmbcinfo;
    if ((*(undefined **)this != PTR_DAT_0045658c) && ((p_Var2->_ownlocale & DAT_00456e20) == 0)) {
      ptVar3 = ___updatetlocinfo();
      *(pthreadlocinfo *)this = ptVar3;
    }
    if ((*(undefined **)(this + 4) != PTR_DAT_00456650) &&
       ((*(uint *)(*(int *)(this + 8) + 0x70) & DAT_00456e20) == 0)) {
      ptVar4 = ___updatetmbcinfo();
      *(pthreadmbcinfo *)(this + 4) = ptVar4;
    }
    uVar1 = *(uint *)(*(int *)(this + 8) + 0x70);
    if ((uVar1 & 2) == 0) {
      *(uint *)(*(int *)(this + 8) + 0x70) = uVar1 | 2;
      this[0xc] = (_LocaleUpdate)0x1;
    }
  }
  else {
    *(pthreadlocinfo *)this = param_1->locinfo;
    *(pthreadmbcinfo *)(this + 4) = param_1->mbcinfo;
  }
  return this;
}



/* Function: FUN_0042af6f */

void __cdecl FUN_0042af6f(FILE *param_1,byte *param_2,localeinfo_struct *param_3,wchar_t *param_4)

{
  byte bVar1;
  wchar_t _WCh;
  short *psVar2;
  byte *pbVar3;
  uint uVar4;
  undefined3 extraout_var;
  int iVar5;
  code *pcVar6;
  size_t sVar7;
  errno_t eVar8;
  byte *pbVar9;
  int *piVar10;
  int extraout_ECX;
  undefined *puVar11;
  int iVar12;
  wchar_t *pwVar13;
  wchar_t *pwVar14;
  wchar_t *pwVar15;
  wchar_t *pwVar16;
  bool bVar17;
  longlong lVar18;
  undefined4 *puVar19;
  undefined4 uVar20;
  localeinfo_struct *plVar21;
  undefined4 local_284;
  undefined4 local_280;
  localeinfo_struct local_27c;
  int local_274;
  char local_270;
  wchar_t *local_268;
  undefined4 local_264;
  int local_260;
  wchar_t *local_25c;
  int *local_258;
  int local_254;
  undefined4 local_250;
  int local_24c;
  int local_248;
  size_t local_244;
  int local_240;
  int local_23c;
  int local_238;
  FILE *local_234;
  byte local_230;
  char local_22f;
  int local_22c;
  size_t local_228;
  int local_224;
  wchar_t *local_220;
  wchar_t *local_21c;
  byte local_215;
  byte *local_214;
  undefined1 local_210 [511];
  undefined2 local_11;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_234 = param_1;
  pwVar13 = (wchar_t *)0x0;
  local_214 = param_2;
  local_220 = param_4;
  local_254 = 0;
  local_21c = (wchar_t *)0x0;
  local_23c = 0;
  local_22c = 0;
  local_238 = 0;
  local_24c = 0;
  local_240 = 0;
  _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)&local_27c,param_3);
  local_258 = __errno();
  if (local_234 != (FILE *)0x0) {
    if ((local_234->_flag & 0x40) == 0) {
      uVar4 = __fileno(local_234);
      if ((uVar4 == 0xffffffff) || (uVar4 == 0xfffffffe)) {
        puVar11 = &DAT_00456138;
      }
      else {
        puVar11 = (undefined *)((uVar4 & 0x1f) * 0x40 + (&DAT_00457610)[(int)uVar4 >> 5]);
      }
      if ((puVar11[0x24] & 0x7f) == 0) {
        if ((uVar4 == 0xffffffff) || (uVar4 == 0xfffffffe)) {
          puVar11 = &DAT_00456138;
        }
        else {
          puVar11 = (undefined *)((uVar4 & 0x1f) * 0x40 + (&DAT_00457610)[(int)uVar4 >> 5]);
        }
        if ((puVar11[0x24] & 0x80) == 0) goto LAB_0042b05e;
      }
    }
    else {
LAB_0042b05e:
      if (param_2 != (byte *)0x0) {
        local_215 = *param_2;
        iVar12 = 0;
        local_224 = 0;
        local_228 = 0;
        local_248 = 0;
        local_25c = (wchar_t *)0x0;
        local_250 = CONCAT31(local_250._1_3_,local_215);
        pwVar16 = local_268;
        pbVar3 = local_214;
        while ((local_215 != 0 && (local_214 = pbVar3 + 1, -1 < iVar12))) {
          if ((byte)(local_215 - 0x20) < 0x59) {
            uVar4 = (int)*(char *)((int)&PTR_DAT_0044f718 + (int)(char)local_215) & 0xf;
          }
          else {
            uVar4 = 0;
          }
          local_248 = (int)(char)(&DAT_0044f738)[uVar4 * 8 + local_248] >> 4;
          pbVar9 = local_214;
          switch(local_248) {
          case 0:
LAB_0042b30a:
            local_240 = 0;
            iVar12 = __isleadbyte_l((uint)local_215,&local_27c);
            if (iVar12 != 0) {
              write_char((byte)local_250,local_234,&local_224);
              bVar1 = *local_214;
              local_214 = local_214 + 1;
              local_250 = CONCAT31(local_250._1_3_,bVar1);
              if (bVar1 == 0) goto LAB_0042bac0;
            }
            write_char((byte)local_250,local_234,&local_224);
            pbVar9 = local_214;
            iVar12 = local_224;
            break;
          case 1:
            local_22c = -1;
            pwVar13 = (wchar_t *)0x0;
            local_264 = 0;
            local_24c = 0;
            local_23c = 0;
            local_238 = 0;
            local_21c = (wchar_t *)0x0;
            local_240 = 0;
            break;
          case 2:
            if (local_215 == 0x20) {
              pwVar13 = (wchar_t *)((uint)pwVar13 | 2);
              local_21c = pwVar13;
            }
            else if (local_215 == 0x23) {
              pwVar13 = (wchar_t *)((uint)pwVar13 | 0x80);
              local_21c = pwVar13;
            }
            else if (local_215 == 0x2b) {
              pwVar13 = (wchar_t *)((uint)pwVar13 | 1);
              local_21c = pwVar13;
            }
            else if (local_215 == 0x2d) {
              pwVar13 = (wchar_t *)((uint)pwVar13 | 4);
              local_21c = pwVar13;
            }
            else if (local_215 == 0x30) {
              pwVar13 = (wchar_t *)((uint)pwVar13 | 8);
              local_21c = pwVar13;
            }
            break;
          case 3:
            if (local_215 == 0x2a) {
              local_23c = *(int *)local_220;
              local_220 = local_220 + 2;
              if (local_23c < 0) {
                pwVar13 = (wchar_t *)((uint)pwVar13 | 4);
                local_23c = -local_23c;
                local_21c = pwVar13;
              }
            }
            else {
              local_23c = local_23c * 10 + -0x30 + (int)(char)local_215;
            }
            break;
          case 4:
            local_22c = 0;
            break;
          case 5:
            if (local_215 == 0x2a) {
              local_22c = *(int *)local_220;
              local_220 = local_220 + 2;
              if (local_22c < 0) {
                local_22c = -1;
              }
            }
            else {
              local_22c = local_22c * 10 + -0x30 + (int)(char)local_215;
              iVar12 = local_224;
            }
            break;
          case 6:
            if (local_215 == 0x49) {
              bVar1 = *local_214;
              if ((bVar1 == 0x36) && (pbVar3[2] == 0x34)) {
                pwVar13 = (wchar_t *)((uint)pwVar13 | 0x8000);
                pbVar9 = pbVar3 + 3;
                local_21c = pwVar13;
              }
              else if ((bVar1 == 0x33) && (pbVar3[2] == 0x32)) {
                pwVar13 = (wchar_t *)((uint)pwVar13 & 0xffff7fff);
                pbVar9 = pbVar3 + 3;
                local_21c = pwVar13;
              }
              else if (((((bVar1 != 100) && (bVar1 != 0x69)) && (bVar1 != 0x6f)) &&
                       ((bVar1 != 0x75 && (bVar1 != 0x78)))) && (bVar1 != 0x58)) {
                local_248 = 0;
                goto LAB_0042b30a;
              }
            }
            else if (local_215 == 0x68) {
              pwVar13 = (wchar_t *)((uint)pwVar13 | 0x20);
              local_21c = pwVar13;
            }
            else if (local_215 == 0x6c) {
              if (*local_214 == 0x6c) {
                pwVar13 = (wchar_t *)((uint)pwVar13 | 0x1000);
                pbVar9 = pbVar3 + 2;
                local_21c = pwVar13;
              }
              else {
                pwVar13 = (wchar_t *)((uint)pwVar13 | 0x10);
                local_21c = pwVar13;
              }
            }
            else if (local_215 == 0x77) {
              pwVar13 = (wchar_t *)((uint)pwVar13 | 0x800);
              local_21c = pwVar13;
            }
            break;
          case 7:
            if ((char)local_215 < 'e') {
              if (local_215 == 100) {
LAB_0042b5e1:
                pwVar13 = (wchar_t *)((uint)pwVar13 | 0x40);
                local_21c = pwVar13;
LAB_0042b5ea:
                local_228 = 10;
LAB_0042b5f4:
                if ((((uint)pwVar13 & 0x8000) == 0) && (((uint)pwVar13 & 0x1000) == 0)) {
                  if (((uint)pwVar13 & 0x20) == 0) {
                    if (((uint)pwVar13 & 0x40) == 0) {
                      uVar4 = *(uint *)local_220;
                      iVar12 = 0;
                      local_220 = local_220 + 2;
                      goto LAB_0042b7cb;
                    }
                    uVar4 = *(uint *)local_220;
                  }
                  else if (((uint)pwVar13 & 0x40) == 0) {
                    uVar4 = (uint)(ushort)*local_220;
                  }
                  else {
                    uVar4 = (uint)*local_220;
                  }
                  iVar12 = (int)uVar4 >> 0x1f;
                  local_220 = local_220 + 2;
                }
                else {
                  uVar4 = *(uint *)local_220;
                  iVar12 = *(int *)(local_220 + 2);
                  local_220 = local_220 + 4;
                }
LAB_0042b7cb:
                if (((((uint)pwVar13 & 0x40) != 0) && (iVar12 < 1)) && (iVar12 < 0)) {
                  bVar17 = uVar4 != 0;
                  uVar4 = -uVar4;
                  iVar12 = -(iVar12 + (uint)bVar17);
                  pwVar13 = (wchar_t *)((uint)pwVar13 | 0x100);
                  local_21c = pwVar13;
                }
                if (((uint)pwVar13 & 0x9000) == 0) {
                  iVar12 = 0;
                }
                lVar18 = CONCAT44(iVar12,uVar4);
                if (local_22c < 0) {
                  local_22c = 1;
                }
                else {
                  pwVar13 = (wchar_t *)((uint)pwVar13 & 0xfffffff7);
                  local_21c = pwVar13;
                  if (0x200 < local_22c) {
                    local_22c = 0x200;
                  }
                }
                if (uVar4 == 0 && iVar12 == 0) {
                  local_238 = 0;
                }
                pwVar14 = &local_11;
                while( true ) {
                  iVar12 = local_22c + -1;
                  if ((local_22c < 1) && (lVar18 == 0)) break;
                  local_22c = iVar12;
                  lVar18 = __aulldvrm((uint)lVar18,(uint)((ulonglong)lVar18 >> 0x20),local_228,
                                      (int)local_228 >> 0x1f);
                  local_244 = (size_t)lVar18;
                  iVar12 = extraout_ECX + 0x30;
                  if (0x39 < iVar12) {
                    iVar12 = iVar12 + local_254;
                  }
                  *(char *)pwVar14 = (char)iVar12;
                  pwVar14 = (wchar_t *)((int)pwVar14 + -1);
                  local_268 = pwVar13;
                }
                local_228 = (int)&local_11 + -(int)pwVar14;
                pwVar16 = (wchar_t *)((int)pwVar14 + 1);
                pwVar13 = local_21c;
                local_22c = iVar12;
                if ((((uint)local_21c & 0x200) != 0) &&
                   ((local_228 == 0 || (*(char *)pwVar16 != '0')))) {
                  local_228 = (int)&local_11 + -(int)pwVar14 + 1;
                  *(undefined1 *)pwVar14 = 0x30;
                  pwVar16 = pwVar14;
                }
              }
              else if ((char)local_215 < 'T') {
                if (local_215 == 0x53) {
                  if (((uint)pwVar13 & 0x830) == 0) {
                    pwVar13 = (wchar_t *)((uint)pwVar13 | 0x800);
                    local_21c = pwVar13;
                  }
                  goto LAB_0042b42b;
                }
                if (local_215 == 0x41) {
LAB_0042b3b0:
                  local_215 = local_215 + 0x20;
                  local_264 = 1;
LAB_0042b3c3:
                  pwVar14 = (wchar_t *)((uint)pwVar13 | 0x40);
                  local_244 = 0x200;
                  pwVar15 = (wchar_t *)local_210;
                  sVar7 = local_244;
                  local_21c = pwVar14;
                  if (local_22c < 0) {
                    local_22c = 6;
                  }
                  else if (local_22c == 0) {
                    if (local_215 == 0x67) {
                      local_22c = 1;
                    }
                  }
                  else {
                    if (0x200 < local_22c) {
                      local_22c = 0x200;
                    }
                    if (0xa3 < local_22c) {
                      sVar7 = local_22c + 0x15d;
                      local_25c = (wchar_t *)__malloc_crt(sVar7);
                      pwVar15 = local_25c;
                      if (local_25c == (wchar_t *)0x0) {
                        local_22c = 0xa3;
                        pwVar15 = (wchar_t *)local_210;
                        sVar7 = local_244;
                      }
                    }
                  }
                  local_244 = sVar7;
                  local_284 = *(undefined4 *)local_220;
                  local_280 = *(undefined4 *)(local_220 + 2);
                  plVar21 = &local_27c;
                  iVar5 = (int)(char)local_215;
                  puVar19 = &local_284;
                  pwVar16 = pwVar15;
                  sVar7 = local_244;
                  iVar12 = local_22c;
                  uVar20 = local_264;
                  local_220 = local_220 + 4;
                  pcVar6 = (code *)DecodePointer(PTR_LAB_00456b88);
                  (*pcVar6)(puVar19,pwVar16,sVar7,iVar5,iVar12,uVar20,plVar21);
                  if ((((uint)pwVar13 & 0x80) != 0) && (local_22c == 0)) {
                    plVar21 = &local_27c;
                    pwVar16 = pwVar15;
                    pcVar6 = (code *)DecodePointer(PTR_LAB_00456b94);
                    (*pcVar6)(pwVar16,plVar21);
                  }
                  if ((local_215 == 0x67) && (((uint)pwVar13 & 0x80) == 0)) {
                    plVar21 = &local_27c;
                    pwVar16 = pwVar15;
                    pcVar6 = (code *)DecodePointer(PTR_LAB_00456b90);
                    (*pcVar6)(pwVar16,plVar21);
                  }
                  if ((char)*pwVar15 == '-') {
                    local_21c = (wchar_t *)((uint)pwVar13 | 0x140);
                    pwVar14 = local_21c;
                    pwVar15 = (wchar_t *)((int)pwVar15 + 1);
                  }
LAB_0042b54b:
                  pwVar16 = pwVar15;
                  pwVar13 = pwVar14;
                  local_228 = _strlen((char *)pwVar16);
                }
                else if (local_215 == 0x43) {
                  if (((uint)pwVar13 & 0x830) == 0) {
                    pwVar13 = (wchar_t *)((uint)pwVar13 | 0x800);
                    local_21c = pwVar13;
                  }
LAB_0042b4a4:
                  if (((uint)pwVar13 & 0x810) == 0) {
                    local_210[0] = (char)*local_220;
                    local_228 = 1;
                    local_220 = local_220 + 2;
                  }
                  else {
                    _WCh = *local_220;
                    local_220 = local_220 + 2;
                    eVar8 = _wctomb_s((int *)&local_228,local_210,0x200,_WCh);
                    if (eVar8 != 0) {
                      local_24c = 1;
                    }
                  }
                  pwVar16 = (wchar_t *)local_210;
                }
                else if ((local_215 == 0x45) || (local_215 == 0x47)) goto LAB_0042b3b0;
              }
              else {
                if (local_215 == 0x58) goto LAB_0042b73f;
                if (local_215 == 0x5a) {
                  psVar2 = *(short **)local_220;
                  local_220 = local_220 + 2;
                  pwVar14 = pwVar13;
                  pwVar15 = (wchar_t *)PTR_DAT_004562f8;
                  if ((psVar2 == (short *)0x0) ||
                     (pwVar16 = *(wchar_t **)(psVar2 + 2), pwVar16 == (wchar_t *)0x0))
                  goto LAB_0042b54b;
                  local_228 = (size_t)*psVar2;
                  if (((uint)pwVar13 & 0x800) == 0) {
                    local_240 = 0;
                  }
                  else {
                    local_228 = (int)local_228 / 2;
                    local_240 = 1;
                  }
                }
                else {
                  if (local_215 == 0x61) goto LAB_0042b3c3;
                  if (local_215 == 99) goto LAB_0042b4a4;
                }
              }
LAB_0042b8c8:
              if (local_24c == 0) {
                if (((uint)pwVar13 & 0x40) != 0) {
                  if (((uint)pwVar13 & 0x100) == 0) {
                    if (((uint)pwVar13 & 1) == 0) {
                      if (((uint)pwVar13 & 2) == 0) goto LAB_0042b90f;
                      local_230 = 0x20;
                    }
                    else {
                      local_230 = 0x2b;
                    }
                  }
                  else {
                    local_230 = 0x2d;
                  }
                  local_238 = 1;
                }
LAB_0042b90f:
                iVar12 = (local_23c - local_228) - local_238;
                if (((uint)pwVar13 & 0xc) == 0) {
                  write_multi_char(0x20,iVar12,local_234,&local_224);
                }
                write_string(&local_230,local_238,local_234,&local_224,local_258);
                if ((((uint)pwVar13 & 8) != 0) && (((uint)pwVar13 & 4) == 0)) {
                  write_multi_char(0x30,iVar12,local_234,&local_224);
                }
                if ((local_240 == 0) || (sVar7 = local_228, pwVar14 = pwVar16, (int)local_228 < 1))
                {
                  write_string((byte *)pwVar16,local_228,local_234,&local_224,local_258);
                }
                else {
                  do {
                    local_244 = sVar7 - 1;
                    local_268 = pwVar14 + 1;
                    eVar8 = _wctomb_s(&local_260,(char *)((int)&local_11 + 1),6,*pwVar14);
                    if ((eVar8 != 0) || (local_260 == 0)) {
                      local_224 = -1;
                      break;
                    }
                    write_string((byte *)((int)&local_11 + 1),local_260,local_234,&local_224,
                                 local_258);
                    sVar7 = local_244;
                    pwVar14 = local_268;
                  } while (local_244 != 0);
                }
                if ((-1 < local_224) && (((uint)pwVar13 & 4) != 0)) {
                  write_multi_char(0x20,iVar12,local_234,&local_224);
                }
              }
            }
            else {
              if ('p' < (char)local_215) {
                if (local_215 == 0x73) {
LAB_0042b42b:
                  iVar12 = 0x7fffffff;
                  if (local_22c != -1) {
                    iVar12 = local_22c;
                  }
                  pwVar14 = *(wchar_t **)local_220;
                  local_220 = local_220 + 2;
                  pwVar16 = pwVar14;
                  if (((uint)pwVar13 & 0x810) == 0) {
                    if (pwVar14 == (wchar_t *)0x0) {
                      pwVar14 = (wchar_t *)PTR_DAT_004562f8;
                      pwVar16 = (wchar_t *)PTR_DAT_004562f8;
                    }
                    for (; (iVar12 != 0 && (iVar12 = iVar12 + -1, (char)*pwVar14 != '\0'));
                        pwVar14 = (wchar_t *)((int)pwVar14 + 1)) {
                    }
                    local_228 = (int)pwVar14 - (int)pwVar16;
                  }
                  else {
                    if (pwVar14 == (wchar_t *)0x0) {
                      pwVar16 = (wchar_t *)PTR_DAT_004562fc;
                    }
                    local_240 = 1;
                    for (pwVar14 = pwVar16;
                        (iVar12 != 0 && (iVar12 = iVar12 + -1, *pwVar14 != L'\0'));
                        pwVar14 = pwVar14 + 1) {
                    }
                    local_228 = (int)pwVar14 - (int)pwVar16 >> 1;
                  }
                  goto LAB_0042b8c8;
                }
                if (local_215 == 0x75) goto LAB_0042b5ea;
                if (local_215 != 0x78) goto LAB_0042b8c8;
                local_254 = 0x27;
LAB_0042b75f:
                local_228 = 0x10;
                if ((char)pwVar13 < '\0') {
                  local_22f = (char)local_254 + 'Q';
                  local_230 = 0x30;
                  local_238 = 2;
                }
                goto LAB_0042b5f4;
              }
              if (local_215 == 0x70) {
                local_22c = 8;
LAB_0042b73f:
                local_254 = 7;
                goto LAB_0042b75f;
              }
              if ((char)local_215 < 'e') goto LAB_0042b8c8;
              if ((char)local_215 < 'h') goto LAB_0042b3c3;
              if (local_215 == 0x69) goto LAB_0042b5e1;
              if (local_215 != 0x6e) {
                if (local_215 != 0x6f) goto LAB_0042b8c8;
                local_228 = 8;
                if ((char)pwVar13 < '\0') {
                  pwVar13 = (wchar_t *)((uint)pwVar13 | 0x200);
                  local_21c = pwVar13;
                }
                goto LAB_0042b5f4;
              }
              piVar10 = *(int **)local_220;
              local_220 = local_220 + 2;
              bVar17 = FUN_0042e36e();
              if (CONCAT31(extraout_var,bVar17) == 0) goto LAB_0042bac0;
              if (((uint)pwVar13 & 0x20) == 0) {
                *piVar10 = local_224;
              }
              else {
                *(short *)piVar10 = (short)local_224;
              }
              local_24c = 1;
            }
            pbVar9 = local_214;
            iVar12 = local_224;
            if (local_25c != (wchar_t *)0x0) {
              FID_conflict__free(local_25c);
              local_25c = (wchar_t *)0x0;
              pbVar9 = local_214;
              iVar12 = local_224;
            }
          }
          local_215 = *pbVar9;
          local_250 = CONCAT31(local_250._1_3_,local_215);
          pbVar3 = pbVar9;
        }
        goto LAB_0042ba9e;
      }
    }
  }
LAB_0042bac0:
  piVar10 = __errno();
  *piVar10 = 0x16;
  FUN_0042acd7();
LAB_0042ba9e:
  if (local_270 != '\0') {
    *(uint *)(local_274 + 0x70) = *(uint *)(local_274 + 0x70) & 0xfffffffd;
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: write_char */

/* Library Function - Single Match
    _write_char
   
   Library: Visual Studio 2012 Release */

void __cdecl write_char(byte param_1,FILE *param_2,int *param_3)

{
  int *piVar1;
  uint uVar2;
  
  if (((param_2->_flag & 0x40) == 0) || (param_2->_base != (char *)0x0)) {
    piVar1 = &param_2->_cnt;
    *piVar1 = *piVar1 + -1;
    if (*piVar1 < 0) {
      uVar2 = FUN_0042ad9a(param_1,param_2);
    }
    else {
      *param_2->_ptr = param_1;
      param_2->_ptr = param_2->_ptr + 1;
      uVar2 = (uint)param_1;
    }
    if (uVar2 == 0xffffffff) {
      *param_3 = -1;
      return;
    }
  }
  *param_3 = *param_3 + 1;
  return;
}



/* Function: write_multi_char */

/* Library Function - Single Match
    _write_multi_char
   
   Library: Visual Studio 2012 Release */

void __cdecl write_multi_char(byte param_1,int param_2,FILE *param_3,int *param_4)

{
  if (0 < param_2) {
    do {
      param_2 = param_2 + -1;
      write_char(param_1,param_3,param_4);
      if (*param_4 == -1) {
        return;
      }
    } while (0 < param_2);
  }
  return;
}



/* Function: write_string */

/* Library Function - Single Match
    _write_string
   
   Library: Visual Studio 2012 Release */

void __cdecl write_string(byte *param_1,int param_2,FILE *param_3,int *param_4,int *param_5)

{
  int iVar1;
  
  iVar1 = *param_5;
  if (((param_3->_flag & 0x40) == 0) || (param_3->_base != (char *)0x0)) {
    *param_5 = 0;
    if (0 < param_2) {
      do {
        param_2 = param_2 + -1;
        write_char(*param_1,param_3,param_4);
        param_1 = param_1 + 1;
        if (*param_4 == -1) {
          if (*param_5 != 0x2a) break;
          write_char(0x3f,param_3,param_4);
        }
      } while (0 < param_2);
      if (*param_5 != 0) {
        return;
      }
    }
    *param_5 = iVar1;
  }
  else {
    *param_4 = *param_4 + param_2;
  }
  return;
}



/* Function: _malloc */

/* Library Function - Single Match
    _malloc
   
   Library: Visual Studio 2012 Release */

void * __cdecl _malloc(size_t _Size)

{
  LPVOID pvVar1;
  int iVar2;
  int *piVar3;
  SIZE_T dwBytes;
  
  if (_Size < 0xffffffe1) {
    do {
      if (DAT_00457608 == (HANDLE)0x0) {
        __FF_MSGBANNER();
        __NMSG_WRITE(0x1e);
        ___crtExitProcess(0xff);
      }
      dwBytes = _Size;
      if (_Size == 0) {
        dwBytes = 1;
      }
      pvVar1 = HeapAlloc(DAT_00457608,0,dwBytes);
      if (pvVar1 != (LPVOID)0x0) {
        return pvVar1;
      }
      if (DAT_00457e10 == 0) {
        piVar3 = __errno();
        *piVar3 = 0xc;
        break;
      }
      iVar2 = __callnewh(_Size);
    } while (iVar2 != 0);
    piVar3 = __errno();
    *piVar3 = 0xc;
  }
  else {
    __callnewh(_Size);
    piVar3 = __errno();
    *piVar3 = 0xc;
  }
  return (void *)0x0;
}



/* Function: exception */

/* Library Function - Single Match
    public: __thiscall std::exception::exception(char const * const &,int)
   
   Library: Visual Studio 2012 Release */

exception * __thiscall std::exception::exception(exception *this,char **param_1,int param_2)

{
  *(undefined ***)this = vftable;
  *(char **)(this + 4) = *param_1;
  this[8] = (exception)0x0;
  return this;
}



/* Function: exception */

/* Library Function - Single Match
    public: __thiscall std::exception::exception(class std::exception const &)
   
   Library: Visual Studio 2012 Release */

exception * __thiscall std::exception::exception(exception *this,exception *param_1)

{
  *(undefined4 *)(this + 4) = 0;
  *(undefined ***)this = vftable;
  this[8] = (exception)0x0;
  operator=(this,param_1);
  return this;
}



/* Function: FUN_0042bcb1 */

void __fastcall FUN_0042bcb1(exception *param_1)

{
  *(undefined ***)param_1 = std::exception::vftable;
  std::exception::_Tidy(param_1);
  return;
}



/* Function: operator= */

/* Library Function - Single Match
    public: class std::exception & __thiscall std::exception::operator=(class std::exception const
   &)
   
   Library: Visual Studio 2012 Release */

exception * __thiscall std::exception::operator=(exception *this,exception *param_1)

{
  if (this != param_1) {
    _Tidy(this);
    if (param_1[8] == (exception)0x0) {
      *(undefined4 *)(this + 4) = *(undefined4 *)(param_1 + 4);
    }
    else {
      _Copy_str(this,*(char **)(param_1 + 4));
    }
  }
  return this;
}



/* Function: FUN_0042bcef */

exception * __thiscall FUN_0042bcef(void *this,byte param_1)

{
  *(undefined ***)this = std::exception::vftable;
  std::exception::_Tidy((exception *)this);
  if ((param_1 & 1) != 0) {
    FID_conflict__free(this);
  }
  return (exception *)this;
}



/* Function: _Copy_str */

/* Library Function - Single Match
    private: void __thiscall std::exception::_Copy_str(char const *)
   
   Library: Visual Studio 2012 Release */

void __thiscall std::exception::_Copy_str(exception *this,char *param_1)

{
  size_t sVar1;
  char *_Dst;
  
  if (param_1 != (char *)0x0) {
    sVar1 = _strlen(param_1);
    _Dst = (char *)_malloc(sVar1 + 1);
    *(char **)(this + 4) = _Dst;
    if (_Dst != (char *)0x0) {
      _strcpy_s(_Dst,sVar1 + 1,param_1);
      this[8] = (exception)0x1;
    }
  }
  return;
}



/* Function: _Tidy */

/* Library Function - Single Match
    private: void __thiscall std::exception::_Tidy(void)
   
   Library: Visual Studio 2012 Release */

void __thiscall std::exception::_Tidy(exception *this)

{
  if (this[8] != (exception)0x0) {
    FID_conflict__free(*(void **)(this + 4));
  }
  *(undefined4 *)(this + 4) = 0;
  this[8] = (exception)0x0;
  return;
}



/* Function: FUN_0042bd6e */

char * __fastcall FUN_0042bd6e(int param_1)

{
  char *pcVar1;
  
  pcVar1 = *(char **)(param_1 + 4);
  if (pcVar1 == (char *)0x0) {
    pcVar1 = "Unknown exception";
  }
  return pcVar1;
}



/* Function: __callnewh */

/* Library Function - Single Match
    __callnewh
   
   Library: Visual Studio 2012 Release */

int __cdecl __callnewh(size_t _Size)

{
  code *pcVar1;
  int iVar2;
  
  pcVar1 = (code *)DecodePointer(DAT_00457c4c);
  if (pcVar1 != (code *)0x0) {
    iVar2 = (*pcVar1)(_Size);
    if (iVar2 != 0) {
      return 1;
    }
  }
  return 0;
}



/* Function: FUN_0042bda1 */

void __cdecl FUN_0042bda1(undefined4 param_1)

{
  DAT_00457c4c = param_1;
  return;
}



/* Function: __CxxThrowException@8 */

/* Library Function - Single Match
    __CxxThrowException@8
   
   Library: Visual Studio 2012 Release */

void __CxxThrowException_8(int *param_1,byte *param_2)

{
  int iVar1;
  DWORD *pDVar2;
  DWORD *pDVar3;
  DWORD local_24 [4];
  DWORD local_14;
  ULONG_PTR local_10;
  int *local_c;
  byte *local_8;
  
  pDVar2 = &DAT_0044f7b4;
  pDVar3 = local_24;
  for (iVar1 = 8; iVar1 != 0; iVar1 = iVar1 + -1) {
    *pDVar3 = *pDVar2;
    pDVar2 = pDVar2 + 1;
    pDVar3 = pDVar3 + 1;
  }
  if ((param_2 != (byte *)0x0) && ((*param_2 & 0x10) != 0)) {
    param_2 = *(byte **)(*(int *)(*param_1 + -4) + 0x18);
  }
  local_c = param_1;
  if ((param_2 != (byte *)0x0) && ((*param_2 & 8) != 0)) {
    local_10 = 0x1994000;
  }
  local_8 = param_2;
  RaiseException(local_24[0],local_24[1],local_14,&local_10);
  return;
}



/* Function: FID_conflict:_free */

/* Library Function - Multiple Matches With Different Base Names
    __free_base
    _free
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release, Visual Studio 2017 Release,
   Visual Studio 2019 Release */

void __cdecl FID_conflict__free(void *_Memory)

{
  BOOL BVar1;
  int *piVar2;
  DWORD DVar3;
  int iVar4;
  
  if (_Memory != (void *)0x0) {
    BVar1 = HeapFree(DAT_00457608,0,_Memory);
    if (BVar1 == 0) {
      piVar2 = __errno();
      DVar3 = GetLastError();
      iVar4 = __get_errno_from_oserr(DVar3);
      *piVar2 = iVar4;
    }
  }
  return;
}



/* Function: _Type_info_dtor */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    private: static void __cdecl type_info::_Type_info_dtor(class type_info *)
   
   Library: Visual Studio 2012 Release */

void __cdecl type_info::_Type_info_dtor(type_info *param_1)

{
  int *_Memory;
  int *piVar1;
  int *piVar2;
  
  __lock(0xe);
  _Memory = DAT_00457c54;
  if (*(int *)(param_1 + 4) != 0) {
    piVar1 = (int *)&DAT_00457c50;
    do {
      piVar2 = piVar1;
      if (DAT_00457c54 == (int *)0x0) goto LAB_0042bf21;
      piVar1 = DAT_00457c54;
    } while (*DAT_00457c54 != *(int *)(param_1 + 4));
    piVar2[1] = DAT_00457c54[1];
    FID_conflict__free(_Memory);
LAB_0042bf21:
    FID_conflict__free(*(void **)(param_1 + 4));
    *(undefined4 *)(param_1 + 4) = 0;
  }
  FUN_0042bf44();
  return;
}



/* Function: FUN_0042bf44 */

void FUN_0042bf44(void)

{
  FUN_0042c0f6(0xe);
  return;
}



/* Function: terminate */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* Library Function - Single Match
    void __cdecl terminate(void)
   
   Library: Visual Studio 2012 Release */

void __cdecl terminate(void)

{
  _ptiddata p_Var1;
  
  p_Var1 = __getptd();
  if ((code *)p_Var1->_terminate != (code *)0x0) {
    (*(code *)p_Var1->_terminate)();
  }
                    /* WARNING: Subroutine does not return */
  _abort();
}



/* Function: FUN_0042bf81 */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void FUN_0042bf81(void)

{
  _DAT_00457c58 = EncodePointer(terminate);
  return;
}



/* Function: __lock */

/* Library Function - Single Match
    __lock
   
   Library: Visual Studio 2012 Release */

void __cdecl __lock(int _File)

{
  int iVar1;
  
  if ((&DAT_00456300)[_File * 2] == 0) {
    iVar1 = __mtinitlocknum(_File);
    if (iVar1 == 0) {
      __amsg_exit(0x11);
    }
  }
  EnterCriticalSection((LPCRITICAL_SECTION)(&DAT_00456300)[_File * 2]);
  return;
}



/* Function: __mtdeletelocks */

/* Library Function - Single Match
    __mtdeletelocks
   
   Library: Visual Studio 2012 Release */

void __cdecl __mtdeletelocks(void)

{
  LPCRITICAL_SECTION lpCriticalSection;
  int *piVar1;
  undefined4 *puVar2;
  
  piVar1 = &DAT_00456300;
  puVar2 = &DAT_00456300;
  do {
    lpCriticalSection = (LPCRITICAL_SECTION)*puVar2;
    if ((lpCriticalSection != (LPCRITICAL_SECTION)0x0) && (puVar2[1] != 1)) {
      DeleteCriticalSection(lpCriticalSection);
      FID_conflict__free(lpCriticalSection);
      *puVar2 = 0;
    }
    puVar2 = puVar2 + 2;
  } while ((int)puVar2 < 0x456420);
  do {
    if ((*piVar1 != 0) && (piVar1[1] == 1)) {
      DeleteCriticalSection((LPCRITICAL_SECTION)*piVar1);
    }
    piVar1 = piVar1 + 2;
  } while ((int)piVar1 < 0x456420);
  return;
}



/* Function: __mtinitlocknum */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    __mtinitlocknum
   
   Library: Visual Studio 2012 Release */

int __cdecl __mtinitlocknum(int _LockNum)

{
  LPCRITICAL_SECTION lpCriticalSection;
  int *piVar1;
  
  if (DAT_00457608 == 0) {
    __FF_MSGBANNER();
    __NMSG_WRITE(0x1e);
    ___crtExitProcess(0xff);
  }
  if ((&DAT_00456300)[_LockNum * 2] == 0) {
    lpCriticalSection = (LPCRITICAL_SECTION)__malloc_crt(0x18);
    if (lpCriticalSection == (LPCRITICAL_SECTION)0x0) {
      piVar1 = __errno();
      *piVar1 = 0xc;
      return 0;
    }
    __lock(10);
    if ((&DAT_00456300)[_LockNum * 2] == 0) {
      InitializeCriticalSectionAndSpinCount(lpCriticalSection,4000);
      (&DAT_00456300)[_LockNum * 2] = lpCriticalSection;
    }
    else {
      FID_conflict__free(lpCriticalSection);
    }
    FUN_0042c0b8();
  }
  return 1;
}



/* Function: FUN_0042c0b8 */

void FUN_0042c0b8(void)

{
  FUN_0042c0f6(10);
  return;
}



/* Function: __mtinitlocks */

/* Library Function - Single Match
    __mtinitlocks
   
   Library: Visual Studio 2012 Release */

int __cdecl __mtinitlocks(void)

{
  undefined4 *puVar1;
  undefined *puVar2;
  
  puVar1 = &DAT_00456300;
  puVar2 = &DAT_00457c60;
  do {
    if (puVar1[1] == 1) {
      *puVar1 = puVar2;
      puVar2 = puVar2 + 0x18;
      InitializeCriticalSectionAndSpinCount((LPCRITICAL_SECTION)*puVar1,4000);
    }
    puVar1 = puVar1 + 2;
  } while ((int)puVar1 < 0x456420);
  return 1;
}



/* Function: FUN_0042c0f6 */

void __cdecl FUN_0042c0f6(int param_1)

{
  LeaveCriticalSection((LPCRITICAL_SECTION)(&DAT_00456300)[param_1 * 2]);
  return;
}



/* Function: __calloc_crt */

/* Library Function - Single Match
    __calloc_crt
   
   Library: Visual Studio 2012 Release */

void * __cdecl __calloc_crt(size_t _Count,size_t _Size)

{
  LPVOID pvVar1;
  uint dwMilliseconds;
  
  dwMilliseconds = 0;
  while( true ) {
    pvVar1 = __calloc_impl(_Count,_Size,(int *)0x0);
    if (pvVar1 != (LPVOID)0x0) {
      return pvVar1;
    }
    if (DAT_00457db0 == 0) break;
    Sleep(dwMilliseconds);
    dwMilliseconds = dwMilliseconds + 1000;
    if (DAT_00457db0 < dwMilliseconds) {
      dwMilliseconds = 0xffffffff;
    }
    if (dwMilliseconds == 0xffffffff) {
      return (void *)0x0;
    }
  }
  return (void *)0x0;
}



/* Function: __malloc_crt */

/* Library Function - Single Match
    __malloc_crt
   
   Library: Visual Studio 2012 Release */

void * __cdecl __malloc_crt(size_t _Size)

{
  uint uVar1;
  void *pvVar2;
  uint dwMilliseconds;
  
  dwMilliseconds = 0;
  while( true ) {
    uVar1 = DAT_00457db0;
    pvVar2 = _malloc(_Size);
    if (pvVar2 != (void *)0x0) {
      return pvVar2;
    }
    if (uVar1 == 0) break;
    Sleep(dwMilliseconds);
    dwMilliseconds = dwMilliseconds + 1000;
    if (DAT_00457db0 < dwMilliseconds) {
      dwMilliseconds = 0xffffffff;
    }
    if (dwMilliseconds == 0xffffffff) {
      return (void *)0x0;
    }
  }
  return (void *)0x0;
}



/* Function: __realloc_crt */

/* Library Function - Single Match
    __realloc_crt
   
   Library: Visual Studio 2012 Release */

void * __cdecl __realloc_crt(void *_Ptr,size_t _NewSize)

{
  void *pvVar1;
  uint dwMilliseconds;
  
  dwMilliseconds = 0;
  do {
    pvVar1 = _realloc(_Ptr,_NewSize);
    if (pvVar1 != (void *)0x0) {
      return pvVar1;
    }
    if (_NewSize == 0) {
      return (void *)0x0;
    }
    if (DAT_00457db0 == 0) {
      return (void *)0x0;
    }
    Sleep(dwMilliseconds);
    dwMilliseconds = dwMilliseconds + 1000;
    if (DAT_00457db0 < dwMilliseconds) {
      dwMilliseconds = 0xffffffff;
    }
  } while (dwMilliseconds != 0xffffffff);
  return (void *)0x0;
}



/* Function: ___addlocaleref */

/* Library Function - Single Match
    ___addlocaleref
   
   Library: Visual Studio 2012 Release */

void __cdecl ___addlocaleref(LONG *param_1)

{
  LONG *pLVar1;
  int *piVar2;
  
  pLVar1 = param_1;
  InterlockedIncrement(param_1);
  if (param_1[0x1e] != 0) {
    InterlockedIncrement((LONG *)param_1[0x1e]);
  }
  if ((LONG *)param_1[0x20] != (LONG *)0x0) {
    InterlockedIncrement((LONG *)param_1[0x20]);
  }
  if (param_1[0x1f] != 0) {
    InterlockedIncrement((LONG *)param_1[0x1f]);
  }
  if ((LONG *)param_1[0x22] != (LONG *)0x0) {
    InterlockedIncrement((LONG *)param_1[0x22]);
  }
  piVar2 = param_1 + 7;
  param_1 = (LONG *)0x6;
  do {
    if (((undefined *)piVar2[-2] != &DAT_00456420) && (*piVar2 != 0)) {
      InterlockedIncrement((LONG *)*piVar2);
    }
    if ((piVar2[-3] != 0) && (piVar2[-1] != 0)) {
      InterlockedIncrement((LONG *)piVar2[-1]);
    }
    piVar2 = piVar2 + 4;
    param_1 = (LONG *)((int)param_1 + -1);
  } while (param_1 != (LONG *)0x0);
  InterlockedIncrement((LONG *)(pLVar1[0x27] + 0xb0));
  return;
}



/* Function: ___freetlocinfo */

/* Library Function - Single Match
    ___freetlocinfo
   
   Library: Visual Studio 2012 Release */

void __cdecl ___freetlocinfo(void *param_1)

{
  int *piVar1;
  undefined **ppuVar2;
  void *_Memory;
  undefined4 *puVar3;
  undefined4 *puVar4;
  
  _Memory = param_1;
  if ((((*(undefined ***)((int)param_1 + 0x84) != (undefined **)0x0) &&
       (*(undefined ***)((int)param_1 + 0x84) != &PTR_DAT_00456e30)) &&
      (*(int **)((int)param_1 + 0x78) != (int *)0x0)) && (**(int **)((int)param_1 + 0x78) == 0)) {
    piVar1 = *(int **)((int)param_1 + 0x80);
    if ((piVar1 != (int *)0x0) && (*piVar1 == 0)) {
      FID_conflict__free(piVar1);
      ___free_lconv_mon(*(int *)((int)param_1 + 0x84));
    }
    piVar1 = *(int **)((int)param_1 + 0x7c);
    if ((piVar1 != (int *)0x0) && (*piVar1 == 0)) {
      FID_conflict__free(piVar1);
      ___free_lconv_num(*(undefined4 **)((int)param_1 + 0x84));
    }
    FID_conflict__free(*(void **)((int)param_1 + 0x78));
    FID_conflict__free(*(void **)((int)param_1 + 0x84));
  }
  if ((*(int **)((int)param_1 + 0x88) != (int *)0x0) && (**(int **)((int)param_1 + 0x88) == 0)) {
    FID_conflict__free((void *)(*(int *)((int)param_1 + 0x8c) + -0xfe));
    FID_conflict__free((void *)(*(int *)((int)param_1 + 0x94) + -0x80));
    FID_conflict__free((void *)(*(int *)((int)param_1 + 0x98) + -0x80));
    FID_conflict__free(*(void **)((int)param_1 + 0x88));
  }
  ppuVar2 = *(undefined ***)((int)param_1 + 0x9c);
  if ((ppuVar2 != &PTR_DAT_00456428) && (ppuVar2[0x2c] == (undefined *)0x0)) {
    ___free_lc_time(ppuVar2);
    FID_conflict__free(*(void **)((int)param_1 + 0x9c));
  }
  puVar3 = (undefined4 *)((int)param_1 + 0xa0);
  puVar4 = (undefined4 *)((int)param_1 + 0x1c);
  param_1 = (void *)0x6;
  do {
    if ((((undefined *)puVar4[-2] != &DAT_00456420) &&
        (piVar1 = (int *)*puVar4, piVar1 != (int *)0x0)) && (*piVar1 == 0)) {
      FID_conflict__free(piVar1);
      FID_conflict__free((void *)*puVar3);
    }
    if (((puVar4[-3] != 0) && (piVar1 = (int *)puVar4[-1], piVar1 != (int *)0x0)) && (*piVar1 == 0))
    {
      FID_conflict__free(piVar1);
    }
    puVar3 = puVar3 + 1;
    puVar4 = puVar4 + 4;
    param_1 = (void *)((int)param_1 + -1);
  } while (param_1 != (void *)0x0);
  FID_conflict__free(_Memory);
  return;
}



/* Function: ___removelocaleref */

/* Library Function - Single Match
    ___removelocaleref
   
   Library: Visual Studio 2012 Release */

LONG * __cdecl ___removelocaleref(LONG *param_1)

{
  LONG *pLVar1;
  int *piVar2;
  
  pLVar1 = param_1;
  if (param_1 != (LONG *)0x0) {
    InterlockedDecrement(param_1);
    if (param_1[0x1e] != 0) {
      InterlockedDecrement((LONG *)param_1[0x1e]);
    }
    if ((LONG *)param_1[0x20] != (LONG *)0x0) {
      InterlockedDecrement((LONG *)param_1[0x20]);
    }
    if (param_1[0x1f] != 0) {
      InterlockedDecrement((LONG *)param_1[0x1f]);
    }
    if ((LONG *)param_1[0x22] != (LONG *)0x0) {
      InterlockedDecrement((LONG *)param_1[0x22]);
    }
    piVar2 = param_1 + 7;
    param_1 = (LONG *)0x6;
    do {
      if (((undefined *)piVar2[-2] != &DAT_00456420) && (*piVar2 != 0)) {
        InterlockedDecrement((LONG *)*piVar2);
      }
      if ((piVar2[-3] != 0) && (piVar2[-1] != 0)) {
        InterlockedDecrement((LONG *)piVar2[-1]);
      }
      piVar2 = piVar2 + 4;
      param_1 = (LONG *)((int)param_1 + -1);
    } while (param_1 != (LONG *)0x0);
    InterlockedDecrement((LONG *)(pLVar1[0x27] + 0xb0));
  }
  return pLVar1;
}



/* Function: ___updatetlocinfo */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    ___updatetlocinfo
   
   Library: Visual Studio 2012 Release */

pthreadlocinfo __cdecl ___updatetlocinfo(void)

{
  _ptiddata p_Var1;
  pthreadlocinfo ptVar2;
  
  p_Var1 = __getptd();
  if (((p_Var1->_ownlocale & DAT_00456e20) == 0) || (p_Var1->ptlocinfo == (pthreadlocinfo)0x0)) {
    __lock(0xc);
    ptVar2 = (pthreadlocinfo)__updatetlocinfoEx_nolock(&p_Var1->ptlocinfo,(LONG *)PTR_DAT_0045658c);
    FUN_0042c4e2();
  }
  else {
    p_Var1 = __getptd();
    ptVar2 = p_Var1->ptlocinfo;
  }
  if (ptVar2 == (pthreadlocinfo)0x0) {
    __amsg_exit(0x20);
  }
  return ptVar2;
}



/* Function: FUN_0042c4e2 */

void FUN_0042c4e2(void)

{
  FUN_0042c0f6(0xc);
  return;
}



/* Function: __updatetlocinfoEx_nolock */

/* Library Function - Single Match
    __updatetlocinfoEx_nolock
   
   Library: Visual Studio 2012 Release */

LONG * __cdecl __updatetlocinfoEx_nolock(undefined4 *param_1,LONG *param_2)

{
  LONG *pLVar1;
  
  if ((param_2 == (LONG *)0x0) || (param_1 == (undefined4 *)0x0)) {
    param_2 = (LONG *)0x0;
  }
  else {
    pLVar1 = (LONG *)*param_1;
    if (pLVar1 != param_2) {
      *param_1 = param_2;
      ___addlocaleref(param_2);
      if (((pLVar1 != (LONG *)0x0) && (___removelocaleref(pLVar1), *pLVar1 == 0)) &&
         (pLVar1 != (LONG *)&DAT_00456590)) {
        ___freetlocinfo(pLVar1);
      }
    }
  }
  return param_2;
}



/* Function: CPtoLocaleName */

/* Library Function - Single Match
    wchar_t const * __cdecl CPtoLocaleName(int)
   
   Library: Visual Studio 2012 Release */

wchar_t * __cdecl CPtoLocaleName(int param_1)

{
  if (param_1 == 0x3a4) {
    return (wchar_t *)PTR_u_ja_JP_0044fb30;
  }
  if (param_1 == 0x3a8) {
    return (wchar_t *)PTR_u_zh_CN_0044fb34;
  }
  if (param_1 == 0x3b5) {
    return (wchar_t *)PTR_u_ko_KR_0044fb38;
  }
  if (param_1 != 0x3b6) {
    return (wchar_t *)0x0;
  }
  return (wchar_t *)PTR_u_zh_TW_0044fb3c;
}



/* Function: getSystemCP */

/* Library Function - Single Match
    int __cdecl getSystemCP(int)
   
   Library: Visual Studio 2012 Release */

int __cdecl getSystemCP(int param_1)

{
  int local_14 [2];
  int local_c;
  char local_8;
  
  _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)local_14,(localeinfo_struct *)0x0);
  DAT_00457dcc = 0;
  if (param_1 == -2) {
    DAT_00457dcc = 1;
    param_1 = GetOEMCP();
  }
  else if (param_1 == -3) {
    DAT_00457dcc = 1;
    param_1 = GetACP();
  }
  else if (param_1 == -4) {
    DAT_00457dcc = 1;
    param_1 = *(UINT *)(local_14[0] + 4);
  }
  if (local_8 != '\0') {
    *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
  }
  return param_1;
}



/* Function: setSBCS */

/* Library Function - Single Match
    void __cdecl setSBCS(struct threadmbcinfostruct *)
   
   Library: Visual Studio 2012 Release */

void __cdecl setSBCS(threadmbcinfostruct *param_1)

{
  int iVar1;
  uchar *puVar2;
  
  puVar2 = param_1->mbctype;
  FUN_004267c0((uint *)puVar2,0,0x101);
  param_1->mbcodepage = 0;
  param_1->ismbcodepage = 0;
  param_1->mblocalename = (wchar_t *)0x0;
  param_1->mbulinfo[0] = 0;
  param_1->mbulinfo[1] = 0;
  param_1->mbulinfo[2] = 0;
  param_1->mbulinfo[3] = 0;
  param_1->mbulinfo[4] = 0;
  param_1->mbulinfo[5] = 0;
  iVar1 = 0x101;
  do {
    *puVar2 = puVar2[(int)&DAT_00456950 - (int)param_1];
    puVar2 = puVar2 + 1;
    iVar1 = iVar1 + -1;
  } while (iVar1 != 0);
  puVar2 = param_1->mbcasemap;
  iVar1 = 0x100;
  do {
    *puVar2 = puVar2[(int)&DAT_00456950 - (int)param_1];
    puVar2 = puVar2 + 1;
    iVar1 = iVar1 + -1;
  } while (iVar1 != 0);
  return;
}



/* Function: setSBUpLow */

/* Library Function - Single Match
    void __cdecl setSBUpLow(struct threadmbcinfostruct *)
   
   Library: Visual Studio 2012 Release */

void __cdecl setSBUpLow(threadmbcinfostruct *param_1)

{
  byte bVar1;
  uchar uVar2;
  BOOL BVar3;
  uint uVar4;
  BYTE *pBVar5;
  uchar *puVar6;
  _cpinfo local_51c;
  WORD local_508 [256];
  uchar local_308 [256];
  uchar local_208 [256];
  CHAR local_108 [256];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  BVar3 = GetCPInfo(param_1->mbcodepage,&local_51c);
  if (BVar3 == 0) {
    uVar4 = 0;
    do {
      puVar6 = param_1->mbcasemap + uVar4;
      if (puVar6 + (-0x61 - (int)param_1->mbcasemap) + 0x20 < (uchar *)0x1a) {
        param_1->mbctype[uVar4 + 1] = param_1->mbctype[uVar4 + 1] | 0x10;
        uVar2 = (char)uVar4 + ' ';
LAB_0042c7cb:
        *puVar6 = uVar2;
      }
      else {
        if (puVar6 + (-0x61 - (int)param_1->mbcasemap) < (uchar *)0x1a) {
          param_1->mbctype[uVar4 + 1] = param_1->mbctype[uVar4 + 1] | 0x20;
          uVar2 = (char)uVar4 + 0xe0;
          goto LAB_0042c7cb;
        }
        *puVar6 = '\0';
      }
      uVar4 = uVar4 + 1;
    } while (uVar4 < 0x100);
  }
  else {
    uVar4 = 0;
    do {
      local_108[uVar4] = (CHAR)uVar4;
      uVar4 = uVar4 + 1;
    } while (uVar4 < 0x100);
    local_108[0] = ' ';
    pBVar5 = local_51c.LeadByte;
    while (local_51c.LeadByte[0] != 0) {
      bVar1 = pBVar5[1];
      for (uVar4 = (uint)local_51c.LeadByte[0]; (uVar4 <= bVar1 && (uVar4 < 0x100));
          uVar4 = uVar4 + 1) {
        local_108[uVar4] = ' ';
      }
      pBVar5 = pBVar5 + 2;
      local_51c.LeadByte[0] = *pBVar5;
    }
    ___crtGetStringTypeA((_locale_t)0x0,1,local_108,0x100,local_508,param_1->mbcodepage,0);
    ___crtLCMapStringA((_locale_t)0x0,param_1->mblocalename,0x100,local_108,0x100,(LPSTR)local_208,
                       0x100,param_1->mbcodepage,0);
    ___crtLCMapStringA((_locale_t)0x0,param_1->mblocalename,0x200,local_108,0x100,(LPSTR)local_308,
                       0x100,param_1->mbcodepage,0);
    uVar4 = 0;
    do {
      if ((local_508[uVar4] & 1) == 0) {
        if ((local_508[uVar4] & 2) != 0) {
          param_1->mbctype[uVar4 + 1] = param_1->mbctype[uVar4 + 1] | 0x20;
          uVar2 = local_308[uVar4];
          goto LAB_0042c774;
        }
        param_1->mbcasemap[uVar4] = '\0';
      }
      else {
        param_1->mbctype[uVar4 + 1] = param_1->mbctype[uVar4 + 1] | 0x10;
        uVar2 = local_208[uVar4];
LAB_0042c774:
        param_1->mbcasemap[uVar4] = uVar2;
      }
      uVar4 = uVar4 + 1;
    } while (uVar4 < 0x100);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: ___updatetmbcinfo */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    ___updatetmbcinfo
   
   Library: Visual Studio 2012 Release */

pthreadmbcinfo __cdecl ___updatetmbcinfo(void)

{
  _ptiddata p_Var1;
  LONG LVar2;
  pthreadmbcinfo lpAddend;
  
  p_Var1 = __getptd();
  if (((p_Var1->_ownlocale & DAT_00456e20) == 0) || (p_Var1->ptlocinfo == (pthreadlocinfo)0x0)) {
    __lock(0xd);
    lpAddend = p_Var1->ptmbcinfo;
    if (lpAddend != (pthreadmbcinfo)PTR_DAT_00456650) {
      if (lpAddend != (pthreadmbcinfo)0x0) {
        LVar2 = InterlockedDecrement(&lpAddend->refcount);
        if ((LVar2 == 0) && (lpAddend != (pthreadmbcinfo)&DAT_00456950)) {
          FID_conflict__free(lpAddend);
        }
      }
      p_Var1->ptmbcinfo = (pthreadmbcinfo)PTR_DAT_00456650;
      lpAddend = (pthreadmbcinfo)PTR_DAT_00456650;
      InterlockedIncrement((LONG *)PTR_DAT_00456650);
    }
    FUN_0042c88d();
  }
  else {
    lpAddend = p_Var1->ptmbcinfo;
  }
  if (lpAddend == (pthreadmbcinfo)0x0) {
    __amsg_exit(0x20);
  }
  return lpAddend;
}



/* Function: FUN_0042c88d */

void FUN_0042c88d(void)

{
  FUN_0042c0f6(0xd);
  return;
}



/* Function: FUN_0042c896 */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

int __cdecl FUN_0042c896(int param_1)

{
  _ptiddata p_Var1;
  int iVar2;
  threadmbcinfostruct *lpAddend;
  LONG LVar3;
  int *piVar4;
  pthreadmbcinfo ptVar5;
  int iVar6;
  int iVar7;
  threadmbcinfostruct *ptVar8;
  
  iVar7 = -1;
  p_Var1 = __getptd();
  ___updatetmbcinfo();
  ptVar5 = p_Var1->ptmbcinfo;
  iVar2 = getSystemCP(param_1);
  if (iVar2 == ptVar5->mbcodepage) {
    iVar7 = 0;
  }
  else {
    lpAddend = (threadmbcinfostruct *)__malloc_crt(0x220);
    if (lpAddend != (threadmbcinfostruct *)0x0) {
      ptVar5 = p_Var1->ptmbcinfo;
      ptVar8 = lpAddend;
      for (iVar7 = 0x88; iVar7 != 0; iVar7 = iVar7 + -1) {
        ptVar8->refcount = ptVar5->refcount;
        ptVar5 = (pthreadmbcinfo)&ptVar5->mbcodepage;
        ptVar8 = (threadmbcinfostruct *)&ptVar8->mbcodepage;
      }
      iVar6 = 0;
      lpAddend->refcount = 0;
      iVar7 = __setmbcp_nolock(iVar2,lpAddend);
      if (iVar7 == 0) {
        LVar3 = InterlockedDecrement(&p_Var1->ptmbcinfo->refcount);
        if ((LVar3 == 0) && (p_Var1->ptmbcinfo != (pthreadmbcinfo)&DAT_00456950)) {
          FID_conflict__free(p_Var1->ptmbcinfo);
        }
        p_Var1->ptmbcinfo = lpAddend;
        InterlockedIncrement((LONG *)lpAddend);
        if (((p_Var1->_ownlocale & 2) == 0) && (((byte)DAT_00456e20 & 1) == 0)) {
          __lock(0xd);
          _DAT_00457db8 = lpAddend->mbcodepage;
          _DAT_00457dbc = lpAddend->ismbcodepage;
          _DAT_00457db4 = lpAddend->mblocalename;
          for (iVar2 = 0; iVar2 < 5; iVar2 = iVar2 + 1) {
            (&DAT_00457dc0)[iVar2] = lpAddend->mbulinfo[iVar2];
          }
          for (iVar2 = 0; iVar2 < 0x101; iVar2 = iVar2 + 1) {
            (&DAT_00456748)[iVar2] = lpAddend->mbctype[iVar2];
          }
          for (; iVar6 < 0x100; iVar6 = iVar6 + 1) {
            (&DAT_00456850)[iVar6] = lpAddend->mbcasemap[iVar6];
          }
          LVar3 = InterlockedDecrement((LONG *)PTR_DAT_00456650);
          if ((LVar3 == 0) && (PTR_DAT_00456650 != &DAT_00456950)) {
            FID_conflict__free(PTR_DAT_00456650);
          }
          PTR_DAT_00456650 = (undefined *)lpAddend;
          InterlockedIncrement((LONG *)lpAddend);
          FUN_0042ca0e();
        }
      }
      else if (iVar7 == -1) {
        if (lpAddend != (threadmbcinfostruct *)&DAT_00456950) {
          FID_conflict__free(lpAddend);
        }
        piVar4 = __errno();
        *piVar4 = 0x16;
      }
    }
  }
  return iVar7;
}



/* Function: FUN_0042ca0e */

void FUN_0042ca0e(void)

{
  FUN_0042c0f6(0xd);
  return;
}



/* Function: __setmbcp_nolock */

/* Library Function - Single Match
    __setmbcp_nolock
   
   Library: Visual Studio 2012 Release */

void __cdecl __setmbcp_nolock(int param_1,threadmbcinfostruct *param_2)

{
  byte bVar1;
  uint uVar2;
  uint uVar3;
  BOOL BVar4;
  BYTE *pBVar5;
  uchar *puVar6;
  wchar_t *pwVar7;
  byte *pbVar8;
  int iVar9;
  byte *pbVar10;
  ushort *puVar11;
  int extraout_EDX;
  ushort *puVar12;
  uint uVar13;
  int local_20;
  _cpinfo local_1c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  uVar2 = getSystemCP(param_1);
  if (uVar2 != 0) {
    uVar13 = 0;
    local_20 = 0;
    uVar3 = 0;
LAB_0042ca83:
    if (*(uint *)((int)&DAT_00456658 + uVar3) != uVar2) goto code_r0x0042ca8f;
    FUN_004267c0((uint *)param_2->mbctype,0,0x101);
    pbVar8 = (byte *)(local_20 * 0x30 + 0x456668);
    do {
      bVar1 = *pbVar8;
      pbVar10 = pbVar8;
      while ((bVar1 != 0 && (bVar1 = pbVar10[1], bVar1 != 0))) {
        for (uVar3 = (uint)*pbVar10; (uVar3 <= bVar1 && (uVar3 < 0x100)); uVar3 = uVar3 + 1) {
          param_2->mbctype[uVar3 + 1] = param_2->mbctype[uVar3 + 1] | (&DAT_00456654)[uVar13];
          bVar1 = pbVar10[1];
        }
        pbVar10 = pbVar10 + 2;
        bVar1 = *pbVar10;
      }
      uVar13 = uVar13 + 1;
      pbVar8 = pbVar8 + 8;
    } while (uVar13 < 4);
    param_2->mbcodepage = uVar2;
    param_2->ismbcodepage = 1;
    pwVar7 = CPtoLocaleName(uVar2);
    param_2->mblocalename = pwVar7;
    puVar11 = param_2->mbulinfo;
    puVar12 = (ushort *)(&DAT_0045665c + extraout_EDX);
    iVar9 = 6;
    do {
      *puVar11 = *puVar12;
      puVar12 = puVar12 + 1;
      puVar11 = puVar11 + 1;
      iVar9 = iVar9 + -1;
    } while (iVar9 != 0);
    goto LAB_0042cc21;
  }
  setSBCS(param_2);
LAB_0042cc2b:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
code_r0x0042ca8f:
  local_20 = local_20 + 1;
  uVar3 = uVar3 + 0x30;
  if (0xef < uVar3) goto code_r0x0042ca9d;
  goto LAB_0042ca83;
code_r0x0042ca9d:
  if (((uVar2 != 65000) && (uVar2 != 0xfde9)) &&
     (BVar4 = IsValidCodePage(uVar2 & 0xffff), BVar4 != 0)) {
    BVar4 = GetCPInfo(uVar2,&local_1c);
    if (BVar4 == 0) {
      if (DAT_00457dcc != 0) {
        setSBCS(param_2);
      }
    }
    else {
      FUN_004267c0((uint *)param_2->mbctype,0,0x101);
      param_2->mbcodepage = uVar2;
      param_2->mblocalename = (wchar_t *)0x0;
      if (local_1c.MaxCharSize < 2) {
        param_2->ismbcodepage = 0;
      }
      else {
        pBVar5 = local_1c.LeadByte;
        while ((local_1c.LeadByte[0] != 0 && (bVar1 = pBVar5[1], bVar1 != 0))) {
          for (uVar2 = (uint)*pBVar5; uVar2 <= bVar1; uVar2 = uVar2 + 1) {
            param_2->mbctype[uVar2 + 1] = param_2->mbctype[uVar2 + 1] | 4;
          }
          pBVar5 = pBVar5 + 2;
          local_1c.LeadByte[0] = *pBVar5;
        }
        puVar6 = param_2->mbctype + 2;
        iVar9 = 0xfe;
        do {
          *puVar6 = *puVar6 | 8;
          puVar6 = puVar6 + 1;
          iVar9 = iVar9 + -1;
        } while (iVar9 != 0);
        pwVar7 = CPtoLocaleName(param_2->mbcodepage);
        param_2->mblocalename = pwVar7;
        param_2->ismbcodepage = 1;
      }
      param_2->mbulinfo[0] = 0;
      param_2->mbulinfo[1] = 0;
      param_2->mbulinfo[2] = 0;
      param_2->mbulinfo[3] = 0;
      param_2->mbulinfo[4] = 0;
      param_2->mbulinfo[5] = 0;
LAB_0042cc21:
      setSBUpLow(param_2);
    }
  }
  goto LAB_0042cc2b;
}



/* Function: __FindPESection */

/* Library Function - Single Match
    __FindPESection
   
   Library: Visual Studio 2012 Release */

PIMAGE_SECTION_HEADER __cdecl __FindPESection(PBYTE pImageBase,DWORD_PTR rva)

{
  int iVar1;
  PIMAGE_SECTION_HEADER p_Var2;
  uint uVar3;
  
  iVar1 = *(int *)(pImageBase + 0x3c);
  uVar3 = 0;
  p_Var2 = (PIMAGE_SECTION_HEADER)
           (pImageBase + *(ushort *)(pImageBase + iVar1 + 0x14) + 0x18 + iVar1);
  if (*(ushort *)(pImageBase + iVar1 + 6) != 0) {
    do {
      if ((p_Var2->VirtualAddress <= rva) &&
         (rva < (p_Var2->Misc).PhysicalAddress + p_Var2->VirtualAddress)) {
        return p_Var2;
      }
      uVar3 = uVar3 + 1;
      p_Var2 = p_Var2 + 1;
    } while (uVar3 < *(ushort *)(pImageBase + iVar1 + 6));
  }
  return (PIMAGE_SECTION_HEADER)0x0;
}



/* Function: __IsNonwritableInCurrentImage */

/* Library Function - Single Match
    __IsNonwritableInCurrentImage
   
   Library: Visual Studio 2012 Release */

BOOL __cdecl __IsNonwritableInCurrentImage(PBYTE pTarget)

{
  BOOL BVar1;
  PIMAGE_SECTION_HEADER p_Var2;
  void *local_14;
  code *pcStack_10;
  uint local_c;
  undefined4 local_8;
  
  pcStack_10 = __except_handler4;
  local_14 = ExceptionList;
  local_c = DAT_004560d0 ^ 0x4541e0;
  ExceptionList = &local_14;
  local_8 = 0;
  BVar1 = __ValidateImageBase((PBYTE)&IMAGE_DOS_HEADER_00400000);
  if (BVar1 != 0) {
    p_Var2 = __FindPESection((PBYTE)&IMAGE_DOS_HEADER_00400000,(DWORD_PTR)(pTarget + -0x400000));
    if (p_Var2 != (PIMAGE_SECTION_HEADER)0x0) {
      ExceptionList = local_14;
      return ~(p_Var2->Characteristics >> 0x1f) & 1;
    }
  }
  ExceptionList = local_14;
  return 0;
}



/* Function: __ValidateImageBase */

/* Library Function - Single Match
    __ValidateImageBase
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release */

BOOL __cdecl __ValidateImageBase(PBYTE pImageBase)

{
  uint uVar1;
  
  if (*(short *)pImageBase != 0x5a4d) {
    return 0;
  }
  uVar1 = 0;
  if (*(int *)(pImageBase + *(int *)(pImageBase + 0x3c)) == 0x4550) {
    uVar1 = (uint)((short)*(int *)((int)(pImageBase + *(int *)(pImageBase + 0x3c)) + 0x18) == 0x10b)
    ;
  }
  return uVar1;
}



/* Function: __onexit */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    __onexit
   
   Library: Visual Studio 2012 Release */

_onexit_t __cdecl __onexit(_onexit_t _Func)

{
  _onexit_t p_Var1;
  
  FUN_004297db();
  p_Var1 = (_onexit_t)__onexit_nolock(_Func);
  FUN_0042cdea();
  return p_Var1;
}



/* Function: FUN_0042cdea */

void FUN_0042cdea(void)

{
  FUN_004297e4();
  return;
}



/* Function: __onexit_nolock */

/* Library Function - Single Match
    __onexit_nolock
   
   Library: Visual Studio 2012 Release */

PVOID __cdecl __onexit_nolock(PVOID param_1)

{
  undefined4 *_Memory;
  undefined4 *puVar1;
  size_t sVar2;
  size_t sVar3;
  PVOID pvVar4;
  int iVar5;
  
  _Memory = (undefined4 *)DecodePointer(DAT_00459060);
  puVar1 = (undefined4 *)DecodePointer(DAT_0045905c);
  if ((puVar1 < _Memory) || (iVar5 = (int)puVar1 - (int)_Memory, iVar5 + 4U < 4)) {
    return (PVOID)0x0;
  }
  sVar2 = __msize(_Memory);
  if (sVar2 < iVar5 + 4U) {
    sVar3 = 0x800;
    if (sVar2 < 0x800) {
      sVar3 = sVar2;
    }
    if ((sVar3 + sVar2 < sVar2) ||
       (pvVar4 = __realloc_crt(_Memory,sVar3 + sVar2), pvVar4 == (void *)0x0)) {
      if (sVar2 + 0x10 < sVar2) {
        return (PVOID)0x0;
      }
      pvVar4 = __realloc_crt(_Memory,sVar2 + 0x10);
      if (pvVar4 == (void *)0x0) {
        return (PVOID)0x0;
      }
    }
    puVar1 = (undefined4 *)((int)pvVar4 + (iVar5 >> 2) * 4);
    DAT_00459060 = EncodePointer(pvVar4);
  }
  pvVar4 = EncodePointer(param_1);
  *puVar1 = pvVar4;
  DAT_0045905c = EncodePointer(puVar1 + 1);
  return param_1;
}



/* Function: _atexit */

/* Library Function - Single Match
    _atexit
   
   Library: Visual Studio 2012 Release */

int __cdecl _atexit(_func_4879 *param_1)

{
  _onexit_t p_Var1;
  
  p_Var1 = __onexit((_onexit_t)param_1);
  return (p_Var1 != (_onexit_t)0x0) - 1;
}



/* Function: __initp_misc_cfltcvt_tab */

/* Library Function - Single Match
    __initp_misc_cfltcvt_tab
   
   Library: Visual Studio 2012 Release */

void __initp_misc_cfltcvt_tab(void)

{
  PVOID pvVar1;
  uint uVar2;
  
  uVar2 = 0;
  do {
    pvVar1 = EncodePointer(*(PVOID *)((int)&PTR_LAB_00456b70 + uVar2));
    *(PVOID *)((int)&PTR_LAB_00456b70 + uVar2) = pvVar1;
    uVar2 = uVar2 + 4;
  } while (uVar2 < 0x28);
  return;
}



/* Function: FUN_0042ceda */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __cdecl FUN_0042ceda(undefined4 param_1)

{
  _DAT_00457dd0 = param_1;
  return;
}



/* Function: FUN_0042cee7 */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __cdecl FUN_0042cee7(undefined4 param_1)

{
  _DAT_00457dd4 = param_1;
  return;
}



/* Function: FUN_0042cef4 */

void FUN_0042cef4(void)

{
  DecodePointer(DAT_00457de0);
  return;
}



/* Function: FUN_0042cf01 */

void __cdecl FUN_0042cf01(undefined4 param_1)

{
  DAT_00457dd8 = param_1;
  DAT_00457ddc = param_1;
  DAT_00457de0 = param_1;
  DAT_00457de4 = param_1;
  return;
}



/* Function: _raise */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    _raise
   
   Library: Visual Studio 2012 Release */

int __cdecl _raise(int _SigNum)

{
  bool bVar1;
  uint uVar2;
  int *piVar3;
  code *pcVar4;
  PVOID pvVar5;
  int iVar6;
  _ptiddata p_Var7;
  int local_38;
  void *local_34;
  undefined4 *local_20;
  
  bVar1 = false;
  p_Var7 = (_ptiddata)0x0;
  if (_SigNum < 0xc) {
    if (_SigNum != 0xb) {
      if (_SigNum == 2) {
        local_20 = &DAT_00457dd8;
        pvVar5 = DAT_00457dd8;
        goto LAB_0042cfd4;
      }
      if (_SigNum != 4) {
        if (_SigNum == 6) goto LAB_0042cfac;
        if (_SigNum != 8) goto LAB_0042cf9a;
      }
    }
    p_Var7 = __getptd_noexit();
    if (p_Var7 == (_ptiddata)0x0) {
      return -1;
    }
    uVar2 = siglookup(_SigNum,(uint)p_Var7->_pxcptacttab);
    local_20 = (undefined4 *)(uVar2 + 8);
    pcVar4 = (code *)*local_20;
  }
  else {
    if (_SigNum == 0xf) {
      local_20 = &DAT_00457de4;
      pvVar5 = DAT_00457de4;
    }
    else if (_SigNum == 0x15) {
      local_20 = &DAT_00457ddc;
      pvVar5 = DAT_00457ddc;
    }
    else {
      if (_SigNum != 0x16) {
LAB_0042cf9a:
        piVar3 = __errno();
        *piVar3 = 0x16;
        FUN_0042acd7();
        return -1;
      }
LAB_0042cfac:
      local_20 = &DAT_00457de0;
      pvVar5 = DAT_00457de0;
    }
LAB_0042cfd4:
    bVar1 = true;
    pcVar4 = (code *)DecodePointer(pvVar5);
  }
  if (pcVar4 == (code *)0x1) {
    return 0;
  }
  if (pcVar4 == (code *)0x0) {
    __exit(3);
  }
  if (bVar1) {
    __lock(0);
  }
  if (((_SigNum == 8) || (_SigNum == 0xb)) || (_SigNum == 4)) {
    local_34 = p_Var7->_tpxcptinfoptrs;
    p_Var7->_tpxcptinfoptrs = (void *)0x0;
    if (_SigNum == 8) {
      local_38 = p_Var7->_tfpecode;
      p_Var7->_tfpecode = 0x8c;
      goto LAB_0042d033;
    }
  }
  else {
LAB_0042d033:
    iVar6 = DAT_0044ea08;
    if (_SigNum == 8) {
      for (; iVar6 < DAT_0044ea0c + DAT_0044ea08; iVar6 = iVar6 + 1) {
        *(undefined4 *)(iVar6 * 0xc + 8 + (int)p_Var7->_pxcptacttab) = 0;
      }
      goto LAB_0042d074;
    }
  }
  pvVar5 = EncodePointer((PVOID)0x0);
  *local_20 = pvVar5;
LAB_0042d074:
  FUN_0042d098();
  if (_SigNum == 8) {
    (*pcVar4)(8,p_Var7->_tfpecode);
  }
  else {
    (*pcVar4)(_SigNum);
    if ((_SigNum != 0xb) && (_SigNum != 4)) {
      return 0;
    }
  }
  p_Var7->_tpxcptinfoptrs = local_34;
  if (_SigNum == 8) {
    p_Var7->_tfpecode = local_38;
  }
  return 0;
}



/* Function: FUN_0042d098 */

void FUN_0042d098(void)

{
  int unaff_EBX;
  
  if (unaff_EBX != 0) {
    FUN_0042c0f6(0);
  }
  return;
}



/* Function: siglookup */

/* Library Function - Single Match
    _siglookup
   
   Library: Visual Studio 2012 Release */

uint __cdecl siglookup(int param_1,uint param_2)

{
  uint uVar1;
  
  uVar1 = param_2;
  do {
    if (*(int *)(uVar1 + 4) == param_1) break;
    uVar1 = uVar1 + 0xc;
  } while (uVar1 < DAT_0044ea00 * 0xc + param_2);
  if ((DAT_0044ea00 * 0xc + param_2 <= uVar1) || (*(int *)(uVar1 + 4) != param_1)) {
    uVar1 = 0;
  }
  return uVar1;
}



/* Function: _strlen */

/* Library Function - Single Match
    _strlen
   
   Library: Visual Studio */

size_t __cdecl _strlen(char *_Str)

{
  uint uVar1;
  uint *puVar2;
  uint *puVar3;
  
  uVar1 = (uint)_Str & 3;
  puVar2 = (uint *)_Str;
  while (uVar1 != 0) {
    uVar1 = *puVar2;
    puVar2 = (uint *)((int)puVar2 + 1);
    if ((char)uVar1 == '\0') goto LAB_0042d173;
    uVar1 = (uint)puVar2 & 3;
  }
  do {
    do {
      puVar3 = puVar2;
      puVar2 = puVar3 + 1;
    } while (((*puVar3 ^ 0xffffffff ^ *puVar3 + 0x7efefeff) & 0x81010100) == 0);
    uVar1 = *puVar3;
    if ((char)uVar1 == '\0') {
      return (int)puVar3 - (int)_Str;
    }
    if ((char)(uVar1 >> 8) == '\0') {
      return (size_t)((int)puVar3 + (1 - (int)_Str));
    }
    if ((uVar1 & 0xff0000) == 0) {
      return (size_t)((int)puVar3 + (2 - (int)_Str));
    }
  } while ((uVar1 & 0xff000000) != 0);
LAB_0042d173:
  return (size_t)((int)puVar2 + (-1 - (int)_Str));
}



/* Function: _wcscat_s */

/* Library Function - Single Match
    _wcscat_s
   
   Library: Visual Studio 2012 Release */

errno_t __cdecl _wcscat_s(wchar_t *_Dst,rsize_t _SizeInWords,wchar_t *_Src)

{
  wchar_t wVar1;
  int *piVar2;
  wchar_t *pwVar3;
  int iVar4;
  int iStack_10;
  
  if ((_Dst != (wchar_t *)0x0) && (_SizeInWords != 0)) {
    pwVar3 = _Dst;
    if (_Src != (wchar_t *)0x0) {
      do {
        if (*pwVar3 == L'\0') break;
        pwVar3 = pwVar3 + 1;
        _SizeInWords = _SizeInWords - 1;
      } while (_SizeInWords != 0);
      if (_SizeInWords != 0) {
        iVar4 = (int)pwVar3 - (int)_Src;
        do {
          wVar1 = *_Src;
          *(wchar_t *)(iVar4 + (int)_Src) = wVar1;
          _Src = _Src + 1;
          if (wVar1 == L'\0') break;
          _SizeInWords = _SizeInWords - 1;
        } while (_SizeInWords != 0);
        if (_SizeInWords != 0) {
          return 0;
        }
        *_Dst = L'\0';
        piVar2 = __errno();
        iStack_10 = 0x22;
        goto LAB_0042d1c1;
      }
    }
    *_Dst = L'\0';
  }
  piVar2 = __errno();
  iStack_10 = 0x16;
LAB_0042d1c1:
  *piVar2 = iStack_10;
  FUN_0042acd7();
  return iStack_10;
}



/* Function: _wcscpy_s */

/* Library Function - Single Match
    _wcscpy_s
   
   Library: Visual Studio 2012 Release */

errno_t __cdecl _wcscpy_s(wchar_t *_Dst,rsize_t _SizeInWords,wchar_t *_Src)

{
  wchar_t wVar1;
  int *piVar2;
  int iVar3;
  
  if ((_Dst != (wchar_t *)0x0) && (_SizeInWords != 0)) {
    if (_Src != (wchar_t *)0x0) {
      iVar3 = (int)_Dst - (int)_Src;
      do {
        wVar1 = *_Src;
        *(wchar_t *)(iVar3 + (int)_Src) = wVar1;
        _Src = _Src + 1;
        if (wVar1 == L'\0') break;
        _SizeInWords = _SizeInWords - 1;
      } while (_SizeInWords != 0);
      if (_SizeInWords != 0) {
        return 0;
      }
      *_Dst = L'\0';
      piVar2 = __errno();
      iVar3 = 0x22;
      goto LAB_0042d22c;
    }
    *_Dst = L'\0';
  }
  piVar2 = __errno();
  iVar3 = 0x16;
LAB_0042d22c:
  *piVar2 = iVar3;
  FUN_0042acd7();
  return iVar3;
}



/* Function: _wcslen */

/* Library Function - Single Match
    _wcslen
   
   Libraries: Visual Studio 2010 Release, Visual Studio 2012 Release, Visual Studio 2015 Release,
   Visual Studio 2019 Release */

size_t __cdecl _wcslen(wchar_t *_Str)

{
  wchar_t wVar1;
  wchar_t *pwVar2;
  
  pwVar2 = _Str;
  do {
    wVar1 = *pwVar2;
    pwVar2 = pwVar2 + 1;
  } while (wVar1 != L'\0');
  return ((int)pwVar2 - (int)_Str >> 1) - 1;
}



/* Function: _wcsncpy_s */

/* Library Function - Single Match
    _wcsncpy_s
   
   Library: Visual Studio 2012 Release */

errno_t __cdecl _wcsncpy_s(wchar_t *_Dst,rsize_t _SizeInWords,wchar_t *_Src,rsize_t _MaxCount)

{
  wchar_t wVar1;
  int *piVar2;
  wchar_t *pwVar3;
  rsize_t rVar4;
  int iVar5;
  
  if (_MaxCount == 0) {
    if (_Dst == (wchar_t *)0x0) {
      if (_SizeInWords == 0) {
        return 0;
      }
    }
    else {
LAB_0042d29b:
      if (_SizeInWords != 0) {
        if (_MaxCount == 0) {
          *_Dst = L'\0';
          return 0;
        }
        if (_Src != (wchar_t *)0x0) {
          rVar4 = _SizeInWords;
          if (_MaxCount == 0xffffffff) {
            iVar5 = (int)_Dst - (int)_Src;
            do {
              wVar1 = *_Src;
              *(wchar_t *)(iVar5 + (int)_Src) = wVar1;
              _Src = _Src + 1;
              if (wVar1 == L'\0') break;
              rVar4 = rVar4 - 1;
            } while (rVar4 != 0);
          }
          else {
            pwVar3 = _Dst;
            do {
              wVar1 = *(wchar_t *)(((int)_Src - (int)_Dst) + (int)pwVar3);
              *pwVar3 = wVar1;
              pwVar3 = pwVar3 + 1;
              if ((wVar1 == L'\0') || (rVar4 = rVar4 - 1, rVar4 == 0)) break;
              _MaxCount = _MaxCount - 1;
            } while (_MaxCount != 0);
            if (_MaxCount == 0) {
              *pwVar3 = L'\0';
            }
          }
          if (rVar4 != 0) {
            return 0;
          }
          if (_MaxCount == 0xffffffff) {
            _Dst[_SizeInWords - 1] = L'\0';
            return 0x50;
          }
          *_Dst = L'\0';
          piVar2 = __errno();
          iVar5 = 0x22;
          goto LAB_0042d2c0;
        }
        *_Dst = L'\0';
      }
    }
  }
  else if (_Dst != (wchar_t *)0x0) goto LAB_0042d29b;
  piVar2 = __errno();
  iVar5 = 0x16;
LAB_0042d2c0:
  *piVar2 = iVar5;
  FUN_0042acd7();
  return iVar5;
}



/* Function: ___crtMessageBoxW */

/* Library Function - Single Match
    ___crtMessageBoxW
   
   Library: Visual Studio 2012 Release */

int __cdecl ___crtMessageBoxW(LPCWSTR _LpText,LPCWSTR _LpCaption,UINT _UType)

{
  bool bVar1;
  code *pcVar2;
  undefined3 extraout_var;
  HMODULE hModule;
  DWORD DVar3;
  FARPROC pFVar4;
  BOOL BVar5;
  int iVar6;
  code *pcVar7;
  int iVar8;
  undefined1 local_28 [4];
  LPCWSTR local_24;
  LPCWSTR local_20;
  code *local_1c;
  code *local_18;
  undefined1 local_14 [8];
  byte local_c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_20 = _LpText;
  iVar8 = 0;
  local_24 = _LpCaption;
  pcVar2 = (code *)EncodePointer((PVOID)0x0);
  local_1c = pcVar2;
  bVar1 = FUN_0042a347();
  local_18 = (code *)CONCAT31(extraout_var,bVar1);
  if (DAT_00457df4 == (PVOID)0x0) {
    hModule = LoadLibraryExW(L"USER32.DLL",(HANDLE)0x0,0x800);
    if (((hModule == (HMODULE)0x0) &&
        ((DVar3 = GetLastError(), DVar3 != 0x57 ||
         (hModule = LoadLibraryW(L"USER32.DLL"), hModule == (HMODULE)0x0)))) ||
       (pFVar4 = GetProcAddress(hModule,"MessageBoxW"), pFVar4 == (FARPROC)0x0)) goto LAB_0042d50d;
    DAT_00457df4 = EncodePointer(pFVar4);
    pFVar4 = GetProcAddress(hModule,"GetActiveWindow");
    DAT_00457df8 = (code *)EncodePointer(pFVar4);
    pFVar4 = GetProcAddress(hModule,"GetLastActivePopup");
    DAT_00457dfc = (code *)EncodePointer(pFVar4);
    pFVar4 = GetProcAddress(hModule,"GetUserObjectInformationW");
    DAT_00457e04 = (code *)EncodePointer(pFVar4);
    pcVar2 = local_1c;
    if (DAT_00457e04 != (code *)0x0) {
      pFVar4 = GetProcAddress(hModule,"GetProcessWindowStation");
      DAT_00457e00 = (code *)EncodePointer(pFVar4);
      pcVar2 = local_1c;
    }
  }
  BVar5 = IsDebuggerPresent();
  if (BVar5 == 0) {
    if (local_18 != (code *)0x0) {
      DecodePointer(DAT_00457df4);
      goto LAB_0042d50d;
    }
  }
  else {
    if (local_20 != (LPCWSTR)0x0) {
      OutputDebugStringW(local_20);
    }
    if (local_18 != (code *)0x0) goto LAB_0042d50d;
  }
  if ((DAT_00457e00 == pcVar2) || (DAT_00457e04 == pcVar2)) {
LAB_0042d4c3:
    if ((((DAT_00457df8 != pcVar2) &&
         (pcVar7 = (code *)DecodePointer(DAT_00457df8), pcVar7 != (code *)0x0)) &&
        (iVar8 = (*pcVar7)(), iVar8 != 0)) &&
       ((DAT_00457dfc != pcVar2 &&
        (pcVar2 = (code *)DecodePointer(DAT_00457dfc), pcVar2 != (code *)0x0)))) {
      iVar8 = (*pcVar2)(iVar8);
    }
  }
  else {
    local_18 = (code *)DecodePointer(DAT_00457e00);
    local_1c = (code *)DecodePointer(DAT_00457e04);
    if (((local_18 == (code *)0x0) || (local_1c == (code *)0x0)) ||
       (((iVar6 = (*local_18)(), iVar6 != 0 &&
         (iVar6 = (*local_1c)(iVar6,1,local_14,0xc,local_28), iVar6 != 0)) && ((local_c & 1) != 0)))
       ) goto LAB_0042d4c3;
    _UType = _UType | 0x200000;
  }
  pcVar2 = (code *)DecodePointer(DAT_00457df4);
  if (pcVar2 != (code *)0x0) {
    (*pcVar2)(iVar8,local_20,local_24,_UType);
  }
LAB_0042d50d:
  iVar8 = __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return iVar8;
}



/* Function: __local_unwind4 */

/* Library Function - Single Match
    __local_unwind4
   
   Libraries: Visual Studio 2017 Debug, Visual Studio 2017 Release, Visual Studio 2019 Debug, Visual
   Studio 2019 Release */

void __cdecl __local_unwind4(uint *param_1,int param_2,uint param_3)

{
  undefined4 *puVar1;
  uint uVar2;
  void *pvStack_28;
  undefined1 *puStack_24;
  uint local_20;
  uint uStack_1c;
  int iStack_18;
  uint *puStack_14;
  
  puStack_14 = param_1;
  iStack_18 = param_2;
  uStack_1c = param_3;
  puStack_24 = &LAB_0042d5b0;
  pvStack_28 = ExceptionList;
  local_20 = DAT_004560d0 ^ (uint)&pvStack_28;
  ExceptionList = &pvStack_28;
  while( true ) {
    uVar2 = *(uint *)(param_2 + 0xc);
    if ((uVar2 == 0xfffffffe) || ((param_3 != 0xfffffffe && (uVar2 <= param_3)))) break;
    puVar1 = (undefined4 *)((*(uint *)(param_2 + 8) ^ *param_1) + 0x10 + uVar2 * 0xc);
    *(undefined4 *)(param_2 + 0xc) = *puVar1;
    if (puVar1[1] == 0) {
      __NLG_Notify(0x101);
      FUN_0042f3a4();
    }
  }
  ExceptionList = pvStack_28;
  return;
}



/* Function: FUN_0042d5f6 */

void FUN_0042d5f6(int param_1)

{
  __local_unwind4(*(uint **)(param_1 + 0x28),*(int *)(param_1 + 0x18),*(uint *)(param_1 + 0x1c));
  return;
}



/* Function: _EH4_CallFilterFunc */

/* Library Function - Single Match
    @_EH4_CallFilterFunc@8
   
   Library: Visual Studio 2012 Release
   __fastcall _EH4_CallFilterFunc,8 */

void __fastcall _EH4_CallFilterFunc(undefined *param_1)

{
  (*(code *)param_1)();
  return;
}



/* Function: _EH4_TransferToHandler */

/* Library Function - Single Match
    @_EH4_TransferToHandler@8
   
   Library: Visual Studio 2012 Release
   __fastcall _EH4_TransferToHandler,8 */

void __fastcall _EH4_TransferToHandler(undefined *UNRECOVERED_JUMPTABLE)

{
  __NLG_Notify(1);
                    /* WARNING: Could not recover jumptable at 0x0042d640. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  (*(code *)UNRECOVERED_JUMPTABLE)();
  return;
}



/* Function: _EH4_GlobalUnwind2 */

/* Library Function - Single Match
    @_EH4_GlobalUnwind2@8
   
   Library: Visual Studio 2012 Release
   __fastcall _EH4_GlobalUnwind2,8 */

void __fastcall _EH4_GlobalUnwind2(PVOID param_1,PEXCEPTION_RECORD param_2)

{
  RtlUnwind(param_1,(PVOID)0x42d656,param_2,(PVOID)0x0);
  return;
}



/* Function: _EH4_LocalUnwind */

/* Library Function - Single Match
    @_EH4_LocalUnwind@16
   
   Library: Visual Studio 2012 Release
   __fastcall _EH4_LocalUnwind,16 */

void __fastcall _EH4_LocalUnwind(int param_1,uint param_2,undefined4 param_3,uint *param_4)

{
  __local_unwind4(param_4,param_1,param_2);
  return;
}



/* Function: FUN_0042d70c */

undefined ** FUN_0042d70c(void)

{
  return &PTR_DAT_00456ba0;
}



/* Function: __lock_file */

/* Library Function - Single Match
    __lock_file
   
   Library: Visual Studio 2012 Release */

void __cdecl __lock_file(FILE *_File)

{
  if ((_File < &PTR_DAT_00456ba0) || ((FILE *)&DAT_00456e00 < _File)) {
    EnterCriticalSection((LPCRITICAL_SECTION)(_File + 1));
  }
  else {
    __lock(((int)(_File + -0x22b5d) >> 5) + 0x10);
    _File->_flag = _File->_flag | 0x8000;
  }
  return;
}



/* Function: __lock_file2 */

/* Library Function - Single Match
    __lock_file2
   
   Library: Visual Studio 2012 Release */

void __cdecl __lock_file2(int _Index,void *_File)

{
  if (_Index < 0x14) {
    __lock(_Index + 0x10);
    *(uint *)((int)_File + 0xc) = *(uint *)((int)_File + 0xc) | 0x8000;
    return;
  }
  EnterCriticalSection((LPCRITICAL_SECTION)((int)_File + 0x20));
  return;
}



/* Function: __unlock_file */

/* Library Function - Single Match
    __unlock_file
   
   Libraries: Visual Studio 2008 Release, Visual Studio 2010 Release, Visual Studio 2012 Release */

void __cdecl __unlock_file(FILE *_File)

{
  if (((FILE *)0x456b9f < _File) && (_File < (FILE *)0x456e01)) {
    _File->_flag = _File->_flag & 0xffff7fff;
    FUN_0042c0f6(((int)(_File + -0x22b5d) >> 5) + 0x10);
    return;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)(_File + 1));
  return;
}



/* Function: __unlock_file2 */

/* Library Function - Single Match
    __unlock_file2
   
   Library: Visual Studio 2012 Release */

void __cdecl __unlock_file2(int _Index,void *_File)

{
  if (_Index < 0x14) {
    *(uint *)((int)_File + 0xc) = *(uint *)((int)_File + 0xc) & 0xffff7fff;
    FUN_0042c0f6(_Index + 0x10);
    return;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)((int)_File + 0x20));
  return;
}



/* Function: FUN_0042d7e8 */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void FUN_0042d7e8(void)

{
  _DAT_00457f9c = 0;
  return;
}



/* Function: __fileno */

/* Library Function - Single Match
    __fileno
   
   Library: Visual Studio 2012 Release */

int __cdecl __fileno(FILE *_File)

{
  int *piVar1;
  
  if (_File == (FILE *)0x0) {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
    return -1;
  }
  return _File->_file;
}



/* Function: FUN_0042d814 */

byte __cdecl FUN_0042d814(uint param_1)

{
  int *piVar1;
  
  if (param_1 == 0xfffffffe) {
    piVar1 = __errno();
    *piVar1 = 9;
  }
  else {
    if ((-1 < (int)param_1) && (param_1 < DAT_00459054)) {
      return *(byte *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + (param_1 & 0x1f) * 0x40) & 0x40;
    }
    piVar1 = __errno();
    *piVar1 = 9;
    FUN_0042acd7();
  }
  return 0;
}



/* Function: FUN_0042d868 */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

undefined4 __cdecl FUN_0042d868(WCHAR *param_1,WCHAR *param_2,WCHAR *param_3)

{
  ulong *puVar1;
  int *piVar2;
  undefined4 uVar3;
  int iVar4;
  
  if (param_1 == (WCHAR *)0xfffffffe) {
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
  }
  else {
    if ((-1 < (int)param_1) && (param_1 < DAT_00459054)) {
      iVar4 = ((uint)param_1 & 0x1f) * 0x40;
      if ((*(byte *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + iVar4) & 1) != 0) {
        ___lock_fhandle((int)param_1);
        if ((*(byte *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + iVar4) & 1) == 0) {
          piVar2 = __errno();
          *piVar2 = 9;
          puVar1 = ___doserrno();
          *puVar1 = 0;
          uVar3 = 0xffffffff;
        }
        else {
          uVar3 = FUN_0042d94a(param_1,param_2,param_3);
        }
        FUN_0042d921();
        return uVar3;
      }
    }
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
    FUN_0042acd7();
  }
  return 0xffffffff;
}



/* Function: FUN_0042d921 */

void FUN_0042d921(void)

{
  int unaff_ESI;
  
  __unlock_fhandle(unaff_ESI);
  return;
}



/* Function: FUN_0042d94a */

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void __cdecl FUN_0042d94a(WCHAR *param_1,WCHAR *param_2,WCHAR *param_3)

{
  char cVar1;
  WCHAR WVar2;
  byte bVar3;
  wint_t wVar4;
  ulong *puVar5;
  int *piVar6;
  undefined3 extraout_var;
  _ptiddata p_Var7;
  BOOL BVar8;
  UINT CodePage;
  WCHAR *pWVar9;
  int iVar10;
  WCHAR *pWVar11;
  WCHAR *pWVar12;
  uint uVar13;
  char cVar14;
  int unaff_ESI;
  int iVar15;
  WCHAR *pWVar16;
  WCHAR *pWVar17;
  ushort uVar18;
  DWORD local_1ae8;
  char local_1ae1;
  WCHAR *local_1ae0;
  WCHAR *local_1adc;
  int local_1ad8;
  int local_1ad4;
  WCHAR *local_1ad0;
  WCHAR *local_1acc;
  WCHAR *local_1ac8;
  WCHAR *local_1ac4;
  WCHAR *local_1ac0;
  WCHAR local_1abc [852];
  CHAR local_1414 [3416];
  WCHAR local_6bc [854];
  undefined2 local_10;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  pWVar16 = (WCHAR *)0x0;
  local_1ac4 = param_1;
  local_1ac0 = param_2;
  local_1ac8 = (WCHAR *)0x0;
  local_1ad8 = 0;
  if (param_3 == (WCHAR *)0x0) goto LAB_0042e167;
  if (param_2 == (WCHAR *)0x0) {
    puVar5 = ___doserrno();
    *puVar5 = 0;
    piVar6 = __errno();
    *piVar6 = 0x16;
    FUN_0042acd7();
    goto LAB_0042e167;
  }
  local_1ad4 = (int)param_1 >> 5;
  iVar15 = ((uint)param_1 & 0x1f) * 0x40;
  cVar14 = (char)(*(char *)(iVar15 + 0x24 + (&DAT_00457610)[local_1ad4]) * '\x02') >> 1;
  if (((cVar14 == '\x02') || (cVar14 == '\x01')) && ((~(uint)param_3 & 1) == 0)) {
    puVar5 = ___doserrno();
    *puVar5 = 0;
    piVar6 = __errno();
    *piVar6 = 0x16;
    FUN_0042acd7();
    goto LAB_0042e167;
  }
  if ((*(byte *)(iVar15 + 4 + (&DAT_00457610)[local_1ad4]) & 0x20) != 0) {
    __lseeki64_nolock((int)param_1,0x200000000,unaff_ESI);
  }
  bVar3 = FUN_0042d814((uint)local_1ac4);
  pWVar17 = pWVar16;
  if ((CONCAT31(extraout_var,bVar3) == 0) ||
     ((*(byte *)(iVar15 + 4 + (&DAT_00457610)[local_1ad4]) & 0x80) == 0)) {
LAB_0042dd52:
    if ((*(byte *)(iVar15 + 4 + (&DAT_00457610)[local_1ad4]) & 0x80) == 0) {
      BVar8 = WriteFile(*(HANDLE *)(iVar15 + (&DAT_00457610)[local_1ad4]),local_1ac0,(DWORD)param_3,
                        (LPDWORD)&local_1adc,(LPOVERLAPPED)0x0);
      if (BVar8 == 0) {
LAB_0042e0e8:
        pWVar11 = (WCHAR *)GetLastError();
        pWVar17 = pWVar16;
      }
      else {
        pWVar11 = (WCHAR *)0x0;
        pWVar17 = local_1adc;
      }
LAB_0042e0f6:
      if (pWVar17 != (WCHAR *)0x0) goto LAB_0042e167;
      goto LAB_0042e0fa;
    }
    pWVar11 = (WCHAR *)0x0;
    local_1acc = (WCHAR *)0x0;
    if (cVar14 == '\0') {
      local_1ac8 = local_1ac0;
      if (param_3 == (WCHAR *)0x0) goto LAB_0042e122;
      do {
        pWVar16 = (WCHAR *)((int)local_1ac8 - (int)local_1ac0);
        pWVar9 = local_1abc;
        local_1ac4 = (WCHAR *)0x0;
        do {
          if (param_3 <= pWVar16) break;
          local_1ae1 = (char)*local_1ac8;
          local_1ac8 = (WCHAR *)((int)local_1ac8 + 1);
          pWVar16 = (WCHAR *)((int)pWVar16 + 1);
          if (local_1ae1 == '\n') {
            local_1ad8 = local_1ad8 + 1;
            *(char *)pWVar9 = '\r';
            pWVar9 = (WCHAR *)((int)pWVar9 + 1);
            local_1ac4 = (WCHAR *)((int)local_1ac4 + 1);
          }
          *(char *)pWVar9 = local_1ae1;
          pWVar9 = (WCHAR *)((int)pWVar9 + 1);
          local_1ac4 = (WCHAR *)((int)local_1ac4 + 1);
        } while (local_1ac4 < (WCHAR *)0x13ff);
        BVar8 = WriteFile(*(HANDLE *)(iVar15 + (&DAT_00457610)[local_1ad4]),local_1abc,
                          (int)pWVar9 - (int)local_1abc,(LPDWORD)&local_1adc,(LPOVERLAPPED)0x0);
        pWVar16 = pWVar17;
        if (BVar8 == 0) goto LAB_0042e0e8;
        pWVar17 = (WCHAR *)((int)pWVar17 + (int)local_1adc);
      } while (((int)pWVar9 - (int)local_1abc <= (int)local_1adc) &&
              ((WCHAR *)((int)local_1ac8 - (int)local_1ac0) < param_3));
      goto LAB_0042e0f6;
    }
    if (cVar14 == '\x02') {
      local_1ac4 = local_1ac0;
      if (param_3 != (WCHAR *)0x0) {
        do {
          local_1ae8 = 0;
          pWVar16 = (WCHAR *)((int)local_1ac4 - (int)local_1ac0);
          uVar13 = 0;
          pWVar9 = local_1abc;
          do {
            if (param_3 <= pWVar16) break;
            WVar2 = *local_1ac4;
            local_1ac4 = local_1ac4 + 1;
            pWVar16 = pWVar16 + 1;
            if (WVar2 == L'\n') {
              *pWVar9 = L'\r';
              local_1ad8 = local_1ad8 + 2;
              pWVar9 = pWVar9 + 1;
              uVar13 = uVar13 + 2;
            }
            *pWVar9 = WVar2;
            uVar13 = uVar13 + 2;
            pWVar9 = pWVar9 + 1;
          } while (uVar13 < 0x13fe);
          BVar8 = WriteFile(*(HANDLE *)(iVar15 + (&DAT_00457610)[local_1ad4]),local_1abc,
                            (int)pWVar9 - (int)local_1abc,(LPDWORD)&local_1adc,(LPOVERLAPPED)0x0);
          pWVar16 = local_1ac8;
          if (BVar8 == 0) goto LAB_0042e0e8;
          local_1ac8 = (WCHAR *)((int)local_1ac8 + (int)local_1adc);
          pWVar11 = local_1acc;
          pWVar17 = local_1ac8;
        } while (((int)pWVar9 - (int)local_1abc <= (int)local_1adc) &&
                ((WCHAR *)((int)local_1ac4 - (int)local_1ac0) < param_3));
        goto LAB_0042e0f6;
      }
    }
    else {
      local_1ae0 = local_1ac0;
      if (param_3 != (WCHAR *)0x0) {
        do {
          local_1ae8 = 0;
          pWVar17 = (WCHAR *)((int)local_1ae0 - (int)local_1ac0);
          uVar13 = 0;
          pWVar16 = local_6bc;
          do {
            if (param_3 <= pWVar17) break;
            WVar2 = *local_1ae0;
            local_1ae0 = local_1ae0 + 1;
            pWVar17 = pWVar17 + 1;
            if (WVar2 == L'\n') {
              *pWVar16 = L'\r';
              pWVar16 = pWVar16 + 1;
              uVar13 = uVar13 + 2;
            }
            *pWVar16 = WVar2;
            uVar13 = uVar13 + 2;
            pWVar16 = pWVar16 + 1;
          } while (uVar13 < 0x6a8);
          local_1ad0 = (WCHAR *)WideCharToMultiByte(0xfde9,0,local_6bc,
                                                    ((int)pWVar16 - (int)local_6bc) / 2,local_1414,
                                                    0xd55,(LPCSTR)0x0,(LPBOOL)0x0);
          pWVar17 = local_1ac8;
          pWVar11 = local_1acc;
          pWVar16 = local_1ac8;
          if (local_1ad0 == (WCHAR *)0x0) goto LAB_0042e0e8;
          local_1ac4 = (WCHAR *)0x0;
          do {
            BVar8 = WriteFile(*(HANDLE *)(iVar15 + (&DAT_00457610)[local_1ad4]),
                              local_1414 + (int)local_1ac4,(int)local_1ad0 - (int)local_1ac4,
                              (LPDWORD)&local_1adc,(LPOVERLAPPED)0x0);
            if (BVar8 == 0) {
              pWVar11 = (WCHAR *)GetLastError();
              local_1acc = pWVar11;
              break;
            }
            local_1ac4 = (WCHAR *)((int)local_1ac4 + (int)local_1adc);
          } while ((int)local_1ac4 < (int)local_1ad0);
        } while (((int)local_1ad0 <= (int)local_1ac4) &&
                (local_1ac8 = (WCHAR *)((int)local_1ae0 - (int)local_1ac0), pWVar17 = local_1ac8,
                local_1ac8 < param_3));
        goto LAB_0042e0f6;
      }
    }
  }
  else {
    p_Var7 = __getptd();
    local_1ac4 = (WCHAR *)(uint)(p_Var7->ptlocinfo->locale_name[2] == (wchar_t *)0x0);
    BVar8 = GetConsoleMode(*(HANDLE *)(iVar15 + (&DAT_00457610)[local_1ad4]),&local_1ae8);
    if ((BVar8 == 0) || ((local_1ac4 != (WCHAR *)0x0 && (cVar14 == '\0')))) goto LAB_0042dd52;
    CodePage = GetConsoleCP();
    local_1ae0 = (WCHAR *)0x0;
    local_1ad0 = local_1ac0;
    pWVar11 = local_1ac4;
    if (param_3 != (WCHAR *)0x0) {
      pWVar9 = (WCHAR *)0x0;
      local_1acc = (WCHAR *)0x0;
      pWVar12 = local_1ac0;
      do {
        pWVar16 = pWVar17;
        if (cVar14 == '\0') {
          cVar1 = (char)*pWVar12;
          local_1ac4 = (WCHAR *)(uint)(cVar1 == '\n');
          iVar10 = (&DAT_00457610)[local_1ad4];
          if (*(int *)(iVar15 + 0x38 + iVar10) == 0) {
            iVar10 = _isleadbyte(CONCAT22(cVar1 >> 7,(short)cVar1));
            if (iVar10 == 0) {
              uVar18 = 1;
              pWVar11 = local_1ad0;
              goto LAB_0042db78;
            }
            if ((uint)(((int)local_1ac0 - (int)local_1ad0) + (int)param_3) < 2) {
              pWVar17 = (WCHAR *)((int)pWVar17 + 1);
              *(char *)(iVar15 + 0x34 + (&DAT_00457610)[local_1ad4]) = (char)*local_1ad0;
              *(undefined4 *)(iVar15 + 0x38 + (&DAT_00457610)[local_1ad4]) = 1;
              pWVar11 = local_1ac4;
              break;
            }
            iVar10 = _mbtowc((wchar_t *)&local_1ac8,(char *)local_1ad0,2);
            pWVar11 = local_1ac4;
            if (iVar10 == -1) break;
            local_1ad0 = (WCHAR *)((int)local_1ad0 + 1);
            local_1acc = (WCHAR *)((int)local_1acc + 1);
          }
          else {
            local_10._0_1_ = *(CHAR *)(iVar15 + 0x34 + iVar10);
            uVar18 = 2;
            *(undefined4 *)(iVar15 + 0x38 + iVar10) = 0;
            pWVar11 = &local_10;
            local_10._1_1_ = cVar1;
LAB_0042db78:
            iVar10 = _mbtowc((wchar_t *)&local_1ac8,(char *)pWVar11,(uint)uVar18);
            pWVar11 = local_1ac4;
            if (iVar10 == -1) break;
          }
          local_1ad0 = (WCHAR *)((int)local_1ad0 + 1);
          local_1acc = (WCHAR *)((int)local_1acc + 1);
          local_1ae8 = WideCharToMultiByte(CodePage,0,(LPCWSTR)&local_1ac8,1,(LPSTR)&local_10,5,
                                           (LPCSTR)0x0,(LPBOOL)0x0);
          pWVar11 = local_1ac4;
          if (local_1ae8 == 0) break;
          BVar8 = WriteFile(*(HANDLE *)(iVar15 + (&DAT_00457610)[local_1ad4]),&local_10,local_1ae8,
                            (LPDWORD)&local_1ae0,(LPOVERLAPPED)0x0);
          if (BVar8 == 0) goto LAB_0042e0e8;
          pWVar17 = (WCHAR *)((int)local_1acc + local_1ad8);
          pWVar11 = local_1ac4;
          if ((int)local_1ae0 < (int)local_1ae8) break;
          pWVar9 = local_1acc;
          pWVar12 = local_1ad0;
          pWVar16 = pWVar17;
          if (local_1ac4 != (WCHAR *)0x0) {
            local_10._0_1_ = '\r';
            BVar8 = WriteFile(*(HANDLE *)(iVar15 + (&DAT_00457610)[local_1ad4]),&local_10,1,
                              (LPDWORD)&local_1ae0,(LPOVERLAPPED)0x0);
            if (BVar8 == 0) goto LAB_0042e0e8;
            pWVar11 = local_1ac4;
            if ((int)local_1ae0 < 1) break;
            local_1ad8 = local_1ad8 + 1;
            pWVar9 = local_1acc;
            pWVar12 = local_1ad0;
            pWVar16 = (WCHAR *)((int)pWVar17 + 1);
          }
        }
        else {
          if ((cVar14 == '\x01') || (cVar14 == '\x02')) {
            local_1ac8 = (WCHAR *)(uint)(ushort)*pWVar12;
            local_1ac4 = (WCHAR *)(uint)(*pWVar12 == L'\n');
            pWVar12 = pWVar12 + 1;
            pWVar9 = local_1acc + 1;
            local_1ad0 = pWVar12;
            local_1acc = pWVar9;
          }
          if ((cVar14 == '\x01') || (cVar14 == '\x02')) {
            wVar4 = __putwch_nolock((wchar_t)local_1ac8);
            if (wVar4 != (wint_t)local_1ac8) goto LAB_0042e0e8;
            pWVar9 = local_1acc;
            pWVar12 = local_1ad0;
            pWVar16 = pWVar17 + 1;
            if (local_1ac4 != (WCHAR *)0x0) {
              local_1ac8 = (WCHAR *)0xd;
              wVar4 = __putwch_nolock(L'\r');
              if (wVar4 != (wint_t)local_1ac8) goto LAB_0042e0e8;
              local_1ad8 = local_1ad8 + 1;
              pWVar9 = local_1acc;
              pWVar12 = local_1ad0;
              pWVar16 = (WCHAR *)((int)pWVar17 + 3);
            }
          }
        }
        pWVar17 = pWVar16;
        pWVar11 = local_1ac4;
      } while (pWVar9 < param_3);
      goto LAB_0042e0f6;
    }
LAB_0042e0fa:
    if (pWVar11 != (WCHAR *)0x0) {
      if (pWVar11 == (WCHAR *)0x5) {
        piVar6 = __errno();
        *piVar6 = 9;
        puVar5 = ___doserrno();
        *puVar5 = 5;
      }
      else {
        FID_conflict___dosmaperr((ulong)pWVar11);
      }
      goto LAB_0042e167;
    }
  }
LAB_0042e122:
  if (((*(byte *)(iVar15 + 4 + (&DAT_00457610)[local_1ad4]) & 0x40) == 0) ||
     ((char)*local_1ac0 != '\x1a')) {
    piVar6 = __errno();
    *piVar6 = 0x1c;
    puVar5 = ___doserrno();
    *puVar5 = 0;
  }
LAB_0042e167:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0042e174 */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

longlong __cdecl FUN_0042e174(uint param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)

{
  ulong *puVar1;
  int *piVar2;
  int iVar3;
  longlong lVar4;
  int in_stack_ffffffc4;
  
  if (param_1 == 0xfffffffe) {
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
  }
  else {
    if ((-1 < (int)param_1) && (param_1 < DAT_00459054)) {
      iVar3 = (param_1 & 0x1f) * 0x40;
      if ((*(byte *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + iVar3) & 1) != 0) {
        ___lock_fhandle(param_1);
        if ((*(byte *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + iVar3) & 1) == 0) {
          piVar2 = __errno();
          *piVar2 = 9;
          puVar1 = ___doserrno();
          *puVar1 = 0;
          lVar4 = -1;
        }
        else {
          lVar4 = __lseeki64_nolock(param_1,CONCAT44(param_4,param_3),in_stack_ffffffc4);
        }
        FUN_0042e246();
        return lVar4;
      }
    }
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
    FUN_0042acd7();
  }
  return -1;
}



/* Function: FUN_0042e246 */

void FUN_0042e246(void)

{
  int unaff_EDI;
  
  __unlock_fhandle(unaff_EDI);
  return;
}



/* Function: __lseeki64_nolock */

/* Library Function - Single Match
    __lseeki64_nolock
   
   Library: Visual Studio 2012 Release */

longlong __cdecl __lseeki64_nolock(int _FileHandle,longlong _Offset,int _Origin)

{
  byte *pbVar1;
  LARGE_INTEGER liDistanceToMove;
  HANDLE hFile;
  int *piVar2;
  BOOL BVar3;
  DWORD DVar4;
  DWORD unaff_EDI;
  undefined4 local_c;
  undefined4 local_8;
  
  hFile = (HANDLE)FUN_0042f556(_FileHandle);
  if (hFile == (HANDLE)0xffffffff) {
    piVar2 = __errno();
    *piVar2 = 9;
  }
  else {
    liDistanceToMove.s.HighPart = (LONG)&local_c;
    liDistanceToMove.s.LowPart = (undefined4)_Offset;
    BVar3 = SetFilePointerEx(hFile,liDistanceToMove,_Offset._4_4_,unaff_EDI);
    if (BVar3 != 0) {
      pbVar1 = (byte *)((&DAT_00457610)[_FileHandle >> 5] + 4 + (_FileHandle & 0x1fU) * 0x40);
      *pbVar1 = *pbVar1 & 0xfd;
      goto LAB_0042e2dd;
    }
    DVar4 = GetLastError();
    FID_conflict___dosmaperr(DVar4);
  }
  local_c = 0xffffffff;
  local_8 = 0xffffffff;
LAB_0042e2dd:
  return CONCAT44(local_8,local_c);
}



/* Function: __getbuf */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */
/* Library Function - Single Match
    __getbuf
   
   Library: Visual Studio 2012 Release */

void __cdecl __getbuf(FILE *_File)

{
  char *pcVar1;
  
  _DAT_00457e08 = _DAT_00457e08 + 1;
  pcVar1 = (char *)__malloc_crt(0x1000);
  _File->_base = pcVar1;
  if (pcVar1 == (char *)0x0) {
    _File->_flag = _File->_flag | 4;
    _File->_base = (char *)&_File->_charbuf;
    _File->_bufsiz = 2;
  }
  else {
    _File->_flag = _File->_flag | 8;
    _File->_bufsiz = 0x1000;
  }
  _File->_cnt = 0;
  _File->_ptr = _File->_base;
  return;
}



/* Function: __isleadbyte_l */

/* Library Function - Single Match
    __isleadbyte_l
   
   Library: Visual Studio 2012 Release */

int __cdecl __isleadbyte_l(int _C,_locale_t _Locale)

{
  ushort uVar1;
  int local_14 [2];
  int local_c;
  char local_8;
  
  _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)local_14,_Locale);
  uVar1 = *(ushort *)(*(int *)(local_14[0] + 0x90) + (_C & 0xffU) * 2);
  if (local_8 != '\0') {
    *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
  }
  return uVar1 & 0x8000;
}



/* Function: _isleadbyte */

/* Library Function - Single Match
    _isleadbyte
   
   Library: Visual Studio 2012 Release */

int __cdecl _isleadbyte(int _C)

{
  int iVar1;
  
  iVar1 = __isleadbyte_l(_C,(_locale_t)0x0);
  return iVar1;
}



/* Function: FUN_0042e36e */

bool FUN_0042e36e(void)

{
  return DAT_00457e0c == (DAT_004560d0 | 1);
}



/* Function: __wctomb_s_l */

/* Library Function - Single Match
    __wctomb_s_l
   
   Library: Visual Studio 2012 Release */

errno_t __cdecl
__wctomb_s_l(int *_SizeConverted,char *_MbCh,size_t _SizeInBytes,wchar_t _WCh,_locale_t _Locale)

{
  char *lpMultiByteStr;
  size_t cbMultiByte;
  int *piVar1;
  int iVar2;
  DWORD DVar3;
  int iVar4;
  int local_14 [2];
  int local_c;
  char local_8;
  
  cbMultiByte = _SizeInBytes;
  lpMultiByteStr = _MbCh;
  if ((_MbCh == (char *)0x0) && (_SizeInBytes != 0)) {
    if (_SizeConverted != (int *)0x0) {
      *_SizeConverted = 0;
    }
    return 0;
  }
  if (_SizeConverted != (int *)0x0) {
    *_SizeConverted = -1;
  }
  if (0x7fffffff < _SizeInBytes) {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
    return 0x16;
  }
  _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)local_14,_Locale);
  iVar4 = 0;
  if (*(int *)(local_14[0] + 0xa8) == 0) {
    if ((ushort)_WCh < 0x100) {
      if (lpMultiByteStr != (char *)0x0) {
        if (cbMultiByte == 0) goto LAB_0042e491;
        *lpMultiByteStr = (char)_WCh;
      }
      if (_SizeConverted != (int *)0x0) {
        *_SizeConverted = 1;
      }
      goto LAB_0042e416;
    }
    if ((lpMultiByteStr != (char *)0x0) && (cbMultiByte != 0)) {
      FUN_004267c0((uint *)lpMultiByteStr,0,cbMultiByte);
    }
  }
  else {
    _MbCh = (char *)0x0;
    iVar2 = WideCharToMultiByte(*(UINT *)(local_14[0] + 4),0,&_WCh,1,lpMultiByteStr,cbMultiByte,
                                (LPCSTR)0x0,(LPBOOL)&_MbCh);
    if (iVar2 == 0) {
      DVar3 = GetLastError();
      if (DVar3 == 0x7a) {
        if ((lpMultiByteStr != (char *)0x0) && (cbMultiByte != 0)) {
          FUN_004267c0((uint *)lpMultiByteStr,0,cbMultiByte);
        }
LAB_0042e491:
        piVar1 = __errno();
        iVar4 = 0x22;
        *piVar1 = 0x22;
        FUN_0042acd7();
        goto LAB_0042e416;
      }
    }
    else if (_MbCh == (char *)0x0) {
      if (_SizeConverted != (int *)0x0) {
        *_SizeConverted = iVar2;
      }
      goto LAB_0042e416;
    }
  }
  piVar1 = __errno();
  *piVar1 = 0x2a;
  piVar1 = __errno();
  iVar4 = *piVar1;
LAB_0042e416:
  if (local_8 != '\0') {
    *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
  }
  return iVar4;
}



/* Function: _wctomb_s */

/* Library Function - Single Match
    _wctomb_s
   
   Library: Visual Studio 2012 Release */

errno_t __cdecl _wctomb_s(int *_SizeConverted,char *_MbCh,rsize_t _SizeInBytes,wchar_t _WCh)

{
  errno_t eVar1;
  
  eVar1 = __wctomb_s_l(_SizeConverted,_MbCh,_SizeInBytes,_WCh,(_locale_t)0x0);
  return eVar1;
}



/* Function: __aulldvrm */

/* Library Function - Single Match
    __aulldvrm
   
   Library: Visual Studio */

undefined8 __aulldvrm(uint param_1,uint param_2,uint param_3,uint param_4)

{
  ulonglong uVar1;
  longlong lVar2;
  uint uVar3;
  int iVar4;
  uint uVar5;
  uint uVar6;
  uint uVar7;
  uint uVar8;
  uint uVar9;
  
  uVar3 = param_1;
  uVar8 = param_4;
  uVar6 = param_2;
  uVar9 = param_3;
  if (param_4 == 0) {
    uVar3 = param_2 / param_3;
    iVar4 = (int)(((ulonglong)param_2 % (ulonglong)param_3 << 0x20 | (ulonglong)param_1) /
                 (ulonglong)param_3);
  }
  else {
    do {
      uVar5 = uVar8 >> 1;
      uVar9 = uVar9 >> 1 | (uint)((uVar8 & 1) != 0) << 0x1f;
      uVar7 = uVar6 >> 1;
      uVar3 = uVar3 >> 1 | (uint)((uVar6 & 1) != 0) << 0x1f;
      uVar8 = uVar5;
      uVar6 = uVar7;
    } while (uVar5 != 0);
    uVar1 = CONCAT44(uVar7,uVar3) / (ulonglong)uVar9;
    iVar4 = (int)uVar1;
    lVar2 = (ulonglong)param_3 * (uVar1 & 0xffffffff);
    uVar3 = (uint)((ulonglong)lVar2 >> 0x20);
    uVar8 = uVar3 + iVar4 * param_4;
    if (((CARRY4(uVar3,iVar4 * param_4)) || (param_2 < uVar8)) ||
       ((param_2 <= uVar8 && (param_1 < (uint)lVar2)))) {
      iVar4 = iVar4 + -1;
    }
    uVar3 = 0;
  }
  return CONCAT44(uVar3,iVar4);
}



/* Function: _strcpy_s */

/* Library Function - Single Match
    _strcpy_s
   
   Library: Visual Studio 2012 Release */

errno_t __cdecl _strcpy_s(char *_Dst,rsize_t _SizeInBytes,char *_Src)

{
  char cVar1;
  int *piVar2;
  int iVar3;
  
  if ((_Dst != (char *)0x0) && (_SizeInBytes != 0)) {
    if (_Src != (char *)0x0) {
      iVar3 = (int)_Dst - (int)_Src;
      do {
        cVar1 = *_Src;
        _Src[iVar3] = cVar1;
        _Src = _Src + 1;
        if (cVar1 == '\0') break;
        _SizeInBytes = _SizeInBytes - 1;
      } while (_SizeInBytes != 0);
      if (_SizeInBytes != 0) {
        return 0;
      }
      *_Dst = '\0';
      piVar2 = __errno();
      iVar3 = 0x22;
      goto LAB_0042e577;
    }
    *_Dst = '\0';
  }
  piVar2 = __errno();
  iVar3 = 0x16;
LAB_0042e577:
  *piVar2 = iVar3;
  FUN_0042acd7();
  return iVar3;
}



/* Function: _abort */

/* Library Function - Single Match
    _abort
   
   Library: Visual Studio 2012 Release */

void __cdecl _abort(void)

{
  code *pcVar1;
  int iVar2;
  BOOL BVar3;
  
  iVar2 = FUN_0042cef4();
  if (iVar2 != 0) {
    _raise(0x16);
  }
  if ((DAT_00456e24 & 2) != 0) {
    BVar3 = IsProcessorFeaturePresent(0x17);
    if (BVar3 != 0) {
      pcVar1 = (code *)swi(0x29);
      (*pcVar1)();
    }
    __call_reportfault(3,0x40000015,1);
  }
  __exit(3);
  pcVar1 = (code *)swi(3);
  (*pcVar1)();
  return;
}



/* Function: _realloc */

/* Library Function - Single Match
    _realloc
   
   Library: Visual Studio 2012 Release */

void * __cdecl _realloc(void *_Memory,size_t _NewSize)

{
  void *pvVar1;
  LPVOID pvVar2;
  int iVar3;
  int *piVar4;
  DWORD DVar5;
  
  if (_Memory == (void *)0x0) {
    pvVar1 = _malloc(_NewSize);
    return pvVar1;
  }
  if (_NewSize == 0) {
    FID_conflict__free(_Memory);
  }
  else {
    do {
      if (0xffffffe0 < _NewSize) {
        __callnewh(_NewSize);
        piVar4 = __errno();
        *piVar4 = 0xc;
        return (void *)0x0;
      }
      if (_NewSize == 0) {
        _NewSize = 1;
      }
      pvVar2 = HeapReAlloc(DAT_00457608,0,_Memory,_NewSize);
      if (pvVar2 != (LPVOID)0x0) {
        return pvVar2;
      }
      if (DAT_00457e10 == 0) {
        piVar4 = __errno();
        DVar5 = GetLastError();
        iVar3 = __get_errno_from_oserr(DVar5);
        *piVar4 = iVar3;
        return (void *)0x0;
      }
      iVar3 = __callnewh(_NewSize);
    } while (iVar3 != 0);
    piVar4 = __errno();
    DVar5 = GetLastError();
    iVar3 = __get_errno_from_oserr(DVar5);
    *piVar4 = iVar3;
  }
  return (void *)0x0;
}



/* Function: __calloc_impl */

/* Library Function - Single Match
    __calloc_impl
   
   Library: Visual Studio 2012 Release */

LPVOID __cdecl __calloc_impl(uint param_1,uint param_2,int *param_3)

{
  int iVar1;
  LPVOID pvVar2;
  uint dwBytes;
  
  if ((param_1 == 0) || (param_2 <= 0xffffffe0 / param_1)) {
    dwBytes = param_1 * param_2;
    if (dwBytes == 0) {
      dwBytes = 1;
    }
    do {
      pvVar2 = (LPVOID)0x0;
      if ((dwBytes < 0xffffffe1) &&
         (pvVar2 = HeapAlloc(DAT_00457608,8,dwBytes), pvVar2 != (LPVOID)0x0)) {
        return pvVar2;
      }
      if (DAT_00457e10 == 0) {
        if (param_3 != (int *)0x0) {
          *param_3 = 0xc;
          return pvVar2;
        }
        return pvVar2;
      }
      iVar1 = __callnewh(dwBytes);
    } while (iVar1 != 0);
    if (param_3 == (int *)0x0) {
      return (LPVOID)0x0;
    }
  }
  else {
    param_3 = __errno();
  }
  *param_3 = 0xc;
  return (LPVOID)0x0;
}



/* Function: ___free_lconv_mon */

/* Library Function - Single Match
    ___free_lconv_mon
   
   Library: Visual Studio 2012 Release */

void __cdecl ___free_lconv_mon(int param_1)

{
  if (param_1 != 0) {
    if (*(undefined **)(param_1 + 0xc) != PTR_DAT_00456e3c) {
      FID_conflict__free(*(undefined **)(param_1 + 0xc));
    }
    if (*(undefined **)(param_1 + 0x10) != PTR_DAT_00456e40) {
      FID_conflict__free(*(undefined **)(param_1 + 0x10));
    }
    if (*(undefined **)(param_1 + 0x14) != PTR_DAT_00456e44) {
      FID_conflict__free(*(undefined **)(param_1 + 0x14));
    }
    if (*(undefined **)(param_1 + 0x18) != PTR_DAT_00456e48) {
      FID_conflict__free(*(undefined **)(param_1 + 0x18));
    }
    if (*(undefined **)(param_1 + 0x1c) != PTR_DAT_00456e4c) {
      FID_conflict__free(*(undefined **)(param_1 + 0x1c));
    }
    if (*(undefined **)(param_1 + 0x20) != PTR_DAT_00456e50) {
      FID_conflict__free(*(undefined **)(param_1 + 0x20));
    }
    if (*(undefined **)(param_1 + 0x24) != PTR_DAT_00456e54) {
      FID_conflict__free(*(undefined **)(param_1 + 0x24));
    }
    if (*(undefined **)(param_1 + 0x38) != PTR_DAT_00456e68) {
      FID_conflict__free(*(undefined **)(param_1 + 0x38));
    }
    if (*(undefined **)(param_1 + 0x3c) != PTR_DAT_00456e6c) {
      FID_conflict__free(*(undefined **)(param_1 + 0x3c));
    }
    if (*(undefined **)(param_1 + 0x40) != PTR_DAT_00456e70) {
      FID_conflict__free(*(undefined **)(param_1 + 0x40));
    }
    if (*(undefined **)(param_1 + 0x44) != PTR_DAT_00456e74) {
      FID_conflict__free(*(undefined **)(param_1 + 0x44));
    }
    if (*(undefined **)(param_1 + 0x48) != PTR_DAT_00456e78) {
      FID_conflict__free(*(undefined **)(param_1 + 0x48));
    }
    if (*(undefined **)(param_1 + 0x4c) != PTR_DAT_00456e7c) {
      FID_conflict__free(*(undefined **)(param_1 + 0x4c));
    }
  }
  return;
}



/* Function: ___free_lconv_num */

/* Library Function - Single Match
    ___free_lconv_num
   
   Library: Visual Studio 2012 Release */

void __cdecl ___free_lconv_num(undefined4 *param_1)

{
  if (param_1 != (undefined4 *)0x0) {
    if ((undefined *)*param_1 != PTR_DAT_00456e30) {
      FID_conflict__free((undefined *)*param_1);
    }
    if ((undefined *)param_1[1] != PTR_DAT_00456e34) {
      FID_conflict__free((undefined *)param_1[1]);
    }
    if ((undefined *)param_1[2] != PTR_DAT_00456e38) {
      FID_conflict__free((undefined *)param_1[2]);
    }
    if ((undefined *)param_1[0xc] != PTR_DAT_00456e60) {
      FID_conflict__free((undefined *)param_1[0xc]);
    }
    if ((undefined *)param_1[0xd] != PTR_DAT_00456e64) {
      FID_conflict__free((undefined *)param_1[0xd]);
    }
  }
  return;
}



/* Function: ___free_lc_time */

/* Library Function - Single Match
    ___free_lc_time
   
   Library: Visual Studio 2012 Release */

void __cdecl ___free_lc_time(undefined4 *param_1)

{
  if (param_1 != (undefined4 *)0x0) {
    FID_conflict__free((void *)param_1[1]);
    FID_conflict__free((void *)param_1[2]);
    FID_conflict__free((void *)param_1[3]);
    FID_conflict__free((void *)param_1[4]);
    FID_conflict__free((void *)param_1[5]);
    FID_conflict__free((void *)param_1[6]);
    FID_conflict__free((void *)*param_1);
    FID_conflict__free((void *)param_1[8]);
    FID_conflict__free((void *)param_1[9]);
    FID_conflict__free((void *)param_1[10]);
    FID_conflict__free((void *)param_1[0xb]);
    FID_conflict__free((void *)param_1[0xc]);
    FID_conflict__free((void *)param_1[0xd]);
    FID_conflict__free((void *)param_1[7]);
    FID_conflict__free((void *)param_1[0xe]);
    FID_conflict__free((void *)param_1[0xf]);
    FID_conflict__free((void *)param_1[0x10]);
    FID_conflict__free((void *)param_1[0x11]);
    FID_conflict__free((void *)param_1[0x12]);
    FID_conflict__free((void *)param_1[0x13]);
    FID_conflict__free((void *)param_1[0x14]);
    FID_conflict__free((void *)param_1[0x15]);
    FID_conflict__free((void *)param_1[0x16]);
    FID_conflict__free((void *)param_1[0x17]);
    FID_conflict__free((void *)param_1[0x18]);
    FID_conflict__free((void *)param_1[0x19]);
    FID_conflict__free((void *)param_1[0x1a]);
    FID_conflict__free((void *)param_1[0x1b]);
    FID_conflict__free((void *)param_1[0x1c]);
    FID_conflict__free((void *)param_1[0x1d]);
    FID_conflict__free((void *)param_1[0x1e]);
    FID_conflict__free((void *)param_1[0x1f]);
    FID_conflict__free((void *)param_1[0x20]);
    FID_conflict__free((void *)param_1[0x21]);
    FID_conflict__free((void *)param_1[0x22]);
    FID_conflict__free((void *)param_1[0x23]);
    FID_conflict__free((void *)param_1[0x24]);
    FID_conflict__free((void *)param_1[0x25]);
    FID_conflict__free((void *)param_1[0x26]);
    FID_conflict__free((void *)param_1[0x27]);
    FID_conflict__free((void *)param_1[0x28]);
    FID_conflict__free((void *)param_1[0x29]);
    FID_conflict__free((void *)param_1[0x2a]);
    FID_conflict__free((void *)param_1[0x2e]);
    FID_conflict__free((void *)param_1[0x2f]);
    FID_conflict__free((void *)param_1[0x30]);
    FID_conflict__free((void *)param_1[0x31]);
    FID_conflict__free((void *)param_1[0x32]);
    FID_conflict__free((void *)param_1[0x33]);
    FID_conflict__free((void *)param_1[0x2d]);
    FID_conflict__free((void *)param_1[0x35]);
    FID_conflict__free((void *)param_1[0x36]);
    FID_conflict__free((void *)param_1[0x37]);
    FID_conflict__free((void *)param_1[0x38]);
    FID_conflict__free((void *)param_1[0x39]);
    FID_conflict__free((void *)param_1[0x3a]);
    FID_conflict__free((void *)param_1[0x34]);
    FID_conflict__free((void *)param_1[0x3b]);
    FID_conflict__free((void *)param_1[0x3c]);
    FID_conflict__free((void *)param_1[0x3d]);
    FID_conflict__free((void *)param_1[0x3e]);
    FID_conflict__free((void *)param_1[0x3f]);
    FID_conflict__free((void *)param_1[0x40]);
    FID_conflict__free((void *)param_1[0x41]);
    FID_conflict__free((void *)param_1[0x42]);
    FID_conflict__free((void *)param_1[0x43]);
    FID_conflict__free((void *)param_1[0x44]);
    FID_conflict__free((void *)param_1[0x45]);
    FID_conflict__free((void *)param_1[0x46]);
    FID_conflict__free((void *)param_1[0x47]);
    FID_conflict__free((void *)param_1[0x48]);
    FID_conflict__free((void *)param_1[0x49]);
    FID_conflict__free((void *)param_1[0x4a]);
    FID_conflict__free((void *)param_1[0x4b]);
    FID_conflict__free((void *)param_1[0x4c]);
    FID_conflict__free((void *)param_1[0x4d]);
    FID_conflict__free((void *)param_1[0x4e]);
    FID_conflict__free((void *)param_1[0x4f]);
    FID_conflict__free((void *)param_1[0x50]);
    FID_conflict__free((void *)param_1[0x51]);
    FID_conflict__free((void *)param_1[0x52]);
    FID_conflict__free((void *)param_1[0x53]);
    FID_conflict__free((void *)param_1[0x54]);
    FID_conflict__free((void *)param_1[0x55]);
    FID_conflict__free((void *)param_1[0x56]);
    FID_conflict__free((void *)param_1[0x57]);
    FID_conflict__free((void *)param_1[0x58]);
  }
  return;
}



/* Function: __crtLCMapStringA_stat */

/* WARNING: Function: __alloca_probe_16 replaced with injection: alloca_probe */
/* Library Function - Single Match
    int __cdecl __crtLCMapStringA_stat(struct localeinfo_struct *,wchar_t const *,unsigned long,char
   const *,int,char *,int,int,int)
   
   Library: Visual Studio 2012 Release */

int __cdecl
__crtLCMapStringA_stat
          (localeinfo_struct *param_1,wchar_t *param_2,ulong param_3,char *param_4,int param_5,
          char *param_6,int param_7,int param_8,int param_9)

{
  uint _Size;
  uint uVar1;
  char *pcVar2;
  int iVar3;
  uint cchWideChar;
  LPCWSTR lpWideCharStr;
  uint uVar4;
  undefined4 *puVar5;
  int iVar6;
  LPCWSTR pWVar7;
  
  uVar1 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  pcVar2 = param_4;
  iVar6 = param_5;
  if (0 < param_5) {
    do {
      iVar6 = iVar6 + -1;
      if (*pcVar2 == '\0') goto LAB_0042ec21;
      pcVar2 = pcVar2 + 1;
    } while (iVar6 != 0);
    iVar6 = -1;
LAB_0042ec21:
    iVar3 = (param_5 - iVar6) + -1;
    iVar6 = param_5 - iVar6;
    if (param_5 <= iVar3) {
      iVar6 = iVar3;
    }
  }
  if (param_8 == 0) {
    param_8 = param_1->locinfo->lc_codepage;
  }
  cchWideChar = MultiByteToWideChar(param_8,(uint)(param_9 != 0) * 8 + 1,param_4,iVar6,(LPWSTR)0x0,0
                                   );
  if (cchWideChar == 0) goto LAB_0042edcc;
  if (((int)cchWideChar < 1) || (0xffffffe0 / cchWideChar < 2)) {
    lpWideCharStr = (LPCWSTR)0x0;
  }
  else {
    uVar4 = cchWideChar * 2 + 8;
    if (uVar4 < 0x401) {
      pWVar7 = (LPCWSTR)&stack0xffffffe8;
      lpWideCharStr = (LPCWSTR)&stack0xffffffe8;
      if (&stack0x00000000 != (undefined1 *)0x18) {
LAB_0042ecb9:
        lpWideCharStr = pWVar7 + 4;
      }
    }
    else {
      lpWideCharStr = (LPCWSTR)_malloc(uVar4);
      if (lpWideCharStr != (LPCWSTR)0x0) {
        lpWideCharStr[0] = L'\xdddd';
        lpWideCharStr[1] = L'\0';
        pWVar7 = lpWideCharStr;
        goto LAB_0042ecb9;
      }
    }
  }
  if (lpWideCharStr == (LPCWSTR)0x0) goto LAB_0042edcc;
  iVar6 = MultiByteToWideChar(param_8,1,param_4,iVar6,lpWideCharStr,cchWideChar);
  if ((iVar6 != 0) &&
     (uVar4 = FUN_0042f01c(param_2,param_3,lpWideCharStr,cchWideChar,(LPWSTR)0x0,0), uVar4 != 0)) {
    if ((param_3 & 0x400) == 0) {
      if (((int)uVar4 < 1) || (0xffffffe0 / uVar4 < 2)) {
        pWVar7 = (LPCWSTR)0x0;
LAB_0042ed7f:
        if (pWVar7 != (LPCWSTR)0x0) {
          iVar6 = FUN_0042f01c(param_2,param_3,lpWideCharStr,cchWideChar,pWVar7,uVar4);
          if (iVar6 != 0) {
            if (param_7 == 0) {
              param_7 = 0;
              param_6 = (LPSTR)0x0;
            }
            WideCharToMultiByte(param_8,0,pWVar7,uVar4,param_6,param_7,(LPCSTR)0x0,(LPBOOL)0x0);
          }
          __freea(pWVar7);
        }
      }
      else {
        _Size = uVar4 * 2 + 8;
        if (_Size < 0x401) {
          puVar5 = (undefined4 *)&stack0xffffffe8;
          if (&stack0x00000000 != (undefined1 *)0x18) {
LAB_0042ed78:
            pWVar7 = (LPCWSTR)(puVar5 + 2);
            goto LAB_0042ed7f;
          }
        }
        else {
          puVar5 = (undefined4 *)_malloc(_Size);
          if (puVar5 != (undefined4 *)0x0) {
            *puVar5 = 0xdddd;
            goto LAB_0042ed78;
          }
        }
      }
    }
    else if ((param_7 != 0) && ((int)uVar4 <= param_7)) {
      FUN_0042f01c(param_2,param_3,lpWideCharStr,cchWideChar,(LPWSTR)param_6,param_7);
    }
  }
  __freea(lpWideCharStr);
LAB_0042edcc:
  iVar6 = __security_check_cookie(uVar1 ^ (uint)&stack0xfffffffc);
  return iVar6;
}



/* Function: ___crtLCMapStringA */

/* Library Function - Single Match
    ___crtLCMapStringA
   
   Library: Visual Studio 2012 Release */

int __cdecl
___crtLCMapStringA(_locale_t _Plocinfo,LPCWSTR _LocaleName,DWORD _DwMapFlag,LPCSTR _LpSrcStr,
                  int _CchSrc,LPSTR _LpDestStr,int _CchDest,int _Code_page,BOOL _BError)

{
  int iVar1;
  localeinfo_struct local_14;
  int local_c;
  char local_8;
  
  _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)&local_14,_Plocinfo);
  iVar1 = __crtLCMapStringA_stat
                    (&local_14,_LocaleName,_DwMapFlag,_LpSrcStr,_CchSrc,_LpDestStr,_CchDest,
                     _Code_page,_BError);
  if (local_8 != '\0') {
    *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
  }
  return iVar1;
}



/* Function: __freea */

/* Library Function - Single Match
    __freea
   
   Library: Visual Studio 2012 Release */

void __cdecl __freea(void *_Memory)

{
  if ((_Memory != (void *)0x0) && (*(int *)((int)_Memory + -8) == 0xdddd)) {
    FID_conflict__free((int *)((int)_Memory + -8));
  }
  return;
}



/* Function: __crtGetStringTypeA_stat */

/* WARNING: Function: __alloca_probe_16 replaced with injection: alloca_probe */
/* Library Function - Single Match
    int __cdecl __crtGetStringTypeA_stat(struct localeinfo_struct *,unsigned long,char const
   *,int,unsigned short *,int,int)
   
   Library: Visual Studio 2012 Release */

int __cdecl
__crtGetStringTypeA_stat
          (localeinfo_struct *param_1,ulong param_2,char *param_3,int param_4,ushort *param_5,
          int param_6,int param_7)

{
  uint _Size;
  uint uVar1;
  uint cchWideChar;
  undefined4 *puVar2;
  int iVar3;
  LPCWSTR lpWideCharStr;
  
  uVar1 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  if (param_6 == 0) {
    param_6 = param_1->locinfo->lc_codepage;
  }
  cchWideChar = MultiByteToWideChar(param_6,(uint)(param_7 != 0) * 8 + 1,param_3,param_4,(LPWSTR)0x0
                                    ,0);
  if (cchWideChar == 0) goto LAB_0042ef1a;
  if (((int)cchWideChar < 1) || (0x7ffffff0 < cchWideChar)) {
    lpWideCharStr = (LPCWSTR)0x0;
  }
  else {
    _Size = cchWideChar * 2 + 8;
    if (_Size < 0x401) {
      puVar2 = (undefined4 *)&stack0xffffffec;
      if (&stack0x00000000 == (undefined1 *)0x14) goto LAB_0042ef1a;
    }
    else {
      puVar2 = (undefined4 *)_malloc(_Size);
      if (puVar2 == (undefined4 *)0x0) goto LAB_0042ef1a;
      *puVar2 = 0xdddd;
    }
    lpWideCharStr = (LPCWSTR)(puVar2 + 2);
  }
  if (lpWideCharStr != (LPCWSTR)0x0) {
    FUN_004267c0((uint *)lpWideCharStr,0,cchWideChar * 2);
    iVar3 = MultiByteToWideChar(param_6,1,param_3,param_4,lpWideCharStr,cchWideChar);
    if (iVar3 != 0) {
      GetStringTypeW(param_2,lpWideCharStr,iVar3,param_5);
    }
    __freea(lpWideCharStr);
  }
LAB_0042ef1a:
  iVar3 = __security_check_cookie(uVar1 ^ (uint)&stack0xfffffffc);
  return iVar3;
}



/* Function: ___crtGetStringTypeA */

/* Library Function - Single Match
    ___crtGetStringTypeA
   
   Library: Visual Studio 2012 Release */

BOOL __cdecl
___crtGetStringTypeA
          (_locale_t _Plocinfo,DWORD _DWInfoType,LPCSTR _LpSrcStr,int _CchSrc,LPWORD _LpCharType,
          int _Code_page,BOOL _BError)

{
  int iVar1;
  localeinfo_struct local_14;
  int local_c;
  char local_8;
  
  _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)&local_14,_Plocinfo);
  iVar1 = __crtGetStringTypeA_stat
                    (&local_14,_DWInfoType,_LpSrcStr,_CchSrc,_LpCharType,_Code_page,_BError);
  if (local_8 != '\0') {
    *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
  }
  return iVar1;
}



/* Function: __msize */

/* Library Function - Single Match
    __msize
   
   Library: Visual Studio 2012 Release */

size_t __cdecl __msize(void *_Memory)

{
  int *piVar1;
  SIZE_T SVar2;
  
  if (_Memory == (void *)0x0) {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
    return 0xffffffff;
  }
  SVar2 = HeapSize(DAT_00457608,0,_Memory);
  return SVar2;
}



/* Function: FID_conflict:GetTableIndexFromLocaleName */

/* Library Function - Multiple Matches With Different Base Names
    int __cdecl GetTableIndexFromLocaleName(wchar_t const *)
    int __cdecl ATL::_AtlGetTableIndexFromLocaleName(wchar_t const *)
    _GetTableIndexFromLocaleName
   
   Libraries: Visual Studio 2015 Release, Visual Studio 2017 Release, Visual Studio 2019 Release */

undefined4 __cdecl FID_conflict_GetTableIndexFromLocaleName(wchar_t *param_1)

{
  int iVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  
  iVar4 = 0;
  iVar2 = 0xe3;
  do {
    iVar3 = (iVar2 + iVar4) / 2;
    iVar1 = __wcsnicmp(param_1,*(wchar_t **)(&UNK_00451250 + iVar3 * 8),0x55);
    if (iVar1 == 0) {
      return *(undefined4 *)(&UNK_00451254 + iVar3 * 8);
    }
    if (iVar1 < 0) {
      iVar2 = iVar3 + -1;
    }
    else {
      iVar4 = iVar3 + 1;
    }
  } while (iVar4 <= iVar2);
  return 0xffffffff;
}



/* Function: FID_conflict:_AtlDownlevelLocaleNameToLCID */

/* Library Function - Multiple Matches With Different Base Names
    unsigned long __cdecl ATL::_AtlDownlevelLocaleNameToLCID(wchar_t const *)
    ___acrt_DownlevelLocaleNameToLCID
    ___crtDownlevelLocaleNameToLCID
   
   Libraries: Visual Studio 2015 Release, Visual Studio 2017 Release, Visual Studio 2019 Release */

undefined4 __cdecl FID_conflict__AtlDownlevelLocaleNameToLCID(wchar_t *param_1)

{
  uint uVar1;
  
  if (param_1 != (wchar_t *)0x0) {
    uVar1 = FID_conflict_GetTableIndexFromLocaleName(param_1);
    if ((-1 < (int)uVar1) && (uVar1 < 0xe4)) {
      return *(undefined4 *)(&DAT_00450b30 + uVar1 * 8);
    }
  }
  return 0;
}



/* Function: FUN_0042f01c */

void __cdecl
FUN_0042f01c(wchar_t *param_1,DWORD param_2,LPCWSTR param_3,int param_4,LPWSTR param_5,int param_6)

{
  LCID Locale;
  
  if ((code *)(DAT_0045904c ^ DAT_004560d0) != (code *)0x0) {
    (*(code *)(DAT_0045904c ^ DAT_004560d0))(param_1,param_2,param_3,param_4,param_5,param_6,0,0,0);
    return;
  }
  Locale = FID_conflict__AtlDownlevelLocaleNameToLCID(param_1);
  LCMapStringW(Locale,param_2,param_3,param_4,param_5,param_6);
  return;
}



/* Function: __wcsnicmp */

/* Library Function - Single Match
    __wcsnicmp
   
   Library: Visual Studio 2019 Release */

int __cdecl __wcsnicmp(wchar_t *_Str1,wchar_t *_Str2,size_t _MaxCount)

{
  wchar_t wVar1;
  int iVar2;
  wchar_t wVar3;
  
  iVar2 = 0;
  if (_MaxCount != 0) {
    iVar2 = (int)_Str1 - (int)_Str2;
    do {
      wVar3 = *(wchar_t *)(iVar2 + (int)_Str2);
      if ((0x40 < (ushort)wVar3) && ((ushort)wVar3 < 0x5b)) {
        wVar3 = wVar3 + L' ';
      }
      wVar1 = *_Str2;
      if ((0x40 < (ushort)wVar1) && ((ushort)wVar1 < 0x5b)) {
        wVar1 = wVar1 + L' ';
      }
      _Str2 = _Str2 + 1;
      _MaxCount = _MaxCount - 1;
    } while (((_MaxCount != 0) && (wVar3 != L'\0')) && (wVar3 == wVar1));
    iVar2 = (uint)(ushort)wVar3 - (uint)(ushort)wVar1;
  }
  return iVar2;
}



/* Function: __fflush_nolock */

/* Library Function - Single Match
    __fflush_nolock
   
   Library: Visual Studio 2012 Release */

int __cdecl __fflush_nolock(FILE *_File)

{
  int iVar1;
  uint uVar2;
  DWORD DVar3;
  
  if (_File == (FILE *)0x0) {
    iVar1 = flsall(0);
  }
  else {
    iVar1 = __flush(_File);
    if (iVar1 == 0) {
      if ((_File->_flag & 0x4000U) == 0) {
        iVar1 = 0;
      }
      else {
        uVar2 = __fileno(_File);
        DVar3 = FUN_0042f82c(uVar2);
        iVar1 = -(uint)(DVar3 != 0);
      }
    }
    else {
      iVar1 = -1;
    }
  }
  return iVar1;
}



/* Function: __flush */

/* Library Function - Single Match
    __flush
   
   Library: Visual Studio 2012 Release */

int __cdecl __flush(FILE *_File)

{
  WCHAR *pWVar1;
  WCHAR *pWVar2;
  int iVar3;
  WCHAR *pWVar4;
  WCHAR *pWVar5;
  
  iVar3 = 0;
  if (((((byte)_File->_flag & 3) == 2) && ((_File->_flag & 0x108U) != 0)) &&
     (pWVar4 = (WCHAR *)(_File->_ptr + -(int)_File->_base), 0 < (int)pWVar4)) {
    pWVar2 = (WCHAR *)_File->_base;
    pWVar5 = pWVar4;
    pWVar1 = (WCHAR *)__fileno(_File);
    pWVar2 = (WCHAR *)FUN_0042d868(pWVar1,pWVar2,pWVar5);
    if (pWVar2 == pWVar4) {
      if ((char)_File->_flag < '\0') {
        _File->_flag = _File->_flag & 0xfffffffd;
      }
    }
    else {
      _File->_flag = _File->_flag | 0x20;
      iVar3 = -1;
    }
  }
  _File->_cnt = 0;
  _File->_ptr = _File->_base;
  return iVar3;
}



/* Function: FUN_0042f180 */

void FUN_0042f180(void)

{
  flsall(1);
  return;
}



/* Function: flsall */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    _flsall
   
   Library: Visual Studio 2012 Release */

int __cdecl flsall(int param_1)

{
  void *_File;
  FILE *_File_00;
  int iVar1;
  int _Index;
  int iVar2;
  int local_28;
  
  iVar2 = 0;
  local_28 = 0;
  __lock(1);
  for (_Index = 0; _Index < DAT_00457fa4; _Index = _Index + 1) {
    _File = *(void **)(DAT_00457fa0 + _Index * 4);
    if ((_File != (void *)0x0) && ((*(byte *)((int)_File + 0xc) & 0x83) != 0)) {
      __lock_file2(_Index,_File);
      _File_00 = *(FILE **)(DAT_00457fa0 + _Index * 4);
      if ((_File_00->_flag & 0x83) != 0) {
        if (param_1 == 1) {
          iVar1 = __fflush_nolock(_File_00);
          if (iVar1 != -1) {
            iVar2 = iVar2 + 1;
          }
        }
        else if ((param_1 == 0) && ((_File_00->_flag & 2) != 0)) {
          iVar1 = __fflush_nolock(_File_00);
          if (iVar1 == -1) {
            local_28 = -1;
          }
        }
      }
      FUN_0042f231();
    }
  }
  FUN_0042f264();
  if (param_1 != 1) {
    iVar2 = local_28;
  }
  return iVar2;
}



/* Function: FUN_0042f231 */

void FUN_0042f231(void)

{
  int unaff_ESI;
  
  __unlock_file2(unaff_ESI,*(void **)(DAT_00457fa0 + unaff_ESI * 4));
  return;
}



/* Function: FUN_0042f264 */

void FUN_0042f264(void)

{
  FUN_0042c0f6(1);
  return;
}



/* Function: __global_unwind2 */

/* Library Function - Single Match
    __global_unwind2
   
   Library: Visual Studio */

void __cdecl __global_unwind2(PVOID param_1)

{
  RtlUnwind(param_1,(PVOID)0x42f288,(PEXCEPTION_RECORD)0x0,(PVOID)0x0);
  return;
}



/* Function: __local_unwind2 */

/* Library Function - Single Match
    __local_unwind2
   
   Libraries: Visual Studio 2017 Debug, Visual Studio 2017 Release, Visual Studio 2019 Debug, Visual
   Studio 2019 Release */

void __cdecl __local_unwind2(int param_1,uint param_2)

{
  uint uVar1;
  void *local_20;
  undefined1 *puStack_1c;
  undefined4 local_18;
  int iStack_14;
  
  iStack_14 = param_1;
  puStack_1c = &LAB_0042f290;
  local_20 = ExceptionList;
  ExceptionList = &local_20;
  while( true ) {
    uVar1 = *(uint *)(param_1 + 0xc);
    if ((uVar1 == 0xffffffff) || ((param_2 != 0xffffffff && (uVar1 <= param_2)))) break;
    local_18 = *(undefined4 *)(*(int *)(param_1 + 8) + uVar1 * 0xc);
    *(undefined4 *)(param_1 + 0xc) = local_18;
    if (*(int *)(*(int *)(param_1 + 8) + 4 + uVar1 * 0xc) == 0) {
      __NLG_Notify(0x101);
      FUN_0042f3a4();
    }
  }
  ExceptionList = local_20;
  return;
}



/* Function: __NLG_Notify */

/* Library Function - Single Match
    __NLG_Notify
   
   Libraries: Visual Studio 2017 Debug, Visual Studio 2017 Release, Visual Studio 2019 Debug, Visual
   Studio 2019 Release */

void __NLG_Notify(ulong param_1)

{
  undefined4 in_EAX;
  undefined4 unaff_EBP;
  
  DAT_00456e98 = param_1;
  DAT_00456e94 = in_EAX;
  DAT_00456e9c = unaff_EBP;
  return;
}



/* Function: FUN_0042f3a4 */

void FUN_0042f3a4(void)

{
  code *in_EAX;
  
  (*in_EAX)();
  return;
}



/* Function: FUN_0042f3a7 */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

int FUN_0042f3a7(void)

{
  FILE *pFVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  
  iVar4 = 0;
  __lock(1);
  for (iVar3 = 3; iVar3 < DAT_00457fa4; iVar3 = iVar3 + 1) {
    pFVar1 = *(FILE **)(DAT_00457fa0 + iVar3 * 4);
    if (pFVar1 != (FILE *)0x0) {
      if ((pFVar1->_flag & 0x83) != 0) {
        iVar2 = FUN_0042f97e(pFVar1);
        if (iVar2 != -1) {
          iVar4 = iVar4 + 1;
        }
      }
      if (0x13 < iVar3) {
        DeleteCriticalSection((LPCRITICAL_SECTION)(*(int *)(DAT_00457fa0 + iVar3 * 4) + 0x20));
        FID_conflict__free(*(void **)(DAT_00457fa0 + iVar3 * 4));
        *(undefined4 *)(DAT_00457fa0 + iVar3 * 4) = 0;
      }
    }
  }
  FUN_0042f43b();
  return iVar4;
}



/* Function: FUN_0042f43b */

void FUN_0042f43b(void)

{
  FUN_0042c0f6(1);
  return;
}



/* Function: ___lock_fhandle */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    ___lock_fhandle
   
   Library: Visual Studio 2012 Release */

int __cdecl ___lock_fhandle(int _Filehandle)

{
  int iVar1;
  
  iVar1 = (_Filehandle & 0x1fU) * 0x40 + (&DAT_00457610)[_Filehandle >> 5];
  if (*(int *)(iVar1 + 8) == 0) {
    __lock(10);
    if (*(int *)(iVar1 + 8) == 0) {
      InitializeCriticalSectionAndSpinCount((LPCRITICAL_SECTION)(iVar1 + 0xc),4000);
      *(int *)(iVar1 + 8) = *(int *)(iVar1 + 8) + 1;
    }
    FUN_0042f4c7();
  }
  EnterCriticalSection
            ((LPCRITICAL_SECTION)
             ((&DAT_00457610)[_Filehandle >> 5] + 0xc + (_Filehandle & 0x1fU) * 0x40));
  return 1;
}



/* Function: FUN_0042f4c7 */

void FUN_0042f4c7(void)

{
  FUN_0042c0f6(10);
  return;
}



/* Function: __free_osfhnd */

/* Library Function - Single Match
    __free_osfhnd
   
   Library: Visual Studio 2012 Release */

int __cdecl __free_osfhnd(int param_1)

{
  int *piVar1;
  ulong *puVar2;
  int iVar3;
  DWORD nStdHandle;
  
  if ((-1 < param_1) && ((uint)param_1 < DAT_00459054)) {
    iVar3 = (param_1 & 0x1fU) * 0x40;
    if (((*(byte *)(iVar3 + 4 + (&DAT_00457610)[param_1 >> 5]) & 1) != 0) &&
       (*(int *)(iVar3 + (&DAT_00457610)[param_1 >> 5]) != -1)) {
      if (DAT_00456fd8 == 1) {
        if (param_1 == 0) {
          nStdHandle = 0xfffffff6;
        }
        else if (param_1 == 1) {
          nStdHandle = 0xfffffff5;
        }
        else {
          if (param_1 != 2) goto LAB_0042f52d;
          nStdHandle = 0xfffffff4;
        }
        SetStdHandle(nStdHandle,(HANDLE)0x0);
      }
LAB_0042f52d:
      *(undefined4 *)(iVar3 + (&DAT_00457610)[param_1 >> 5]) = 0xffffffff;
      return 0;
    }
  }
  piVar1 = __errno();
  *piVar1 = 9;
  puVar2 = ___doserrno();
  *puVar2 = 0;
  return -1;
}



/* Function: FUN_0042f556 */

undefined4 __cdecl FUN_0042f556(uint param_1)

{
  ulong *puVar1;
  int *piVar2;
  int iVar3;
  
  if (param_1 == 0xfffffffe) {
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
  }
  else {
    if ((-1 < (int)param_1) && (param_1 < DAT_00459054)) {
      iVar3 = (param_1 & 0x1f) * 0x40;
      if ((*(byte *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + iVar3) & 1) != 0) {
        return *(undefined4 *)((&DAT_00457610)[(int)param_1 >> 5] + iVar3);
      }
    }
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
    FUN_0042acd7();
  }
  return 0xffffffff;
}



/* Function: __unlock_fhandle */

/* Library Function - Single Match
    __unlock_fhandle
   
   Library: Visual Studio 2012 Release */

void __cdecl __unlock_fhandle(int _Filehandle)

{
  LeaveCriticalSection
            ((LPCRITICAL_SECTION)
             ((&DAT_00457610)[_Filehandle >> 5] + (_Filehandle & 0x1fU) * 0x40 + 0xc));
  return;
}



/* Function: __mbtowc_l */

/* Library Function - Single Match
    __mbtowc_l
   
   Library: Visual Studio 2012 Release */

int __cdecl __mbtowc_l(wchar_t *_DstCh,char *_SrcCh,size_t _SrcSizeInBytes,_locale_t _Locale)

{
  uint uVar1;
  int iVar2;
  int *piVar3;
  int iVar4;
  localeinfo_struct local_14;
  int local_c;
  char local_8;
  
  if ((_SrcCh == (char *)0x0) || (_SrcSizeInBytes == 0)) {
    return 0;
  }
  if (*_SrcCh == '\0') {
    if (_DstCh == (wchar_t *)0x0) {
      return 0;
    }
    *_DstCh = L'\0';
    return 0;
  }
  _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)&local_14,_Locale);
  if ((local_14.locinfo)->locale_name[2] == (wchar_t *)0x0) {
    if (_DstCh != (wchar_t *)0x0) {
      *_DstCh = (ushort)(byte)*_SrcCh;
    }
    iVar4 = 1;
    goto LAB_0042f6c1;
  }
  iVar4 = __isleadbyte_l((uint)(byte)*_SrcCh,&local_14);
  if (iVar4 == 0) {
    iVar4 = 1;
    iVar2 = MultiByteToWideChar((local_14.locinfo)->lc_codepage,9,_SrcCh,1,_DstCh,
                                (uint)(_DstCh != (wchar_t *)0x0));
    if (iVar2 != 0) goto LAB_0042f6c1;
LAB_0042f6b3:
    piVar3 = __errno();
    iVar4 = -1;
    *piVar3 = 0x2a;
  }
  else {
    if ((local_14.locinfo)->mb_cur_max < 2) {
LAB_0042f680:
      uVar1 = (local_14.locinfo)->mb_cur_max;
LAB_0042f683:
      if ((_SrcSizeInBytes < uVar1) || (_SrcCh[1] == '\0')) goto LAB_0042f6b3;
    }
    else {
      uVar1 = (local_14.locinfo)->mb_cur_max;
      if ((int)_SrcSizeInBytes < (int)uVar1) goto LAB_0042f683;
      iVar4 = MultiByteToWideChar((local_14.locinfo)->lc_codepage,9,_SrcCh,
                                  (local_14.locinfo)->mb_cur_max,_DstCh,
                                  (uint)(_DstCh != (wchar_t *)0x0));
      if (iVar4 == 0) goto LAB_0042f680;
    }
    iVar4 = (local_14.locinfo)->mb_cur_max;
  }
LAB_0042f6c1:
  if (local_8 != '\0') {
    *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
    return iVar4;
  }
  return iVar4;
}



/* Function: _mbtowc */

/* Library Function - Single Match
    _mbtowc
   
   Library: Visual Studio 2012 Release */

int __cdecl _mbtowc(wchar_t *_DstCh,char *_SrcCh,size_t _SrcSizeInBytes)

{
  int iVar1;
  
  iVar1 = __mbtowc_l(_DstCh,_SrcCh,_SrcSizeInBytes,(_locale_t)0x0);
  return iVar1;
}



/* Function: __putwch_nolock */

/* Library Function - Single Match
    __putwch_nolock
   
   Library: Visual Studio 2012 Release */

wint_t __cdecl __putwch_nolock(wchar_t _WCh)

{
  BOOL BVar1;
  DWORD local_8;
  
  if (DAT_00456eb0 == (HANDLE)0xfffffffe) {
    ___initconout();
  }
  if (DAT_00456eb0 != (HANDLE)0xffffffff) {
    BVar1 = WriteConsoleW(DAT_00456eb0,&_WCh,1,&local_8,(LPVOID)0x0);
    if (BVar1 != 0) {
      return _WCh;
    }
  }
  return 0xffff;
}



/* Function: __alloca_probe */

/* WARNING: This is an inlined function */
/* Library Function - Single Match
    __chkstk
   
   Library: Visual Studio */

void __alloca_probe(void)

{
  undefined1 *in_EAX;
  undefined4 *puVar1;
  undefined4 *puVar2;
  undefined4 unaff_retaddr;
  undefined1 auStack_4 [4];
  
  puVar2 = (undefined4 *)((int)&stack0x00000000 - (int)in_EAX & ~-(uint)(&stack0x00000000 < in_EAX))
  ;
  for (puVar1 = (undefined4 *)((uint)auStack_4 & 0xfffff000); puVar2 < puVar1;
      puVar1 = puVar1 + -0x400) {
  }
  *puVar2 = unaff_retaddr;
  return;
}



/* Function: _iswctype */

/* Library Function - Single Match
    _iswctype
   
   Library: Visual Studio 2012 Release */

int __cdecl _iswctype(wint_t _C,wctype_t _Type)

{
  uint uVar1;
  BOOL BVar2;
  uint local_8;
  
  if (_C == 0xffff) {
    return 0;
  }
  if (_C < 0x100) {
    uVar1 = (uint)*(ushort *)(PTR_DAT_00456e88 + (uint)_C * 2);
  }
  else {
    BVar2 = GetStringTypeW(1,(LPCWSTR)&_C,1,(LPWORD)&local_8);
    uVar1 = -(uint)(BVar2 != 0) & local_8 & 0xffff;
  }
  return uVar1 & _Type;
}



/* Function: FUN_0042f7f6 */

void FUN_0042f7f6(void)

{
  FUN_0042c0f6(0xc);
  return;
}



/* Function: __alloca_probe_16 */

/* WARNING: This is an inlined function */
/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */
/* Library Function - Single Match
    __alloca_probe_16
   
   Library: Visual Studio 2012 Release */

uint __alloca_probe_16(void)

{
  uint in_EAX;
  uint uVar1;
  
  uVar1 = 4 - in_EAX & 0xf;
  return in_EAX + uVar1 | -(uint)CARRY4(in_EAX,uVar1);
}



/* Function: __alloca_probe_8 */

/* WARNING: This is an inlined function */
/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */
/* Library Function - Single Match
    __alloca_probe_8
   
   Library: Visual Studio */

uint __alloca_probe_8(void)

{
  uint in_EAX;
  uint uVar1;
  
  uVar1 = 4 - in_EAX & 7;
  return in_EAX + uVar1 | -(uint)CARRY4(in_EAX,uVar1);
}



/* Function: FUN_0042f82c */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

DWORD __cdecl FUN_0042f82c(uint param_1)

{
  int *piVar1;
  HANDLE hFile;
  BOOL BVar2;
  ulong *puVar3;
  int iVar4;
  DWORD DVar5;
  
  if (param_1 == 0xfffffffe) {
    piVar1 = __errno();
    *piVar1 = 9;
  }
  else {
    if ((-1 < (int)param_1) && (param_1 < DAT_00459054)) {
      iVar4 = (param_1 & 0x1f) * 0x40;
      if ((*(byte *)(iVar4 + 4 + (&DAT_00457610)[(int)param_1 >> 5]) & 1) != 0) {
        ___lock_fhandle(param_1);
        DVar5 = 0;
        if ((*(byte *)(iVar4 + 4 + (&DAT_00457610)[(int)param_1 >> 5]) & 1) != 0) {
          hFile = (HANDLE)FUN_0042f556(param_1);
          BVar2 = FlushFileBuffers(hFile);
          if (BVar2 == 0) {
            DVar5 = GetLastError();
          }
          if (DVar5 == 0) goto LAB_0042f8db;
          puVar3 = ___doserrno();
          *puVar3 = DVar5;
        }
        piVar1 = __errno();
        *piVar1 = 9;
        DVar5 = 0xffffffff;
LAB_0042f8db:
        FUN_0042f8f1();
        return DVar5;
      }
    }
    piVar1 = __errno();
    *piVar1 = 9;
    FUN_0042acd7();
  }
  return 0xffffffff;
}



/* Function: FUN_0042f8f1 */

void FUN_0042f8f1(void)

{
  int unaff_EDI;
  
  __unlock_fhandle(unaff_EDI);
  return;
}



/* Function: __fclose_nolock */

/* Library Function - Single Match
    __fclose_nolock
   
   Library: Visual Studio 2012 Release */

int __cdecl __fclose_nolock(FILE *_File)

{
  int *piVar1;
  uint uVar2;
  int iVar3;
  int iVar4;
  
  iVar4 = -1;
  if (_File == (FILE *)0x0) {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
    iVar4 = -1;
  }
  else {
    if ((_File->_flag & 0x83) != 0) {
      iVar4 = __flush(_File);
      __freebuf(_File);
      uVar2 = __fileno(_File);
      iVar3 = FUN_0042fa2b(uVar2);
      if (iVar3 < 0) {
        iVar4 = -1;
      }
      else if (_File->_tmpfname != (char *)0x0) {
        FID_conflict__free(_File->_tmpfname);
        _File->_tmpfname = (char *)0x0;
      }
    }
    _File->_flag = 0;
  }
  return iVar4;
}



/* Function: FUN_0042f97e */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

int __cdecl FUN_0042f97e(FILE *param_1)

{
  int *piVar1;
  int iVar2;
  
  iVar2 = -1;
  if (param_1 == (FILE *)0x0) {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
  }
  else if ((param_1->_flag & 0x40) == 0) {
    __lock_file(param_1);
    iVar2 = __fclose_nolock(param_1);
    FUN_0042f9ed();
  }
  else {
    param_1->_flag = 0;
  }
  return iVar2;
}



/* Function: FUN_0042f9ed */

void FUN_0042f9ed(void)

{
  FILE *unaff_ESI;
  
  __unlock_file(unaff_ESI);
  return;
}



/* Function: ___initconout */

/* Library Function - Single Match
    ___initconout
   
   Library: Visual Studio 2012 Release */

void __cdecl ___initconout(void)

{
  DAT_00456eb0 = CreateFileW(L"CONOUT$",0x40000000,3,(LPSECURITY_ATTRIBUTES)0x0,3,0,(HANDLE)0x0);
  return;
}



/* Function: FUN_0042fa2b */

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */

undefined4 __cdecl FUN_0042fa2b(uint param_1)

{
  ulong *puVar1;
  int *piVar2;
  undefined4 uVar3;
  int iVar4;
  
  if (param_1 == 0xfffffffe) {
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
  }
  else {
    if ((-1 < (int)param_1) && (param_1 < DAT_00459054)) {
      iVar4 = (param_1 & 0x1f) * 0x40;
      if ((*(byte *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + iVar4) & 1) != 0) {
        ___lock_fhandle(param_1);
        if ((*(byte *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + iVar4) & 1) == 0) {
          piVar2 = __errno();
          *piVar2 = 9;
          uVar3 = 0xffffffff;
        }
        else {
          uVar3 = FUN_0042faf5(param_1);
        }
        FUN_0042facc();
        return uVar3;
      }
    }
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
    FUN_0042acd7();
  }
  return 0xffffffff;
}



/* Function: FUN_0042facc */

void FUN_0042facc(void)

{
  int unaff_ESI;
  
  __unlock_fhandle(unaff_ESI);
  return;
}



/* Function: FUN_0042faf5 */

undefined4 __cdecl FUN_0042faf5(uint param_1)

{
  int iVar1;
  int iVar2;
  HANDLE hObject;
  BOOL BVar3;
  DWORD DVar4;
  undefined4 uVar5;
  
  iVar1 = FUN_0042f556(param_1);
  if (iVar1 != -1) {
    if (((param_1 == 1) && ((*(byte *)(DAT_00457610 + 0x84) & 1) != 0)) ||
       ((param_1 == 2 && ((*(byte *)(DAT_00457610 + 0x44) & 1) != 0)))) {
      iVar1 = FUN_0042f556(2);
      iVar2 = FUN_0042f556(1);
      if (iVar2 == iVar1) goto LAB_0042fb59;
    }
    hObject = (HANDLE)FUN_0042f556(param_1);
    BVar3 = CloseHandle(hObject);
    if (BVar3 == 0) {
      DVar4 = GetLastError();
      goto LAB_0042fb5b;
    }
  }
LAB_0042fb59:
  DVar4 = 0;
LAB_0042fb5b:
  __free_osfhnd(param_1);
  *(undefined1 *)((&DAT_00457610)[(int)param_1 >> 5] + 4 + (param_1 & 0x1f) * 0x40) = 0;
  if (DVar4 == 0) {
    uVar5 = 0;
  }
  else {
    FID_conflict___dosmaperr(DVar4);
    uVar5 = 0xffffffff;
  }
  return uVar5;
}



/* Function: __freebuf */

/* Library Function - Single Match
    __freebuf
   
   Library: Visual Studio 2012 Release */

void __cdecl __freebuf(FILE *_File)

{
  if (((_File->_flag & 0x83) != 0) && ((_File->_flag & 8) != 0)) {
    FID_conflict__free(_File->_base);
    _File->_flag = _File->_flag & 0xfffffbf7;
    _File->_ptr = (char *)0x0;
    _File->_base = (char *)0x0;
    _File->_cnt = 0;
  }
  return;
}



/* Function: wcstoxl */

/* Library Function - Single Match
    unsigned long __cdecl wcstoxl(wchar_t const *,wchar_t const * *,int,int)
   
   Library: Visual Studio 2012 Release */

ulong __cdecl wcstoxl(wchar_t *param_1,wchar_t **param_2,int param_3,int param_4)

{
  wchar_t _C;
  wchar_t *pwVar1;
  int *piVar2;
  int iVar3;
  uint uVar4;
  uint uVar5;
  uint uVar6;
  wchar_t *pwVar7;
  uint uVar8;
  ushort uVar9;
  uint local_8;
  
  if (param_2 != (wchar_t **)0x0) {
    *param_2 = param_1;
  }
  if ((param_1 == (wchar_t *)0x0) || ((param_3 != 0 && ((param_3 < 2 || (0x24 < param_3)))))) {
    piVar2 = __errno();
    *piVar2 = 0x16;
    FUN_0042acd7();
    return 0;
  }
  _C = *param_1;
  uVar6 = 0;
  pwVar1 = param_1;
  while( true ) {
    pwVar7 = pwVar1 + 1;
    iVar3 = _iswctype(_C,8);
    if (iVar3 == 0) break;
    _C = *pwVar7;
    pwVar1 = pwVar7;
  }
  if (_C == L'-') {
    param_4 = param_4 | 2;
LAB_0042fc2f:
    _C = *pwVar7;
    pwVar7 = pwVar1 + 2;
  }
  else if (_C == L'+') goto LAB_0042fc2f;
  uVar8 = (uint)(ushort)_C;
  if (param_3 == 0) {
    iVar3 = __wchartodigit(_C);
    if (iVar3 != 0) {
      param_3 = 10;
      goto LAB_0042fc9f;
    }
    if ((*pwVar7 != L'x') && (*pwVar7 != L'X')) {
      param_3 = 8;
      goto LAB_0042fc9f;
    }
    param_3 = 0x10;
  }
  if (((param_3 == 0x10) && (iVar3 = __wchartodigit(_C), iVar3 == 0)) &&
     ((*pwVar7 == L'x' || (*pwVar7 == L'X')))) {
    uVar8 = (uint)(ushort)pwVar7[1];
    pwVar7 = pwVar7 + 2;
  }
LAB_0042fc9f:
  uVar4 = (uint)(0xffffffff / (ulonglong)(uint)param_3);
  local_8 = param_4;
  do {
    uVar9 = (ushort)uVar8;
    uVar5 = __wchartodigit(uVar9);
    if (uVar5 == 0xffffffff) {
      if (((uVar9 < 0x41) || (0x5a < uVar9)) && (0x19 < (ushort)(uVar9 - 0x61))) {
LAB_0042fcda:
        pwVar7 = pwVar7 + -1;
        if ((local_8 & 8) == 0) {
          if (param_2 != (wchar_t **)0x0) {
            pwVar7 = param_1;
          }
          uVar6 = 0;
        }
        else if (((local_8 & 4) != 0) ||
                (((local_8 & 1) == 0 &&
                 ((((local_8 & 2) != 0 && (0x80000000 < uVar6)) ||
                  (((local_8 & 2) == 0 && (0x7fffffff < uVar6)))))))) {
          piVar2 = __errno();
          *piVar2 = 0x22;
          if ((local_8 & 1) == 0) {
            uVar6 = ((local_8 & 2) != 0) + 0x7fffffff;
          }
          else {
            uVar6 = 0xffffffff;
          }
        }
        if (param_2 != (wchar_t **)0x0) {
          *param_2 = pwVar7;
        }
        if ((local_8 & 2) != 0) {
          uVar6 = -uVar6;
        }
        return uVar6;
      }
      if ((ushort)(uVar9 - 0x61) < 0x1a) {
        uVar8 = uVar8 - 0x20;
      }
      uVar5 = uVar8 - 0x37;
    }
    if ((uint)param_3 <= uVar5) goto LAB_0042fcda;
    if ((uVar6 < uVar4) ||
       ((uVar6 == uVar4 && (uVar5 <= (uint)(0xffffffff % (ulonglong)(uint)param_3))))) {
      uVar6 = uVar6 * param_3 + uVar5;
      local_8 = local_8 | 8;
    }
    else {
      local_8 = local_8 | 0xc;
      if (param_2 == (wchar_t **)0x0) goto LAB_0042fcda;
    }
    uVar8 = (uint)(ushort)*pwVar7;
    pwVar7 = pwVar7 + 1;
  } while( true );
}



/* Function: FID_conflict:__wcstoul_l */

/* Library Function - Multiple Matches With Different Base Names
    __wcstoul_l
    _wcstoul
   
   Library: Visual Studio 2012 Release */

ulong __cdecl FID_conflict___wcstoul_l(wchar_t *_Str,wchar_t **_EndPtr,int _Radix)

{
  ulong uVar1;
  
  uVar1 = wcstoxl(_Str,_EndPtr,_Radix,1);
  return uVar1;
}



/* Function: __wchartodigit */

/* Library Function - Single Match
    __wchartodigit
   
   Library: Visual Studio 2012 Release */

int __cdecl __wchartodigit(ushort param_1)

{
  ushort uVar1;
  int iVar2;
  
  if (0x2f < param_1) {
    if (param_1 < 0x3a) {
      return param_1 - 0x30;
    }
    iVar2 = 0xff10;
    if (param_1 < 0xff10) {
      iVar2 = 0x660;
      if (param_1 < 0x660) {
        return -1;
      }
      if (param_1 < 0x66a) goto LAB_0042fdf7;
      iVar2 = 0x6f0;
      if (param_1 < 0x6f0) {
        return -1;
      }
      if (param_1 < 0x6fa) goto LAB_0042fdf7;
      iVar2 = 0x966;
      if (param_1 < 0x966) {
        return -1;
      }
      if (param_1 < 0x970) goto LAB_0042fdf7;
      iVar2 = 0x9e6;
      if (param_1 < 0x9e6) {
        return -1;
      }
      if (param_1 < 0x9f0) goto LAB_0042fdf7;
      iVar2 = 0xa66;
      if (param_1 < 0xa66) {
        return -1;
      }
      if (param_1 < 0xa70) goto LAB_0042fdf7;
      iVar2 = 0xae6;
      if (param_1 < 0xae6) {
        return -1;
      }
      if (param_1 < 0xaf0) goto LAB_0042fdf7;
      iVar2 = 0xb66;
      if (param_1 < 0xb66) {
        return -1;
      }
      if (param_1 < 0xb70) goto LAB_0042fdf7;
      iVar2 = 0xc66;
      if (param_1 < 0xc66) {
        return -1;
      }
      if (param_1 < 0xc70) goto LAB_0042fdf7;
      iVar2 = 0xce6;
      if (param_1 < 0xce6) {
        return -1;
      }
      if (param_1 < 0xcf0) goto LAB_0042fdf7;
      iVar2 = 0xd66;
      if (param_1 < 0xd66) {
        return -1;
      }
      if (param_1 < 0xd70) goto LAB_0042fdf7;
      iVar2 = 0xe50;
      if (param_1 < 0xe50) {
        return -1;
      }
      if (param_1 < 0xe5a) goto LAB_0042fdf7;
      iVar2 = 0xed0;
      if (param_1 < 0xed0) {
        return -1;
      }
      if (param_1 < 0xeda) goto LAB_0042fdf7;
      iVar2 = 0xf20;
      if (param_1 < 0xf20) {
        return -1;
      }
      if (param_1 < 0xf2a) goto LAB_0042fdf7;
      iVar2 = 0x1040;
      if (param_1 < 0x1040) {
        return -1;
      }
      if (param_1 < 0x104a) goto LAB_0042fdf7;
      iVar2 = 0x17e0;
      if (param_1 < 0x17e0) {
        return -1;
      }
      if (param_1 < 0x17ea) goto LAB_0042fdf7;
      iVar2 = 0x1810;
      if (param_1 < 0x1810) {
        return -1;
      }
      uVar1 = 0x181a;
    }
    else {
      uVar1 = 0xff1a;
    }
    if (param_1 < uVar1) {
LAB_0042fdf7:
      return (uint)param_1 - iVar2;
    }
  }
  return -1;
}



/* Function: Ordinal_20 */

void Ordinal_20(void)

{
                    /* WARNING: Could not recover jumptable at 0x0042ff52. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  Ordinal_20();
  return;
}



/* Function: Ordinal_22 */

void Ordinal_22(void)

{
                    /* WARNING: Could not recover jumptable at 0x0042ff58. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  Ordinal_22();
  return;
}



/* Function: Ordinal_23 */

void Ordinal_23(void)

{
                    /* WARNING: Could not recover jumptable at 0x0042ff5e. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  Ordinal_23();
  return;
}



/* Function: Ordinal_8 */

void Ordinal_8(void)

{
                    /* WARNING: Could not recover jumptable at 0x0042ff64. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  Ordinal_8();
  return;
}



/* Function: Ordinal_17 */

void Ordinal_17(void)

{
                    /* WARNING: Could not recover jumptable at 0x0042ff6a. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  Ordinal_17();
  return;
}



/* Function: Ordinal_125 */

void Ordinal_125(void)

{
                    /* WARNING: Could not recover jumptable at 0x0042ff70. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  Ordinal_125();
  return;
}



/* Function: Ordinal_171 */

void Ordinal_171(void)

{
                    /* WARNING: Could not recover jumptable at 0x0042ff76. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  Ordinal_171();
  return;
}



/* Function: WinVerifyTrust */

LONG WinVerifyTrust(HWND hwnd,GUID *pgActionID,LPVOID pWVTData)

{
  LONG LVar1;
  
                    /* WARNING: Could not recover jumptable at 0x0042ff7c. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  LVar1 = WinVerifyTrust(hwnd,pgActionID,pWVTData);
  return LVar1;
}



/* Function: WTHelperGetProvSignerFromChain */

CRYPT_PROVIDER_SGNR *
WTHelperGetProvSignerFromChain
          (CRYPT_PROVIDER_DATA *pProvData,DWORD idxSigner,BOOL fCounterSigner,DWORD idxCounterSigner
          )

{
  CRYPT_PROVIDER_SGNR *pCVar1;
  
                    /* WARNING: Could not recover jumptable at 0x0042ff82. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  pCVar1 = WTHelperGetProvSignerFromChain(pProvData,idxSigner,fCounterSigner,idxCounterSigner);
  return pCVar1;
}



/* Function: WTHelperProvDataFromStateData */

CRYPT_PROVIDER_DATA * WTHelperProvDataFromStateData(HANDLE hStateData)

{
  CRYPT_PROVIDER_DATA *pCVar1;
  
                    /* WARNING: Could not recover jumptable at 0x0042ff88. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  pCVar1 = WTHelperProvDataFromStateData(hStateData);
  return pCVar1;
}



/* Function: CryptCATAdminCalcHashFromFileHandle */

BOOL CryptCATAdminCalcHashFromFileHandle(HANDLE hFile,DWORD *pcbHash,BYTE *pbHash,DWORD dwFlags)

{
  BOOL BVar1;
  
                    /* WARNING: Could not recover jumptable at 0x0042ff8e. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  BVar1 = CryptCATAdminCalcHashFromFileHandle(hFile,pcbHash,pbHash,dwFlags);
  return BVar1;
}



/* Function: FUN_0042ff94 */

int FUN_0042ff94(short *param_1,uint param_2,int param_3,uint param_4)

{
  int iVar1;
  int local_8;
  
  iVar1 = FUN_0043007a(param_1,param_2,&local_8,0x7fffffff);
  if (-1 < iVar1) {
    if (param_4 < 0x7fffffff) {
      iVar1 = _StringCopyWorkerW_20(param_1 + local_8,param_2 - local_8,(int *)0x0,param_3,param_4);
    }
    else {
      iVar1 = -0x7ff8ffa9;
    }
  }
  return iVar1;
}



/* Function: FUN_0042ffe1 */

void FUN_0042ffe1(short *param_1,uint param_2,int param_3)

{
  int iVar1;
  int local_8;
  
  iVar1 = FUN_0043007a(param_1,param_2,&local_8,0x7fffffff);
  if (-1 < iVar1) {
    _StringCopyWorkerW_20(param_1 + local_8,param_2 - local_8,(int *)0x0,param_3,0x7fffffff);
  }
  return;
}



/* Function: _StringCopyWorkerW@20 */

/* Library Function - Single Match
    _StringCopyWorkerW@20
   
   Library: Visual Studio 2012 Release */

undefined4 _StringCopyWorkerW_20(short *param_1,int param_2,int *param_3,int param_4,int param_5)

{
  short sVar1;
  int iVar2;
  undefined4 uVar3;
  int iVar4;
  
  iVar2 = 0;
  if (param_2 != 0) {
    iVar4 = param_4 - (int)param_1;
    do {
      if ((param_5 == 0) || (sVar1 = *(short *)(iVar4 + (int)param_1), sVar1 == 0)) break;
      *param_1 = sVar1;
      param_1 = param_1 + 1;
      param_5 = param_5 + -1;
      iVar2 = iVar2 + 1;
      param_2 = param_2 + -1;
    } while (param_2 != 0);
    uVar3 = 0;
    if (param_2 != 0) goto LAB_00430065;
  }
  param_1 = param_1 + -1;
  iVar2 = iVar2 + -1;
  uVar3 = 0x8007007a;
LAB_00430065:
  *param_1 = 0;
  if (param_3 != (int *)0x0) {
    *param_3 = iVar2;
  }
  return uVar3;
}



/* Function: FUN_0043007a */

int FUN_0043007a(short *param_1,uint param_2,int *param_3,uint param_4)

{
  int iVar1;
  uint uVar2;
  
  iVar1 = 0;
  if ((param_2 == 0) || (param_4 < param_2)) {
    iVar1 = -0x7ff8ffa9;
  }
  if (iVar1 < 0) {
    *param_3 = 0;
    return iVar1;
  }
  iVar1 = 0;
  uVar2 = param_2;
  if (param_2 != 0) {
    do {
      if (*param_1 == 0) break;
      param_1 = param_1 + 1;
      uVar2 = uVar2 - 1;
    } while (uVar2 != 0);
    if (uVar2 != 0) goto LAB_004300b7;
  }
  iVar1 = -0x7ff8ffa9;
LAB_004300b7:
  if (param_3 != (int *)0x0) {
    if (iVar1 < 0) {
      *param_3 = 0;
    }
    else {
      *param_3 = param_2 - uVar2;
    }
  }
  return iVar1;
}



/* Function: FUN_004300d9 */

void FUN_004300d9(void)

{
  return;
}



/* Function: FUN_004300dc */

void FUN_004300dc(int param_1,undefined4 *param_2)

{
  FUN_004300f0(param_1,param_2,(int *)0x0);
  return;
}



/* Function: FUN_004300f0 */

void FUN_004300f0(int param_1,undefined4 *param_2,int *param_3)

{
  UINT UVar1;
  int iVar2;
  HMODULE pHVar3;
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0((uint *)local_210,0,0x208);
  UVar1 = GetSystemDirectoryW(local_210,0x104);
  if (UVar1 != 0) {
    if (((local_210[UVar1 - 1] != L'\\') &&
        (iVar2 = FUN_0042ff94(local_210,0x104,0x452c9c,1), iVar2 < 0)) ||
       (iVar2 = FUN_0042ffe1(local_210,0x104,param_1), iVar2 < 0)) goto LAB_004301c5;
    pHVar3 = LoadLibraryW(local_210);
    *param_2 = pHVar3;
    if (pHVar3 != (HMODULE)0x0) {
      if (param_3 != (int *)0x0) {
        FUN_00433f88(param_3,local_210,0x104);
      }
      goto LAB_004301c5;
    }
  }
  GetLastError();
LAB_004301c5:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004301d8 */

undefined4 FUN_004301d8(int *param_1,uint param_2)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  
  uVar3 = ((param_2 >> 7) + 1) * 0x80;
  if (*param_1 == 0) {
    iVar2 = FUN_00431078(uVar3,1);
    *param_1 = iVar2;
    if (iVar2 != 0) {
      return 0;
    }
  }
  else {
    uVar1 = FUN_00431231((LPCVOID)*param_1);
    if (uVar3 <= uVar1) {
      return 0;
    }
    iVar2 = FUN_0043120c((LPVOID)*param_1,uVar3,1);
    if (iVar2 != 0) {
      *param_1 = iVar2;
      return 0;
    }
  }
  FUN_004300d9();
  return 0x8007000e;
}



/* Function: FUN_00430249 */

undefined4 FUN_00430249(uint param_1,int param_2,uint *param_3)

{
  undefined4 uVar1;
  
  if (param_2 + param_1 < param_1) {
    *param_3 = 0xffffffff;
    uVar1 = 0x80070216;
  }
  else {
    *param_3 = param_2 + param_1;
    uVar1 = 0;
  }
  return uVar1;
}



/* Function: FUN_0043026c */

undefined4 FUN_0043026c(undefined4 param_1,int param_2,undefined4 *param_3)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if (param_2 == 0) {
    *param_3 = param_1;
  }
  else {
    uVar1 = 0x80070216;
    *param_3 = 0xffffffff;
  }
  return uVar1;
}



/* Function: FUN_00430298 */

int FUN_00430298(int param_1,uint param_2,uint *param_3,undefined4 *param_4)

{
  uint uVar1;
  int iVar2;
  uint local_8;
  
  local_8 = 0;
  uVar1 = *param_3;
  iVar2 = _ULongSub_12(param_2,uVar1,(int *)&local_8);
  if (-1 < iVar2) {
    if (7 < local_8) {
      *param_4 = *(undefined4 *)(uVar1 + param_1);
      param_4[1] = *(undefined4 *)(uVar1 + 4 + param_1);
      *param_3 = *param_3 + 8;
      return iVar2;
    }
    iVar2 = -0x7ff8ffa9;
  }
  FUN_004300d9();
  return iVar2;
}



/* Function: FUN_004302f8 */

int FUN_004302f8(int param_1,uint param_2,uint *param_3,undefined4 *param_4)

{
  uint uVar1;
  int iVar2;
  uint local_8;
  
  local_8 = 0;
  uVar1 = *param_3;
  iVar2 = _ULongSub_12(param_2,uVar1,(int *)&local_8);
  if (-1 < iVar2) {
    if (3 < local_8) {
      *param_4 = *(undefined4 *)(uVar1 + param_1);
      *param_3 = *param_3 + 4;
      return iVar2;
    }
    iVar2 = -0x7ff8ffa9;
  }
  FUN_004300d9();
  return iVar2;
}



/* Function: FUN_00430351 */

int FUN_00430351(int param_1,uint param_2,uint *param_3,int *param_4)

{
  uint uVar1;
  uint uVar2;
  int iVar3;
  LPCWSTR pWVar4;
  uint local_c;
  uint local_8;
  
  local_c = 0;
  local_8 = 0;
  uVar1 = *param_3;
  iVar3 = _ULongSub_12(param_2,uVar1,(int *)&local_8);
  if (-1 < iVar3) {
    if (3 < local_8) {
      uVar2 = *(uint *)(uVar1 + param_1);
      iVar3 = FUN_0043026c(uVar2 * 2,uVar2 >> 0x1f,&local_c);
      if (((iVar3 < 0) || (iVar3 = FUN_00430249(uVar1,4,param_3), iVar3 < 0)) ||
         (iVar3 = _ULongSub_12(param_2,*param_3,(int *)&local_8), uVar1 = local_c, iVar3 < 0))
      goto LAB_00430403;
      if (local_c <= local_8) {
        if (uVar2 == 0) {
          pWVar4 = L"";
        }
        else {
          pWVar4 = (LPCWSTR)(*param_3 + param_1);
        }
        iVar3 = FUN_00433f88(param_4,pWVar4,uVar2);
        if (iVar3 < 0) {
          return iVar3;
        }
        *param_3 = *param_3 + uVar1;
        return iVar3;
      }
    }
    iVar3 = -0x7ff8ffa9;
  }
LAB_00430403:
  FUN_004300d9();
  return iVar3;
}



/* Function: FUN_0043043d */

int FUN_0043043d(int param_1,uint param_2,uint *param_3,int *param_4)

{
  uint uVar1;
  uint uVar2;
  int iVar3;
  LPCSTR pCVar4;
  uint local_c;
  uint local_8;
  
  local_c = 0;
  local_8 = 0;
  uVar1 = *param_3;
  iVar3 = _ULongSub_12(param_2,uVar1,(int *)&local_8);
  if (-1 < iVar3) {
    if (3 < local_8) {
      uVar2 = *(uint *)(uVar1 + param_1);
      iVar3 = FUN_0043026c(uVar2,0,&local_c);
      if (((iVar3 < 0) || (iVar3 = FUN_00430249(uVar1,4,param_3), iVar3 < 0)) ||
         (iVar3 = _ULongSub_12(param_2,*param_3,(int *)&local_8), uVar1 = local_c, iVar3 < 0))
      goto LAB_004304ec;
      if (local_c <= local_8) {
        if (uVar2 == 0) {
          pCVar4 = "";
        }
        else {
          pCVar4 = (LPCSTR)(*param_3 + param_1);
        }
        iVar3 = FUN_00434399(param_4,pCVar4,uVar2);
        if (iVar3 < 0) {
          return iVar3;
        }
        *param_3 = *param_3 + uVar1;
        return iVar3;
      }
    }
    iVar3 = -0x7ff8ffa9;
  }
LAB_004304ec:
  FUN_004300d9();
  return iVar3;
}



/* Function: FUN_00430526 */

void FUN_00430526(int *param_1,int *param_2,undefined4 param_3,undefined4 param_4)

{
  int iVar1;
  int iVar2;
  
  iVar2 = FUN_004301d8(param_1,*param_2 + 8);
  if (-1 < iVar2) {
    iVar2 = *param_1;
    iVar1 = *param_2;
    *(undefined4 *)(iVar2 + iVar1) = param_3;
    *(undefined4 *)(iVar2 + 4 + iVar1) = param_4;
    *param_2 = *param_2 + 8;
  }
  return;
}



/* Function: FUN_0043055b */

void FUN_0043055b(int *param_1,int *param_2,undefined4 param_3)

{
  int iVar1;
  
  iVar1 = FUN_004301d8(param_1,*param_2 + 4);
  if (-1 < iVar1) {
    *(undefined4 *)(*param_1 + *param_2) = param_3;
    *param_2 = *param_2 + 4;
  }
  return;
}



/* Function: FUN_00430589 */

int FUN_00430589(int *param_1,int *param_2,LPCWSTR param_3)

{
  rsize_t _DstSize;
  int iVar1;
  int iVar2;
  
  iVar1 = lstrlenW(param_3);
  _DstSize = iVar1 * 2;
  iVar2 = FUN_004301d8(param_1,*param_2 + 4 + _DstSize);
  if (-1 < iVar2) {
    *(int *)(*param_1 + *param_2) = iVar1;
    *param_2 = *param_2 + 4;
    _memcpy_s((void *)(*param_1 + *param_2),_DstSize,param_3,_DstSize);
    *param_2 = *param_2 + _DstSize;
  }
  return iVar2;
}



/* Function: FUN_004305e8 */

int FUN_004305e8(int *param_1,int *param_2,LPCSTR param_3)

{
  rsize_t _DstSize;
  int iVar1;
  
  _DstSize = lstrlenA(param_3);
  iVar1 = FUN_004301d8(param_1,*param_2 + 4 + _DstSize);
  if (-1 < iVar1) {
    *(rsize_t *)(*param_1 + *param_2) = _DstSize;
    *param_2 = *param_2 + 4;
    _memcpy_s((void *)(*param_1 + *param_2),_DstSize,param_3,_DstSize);
    *param_2 = *param_2 + _DstSize;
  }
  return iVar1;
}



/* Function: FUN_0043063c */

void __cdecl FUN_0043063c(LPCSTR param_1)

{
  FUN_00430875(2,param_1,&stack0x00000008,1);
  return;
}



/* Function: FUN_00430651 */

DWORD FUN_00430651(undefined4 param_1,LPCVOID param_2,DWORD param_3,undefined4 param_4,int param_5)

{
  DWORD DVar1;
  uint uVar2;
  LPCWSTR local_8;
  
  uVar2 = 0;
  local_8 = (LPCWSTR)0x0;
  DVar1 = FormatMessageW(0x900,param_2,param_3,0,(LPWSTR)&local_8,0,(va_list *)&param_4);
  if (DVar1 == 0) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if ((int)uVar2 < 0) {
      FUN_004300d9();
      goto LAB_004306db;
    }
  }
  else if (((1 < DVar1) && (local_8[DVar1 - 2] == L'\r')) && (local_8[DVar1 - 1] == L'\n')) {
    local_8[DVar1 - 2] = L'\0';
  }
  FUN_004306f1(param_1,param_3,local_8,param_5);
LAB_004306db:
  if (local_8 != (LPCWSTR)0x0) {
    LocalFree(local_8);
  }
  return uVar2;
}



/* Function: FUN_004306f1 */

void FUN_004306f1(int param_1,uint param_2,LPCWSTR param_3,int param_4)

{
  int iVar1;
  DWORD DVar2;
  LPCWSTR local_20;
  LPCSTR local_1c;
  _SYSTEMTIME local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_20 = (LPCWSTR)0x0;
  local_1c = (LPCSTR)0x0;
  if (DAT_00457e7c != 0) goto LAB_00430863;
  EnterCriticalSection((LPCRITICAL_SECTION)&DAT_00457e88);
  if (param_4 == 0) {
LAB_004307fd:
    if (local_20 != (LPCWSTR)0x0) {
      param_3 = local_20;
    }
    DVar2 = FUN_00434262((int *)&local_1c,param_3,0,0xfde9);
    if (-1 < (int)DVar2) {
      if (DAT_00457e70 == (code *)0x0) {
        FUN_00430f66(local_1c);
      }
      else {
        (*DAT_00457e70)(local_1c,DAT_00457e74);
      }
    }
  }
  else {
    GetCurrentProcessId();
    GetCurrentThreadId();
    local_18.wYear = 0;
    local_18.wMonth = 0;
    local_18.wDayOfWeek = 0;
    local_18.wDay = 0;
    local_18.wHour = 0;
    local_18.wMinute = 0;
    local_18.wSecond = 0;
    local_18.wMilliseconds = 0;
    GetLocalTime(&local_18);
    iVar1 = FUN_00433cea((int *)&local_20,
                         L"%ls[%04X:%04X][%04hu-%02hu-%02huT%02hu:%02hu:%02hu]%hs%03d:%ls %ls%ls");
    if (-1 < iVar1) goto LAB_004307fd;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)&DAT_00457e88);
  if (local_20 != (LPCWSTR)0x0) {
    FUN_004380ab(local_20);
  }
  if (local_1c != (LPCSTR)0x0) {
    FUN_004380ab(local_1c);
  }
LAB_00430863:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00430875 */

DWORD FUN_00430875(undefined4 param_1,LPCSTR param_2,va_list param_3,int param_4)

{
  DWORD DVar1;
  LPCWSTR local_c;
  wchar_t *local_8;
  
  local_8 = (wchar_t *)0x0;
  local_c = (LPCWSTR)0x0;
  DVar1 = FUN_00434004((int *)&local_8,param_2,0,0);
  if (-1 < (int)DVar1) {
    DVar1 = FUN_00433cfe((int *)&local_c,local_8,param_3);
    if (-1 < (int)DVar1) {
      DVar1 = FUN_004306f1(param_1,0,local_c,param_4);
    }
  }
  if (local_8 != (wchar_t *)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar1;
}



/* Function: FUN_004308e0 */

int __cdecl FUN_004308e0(wchar_t *param_1,uint param_2,wchar_t *param_3)

{
  uint uVar1;
  int iVar2;
  uint _Count;
  
  iVar2 = 0;
  if ((param_2 == 0) || (0x7fffffff < param_2)) {
    iVar2 = -0x7ff8ffa9;
  }
  if (-1 < iVar2) {
    iVar2 = 0;
    _Count = param_2 - 1;
    uVar1 = __vsnwprintf(param_1,_Count,param_3,&stack0x00000010);
    if (((int)uVar1 < 0) || (_Count < uVar1)) {
      iVar2 = -0x7ff8ff86;
    }
    else if (uVar1 != _Count) {
      return 0;
    }
    param_1[_Count] = L'\0';
  }
  return iVar2;
}



/* Function: FUN_00430935 */

void FUN_00430935(int param_1)

{
  if (DAT_00456eb8 != (HANDLE)0xffffffff) {
    if (param_1 != 0) {
      FUN_00430adc();
    }
    if (DAT_00456eb8 != (HANDLE)0xffffffff) {
      CloseHandle(DAT_00456eb8);
      DAT_00456eb8 = (HANDLE)0xffffffff;
    }
  }
  if (DAT_00457e80 != (LPVOID)0x0) {
    FUN_004380ab(DAT_00457e80);
    DAT_00457e80 = (LPVOID)0x0;
  }
  if (DAT_00457e84 != (LPVOID)0x0) {
    FUN_004380ab(DAT_00457e84);
    DAT_00457e84 = (LPVOID)0x0;
  }
  return;
}



/* Function: FUN_00430995 */

void FUN_00430995(void)

{
  EnterCriticalSection((LPCRITICAL_SECTION)&DAT_00457e88);
  DAT_00457e7c = 1;
  if (DAT_00456eb8 != (HANDLE)0xffffffff) {
    CloseHandle(DAT_00456eb8);
    DAT_00456eb8 = (HANDLE)0xffffffff;
  }
  if (DAT_00457e80 != (LPVOID)0x0) {
    FUN_004380ab(DAT_00457e80);
    DAT_00457e80 = (LPVOID)0x0;
  }
  if (DAT_00457e84 != (LPVOID)0x0) {
    FUN_004380ab(DAT_00457e84);
    DAT_00457e84 = (LPVOID)0x0;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)&DAT_00457e88);
  return;
}



/* Function: FUN_004309f9 */

void FUN_004309f9(undefined4 param_1,DWORD param_2,LPCVOID param_3)

{
  int iVar1;
  wchar_t local_20 [12];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  iVar1 = FUN_004308e0(local_20,0xb,L"0x%08x");
  if (-1 < iVar1) {
    FUN_00430c99(5,param_2,param_3);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00430a57 */

void __cdecl FUN_00430a57(undefined4 param_1,LPCSTR param_2)

{
  FUN_00430a6b(param_1,param_2,&stack0x0000000c);
  return;
}



/* Function: FUN_00430a6b */

DWORD FUN_00430a6b(undefined4 param_1,LPCSTR param_2,va_list param_3)

{
  DWORD DVar1;
  LPVOID local_c;
  wchar_t *local_8;
  
  local_8 = (wchar_t *)0x0;
  local_c = (LPVOID)0x0;
  DVar1 = FUN_00434004((int *)&local_8,param_2,0,0);
  if (-1 < (int)DVar1) {
    DVar1 = FUN_00433cfe((int *)&local_c,local_8,param_3);
    if (-1 < (int)DVar1) {
      DVar1 = FUN_00430f28(5,"Error 0x%x: %ls");
    }
  }
  if (local_8 != (wchar_t *)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar1;
}



/* Function: FUN_00430adc */

undefined4 FUN_00430adc(void)

{
  undefined4 uVar1;
  LPVOID local_8;
  
  local_8 = (LPVOID)0x0;
  FUN_00438acd((int *)&local_8,0);
  uVar1 = FUN_0043063c("=== Logging stopped: %ls ===");
  if (local_8 != (LPVOID)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00430b14 */

void FUN_00430b14(void)

{
  DWORD DVar1;
  BOOL BVar2;
  WCHAR *pWVar3;
  int iVar4;
  DWORD local_428 [3];
  LPVOID local_41c;
  WCHAR local_418 [260];
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_428[0] = 0x104;
  local_428[2] = 0;
  local_428[1] = 0;
  local_41c = (LPVOID)0x0;
  DVar1 = GetModuleFileNameW((HMODULE)0x0,local_210,0x104);
  iVar4 = 0x208;
  if (DVar1 == 0) {
    FUN_004267c0((uint *)local_210,0,0x208);
  }
  DVar1 = FUN_0043710a(local_210,local_428 + 2,local_428 + 1);
  if ((int)DVar1 < 0) {
    local_428[2] = 0;
    local_428[1] = 0;
  }
  BVar2 = GetComputerNameW(local_418,local_428);
  if (BVar2 == 0) {
    pWVar3 = local_418;
    do {
      *(undefined1 *)pWVar3 = 0;
      pWVar3 = (WCHAR *)((int)pWVar3 + 1);
      iVar4 = iVar4 + -1;
    } while (iVar4 != 0);
  }
  FUN_00438acd((int *)&local_41c,0);
  FUN_00430f28(2,"=== Logging started: %ls ===");
  FUN_00430f28(2,"Executable: %ls v%d.%d.%d.%d");
  FUN_00430f28(2,"Computer  : %ls");
  FUN_00430f28(2,"--- logging level: %hs ---");
  if (local_41c != (LPVOID)0x0) {
    FUN_004380ab(local_41c);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00430c99 */

DWORD __cdecl FUN_00430c99(int param_1,DWORD param_2,LPCVOID param_3)

{
  LPCVOID pvVar1;
  DWORD DVar2;
  
  if ((param_1 != 5) && (DAT_00456ebc < param_1)) {
    return 1;
  }
  pvVar1 = DAT_00457e78;
  if (param_3 != (LPCVOID)0x0) {
    pvVar1 = param_3;
  }
  DVar2 = FUN_00430651(param_1,pvVar1,param_2,&stack0x00000010,1);
  return DVar2;
}



/* Function: FUN_00430cd0 */

DWORD FUN_00430cd0(int param_1,DWORD param_2,LPCVOID param_3,undefined4 param_4)

{
  DWORD DVar1;
  LPCVOID pvVar2;
  
  if ((param_1 == 5) || (param_1 <= DAT_00456ebc)) {
    pvVar2 = DAT_00457e78;
    if (param_3 != (LPCVOID)0x0) {
      pvVar2 = param_3;
    }
    DVar1 = FUN_00430651(param_1,pvVar2,param_2,param_4,1);
  }
  else {
    DVar1 = 1;
  }
  return DVar1;
}



/* Function: FUN_00430d08 */

void FUN_00430d08(undefined4 param_1)

{
  DAT_00457e7c = 0;
  DAT_00457e78 = param_1;
  InitializeCriticalSection((LPCRITICAL_SECTION)&DAT_00457e88);
  DAT_00457ea0 = 1;
  return;
}



/* Function: FUN_00430d33 */

DWORD FUN_00430d33(WCHAR *param_1,LPCWSTR param_2,undefined4 param_3,short *param_4,int param_5,
                  int param_6,int *param_7)

{
  uint uVar1;
  DWORD DVar2;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  EnterCriticalSection((LPCRITICAL_SECTION)&DAT_00457e88);
  if ((param_4 == (short *)0x0) || (*param_4 == 0)) {
    uVar1 = FUN_004314a9(param_1,param_2,(int *)&DAT_00457e80);
    if (((int)uVar1 < 0) ||
       ((uVar1 = FUN_00431c88(DAT_00457e80,(int *)&local_8), (int)uVar1 < 0 ||
        (uVar1 = FUN_00437850(local_8,(LPSECURITY_ATTRIBUTES)0x0), (int)uVar1 < 0))))
    goto LAB_00430e81;
    DVar2 = 2;
    if (param_5 != 0) {
      DVar2 = 4;
    }
    DAT_00456eb8 = CreateFileW(DAT_00457e80,0x40000000,1,(LPSECURITY_ATTRIBUTES)0x0,DVar2,0x80,
                               (HANDLE)0x0);
    if (DAT_00456eb8 == (HANDLE)0xffffffff) {
      DVar2 = GetLastError();
      uVar1 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar1 = DVar2;
      }
      if ((int)uVar1 < 0) {
        FUN_004300d9();
        goto LAB_00430e81;
      }
    }
    if (param_5 != 0) {
      SetFilePointer(DAT_00456eb8,0,(PLONG)0x0,2);
    }
  }
  else {
    uVar1 = FUN_0043167e(param_1,param_2,param_3,param_4,(int *)&DAT_00457e80,&DAT_00456eb8);
    if ((int)uVar1 < 0) goto LAB_00430e81;
  }
  if (param_6 != 0) {
    FUN_00430b14();
  }
  if ((DAT_00457e84 != (LPCSTR)0x0) && (FUN_00430f66(DAT_00457e84), DAT_00457e84 != (LPCSTR)0x0)) {
    FUN_004380ab(DAT_00457e84);
    DAT_00457e84 = (LPCSTR)0x0;
  }
  if ((param_7 == (int *)0x0) || (uVar1 = FUN_00433f88(param_7,DAT_00457e80,0), -1 < (int)uVar1)) {
    DAT_00457e7c = 0;
  }
LAB_00430e81:
  LeaveCriticalSection((LPCRITICAL_SECTION)&DAT_00457e88);
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00430ea1 */

void FUN_00430ea1(undefined4 param_1,undefined4 param_2)

{
  DAT_00457e70 = param_1;
  DAT_00457e74 = param_2;
  return;
}



/* Function: FUN_00430eb8 */

int FUN_00430eb8(int param_1,int param_2)

{
  int iVar1;
  
  iVar1 = DAT_00456ebc;
  if ((DAT_00456ebc != param_1) && (DAT_00456ebc = param_1, param_2 != 0)) {
    FUN_00430f28(2,"--- logging level: %hs ---");
  }
  return iVar1;
}



/* Function: FUN_00430f28 */

void __cdecl FUN_00430f28(int param_1,LPCSTR param_2)

{
  FUN_00430f3c(param_1,param_2,&stack0x0000000c);
  return;
}



/* Function: FUN_00430f3c */

DWORD FUN_00430f3c(int param_1,LPCSTR param_2,va_list param_3)

{
  DWORD DVar1;
  
  if ((param_1 == 5) || (param_1 <= DAT_00456ebc)) {
    DVar1 = FUN_00430875(param_1,param_2,param_3,1);
  }
  else {
    DVar1 = 1;
  }
  return DVar1;
}



/* Function: FUN_00430f66 */

DWORD FUN_00430f66(LPCSTR param_1)

{
  uint uVar1;
  BOOL BVar2;
  DWORD DVar3;
  uint uVar4;
  uint uVar5;
  DWORD local_8;
  
  uVar4 = 0;
  local_8 = 0;
  uVar5 = 0;
  uVar1 = lstrlenA(param_1);
  if (DAT_00456eb8 == (HANDLE)0xffffffff) {
    uVar4 = FUN_004341b2(&DAT_00457e84,param_1,0);
    if (-1 < (int)uVar4) {
      uVar4 = 0;
    }
  }
  else if (uVar1 != 0) {
    do {
      BVar2 = WriteFile(DAT_00456eb8,param_1 + uVar5,uVar1 - uVar5,&local_8,(LPOVERLAPPED)0x0);
      if (BVar2 == 0) {
        DVar3 = GetLastError();
        uVar4 = DVar3 & 0xffff | 0x80070000;
        if ((int)DVar3 < 1) {
          uVar4 = DVar3;
        }
        if ((int)uVar4 < 0) {
          FUN_004300d9();
          return uVar4;
        }
      }
      uVar5 = uVar5 + local_8;
    } while (uVar5 < uVar1);
  }
  return uVar4;
}



/* Function: FUN_00431001 */

void FUN_00431001(int param_1)

{
  FUN_00430935(param_1);
  if (DAT_00457ea0 != 0) {
    DeleteCriticalSection((LPCRITICAL_SECTION)&DAT_00457e88);
    DAT_00457ea0 = 0;
  }
  DAT_00457e78 = 0;
  DAT_00457e7c = 0;
  if (DAT_00457ea4 != (LPVOID)0x0) {
    FUN_004380ab(DAT_00457ea4);
    DAT_00457ea4 = (LPVOID)0x0;
  }
  if (DAT_00457eac != (LPVOID)0x0) {
    FUN_004380ab(DAT_00457eac);
    DAT_00457eac = (LPVOID)0x0;
  }
  if (DAT_00457ea8 != (LPVOID)0x0) {
    FUN_004380ab(DAT_00457ea8);
    DAT_00457ea8 = (LPVOID)0x0;
  }
  return;
}



/* Function: FUN_00431078 */

void FUN_00431078(SIZE_T param_1,int param_2)

{
  uint dwFlags;
  HANDLE hHeap;
  
  dwFlags = -(uint)(param_2 != 0) & 8;
  hHeap = GetProcessHeap();
  HeapAlloc(hHeap,dwFlags,param_1);
  return;
}



/* Function: FUN_0043109a */

int FUN_0043109a(int *param_1,uint param_2,uint param_3,int param_4)

{
  int iVar1;
  uint uVar2;
  int iVar3;
  uint local_c;
  SIZE_T local_8;
  
  local_c = 0;
  local_8 = 0;
  iVar1 = FUN_00430249(param_2,param_4,&local_c);
  if ((-1 < iVar1) &&
     (iVar1 = FUN_0043026c((int)((ulonglong)local_c * (ulonglong)param_3),
                           (int)((ulonglong)local_c * (ulonglong)param_3 >> 0x20),&local_8),
     -1 < iVar1)) {
    if (*param_1 == 0) {
      iVar3 = FUN_00431078(local_8,1);
    }
    else {
      uVar2 = FUN_00431231((LPCVOID)*param_1);
      if (param_2 * param_3 <= uVar2) {
        return iVar1;
      }
      iVar3 = FUN_0043120c((LPVOID)*param_1,local_8,1);
    }
    if (iVar3 == 0) {
      iVar1 = -0x7ff8fff2;
      FUN_004300d9();
    }
    else {
      *param_1 = iVar3;
    }
  }
  return iVar1;
}



/* Function: FUN_00431137 */

DWORD FUN_00431137(LPVOID param_1)

{
  HANDLE hHeap;
  BOOL BVar1;
  DWORD DVar2;
  DWORD DVar3;
  
  DVar3 = 0;
  hHeap = GetProcessHeap();
  BVar1 = HeapFree(hHeap,DVar3,param_1);
  DVar3 = 0;
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    DVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      DVar3 = DVar2;
    }
  }
  return DVar3;
}



/* Function: FUN_0043116d */

int FUN_0043116d(int *param_1,uint param_2,int param_3,int param_4,rsize_t param_5,int param_6)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  void *_Dst;
  void *_Src;
  uint uVar5;
  
  if (param_3 == 0) {
    iVar3 = 0;
  }
  else {
    uVar5 = param_4 + param_3;
    iVar3 = FUN_0043109a(param_1,uVar5,param_5,param_6);
    if (-1 < iVar3) {
      iVar2 = *param_1;
      uVar1 = uVar5 - 1;
      if (param_2 < uVar1) {
        _Dst = (void *)(uVar1 * param_5 + iVar2);
        _Src = (void *)((uVar5 - 2) * param_5 + iVar2);
        iVar4 = uVar1 - param_2;
        do {
          _memcpy_s(_Dst,param_5,_Src,param_5);
          _Src = (void *)((int)_Src - param_5);
          _Dst = (void *)((int)_Dst - param_5);
          iVar4 = iVar4 + -1;
        } while (iVar4 != 0);
      }
      FUN_004267c0((uint *)(param_2 * param_5 + iVar2),0,param_3 * param_5);
    }
  }
  return iVar3;
}



/* Function: FUN_0043120c */

void FUN_0043120c(LPVOID param_1,SIZE_T param_2,int param_3)

{
  uint dwFlags;
  HANDLE hHeap;
  
  dwFlags = -(uint)(param_3 != 0) & 8;
  hHeap = GetProcessHeap();
  HeapReAlloc(hHeap,dwFlags,param_1,param_2);
  return;
}



/* Function: FUN_00431231 */

void FUN_00431231(LPCVOID param_1)

{
  HANDLE hHeap;
  DWORD dwFlags;
  
  dwFlags = 0;
  hHeap = GetProcessHeap();
  HeapSize(hHeap,dwFlags,param_1);
  return;
}



/* Function: FUN_0043124a */

int FUN_0043124a(int *param_1)

{
  int iVar1;
  int local_c;
  uint local_8;
  
  local_8 = 0;
  local_c = 0;
  iVar1 = FUN_0043452e((LPCVOID)*param_1,&local_8);
  if (-1 < iVar1) {
    iVar1 = FUN_0040e205((short *)*param_1,local_8,&local_c);
    if (-1 < iVar1) {
      if (*(short *)(*param_1 + -2 + local_c * 2) != 0x5c) {
        iVar1 = FUN_00433c35(param_1,(short *)&DAT_00452c9c,1);
      }
    }
  }
  return iVar1;
}



/* Function: FUN_004312a7 */

int FUN_004312a7(int *param_1,short *param_2)

{
  bool bVar1;
  short sVar2;
  int iVar3;
  int iVar4;
  uint uVar5;
  short *psVar6;
  short *psVar7;
  short *psVar8;
  uint local_c;
  short *local_8;
  
  bVar1 = false;
  sVar2 = *param_2;
  local_8 = (short *)0x0;
  iVar3 = 0;
  psVar6 = param_2;
  if (sVar2 != 0) {
    do {
      iVar4 = iVar3;
      if ((((sVar2 == 0x20) || (sVar2 == 9)) || (sVar2 == 10)) || (sVar2 == 0xb)) {
        bVar1 = true;
      }
      else {
        if (sVar2 == 0x22) {
          bVar1 = true;
        }
        else if (sVar2 != 0x5c) goto LAB_00431325;
        iVar4 = iVar4 + 1;
      }
LAB_00431325:
      sVar2 = psVar6[1];
      iVar3 = iVar4 + 1;
      psVar6 = psVar6 + 1;
    } while (sVar2 != 0);
    if (bVar1) {
      iVar3 = FUN_00433bdf((int *)&local_8,iVar4 + 4);
      if (iVar3 < 0) goto LAB_00431420;
      *local_8 = 0x22;
      sVar2 = *param_2;
      psVar7 = param_2;
      psVar6 = local_8;
      while (psVar6 = psVar6 + 1, sVar2 != 0) {
        local_c = 0;
        sVar2 = *psVar7;
        while (sVar2 == 0x5c) {
          psVar7 = psVar7 + 1;
          local_c = local_c + 1;
          sVar2 = *psVar7;
        }
        if (*psVar7 == 0) {
          local_c = local_c * 2;
        }
        else if (*psVar7 == 0x22) {
          local_c = local_c * 2 + 1;
        }
        if (local_c != 0) {
          psVar8 = psVar6;
          for (uVar5 = local_c >> 1; uVar5 != 0; uVar5 = uVar5 - 1) {
            psVar8[0] = 0x5c;
            psVar8[1] = 0x5c;
            psVar8 = psVar8 + 2;
          }
          for (uVar5 = (uint)((local_c & 1) != 0); uVar5 != 0; uVar5 = uVar5 - 1) {
            *psVar8 = 0x5c;
            psVar8 = psVar8 + 1;
          }
          psVar6 = psVar6 + local_c;
        }
        if (*psVar7 == 0) break;
        *psVar6 = *psVar7;
        psVar7 = psVar7 + 1;
        sVar2 = *psVar7;
      }
      *psVar6 = 0x22;
      psVar6[1] = 0;
    }
  }
  if ((((short *)*param_1 == (short *)0x0) || (*(short *)*param_1 == 0)) ||
     (iVar3 = FUN_00433c35(param_1,(short *)&DAT_004443f0,0), -1 < iVar3)) {
    if (local_8 != (short *)0x0) {
      param_2 = local_8;
    }
    iVar3 = FUN_00433c35(param_1,param_2,0);
  }
LAB_00431420:
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar3;
}



/* Function: FUN_00431437 */

DWORD FUN_00431437(LPCWSTR param_1,LPCWSTR param_2,int *param_3)

{
  DWORD DVar1;
  int iVar2;
  PCNZWCH local_c;
  PCNZWCH local_8;
  
  local_c = (PCNZWCH)0x0;
  local_8 = (PCNZWCH)0x0;
  DVar1 = FUN_0043191f((int *)&local_c,param_1,(LPWSTR)0x3);
  if (-1 < (int)DVar1) {
    DVar1 = FUN_0043191f((int *)&local_8,param_2,(LPWSTR)0x3);
    if (-1 < (int)DVar1) {
      iVar2 = CompareStringW(0,1,local_c,-1,local_8,-1);
      *param_3 = iVar2;
    }
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (PCNZWCH)0x0) {
    FUN_004380ab(local_c);
  }
  return DVar1;
}



/* Function: FUN_004314a9 */

void FUN_004314a9(LPCWSTR param_1,LPCWSTR param_2,int *param_3)

{
  int iVar1;
  LPCWSTR pWVar2;
  
  pWVar2 = param_1;
  if ((((param_2 == (LPCWSTR)0x0) || (*param_2 == L'\0')) ||
      (pWVar2 = param_2, param_1 == (LPCWSTR)0x0)) ||
     ((*param_1 == L'\0' || (iVar1 = FUN_00431d3c(param_2), iVar1 != 0)))) {
    FUN_00433f88(param_3,pWVar2,0);
  }
  else {
    iVar1 = FUN_00433f88(param_3,param_1,0);
    if ((-1 < iVar1) && (iVar1 = FUN_0043124a(param_3), -1 < iVar1)) {
      FUN_00433c35(param_3,param_2,0);
    }
  }
  return;
}



/* Function: FUN_00431510 */

DWORD FUN_00431510(LPCWSTR param_1,wchar_t *param_2,uint param_3,int *param_4)

{
  DWORD DVar1;
  BOOL BVar2;
  DWORD DVar3;
  uint uVar4;
  LPVOID local_c;
  LPWSTR local_8;
  
  local_8 = (LPWSTR)0x0;
  local_c = (LPVOID)0x0;
  if ((param_1 == (LPCWSTR)0x0) || (*param_1 == L'\0')) {
    DVar1 = FUN_00433bdf((int *)&local_8,0x104);
    if ((int)DVar1 < 0) goto LAB_0043165a;
    DVar3 = GetTempPathW(0x104,local_8);
    if (DVar3 == 0) {
      DVar3 = GetLastError();
      DVar1 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        DVar1 = DVar3;
      }
      if (-1 < (int)DVar1) {
        DVar1 = 0x80004005;
      }
      FUN_004300d9();
      goto LAB_0043165a;
    }
  }
  else {
    DVar1 = FUN_00433f88((int *)&local_8,param_1,0);
    if (((int)DVar1 < 0) || (DVar1 = FUN_0043124a((int *)&local_8), (int)DVar1 < 0))
    goto LAB_0043165a;
  }
  uVar4 = 1;
  if (param_3 == 0) {
LAB_0043164d:
    if (-1 < (int)DVar1) {
      DVar1 = FUN_0043124a(param_4);
    }
  }
  else {
    do {
      DVar1 = FUN_00433cea((int *)&local_c,param_2);
      if (((int)DVar1 < 0) || (DVar1 = FUN_00433cea(param_4,L"%s%s"), (int)DVar1 < 0)) break;
      BVar2 = CreateDirectoryW((LPCWSTR)*param_4,(LPSECURITY_ATTRIBUTES)0x0);
      if (BVar2 != 0) {
        DVar1 = 0;
        goto LAB_0043164d;
      }
      DVar3 = GetLastError();
      if (DVar3 != 0xb7) {
        if (DVar3 == 3) {
          DVar1 = FUN_00437850((LPCWSTR)*param_4,(LPSECURITY_ATTRIBUTES)0x0);
        }
        else {
          DVar1 = DVar3 & 0xffff | 0x80070000;
          if ((int)DVar3 < 1) {
            DVar1 = DVar3;
          }
        }
        goto LAB_0043164d;
      }
      uVar4 = uVar4 + 1;
      DVar1 = 0x800700b7;
    } while (uVar4 <= param_3);
  }
LAB_0043165a:
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return DVar1;
}



/* Function: FUN_0043167e */

void FUN_0043167e(WCHAR *param_1,LPCWSTR param_2,int param_3,short *param_4,int *param_5,
                 undefined4 *param_6)

{
  bool bVar1;
  int iVar2;
  DWORD DVar3;
  uint uVar4;
  uint uVar5;
  HANDLE hObject;
  LPCWSTR local_22c;
  LPCWSTR local_228;
  LPCWSTR local_224;
  _SYSTEMTIME local_220;
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0((uint *)local_210,0,0x208);
  local_224 = (LPCWSTR)0x0;
  local_22c = (LPCWSTR)0x0;
  local_220.wYear = 0;
  local_220.wMonth = 0;
  local_220.wDayOfWeek = 0;
  local_220.wDay = 0;
  local_220.wHour = 0;
  local_220.wMinute = 0;
  local_220.wSecond = 0;
  local_220.wMilliseconds = 0;
  hObject = (HANDLE)0xffffffff;
  local_228 = (LPCWSTR)0x0;
  if ((param_1 == (WCHAR *)0x0) || (*param_1 == L'\0')) {
    DVar3 = GetTempPathW(0x104,local_210);
    if (DVar3 == 0) {
      GetLastError();
      FUN_004300d9();
      goto LAB_004318d0;
    }
    param_1 = local_210;
  }
  iVar2 = FUN_004314a9(param_1,param_2,(int *)&local_224);
  if ((-1 < iVar2) &&
     ((iVar2 = FUN_00431c88(local_224,(int *)&local_22c), iVar2 != 0 ||
      (DVar3 = FUN_00437850(local_22c,(LPSECURITY_ATTRIBUTES)0x0), -1 < (int)DVar3)))) {
    do {
      GetLocalTime(&local_220);
      iVar2 = FUN_00433cea((int *)&local_228,L"%ls_%04u%02u%02u%02u%02u%02u%ls%ls%ls");
      if (iVar2 < 0) goto LAB_004318c4;
      hObject = CreateFileW(local_228,0x40000000,1,(LPSECURITY_ATTRIBUTES)0x0,1,0x80,(HANDLE)0x0);
      if (hObject != (HANDLE)0xffffffff) break;
      uVar4 = GetLastError();
      if ((uVar4 == 0x50) || (uVar4 == 5)) {
        Sleep(100);
        uVar4 = 0;
        bVar1 = true;
      }
      else {
        bVar1 = false;
      }
      uVar5 = uVar4 & 0xffff | 0x80070000;
      if ((int)uVar4 < 1) {
        uVar5 = uVar4;
      }
      if ((int)uVar5 < 0) goto LAB_004318d0;
    } while (bVar1);
    if (((param_5 == (int *)0x0) || (iVar2 = FUN_00433f88(param_5,local_228,0), -1 < iVar2)) &&
       (param_6 != (undefined4 *)0x0)) {
      *param_6 = hObject;
      hObject = (HANDLE)0xffffffff;
    }
LAB_004318c4:
    if (hObject != (HANDLE)0xffffffff) {
      CloseHandle(hObject);
    }
  }
LAB_004318d0:
  if (local_228 != (LPCWSTR)0x0) {
    FUN_004380ab(local_228);
  }
  if (local_22c != (LPCWSTR)0x0) {
    FUN_004380ab(local_22c);
  }
  if (local_224 != (LPCWSTR)0x0) {
    FUN_004380ab(local_224);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0043191f */

DWORD FUN_0043191f(int *param_1,LPCWSTR param_2,LPWSTR param_3)

{
  uint uVar1;
  DWORD DVar2;
  LPCWSTR pWVar3;
  uint uVar4;
  uint local_10;
  LPCWSTR local_c;
  LPCWSTR local_8;
  
  local_c = (LPCWSTR)0x0;
  local_8 = (LPCWSTR)0x0;
  local_10 = 0;
  if (((uint)param_3 & 1) == 0) {
LAB_00431a46:
    pWVar3 = local_8;
    if (((uint)param_3 & 2) == 0) {
      local_8 = (LPCWSTR)0x0;
      local_c = pWVar3;
    }
    else {
      param_3 = (LPWSTR)0x0;
      pWVar3 = param_2;
      if (local_8 != (LPCWSTR)0x0) {
        pWVar3 = local_8;
      }
      uVar4 = 0x40;
      if (0x40 < local_10) {
        uVar4 = local_10;
      }
      uVar1 = FUN_00433bdf((int *)&local_c,uVar4);
      if ((int)uVar1 < 0) goto LAB_00431b61;
      uVar1 = GetFullPathNameW(pWVar3,uVar4,local_c,&param_3);
      if (uVar1 == 0) {
        DVar2 = GetLastError();
        uVar1 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar1 = DVar2;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        goto LAB_00431b21;
      }
      if (uVar4 < uVar1) {
        uVar4 = uVar1 + 7;
        if (uVar1 < 0x104) {
          uVar4 = uVar1;
        }
        uVar1 = FUN_00433bdf((int *)&local_c,uVar4);
        if ((int)uVar1 < 0) goto LAB_00431b61;
        uVar1 = GetFullPathNameW(pWVar3,uVar4,local_c,&param_3);
        if (uVar1 == 0) {
          DVar2 = GetLastError();
          uVar1 = DVar2 & 0xffff | 0x80070000;
          if ((int)DVar2 < 1) {
            uVar1 = DVar2;
          }
          if (-1 < (int)uVar1) {
            uVar1 = 0x80004005;
          }
          goto LAB_00431b21;
        }
        if (uVar4 < uVar1) goto LAB_00431b1f;
      }
      if ((0x104 < uVar1) && (uVar1 = FUN_00431d67((int *)&local_c), (int)uVar1 < 0))
      goto LAB_00431b61;
    }
    if (local_c != (LPCWSTR)0x0) {
      param_2 = local_c;
    }
    uVar1 = FUN_00433f88(param_1,param_2,0);
  }
  else {
    local_10 = 0x40;
    uVar1 = FUN_00433bdf((int *)&local_8,0x40);
    if ((int)uVar1 < 0) goto LAB_00431b61;
    uVar1 = ExpandEnvironmentStringsW(param_2,local_8,local_10);
    if (uVar1 == 0) {
      DVar2 = GetLastError();
      uVar1 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar1 = DVar2;
      }
      if (-1 < (int)uVar1) {
        uVar1 = 0x80004005;
      }
    }
    else {
      if (uVar1 <= local_10) {
LAB_00431a05:
        if (0x104 < uVar1) {
          uVar1 = FUN_00431d67((int *)&local_8);
          if (uVar1 == 0x80070057) {
            uVar1 = 0;
          }
          if (((int)uVar1 < 0) || (uVar1 = FUN_0043452e(local_8,&local_10), (int)uVar1 < 0))
          goto LAB_00431b61;
        }
        goto LAB_00431a46;
      }
      local_10 = uVar1;
      uVar1 = FUN_00433bdf((int *)&local_8,uVar1);
      if ((int)uVar1 < 0) goto LAB_00431b61;
      uVar1 = ExpandEnvironmentStringsW(param_2,local_8,local_10);
      if (uVar1 == 0) {
        DVar2 = GetLastError();
        uVar1 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar1 = DVar2;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        goto LAB_00431b21;
      }
      if (uVar1 <= local_10) goto LAB_00431a05;
LAB_00431b1f:
      uVar1 = 0x8007007a;
    }
LAB_00431b21:
    FUN_004300d9();
  }
LAB_00431b61:
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00431b86 */

short * FUN_00431b86(short *param_1)

{
  short sVar1;
  short *psVar2;
  short *psVar3;
  
  if (param_1 != (short *)0x0) {
    sVar1 = *param_1;
    psVar2 = (short *)0x0;
    psVar3 = param_1;
    while (param_1 = psVar2, sVar1 != 0) {
      if (((sVar1 == 0x5c) || (sVar1 == 0x2f)) || (sVar1 == 0x3a)) {
        param_1 = (short *)0x0;
      }
      else if (sVar1 == 0x2e) {
        param_1 = psVar3;
      }
      psVar3 = psVar3 + 1;
      psVar2 = param_1;
      sVar1 = *psVar3;
    }
  }
  return param_1;
}



/* Function: FUN_00431bd3 */

int FUN_00431bd3(short *param_1,uint param_2)

{
  int iVar1;
  uint local_8;
  
  local_8 = 0;
  iVar1 = FUN_0040e205(param_1,param_2,(int *)&local_8);
  if (-1 < iVar1) {
    if (local_8 < param_2) {
      if (param_1[local_8 - 1] != 0x5c) {
        param_1[local_8] = 0x5c;
        param_1[local_8 + 1] = 0;
      }
    }
    else {
      iVar1 = -0x7ff8ff86;
    }
  }
  return iVar1;
}



/* Function: FUN_00431c19 */

DWORD FUN_00431c19(int *param_1,HMODULE param_2)

{
  DWORD DVar1;
  uint uVar2;
  
  uVar2 = 0x104;
  while( true ) {
    DVar1 = FUN_00433bdf(param_1,uVar2);
    if ((int)DVar1 < 0) {
      return DVar1;
    }
    DVar1 = GetModuleFileNameW(param_2,(LPWSTR)*param_1,uVar2);
    if (DVar1 == 0) break;
    if (DVar1 != uVar2) {
      return 0;
    }
    uVar2 = DVar1 + 1;
  }
  DVar1 = GetLastError();
  uVar2 = DVar1 & 0xffff | 0x80070000;
  if ((int)DVar1 < 1) {
    uVar2 = DVar1;
  }
  if (-1 < (int)uVar2) {
    uVar2 = 0x80004005;
  }
  FUN_004300d9();
  return uVar2;
}



/* Function: FUN_00431c88 */

int FUN_00431c88(LPCWSTR param_1,int *param_2)

{
  WCHAR WVar1;
  WCHAR WVar2;
  uint uVar3;
  int iVar4;
  LPCWSTR pWVar5;
  
  WVar1 = *param_1;
  uVar3 = 0xffffffff;
  if (WVar1 != L'\0') {
    iVar4 = 0;
    pWVar5 = param_1;
    WVar2 = WVar1;
    do {
      if (((WVar2 == L'\\') || (WVar2 == L'/')) || ((WVar2 == L':' && (pWVar5 == param_1 + 1)))) {
        uVar3 = (iVar4 >> 1) + 1;
      }
      pWVar5 = pWVar5 + 1;
      iVar4 = iVar4 + 2;
      WVar2 = *pWVar5;
    } while (WVar2 != L'\0');
    if (uVar3 != 0xffffffff) {
      if (WVar1 == L'\"') {
        param_1 = param_1 + 1;
        uVar3 = uVar3 - 1;
      }
      iVar4 = FUN_00433f88(param_2,param_1,uVar3);
      return iVar4;
    }
  }
  return 1;
}



/* Function: FUN_00431d07 */

void FUN_00431d07(undefined4 param_1,int *param_2)

{
  int iVar1;
  
  iVar1 = FUN_00433bdf(param_2,0x104);
  if (-1 < iVar1) {
    iVar1 = SHGetFolderPathW(0,param_1,0,0,*param_2);
    if (-1 < iVar1) {
      FUN_0043124a(param_2);
    }
  }
  return;
}



/* Function: FUN_00431d3c */

undefined4 FUN_00431d3c(LPCWSTR param_1)

{
  uint uVar1;
  undefined4 uVar2;
  
  uVar1 = lstrlenW(param_1);
  uVar2 = 1;
  if (((uVar1 < 2) || (*param_1 != L'\\')) && (param_1[1] != L':')) {
    uVar2 = 0;
  }
  return uVar2;
}



/* Function: FUN_00431d67 */

int FUN_00431d67(int *param_1)

{
  ushort uVar1;
  ushort *_Dst;
  int *piVar2;
  wchar_t *pwVar3;
  int iVar4;
  
  piVar2 = param_1;
  _Dst = (ushort *)*param_1;
  param_1 = (int *)0x0;
  uVar1 = *_Dst;
  if ((((uVar1 < 0x61) || (0x7a < uVar1)) && ((uVar1 < 0x41 || (0x5a < uVar1)))) ||
     ((_Dst[1] != 0x3a || (_Dst[2] != 0x5c)))) {
    if ((uVar1 != 0x5c) || (_Dst[1] != 0x5c)) {
      return -0x7ff8ffa9;
    }
    if ((_Dst[2] == 0x3f) && (_Dst[3] == 0x5c)) {
      return 0;
    }
    iVar4 = FUN_00434564(_Dst,(int *)&param_1);
    if (iVar4 < 0) {
      return iVar4;
    }
    _memmove_s(_Dst,(rsize_t)param_1,_Dst + 1,(int)param_1 - 2);
    iVar4 = 7;
    pwVar3 = L"\\\\?\\UNC";
  }
  else {
    iVar4 = 4;
    pwVar3 = L"\\\\?\\";
  }
  iVar4 = FUN_00433ec4(piVar2,pwVar3,iVar4);
  return iVar4;
}



/* Function: FUN_00431e0f */

DWORD FUN_00431e0f(HANDLE param_1,uint *param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  DWORD local_10;
  int local_c;
  HANDLE local_8;
  
  uVar3 = 0;
  local_8 = (HANDLE)0x0;
  local_c = 0;
  local_10 = 0;
  BVar1 = OpenProcessToken(param_1,8,&local_8);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
  }
  else {
    BVar1 = GetTokenInformation(local_8,TokenElevation,&local_c,4,&local_10);
    if (BVar1 != 0) {
      *param_2 = (uint)(local_c != 0);
      goto LAB_00431eb8;
    }
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (uVar3 == 0x80070057) {
      uVar3 = 0;
      *param_2 = 0;
      goto LAB_00431eb8;
    }
    if (-1 < (int)uVar3) goto LAB_00431eb8;
  }
  FUN_004300d9();
LAB_00431eb8:
  if (local_8 != (HANDLE)0x0) {
    CloseHandle(local_8);
  }
  return uVar3;
}



/* Function: FUN_00431ece */

DWORD FUN_00431ece(LPCWSTR param_1,int param_2,WORD param_3,undefined4 *param_4)

{
  HANDLE pvVar1;
  uint uVar2;
  BOOL BVar3;
  DWORD DVar4;
  _STARTUPINFOW local_5c;
  _PROCESS_INFORMATION local_18;
  LPWSTR local_8;
  
  local_8 = (LPWSTR)0x0;
  FUN_004267c0(&local_5c.cb,0,0x44);
  local_18.hProcess = (HANDLE)0x0;
  local_18.hThread = (HANDLE)0x0;
  local_18.dwProcessId = 0;
  local_18.dwThreadId = 0;
  uVar2 = FUN_00433cea((int *)&local_8,L"\"%ls\" %ls");
  if (-1 < (int)uVar2) {
    local_5c.cb = 0x44;
    local_5c.wShowWindow = param_3;
    BVar3 = CreateProcessW(param_1,local_8,(LPSECURITY_ATTRIBUTES)0x0,(LPSECURITY_ATTRIBUTES)0x0,0,0
                           ,(LPVOID)0x0,(LPCWSTR)0x0,&local_5c,&local_18);
    pvVar1 = local_18.hProcess;
    if (BVar3 == 0) {
      DVar4 = GetLastError();
      uVar2 = DVar4 & 0xffff | 0x80070000;
      if ((int)DVar4 < 1) {
        uVar2 = DVar4;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
    }
    else {
      local_18.hProcess = (HANDLE)0x0;
      *param_4 = pvVar1;
    }
  }
  if (local_18.hThread != (HANDLE)0x0) {
    CloseHandle(local_18.hThread);
    local_18.hThread = (HANDLE)0x0;
  }
  if (local_18.hProcess != (HANDLE)0x0) {
    CloseHandle(local_18.hProcess);
    local_18.hProcess = (HANDLE)0x0;
  }
  if (local_8 != (LPWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar2;
}



/* Function: FUN_00431fb6 */

DWORD FUN_00431fb6(HANDLE param_1,DWORD param_2,DWORD *param_3)

{
  DWORD DVar1;
  BOOL BVar2;
  uint uVar3;
  DWORD local_8;
  
  local_8 = 0;
  local_8 = WaitForSingleObject(param_1,param_2);
  if (local_8 == 0xffffffff) {
    DVar1 = GetLastError();
    uVar3 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar3 = DVar1;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
  }
  else {
    if (local_8 == 0x102) {
      return 0x80070102;
    }
    BVar2 = GetExitCodeProcess(param_1,&local_8);
    if (BVar2 != 0) {
      *param_3 = local_8;
      return 0;
    }
    DVar1 = GetLastError();
    uVar3 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar3 = DVar1;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
  }
  FUN_004300d9();
  return uVar3;
}



/* Function: FUN_00432058 */

DWORD FUN_00432058(undefined4 param_1,undefined4 *param_2)

{
  HMODULE hModule;
  FARPROC pFVar1;
  int iVar2;
  DWORD DVar3;
  uint uVar4;
  char *lpProcName;
  undefined4 local_8;
  
  lpProcName = "IsWow64Process";
  local_8 = 0;
  hModule = GetModuleHandleW(L"kernel32");
  pFVar1 = GetProcAddress(hModule,lpProcName);
  if ((pFVar1 != (FARPROC)0x0) && (iVar2 = (*pFVar1)(param_1,&local_8), iVar2 == 0)) {
    DVar3 = GetLastError();
    uVar4 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar4 = DVar3;
    }
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
    FUN_004300d9();
    return uVar4;
  }
  *param_2 = local_8;
  return 0;
}



/* Function: FUN_004320c6 */

int FUN_004320c6(short *param_1,uint param_2,int *param_3)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  uint uVar4;
  
  uVar1 = param_2 >> 1;
  iVar2 = 0;
  if ((param_1 == (short *)0x0) || (0x7fffffff < uVar1)) {
    iVar3 = -0x7ff8ffa9;
  }
  else {
    iVar3 = 0;
    uVar4 = uVar1;
    if (uVar1 != 0) {
      do {
        if (*param_1 == 0) break;
        param_1 = param_1 + 1;
        uVar4 = uVar4 - 1;
      } while (uVar4 != 0);
      if (uVar4 != 0) {
        iVar2 = uVar1 - uVar4;
        goto LAB_0043210d;
      }
    }
    iVar3 = -0x7ff8ffa9;
  }
LAB_0043210d:
  if (param_3 != (int *)0x0) {
    if (iVar3 < 0) {
      *param_3 = 0;
    }
    else {
      *param_3 = iVar2 * 2;
    }
  }
  return iVar3;
}



/* Function: FUN_00432129 */

uint FUN_00432129(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  uVar1 = (*DAT_00457ec0)(param_1,param_2,0,0,0,param_3,0,param_4,0);
  if (uVar1 != 0) {
    uVar2 = uVar1 & 0xffff | 0x80070000;
    if ((int)uVar1 < 1) {
      uVar2 = uVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_00432176 */

uint FUN_00432176(undefined4 param_1,undefined4 param_2,undefined4 param_3,int param_4,
                 undefined4 param_5,undefined4 param_6,uint *param_7)

{
  uint uVar1;
  uint uVar2;
  int local_8;
  
  uVar2 = 0;
  uVar1 = (*DAT_00457ec0)(param_1,param_2,0,0,param_4 != 0,param_3,param_5,param_6,&local_8);
  if (uVar1 == 0) {
    if (param_7 != (uint *)0x0) {
      *param_7 = (uint)(local_8 == 1);
    }
  }
  else {
    uVar2 = uVar1 & 0xffff | 0x80070000;
    if ((int)uVar1 < 1) {
      uVar2 = uVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_004321e8 */

uint FUN_004321e8(undefined4 param_1,LPCWSTR param_2,int param_3,int param_4)

{
  uint uVar1;
  uint uVar2;
  undefined4 uVar3;
  uint uVar4;
  LPCWSTR local_10;
  LPCWSTR local_c;
  HKEY local_8;
  
  local_c = (LPCWSTR)0x0;
  local_10 = (LPCWSTR)0x0;
  local_8 = (HKEY)0x0;
  uVar3 = 0;
  if (param_4 != 0) {
    uVar1 = FUN_004324d5(param_1,param_2,0x20019,&local_8);
    if (uVar1 == 0x80070002) {
      uVar1 = 0;
    }
    else {
      while (-1 < (int)uVar1) {
        uVar1 = FUN_004323b4(local_8,0,(int *)&local_c);
        if (uVar1 == 0x80070103) goto LAB_0043227f;
        if (((int)uVar1 < 0) ||
           (uVar1 = FUN_004314a9(param_2,local_c,(int *)&local_10), (int)uVar1 < 0)) break;
        uVar1 = FUN_004321e8(param_1,local_10,param_3,param_4);
      }
    }
    goto LAB_00432331;
  }
LAB_0043227f:
  uVar1 = 0;
  if ((DAT_00457eb4 == 0) && (param_3 != 0)) {
    uVar1 = 0x80070057;
    goto LAB_00432331;
  }
  if (param_3 == 1) {
    uVar3 = 0x200;
  }
  else if (param_3 == 2) {
    uVar3 = 0x100;
  }
  if (DAT_00457eb8 == (code *)0x0) {
    uVar2 = (*DAT_00457ec8)(param_1,param_2);
    uVar4 = uVar2 & 0xffff | 0x80070000;
    if ((int)uVar2 < 1) {
      uVar4 = uVar2;
    }
    if (uVar4 == 0x80070002) goto LAB_0043230d;
    if (uVar2 == 0) goto LAB_00432331;
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
  }
  else {
    uVar2 = (*DAT_00457eb8)(param_1,param_2,uVar3,0);
    uVar4 = uVar2 & 0xffff | 0x80070000;
    if ((int)uVar2 < 1) {
      uVar4 = uVar2;
    }
    if (uVar4 == 0x80070002) {
LAB_0043230d:
      uVar1 = 0x80070002;
      goto LAB_00432331;
    }
    if (uVar2 == 0) goto LAB_00432331;
    if (-1 < (int)uVar4) {
      uVar4 = 0x80004005;
    }
  }
  FUN_004300d9();
  uVar1 = uVar4;
LAB_00432331:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  if (local_10 != (LPCWSTR)0x0) {
    FUN_004380ab(local_10);
  }
  return uVar1;
}



/* Function: FUN_00432369 */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

int FUN_00432369(void)

{
  int iVar1;
  
  iVar1 = FUN_004300dc(0x452f38,&DAT_00457eb0);
  if (-1 < iVar1) {
    _DAT_00457ebc = GetProcAddress(DAT_00457eb0,"RegDeleteKeyExW");
    if (DAT_00457eb8 == (FARPROC)0x0) {
      DAT_00457eb8 = _DAT_00457ebc;
    }
    DAT_00457eb4 = 1;
  }
  return iVar1;
}



/* Function: FUN_004323b4 */

uint FUN_004323b4(undefined4 param_1,undefined4 param_2,int *param_3)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  uint local_8;
  
  local_8 = 0;
  if ((param_3 == (int *)0x0) || (*param_3 == 0)) {
LAB_004323e6:
    local_8 = 2;
    uVar1 = FUN_00433bdf(param_3,2);
    if ((int)uVar1 < 0) {
      return uVar1;
    }
  }
  else {
    uVar1 = FUN_0043452e((LPCVOID)*param_3,&local_8);
    if ((int)uVar1 < 0) {
      return uVar1;
    }
    if (local_8 < 2) goto LAB_004323e6;
  }
  uVar2 = (*DAT_00457ecc)(param_1,param_2,*param_3,&local_8,0,0,0,0);
  if (uVar2 == 0xea) {
    uVar1 = (*DAT_00457ed4)(param_1,0,0,0,0,&local_8,0,0,0,0,0,0);
    if (uVar1 != 0) {
      uVar3 = uVar1 & 0xffff | 0x80070000;
      if ((int)uVar1 < 1) {
        uVar3 = uVar1;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
      goto LAB_004324a7;
    }
    local_8 = local_8 + 1;
    uVar1 = FUN_00433bdf(param_3,local_8);
    if ((int)uVar1 < 0) {
      return uVar1;
    }
    uVar2 = (*DAT_00457ecc)(param_1,param_2,*param_3,&local_8,0,0,0,0);
  }
  else if (uVar2 == 0x103) {
    return 0x80070103;
  }
  if (uVar2 == 0) {
    *(undefined2 *)(*param_3 + local_8 * 2) = 0;
    return uVar1;
  }
  uVar3 = uVar2 & 0xffff | 0x80070000;
  if ((int)uVar2 < 1) {
    uVar3 = uVar2;
  }
  if (-1 < (int)uVar3) {
    uVar3 = 0x80004005;
  }
LAB_004324a7:
  FUN_004300d9();
  return uVar3;
}



/* Function: FUN_004324d5 */

uint FUN_004324d5(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  
  uVar1 = (*DAT_00457ec4)(param_1,param_2,0,param_3,param_4);
  uVar2 = uVar1 & 0xffff | 0x80070000;
  if ((int)uVar1 < 1) {
    uVar2 = uVar1;
  }
  if (uVar2 == 0x80070002) {
    uVar3 = 0x80070002;
  }
  else {
    uVar3 = 0;
    if (uVar1 != 0) {
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
      uVar3 = uVar2;
    }
  }
  return uVar3;
}



/* Function: FUN_00432531 */

uint FUN_00432531(undefined4 param_1,undefined4 param_2,undefined4 param_3)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  uVar1 = (*DAT_00457ed4)(param_1,0,0,0,param_2,0,0,param_3,0,0,0,0);
  if (uVar1 != 0) {
    uVar2 = uVar1 & 0xffff | 0x80070000;
    if ((int)uVar1 < 1) {
      uVar2 = uVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_00432582 */

uint FUN_00432582(undefined4 param_1,undefined4 param_2,undefined4 param_3)

{
  uint uVar1;
  uint uVar2;
  undefined4 local_c;
  int local_8;
  
  local_8 = 0;
  local_c = 4;
  uVar1 = (*DAT_00457ed8)(param_1,param_2,0,&local_8,param_3,&local_c);
  uVar2 = uVar1 & 0xffff | 0x80070000;
  if ((int)uVar1 < 1) {
    uVar2 = uVar1;
  }
  if (uVar2 == 0x80070002) {
    uVar2 = 0x80070002;
  }
  else {
    if (uVar1 == 0) {
      if (local_8 == 4) {
        return 0;
      }
      uVar2 = 0x8007070c;
    }
    else if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_00432602 */

uint FUN_00432602(undefined4 param_1,undefined4 param_2,int *param_3)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  LPCWSTR local_14;
  uint local_10;
  int local_c;
  uint local_8;
  
  local_8 = 0;
  local_10 = 0;
  local_c = 0;
  local_14 = (LPCWSTR)0x0;
  if ((param_3 == (int *)0x0) || (*param_3 == 0)) {
LAB_00432641:
    local_8 = 2;
    uVar1 = FUN_00433bdf(param_3,2);
    if ((int)uVar1 < 0) goto LAB_00432741;
  }
  else {
    uVar1 = FUN_0043452e((LPCVOID)*param_3,&local_8);
    if ((int)uVar1 < 0) goto LAB_00432741;
    if (local_8 < 2) goto LAB_00432641;
  }
  local_10 = local_8 * 2 - 2;
  uVar2 = (*DAT_00457ed8)(param_1,param_2,0,&local_c,*param_3,&local_10);
  if (uVar2 == 0xea) {
    local_8 = (local_10 >> 1) + 1;
    uVar1 = FUN_00433bdf(param_3,local_8);
    if ((int)uVar1 < 0) goto LAB_00432741;
    uVar2 = (*DAT_00457ed8)(param_1,param_2,0,&local_c,*param_3,&local_10);
  }
  uVar3 = uVar2 & 0xffff | 0x80070000;
  if ((int)uVar2 < 1) {
    uVar3 = uVar2;
  }
  if (uVar3 == 0x80070002) {
    uVar1 = 0x80070002;
  }
  else {
    if (uVar2 == 0) {
      if ((local_c == 1) || (local_c == 2)) {
        *(undefined2 *)(*param_3 + -2 + local_8 * 2) = 0;
        if ((local_c == 2) &&
           (uVar1 = FUN_00433f88((int *)&local_14,(LPCWSTR)*param_3,0), -1 < (int)uVar1)) {
          uVar1 = FUN_0043191f(param_3,local_14,(LPWSTR)0x1);
        }
        goto LAB_00432741;
      }
      uVar1 = 0x8007070c;
    }
    else {
      uVar1 = uVar3;
      if (-1 < (int)uVar3) {
        uVar1 = 0x80004005;
      }
    }
    FUN_004300d9();
  }
LAB_00432741:
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  return uVar1;
}



/* Function: FUN_00432757 */

uint FUN_00432757(undefined4 param_1,undefined4 param_2,int *param_3,uint *param_4)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  uint uVar5;
  LPCWSTR lpString;
  int local_10;
  uint local_c;
  LPCWSTR local_8;
  
  iVar4 = 0;
  local_10 = 0;
  local_c = 0;
  uVar5 = 0;
  local_8 = (LPCWSTR)0x0;
  uVar1 = (*DAT_00457ed8)(param_1,param_2,0,&local_10,0,&local_c);
  if (local_c != 0) {
    uVar5 = local_c >> 1;
    uVar2 = FUN_00433bdf((int *)&local_8,uVar5);
    if ((int)uVar2 < 0) goto LAB_004328bd;
    uVar1 = (*DAT_00457ed8)(param_1,param_2,0,&local_10,local_8,&local_c);
  }
  uVar3 = uVar1 & 0xffff | 0x80070000;
  if ((int)uVar1 < 1) {
    uVar3 = uVar1;
  }
  uVar2 = 0x80070002;
  if (uVar3 == 0x80070002) goto LAB_004328bd;
  if (uVar1 == 0) {
    uVar1 = local_c >> 1;
    if (uVar1 != uVar5) {
      uVar2 = 0x8000ffff;
      goto LAB_004328bd;
    }
    if (local_10 == 7) {
      if (uVar5 < 2) {
        *param_3 = 0;
        *param_4 = 0;
        uVar2 = 0;
      }
      else {
        uVar2 = 0;
        if ((local_8[uVar5 - 1] == L'\0') && (local_8[uVar5 - 2] == L'\0')) {
          if (uVar1 != 0) {
            do {
              if (local_8[uVar2] == L'\0') {
                iVar4 = iVar4 + 1;
              }
              uVar2 = uVar2 + 1;
            } while (uVar2 < uVar1);
          }
          *param_4 = iVar4 - 1U;
          uVar2 = FUN_0043109a(param_3,iVar4 - 1U,4,0);
          if ((-1 < (int)uVar2) && (uVar1 = 0, lpString = local_8, *param_4 != 0)) {
            do {
              uVar2 = FUN_00433f88((int *)(*param_3 + uVar1 * 4),lpString,0);
              if ((int)uVar2 < 0) break;
              iVar4 = lstrlenW(lpString);
              lpString = lpString + iVar4 + 1;
              uVar1 = uVar1 + 1;
            } while (uVar1 < *param_4);
          }
        }
        else {
          uVar2 = 0x80070057;
        }
      }
      goto LAB_004328bd;
    }
    uVar2 = 0x8007070c;
  }
  else {
    uVar2 = uVar3;
    if (-1 < (int)uVar3) {
      uVar2 = 0x80004005;
    }
  }
  FUN_004300d9();
LAB_004328bd:
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar2;
}



/* Function: FUN_004328d3 */

uint FUN_004328d3(undefined4 param_1,undefined4 param_2,uint *param_3)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  undefined4 local_10;
  LPCWSTR local_c;
  int local_8;
  
  local_8 = 0;
  local_c = (LPCWSTR)0x0;
  local_10 = 8;
  uVar1 = (*DAT_00457ed8)(param_1,param_2,0,&local_8,*param_3,&local_10);
  uVar3 = uVar1 & 0xffff | 0x80070000;
  if ((int)uVar1 < 1) {
    uVar3 = uVar1;
  }
  if (uVar3 == 0x80070002) {
    uVar2 = 0x80070002;
  }
  else if ((local_8 == 1) || (local_8 == 2)) {
    uVar2 = FUN_00432602(param_1,param_2,(int *)&local_c);
    if (-1 < (int)uVar2) {
      uVar2 = FUN_0043720f(local_c,0,param_3);
    }
  }
  else {
    if (local_8 == 0xb) {
      uVar2 = 0;
      if (uVar1 == 0) goto LAB_00432985;
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
    }
    else {
      uVar3 = 0x8007070c;
    }
    FUN_004300d9();
    uVar2 = uVar3;
  }
LAB_00432985:
  if (local_c != (LPCWSTR)0x0) {
    FUN_004380ab(local_c);
  }
  return uVar2;
}



/* Function: FUN_0043299b */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void FUN_0043299b(void)

{
  if (DAT_00457eb0 != (HMODULE)0x0) {
    FreeLibrary(DAT_00457eb0);
    DAT_00457eb0 = (HMODULE)0x0;
    _DAT_00457ebc = 0;
    DAT_00457eb8 = 0;
  }
  DAT_00457eb4 = 0;
  return;
}



/* Function: FUN_004329c8 */

uint FUN_004329c8(undefined4 param_1,undefined4 param_2)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  uVar1 = (*DAT_00457edc)(param_1,param_2,0,4,&stack0x0000000c,4);
  if (uVar1 != 0) {
    uVar2 = uVar1 & 0xffff | 0x80070000;
    if ((int)uVar1 < 1) {
      uVar2 = uVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_00432a16 */

uint FUN_00432a16(undefined4 param_1,undefined4 param_2,short *param_3)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  int local_8;
  
  local_8 = 0;
  if (param_3 == (short *)0x0) {
    uVar1 = (*DAT_00457ee0)(param_1,param_2);
    if ((uVar1 == 2) || (uVar1 == 3)) {
      uVar1 = 0;
    }
    if (uVar1 == 0) {
      return 0;
    }
    uVar3 = uVar1 & 0xffff | 0x80070000;
    if ((int)uVar1 < 1) {
      uVar3 = uVar1;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
  }
  else {
    uVar1 = FUN_004320c6(param_3,0xffffffff,&local_8);
    if ((int)uVar1 < 0) {
      return uVar1;
    }
    uVar2 = (*DAT_00457edc)(param_1,param_2,0,1,param_3,local_8);
    if (uVar2 == 0) {
      return uVar1;
    }
    uVar3 = uVar2 & 0xffff | 0x80070000;
    if ((int)uVar2 < 1) {
      uVar3 = uVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
  }
  FUN_004300d9();
  return uVar3;
}



/* Function: FUN_00432abe */

uint FUN_00432abe(undefined4 param_1,undefined4 param_2,short *param_3,uint param_4)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  uint uVar4;
  short *psVar5;
  short *psVar6;
  uint *puVar7;
  undefined4 local_10;
  uint local_c;
  short *local_8;
  
  uVar4 = 0;
  local_10 = 0;
  local_8 = (short *)0x0;
  if (param_4 == 0) {
    param_3 = (short *)&DAT_00452f70;
  }
  else {
    uVar4 = 0;
    local_c = 1;
    if (param_4 != 0) {
      do {
        uVar3 = local_c;
        puVar7 = &local_c;
        iVar2 = lstrlenW(*(LPCWSTR *)(param_3 + uVar4 * 2));
        uVar3 = FUN_00430249(uVar3,iVar2 + 1,puVar7);
        psVar6 = local_8;
        if ((int)uVar3 < 0) goto LAB_00432be1;
        uVar4 = uVar4 + 1;
      } while (uVar4 < param_4);
    }
    uVar4 = local_c;
    uVar3 = FUN_00433bdf((int *)&local_8,local_c);
    psVar6 = local_8;
    if ((int)uVar3 < 0) goto LAB_00432be1;
    local_c = 0;
    psVar5 = local_8;
    if (param_4 != 0) {
      do {
        uVar3 = FUN_0041cddb(psVar5,uVar4,*(int *)(param_3 + local_c * 2));
        uVar1 = local_c;
        psVar6 = local_8;
        if ((int)uVar3 < 0) goto LAB_00432be1;
        lstrlenW(*(LPCWSTR *)(param_3 + local_c * 2));
        iVar2 = lstrlenW(*(LPCWSTR *)(param_3 + uVar1 * 2));
        psVar5 = psVar5 + iVar2 + 1;
        local_c = uVar1 + 1;
      } while (local_c < param_4);
    }
    param_3 = local_8;
  }
  psVar6 = local_8;
  uVar3 = FUN_0043026c(uVar4 * 2,uVar4 >> 0x1f,&local_10);
  if ((-1 < (int)uVar3) &&
     (uVar4 = (*DAT_00457edc)(param_1,param_2,0,7,param_3,local_10), psVar6 = local_8, uVar4 != 0))
  {
    uVar3 = uVar4 & 0xffff | 0x80070000;
    if ((int)uVar4 < 1) {
      uVar3 = uVar4;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
    psVar6 = local_8;
  }
LAB_00432be1:
  if (psVar6 != (short *)0x0) {
    FUN_004380ab(psVar6);
  }
  return uVar3;
}



/* Function: FUN_00432bf4 */

uint __cdecl FUN_00432bf4(undefined4 param_1,undefined4 param_2,wchar_t *param_3)

{
  uint uVar1;
  short *local_8;
  
  local_8 = (short *)0x0;
  uVar1 = FUN_00433cfe((int *)&local_8,param_3,&stack0x00000010);
  if (-1 < (int)uVar1) {
    uVar1 = FUN_00432a16(param_1,param_2,local_8);
  }
  if (local_8 != (short *)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00432c36 */

void FUN_00432c36(void)

{
  BOOL BVar1;
  DWORD DVar2;
  undefined1 local_22c;
  undefined4 local_22b;
  undefined4 uStack_227;
  undefined4 uStack_223;
  undefined4 uStack_21f;
  undefined2 uStack_21b;
  undefined1 uStack_219;
  PACL local_218;
  DWORD local_214;
  undefined8 local_210;
  uint local_208 [16];
  undefined8 local_1c8;
  uint local_1c0 [16];
  undefined8 local_180;
  uint local_178 [16];
  undefined8 local_138;
  uint local_130 [16];
  CHAR local_f0 [8];
  uint local_e8 [16];
  _EXPLICIT_ACCESS_A local_a8;
  undefined4 local_88;
  undefined4 local_84;
  undefined4 local_80;
  undefined4 local_7c;
  undefined4 local_78;
  undefined4 local_74;
  undefined4 local_70;
  undefined8 *local_6c;
  undefined4 local_68;
  undefined4 local_64;
  undefined4 local_60;
  undefined4 local_5c;
  undefined4 local_58;
  undefined4 local_54;
  undefined4 local_50;
  undefined8 *local_4c;
  undefined4 local_48;
  undefined4 local_44;
  undefined4 local_40;
  undefined4 local_3c;
  undefined4 local_38;
  undefined4 local_34;
  undefined4 local_30;
  undefined8 *local_2c;
  undefined4 local_28;
  undefined4 local_24;
  undefined4 local_20;
  undefined4 local_1c;
  undefined4 local_18;
  undefined4 local_14;
  undefined4 local_10;
  undefined8 *local_c;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_22c = 0;
  local_22b = 0;
  uStack_227 = 0;
  uStack_223 = 0;
  uStack_21f = 0;
  uStack_21b = 0;
  uStack_219 = 0;
  local_a8.grfAccessPermissions = 0;
  FUN_004267c0(&local_a8.grfAccessMode,0,0x9c);
  local_218 = (PACL)0x0;
  local_f0[0] = '\0';
  local_f0[1] = '\0';
  local_f0[2] = '\0';
  local_f0[3] = '\0';
  local_f0[4] = '\0';
  local_f0[5] = '\0';
  local_f0[6] = '\0';
  local_f0[7] = '\0';
  FUN_004267c0(local_e8,0,0x40);
  local_138 = 0;
  FUN_004267c0(local_130,0,0x40);
  local_180 = 0;
  FUN_004267c0(local_178,0,0x40);
  local_1c8 = 0;
  FUN_004267c0(local_1c0,0,0x40);
  local_210 = 0;
  FUN_004267c0(local_208,0,0x40);
  local_214 = 0;
  BVar1 = InitializeSecurityDescriptor(&local_22c,1);
  if (BVar1 == 0) {
    GetLastError();
  }
  else {
    local_214 = 0x48;
    BVar1 = CreateWellKnownSid(WinBuiltinAdministratorsSid,(PSID)0x0,local_f0,&local_214);
    if (BVar1 == 0) {
      GetLastError();
    }
    else {
      local_214 = 0x48;
      BVar1 = CreateWellKnownSid(WinLocalServiceSid,(PSID)0x0,&local_138,&local_214);
      if (BVar1 == 0) {
        GetLastError();
      }
      else {
        local_214 = 0x48;
        BVar1 = CreateWellKnownSid(WinNetworkServiceSid,(PSID)0x0,&local_180,&local_214);
        if (BVar1 == 0) {
          GetLastError();
        }
        else {
          local_214 = 0x48;
          BVar1 = CreateWellKnownSid(WinSelfSid,(PSID)0x0,&local_1c8,&local_214);
          if (BVar1 == 0) {
            GetLastError();
          }
          else {
            local_214 = 0x48;
            BVar1 = CreateWellKnownSid(WinLocalSystemSid,(PSID)0x0,&local_210,&local_214);
            if (BVar1 == 0) {
              GetLastError();
            }
            else {
              local_a8.Trustee.ptstrName = local_f0;
              local_6c = &local_138;
              local_4c = &local_180;
              local_2c = &local_1c8;
              local_c = &local_210;
              local_a8.grfAccessPermissions = 3;
              local_a8.grfAccessMode = SET_ACCESS;
              local_a8.grfInheritance = 0;
              local_a8.Trustee.pMultipleTrustee = (_TRUSTEE_A *)0x0;
              local_a8.Trustee.MultipleTrusteeOperation = NO_MULTIPLE_TRUSTEE;
              local_a8.Trustee.TrusteeForm = TRUSTEE_IS_SID;
              local_a8.Trustee.TrusteeType = TRUSTEE_IS_GROUP;
              local_88 = 3;
              local_84 = 2;
              local_80 = 0;
              local_7c = 0;
              local_78 = 0;
              local_74 = 0;
              local_70 = 2;
              local_68 = 3;
              local_64 = 2;
              local_60 = 0;
              local_5c = 0;
              local_58 = 0;
              local_54 = 0;
              local_50 = 2;
              local_48 = 3;
              local_44 = 2;
              local_40 = 0;
              local_3c = 0;
              local_38 = 0;
              local_34 = 0;
              local_30 = 2;
              local_28 = 3;
              local_24 = 2;
              local_20 = 0;
              local_1c = 0;
              local_18 = 0;
              local_14 = 0;
              local_10 = 2;
              DVar2 = SetEntriesInAclA(5,&local_a8,(PACL)0x0,&local_218);
              if (DVar2 == 0) {
                BVar1 = SetSecurityDescriptorOwner(&local_22c,local_f0,0);
                if (BVar1 == 0) {
                  GetLastError();
                }
                else {
                  BVar1 = SetSecurityDescriptorGroup(&local_22c,local_f0,0);
                  if (BVar1 == 0) {
                    GetLastError();
                  }
                  else {
                    BVar1 = SetSecurityDescriptorDacl(&local_22c,1,local_218,0);
                    if (BVar1 != 0) {
                      CoInitializeSecurity
                                (&local_22c,-1,(SOLE_AUTHENTICATION_SERVICE *)0x0,(void *)0x0,6,2,
                                 (void *)0x0,0x3000,(void *)0x0);
                      goto LAB_00433087;
                    }
                    GetLastError();
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  FUN_004300d9();
LAB_00433087:
  if (local_218 != (PACL)0x0) {
    LocalFree(local_218);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004330ac */

int FUN_004330ac(short *param_1,uint param_2,int param_3)

{
  short sVar1;
  uint uVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  
  uVar2 = param_2 >> 1;
  iVar4 = 0;
  if ((uVar2 == 0) || (0x7fffffff < uVar2)) {
    iVar4 = -0x7ff8ffa9;
  }
  if (iVar4 < 0) {
    return iVar4;
  }
  iVar4 = 0;
  if (uVar2 != 0) {
    iVar5 = 0x7ffffffe - uVar2;
    iVar3 = param_3 - (int)param_1;
    do {
      if ((iVar5 + uVar2 == 0) || (sVar1 = *(short *)(iVar3 + (int)param_1), sVar1 == 0)) break;
      *param_1 = sVar1;
      param_1 = param_1 + 1;
      uVar2 = uVar2 - 1;
    } while (uVar2 != 0);
    if (uVar2 != 0) goto LAB_00433109;
  }
  param_1 = param_1 + -1;
  iVar4 = -0x7ff8ff86;
LAB_00433109:
  *param_1 = 0;
  return iVar4;
}



/* Function: FUN_00433115 */

void FUN_00433115(int param_1,int param_2)

{
  code *pcVar1;
  int iVar2;
  uint local_224;
  undefined4 local_220;
  short local_214 [256];
  uint local_14 [4];
  
  local_14[3] = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0(&local_224,0,0x210);
  pcVar1 = DAT_00457ee4;
  local_14[0] = 0;
  local_14[1] = 0;
  local_14[2] = 0;
  if (DAT_00457ee4 != (code *)0x0) {
    local_220 = 0xc;
    if (param_2 == 1) {
      local_220 = 1;
    }
    if (param_2 == 2) {
      local_220 = 0;
    }
    local_224 = 100;
    FUN_004330ac(local_214,0x200,param_1);
    iVar2 = (*pcVar1)(&local_224,local_14);
    if ((iVar2 == 0) && (local_14[0] != 0)) {
      FUN_004300d9();
    }
  }
  __security_check_cookie(local_14[3] ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004331e2 */

DWORD FUN_004331e2(int param_1)

{
  uint uVar1;
  DWORD DVar2;
  
  uVar1 = FUN_004300dc(0x452f74,&DAT_00457ee8);
  if ((int)uVar1 < 0) {
    uVar1 = 0x80004001;
  }
  else {
    DAT_00457ee4 = GetProcAddress(DAT_00457ee8,"SRSetRestorePointW");
    if (DAT_00457ee4 == (FARPROC)0x0) {
      DVar2 = GetLastError();
      uVar1 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar1 = DVar2;
      }
      if (-1 < (int)uVar1) {
        uVar1 = 0x80004005;
      }
      FUN_004300d9();
    }
    else if (param_1 != 0) {
      uVar1 = FUN_00432c36();
    }
    if (-1 < (int)uVar1) {
      return uVar1;
    }
  }
  if (DAT_00457ee8 != (HMODULE)0x0) {
    FUN_0043326f();
  }
  return uVar1;
}



/* Function: FUN_0043326f */

void FUN_0043326f(void)

{
  if (DAT_00457ee8 != (HMODULE)0x0) {
    FreeLibrary(DAT_00457ee8);
    DAT_00457ee8 = (HMODULE)0x0;
    DAT_00457ee4 = 0;
  }
  return;
}



/* Function: FUN_0043328e */

undefined4 FUN_0043328e(int param_1)

{
  int iVar1;
  char cVar2;
  
  iVar1 = param_1 + -0x30;
  cVar2 = (char)param_1;
  if ((ushort)iVar1 < 10) {
    cVar2 = cVar2 + -0x30;
  }
  else {
    iVar1 = param_1 + -0x61;
    if ((ushort)iVar1 < 6) {
      cVar2 = cVar2 + -0x57;
    }
    else {
      cVar2 = cVar2 + -0x37;
    }
  }
  return CONCAT31((int3)((uint)iVar1 >> 8),cVar2);
}



/* Function: FUN_004332b9 */

undefined4 FUN_004332b9(int param_1,int *param_2)

{
  undefined4 uVar1;
  
  if (param_1 < 0) {
    *param_2 = -1;
    uVar1 = 0x80070216;
  }
  else {
    *param_2 = param_1;
    uVar1 = 0;
  }
  return uVar1;
}



/* Function: FUN_004332d8 */

DWORD FUN_004332d8(int *param_1,LPCWSTR param_2,uint param_3,DWORD param_4)

{
  uint uVar1;
  int iVar2;
  DWORD DVar3;
  uint cchSrc;
  
  cchSrc = param_3;
  uVar1 = FUN_00433f88(param_1,param_2,param_3);
  if ((-1 < (int)uVar1) &&
     (((cchSrc != 0 ||
       (uVar1 = FUN_0040e205((short *)*param_1,0x7fffffff,(int *)&param_3), cchSrc = param_3,
       -1 < (int)uVar1)) &&
      (iVar2 = LCMapStringW(0x7f,param_4,(LPCWSTR)*param_1,cchSrc,(LPWSTR)*param_1,cchSrc),
      iVar2 == 0)))) {
    DVar3 = GetLastError();
    uVar1 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar1 = DVar3;
    }
    if (-1 < (int)uVar1) {
      uVar1 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar1;
}



/* Function: FUN_0043335d */

int FUN_0043335d(uint *param_1,undefined1 *param_2,char *param_3,uint param_4,int *param_5,
                uint *param_6,uint param_7)

{
  undefined1 *puVar1;
  int iVar2;
  uint uVar3;
  long lVar4;
  uint local_c;
  undefined1 *local_8;
  
  puVar1 = param_2;
  lVar4 = 0;
  if ((param_7 & 0x100) == 0) {
    if ((param_2 == (undefined1 *)0x0) || ((undefined1 *)0x7fffffff < param_2)) {
      lVar4 = -0x7ff8ffa9;
    }
    if (-1 < lVar4) goto LAB_00433398;
    param_2 = (undefined1 *)0x0;
  }
  else {
    if (((param_1 == (uint *)0x0) && (param_2 != (undefined1 *)0x0)) ||
       ((undefined1 *)0x7fffffff < param_2)) {
      lVar4 = -0x7ff8ffa9;
    }
    if ((lVar4 < 0) || (param_2 == (undefined1 *)0x0)) {
      param_2 = (undefined1 *)0x0;
    }
    else {
LAB_00433398:
      lVar4 = StringLengthWorkerA((char *)param_1,(uint)param_2,(uint *)&param_2);
    }
  }
  if (lVar4 < 0) {
    return lVar4;
  }
  uVar3 = (int)puVar1 - (int)param_2;
  local_8 = param_2;
  param_2 = (undefined1 *)((int)param_1 + (int)param_2);
  local_c = uVar3;
  iVar2 = FUN_00433ae5((int *)&param_3,&param_4,0x7fffffff,param_7);
  if (-1 < iVar2) {
    if ((param_7 & 0xffffe000) == 0) {
      if (uVar3 < 2) {
        if ((param_4 != 0) && (*param_3 != '\0')) {
          if (param_1 == (uint *)0x0) {
            iVar2 = -0x7ff8ffa9;
            goto LAB_0043340d;
          }
          iVar2 = -0x7ff8ff86;
        }
      }
      else {
        local_c = 0;
        iVar2 = _StringCopyWorkerA_20(param_2,uVar3,(int *)&local_c,(int)param_3,param_4);
        param_2 = param_2 + local_c;
        uVar3 = uVar3 - local_c;
        local_c = uVar3;
        if (iVar2 < 0) goto LAB_0043340d;
        if (((param_7 & 0x200) != 0) && (1 < uVar3)) {
          FUN_004267c0((uint *)(param_2 + 1),(byte)param_7,uVar3 - 1);
        }
      }
      if (-1 < iVar2) goto LAB_0043343d;
    }
    else {
      iVar2 = -0x7ff8ffa9;
    }
  }
LAB_0043340d:
  if (((param_7 & 0x1c00) != 0) && (puVar1 != (undefined1 *)0x0)) {
    FID_conflict__RtlStringExHandleOtherFlagsA_24
              (param_1,(uint)puVar1,(int)local_8,&param_2,&local_c,param_7);
    uVar3 = local_c;
  }
  if ((iVar2 < 0) && (iVar2 != -0x7ff8ff86)) {
    return iVar2;
  }
LAB_0043343d:
  if (param_5 != (int *)0x0) {
    *param_5 = (int)param_2;
  }
  if (param_6 != (uint *)0x0) {
    *param_6 = uVar3;
  }
  return iVar2;
}



/* Function: FUN_004334e8 */

int FUN_004334e8(uint *param_1,short *param_2,short *param_3,uint param_4,int *param_5,uint *param_6
                ,uint param_7)

{
  short *psVar1;
  uint uVar2;
  int iVar3;
  uint local_c;
  short *local_8;
  
  psVar1 = param_2;
  iVar3 = 0;
  if ((param_7 & 0x100) == 0) {
    if ((param_2 == (short *)0x0) || ((short *)0x7fffffff < param_2)) {
      iVar3 = -0x7ff8ffa9;
    }
    if (-1 < iVar3) goto LAB_0043351f;
    param_2 = (short *)0x0;
  }
  else {
    if (((param_1 == (uint *)0x0) && (param_2 != (short *)0x0)) || ((short *)0x7fffffff < param_2))
    {
      iVar3 = -0x7ff8ffa9;
    }
    if ((iVar3 < 0) || (param_2 == (short *)0x0)) {
      param_2 = (short *)0x0;
    }
    else {
LAB_0043351f:
      iVar3 = FID_conflict__StringLengthWorkerW_12((short *)param_1,(int)param_2,(int *)&param_2);
    }
  }
  if (iVar3 < 0) {
    return iVar3;
  }
  uVar2 = (int)psVar1 - (int)param_2;
  local_8 = param_2;
  param_2 = (short *)((int)param_1 + (int)param_2 * 2);
  local_c = uVar2;
  iVar3 = FUN_00433b21((int *)&param_3,&param_4,0x7fffffff,param_7);
  if (-1 < iVar3) {
    if ((param_7 & 0xffffe000) == 0) {
      if (uVar2 < 2) {
        if ((param_4 != 0) && (*param_3 != 0)) {
          if (param_1 == (uint *)0x0) {
            iVar3 = -0x7ff8ffa9;
            goto LAB_00433599;
          }
          iVar3 = -0x7ff8ff86;
        }
      }
      else {
        local_c = 0;
        iVar3 = _StringCopyWorkerW_20(param_2,uVar2,(int *)&local_c,(int)param_3,param_4);
        uVar2 = uVar2 - local_c;
        param_2 = param_2 + local_c;
        local_c = uVar2;
        if (iVar3 < 0) goto LAB_00433599;
        if ((((param_7 & 0x200) != 0) && (1 < uVar2)) && (2 < uVar2 * 2)) {
          FUN_004267c0((uint *)(param_2 + 1),(byte)param_7,uVar2 * 2 - 2);
        }
      }
      if (-1 < iVar3) goto LAB_004335cc;
    }
    else {
      iVar3 = -0x7ff8ffa9;
    }
  }
LAB_00433599:
  if (((param_7 & 0x1c00) != 0) && (psVar1 != (short *)0x0)) {
    FID_conflict__StringExHandleOtherFlagsW_24
              (param_1,(int)psVar1 * 2,(int)local_8,&param_2,&local_c,param_7);
    uVar2 = local_c;
  }
  if ((iVar3 < 0) && (iVar3 != -0x7ff8ff86)) {
    return iVar3;
  }
LAB_004335cc:
  if (param_5 != (int *)0x0) {
    *param_5 = (int)param_2;
  }
  if (param_6 != (uint *)0x0) {
    *param_6 = uVar2;
  }
  return iVar3;
}



/* Function: FUN_00433684 */

int FUN_00433684(uint *param_1,uint param_2,char *param_3,uint param_4,int *param_5,uint *param_6,
                uint param_7)

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  uint local_8;
  
  uVar2 = param_2;
  puVar1 = param_1;
  if ((param_7 & 0x100) == 0) {
    if (param_2 != 0) goto LAB_004336b7;
LAB_004336bb:
    iVar4 = -0x7ff8ffa9;
  }
  else {
    if ((param_1 == (uint *)0x0) && (param_2 != 0)) goto LAB_004336bb;
LAB_004336b7:
    iVar4 = 0;
    if (0x7fffffff < param_2) goto LAB_004336bb;
  }
  if (iVar4 < 0) {
    return iVar4;
  }
  local_8 = param_2;
  iVar4 = FUN_00433ae5((int *)&param_3,&param_4,0x7fffffff,param_7);
  if (iVar4 < 0) {
    if (uVar2 != 0) {
      *(undefined1 *)puVar1 = 0;
    }
LAB_0043378d:
    uVar3 = param_2;
    if (-1 < iVar4) goto LAB_004337c3;
  }
  else {
    uVar3 = uVar2;
    if ((param_7 & 0xffffe000) == 0) {
      if (uVar2 == 0) {
        if ((param_4 != 0) && (*param_3 != '\0')) {
          if (puVar1 == (uint *)0x0) {
            iVar4 = -0x7ff8ffa9;
            goto LAB_00433794;
          }
          iVar4 = -0x7ff8ff86;
        }
      }
      else {
        param_2 = 0;
        iVar4 = _StringCopyWorkerA_20
                          ((undefined1 *)puVar1,uVar2,(int *)&param_2,(int)param_3,param_4);
        param_1 = (uint *)(param_2 + (int)puVar1);
        uVar3 = uVar2 - param_2;
        param_2 = uVar3;
        local_8 = uVar3;
        if (iVar4 < 0) goto LAB_00433794;
        if (((param_7 & 0x200) != 0) && (1 < uVar3)) {
          FUN_004267c0((uint *)((int)param_1 + 1),(byte)param_7,uVar3 - 1);
        }
      }
      goto LAB_0043378d;
    }
    iVar4 = -0x7ff8ffa9;
    if (uVar2 != 0) {
      *(undefined1 *)puVar1 = 0;
    }
  }
LAB_00433794:
  if (((param_7 & 0x1c00) != 0) && (uVar2 != 0)) {
    FID_conflict__RtlStringExHandleOtherFlagsA_24(puVar1,uVar2,0,&param_1,&local_8,param_7);
    uVar3 = local_8;
  }
  param_2 = uVar3;
  if ((iVar4 < 0) && (iVar4 != -0x7ff8ff86)) {
    return iVar4;
  }
LAB_004337c3:
  if (param_5 != (int *)0x0) {
    *param_5 = (int)param_1;
  }
  if (param_6 != (uint *)0x0) {
    *param_6 = param_2;
  }
  return iVar4;
}



/* Function: FUN_004337e1 */

int FUN_004337e1(uint *param_1,uint param_2,short *param_3,uint param_4,int *param_5,uint *param_6,
                uint param_7)

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  uint local_8;
  
  uVar2 = param_2;
  puVar1 = param_1;
  iVar4 = 0;
  if ((param_7 & 0x100) == 0) {
    if (param_2 != 0) goto LAB_00433814;
LAB_00433818:
    iVar4 = -0x7ff8ffa9;
  }
  else {
    if ((param_1 == (uint *)0x0) && (param_2 != 0)) goto LAB_00433818;
LAB_00433814:
    if (0x7fffffff < param_2) goto LAB_00433818;
  }
  if (iVar4 < 0) {
    return iVar4;
  }
  local_8 = param_2;
  iVar4 = FUN_00433b21((int *)&param_3,&param_4,0x7fffffff,param_7);
  if (iVar4 < 0) {
    if (uVar2 != 0) {
      *(undefined2 *)puVar1 = 0;
    }
LAB_00433903:
    uVar3 = param_2;
    if (-1 < iVar4) goto LAB_0043393d;
  }
  else {
    uVar3 = uVar2;
    if ((param_7 & 0xffffe000) == 0) {
      if (uVar2 == 0) {
        if ((param_4 != 0) && (*param_3 != 0)) {
          if (puVar1 == (uint *)0x0) {
            iVar4 = -0x7ff8ffa9;
            goto LAB_0043390a;
          }
          iVar4 = -0x7ff8ff86;
        }
      }
      else {
        param_2 = 0;
        iVar4 = _StringCopyWorkerW_20((short *)puVar1,uVar2,(int *)&param_2,(int)param_3,param_4);
        param_1 = (uint *)((int)puVar1 + param_2 * 2);
        uVar3 = uVar2 - param_2;
        param_2 = uVar3;
        local_8 = uVar3;
        if (iVar4 < 0) goto LAB_0043390a;
        if ((((param_7 & 0x200) != 0) && (1 < uVar3)) && (2 < uVar3 * 2)) {
          FUN_004267c0((uint *)((int)param_1 + 2),(byte)param_7,uVar3 * 2 - 2);
        }
      }
      goto LAB_00433903;
    }
    iVar4 = -0x7ff8ffa9;
    if (uVar2 != 0) {
      *(undefined2 *)puVar1 = 0;
    }
  }
LAB_0043390a:
  if (((param_7 & 0x1c00) != 0) && (uVar2 != 0)) {
    FID_conflict__StringExHandleOtherFlagsW_24(puVar1,uVar2 * 2,0,&param_1,&local_8,param_7);
    uVar3 = local_8;
  }
  param_2 = uVar3;
  if ((iVar4 < 0) && (iVar4 != -0x7ff8ff86)) {
    return iVar4;
  }
LAB_0043393d:
  if (param_5 != (int *)0x0) {
    *param_5 = (int)param_1;
  }
  if (param_6 != (uint *)0x0) {
    *param_6 = param_2;
  }
  return iVar4;
}



/* Function: StringCchLengthA */

/* Library Function - Single Match
    long __stdcall StringCchLengthA(char const *,unsigned int,unsigned int *)
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release */

long StringCchLengthA(char *param_1,uint param_2,uint *param_3)

{
  long lVar1;
  
  if ((param_1 == (char *)0x0) || (0x7fffffff < param_2)) {
    lVar1 = -0x7ff8ffa9;
  }
  else {
    lVar1 = StringLengthWorkerA(param_1,param_2,param_3);
  }
  if ((lVar1 < 0) && (param_3 != (uint *)0x0)) {
    *param_3 = 0;
  }
  return lVar1;
}



/* Function: FUN_00433994 */

int FUN_00433994(wchar_t *param_1,uint param_2,wchar_t *param_3,va_list param_4)

{
  uint uVar1;
  int iVar2;
  uint _Count;
  
  iVar2 = 0;
  if ((param_2 == 0) || (0x7fffffff < param_2)) {
    iVar2 = -0x7ff8ffa9;
  }
  if (-1 < iVar2) {
    iVar2 = 0;
    _Count = param_2 - 1;
    uVar1 = __vsnwprintf(param_1,_Count,param_3,param_4);
    if (((int)uVar1 < 0) || (_Count < uVar1)) {
      iVar2 = -0x7ff8ff86;
    }
    else if (uVar1 != _Count) {
      return 0;
    }
    param_1[_Count] = L'\0';
  }
  return iVar2;
}



/* Function: _StringCopyWorkerA@20 */

/* Library Function - Single Match
    _StringCopyWorkerA@20
   
   Library: Visual Studio 2012 Release */

undefined4
_StringCopyWorkerA_20(undefined1 *param_1,int param_2,int *param_3,int param_4,int param_5)

{
  int iVar1;
  undefined4 uVar2;
  int iVar3;
  
  uVar2 = 0;
  iVar1 = 0;
  if (param_2 != 0) {
    iVar3 = param_4 - (int)param_1;
    do {
      if ((param_5 == 0) || (param_1[iVar3] == '\0')) break;
      *param_1 = param_1[iVar3];
      param_1 = param_1 + 1;
      param_2 = param_2 + -1;
      param_5 = param_5 + -1;
      iVar1 = iVar1 + 1;
    } while (param_2 != 0);
    if (param_2 != 0) goto LAB_00433a34;
  }
  param_1 = param_1 + -1;
  iVar1 = iVar1 + -1;
  uVar2 = 0x8007007a;
LAB_00433a34:
  *param_1 = 0;
  if (param_3 != (int *)0x0) {
    *param_3 = iVar1;
  }
  return uVar2;
}



/* Function: FID_conflict:_RtlStringExHandleOtherFlagsA@24 */

/* Library Function - Multiple Matches With Different Base Names
    _RtlStringExHandleOtherFlagsA@24
    _StringExHandleOtherFlagsA@24
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release, Visual Studio 2019 Release */

undefined4
FID_conflict__RtlStringExHandleOtherFlagsA_24
          (uint *param_1,uint param_2,int param_3,undefined4 *param_4,uint *param_5,uint param_6)

{
  undefined1 *puVar1;
  
  if ((param_2 != 0) && ((param_6 & 0x1000) != 0)) {
    *param_4 = (undefined1 *)((int)param_1 + param_3);
    *param_5 = param_2 - param_3;
    *(undefined1 *)((int)param_1 + param_3) = 0;
  }
  if ((param_6 & 0x400) != 0) {
    FUN_004267c0(param_1,(byte)param_6,param_2);
    if ((param_6 & 0xff) == 0) {
      *param_4 = param_1;
      *param_5 = param_2;
    }
    else {
      if (param_2 == 0) {
        return 0;
      }
      puVar1 = (undefined1 *)((param_2 - 1) + (int)param_1);
      *param_4 = puVar1;
      *param_5 = 1;
      *puVar1 = 0;
    }
  }
  if ((param_2 != 0) && ((param_6 & 0x800) != 0)) {
    *param_4 = param_1;
    *param_5 = param_2;
    *(undefined1 *)param_1 = 0;
  }
  return 0;
}



/* Function: FUN_00433ae5 */

undefined4 FUN_00433ae5(int *param_1,uint *param_2,uint param_3,uint param_4)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if ((param_2 == (uint *)0x0) || (*param_2 < param_3)) {
    if (((param_4 & 0x100) != 0) &&
       ((*param_1 == 0 && (*param_1 = (int)&DAT_00442775, param_2 != (uint *)0x0)))) {
      *param_2 = 0;
    }
  }
  else {
    uVar1 = 0x80070057;
  }
  return uVar1;
}



/* Function: FUN_00433b21 */

undefined4 FUN_00433b21(int *param_1,uint *param_2,uint param_3,uint param_4)

{
  undefined4 uVar1;
  
  uVar1 = 0;
  if ((param_2 == (uint *)0x0) || (*param_2 < param_3)) {
    if (((param_4 & 0x100) != 0) &&
       ((*param_1 == 0 && (*param_1 = (int)&DAT_0043b580, param_2 != (uint *)0x0)))) {
      *param_2 = 0;
    }
  }
  else {
    uVar1 = 0x80070057;
  }
  return uVar1;
}



/* Function: StringLengthWorkerA */

/* Library Function - Single Match
    long __stdcall StringLengthWorkerA(char const *,unsigned int,unsigned int *)
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release */

long StringLengthWorkerA(char *param_1,uint param_2,uint *param_3)

{
  uint uVar1;
  int iVar2;
  
  iVar2 = 0;
  uVar1 = param_2;
  if (param_2 != 0) {
    do {
      if (*param_1 == '\0') break;
      param_1 = param_1 + 1;
      uVar1 = uVar1 - 1;
    } while (uVar1 != 0);
    if (uVar1 != 0) goto LAB_00433b80;
  }
  iVar2 = -0x7ff8ffa9;
LAB_00433b80:
  if (param_3 != (uint *)0x0) {
    if (iVar2 < 0) {
      *param_3 = 0;
    }
    else {
      *param_3 = param_2 - uVar1;
    }
  }
  return iVar2;
}



/* Function: FID_conflict:_StringLengthWorkerW@12 */

/* Library Function - Multiple Matches With Different Base Names
    long __stdcall StringLengthWorkerW(wchar_t const *,unsigned int,unsigned int *)
    _StringLengthWorkerW@12
   
   Library: Visual Studio 2012 Release */

int FID_conflict__StringLengthWorkerW_12(short *param_1,int param_2,int *param_3)

{
  int iVar1;
  int iVar2;
  
  iVar2 = 0;
  iVar1 = param_2;
  if (param_2 != 0) {
    do {
      if (*param_1 == 0) break;
      param_1 = param_1 + 1;
      iVar1 = iVar1 + -1;
    } while (iVar1 != 0);
    if (iVar1 != 0) goto LAB_00433bc4;
  }
  iVar2 = -0x7ff8ffa9;
LAB_00433bc4:
  if (param_3 != (int *)0x0) {
    if (iVar2 < 0) {
      *param_3 = 0;
    }
    else {
      *param_3 = param_2 - iVar1;
    }
  }
  return iVar2;
}



/* Function: FUN_00433bdf */

undefined4 FUN_00433bdf(int *param_1,uint param_2)

{
  int iVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  if (param_2 < 0x7fffffff) {
    if (*param_1 == 0) {
      iVar1 = FUN_00431078(param_2 * 2,1);
    }
    else {
      iVar1 = FUN_0043120c((LPVOID)*param_1,param_2 * 2,0);
    }
    if (iVar1 == 0) {
      uVar2 = 0x8007000e;
      FUN_004300d9();
    }
    else {
      *param_1 = iVar1;
    }
  }
  else {
    uVar2 = 0x8007000e;
  }
  return uVar2;
}



/* Function: FUN_00433c35 */

int FUN_00433c35(int *param_1,short *param_2,uint param_3)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  short *psVar4;
  int local_8;
  
  psVar4 = (short *)0x0;
  local_8 = 0;
  if (*param_1 != 0) {
    uVar1 = FUN_00431231((LPCVOID)*param_1);
    if (uVar1 == 0xffffffff) {
      return -0x7ff8ffa9;
    }
    psVar4 = (short *)(uVar1 >> 1);
    iVar2 = FUN_0040e205((short *)*param_1,0x7fffffff,&local_8);
    if (iVar2 < 0) {
      return iVar2;
    }
  }
  iVar2 = local_8;
  if ((param_3 != 0) || (iVar3 = FUN_0040e205(param_2,0x7fffffff,(int *)&param_3), -1 < iVar3)) {
    uVar1 = param_3;
    if ((uint)((int)psVar4 - iVar2) < param_3 + 1) {
      psVar4 = (short *)((iVar2 + param_3) * 2 + 2);
      iVar2 = FUN_00433bdf(param_1,(uint)psVar4);
      if (iVar2 < 0) {
        return iVar2;
      }
    }
    if (*param_1 == 0) {
      iVar3 = -0x7fff0001;
    }
    else {
      iVar3 = FUN_004334e8((uint *)*param_1,psVar4,param_2,uVar1,(int *)0x0,(uint *)0x0,0x200);
    }
  }
  return iVar3;
}



/* Function: FUN_00433cea */

void __cdecl FUN_00433cea(int *param_1,wchar_t *param_2)

{
  FUN_00433cfe(param_1,param_2,&stack0x0000000c);
  return;
}



/* Function: FUN_00433cfe */

int FUN_00433cfe(int *param_1,wchar_t *param_2,va_list param_3)

{
  uint uVar1;
  int iVar2;
  int local_c;
  LPVOID local_8;
  
  local_8 = (LPVOID)0x0;
  local_c = 0;
  if (*param_1 != 0) {
    uVar1 = FUN_00431231((LPCVOID)*param_1);
    if (uVar1 == 0xffffffff) {
      return -0x7ff8ffa9;
    }
    local_c = lstrlenW((LPCWSTR)*param_1);
    uVar1 = uVar1 >> 1;
    if (uVar1 != 0) goto LAB_00433d4c;
  }
  uVar1 = 0x100;
  iVar2 = FUN_00433bdf(param_1,0x100);
  if (iVar2 < 0) {
    return iVar2;
  }
LAB_00433d4c:
  do {
    iVar2 = FUN_00433994((wchar_t *)*param_1,uVar1,param_2,param_3);
    if (iVar2 == -0x7ff8ff86) {
      if (local_8 == (LPVOID)0x0) {
        local_8 = (LPVOID)*param_1;
        *param_1 = 0;
        *(undefined2 *)((int)local_8 + local_c * 2) = 0;
      }
      uVar1 = uVar1 * 2;
      iVar2 = FUN_00433bdf(param_1,uVar1);
      if (iVar2 < 0) break;
      iVar2 = 1;
    }
  } while (iVar2 == 1);
  if (local_8 != (LPVOID)0x0) {
    FUN_00431137(local_8);
  }
  return iVar2;
}



/* Function: FUN_00433da8 */

DWORD __cdecl FUN_00433da8(int *param_1,DWORD param_2,LPCVOID param_3)

{
  DWORD DVar1;
  uint uVar2;
  va_list local_c;
  LPCWSTR local_8;
  
  DVar1 = 0x11ff;
  if (param_3 != (LPCVOID)0x0) {
    DVar1 = 0x19ff;
  }
  local_c = &stack0x00000010;
  local_8 = (LPCWSTR)0x0;
  DVar1 = FormatMessageW(DVar1,param_3,param_2,0,(LPWSTR)&local_8,0,&local_c);
  local_c = (va_list)0x0;
  if (DVar1 == 0) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  else {
    uVar2 = FUN_00433f88(param_1,local_8,DVar1);
  }
  if (local_8 != (LPCWSTR)0x0) {
    LocalFree(local_8);
  }
  return uVar2;
}



/* Function: FUN_00433e39 */

int FUN_00433e39(LPCWSTR param_1,undefined4 *param_2,uint *param_3)

{
  int iVar1;
  byte *pbVar2;
  uint uVar3;
  uint local_8;
  
  local_8 = 0;
  iVar1 = FUN_0040e205(param_1,0x7fffffff,(int *)&local_8);
  if (-1 < iVar1) {
    if ((local_8 & 1) == 0) {
      uVar3 = local_8 >> 1;
      pbVar2 = (byte *)FUN_00431078(uVar3,1);
      if (pbVar2 == (byte *)0x0) {
        iVar1 = -0x7ff8fff2;
        FUN_004300d9();
      }
      else {
        iVar1 = FUN_00434446(param_1,pbVar2,uVar3);
        if (-1 < iVar1) {
          *param_2 = pbVar2;
          pbVar2 = (byte *)0x0;
          if (param_3 == (uint *)0x0) {
            return iVar1;
          }
          *param_3 = uVar3;
        }
        if (pbVar2 != (byte *)0x0) {
          FUN_00431137(pbVar2);
        }
      }
    }
    else {
      iVar1 = -0x7ff8ffa9;
    }
  }
  return iVar1;
}



/* Function: FUN_00433ec4 */

int FUN_00433ec4(int *param_1,short *param_2,int param_3)

{
  undefined8 *puVar1;
  uint uVar2;
  int iVar3;
  uint uVar4;
  int iVar5;
  int local_8;
  
  iVar5 = 0;
  uVar4 = 0;
  local_8 = 0;
  if (*param_1 != 0) {
    uVar4 = FUN_00431231((LPCVOID)*param_1);
    if (uVar4 == 0xffffffff) {
      return -0x7ff8ffa9;
    }
    uVar4 = uVar4 >> 1;
    iVar5 = FUN_0040e205((short *)*param_1,0x7fffffff,&local_8);
    if (iVar5 < 0) {
      return iVar5;
    }
  }
  if ((param_3 != 0) || (iVar5 = FUN_0040e205(param_2,0x7fffffff,&param_3), -1 < iVar5)) {
    iVar3 = param_3;
    if (uVar4 - local_8 < param_3 + 1U) {
      uVar4 = local_8 + 1 + param_3;
      iVar5 = FUN_00433bdf(param_1,uVar4);
      if (iVar5 < 0) {
        return iVar5;
      }
    }
    puVar1 = (undefined8 *)*param_1;
    if (puVar1 == (undefined8 *)0x0) {
      iVar5 = -0x7fff0001;
    }
    else {
      uVar2 = iVar3 * 2;
      FUN_00426850((undefined8 *)(uVar2 + (int)puVar1),puVar1,uVar4 * 2 + iVar3 * -2);
      FUN_004270c0((undefined8 *)*param_1,(undefined8 *)param_2,uVar2);
    }
  }
  return iVar5;
}



/* Function: FUN_00433f88 */

int FUN_00433f88(int *param_1,LPCWSTR param_2,uint param_3)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  
  uVar3 = 0;
  if (*param_1 != 0) {
    uVar3 = FUN_00431231((LPCVOID)*param_1);
    if (uVar3 == 0xffffffff) {
      return -0x7ff8ffa9;
    }
    uVar3 = uVar3 >> 1;
  }
  if (param_3 == 0) {
    param_3 = lstrlenW(param_2);
  }
  uVar2 = param_3 + 1;
  if (uVar2 < param_3) {
    uVar2 = 0xffffffff;
    iVar1 = -0x7ff8fdea;
  }
  else {
    iVar1 = 0;
  }
  if ((-1 < iVar1) &&
     ((uVar2 <= uVar3 || (iVar1 = FUN_00433bdf(param_1,uVar2), uVar3 = uVar2, -1 < iVar1)))) {
    iVar1 = FUN_004337e1((uint *)*param_1,uVar3,param_2,param_3,(int *)0x0,(uint *)0x0,0x200);
  }
  return iVar1;
}



/* Function: FUN_00434004 */

DWORD FUN_00434004(int *param_1,LPCSTR param_2,int param_3,UINT param_4)

{
  uint uVar1;
  int iVar2;
  DWORD DVar3;
  int iVar4;
  uint uVar5;
  
  uVar5 = 0;
  if (*param_1 != 0) {
    uVar5 = FUN_00431231((LPCVOID)*param_1);
    if (uVar5 == 0xffffffff) {
      return 0x80070057;
    }
    uVar5 = uVar5 >> 1;
  }
  if (param_3 == 0) {
    iVar2 = MultiByteToWideChar(param_4,0,param_2,-1,(LPWSTR)0x0,0);
    if (iVar2 == 0) {
      DVar3 = GetLastError();
      uVar5 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar5 = DVar3;
      }
      if (-1 < (int)uVar5) {
        uVar5 = 0x80004005;
      }
      goto LAB_00434121;
    }
    iVar2 = iVar2 + -1;
  }
  else {
    iVar2 = param_3;
    if (param_2[param_3] == '\0') {
      iVar2 = param_3 + -1;
    }
  }
  uVar1 = iVar2 + 1;
  if (uVar5 < uVar1) {
    if (0x7ffffffe < uVar1) {
      return 0x8007000e;
    }
    if ((LPVOID)*param_1 == (LPVOID)0x0) {
      iVar4 = FUN_00431078(uVar1 * 2,1);
    }
    else {
      iVar4 = FUN_0043120c((LPVOID)*param_1,uVar1 * 2,1);
    }
    if (iVar4 == 0) {
      uVar5 = 0x8007000e;
      goto LAB_00434121;
    }
    *param_1 = iVar4;
    uVar5 = uVar1;
  }
  if (param_3 == 0) {
    param_3 = -1;
  }
  iVar4 = MultiByteToWideChar(param_4,0,param_2,param_3,(LPWSTR)*param_1,uVar5);
  if (iVar4 != 0) {
    *(undefined2 *)(*param_1 + iVar2 * 2) = 0;
    return 0;
  }
  DVar3 = GetLastError();
  uVar5 = DVar3 & 0xffff | 0x80070000;
  if ((int)DVar3 < 1) {
    uVar5 = DVar3;
  }
  if (-1 < (int)uVar5) {
    uVar5 = 0x80004005;
  }
LAB_00434121:
  FUN_004300d9();
  return uVar5;
}



/* Function: FUN_0043413e */

void FUN_0043413e(int *param_1,LPCWSTR param_2,uint param_3)

{
  FUN_004332d8(param_1,param_2,param_3,0x200);
  return;
}



/* Function: FUN_00434158 */

undefined4 FUN_00434158(int *param_1,uint param_2)

{
  int iVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  if (param_2 < 0x7fffffff) {
    if (*param_1 == 0) {
      iVar1 = FUN_00431078(param_2,1);
    }
    else {
      iVar1 = FUN_0043120c((LPVOID)*param_1,param_2,0);
    }
    if (iVar1 == 0) {
      uVar2 = 0x8007000e;
      FUN_004300d9();
    }
    else {
      *param_1 = iVar1;
    }
  }
  else {
    uVar2 = 0x8007000e;
  }
  return uVar2;
}



/* Function: FUN_004341b2 */

long FUN_004341b2(int *param_1,char *param_2,uint param_3)

{
  uint uVar1;
  uint uVar2;
  long lVar3;
  int iVar4;
  undefined1 *puVar5;
  uint local_8;
  
  puVar5 = (undefined1 *)0x0;
  local_8 = 0;
  if (*param_1 != 0) {
    puVar5 = (undefined1 *)FUN_00431231((LPCVOID)*param_1);
    if (puVar5 == (undefined1 *)0xffffffff) {
      return -0x7ff8ffa9;
    }
    lVar3 = StringCchLengthA((char *)*param_1,0x7fffffff,&local_8);
    if (lVar3 < 0) {
      return lVar3;
    }
  }
  uVar2 = local_8;
  if ((param_3 != 0) || (lVar3 = StringCchLengthA(param_2,0x7fffffff,&param_3), -1 < lVar3)) {
    uVar1 = param_3;
    if ((int)puVar5 - uVar2 < param_3 + 1) {
      puVar5 = (undefined1 *)((uVar2 + param_3) * 2 + 2);
      iVar4 = FUN_00434158(param_1,(uint)puVar5);
      if (iVar4 < 0) {
        return iVar4;
      }
    }
    if (*param_1 == 0) {
      lVar3 = -0x7fff0001;
    }
    else {
      lVar3 = FUN_0043335d((uint *)*param_1,puVar5,param_2,uVar1,(int *)0x0,(uint *)0x0,0x200);
    }
  }
  return lVar3;
}



/* Function: FUN_00434262 */

DWORD FUN_00434262(int *param_1,LPCWSTR param_2,int param_3,UINT param_4)

{
  uint uVar1;
  int iVar2;
  DWORD DVar3;
  int iVar4;
  uint uVar5;
  
  uVar5 = 0;
  if ((*param_1 != 0) && (uVar5 = FUN_00431231((LPCVOID)*param_1), uVar5 == 0xffffffff)) {
    return 0x80070057;
  }
  if (param_3 == 0) {
    iVar2 = WideCharToMultiByte(param_4,0,param_2,-1,(LPSTR)0x0,0,(LPCSTR)0x0,(LPBOOL)0x0);
    if (iVar2 == 0) {
      DVar3 = GetLastError();
      uVar5 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        uVar5 = DVar3;
      }
      if (-1 < (int)uVar5) {
        uVar5 = 0x80004005;
      }
      goto LAB_0043437f;
    }
    iVar2 = iVar2 + -1;
  }
  else {
    iVar2 = param_3;
    if (param_2[param_3] == L'\0') {
      iVar2 = param_3 + -1;
    }
  }
  uVar1 = iVar2 + 1;
  if (uVar5 < uVar1) {
    if (0x7ffffffe < uVar1) {
      return 0x8007000e;
    }
    if (*param_1 == 0) {
      iVar4 = FUN_00431078(uVar1,1);
    }
    else {
      iVar4 = FUN_0043120c((LPVOID)*param_1,uVar1,1);
    }
    if (iVar4 == 0) {
      uVar5 = 0x8007000e;
      goto LAB_0043437f;
    }
    *param_1 = iVar4;
    uVar5 = uVar1;
  }
  if (param_3 == 0) {
    param_3 = -1;
  }
  iVar4 = WideCharToMultiByte(param_4,0,param_2,param_3,(LPSTR)*param_1,uVar5,(LPCSTR)0x0,
                              (LPBOOL)0x0);
  if (iVar4 != 0) {
    *(undefined1 *)(iVar2 + *param_1) = 0;
    return 0;
  }
  DVar3 = GetLastError();
  uVar5 = DVar3 & 0xffff | 0x80070000;
  if ((int)DVar3 < 1) {
    uVar5 = DVar3;
  }
  if (-1 < (int)uVar5) {
    uVar5 = 0x80004005;
  }
LAB_0043437f:
  FUN_004300d9();
  return uVar5;
}



/* Function: FUN_00434399 */

int FUN_00434399(int *param_1,LPCSTR param_2,uint param_3)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  
  uVar3 = 0;
  if ((*param_1 == 0) || (uVar3 = FUN_00431231((LPCVOID)*param_1), uVar3 != 0xffffffff)) {
    if (param_3 == 0) {
      param_3 = lstrlenA(param_2);
    }
    uVar2 = param_3 + 1;
    if (uVar2 < param_3) {
      uVar2 = 0xffffffff;
      iVar1 = -0x7ff8fdea;
    }
    else {
      iVar1 = 0;
    }
    if ((-1 < iVar1) &&
       ((uVar2 <= uVar3 || (iVar1 = FUN_00434158(param_1,uVar2), uVar3 = uVar2, -1 < iVar1)))) {
      iVar1 = FUN_00433684((uint *)*param_1,uVar3,param_2,param_3,(int *)0x0,(uint *)0x0,0x200);
    }
  }
  else {
    iVar1 = -0x7ff8ffa9;
  }
  return iVar1;
}



/* Function: FUN_00434413 */

void FUN_00434413(LPVOID param_1,uint param_2)

{
  DWORD DVar1;
  uint uVar2;
  
  uVar2 = 0;
  if (param_2 != 0) {
    do {
      if ((*(int *)((int)param_1 + uVar2 * 4) != 0) &&
         (DVar1 = FUN_00431137(*(LPVOID *)((int)param_1 + uVar2 * 4)), (int)DVar1 < 0)) {
        return;
      }
      uVar2 = uVar2 + 1;
    } while (uVar2 < param_2);
  }
  FUN_00431137(param_1);
  return;
}



/* Function: FUN_00434446 */

undefined4 FUN_00434446(LPCWSTR param_1,byte *param_2,uint param_3)

{
  LPCWSTR pWVar1;
  uint uVar2;
  byte extraout_DL;
  undefined4 uVar3;
  
  uVar2 = lstrlenW(param_1);
  uVar2 = uVar2 >> 1;
  if (param_3 < uVar2) {
    uVar3 = 0x8007007a;
    FUN_004300d9();
  }
  else {
    for (; uVar3 = 0, uVar2 != 0; uVar2 = uVar2 - 1) {
      uVar3 = FUN_0043328e((uint)(ushort)*param_1);
      *param_2 = (char)uVar3 << 4;
      pWVar1 = param_1 + 1;
      param_1 = param_1 + 2;
      uVar3 = FUN_0043328e((uint)(ushort)*pWVar1);
      *param_2 = (byte)uVar3 & 0xf | extraout_DL;
      param_2 = param_2 + 1;
    }
  }
  return uVar3;
}



/* Function: FUN_004344b6 */

undefined4 FUN_004344b6(byte *param_1,int param_2,short *param_3,uint param_4)

{
  undefined4 uVar1;
  
  if (param_4 < param_2 * 2 + 1U) {
    uVar1 = 0x8007007a;
  }
  else {
    if (param_2 != 0) {
      do {
        *param_3 = (-(ushort)(*param_1 >> 4 < 10) & 0xfff9) + (ushort)(*param_1 >> 4) + 0x37;
        param_3[1] = (-(ushort)((*param_1 & 0xf) < 10) & 0xfff9) + (ushort)(*param_1 & 0xf) + 0x37;
        param_3 = param_3 + 2;
        param_1 = param_1 + 1;
        param_2 = param_2 + -1;
      } while (param_2 != 0);
    }
    uVar1 = 0;
    *param_3 = 0;
  }
  return uVar1;
}



/* Function: FUN_0043452e */

undefined4 FUN_0043452e(LPCVOID param_1,uint *param_2)

{
  uint uVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  if (param_1 == (LPCVOID)0x0) {
    *param_2 = 0;
  }
  else {
    uVar1 = FUN_00431231(param_1);
    *param_2 = uVar1;
    if (uVar1 == 0xffffffff) {
      uVar2 = 0x80004005;
    }
    else {
      *param_2 = uVar1 >> 1;
    }
  }
  return uVar2;
}



/* Function: FUN_00434564 */

undefined4 FUN_00434564(LPCVOID param_1,int *param_2)

{
  int iVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  iVar1 = FUN_00431231(param_1);
  *param_2 = iVar1;
  if (iVar1 == -1) {
    uVar2 = 0x80004005;
  }
  return uVar2;
}



/* Function: FUN_00434589 */

int FUN_00434589(LPCWSTR param_1,uint param_2,uint *param_3)

{
  int iVar1;
  undefined8 local_c;
  
  local_c = 0;
  iVar1 = FUN_004345da(param_1,param_2,&local_c);
  if (-1 < iVar1) {
    if (local_c._4_4_ + (uint)(0x7fffffff < (uint)local_c) == 0) {
      *param_3 = (uint)local_c;
    }
    else {
      iVar1 = -0x7ffdfff6;
    }
  }
  return iVar1;
}



/* Function: FUN_004345da */

undefined4 FUN_004345da(LPCWSTR param_1,uint param_2,longlong *param_3)

{
  uint uVar1;
  int iVar2;
  undefined4 uVar3;
  longlong lVar4;
  uint local_14;
  int local_10;
  uint local_c;
  
  uVar3 = 0;
  local_14 = 1;
  lVar4 = 0;
  if ((param_2 == 0) && (param_2 = lstrlenW(param_1), param_2 == 0)) {
LAB_0043469a:
    uVar3 = 0x80070057;
  }
  else {
    uVar1 = 0;
    if (*param_1 == L'-') {
      if (param_2 < 2) goto LAB_0043469a;
      uVar1 = 1;
      local_14 = 0xffffffff;
    }
    for (; uVar1 < param_2; uVar1 = uVar1 + 1) {
      local_10 = (int)((ulonglong)lVar4 >> 0x20);
      local_c = (uint)lVar4;
      iVar2 = (ushort)param_1[uVar1] - 0x30;
      if ((iVar2 < 0) || (9 < iVar2)) goto LAB_0043469a;
      lVar4 = __allmul(local_c,local_10,10,0);
      lVar4 = lVar4 + (int)(iVar2 * local_14);
      if ((int)((uint)((ulonglong)lVar4 >> 0x20) ^ local_14) < 0) {
        return 0x8002000a;
      }
    }
    *param_3 = lVar4;
  }
  return uVar3;
}



/* Function: FUN_004346a1 */

int FUN_004346a1(LPCWSTR param_1,uint param_2,undefined2 *param_3)

{
  int iVar1;
  undefined8 local_c;
  
  local_c = 0;
  iVar1 = FUN_0043472d(param_1,param_2,&local_c);
  if (-1 < iVar1) {
    if ((local_c._4_4_ == 0) && ((uint)local_c < 0x10000)) {
      *param_3 = (short)local_c;
    }
    else {
      iVar1 = -0x7ffdfff6;
    }
  }
  return iVar1;
}



/* Function: FUN_004346e9 */

int FUN_004346e9(LPCWSTR param_1,uint param_2,undefined4 *param_3)

{
  int iVar1;
  undefined8 local_c;
  
  local_c = 0;
  iVar1 = FUN_0043472d(param_1,param_2,&local_c);
  if (-1 < iVar1) {
    if (local_c._4_4_ == 0) {
      *param_3 = (undefined4)local_c;
    }
    else {
      iVar1 = -0x7ffdfff6;
    }
  }
  return iVar1;
}



/* Function: FUN_0043472d */

/* WARNING: Removing unreachable block (ram,0x00434795) */

undefined4 FUN_0043472d(LPCWSTR param_1,uint param_2,ulonglong *param_3)

{
  WCHAR WVar1;
  ulonglong uVar2;
  ulonglong uVar3;
  undefined4 uVar4;
  longlong lVar5;
  uint local_c;
  
  uVar4 = 0;
  local_c = 0;
  if ((param_2 == 0) && (param_2 = lstrlenW(param_1), param_2 == 0)) {
LAB_004347bf:
    uVar4 = 0x80070057;
  }
  else {
    uVar3 = 0;
    do {
      WVar1 = param_1[local_c];
      if (9 < (ushort)WVar1 - 0x30) goto LAB_004347bf;
      lVar5 = __allmul((uint)uVar3,(int)(uVar3 >> 0x20),10,0);
      uVar2 = lVar5 + (ulonglong)((ushort)WVar1 - 0x30);
      if (uVar2 < uVar3) {
        return 0x8002000a;
      }
      local_c = local_c + 1;
      uVar3 = uVar2;
    } while (local_c < param_2);
    *param_3 = uVar2;
  }
  return uVar4;
}



/* Function: FUN_004347cd */

longlong FUN_004347cd(uint param_1,uint param_2,uint param_3)

{
  uint uVar1;
  longlong lVar2;
  
  if (param_2 < *(uint *)(param_1 + 0x60c)) {
    lVar2 = CONCAT44(param_1,param_3);
  }
  else {
    lVar2 = (ulonglong)param_1 << 0x20;
    if (param_2 == *(uint *)(param_1 + 0x60c)) {
      uVar1 = *(uint *)(param_2 * 0x18 + 0xc + param_1);
      lVar2 = (ulonglong)param_1 << 0x20;
      if (uVar1 != 0) {
        lVar2 = (ulonglong)*(uint *)(param_2 * 0x18 + 0x10 + param_1) * (ulonglong)param_3;
        lVar2 = __aulldiv((uint)lVar2,(uint)((ulonglong)lVar2 >> 0x20),uVar1,0);
      }
    }
  }
  return lVar2;
}



/* Function: FUN_0043480e */

int FUN_0043480e(int param_1,undefined4 *param_2)

{
  if ((param_1 == 0x644) || (param_1 == 0x669)) {
    *param_2 = 2;
  }
  else {
    if (1 < param_1 - 0xbc2U) {
      return param_1;
    }
    *param_2 = 1;
  }
  return 0;
}



/* Function: FUN_00434849 */

undefined4 FUN_00434849(int *param_1,int param_2,undefined4 param_3,undefined4 param_4,int param_5)

{
  undefined4 uVar1;
  int iVar2;
  
  uVar1 = 0;
  iVar2 = param_2;
  if (param_2 < 0x8000001) {
    if (param_2 != 0x8000000) {
      if ((param_2 != 0) && (param_2 != 0x1000000)) {
        if (param_2 == 0x5000000) {
LAB_004348ef:
          uVar1 = FUN_00434e27((int)param_1,param_5);
          goto LAB_00434969;
        }
        if (param_2 != 0x7000000) goto LAB_00434962;
      }
      uVar1 = FUN_00434d8d((int)param_1,param_3,param_4,param_5);
      goto LAB_00434969;
    }
    iVar2 = param_1[0x183];
    if ((iVar2 != -1) && (param_1[iVar2 * 6 + 7] != 0)) {
      param_1[iVar2 * 6 + 7] = 0;
    }
    iVar2 = 0x8000000;
  }
  else if (param_2 == 0x9000000) {
    iVar2 = param_1[0x183];
    if ((iVar2 != -1) && (param_1[iVar2 * 6 + 7] != 0)) {
      if (param_1[iVar2 * 6 + 6] == 0) {
        param_1[iVar2 * 6 + 4] = param_1[iVar2 * 6 + 4] - param_1[iVar2 * 6 + 5];
      }
      else {
        param_1[iVar2 * 6 + 4] = param_1[iVar2 * 6 + 4] + param_1[iVar2 * 6 + 5];
      }
      uVar1 = FUN_00434efc(param_1);
      goto LAB_00434969;
    }
    iVar2 = 0x9000000;
  }
  else {
    if (param_2 == 0xc000000) {
      FUN_004267c0((uint *)(param_1 + 3),0,0x600);
      param_1[0x183] = -1;
      goto LAB_00434969;
    }
    if (param_2 == 0xd000000) goto LAB_00434969;
    if (param_2 == 0x19000000) goto LAB_004348ef;
  }
LAB_00434962:
  uVar1 = FUN_00434e8f((int)param_1,iVar2,param_3,param_4,param_5);
LAB_00434969:
  if (param_2 == 0x6000000) {
    uVar1 = 0;
  }
  return uVar1;
}



/* Function: FUN_0043497c */

void FUN_0043497c(int *param_1,LPCWSTR param_2,int param_3)

{
  int iVar1;
  uint uVar2;
  int iVar3;
  WCHAR WVar4;
  uint uVar5;
  uint *local_1c;
  uint local_18 [5];
  
  local_18[4] = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_18[0] = 0;
  local_18[1] = 0;
  local_18[2] = 0;
  local_18[3] = 0;
  uVar5 = 0;
  if (param_3 == 0) {
    local_1c = local_18;
    do {
      if (((uVar5 + 0x31 != (uint)(ushort)*param_2) || (param_2[1] != L':')) || (param_2[2] != L' ')
         ) break;
      param_2 = param_2 + 3;
      uVar2 = 0;
      WVar4 = *param_2;
      while ((WVar4 != L'\0' && (WVar4 != L' '))) {
        uVar2 = uVar2 + 1;
        WVar4 = param_2[uVar2];
      }
      iVar3 = FUN_00434589(param_2,uVar2,local_1c);
      if (iVar3 < 0) goto LAB_00434bb6;
      local_1c = local_1c + 1;
      uVar5 = uVar5 + 1;
    } while ((int)uVar5 < 4);
  }
  else {
    uVar2 = Ordinal_115(param_3);
    uVar5 = 4;
    if (uVar2 < 4) {
      uVar5 = uVar2;
    }
    if (0 < (int)uVar5) {
      iVar3 = 0;
      do {
        iVar1 = iVar3 + 1;
        uVar2 = Ordinal_116(param_3,iVar1);
        local_18[iVar3] = uVar2;
        iVar3 = iVar1;
      } while (iVar1 < (int)uVar5);
    }
  }
  if (0 < (int)uVar5) {
    if (local_18[0] == 0) {
      if ((int)uVar5 < 4) goto LAB_00434bb6;
      if (param_1[0x183] == -1) {
        param_1[0x183] = 0;
      }
      else {
        uVar5 = param_1[0x183] + 1;
        if (0x3f < uVar5) {
          FUN_004300d9();
          goto LAB_00434bb6;
        }
        param_1[0x183] = uVar5;
      }
      param_1[param_1[0x183] * 6 + 3] = local_18[1];
      uVar5 = local_18[1];
      if (local_18[2] == 0) {
        uVar5 = 0;
      }
      param_1[param_1[0x183] * 6 + 4] = uVar5;
      param_1[(param_1[0x183] + 1) * 6] = (uint)(local_18[2] == 0);
      param_1[param_1[0x183] * 6 + 7] = 0;
      param_1[param_1[0x183] * 6 + 8] = (uint)(local_18[3] == 1);
      if (param_1[0x183] == 0) {
        param_1[3] = param_1[3] + 0x32;
      }
    }
    else if (local_18[0] == 1) {
      if ((int)uVar5 < 3) goto LAB_00434bb6;
      if (local_18[2] == 0) {
        param_1[param_1[0x183] * 6 + 7] = 0;
      }
      else {
        param_1[param_1[0x183] * 6 + 7] = 1;
        param_1[param_1[0x183] * 6 + 5] = local_18[1];
      }
    }
    else if (local_18[0] == 2) {
      if (((1 < (int)uVar5) && (iVar3 = param_1[0x183], iVar3 != -1)) &&
         (param_1[iVar3 * 6 + 3] != 0)) {
        if (param_1[iVar3 * 6 + 6] == 0) {
          param_1[iVar3 * 6 + 4] = param_1[iVar3 * 6 + 4] - local_18[1];
        }
        else {
          param_1[iVar3 * 6 + 4] = param_1[iVar3 * 6 + 4] + local_18[1];
        }
      }
    }
    else {
      if (local_18[0] != 3) goto LAB_00434bb6;
      param_1[param_1[0x183] * 6 + 3] = param_1[param_1[0x183] * 6 + 3] + local_18[1];
    }
    if (param_1[0x183] != -1) {
      FUN_00434efc(param_1);
    }
  }
LAB_00434bb6:
  __security_check_cookie(local_18[4] ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00434bc9 */

void FUN_00434bc9(int param_1,int *param_2,uint *param_3)

{
  int iVar1;
  int *piVar2;
  int iVar3;
  uint uVar4;
  int *local_c;
  uint local_8;
  
  piVar2 = (int *)0x0;
  uVar4 = 0;
  if (param_1 != 0) {
    uVar4 = Ordinal_115(param_1);
    iVar3 = 1;
    if (uVar4 != 0) {
      piVar2 = (int *)FUN_00431078(uVar4 << 2,1);
    }
    local_c = piVar2;
    if (piVar2 != (int *)0x0) {
      for (; iVar3 - 1U < uVar4; iVar3 = iVar3 + 1) {
        local_8 = 0;
        iVar1 = Ordinal_118(param_1,iVar3,&DAT_0043b580,&local_8);
        if (iVar1 == 0xea) {
          local_8 = local_8 + 1;
          iVar1 = FUN_00433bdf(local_c,local_8);
          if (-1 < iVar1) {
            Ordinal_118(param_1,iVar3,*local_c,&local_8);
          }
        }
        local_c = local_c + 1;
      }
    }
  }
  *param_2 = (int)piVar2;
  *param_3 = uVar4;
  return;
}



/* Function: FUN_00434c62 */

void FUN_00434c62(int *param_1,uint param_2,LPCWSTR param_3)

{
  if (param_3 != (LPCWSTR)0x0) {
    if ((param_2 & 0xff000000) == 0xa000000) {
      FUN_0043497c(param_1,param_3,0);
    }
    else {
      FUN_00434849(param_1,param_2 & 0xff000000,param_2 & 0xffffff,param_3,0);
    }
  }
  return;
}



/* Function: FUN_00434ca1 */

undefined4 FUN_00434ca1(int *param_1,uint param_2,int param_3)

{
  uint uVar1;
  uint uVar2;
  int iVar3;
  undefined4 uVar4;
  uint local_c;
  LPVOID local_8;
  
  uVar4 = 0;
  local_8 = (LPVOID)0x0;
  local_c = 0;
  if (param_3 != 0) {
    if ((param_2 & 0xff000000) == 0xa000000) {
      uVar4 = FUN_0043497c(param_1,(LPCWSTR)0x0,param_3);
    }
    else {
      uVar1 = Ordinal_171(0,param_3,&DAT_0043b580,&local_c);
      if ((uVar1 == 0xea) || (uVar1 == 0)) {
        local_c = local_c + 1;
        uVar2 = FUN_00433bdf((int *)&local_8,local_c);
      }
      else {
        uVar2 = uVar1 & 0xffff | 0x80070000;
        if ((int)uVar1 < 1) {
          uVar2 = uVar1;
        }
      }
      if (-1 < (int)uVar2) {
        iVar3 = Ordinal_171(0,param_3,local_8,&local_c);
        if (iVar3 == 0) {
          uVar4 = FUN_00434849(param_1,param_2 & 0xff000000,param_2 & 0xffffff,local_8,param_3);
        }
        else {
          FUN_004300d9();
        }
      }
    }
    if (local_8 != (LPVOID)0x0) {
      FUN_004380ab(local_8);
    }
  }
  return uVar4;
}



/* Function: FUN_00434d8d */

undefined4 FUN_00434d8d(int param_1,undefined4 param_2,undefined4 param_3,int param_4)

{
  LPVOID pvVar1;
  uint uVar2;
  int iVar3;
  undefined4 uVar4;
  uint *puVar5;
  uint local_2c [3];
  LPVOID local_20;
  undefined4 local_1c;
  int local_18;
  undefined4 local_14;
  int local_10;
  LPVOID local_c;
  uint local_8;
  
  uVar4 = 0;
  puVar5 = local_2c;
  for (iVar3 = 7; iVar3 != 0; iVar3 = iVar3 + -1) {
    *puVar5 = 0;
    puVar5 = puVar5 + 1;
  }
  local_10 = 0;
  local_c = (LPVOID)0x0;
  local_8 = 0;
  if (param_4 != 0) {
    local_10 = Ordinal_116(param_4,1);
    if (local_10 == 0x645) {
      uVar4 = 5;
    }
    else if (local_10 == 0x6a8) {
      uVar4 = 1;
    }
  }
  FUN_00434bc9(param_4,(int *)&local_c,&local_8);
  uVar2 = local_8;
  pvVar1 = local_c;
  local_2c[1] = param_2;
  local_18 = local_10;
  local_14 = param_3;
  local_2c[0] = 2;
  local_2c[2] = local_8;
  local_20 = local_c;
  local_1c = uVar4;
  uVar4 = (**(code **)(param_1 + 4))(local_2c,*(undefined4 *)(param_1 + 8));
  FUN_00434f65(pvVar1,uVar2);
  return uVar4;
}



/* Function: FUN_00434e27 */

undefined4 FUN_00434e27(int param_1,int param_2)

{
  LPVOID pvVar1;
  uint uVar2;
  undefined4 uVar3;
  int iVar4;
  uint *puVar5;
  uint local_28 [3];
  LPVOID local_1c;
  uint local_14;
  LPVOID local_10;
  LPVOID local_c;
  uint local_8;
  
  local_c = (LPVOID)0x0;
  local_8 = 0;
  puVar5 = local_28;
  for (iVar4 = 7; iVar4 != 0; iVar4 = iVar4 + -1) {
    *puVar5 = 0;
    puVar5 = puVar5 + 1;
  }
  FUN_00434bc9(param_2,(int *)&local_c,&local_8);
  uVar2 = local_8;
  pvVar1 = local_c;
  local_28[0] = 4;
  local_28[1] = 0xe;
  local_28[2] = local_8;
  local_1c = local_c;
  local_14 = local_8;
  local_10 = local_c;
  uVar3 = (**(code **)(param_1 + 4))(local_28,*(undefined4 *)(param_1 + 8));
  FUN_00434f65(pvVar1,uVar2);
  return uVar3;
}



/* Function: FUN_00434e8f */

undefined4
FUN_00434e8f(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,int param_5)

{
  LPVOID pvVar1;
  uint uVar2;
  undefined4 uVar3;
  int iVar4;
  uint *puVar5;
  uint local_28 [3];
  LPVOID local_1c;
  undefined4 local_14;
  undefined4 local_10;
  LPVOID local_c;
  uint local_8;
  
  local_c = (LPVOID)0x0;
  local_8 = 0;
  puVar5 = local_28;
  for (iVar4 = 7; iVar4 != 0; iVar4 = iVar4 + -1) {
    *puVar5 = 0;
    puVar5 = puVar5 + 1;
  }
  FUN_00434bc9(param_5,(int *)&local_c,&local_8);
  uVar2 = local_8;
  pvVar1 = local_c;
  local_28[1] = param_3;
  local_14 = param_2;
  local_10 = param_4;
  local_28[0] = 3;
  local_28[2] = local_8;
  local_1c = local_c;
  uVar3 = (**(code **)(param_1 + 4))(local_28,*(undefined4 *)(param_1 + 8));
  FUN_00434f65(pvVar1,uVar2);
  return uVar3;
}



/* Function: FUN_00434efc */

void FUN_00434efc(int *param_1)

{
  int iVar1;
  uint uVar2;
  undefined4 *puVar3;
  longlong lVar4;
  longlong lVar5;
  longlong lVar6;
  undefined4 local_20 [5];
  uint local_c;
  
  puVar3 = local_20;
  for (iVar1 = 7; iVar1 != 0; iVar1 = iVar1 + -1) {
    *puVar3 = 0;
    puVar3 = puVar3 + 1;
  }
  lVar4 = FUN_004347cd((uint)param_1,1,0x50);
  lVar5 = FUN_004347cd((uint)param_1,0,0xf);
  lVar6 = FUN_004347cd((uint)param_1,2,5);
  uVar2 = (int)lVar4 + (int)lVar5 + (int)lVar6;
  local_c = 100;
  if (uVar2 < 100) {
    local_c = uVar2;
  }
  if (*param_1 != 0) {
    local_c = 100 - local_c;
  }
  local_20[0] = 1;
  local_20[1] = 1;
  (*(code *)param_1[1])(local_20,param_1[2]);
  return;
}



/* Function: FUN_00434f65 */

void FUN_00434f65(LPVOID param_1,uint param_2)

{
  uint uVar1;
  
  if (param_1 != (LPVOID)0x0) {
    uVar1 = 0;
    if (param_2 != 0) {
      do {
        if (*(int *)((int)param_1 + uVar1 * 4) != 0) {
          FUN_004380ab(*(LPVOID *)((int)param_1 + uVar1 * 4));
        }
        uVar1 = uVar1 + 1;
      } while (uVar1 < param_2);
    }
    FUN_00431137(param_1);
  }
  return;
}



/* Function: FUN_00434f98 */

uint FUN_00434f98(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
                 undefined4 *param_5)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  
  uVar3 = 0;
  iVar1 = (*(code *)PTR_Ordinal_190_00456ef0)(param_1,param_2,param_3,param_4);
  uVar2 = FUN_0043480e(iVar1,param_5);
  if (uVar2 != 0) {
    uVar3 = uVar2 & 0xffff | 0x80070000;
    if ((int)uVar2 < 1) {
      uVar3 = uVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar3;
}



/* Function: FUN_00434fec */

uint FUN_00434fec(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
                 undefined4 param_5)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  if (DAT_00457eec == (code *)0x0) {
    uVar2 = 0x80004001;
  }
  else {
    uVar1 = (*DAT_00457eec)(param_1,param_2,param_3,param_5,param_4);
    if (uVar1 != 0) {
      uVar2 = uVar1 & 0xffff | 0x80070000;
      if ((int)uVar1 < 1) {
        uVar2 = uVar1;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
    }
  }
  return uVar2;
}



/* Function: FUN_00435046 */

uint FUN_00435046(undefined4 param_1,undefined4 param_2,undefined4 param_3)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  uVar1 = (*(code *)PTR_Ordinal_169_00456ed8)(param_1,param_2,param_3);
  if (uVar1 != 0) {
    uVar2 = uVar1 & 0xffff | 0x80070000;
    if ((int)uVar1 < 1) {
      uVar2 = uVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_0043508e */

uint FUN_0043508e(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
                 undefined4 param_5,undefined4 param_6,undefined4 param_7,undefined4 param_8)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  if (DAT_00457ef0 == (code *)0x0) {
    uVar2 = 0x80004001;
  }
  else {
    uVar1 = (*DAT_00457ef0)(param_1,param_2,param_3,param_4,param_5,param_6,param_7,param_8);
    if (uVar1 == 0x103) {
      uVar2 = 0x80070103;
    }
    else if (uVar1 != 0) {
      uVar2 = uVar1 & 0xffff | 0x80070000;
      if ((int)uVar1 < 1) {
        uVar2 = uVar1;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
    }
  }
  return uVar2;
}



/* Function: FUN_004350ff */

uint FUN_004350ff(undefined4 param_1,undefined4 param_2,undefined4 param_3)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  uVar1 = (*(code *)PTR_Ordinal_205_00456f04)(param_1,0,param_2,param_3);
  if (uVar1 == 0x103) {
    uVar2 = 0x80070103;
  }
  else if (uVar1 != 0) {
    uVar2 = uVar1 & 0xffff | 0x80070000;
    if ((int)uVar1 < 1) {
      uVar2 = uVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_00435156 */

int FUN_00435156(undefined4 param_1,undefined4 param_2,int *param_3,int *param_4)

{
  int *piVar1;
  int iVar2;
  int iVar3;
  int *local_8;
  
  piVar1 = param_4;
  local_8 = (int *)0x40;
  iVar2 = FUN_00433bdf(param_4,0x40);
  if (-1 < iVar2) {
    param_4 = local_8;
    iVar3 = (*(code *)PTR_Ordinal_173_00456ee4)(param_1,param_2,*piVar1,&local_8);
    *param_3 = iVar3;
    if (iVar3 == -3) {
      local_8 = (int *)((int)local_8 + 1);
      iVar2 = FUN_00433bdf(piVar1,(uint)local_8);
      if (iVar2 < 0) {
        return iVar2;
      }
      param_4 = local_8;
      iVar3 = (*(code *)PTR_Ordinal_173_00456ee4)(param_1,param_2,*piVar1,&local_8);
      *param_3 = iVar3;
    }
    if (*param_3 == -2) {
      iVar2 = -0x7ff8ffa9;
      FUN_004300d9();
    }
    else if ((*param_3 != -1) && (param_4 <= local_8)) {
      local_8 = (int *)((int)local_8 + 1);
      iVar2 = FUN_00433bdf(piVar1,(uint)local_8);
      if (-1 < iVar2) {
        iVar3 = (*(code *)PTR_Ordinal_173_00456ee4)(param_1,param_2,*piVar1,&local_8);
        *param_3 = iVar3;
      }
    }
  }
  return iVar2;
}



/* Function: FUN_0043521e */

uint FUN_0043521e(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
                 undefined4 param_5,int *param_6)

{
  uint uVar1;
  uint uVar2;
  uint local_8;
  
  local_8 = 0x40;
  if (DAT_00457ef4 == (code *)0x0) {
    uVar2 = 0x80004001;
  }
  else {
    uVar2 = FUN_00433bdf(param_6,0x40);
    if (-1 < (int)uVar2) {
      uVar1 = (*DAT_00457ef4)(param_1,param_2,param_3,param_4,param_5,*param_6,&local_8);
      if (uVar1 == 0xea) {
        local_8 = local_8 + 1;
        uVar2 = FUN_00433bdf(param_6,local_8);
        if ((int)uVar2 < 0) {
          return uVar2;
        }
        uVar1 = (*DAT_00457ef4)(param_1,param_2,param_3,param_4,param_5,*param_6,&local_8);
      }
      if (uVar1 != 0) {
        uVar2 = uVar1 & 0xffff | 0x80070000;
        if ((int)uVar1 < 1) {
          uVar2 = uVar1;
        }
        if (-1 < (int)uVar2) {
          uVar2 = 0x80004005;
        }
        FUN_004300d9();
      }
    }
  }
  return uVar2;
}



/* Function: FUN_004352d2 */

uint FUN_004352d2(undefined4 param_1,undefined4 param_2,int *param_3)

{
  uint uVar1;
  uint uVar2;
  uint local_8;
  
  local_8 = 0x40;
  uVar1 = FUN_00433bdf(param_3,0x40);
  if (-1 < (int)uVar1) {
    uVar2 = (*(code *)PTR_Ordinal_70_00456edc)(param_1,param_2,*param_3,&local_8);
    if (uVar2 == 0xea) {
      local_8 = local_8 + 1;
      uVar1 = FUN_00433bdf(param_3,local_8);
      if ((int)uVar1 < 0) {
        return uVar1;
      }
      uVar2 = (*(code *)PTR_Ordinal_70_00456edc)(param_1,param_2,*param_3,&local_8);
    }
    if (uVar2 != 0) {
      uVar1 = uVar2 & 0xffff | 0x80070000;
      if ((int)uVar2 < 1) {
        uVar1 = uVar2;
      }
      if (-1 < (int)uVar1) {
        uVar1 = 0x80004005;
      }
      FUN_004300d9();
    }
  }
  return uVar1;
}



/* Function: FUN_00435361 */

uint FUN_00435361(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
                 int *param_5)

{
  uint uVar1;
  uint uVar2;
  uint local_8;
  
  local_8 = 0x40;
  if (DAT_00457ef8 == (code *)0x0) {
    uVar1 = FUN_004352d2(param_1,param_4,param_5);
  }
  else {
    uVar1 = FUN_00433bdf(param_5,0x40);
    if (-1 < (int)uVar1) {
      uVar2 = (*DAT_00457ef8)(param_1,param_2,param_3,param_4,*param_5,&local_8);
      if (uVar2 == 0xea) {
        local_8 = local_8 + 1;
        uVar1 = FUN_00433bdf(param_5,local_8);
        if ((int)uVar1 < 0) {
          return uVar1;
        }
        uVar2 = (*DAT_00457ef8)(param_1,param_2,param_3,param_4,*param_5,&local_8);
      }
      if (uVar2 != 0) {
        uVar1 = uVar2 & 0xffff | 0x80070000;
        if ((int)uVar2 < 1) {
          uVar1 = uVar2;
        }
        if (-1 < (int)uVar1) {
          uVar1 = 0x80004005;
        }
        FUN_004300d9();
      }
    }
  }
  return uVar1;
}



/* Function: FUN_0043541a */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

int FUN_0043541a(void)

{
  int iVar1;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  iVar1 = FUN_004300f0(0x45317c,&DAT_00457f04,(int *)&local_8);
  if (-1 < iVar1) {
    FUN_0043710a(local_8,&DAT_00457f24,(undefined4 *)&DAT_00457f28);
    _DAT_00457f08 = GetProcAddress(DAT_00457f04,"MsiDeterminePatchSequenceW");
    if (DAT_00457eec == (FARPROC)0x0) {
      DAT_00457eec = _DAT_00457f08;
    }
    _DAT_00457f0c = GetProcAddress(DAT_00457f04,"MsiEnumProductsExW");
    if (DAT_00457ef0 == (FARPROC)0x0) {
      DAT_00457ef0 = _DAT_00457f0c;
    }
    _DAT_00457f10 = GetProcAddress(DAT_00457f04,"MsiGetPatchInfoExW");
    if (DAT_00457ef4 == (FARPROC)0x0) {
      DAT_00457ef4 = _DAT_00457f10;
    }
    _DAT_00457f14 = GetProcAddress(DAT_00457f04,"MsiGetProductInfoExW");
    if (DAT_00457ef8 == (FARPROC)0x0) {
      DAT_00457ef8 = _DAT_00457f14;
    }
    _DAT_00457f18 = GetProcAddress(DAT_00457f04,"MsiSetExternalUIRecord");
    if (DAT_00457efc == (FARPROC)0x0) {
      DAT_00457efc = _DAT_00457f18;
    }
    _DAT_00457f1c = GetProcAddress(DAT_00457f04,"MsiSourceListAddSourceExW");
    if (DAT_00457f00 == (FARPROC)0x0) {
      DAT_00457f00 = _DAT_00457f1c;
    }
    _DAT_00457f20 = 1;
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_00435549 */

uint FUN_00435549(uint param_1,undefined4 param_2,uint param_3,uint param_4,uint param_5,
                 uint *param_6)

{
  code *pcVar1;
  uint *puVar2;
  uint uVar3;
  undefined4 uVar4;
  uint uVar5;
  
  puVar2 = param_6;
  uVar5 = 0;
  uVar4 = 0x3fe7;
  if (0x3ffff < DAT_00457f24) {
    uVar4 = 0x2003fe7;
  }
  FUN_004267c0(param_6,0,0x628);
  *puVar2 = param_5;
  puVar2[1] = param_1;
  puVar2[2] = param_4;
  uVar3 = (*(code *)PTR_Ordinal_141_00456ef8)(param_2,&param_3);
  pcVar1 = DAT_00457efc;
  puVar2[0x184] = uVar3;
  puVar2[0x185] = param_3;
  if (pcVar1 == (code *)0x0) {
    uVar3 = (*(code *)PTR_Ordinal_137_00456efc)(FUN_00434c62,uVar4,puVar2);
    puVar2[0x186] = uVar3;
    puVar2[0x189] = 1;
  }
  else {
    uVar3 = (*pcVar1)(FUN_00434ca1,uVar4,puVar2,puVar2 + 0x187);
    if (uVar3 == 0) {
      puVar2[0x188] = 1;
    }
    else {
      uVar5 = uVar3 & 0xffff | 0x80070000;
      if ((int)uVar3 < 1) {
        uVar5 = uVar3;
      }
      if (-1 < (int)uVar5) {
        uVar5 = 0x80004005;
      }
      FUN_004300d9();
    }
  }
  return uVar5;
}



/* Function: FUN_00435621 */

uint FUN_00435621(undefined4 param_1,undefined4 param_2,undefined4 *param_3)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  
  uVar3 = 0;
  iVar1 = (*(code *)PTR_Ordinal_88_00456eec)(param_1,param_2);
  uVar2 = FUN_0043480e(iVar1,param_3);
  if (uVar2 != 0) {
    uVar3 = uVar2 & 0xffff | 0x80070000;
    if ((int)uVar2 < 1) {
      uVar3 = uVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar3;
}



/* Function: FUN_0043566f */

int FUN_0043566f(undefined4 param_1,int *param_2,int *param_3)

{
  int *piVar1;
  int iVar2;
  int iVar3;
  int *local_8;
  
  piVar1 = param_3;
  local_8 = (int *)0x40;
  iVar2 = FUN_00433bdf(param_3,0x40);
  if (-1 < iVar2) {
    param_3 = local_8;
    iVar3 = (*(code *)PTR_Ordinal_90_00456ee8)(param_1,*piVar1,&local_8);
    *param_2 = iVar3;
    if (iVar3 == -3) {
      local_8 = (int *)((int)local_8 + 1);
      iVar2 = FUN_00433bdf(piVar1,(uint)local_8);
      if (iVar2 < 0) {
        return iVar2;
      }
      param_3 = local_8;
      iVar3 = (*(code *)PTR_Ordinal_90_00456ee8)(param_1,*piVar1,&local_8);
      *param_2 = iVar3;
    }
    if (*param_2 == -2) {
      iVar2 = -0x7ff8ffa9;
      FUN_004300d9();
    }
    else if ((*param_2 != -1) && (param_3 <= local_8)) {
      local_8 = (int *)((int)local_8 + 1);
      iVar2 = FUN_00433bdf(piVar1,(uint)local_8);
      if (-1 < iVar2) {
        iVar3 = (*(code *)PTR_Ordinal_90_00456ee8)(param_1,*piVar1,&local_8);
        *param_2 = iVar3;
      }
    }
  }
  return iVar2;
}



/* Function: FUN_0043572e */

undefined4 FUN_0043572e(undefined4 param_1,undefined4 param_2,int *param_3)

{
  int iVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  iVar1 = (*(code *)PTR_Ordinal_111_00456ee0)(param_1,param_2);
  *param_3 = iVar1;
  if (iVar1 == -2) {
    uVar2 = 0x80070057;
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_00435768 */

uint FUN_00435768(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 *param_4)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  
  uVar3 = 0;
  iVar1 = (*(code *)PTR_Ordinal_238_00456ef4)(param_1,param_2,2,param_3);
  uVar2 = FUN_0043480e(iVar1,param_4);
  if (uVar2 != 0) {
    uVar3 = uVar2 & 0xffff | 0x80070000;
    if ((int)uVar2 < 1) {
      uVar3 = uVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar3;
}



/* Function: FUN_004357bb */

uint FUN_004357bb(undefined4 param_1,undefined4 param_2,undefined4 param_3,uint param_4,
                 undefined4 param_5,undefined4 param_6)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  uVar1 = (*DAT_00457f00)(param_1,param_2,param_3,param_4 | 1,param_5,param_6);
  if (uVar1 != 0) {
    uVar2 = uVar1 & 0xffff | 0x80070000;
    if ((int)uVar1 < 1) {
      uVar2 = uVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar2;
}



/* Function: FUN_00435810 */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void FUN_00435810(void)

{
  if (DAT_00457f04 != (HMODULE)0x0) {
    FreeLibrary(DAT_00457f04);
    DAT_00457f04 = (HMODULE)0x0;
    _DAT_00457f18 = 0;
    _DAT_00457f14 = 0;
    _DAT_00457f10 = 0;
    _DAT_00457f0c = 0;
    _DAT_00457f08 = 0;
    _DAT_00457f1c = 0;
  }
  _DAT_00457f20 = 0;
  return;
}



/* Function: FUN_00435855 */

void FUN_00435855(uint *param_1)

{
  uint uVar1;
  
  if (param_1[0x184] != 0) {
    uVar1 = (*(code *)PTR_Ordinal_141_00456ef8)(param_1[0x184],param_1 + 0x185);
    param_1[0x184] = uVar1;
  }
  if (param_1[0x189] != 0) {
    (*(code *)PTR_Ordinal_137_00456efc)(param_1[0x186],0,0);
  }
  if (param_1[0x188] != 0) {
    (*DAT_00457efc)(param_1[0x187],0,0,0);
  }
  FUN_004267c0(param_1,0,0x628);
  return;
}



/* Function: FUN_004358bf */

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

DWORD FUN_004358bf(int param_1,undefined4 *param_2,undefined4 *param_3)

{
  int *piVar1;
  int *piVar2;
  HMODULE hModule;
  DWORD DVar3;
  FARPROC pFVar4;
  FARPROC pFVar5;
  FARPROC pFVar6;
  int iVar7;
  int iVar8;
  uint uVar9;
  undefined4 local_10;
  int *local_c;
  int *local_8;
  
  iVar8 = 0;
  local_10 = 0;
  local_c = (int *)0x0;
  local_8 = (int *)0x0;
  hModule = GetModuleHandleA("kernel32.dll");
  if (hModule == (HMODULE)0x0) {
    DVar3 = GetLastError();
    uVar9 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar9 = DVar3;
    }
    if (-1 < (int)uVar9) {
      uVar9 = 0x80004005;
    }
    FUN_004300d9();
    goto LAB_00435a36;
  }
  pFVar4 = GetProcAddress(hModule,"IsWow64Process");
  if (pFVar4 == (FARPROC)0x0) {
    pFVar4 = (FARPROC)0x0;
  }
  else {
    pFVar5 = GetProcAddress(hModule,"Wow64DisableWow64FsRedirection");
    pFVar6 = GetProcAddress(hModule,"Wow64EnableWow64FsRedirection");
    pFVar4 = GetProcAddress(hModule,"Wow64RevertWow64FsRedirection");
    if (((pFVar5 == (FARPROC)0x0) || (pFVar6 == (FARPROC)0x0)) || (pFVar4 == (FARPROC)0x0)) {
      iVar8 = 0;
    }
    else {
      (*pFVar5)(&local_10);
      iVar8 = (*pFVar6)(1);
    }
  }
  uVar9 = CoCreateInstance((IID *)&DAT_00457f2c,(LPUNKNOWN)0x0,1,(IID *)&DAT_0043bcb0,&local_8);
  if (-1 < (int)uVar9) {
    iVar7 = 0;
    do {
      if ((&DAT_00457f2c)[iVar7] != (&DAT_0043bca0)[iVar7]) {
        iVar7 = 0;
        goto LAB_004359b3;
      }
      iVar7 = iVar7 + 1;
    } while (iVar7 != 4);
    goto LAB_004359cb;
  }
  goto LAB_00435a20;
  while (iVar7 = iVar7 + 1, iVar7 != 4) {
LAB_004359b3:
    if ((&DAT_00457f2c)[iVar7] != (&DAT_0043bc90)[iVar7]) goto LAB_004359d5;
  }
LAB_004359cb:
  _DAT_00457f48 = 1;
LAB_004359d5:
  if ((param_1 == 0) ||
     ((uVar9 = FUN_00435a58(local_8,param_1,(int)&local_c), -1 < (int)uVar9 &&
      (uVar9 = (**(code **)(*local_8 + 0x54))(local_8,local_c,0), -1 < (int)uVar9)))) {
    piVar2 = local_8;
    piVar1 = local_c;
    local_8 = (int *)0x0;
    *param_2 = piVar2;
    if (param_3 != (undefined4 *)0x0) {
      local_c = (int *)0x0;
      *param_3 = piVar1;
    }
  }
LAB_00435a20:
  if ((iVar8 != 0) && (iVar8 = (*pFVar4)(local_10), iVar8 == 0)) {
                    /* WARNING: Subroutine does not return */
    ExitProcess(1);
  }
LAB_00435a36:
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return uVar9;
}



/* Function: FUN_00435a58 */

undefined4 FUN_00435a58(int *param_1,undefined4 param_2,int param_3)

{
  int iVar1;
  undefined4 uVar2;
  
  if ((param_3 == 0) || (param_1 == (int *)0x0)) {
    uVar2 = 0x80070057;
  }
  else {
    iVar1 = Ordinal_2(param_2);
    if (iVar1 == 0) {
      uVar2 = 0x8007000e;
      FUN_004300d9();
    }
    else {
      uVar2 = (**(code **)(*param_1 + 0xbc))(param_1,iVar1,param_3);
      Ordinal_6(iVar1);
    }
  }
  return uVar2;
}



/* Function: FUN_00435ab2 */

int FUN_00435ab2(int *param_1,undefined4 param_2,undefined4 *param_3)

{
  undefined4 uVar1;
  int iVar2;
  int iVar3;
  undefined1 local_1c [8];
  undefined4 local_14;
  int *local_c;
  int *local_8;
  
  local_8 = (int *)0x0;
  local_c = (int *)0x0;
  iVar2 = Ordinal_2(param_2);
  Ordinal_8(local_1c);
  iVar3 = (**(code **)(*param_1 + 0x44))(param_1,&local_8);
  if (-1 < iVar3) {
    iVar3 = FUN_00435cff(local_8,iVar2,(int)&local_c);
    if ((iVar3 != 1) && (-1 < iVar3)) {
      iVar3 = (**(code **)(*local_c + 0x20))(local_c,local_1c);
      uVar1 = local_14;
      if ((-1 < iVar3) && ((iVar3 == 0 && (param_3 != (undefined4 *)0x0)))) {
        local_14 = 0;
        *param_3 = uVar1;
      }
    }
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  Ordinal_9(local_1c);
  if (iVar2 != 0) {
    Ordinal_6(iVar2);
  }
  return iVar3;
}



/* Function: FUN_00435b5e */

int FUN_00435b5e(int *param_1,undefined4 param_2,int *param_3)

{
  int iVar1;
  int iVar2;
  undefined1 local_1c [8];
  LPCWSTR local_14;
  int *local_c;
  int *local_8;
  
  local_8 = (int *)0x0;
  local_c = (int *)0x0;
  iVar2 = 0;
  Ordinal_8(local_1c);
  iVar1 = (**(code **)(*param_1 + 0x44))(param_1,&local_8);
  if (-1 < iVar1) {
    iVar2 = Ordinal_2(param_2);
    if (iVar2 == 0) {
      iVar1 = -0x7ff8fff2;
      FUN_004300d9();
    }
    else {
      iVar1 = FUN_00435cff(local_8,iVar2,(int)&local_c);
      if (iVar1 != 1) {
        if (iVar1 < 0) goto LAB_00435bf9;
        iVar1 = (**(code **)(*local_c + 0x20))(local_c,local_1c);
        if (iVar1 != 1) {
          if (-1 < iVar1) {
            iVar1 = FUN_00433f88(param_3,local_14,0);
          }
          goto LAB_00435bf9;
        }
      }
      iVar1 = -0x7ff8fb70;
    }
  }
LAB_00435bf9:
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  Ordinal_9(local_1c);
  if (iVar2 != 0) {
    Ordinal_6(iVar2);
  }
  return iVar1;
}



/* Function: FUN_00435c30 */

int FUN_00435c30(int *param_1,undefined4 param_2,undefined4 *param_3)

{
  int iVar1;
  undefined8 local_10;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  iVar1 = FUN_00435ab2(param_1,param_2,&local_8);
  if (-1 < iVar1) {
    if (iVar1 == 0) {
      local_10 = 0;
      iVar1 = FUN_004345da(local_8,0,&local_10);
      if (-1 < iVar1) {
        *param_3 = (undefined4)local_10;
        param_3[1] = local_10._4_4_;
      }
    }
    else {
      *param_3 = 0;
      param_3[1] = 0;
    }
  }
  if (local_8 != (LPCWSTR)0x0) {
    Ordinal_6(local_8);
  }
  return iVar1;
}



/* Function: FUN_00435c9d */

void FUN_00435c9d(int *param_1,undefined4 param_2,ulong *param_3)

{
  FUN_00435cb4(param_1,param_2,10,param_3);
  return;
}



/* Function: FUN_00435cb4 */

int FUN_00435cb4(int *param_1,undefined4 param_2,int param_3,ulong *param_4)

{
  int iVar1;
  ulong uVar2;
  wchar_t *local_8;
  
  local_8 = (wchar_t *)0x0;
  iVar1 = FUN_00435ab2(param_1,param_2,&local_8);
  if ((-1 < iVar1) && (iVar1 == 0)) {
    uVar2 = FID_conflict___wcstoul_l(local_8,(wchar_t **)0x0,param_3);
    *param_4 = uVar2;
  }
  if (local_8 != (wchar_t *)0x0) {
    Ordinal_6(local_8);
  }
  return iVar1;
}



/* Function: FUN_00435cff */

undefined4 FUN_00435cff(int *param_1,undefined4 param_2,int param_3)

{
  int iVar1;
  undefined4 uVar2;
  
  if ((param_1 == (int *)0x0) || (param_3 == 0)) {
    uVar2 = 0x80070057;
  }
  else {
    iVar1 = Ordinal_2(param_2);
    if (iVar1 == 0) {
      uVar2 = 0x8007000e;
      FUN_004300d9();
    }
    else {
      uVar2 = (**(code **)(*param_1 + 0x1c))(param_1,iVar1,param_3);
      Ordinal_6(iVar1);
    }
  }
  return uVar2;
}



/* Function: FUN_00435d59 */

void FUN_00435d59(int *param_1,undefined4 param_2)

{
  (**(code **)(*param_1 + 0x68))(param_1,param_2);
  return;
}



/* Function: FUN_00435d6c */

int FUN_00435d6c(int *param_1,undefined4 param_2,uint *param_3)

{
  int iVar1;
  int iVar2;
  PCNZWCH local_8;
  
  local_8 = (PCNZWCH)0x0;
  iVar1 = FUN_00435b5e(param_1,param_2,(int *)&local_8);
  if ((iVar1 != -0x7ff8fb70) && (-1 < iVar1)) {
    iVar2 = CompareStringW(0x7f,0,local_8,-1,L"yes",-1);
    *param_3 = (uint)(iVar2 == 2);
  }
  if (local_8 != (PCNZWCH)0x0) {
    FUN_004380ab(local_8);
  }
  return iVar1;
}



/* Function: FUN_00435dca */

HRESULT FUN_00435dca(void)

{
  HRESULT HVar1;
  LONG LVar2;
  
  if ((DAT_00457f44 == 0) && (HVar1 = CoInitialize((LPVOID)0x0), HVar1 != -0x7ffefefa)) {
    if (HVar1 < 0) {
      return HVar1;
    }
    DAT_00457f44 = 1;
  }
  LVar2 = InterlockedIncrement((LONG *)&DAT_00457f3c);
  if (((LVar2 != 1) ||
      (HVar1 = CLSIDFromProgID(L"Msxml2.DOMDocument",(LPCLSID)&DAT_00457f2c), -1 < HVar1)) ||
     (HVar1 = CLSIDFromProgID(L"MSXML.DOMDocument",(LPCLSID)&DAT_00457f2c), -1 < HVar1)) {
    HVar1 = 0;
  }
  return HVar1;
}



/* Function: FUN_00435e28 */

void FUN_00435e28(undefined4 param_1,undefined4 param_2,undefined4 *param_3)

{
  DWORD DVar1;
  int iVar2;
  int *piVar3;
  undefined4 *puVar4;
  undefined4 local_40;
  undefined4 uStack_3c;
  undefined4 *local_38;
  undefined4 uStack_34;
  undefined4 *local_30;
  undefined4 local_2c;
  undefined4 local_28;
  int *local_24;
  undefined4 local_20;
  undefined4 local_1c;
  undefined4 local_14;
  undefined4 local_10;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_2c = param_1;
  local_30 = param_3;
  puVar4 = &local_20;
  for (iVar2 = 6; iVar2 != 0; iVar2 = iVar2 + -1) {
    *puVar4 = 0;
    puVar4 = puVar4 + 1;
  }
  local_24 = (int *)0x0;
  local_28 = 0;
  Ordinal_8(&local_40);
  DVar1 = FUN_004358bf(0,&local_24,(undefined4 *)0x0);
  piVar3 = local_24;
  if (DVar1 == 1) {
    DVar1 = 0x80004005;
  }
  if (-1 < (int)DVar1) {
    iVar2 = (**(code **)(*local_24 + 0x110))(local_24,0);
    if (-1 < iVar2) {
      iVar2 = (**(code **)(*piVar3 + 0x118))(piVar3,0);
      if (-1 < iVar2) {
        local_20._2_2_ = 0x12;
        local_14 = local_2c;
        local_10 = param_2;
        local_20._0_2_ = 1;
        local_1c = 1;
        local_40 = CONCAT22(local_40._2_2_,0x2011);
        local_38 = &local_20;
        iVar2 = (**(code **)(*piVar3 + 0xe8))
                          (piVar3,local_40,uStack_3c,local_38,uStack_34,&local_28);
        if (iVar2 == 1) {
          iVar2 = -0x7ff8ff92;
        }
        if (-1 < iVar2) {
          *local_30 = piVar3;
          piVar3 = (int *)0x0;
        }
      }
    }
  }
  if (piVar3 != (int *)0x0) {
    (**(code **)(*piVar3 + 8))(piVar3);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00435f1d */

uint FUN_00435f1d(int *param_1,undefined4 *param_2,undefined4 *param_3)

{
  undefined4 *puVar1;
  uint uVar2;
  bool bVar3;
  int *local_8;
  
  puVar1 = param_3;
  local_8 = (int *)0x0;
  *param_2 = 0;
  if (param_3 != (undefined4 *)0x0) {
    *param_3 = 0;
  }
  while (uVar2 = (**(code **)(*param_1 + 0x24))(param_1,&local_8), uVar2 == 0) {
    uVar2 = (**(code **)(*local_8 + 0x28))(local_8,&param_3);
    if ((int)uVar2 < 0) goto LAB_00435fab;
    if (param_3 == (undefined4 *)0x1) break;
    if (local_8 != (int *)0x0) {
      (**(code **)(*local_8 + 8))(local_8);
      local_8 = (int *)0x0;
    }
  }
  if ((-1 < (int)uVar2) &&
     (((local_8 == (int *)0x0 || (puVar1 == (undefined4 *)0x0)) ||
      (uVar2 = (**(code **)(*local_8 + 0xa4))(local_8,puVar1), -1 < (int)uVar2)))) {
    bVar3 = local_8 == (int *)0x0;
    *param_2 = local_8;
    local_8 = (int *)0x0;
    uVar2 = (uint)bVar3;
  }
LAB_00435fab:
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return uVar2;
}



/* Function: FUN_00435fbe */

undefined4 FUN_00435fbe(int *param_1,undefined2 *param_2,int param_3)

{
  undefined2 *puVar1;
  int iVar2;
  undefined4 uVar3;
  
  if ((param_1 == (int *)0x0) || (param_3 == 0)) {
    uVar3 = 0x8000ffff;
    FUN_004300d9();
  }
  else {
    puVar1 = &DAT_0043b580;
    if (param_2 != (undefined2 *)0x0) {
      puVar1 = param_2;
    }
    iVar2 = Ordinal_2(puVar1);
    if (iVar2 == 0) {
      uVar3 = 0x8007000e;
      FUN_004300d9();
    }
    else {
      uVar3 = (**(code **)(*param_1 + 0x90))(param_1,iVar2,param_3);
      Ordinal_6(iVar2);
    }
  }
  return uVar3;
}



/* Function: FUN_00436045 */

undefined4 FUN_00436045(int *param_1,undefined2 *param_2,int param_3)

{
  undefined2 *puVar1;
  int iVar2;
  undefined4 uVar3;
  
  if ((param_1 == (int *)0x0) || (param_3 == 0)) {
    uVar3 = 0x8000ffff;
    FUN_004300d9();
  }
  else {
    puVar1 = &DAT_0043b580;
    if (param_2 != (undefined2 *)0x0) {
      puVar1 = param_2;
    }
    iVar2 = Ordinal_2(puVar1);
    if (iVar2 == 0) {
      uVar3 = 0x8007000e;
      FUN_004300d9();
    }
    else {
      uVar3 = (**(code **)(*param_1 + 0x94))(param_1,iVar2,param_3);
      Ordinal_6(iVar2);
    }
  }
  return uVar3;
}



/* Function: FUN_004360cc */

void FUN_004360cc(void)

{
  LONG LVar1;
  
  LVar1 = InterlockedDecrement((LONG *)&DAT_00457f3c);
  if (LVar1 == 0) {
    DAT_00457f2c = 0;
    DAT_00457f30 = 0;
    DAT_00457f34 = 0;
    DAT_00457f38 = 0;
    if (DAT_00457f44 != 0) {
      DAT_00457f2c = LVar1;
      DAT_00457f30 = LVar1;
      DAT_00457f34 = LVar1;
      DAT_00457f38 = LVar1;
                    /* WARNING: Could not recover jumptable at 0x004360ef. Too many branches */
                    /* WARNING: Treating indirect jump as call */
      CoUninitialize();
      return;
    }
  }
  return;
}



/* Function: FUN_004360f6 */

void FUN_004360f6(PBOOL param_1)

{
  BOOL BVar1;
  uint local_18;
  PSID local_14;
  _SID_IDENTIFIER_AUTHORITY local_10;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_18 = 0;
  local_10.Value[0] = '\0';
  local_10.Value[1] = '\0';
  local_10.Value[2] = '\0';
  local_10.Value[3] = '\0';
  local_10.Value[4] = '\0';
  local_10.Value[5] = '\x05';
  local_14 = (PSID)0x0;
  FUN_00436280(&local_18);
  if (local_18 == 0) {
    BVar1 = AllocateAndInitializeSid(&local_10,'\x02',0x20,0x220,0,0,0,0,0,0,&local_14);
    *param_1 = BVar1;
    if (BVar1 != 0) {
      BVar1 = CheckTokenMembership((HANDLE)0x0,local_14,param_1);
      if (BVar1 == 0) {
        *param_1 = 0;
      }
    }
  }
  else {
    *param_1 = 1;
  }
  if (local_14 != (LPVOID)0x0) {
    FUN_004380ab(local_14);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00436186 */

void FUN_00436186(int *param_1,undefined4 *param_2)

{
  _OSVERSIONINFOW local_124;
  undefined2 local_10;
  undefined2 local_e;
  char local_a;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0(&local_124.dwOSVersionInfoSize,0,0x11c);
  if (DAT_00457f4c == 0) {
    local_124.dwOSVersionInfoSize = 0x11c;
    GetVersionExW(&local_124);
    DAT_00457f50 = CONCAT22(local_10,local_e);
    if (local_124.dwMajorVersion == 4) {
      DAT_00457f4c = 1;
    }
    else if (local_124.dwMajorVersion == 5) {
      if (local_124.dwMinorVersion == 0) {
        DAT_00457f4c = 2;
      }
      else if (local_124.dwMinorVersion == 1) {
        DAT_00457f4c = 3;
      }
      else {
        DAT_00457f4c = 9;
        if (local_124.dwMinorVersion == 2) {
          DAT_00457f4c = 4;
        }
      }
    }
    else {
      if (local_124.dwMajorVersion == 6) {
        if (local_124.dwMinorVersion == 0) {
          DAT_00457f4c = (local_a != '\x01') + 5;
          goto LAB_00436266;
        }
        if (local_124.dwMinorVersion == 1) {
          DAT_00457f4c = (local_a != '\x01') + 7;
          goto LAB_00436266;
        }
      }
      DAT_00457f4c = 9;
    }
  }
LAB_00436266:
  *param_1 = DAT_00457f4c;
  *param_2 = DAT_00457f50;
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00436280 */

uint FUN_00436280(uint *param_1)

{
  uint uVar1;
  int local_c;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  local_c = 0;
  *param_1 = 0;
  uVar1 = FUN_004324d5(0x80000002,L"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System",
                       0x20019,&local_8);
  if (uVar1 != 0x80070002) {
    if ((int)uVar1 < 0) goto LAB_004362e8;
    uVar1 = FUN_00432582(local_8,L"EnableLUA",&local_c);
    if (uVar1 != 0x80070002) {
      if (-1 < (int)uVar1) {
        *param_1 = (uint)(local_c != 0);
      }
      goto LAB_004362e8;
    }
  }
  uVar1 = 0;
LAB_004362e8:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  return uVar1;
}



/* Function: FUN_004362ff */

undefined4
FUN_004362ff(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
            undefined4 param_5,undefined4 param_6,undefined4 *param_7)

{
  int iVar1;
  undefined4 uVar2;
  uint local_40 [3];
  undefined4 local_34;
  undefined4 local_30;
  undefined4 local_2c;
  undefined4 local_28;
  undefined4 local_24;
  uint local_20;
  HANDLE local_8;
  
  uVar2 = 0;
  FUN_004267c0(local_40,0,0x3c);
  local_40[2] = param_6;
  local_34 = param_3;
  local_30 = param_1;
  local_2c = param_2;
  local_28 = param_4;
  local_24 = param_5;
  local_40[0] = 0x3c;
  local_40[1] = 0x540;
  iVar1 = (*DAT_00457f54)(local_40);
  if (iVar1 != 0) {
    if (param_7 != (undefined4 *)0x0) {
      *param_7 = local_8;
      local_8 = (HANDLE)0x0;
    }
    goto LAB_004363d5;
  }
  if (local_20 < 0x1c) {
    if (local_20 == 0x1b) {
LAB_004363b8:
      uVar2 = 0x80070483;
      goto LAB_004363d5;
    }
    if (local_20 == 2) {
      uVar2 = 0x80070002;
      goto LAB_004363d5;
    }
    if (local_20 == 3) {
      uVar2 = 0x80070003;
      goto LAB_004363d5;
    }
    if (local_20 == 5) {
      uVar2 = 0x80070005;
      goto LAB_004363d5;
    }
    if (local_20 == 8) {
      uVar2 = 0x8007000e;
      goto LAB_004363d5;
    }
    if (local_20 == 0xb) {
      uVar2 = 0x8007000b;
      goto LAB_004363d5;
    }
  }
  else {
    if (((local_20 == 0x1c) || (local_20 == 0x1d)) || (local_20 == 0x1e)) {
      uVar2 = 0x80070484;
      goto LAB_004363d5;
    }
    if (local_20 == 0x1f) goto LAB_004363b8;
    if (local_20 == 0x20) {
      uVar2 = 0x80070485;
      goto LAB_004363d5;
    }
  }
  uVar2 = 0x80004005;
LAB_004363d5:
  if (local_8 != (HANDLE)0x0) {
    CloseHandle(local_8);
  }
  return uVar2;
}



/* Function: FUN_004363eb */

void FUN_004363eb(int *param_1,uint param_2)

{
  int iVar1;
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  iVar1 = SHGetFolderPathW(0,param_2 | 0x8000,0,0,local_210);
  if (-1 < iVar1) {
    iVar1 = FUN_00433f88(param_1,local_210,0);
    if (-1 < iVar1) {
      FUN_0043124a(param_1);
    }
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0043644a */

void FUN_0043644a(LPVOID *param_1)

{
  HRESULT HVar1;
  CLSID local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_18.Data1 = 0;
  local_18.Data2 = 0;
  local_18.Data3 = 0;
  local_18.Data4[0] = '\0';
  local_18.Data4[1] = '\0';
  local_18.Data4[2] = '\0';
  local_18.Data4[3] = '\0';
  local_18.Data4[4] = '\0';
  local_18.Data4[5] = '\0';
  local_18.Data4[6] = '\0';
  local_18.Data4[7] = '\0';
  HVar1 = CLSIDFromProgID(L"Microsoft.Update.AutoUpdate",&local_18);
  if (-1 < HVar1) {
    CoCreateInstance(&local_18,(LPUNKNOWN)0x0,1,(IID *)&DAT_004537a8,param_1);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_0043649f */

int FUN_0043649f(void)

{
  int iVar1;
  int *local_8;
  
  local_8 = (int *)0x0;
  iVar1 = FUN_0043644a(&local_8);
  if (-1 < iVar1) {
    iVar1 = (**(code **)(*local_8 + 0x20))(local_8);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return iVar1;
}



/* Function: FUN_004364d4 */

HRESULT FUN_004364d4(uint *param_1)

{
  int iVar1;
  int *local_c;
  short local_8 [2];
  
  local_c = (int *)0x0;
  iVar1 = CoCreateInstance((IID *)&DAT_00453338,(LPUNKNOWN)0x0,1,(IID *)&DAT_00453348,&local_c);
  if ((iVar1 < 0) || (iVar1 = (**(code **)(*local_c + 0x20))(local_c,local_8), iVar1 < 0)) {
    FUN_004300d9();
  }
  else {
    *param_1 = (uint)(local_8[0] != 0);
  }
  if (local_c != (int *)0x0) {
    (**(code **)(*local_c + 8))(local_c);
  }
  return iVar1;
}



/* Function: FUN_00436547 */

int FUN_00436547(void)

{
  int iVar1;
  int *local_8;
  
  local_8 = (int *)0x0;
  iVar1 = FUN_0043644a(&local_8);
  if (-1 < iVar1) {
    iVar1 = (**(code **)(*local_8 + 0x24))(local_8);
  }
  if (local_8 != (int *)0x0) {
    (**(code **)(*local_8 + 8))(local_8);
  }
  return iVar1;
}



/* Function: _ULongSub@12 */

/* Library Function - Single Match
    _ULongSub@12
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release */

undefined4 _ULongSub_12(uint param_1,uint param_2,int *param_3)

{
  undefined4 uVar1;
  
  if (param_1 < param_2) {
    *param_3 = -1;
    uVar1 = 0x80070216;
  }
  else {
    *param_3 = param_1 - param_2;
    uVar1 = 0;
  }
  return uVar1;
}



/* Function: FUN_0043659f */

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_0043659f(HANDLE param_1,HANDLE param_2,uint param_3,uint param_4,uint *param_5)

{
  BOOL BVar1;
  DWORD DVar2;
  DWORD DVar3;
  bool bVar4;
  uint local_1010;
  DWORD DStack_100c;
  undefined1 local_1008 [4096];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  DStack_100c = 0;
  local_1010 = 0;
  DVar3 = DStack_100c;
  do {
    if ((((param_3 == 0) && (param_4 == 0)) ||
        (DStack_100c = param_3 - local_1010, param_4 - DVar3 != (uint)(param_3 < local_1010))) ||
       (0x1000 < DStack_100c)) {
      DStack_100c = 0x1000;
    }
    BVar1 = ReadFile(param_1,local_1008,DStack_100c,&DStack_100c,(LPOVERLAPPED)0x0);
    if (BVar1 == 0) {
      GetLastError();
      FUN_004300d9();
      goto LAB_004366d2;
    }
    if ((DStack_100c != 0) &&
       (DVar2 = FUN_004373a3(param_2,(int)local_1008,DStack_100c), (int)DVar2 < 0))
    goto LAB_004366d2;
    bVar4 = CARRY4(local_1010,DStack_100c);
    local_1010 = local_1010 + DStack_100c;
    DVar3 = DVar3 + bVar4;
  } while (((DVar3 <= param_4) && ((DVar3 < param_4 || (local_1010 < param_3)))) &&
          (DStack_100c != 0));
  if (param_5 != (uint *)0x0) {
    *param_5 = local_1010;
    param_5[1] = DVar3;
  }
LAB_004366d2:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_004366e5 */

DWORD FUN_004366e5(LPCWSTR param_1,LPCWSTR param_2,int param_3)

{
  WCHAR WVar1;
  BOOL BVar2;
  DWORD DVar3;
  DWORD DVar4;
  WCHAR *pWVar5;
  uint uVar6;
  WCHAR *pWVar7;
  
  BVar2 = CopyFileW(param_1,param_2,(uint)(param_3 == 0));
  DVar4 = 0;
  if (BVar2 == 0) {
    DVar3 = GetLastError();
    if ((param_3 == 0) && ((DVar3 == 0x50 || (DVar3 == 0xb7)))) {
      DVar4 = 1;
    }
    else if (DVar3 == 3) {
      WVar1 = *param_2;
      pWVar7 = (WCHAR *)0x0;
      pWVar5 = param_2;
      if (WVar1 != L'\0') {
        do {
          if (WVar1 == L'\\') {
            pWVar7 = pWVar5;
          }
          WVar1 = pWVar5[1];
          pWVar5 = pWVar5 + 1;
        } while (WVar1 != L'\0');
        if (pWVar7 != (WCHAR *)0x0) {
          *pWVar7 = L'\0';
          DVar4 = FUN_00437850(param_2,(LPSECURITY_ATTRIBUTES)0x0);
          *pWVar7 = L'\\';
          if ((int)DVar4 < 0) {
            return DVar4;
          }
          BVar2 = CopyFileW(param_1,param_2,param_3);
          if (BVar2 != 0) {
            return DVar4;
          }
          DVar4 = GetLastError();
          uVar6 = DVar4 & 0xffff | 0x80070000;
          if ((int)DVar4 < 1) {
            uVar6 = DVar4;
          }
          if (-1 < (int)uVar6) {
            return uVar6;
          }
          FUN_004300d9();
          return uVar6;
        }
      }
      DVar4 = 0x80070003;
    }
    else {
      DVar4 = DVar3 & 0xffff | 0x80070000;
      if ((int)DVar3 < 1) {
        DVar4 = DVar3;
      }
    }
  }
  return DVar4;
}



/* Function: FUN_004367c5 */

DWORD FUN_004367c5(LPCWSTR param_1,LPCWSTR param_2,int param_3,uint param_4,DWORD param_5)

{
  DWORD DVar1;
  uint uVar2;
  
  DVar1 = 0x80004005;
  uVar2 = 0;
  while( true ) {
    if (param_4 < uVar2) {
      return DVar1;
    }
    if (uVar2 != 0) {
      Sleep(param_5);
    }
    DVar1 = FUN_004366e5(param_1,param_2,param_3);
    if (DVar1 == 0x80070002) {
      return 0x80070002;
    }
    if (DVar1 == 0x80070003) {
      return 0x80070003;
    }
    if (DVar1 == 0x80070050) break;
    if (DVar1 == 0x800700b7) {
      return 0x800700b7;
    }
    uVar2 = uVar2 + 1;
    if (-1 < (int)DVar1) {
      return DVar1;
    }
  }
  return 0x80070050;
}



/* Function: FUN_00436816 */

DWORD FUN_00436816(LPCWSTR param_1)

{
  int iVar1;
  BOOL BVar2;
  DWORD DVar3;
  uint uVar4;
  uint local_8;
  
  local_8 = 0xffffffff;
  uVar4 = 0;
  iVar1 = FUN_00436af7(param_1,&local_8);
  if (iVar1 == 0) {
    return 0;
  }
  if (((local_8 & 7) != 0) && (BVar2 = SetFileAttributesW(param_1,0x80), BVar2 == 0)) {
    DVar3 = GetLastError();
    uVar4 = DVar3 & 0xffff | 0x80070000;
    if ((int)DVar3 < 1) {
      uVar4 = DVar3;
    }
    if ((int)uVar4 < 0) goto LAB_00436892;
  }
  BVar2 = DeleteFileW(param_1);
  if (BVar2 != 0) {
    return uVar4;
  }
  DVar3 = GetLastError();
  uVar4 = DVar3 & 0xffff | 0x80070000;
  if ((int)DVar3 < 1) {
    uVar4 = DVar3;
  }
  if (-1 < (int)uVar4) {
    return uVar4;
  }
LAB_00436892:
  FUN_004300d9();
  return uVar4;
}



/* Function: FUN_004368a4 */

uint FUN_004368a4(LPCWSTR param_1,LPCWSTR param_2,int param_3,int param_4)

{
  BOOL BVar1;
  DWORD DVar2;
  int iVar3;
  WCHAR WVar4;
  WCHAR *pWVar5;
  DWORD DVar6;
  uint uVar7;
  WCHAR *pWVar8;
  
  DVar6 = (DWORD)(param_3 != 0);
  if (param_4 != 0) {
    DVar6 = DVar6 | 2;
  }
  BVar1 = MoveFileExW(param_1,param_2,DVar6);
  if (BVar1 != 0) {
    return 0;
  }
  DVar2 = GetLastError();
  if ((param_3 == 0) && ((DVar2 == 0x50 || (DVar2 == 0xb7)))) {
    return 1;
  }
  if (DVar2 == 2) {
    iVar3 = FUN_00436af7(param_1,(uint *)0x0);
    if (iVar3 == 0) goto LAB_0043699e;
    DVar2 = 3;
  }
  if (DVar2 == 3) {
    pWVar8 = (WCHAR *)0x0;
    WVar4 = *param_2;
    pWVar5 = param_2;
    if (WVar4 != L'\0') {
      do {
        if (WVar4 == L'\\') {
          pWVar8 = pWVar5;
        }
        WVar4 = pWVar5[1];
        pWVar5 = pWVar5 + 1;
      } while (WVar4 != L'\0');
      if (pWVar8 != (WCHAR *)0x0) {
        *pWVar8 = L'\0';
        DVar2 = FUN_00437850(param_2,(LPSECURITY_ATTRIBUTES)0x0);
        *pWVar8 = L'\\';
        if ((int)DVar2 < 0) {
          return DVar2;
        }
        BVar1 = MoveFileExW(param_1,param_2,DVar6);
        if (BVar1 != 0) {
          return DVar2;
        }
        DVar6 = GetLastError();
        uVar7 = DVar6 & 0xffff | 0x80070000;
        if ((int)DVar6 < 1) {
          uVar7 = DVar6;
        }
        if (-1 < (int)uVar7) {
          return uVar7;
        }
        FUN_004300d9();
        return uVar7;
      }
    }
    return 0x80070003;
  }
LAB_0043699e:
  uVar7 = DVar2 & 0xffff | 0x80070000;
  if ((int)DVar2 < 1) {
    uVar7 = DVar2;
  }
  return uVar7;
}



/* Function: FUN_004369b5 */

uint FUN_004369b5(LPCWSTR param_1,LPCWSTR param_2,int param_3,int param_4,int param_5,DWORD param_6)

{
  uint uVar1;
  uint uVar2;
  
  uVar2 = 0;
  uVar1 = 0x80004005;
  do {
    if (param_5 + 1U <= uVar2) {
      return uVar1;
    }
    if (uVar2 != 0) {
      Sleep(param_6);
    }
    uVar1 = FUN_004368a4(param_1,param_2,param_3,param_4);
    uVar2 = uVar2 + 1;
  } while ((int)uVar1 < 0);
  return uVar1;
}



/* Function: FUN_004369f6 */

int FUN_004369f6(LPCWSTR param_1,uint *param_2)

{
  int iVar1;
  uint uVar2;
  LPCWSTR pWVar3;
  DWORD DVar4;
  int local_14;
  HKEY local_10;
  LPVOID local_c;
  uint local_8;
  
  local_10 = (HKEY)0x0;
  local_c = (LPVOID)0x0;
  local_8 = 0;
  local_14 = 0;
  iVar1 = FUN_00436af7(param_1,param_2);
  if ((((iVar1 != 0) &&
       (uVar2 = FUN_004324d5(0x80000002,L"SYSTEM\\CurrentControlSet\\Control\\Session Manager",1,
                             &local_10), uVar2 != 0x80070002)) && (-1 < (int)uVar2)) &&
     (((uVar2 = FUN_00432757(local_10,L"PendingFileRenameOperations",(int *)&local_c,&local_8),
       uVar2 != 0x80070002 && (-1 < (int)uVar2)) && (uVar2 = 0, local_8 != 0)))) {
    do {
      pWVar3 = *(LPCWSTR *)((int)local_c + uVar2 * 4);
      if ((pWVar3 != (LPCWSTR)0x0) && (*pWVar3 != L'\0')) {
        if ((*pWVar3 == L'\\') &&
           (((pWVar3[1] == L'?' && (pWVar3[2] == L'?')) && (pWVar3[3] == L'\\')))) {
          pWVar3 = pWVar3 + 4;
        }
        DVar4 = FUN_00431437(param_1,pWVar3,&local_14);
        if ((int)DVar4 < 0) break;
        if (local_14 == 2) {
          iVar1 = 0;
          break;
        }
      }
      uVar2 = uVar2 + 2;
    } while (uVar2 < local_8);
  }
  if (local_c != (LPVOID)0x0) {
    FUN_00434413(local_c,local_8);
  }
  if (local_10 != (HKEY)0x0) {
    RegCloseKey(local_10);
  }
  return iVar1;
}



/* Function: FUN_00436af7 */

void FUN_00436af7(LPCWSTR param_1,uint *param_2)

{
  HANDLE hFindFile;
  _WIN32_FIND_DATAW local_258;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  FUN_004267c0(&local_258.dwFileAttributes,0,0x250);
  hFindFile = FindFirstFileW(param_1,&local_258);
  if (((hFindFile != (HANDLE)0xffffffff) &&
      (FindClose(hFindFile), (local_258.dwFileAttributes & 0x10) == 0)) && (param_2 != (uint *)0x0))
  {
    *param_2 = local_258.dwFileAttributes;
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00436b6a */

void FUN_00436b6a(int *param_1,SIZE_T *param_2,LPCWSTR param_3)

{
  FUN_00436b86(param_1,param_2,param_3,0,0,0xffffffff,0);
  return;
}



/* Function: FUN_00436b86 */

DWORD FUN_00436b86(int *param_1,SIZE_T *param_2,LPCWSTR param_3,DWORD param_4,uint param_5,
                  SIZE_T param_6,int param_7)

{
  HANDLE hFile;
  DWORD DVar1;
  BOOL BVar2;
  int iVar3;
  LPVOID pvVar4;
  SIZE_T SVar5;
  uint uVar6;
  uint uVar7;
  LARGE_INTEGER local_10;
  HANDLE local_8;
  
  local_10.s.LowPart = 0;
  local_10.s.HighPart = 0;
  if ((((param_2 == (SIZE_T *)0x0) || (param_1 == (int *)0x0)) || (param_3 == (LPCWSTR)0x0)) ||
     (*param_3 == L'\0')) {
    FUN_004300d9();
    return 0x80070057;
  }
  local_8 = CreateFileW(param_3,0x80000000,5,(LPSECURITY_ATTRIBUTES)0x0,3,0x8000080,(HANDLE)0x0);
  if (local_8 == (HANDLE)0xffffffff) {
    DVar1 = GetLastError();
    uVar6 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar6 = DVar1;
    }
    if (uVar6 == 0x80070002) {
      return 0x80070002;
    }
    if (DVar1 != 0) {
      if (-1 < (int)uVar6) {
        uVar6 = 0x80004005;
      }
      FUN_004300d9();
      return uVar6;
    }
  }
  hFile = local_8;
  BVar2 = GetFileSizeEx(local_8,&local_10);
  uVar6 = param_5;
  if (BVar2 == 0) {
    DVar1 = GetLastError();
    uVar6 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar6 = DVar1;
    }
    if (-1 < (int)uVar6) {
      uVar6 = 0x80004005;
    }
  }
  else {
    uVar7 = 0;
    if (param_4 != 0) {
      if ((local_10.s.HighPart < 1) &&
         ((0x7fffffff < (uint)local_10.s.HighPart || (local_10.s.LowPart < param_5)))) {
        uVar6 = 0x80070057;
        goto LAB_00436e27;
      }
      DVar1 = SetFilePointer(hFile,param_5,(PLONG)0x0,1);
      uVar7 = uVar6;
      if (DVar1 == 0xffffffff) {
        DVar1 = GetLastError();
        uVar6 = DVar1 & 0xffff | 0x80070000;
        if ((int)DVar1 < 1) {
          uVar6 = DVar1;
        }
        if ((int)uVar6 < 0) goto LAB_00436c90;
      }
    }
    SVar5 = param_6;
    if (param_7 == 0) {
      iVar3 = local_10.s.HighPart - (uint)(local_10.s.LowPart < uVar7);
      SVar5 = local_10.s.LowPart - uVar7;
      if ((-1 < iVar3) && ((0 < iVar3 || (param_6 < local_10.s.LowPart - uVar7)))) {
        uVar6 = 0x8007007a;
        goto LAB_00436c90;
      }
    }
    uVar6 = 0;
    if (*param_1 == 0) {
      if (SVar5 == 0) goto LAB_00436d0b;
      pvVar4 = (LPVOID)FUN_00431078(SVar5,1);
      if (pvVar4 != (LPVOID)0x0) goto LAB_00436d89;
      uVar6 = 0x8007000e;
    }
    else {
      if (SVar5 == 0) {
        FUN_00431137((LPVOID)*param_1);
        *param_1 = 0;
LAB_00436d0b:
        *param_2 = 0;
        goto LAB_00436e27;
      }
      pvVar4 = (LPVOID)FUN_0043120c((LPVOID)*param_1,SVar5,1);
      if (pvVar4 != (LPVOID)0x0) {
LAB_00436d89:
        param_6 = 0;
        param_3 = (LPCWSTR)0x0;
        do {
          param_4 = 0;
          uVar6 = _ULongSub_12(SVar5,param_6,(int *)&param_4);
          if ((int)uVar6 < 0) goto LAB_00436e1d;
          BVar2 = ReadFile(local_8,(LPVOID)(param_6 + (int)pvVar4),param_4,(LPDWORD)&param_3,
                           (LPOVERLAPPED)0x0);
          if (BVar2 == 0) {
            DVar1 = GetLastError();
            uVar6 = DVar1 & 0xffff | 0x80070000;
            if ((int)DVar1 < 1) {
              uVar6 = DVar1;
            }
            if (-1 < (int)uVar6) {
              uVar6 = 0x80004005;
            }
            FUN_004300d9();
            goto LAB_00436e1d;
          }
          param_6 = param_6 + (int)param_3;
        } while (param_3 != (LPCWSTR)0x0);
        if (param_6 == SVar5) {
          *param_1 = (int)pvVar4;
          pvVar4 = (LPVOID)0x0;
          *param_2 = SVar5;
        }
        else {
          uVar6 = 0x8000ffff;
        }
LAB_00436e1d:
        if (pvVar4 != (LPVOID)0x0) {
          FUN_00431137(pvVar4);
        }
        goto LAB_00436e27;
      }
      uVar6 = 0x8007000e;
    }
  }
LAB_00436c90:
  FUN_004300d9();
LAB_00436e27:
  if (local_8 != (HANDLE)0xffffffff) {
    CloseHandle(local_8);
  }
  return uVar6;
}



/* Function: FUN_00436e3f */

uint FUN_00436e3f(LPCWSTR param_1)

{
  uint uVar1;
  LPCWSTR pWVar2;
  uint uVar3;
  uint uVar4;
  int local_18;
  int local_14;
  HKEY local_10;
  uint local_c;
  short *local_8;
  
  uVar4 = 0;
  local_10 = (HKEY)0x0;
  local_8 = (short *)0x0;
  local_c = 0;
  local_18 = 0;
  local_14 = 0;
  uVar1 = FUN_004324d5(0x80000002,L"SYSTEM\\CurrentControlSet\\Control\\Session Manager",3,&local_10
                      );
  if (uVar1 != 0x80070002) {
    if ((int)uVar1 < 0) goto LAB_00436f87;
    uVar1 = FUN_00432757(local_10,L"PendingFileRenameOperations",(int *)&local_8,&local_c);
    if (uVar1 != 0x80070002) {
      if ((-1 < (int)uVar1) && (uVar3 = 0, local_c != 0)) {
        do {
          pWVar2 = *(LPCWSTR *)(local_8 + uVar3 * 2);
          if ((pWVar2 != (LPCWSTR)0x0) && (*pWVar2 != L'\0')) {
            if ((((*pWVar2 == L'\\') && (pWVar2[1] == L'?')) && (pWVar2[2] == L'?')) &&
               (pWVar2[3] == L'\\')) {
              pWVar2 = pWVar2 + 4;
            }
            uVar1 = FUN_00431437(param_1,pWVar2,&local_18);
            if ((int)uVar1 < 0) goto LAB_00436f87;
            if (local_18 == 2) {
              if (*(int *)(local_8 + uVar3 * 2) != 0) {
                FUN_004380ab(*(LPVOID *)(local_8 + uVar3 * 2));
                (local_8 + uVar3 * 2)[0] = 0;
                (local_8 + uVar3 * 2)[1] = 0;
              }
              if (*(LPVOID *)(local_8 + uVar3 * 2 + 2) != (LPVOID)0x0) {
                FUN_004380ab(*(LPVOID *)(local_8 + uVar3 * 2 + 2));
                (local_8 + uVar3 * 2 + 2)[0] = 0;
                (local_8 + uVar3 * 2 + 2)[1] = 0;
              }
              local_14 = 1;
            }
          }
          uVar3 = uVar3 + 2;
        } while (uVar3 < local_c);
        if (local_14 != 0) {
          uVar1 = 0;
          if (local_c != 0) {
            do {
              if (*(int *)(local_8 + uVar1 * 2) != 0) {
                *(int *)(local_8 + uVar4 * 2) = *(int *)(local_8 + uVar1 * 2);
                uVar4 = uVar4 + 1;
              }
              uVar1 = uVar1 + 1;
            } while (uVar1 < local_c);
          }
          local_c = uVar4;
          uVar1 = FUN_00432abe(local_10,L"PendingFileRenameOperations",local_8,uVar4);
        }
      }
      goto LAB_00436f87;
    }
  }
  uVar1 = 0;
LAB_00436f87:
  if (local_8 != (short *)0x0) {
    FUN_00434413(local_8,local_c);
  }
  if (local_10 != (HKEY)0x0) {
    RegCloseKey(local_10);
  }
  return uVar1;
}



/* Function: FUN_00436faf */

DWORD FUN_00436faf(HANDLE param_1,undefined4 param_2,undefined4 param_3,undefined4 *param_4,
                  PLARGE_INTEGER param_5)

{
  LARGE_INTEGER liDistanceToMove;
  BOOL BVar1;
  DWORD DVar2;
  DWORD unaff_ESI;
  uint uVar3;
  undefined4 local_c;
  undefined4 local_8;
  
  uVar3 = 0;
  liDistanceToMove.s.HighPart = (LONG)&local_c;
  liDistanceToMove.s.LowPart = param_3;
  BVar1 = SetFilePointerEx(param_1,liDistanceToMove,param_5,unaff_ESI);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
  }
  else if (param_4 != (undefined4 *)0x0) {
    *param_4 = local_c;
    param_4[1] = local_8;
  }
  return uVar3;
}



/* Function: FUN_0043701a */

DWORD FUN_0043701a(LPCWSTR param_1,DWORD *param_2)

{
  HANDLE hObject;
  DWORD DVar1;
  uint uVar2;
  
  if (param_1 == (LPCWSTR)0x0) {
    uVar2 = 0x80070057;
    FUN_004300d9();
  }
  else {
    hObject = CreateFileW(param_1,0x80,1,(LPSECURITY_ATTRIBUTES)0x0,3,0x80,(HANDLE)0x0);
    if (hObject == (HANDLE)0xffffffff) {
      DVar1 = GetLastError();
      uVar2 = DVar1 & 0xffff | 0x80070000;
      if ((int)DVar1 < 1) {
        uVar2 = DVar1;
      }
      if (-1 < (int)uVar2) {
        uVar2 = 0x80004005;
      }
      FUN_004300d9();
    }
    else {
      uVar2 = FUN_004370a5(hObject,param_2);
      CloseHandle(hObject);
    }
  }
  return uVar2;
}



/* Function: FUN_004370a5 */

DWORD FUN_004370a5(HANDLE param_1,DWORD *param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  LARGE_INTEGER local_c;
  
  uVar3 = 0;
  *param_2 = 0;
  param_2[1] = 0;
  BVar1 = GetFileSizeEx(param_1,&local_c);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
  }
  else {
    *param_2 = local_c.s.LowPart;
    param_2[1] = local_c.s.HighPart;
  }
  return uVar3;
}



/* Function: FUN_0043710a */

DWORD FUN_0043710a(LPCWSTR param_1,undefined4 *param_2,undefined4 *param_3)

{
  DWORD DVar1;
  DWORD DVar2;
  HGLOBAL lpData;
  BOOL BVar3;
  uint uVar4;
  uint local_10;
  LPVOID local_c;
  DWORD local_8;
  
  uVar4 = 0;
  local_8 = 0;
  local_c = (LPVOID)0x0;
  local_10 = 0;
  DVar1 = GetFileVersionInfoSizeW(param_1,&local_8);
  if (DVar1 == 0) {
    DVar2 = GetLastError();
    uVar4 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar4 = DVar2;
    }
    if ((int)uVar4 < 0) goto LAB_00437150;
  }
  lpData = GlobalAlloc(0,DVar1);
  if (lpData == (HGLOBAL)0x0) {
    uVar4 = 0x8007000e;
LAB_00437150:
    FUN_004300d9();
    return uVar4;
  }
  BVar3 = GetFileVersionInfoW(param_1,local_8,DVar1,lpData);
  if (BVar3 == 0) {
    DVar1 = GetLastError();
    uVar4 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar4 = DVar1;
    }
    if (-1 < (int)uVar4) goto LAB_004371ab;
LAB_004371e0:
    FUN_004300d9();
  }
  else {
LAB_004371ab:
    BVar3 = VerQueryValueW(lpData,L"\\",&local_c,&local_10);
    if (BVar3 == 0) {
      DVar1 = GetLastError();
      uVar4 = DVar1 & 0xffff | 0x80070000;
      if ((int)DVar1 < 1) {
        uVar4 = DVar1;
      }
      if ((int)uVar4 < 0) goto LAB_004371e0;
    }
    *param_2 = *(undefined4 *)((int)local_c + 8);
    *param_3 = *(undefined4 *)((int)local_c + 0xc);
  }
  GlobalFree(lpData);
  return uVar4;
}



/* Function: FUN_0043720f */

int FUN_0043720f(LPCWSTR param_1,uint param_2,uint *param_3)

{
  LPCWSTR pWVar1;
  int iVar2;
  LPCWSTR lpString;
  LPCWSTR pWVar3;
  longlong lVar4;
  undefined8 local_14;
  uint local_c;
  undefined4 local_8;
  
  lpString = param_1;
  param_1 = (LPCWSTR)0x0;
  local_8 = 0;
  local_14 = 0;
  if ((param_2 != 0) || (param_2 = lstrlenW(lpString), param_2 != 0)) {
    local_c = local_14._4_4_;
    pWVar1 = lpString + param_2;
    param_2 = (uint)local_14;
    pWVar3 = lpString;
    do {
      for (; (pWVar3 < pWVar1 && (*pWVar3 != L'.')); pWVar3 = pWVar3 + 1) {
      }
      if (lpString == pWVar3) {
        return -0x7ff8ffa9;
      }
      iVar2 = FUN_004332b9((int)pWVar3 - (int)lpString >> 1,(int *)((int)&local_14 + 4));
      if (iVar2 < 0) {
        return iVar2;
      }
      iVar2 = FUN_004346a1(lpString,local_14._4_4_,(undefined2 *)&local_8);
      if (iVar2 < 0) {
        return iVar2;
      }
      lVar4 = __allshl(('\x03' - (char)param_1) * '\x10',0);
      param_2 = param_2 | (uint)lVar4;
      local_c = local_c | (uint)((ulonglong)lVar4 >> 0x20);
      if (pWVar1 <= pWVar3) {
        *param_3 = param_2;
        param_3[1] = local_c;
        return iVar2;
      }
      lpString = pWVar3 + 1;
      param_1 = (LPCWSTR)((int)param_1 + 1);
      pWVar3 = lpString;
    } while (param_1 < (LPCWSTR)0x4);
  }
  return -0x7ff8ffa9;
}



/* Function: FUN_004372e6 */

void FUN_004372e6(undefined4 param_1,undefined4 param_2,int *param_3)

{
  FUN_00433cea(param_3,L"%u.%u.%u.%u");
  return;
}



/* Function: FUN_0043731c */

DWORD FUN_0043731c(LPCWSTR param_1,DWORD param_2,int param_3,uint param_4,undefined4 *param_5)

{
  HANDLE hObject;
  DWORD DVar1;
  uint uVar2;
  
  hObject = CreateFileW(param_1,0x40000000,1,(LPSECURITY_ATTRIBUTES)0x0,2,param_2,(HANDLE)0x0);
  if (hObject == (HANDLE)0xffffffff) {
    DVar1 = GetLastError();
    uVar2 = DVar1 & 0xffff | 0x80070000;
    if ((int)DVar1 < 1) {
      uVar2 = DVar1;
    }
    if (-1 < (int)uVar2) {
      uVar2 = 0x80004005;
    }
    FUN_004300d9();
  }
  else {
    uVar2 = FUN_004373a3(hObject,param_3,param_4);
    if ((-1 < (int)uVar2) && (param_5 != (undefined4 *)0x0)) {
      *param_5 = hObject;
      hObject = (HANDLE)0xffffffff;
    }
    if (hObject != (HANDLE)0xffffffff) {
      CloseHandle(hObject);
    }
  }
  return uVar2;
}



/* Function: FUN_004373a3 */

DWORD FUN_004373a3(HANDLE param_1,int param_2,uint param_3)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  uint uVar4;
  DWORD local_8;
  
  uVar3 = 0;
  local_8 = 0;
  uVar4 = 0;
  do {
    BVar1 = WriteFile(param_1,(LPCVOID)(uVar4 + param_2),param_3 - uVar4,&local_8,(LPOVERLAPPED)0x0)
    ;
    if (BVar1 == 0) {
      DVar2 = GetLastError();
      uVar3 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar3 = DVar2;
      }
      if ((int)uVar3 < 0) {
        FUN_004300d9();
        return uVar3;
      }
    }
    uVar4 = uVar4 + local_8;
    if (param_3 <= uVar4) {
      return uVar3;
    }
  } while( true );
}



/* Function: FUN_0043740c */

void FUN_0043740c(LPCWSTR param_1,uint param_2)

{
  uint uVar1;
  uint uVar2;
  DWORD DVar3;
  DWORD DVar4;
  BOOL BVar5;
  int iVar6;
  UINT UVar7;
  uint uVar8;
  WCHAR *lpExistingFileName;
  HANDLE local_67c;
  LPCWSTR local_66c;
  _WIN32_FIND_DATAW local_668;
  WCHAR local_418 [260];
  WCHAR local_210 [260];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_67c = (HANDLE)0xffffffff;
  uVar1 = param_2 >> 1 & 1;
  uVar2 = param_2 >> 2 & 1;
  local_66c = (LPCWSTR)0x0;
  FUN_004267c0((uint *)local_418,0,0x208);
  FUN_004267c0((uint *)local_210,0,0x208);
  DVar3 = GetFileAttributesW(param_1);
  if (DVar3 == 0xffffffff) {
    DVar4 = GetLastError();
    if (DVar4 == 2) {
      DVar4 = 3;
    }
    uVar8 = DVar4 & 0xffff | 0x80070000;
    if ((int)DVar4 < 1) {
      uVar8 = DVar4;
    }
    if (-1 < (int)uVar8) goto LAB_004374cd;
    goto LAB_004374be;
  }
LAB_004374cd:
  if ((DVar3 & 0x10) == 0) {
LAB_00437817:
    if (local_67c != (HANDLE)0xffffffff) {
      FindClose(local_67c);
    }
  }
  else {
    if (((DVar3 & 1) == 0) || (BVar5 = SetFileAttributesW(param_1,0x80), BVar5 != 0)) {
      if (((param_2 & 1) == 0) && (uVar1 == 0)) {
LAB_00437723:
        BVar5 = RemoveDirectoryW(param_1);
        if (BVar5 != 0) goto LAB_00437817;
        DVar3 = GetLastError();
        uVar1 = DVar3 & 0xffff | 0x80070000;
        if ((int)DVar3 < 1) {
          uVar1 = DVar3;
        }
        if (uVar1 == 0x80070020) {
          if ((uVar2 != 0) && (BVar5 = MoveFileExW(param_1,(LPCWSTR)0x0,4), BVar5 != 0)) {
            uVar1 = 0;
            goto LAB_0043776a;
          }
        }
        else {
LAB_0043776a:
          if (-1 < (int)uVar1) goto LAB_00437817;
        }
LAB_00437778:
        FUN_004300d9();
        goto LAB_00437817;
      }
      if ((uVar2 == 0) || (DVar3 = GetTempPathW(0x104,local_418), DVar3 != 0)) {
        iVar6 = FUN_004314a9(param_1,L"*.*",(int *)&local_66c);
        if (iVar6 < 0) goto LAB_00437829;
        local_67c = FindFirstFileW(local_66c,&local_668);
        if (local_67c != (HANDLE)0xffffffff) {
          do {
            if ((local_668.cFileName[0] != L'.') ||
               ((local_668.cFileName[1] != L'\0' &&
                ((local_668.cFileName[1] != L'.' || (local_668.cFileName[2] != L'\0')))))) {
              local_668.cFileName[0x103] = L'\0';
              iVar6 = FUN_004314a9(param_1,local_668.cFileName,(int *)&local_66c);
              if (iVar6 < 0) goto LAB_00437817;
              if ((uVar1 == 0) || (((byte)local_668.dwFileAttributes & 0x10) == 0)) {
                if ((param_2 & 1) != 0) {
                  if ((((byte)local_668.dwFileAttributes & 7) != 0) &&
                     (BVar5 = SetFileAttributesW(local_66c,0x80), BVar5 == 0)) {
                    GetLastError();
                    goto LAB_00437778;
                  }
                  BVar5 = DeleteFileW(local_66c);
                  if (BVar5 == 0) {
                    if (uVar2 == 0) {
                      GetLastError();
                      goto LAB_00437778;
                    }
                    UVar7 = GetTempFileNameW(local_418,L"DEL",0,local_210);
                    if (UVar7 == 0) {
                      GetLastError();
                      goto LAB_00437778;
                    }
                    BVar5 = MoveFileExW(local_66c,local_210,1);
                    lpExistingFileName = local_66c;
                    if (BVar5 != 0) {
                      lpExistingFileName = local_210;
                    }
                    MoveFileExW(lpExistingFileName,(LPCWSTR)0x0,4);
                  }
                }
              }
              else {
                iVar6 = FUN_0043124a((int *)&local_66c);
                if (iVar6 < 0) goto LAB_00437817;
                FUN_0043740c(local_66c,param_2);
              }
            }
            BVar5 = FindNextFileW(local_67c,&local_668);
          } while (BVar5 != 0);
          DVar3 = GetLastError();
          if (DVar3 == 0x12) goto LAB_00437723;
          GetLastError();
          goto LAB_00437778;
        }
        GetLastError();
      }
      else {
        GetLastError();
      }
    }
    else {
      GetLastError();
    }
LAB_004374be:
    FUN_004300d9();
  }
LAB_00437829:
  if (local_66c != (LPCWSTR)0x0) {
    FUN_004380ab(local_66c);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00437850 */

DWORD FUN_00437850(LPCWSTR param_1,LPSECURITY_ATTRIBUTES param_2)

{
  WCHAR WVar1;
  BOOL BVar2;
  int iVar3;
  WCHAR *pWVar4;
  WCHAR *pWVar5;
  DWORD DVar6;
  
  DVar6 = 0;
  BVar2 = CreateDirectoryW(param_1,param_2);
  if (BVar2 == 0) {
    DVar6 = GetLastError();
    if ((DVar6 == 0xb7) ||
       ((DVar6 != 3 && (iVar3 = FUN_0043791e(param_1,(DWORD *)0x0), iVar3 != 0)))) {
      DVar6 = 0;
    }
    else {
      WVar1 = *param_1;
      pWVar5 = (WCHAR *)0x0;
      pWVar4 = param_1;
      if (WVar1 != L'\0') {
        do {
          if (WVar1 == L'\\') {
            pWVar5 = pWVar4;
          }
          WVar1 = pWVar4[1];
          pWVar4 = pWVar4 + 1;
        } while (WVar1 != L'\0');
        if (pWVar5 != (WCHAR *)0x0) {
          *pWVar5 = L'\0';
          DVar6 = FUN_00437850(param_1,param_2);
          *pWVar5 = L'\\';
          if ((int)DVar6 < 0) {
            return DVar6;
          }
          BVar2 = CreateDirectoryW(param_1,param_2);
          if (BVar2 != 0) {
            return 0;
          }
          DVar6 = GetLastError();
          if (DVar6 == 0xb7) {
            return 1;
          }
          if (0 < (int)DVar6) {
            return DVar6 & 0xffff | 0x80070000;
          }
          return DVar6;
        }
      }
      DVar6 = 0x80070003;
      FUN_004300d9();
    }
  }
  return DVar6;
}



/* Function: FUN_0043791e */

undefined4 FUN_0043791e(LPCWSTR param_1,DWORD *param_2)

{
  DWORD DVar1;
  undefined4 uVar2;
  
  uVar2 = 0;
  DVar1 = GetFileAttributesW(param_1);
  if ((DVar1 != 0xffffffff) && ((DVar1 & 0x10) != 0)) {
    if (param_2 != (DWORD *)0x0) {
      *param_2 = DVar1;
    }
    uVar2 = 1;
  }
  return uVar2;
}



/* Function: FUN_00437949 */

DWORD FUN_00437949(int *param_1)

{
  DWORD DVar1;
  LPWSTR lpBuffer;
  DWORD DVar2;
  uint uVar3;
  uint local_8;
  
  lpBuffer = (LPWSTR)0x0;
  DVar2 = 0;
  local_8 = 0;
  if ((param_1 != (int *)0x0) && (*param_1 != 0)) {
    DVar2 = FUN_0043452e((LPCVOID)*param_1,&local_8);
    if ((int)DVar2 < 0) {
      return DVar2;
    }
    if (local_8 != 0) {
      lpBuffer = (LPWSTR)*param_1;
    }
  }
  DVar1 = GetCurrentDirectoryW(local_8,lpBuffer);
  if (DVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
  }
  else {
    if (DVar1 <= local_8) {
      return DVar2;
    }
    DVar2 = FUN_00433bdf(param_1,DVar1);
    if ((int)DVar2 < 0) {
      return DVar2;
    }
    DVar1 = GetCurrentDirectoryW(DVar1,(LPWSTR)*param_1);
    if (DVar1 != 0) {
      return DVar2;
    }
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
  }
  FUN_004300d9();
  return uVar3;
}



/* Function: FUN_00437a0c */

int FUN_00437a0c(int *param_1,LPCWSTR param_2,uint *param_3)

{
  PCNZWCH lpString2;
  int iVar1;
  uint uVar2;
  int iVar3;
  uint local_8;
  
  local_8 = 0;
  if ((uint)param_1[2] < 0xc) {
    iVar3 = FUN_00437d07((int)param_1,*(uint *)(&DAT_0045348c + param_1[2] * 4),param_2,&local_8);
    uVar2 = local_8;
    if (-1 < iVar3) {
      do {
        lpString2 = (PCNZWCH)FUN_00437d7c((int)param_1,*(int *)(param_1[5] + uVar2 * 4));
        if (*param_1 == 1) {
          lpString2 = *(PCNZWCH *)((int)lpString2 + param_1[4]);
        }
        iVar1 = CompareStringW(0x7f,(uint)((*(byte *)(param_1 + 1) & 1) != 0),param_2,-1,lpString2,
                               -1);
        if (iVar1 == 2) {
          *param_3 = uVar2;
          return iVar3;
        }
        uVar2 = uVar2 + 1 & -(uint)(uVar2 + 1 < *(uint *)(&DAT_0045348c + param_1[2] * 4));
      } while ((*(int *)(param_1[5] + uVar2 * 4) != 0) && (uVar2 != local_8));
      iVar3 = -0x7ff8fb70;
    }
  }
  else {
    iVar3 = -0x7ff8ffa9;
  }
  return iVar3;
}



/* Function: FUN_00437ab9 */

int FUN_00437ab9(int param_1,uint param_2,int param_3,LPCWSTR param_4,uint *param_5)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  uint local_8;
  
  local_8 = 0;
  iVar2 = FUN_00437d07(param_1,param_2,param_4,&local_8);
  if (-1 < iVar2) {
    iVar1 = *(int *)(param_3 + local_8 * 4);
    uVar3 = local_8;
    while (iVar1 != 0) {
      uVar3 = uVar3 + 1 & -(uint)(uVar3 + 1 < param_2);
      if (uVar3 == local_8) {
        FUN_004300d9();
        return -0x7ff8ef26;
      }
      iVar1 = *(int *)(param_3 + uVar3 * 4);
    }
    *param_5 = uVar3;
  }
  return iVar2;
}



/* Function: FUN_00437b1f */

int FUN_00437b1f(int *param_1,LPCWSTR param_2,int *param_3)

{
  int iVar1;
  int iVar2;
  uint local_c;
  uint local_8;
  
  local_8 = 0;
  local_c = 0;
  if ((param_1 == (int *)0x0) || (param_2 == (LPCWSTR)0x0)) {
    iVar2 = -0x7ff8ffa9;
    FUN_004300d9();
  }
  else if ((uint)param_1[2] < 0xc) {
    iVar2 = FUN_00437d07((int)param_1,*(uint *)(&DAT_0045348c + param_1[2] * 4),param_2,&local_8);
    if (-1 < iVar2) {
      iVar2 = FUN_00437d7c((int)param_1,*(int *)(param_1[5] + local_8 * 4));
      if (iVar2 == 0) {
        if (param_3 != (int *)0x0) {
          *param_3 = 0;
        }
        iVar2 = -0x7ff8fb70;
      }
      else {
        iVar2 = FUN_00437a0c(param_1,param_2,&local_c);
        if (iVar2 != -0x7ff8fb70) {
          if (iVar2 < 0) goto LAB_00437be5;
          if (param_3 != (int *)0x0) {
            iVar1 = FUN_00437d7c((int)param_1,*(int *)(param_1[5] + local_c * 4));
            *param_3 = iVar1;
          }
        }
        if (-1 < iVar2) {
          return iVar2;
        }
      }
    }
  }
  else {
    iVar2 = -0x7ff8ffa9;
  }
LAB_00437be5:
  if (param_3 != (int *)0x0) {
    *param_3 = 0;
  }
  return iVar2;
}



/* Function: FUN_00437bf5 */

int FUN_00437bf5(int *param_1)

{
  int iVar1;
  int *piVar2;
  uint uVar3;
  LPVOID pvVar4;
  LPCWSTR pWVar5;
  int iVar6;
  uint local_c;
  SIZE_T local_8;
  
  piVar2 = param_1;
  local_c = 0;
  local_8 = 0;
  uVar3 = param_1[2] + 1;
  if (uVar3 < 0xc) {
    iVar6 = FUN_0043026c(*(uint *)(&DAT_0045348c + uVar3 * 4) << 2,
                         *(uint *)(&DAT_0045348c + uVar3 * 4) >> 0x1e,&local_8);
    if (-1 < iVar6) {
      pvVar4 = (LPVOID)FUN_00431078(local_8,1);
      if (pvVar4 == (LPVOID)0x0) {
        iVar6 = -0x7ff8fff2;
        FUN_004300d9();
      }
      else {
        param_1 = (int *)0x0;
        if (piVar2[3] != 0) {
          do {
            pWVar5 = (LPCWSTR)FUN_00437d7c((int)piVar2,*(int *)(piVar2[6] + (int)param_1 * 4));
            if (*piVar2 == 1) {
              pWVar5 = *(LPCWSTR *)((int)pWVar5 + piVar2[4]);
            }
            if (pWVar5 == (LPCWSTR)0x0) {
              iVar6 = -0x7ff8ffa9;
              FUN_004300d9();
              goto LAB_00437cdd;
            }
            iVar6 = FUN_00437ab9((int)piVar2,*(uint *)(&DAT_0045348c + uVar3 * 4),(int)pvVar4,pWVar5
                                 ,&local_c);
            if (iVar6 < 0) goto LAB_00437cdd;
            iVar1 = (int)param_1 * 4;
            param_1 = (int *)((int)param_1 + 1);
            *(undefined4 *)((int)pvVar4 + local_c * 4) = *(undefined4 *)(piVar2[6] + iVar1);
          } while (param_1 < (int *)piVar2[3]);
        }
        piVar2[2] = uVar3;
        if (piVar2[5] != 0) {
          FUN_00431137((LPVOID)piVar2[5]);
        }
        piVar2[5] = (int)pvVar4;
        pvVar4 = (LPVOID)0x0;
LAB_00437cdd:
        if (pvVar4 != (LPVOID)0x0) {
          FUN_00431137(pvVar4);
        }
      }
    }
  }
  else {
    iVar6 = -0x7ff8ef26;
  }
  return iVar6;
}



/* Function: FUN_00437d07 */

int FUN_00437d07(int param_1,uint param_2,LPCWSTR param_3,uint *param_4)

{
  uint uVar1;
  LPCWSTR pWVar2;
  int iVar3;
  LPCWSTR local_8;
  
  iVar3 = 0;
  local_8 = (LPCWSTR)0x0;
  uVar1 = 0;
  pWVar2 = (LPCWSTR)0x0;
  if (((*(byte *)(param_1 + 4) & 1) == 0) ||
     (iVar3 = FUN_0043413e((int *)&local_8,param_3,0), param_3 = local_8, pWVar2 = local_8,
     -1 < iVar3)) {
    for (; *param_3 != L'\0'; param_3 = param_3 + 1) {
      uVar1 = uVar1 * 0x1003f + ~((uint)(ushort)*param_3 * 0x1fd);
    }
    *param_4 = uVar1 % param_2;
  }
  if (pWVar2 != (LPCWSTR)0x0) {
    FUN_004380ab(pWVar2);
  }
  return iVar3;
}



/* Function: FUN_00437d7c */

int FUN_00437d7c(int param_1,int param_2)

{
  if (param_2 == 0) {
    param_2 = 0;
  }
  else if (*(int **)(param_1 + 0x1c) != (int *)0x0) {
    param_2 = **(int **)(param_1 + 0x1c) + -1 + param_2;
  }
  return param_2;
}



/* Function: FUN_00437da1 */

int FUN_00437da1(int *param_1,LPCWSTR param_2)

{
  int iVar1;
  int iVar2;
  uint local_8;
  
  local_8 = 0;
  if ((param_1 == (int *)0x0) || (param_2 == (LPCWSTR)0x0)) {
    iVar2 = -0x7ff8ffa9;
    FUN_004300d9();
  }
  else if (((uint)param_1[2] < 0xc) && (*param_1 == 2)) {
    if (*(uint *)(&DAT_0045348c + param_1[2] * 4) >> 3 <= param_1[3] + 1U) {
      iVar2 = FUN_00437bf5(param_1);
      if (iVar2 == -0x7ff8ef26) {
        if (*(uint *)(&DAT_0045348c + param_1[2] * 4) <= (uint)param_1[3]) {
          return -0x7ff8ef26;
        }
        iVar2 = 0;
      }
      if (iVar2 < 0) {
        return iVar2;
      }
    }
    iVar2 = FUN_00437ab9((int)param_1,*(uint *)(&DAT_0045348c + param_1[2] * 4),param_1[5],param_2,
                         &local_8);
    if ((-1 < iVar2) && (iVar2 = FUN_0043109a(param_1 + 6,param_1[3] + 1,4,1000), -1 < iVar2)) {
      param_1[3] = param_1[3] + 1;
      iVar1 = local_8 * 4;
      iVar2 = FUN_00433f88((int *)(param_1[5] + iVar1),param_2,0);
      if (-1 < iVar2) {
        *(undefined4 *)(param_1[6] + -4 + param_1[3] * 4) = *(undefined4 *)(iVar1 + param_1[5]);
      }
    }
  }
  else {
    iVar2 = -0x7ff8ffa9;
  }
  return iVar2;
}



/* Function: FUN_00437ea7 */

int FUN_00437ea7(int *param_1,int param_2,uint param_3)

{
  int iVar1;
  uint uVar2;
  
  uVar2 = 0;
  if (param_3 != 0) {
    do {
      iVar1 = FUN_0043805f(param_1,*(LPCWSTR *)(param_2 + uVar2 * 4));
      if (iVar1 != -0x7ff8fb70) {
        if (iVar1 < 0) {
          return iVar1;
        }
        return 0;
      }
      uVar2 = uVar2 + 1;
    } while (uVar2 < param_3);
  }
  return -0x7ff8fb6f;
}



/* Function: FUN_00437ee1 */

undefined4 FUN_00437ee1(undefined4 *param_1,int param_2,undefined4 param_3)

{
  undefined4 *puVar1;
  uint uVar2;
  int iVar3;
  undefined4 uVar4;
  
  if (param_1 == (undefined4 *)0x0) {
    uVar4 = 0x80070057;
    FUN_004300d9();
  }
  else {
    puVar1 = (undefined4 *)FUN_00431078(0x20,0);
    *param_1 = puVar1;
    if (puVar1 != (undefined4 *)0x0) {
      *puVar1 = 2;
      puVar1[1] = param_3;
      puVar1[4] = 0;
      puVar1[2] = 0;
      puVar1[3] = 0;
      puVar1[6] = 0;
      puVar1[7] = 0;
      do {
        if ((uint)(param_2 << 3) <= *(uint *)(&DAT_0045348c + puVar1[2] * 4)) break;
        uVar2 = puVar1[2] + 1;
        puVar1[2] = uVar2;
      } while (uVar2 < 0xb);
      iVar3 = FUN_00431078(*(int *)(&DAT_0045348c + puVar1[2] * 4) << 2,1);
      puVar1[5] = iVar3;
      if (iVar3 != 0) {
        return 0;
      }
    }
    uVar4 = 0x8007000e;
    FUN_004300d9();
  }
  return uVar4;
}



/* Function: FUN_00437f99 */

int FUN_00437f99(undefined4 *param_1,int param_2,uint param_3,undefined4 param_4)

{
  LPCWSTR pWVar1;
  int iVar2;
  uint uVar3;
  int *piVar4;
  int *local_8;
  
  local_8 = (int *)0x0;
  iVar2 = FUN_00437ee1(&local_8,param_3,param_4);
  piVar4 = local_8;
  if (-1 < iVar2) {
    uVar3 = 0;
    if (param_3 != 0) {
      do {
        pWVar1 = *(LPCWSTR *)(param_2 + uVar3 * 4);
        iVar2 = FUN_0043805f(piVar4,pWVar1);
        if (iVar2 == -0x7ff8fb70) {
          iVar2 = FUN_00437da1(piVar4,pWVar1);
        }
        if (iVar2 < 0) goto LAB_00437ff9;
        uVar3 = uVar3 + 1;
      } while (uVar3 < param_3);
    }
    *param_1 = piVar4;
    piVar4 = (int *)0x0;
  }
LAB_00437ff9:
  if (piVar4 != (int *)0x0) {
    FUN_0043800c(piVar4);
  }
  return iVar2;
}



/* Function: FUN_0043800c */

void FUN_0043800c(int *param_1)

{
  uint uVar1;
  
  if ((*param_1 == 2) && (uVar1 = 0, param_1[3] != 0)) {
    do {
      if (*(int *)(param_1[6] + uVar1 * 4) != 0) {
        FUN_004380ab(*(LPVOID *)(param_1[6] + uVar1 * 4));
      }
      uVar1 = uVar1 + 1;
    } while (uVar1 < (uint)param_1[3]);
  }
  if (param_1[6] != 0) {
    FUN_00431137((LPVOID)param_1[6]);
  }
  if (param_1[5] != 0) {
    FUN_00431137((LPVOID)param_1[5]);
  }
  FUN_00431137(param_1);
  return;
}



/* Function: FUN_0043805f */

int FUN_0043805f(int *param_1,LPCWSTR param_2)

{
  int iVar1;
  
  if ((param_1 == (int *)0x0) || (param_2 == (LPCWSTR)0x0)) {
    iVar1 = -0x7ff8ffa9;
    FUN_004300d9();
  }
  else {
    iVar1 = FUN_00437b1f(param_1,param_2,(int *)0x0);
  }
  return iVar1;
}



/* Function: FUN_004380ab */

void FUN_004380ab(LPVOID param_1)

{
  FUN_00431137(param_1);
  return;
}



/* Function: FUN_004380b4 */

DWORD FUN_004380b4(LPCWSTR param_1,SE_OBJECT_TYPE param_2,SECURITY_INFORMATION param_3,PSID param_4,
                  PSID param_5,PACL param_6,PACL param_7,uint param_8,DWORD param_9)

{
  uint uVar1;
  DWORD DVar2;
  uint uVar3;
  LPWSTR local_8;
  
  uVar3 = 0;
  local_8 = (LPWSTR)0x0;
  uVar1 = FUN_00433f88((int *)&local_8,param_1,0);
  if (-1 < (int)uVar1) {
    uVar1 = 0x80004005;
    do {
      if (param_8 < uVar3) break;
      if (uVar3 != 0) {
        Sleep(param_9);
      }
      DVar2 = SetNamedSecurityInfoW(local_8,param_2,param_3,param_4,param_5,param_6,param_7);
      uVar1 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar1 = DVar2;
      }
      uVar3 = uVar3 + 1;
    } while ((int)uVar1 < 0);
    if ((int)uVar1 < 0) {
      FUN_004300d9();
    }
  }
  if (local_8 != (LPWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00438141 */

DWORD FUN_00438141(PCCERT_CONTEXT param_1,DWORD param_2,undefined4 *param_3,SIZE_T *param_4)

{
  BOOL BVar1;
  DWORD DVar2;
  void *pvData;
  uint uVar3;
  DWORD local_8;
  
  uVar3 = 0;
  local_8 = 0;
  BVar1 = CertGetCertificateContextProperty(param_1,param_2,(void *)0x0,&local_8);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
  }
  else {
    pvData = (void *)FUN_00431078(local_8,1);
    if (pvData == (void *)0x0) {
      uVar3 = 0x8007000e;
      FUN_004300d9();
    }
    else {
      BVar1 = CertGetCertificateContextProperty(param_1,param_2,pvData,&local_8);
      if (BVar1 == 0) {
        DVar2 = GetLastError();
        uVar3 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar3 = DVar2;
        }
        if (-1 < (int)uVar3) {
          uVar3 = 0x80004005;
        }
        FUN_004300d9();
      }
      else {
        *param_3 = pvData;
        pvData = (LPVOID)0x0;
        if (param_4 == (SIZE_T *)0x0) {
          return 0;
        }
        *param_4 = local_8;
      }
      if (pvData != (LPVOID)0x0) {
        FUN_00431137(pvData);
      }
    }
  }
  return uVar3;
}



/* Function: FUN_0043821c */

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_0043821c(HANDLE param_1,DWORD param_2,ALG_ID param_3,BYTE *param_4,undefined4 param_5,
                 uint param_6)

{
  uint uVar1;
  BOOL BVar2;
  DWORD unaff_EDI;
  DWORD local_1014;
  HCRYPTPROV local_1010;
  HCRYPTHASH local_100c;
  uint local_1008 [1024];
  uint local_8;
  
  uVar1 = param_6;
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_1010 = 0;
  local_100c = 0;
  local_1014 = 0;
  FUN_004267c0(local_1008,0,0x1000);
  BVar2 = CryptAcquireContextW(&local_1010,(LPCWSTR)0x0,(LPCWSTR)0x0,param_2,0xf0000040);
  if (BVar2 == 0) {
    GetLastError();
  }
  else {
    BVar2 = CryptCreateHash(local_1010,param_3,0,0,&local_100c);
    if (BVar2 == 0) {
      GetLastError();
    }
    else {
      do {
        BVar2 = ReadFile(param_1,local_1008,0x1000,&local_1014,(LPOVERLAPPED)0x0);
        if (BVar2 == 0) {
          GetLastError();
          goto LAB_0043836b;
        }
        if (local_1014 == 0) {
          BVar2 = CryptGetHashParam(local_100c,2,param_4,&param_5,0);
          if (BVar2 == 0) {
            GetLastError();
            goto LAB_0043836b;
          }
          if ((uVar1 == 0) ||
             (BVar2 = SetFilePointerEx(param_1,(LARGE_INTEGER)((ulonglong)uVar1 << 0x20),
                                       (PLARGE_INTEGER)0x1,unaff_EDI), BVar2 != 0))
          goto LAB_00438375;
          GetLastError();
          goto LAB_0043836b;
        }
        BVar2 = CryptHashData(local_100c,(BYTE *)local_1008,local_1014,0);
      } while (BVar2 != 0);
      GetLastError();
    }
  }
LAB_0043836b:
  FUN_004300d9();
LAB_00438375:
  if (local_100c != 0) {
    CryptDestroyHash(local_100c);
  }
  if (local_1010 != 0) {
    CryptReleaseContext(local_1010,0);
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00438466 */

DWORD FUN_00438466(SC_HANDLE param_1,undefined4 *param_2)

{
  BOOL BVar1;
  DWORD DVar2;
  uint uVar3;
  LPQUERY_SERVICE_CONFIGW lpServiceConfig;
  DWORD local_8;
  
  uVar3 = 0;
  lpServiceConfig = (LPQUERY_SERVICE_CONFIGW)0x0;
  local_8 = 0;
  BVar1 = QueryServiceConfigW(param_1,(LPQUERY_SERVICE_CONFIGW)0x0,0,&local_8);
  if (BVar1 == 0) {
    DVar2 = GetLastError();
    if (DVar2 == 0x7a) {
      lpServiceConfig = (LPQUERY_SERVICE_CONFIGW)FUN_00431078(local_8,1);
      if (lpServiceConfig != (LPQUERY_SERVICE_CONFIGW)0x0) {
        BVar1 = QueryServiceConfigW(param_1,lpServiceConfig,local_8,&local_8);
        if (BVar1 != 0) goto LAB_0043851c;
        DVar2 = GetLastError();
        uVar3 = DVar2 & 0xffff | 0x80070000;
        if ((int)DVar2 < 1) {
          uVar3 = DVar2;
        }
        if (-1 < (int)uVar3) {
          uVar3 = 0x80004005;
        }
        FUN_004300d9();
        goto LAB_00438523;
      }
      uVar3 = 0x8007000e;
    }
    else {
      if (DVar2 == 0) goto LAB_0043851c;
      uVar3 = DVar2 & 0xffff | 0x80070000;
      if ((int)DVar2 < 1) {
        uVar3 = DVar2;
      }
      if (-1 < (int)uVar3) {
        uVar3 = 0x80004005;
      }
    }
    FUN_004300d9();
  }
  else {
LAB_0043851c:
    *param_2 = lpServiceConfig;
    lpServiceConfig = (LPQUERY_SERVICE_CONFIGW)0x0;
LAB_00438523:
    if (lpServiceConfig != (LPQUERY_SERVICE_CONFIGW)0x0) {
      FUN_00431137(lpServiceConfig);
    }
  }
  return uVar3;
}



/* Function: FUN_00438535 */

void FUN_00438535(LPCWSTR param_1,undefined4 param_2)

{
  int iVar1;
  int local_8;
  
  local_8 = 0;
  iVar1 = FUN_004314a9(L"SOFTWARE\\Policies\\",param_1,&local_8);
  if (-1 < iVar1) {
    FUN_004324d5(0x80000002,local_8,0x20019,param_2);
  }
  return;
}



/* Function: FUN_0043856b */

uint FUN_0043856b(LPCWSTR param_1,undefined4 param_2,undefined4 param_3,undefined4 *param_4)

{
  uint uVar1;
  HKEY local_8;
  
  local_8 = (HKEY)0x0;
  uVar1 = FUN_00438535(param_1,&local_8);
  if ((uVar1 != 0x80070002) && (uVar1 != 0x80070003)) {
    if ((int)uVar1 < 0) goto LAB_004385b9;
    uVar1 = FUN_00432582(local_8,param_2,param_4);
    if ((uVar1 != 0x80070002) && (uVar1 != 0x80070003)) goto LAB_004385b9;
  }
  uVar1 = 1;
LAB_004385b9:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
  }
  if ((uVar1 == 1) || ((int)uVar1 < 0)) {
    *param_4 = param_3;
  }
  return uVar1;
}



/* Function: FUN_004385df */

void FUN_004385df(undefined4 param_1,LPFILETIME param_2)

{
  int iVar1;
  BOOL BVar2;
  undefined4 local_1c;
  SYSTEMTIME local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_18.wYear = 0;
  local_18.wMonth = 0;
  local_18.wDayOfWeek = 0;
  local_18.wDay = 0;
  local_18.wHour = 0;
  local_18.wMinute = 0;
  local_18.wSecond = 0;
  local_18.wMilliseconds = 0;
  local_1c = 0x10;
  iVar1 = HttpQueryInfoW(param_1,0x4000000b,&local_18,&local_1c,0);
  if (iVar1 == 0) {
    GetLastError();
  }
  else {
    BVar2 = SystemTimeToFileTime(&local_18,param_2);
    if (BVar2 != 0) goto LAB_00438685;
    GetLastError();
  }
  FUN_004300d9();
LAB_00438685:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00438698 */

DWORD FUN_00438698(undefined4 param_1,undefined4 *param_2)

{
  int iVar1;
  DWORD DVar2;
  uint uVar3;
  undefined4 local_c;
  undefined4 local_8;
  
  uVar3 = 0;
  local_8 = 4;
  iVar1 = HttpQueryInfoW(param_1,0x20000005,&local_c,&local_8,0);
  if (iVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if ((int)uVar3 < 0) {
      FUN_004300d9();
      return uVar3;
    }
  }
  param_2[1] = 0;
  *param_2 = local_c;
  return uVar3;
}



/* Function: FUN_004386fc */

DWORD FUN_004386fc(undefined4 param_1,uint param_2,undefined4 param_3)

{
  int iVar1;
  DWORD DVar2;
  uint uVar3;
  undefined4 local_c;
  undefined4 local_8;
  
  uVar3 = 0;
  local_c = 4;
  local_8 = 0;
  iVar1 = HttpQueryInfoW(param_1,param_2 | 0x20000000,param_3,&local_c,&local_8);
  if (iVar1 == 0) {
    DVar2 = GetLastError();
    uVar3 = DVar2 & 0xffff | 0x80070000;
    if ((int)DVar2 < 1) {
      uVar3 = DVar2;
    }
    if (-1 < (int)uVar3) {
      uVar3 = 0x80004005;
    }
    FUN_004300d9();
  }
  return uVar3;
}



/* Function: FUN_00438764 */

uint FUN_00438764(undefined4 param_1,undefined4 param_2,int *param_3)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  undefined4 local_c;
  uint local_8;
  
  local_8 = 0;
  local_c = 0;
  if ((*param_3 == 0) && (uVar1 = FUN_00433bdf(param_3,0x40), (int)uVar1 < 0)) {
    return uVar1;
  }
  uVar1 = FUN_00434564((LPCVOID)*param_3,(int *)&local_8);
  if ((-1 < (int)uVar1) &&
     (iVar2 = HttpQueryInfoW(param_1,param_2,*param_3,&local_8,&local_c), iVar2 == 0)) {
    uVar3 = GetLastError();
    if (uVar3 == 0x7a) {
      local_8 = local_8 + 2;
      uVar1 = FUN_00433bdf(param_3,local_8 >> 1);
      if ((int)uVar1 < 0) {
        return uVar1;
      }
      iVar2 = HttpQueryInfoW(param_1,param_2,*param_3,&local_8,&local_c);
      if (iVar2 == 0) {
        uVar3 = GetLastError();
      }
      else {
        uVar3 = 0;
      }
    }
    uVar1 = uVar3 & 0xffff | 0x80070000;
    if ((int)uVar3 < 1) {
      uVar1 = uVar3;
    }
    if ((int)uVar1 < 0) {
      FUN_004300d9();
    }
  }
  return uVar1;
}



/* Function: FUN_00438829 */

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_00438829(undefined4 param_1,undefined4 *param_2,int *param_3,undefined2 *param_4,
                 int *param_5,int *param_6,int *param_7,int *param_8)

{
  int iVar1;
  uint local_2470 [3];
  undefined4 local_2464;
  WCHAR *local_2460;
  uint local_245c;
  undefined2 local_2458;
  WCHAR *local_2454;
  uint local_2450;
  WCHAR *local_244c;
  uint local_2448;
  WCHAR *local_2444;
  uint local_2440;
  WCHAR *local_243c;
  uint local_2438;
  undefined4 local_2434;
  undefined4 *local_2430;
  undefined2 *local_242c;
  int *local_2428;
  int *local_2424;
  int *local_2420;
  WCHAR local_241c [2050];
  WCHAR local_1418 [2050];
  WCHAR local_414 [258];
  WCHAR local_210 [130];
  WCHAR local_10c [130];
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  local_2434 = param_1;
  local_2430 = param_2;
  local_2420 = param_3;
  local_242c = param_4;
  local_2428 = param_5;
  local_2424 = param_6;
  FUN_004267c0(local_2470,0,0x3c);
  local_2470[0] = 0x3c;
  if (local_2420 != (int *)0x0) {
    local_2460 = local_414;
    local_245c = 0x101;
  }
  if (local_2428 != (int *)0x0) {
    local_2454 = local_10c;
    local_2450 = 0x81;
  }
  if (local_2424 != (int *)0x0) {
    local_244c = local_210;
    local_2448 = 0x81;
  }
  if (param_7 != (int *)0x0) {
    local_2444 = local_1418;
    local_2440 = 0x801;
  }
  if (param_8 != (int *)0x0) {
    local_243c = local_241c;
    local_2438 = 0x801;
  }
  iVar1 = InternetCrackUrlW(local_2434,0,0x90000000,local_2470);
  if (iVar1 == 0) {
    GetLastError();
    FUN_004300d9();
  }
  else {
    if (local_2430 != (undefined4 *)0x0) {
      *local_2430 = local_2464;
    }
    if ((local_2420 == (int *)0x0) ||
       (iVar1 = FUN_00433f88(local_2420,local_2460,local_245c), -1 < iVar1)) {
      if (local_242c != (undefined2 *)0x0) {
        *local_242c = local_2458;
      }
      if ((((local_2428 == (int *)0x0) ||
           (iVar1 = FUN_00433f88(local_2428,local_2454,local_2450), -1 < iVar1)) &&
          ((local_2424 == (int *)0x0 ||
           (iVar1 = FUN_00433f88(local_2424,local_244c,local_2448), -1 < iVar1)))) &&
         (((param_7 == (int *)0x0 ||
           (iVar1 = FUN_00433f88(param_7,local_2444,local_2440), -1 < iVar1)) &&
          (param_8 != (int *)0x0)))) {
        FUN_00433f88(param_8,local_243c,local_2438);
      }
    }
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00438a49 */

void FUN_00438a49(undefined4 param_1,undefined4 *param_2)

{
  FUN_00438829(param_1,param_2,param_2 + 1,(undefined2 *)(param_2 + 2),param_2 + 3,param_2 + 4,
               param_2 + 5,param_2 + 6);
  return;
}



/* Function: FUN_00438a74 */

void FUN_00438a74(undefined4 *param_1)

{
  int iVar1;
  
  if (param_1[1] != 0) {
    FUN_004380ab((LPVOID)param_1[1]);
  }
  if (param_1[3] != 0) {
    FUN_004380ab((LPVOID)param_1[3]);
  }
  if (param_1[4] != 0) {
    FUN_004380ab((LPVOID)param_1[4]);
  }
  if (param_1[5] != 0) {
    FUN_004380ab((LPVOID)param_1[5]);
  }
  if (param_1[6] != 0) {
    FUN_004380ab((LPVOID)param_1[6]);
  }
  for (iVar1 = 7; iVar1 != 0; iVar1 = iVar1 + -1) {
    *param_1 = 0;
    param_1 = param_1 + 1;
  }
  return;
}



/* Function: FUN_00438acd */

void FUN_00438acd(int *param_1,int param_2)

{
  _SYSTEMTIME local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  GetSystemTime(&local_18);
  FUN_00438b07(param_1,&local_18,param_2);
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00438b07 */

void FUN_00438b07(int *param_1,SYSTEMTIME *param_2,int param_3)

{
  _TIME_ZONE_INFORMATION local_c4;
  _SYSTEMTIME local_18;
  uint local_8;
  
  local_8 = DAT_004560d0 ^ (uint)&stack0xfffffffc;
  if (param_3 == 0) {
    GetTimeZoneInformation(&local_c4);
    SystemTimeToTzSpecificLocalTime(&local_c4,param_2,&local_18);
    FUN_00433cea(param_1,L"%04hu-%02hu-%02huT%02hu:%02hu:%02hu%c%02u:%02u");
  }
  else {
    FUN_00433cea(param_1,L"%04hu-%02hu-%02huT%02hu:%02hu:%02huZ");
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



/* Function: FUN_00438bd5 */

void FUN_00438bd5(short *param_1,int *param_2)

{
  uint uVar1;
  int iVar2;
  uint local_c;
  uint local_8;
  
  local_8 = 0;
  local_c = 0;
  if ((DAT_00457f94 & 1) == 0) {
    DAT_00457f94 = DAT_00457f94 | 1;
    DAT_00457f90 = lstrlenW((LPCWSTR)PTR_u_Software_Classes_Installer_Depen_00456f1c);
  }
  uVar1 = DAT_00457f90;
  iVar2 = FUN_0040e205(param_1,0x7fffffff,(int *)&local_8);
  if (((-1 < iVar2) && (iVar2 = FUN_00430249(uVar1,local_8,&local_c), -1 < iVar2)) &&
     (iVar2 = FUN_00433f88(param_2,(LPCWSTR)PTR_u_Software_Classes_Installer_Depen_00456f1c,local_c)
     , -1 < iVar2)) {
    FUN_00433c35(param_2,param_1,local_8);
  }
  return;
}



/* Function: FUN_00438c5e */

uint FUN_00438c5e(undefined4 param_1,short *param_2,int *param_3)

{
  uint uVar1;
  LPVOID local_c;
  HKEY local_8;
  
  local_c = (LPVOID)0x0;
  local_8 = (HKEY)0x0;
  uVar1 = FUN_00438bd5(param_2,(int *)&local_c);
  if ((-1 < (int)uVar1) &&
     ((uVar1 = FUN_004324d5(param_1,local_c,0x20019,&local_8), uVar1 == 0x80070002 ||
      ((-1 < (int)uVar1 &&
       (uVar1 = FUN_00432602(local_8,PTR_u_DisplayName_00456f0c,param_3), uVar1 == 0x80070002))))))
  {
    uVar1 = 0;
  }
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  return uVar1;
}



/* Function: FUN_00438ce4 */

uint FUN_00438ce4(undefined4 param_1,short *param_2,undefined4 param_3,int *param_4,int *param_5,
                 uint *param_6)

{
  uint uVar1;
  int iVar2;
  LPVOID local_18;
  LPCWSTR local_14;
  HKEY local_10;
  HKEY local_c;
  LPCWSTR local_8;
  
  local_18 = (LPVOID)0x0;
  local_10 = (HKEY)0x0;
  local_c = (HKEY)0x0;
  local_8 = (LPCWSTR)0x0;
  local_14 = (LPCWSTR)0x0;
  uVar1 = FUN_00438bd5(param_2,(int *)&local_18);
  if (-1 < (int)uVar1) {
    uVar1 = FUN_004324d5(param_1,local_18,0x20019,&local_10);
    if (-1 < (int)uVar1) {
      uVar1 = FUN_004324d5(local_10,PTR_u_Dependents_00456f20,0x20019,&local_c);
      if (uVar1 != 0x80070002) {
        if ((int)uVar1 < 0) goto LAB_00438dbc;
        iVar2 = 0;
        while( true ) {
          uVar1 = FUN_004323b4(local_c,iVar2,(int *)&local_8);
          if (uVar1 == 0x80070103) break;
          if ((int)uVar1 < 0) goto LAB_00438dbc;
          uVar1 = FUN_0043805f(param_4,local_8);
          if (uVar1 == 0x80070490) {
            uVar1 = FUN_00438c5e(param_1,local_8,(int *)&local_14);
            if ((int)uVar1 < 0) goto LAB_00438dbc;
            uVar1 = FUN_00438e0c(param_5,param_6,local_8,local_14);
          }
          if ((int)uVar1 < 0) goto LAB_00438dbc;
          iVar2 = iVar2 + 1;
        }
      }
      uVar1 = 0;
    }
  }
LAB_00438dbc:
  if (local_14 != (LPCWSTR)0x0) {
    FUN_004380ab(local_14);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  if (local_c != (HKEY)0x0) {
    RegCloseKey(local_c);
    local_c = (HKEY)0x0;
  }
  if (local_10 != (HKEY)0x0) {
    RegCloseKey(local_10);
    local_10 = (HKEY)0x0;
  }
  if (local_18 != (LPVOID)0x0) {
    FUN_004380ab(local_18);
  }
  return uVar1;
}



/* Function: FUN_00438e0c */

int FUN_00438e0c(int *param_1,uint *param_2,LPCWSTR param_3,LPCWSTR param_4)

{
  int *piVar1;
  int iVar2;
  uint uVar3;
  
  uVar3 = *param_2 + 1;
  if (uVar3 < *param_2) {
    uVar3 = 0xffffffff;
    iVar2 = -0x7ff8fdea;
  }
  else {
    iVar2 = 0;
  }
  if ((-1 < iVar2) && (iVar2 = FUN_0043109a(param_1,uVar3,8,5), -1 < iVar2)) {
    piVar1 = (int *)(*param_1 + *param_2 * 8);
    if (piVar1 == (int *)0x0) {
      iVar2 = -0x7fffbffd;
      FUN_004300d9();
    }
    else {
      iVar2 = FUN_00433f88(piVar1,param_3,0);
      if (-1 < iVar2) {
        if ((param_4 != (LPCWSTR)0x0) && (iVar2 = FUN_00433f88(piVar1 + 1,param_4,0), iVar2 < 0)) {
          return iVar2;
        }
        *param_2 = uVar3;
      }
    }
  }
  return iVar2;
}



/* Function: FUN_00438ea2 */

void FUN_00438ea2(LPVOID param_1,uint param_2)

{
  LPVOID pvVar1;
  uint uVar2;
  
  uVar2 = 0;
  if (param_2 != 0) {
    do {
      if (*(int *)((int)param_1 + uVar2 * 8) != 0) {
        FUN_004380ab(*(LPVOID *)((int)param_1 + uVar2 * 8));
      }
      pvVar1 = *(LPVOID *)((int)param_1 + uVar2 * 8 + 4);
      if (pvVar1 != (LPVOID)0x0) {
        FUN_004380ab(pvVar1);
      }
      uVar2 = uVar2 + 1;
    } while (uVar2 < param_2);
  }
  if (param_1 != (LPVOID)0x0) {
    FUN_00431137(param_1);
  }
  return;
}



/* Function: FUN_00438ee3 */

uint FUN_00438ee3(undefined4 param_1)

{
  uint uVar1;
  LPVOID local_c;
  HKEY local_8;
  
  local_c = (LPVOID)0x0;
  local_8 = (HKEY)0x0;
  uVar1 = FUN_00433cea((int *)&local_c,L"%ls%ls\\%ls\\%ls");
  if (-1 < (int)uVar1) {
    uVar1 = FUN_004324d5(param_1,local_c,0x20019,&local_8);
  }
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  return uVar1;
}



/* Function: FUN_00438f58 */

uint FUN_00438f58(undefined4 param_1,short *param_2,int *param_3,int *param_4,uint *param_5)

{
  uint uVar1;
  LPVOID local_c;
  HKEY local_8;
  
  local_c = (LPVOID)0x0;
  local_8 = (HKEY)0x0;
  uVar1 = FUN_00438bd5(param_2,(int *)&local_c);
  if (-1 < (int)uVar1) {
    uVar1 = FUN_004324d5(param_1,local_c,0x20019,&local_8);
    if (uVar1 == 0x80070002) {
      uVar1 = 0x80070490;
    }
    else if (-1 < (int)uVar1) {
      if (param_3 != (int *)0x0) {
        uVar1 = FUN_00432602(local_8,0,param_3);
        if (uVar1 == 0x80070002) {
          uVar1 = 0;
        }
        if ((int)uVar1 < 0) goto LAB_00439009;
      }
      if (param_4 != (int *)0x0) {
        uVar1 = FUN_00432602(local_8,PTR_u_DisplayName_00456f0c,param_4);
        if (uVar1 == 0x80070002) {
          uVar1 = 0;
        }
        if ((int)uVar1 < 0) goto LAB_00439009;
      }
      if ((param_5 != (uint *)0x0) &&
         (uVar1 = FUN_004328d3(local_8,PTR_u_Version_00456f08,param_5), uVar1 == 0x80070002)) {
        uVar1 = 0;
      }
    }
  }
LAB_00439009:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  return uVar1;
}



/* Function: FUN_0043902f */

uint FUN_0043902f(undefined4 param_1,short *param_2,short *param_3,short *param_4,short *param_5,
                 int param_6)

{
  uint uVar1;
  uint local_10;
  LPVOID local_c;
  HKEY local_8;
  
  local_c = (LPVOID)0x0;
  local_8 = (HKEY)0x0;
  local_10 = 0;
  uVar1 = FUN_00438bd5(param_2,(int *)&local_c);
  if (-1 < (int)uVar1) {
    uVar1 = FUN_00432176(param_1,local_c,0x20006,0,0,&local_8,&local_10);
    if (-1 < (int)uVar1) {
      if (param_5 != (short *)0x0) {
        uVar1 = FUN_00432a16(local_8,0,param_5);
        if ((int)uVar1 < 0) goto LAB_004390d1;
      }
      uVar1 = FUN_00432a16(local_8,PTR_u_Version_00456f08,param_3);
      if (-1 < (int)uVar1) {
        uVar1 = FUN_00432a16(local_8,PTR_u_DisplayName_00456f0c,param_4);
        if ((-1 < (int)uVar1) && (param_6 != 0)) {
          uVar1 = FUN_004329c8(local_8,PTR_u_Attributes_00456f18);
        }
      }
    }
  }
LAB_004390d1:
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_c != (LPVOID)0x0) {
    FUN_004380ab(local_c);
  }
  return uVar1;
}



/* Function: FUN_004390f7 */

uint FUN_004390f7(undefined4 param_1,short *param_2,undefined4 param_3,short *param_4,short *param_5
                 ,int param_6)

{
  uint uVar1;
  uint local_18;
  LPVOID local_14;
  LPVOID local_10;
  HKEY local_c;
  HKEY local_8;
  
  local_14 = (LPVOID)0x0;
  local_c = (HKEY)0x0;
  local_10 = (LPVOID)0x0;
  local_8 = (HKEY)0x0;
  local_18 = 0;
  uVar1 = FUN_00438bd5(param_2,(int *)&local_14);
  if (-1 < (int)uVar1) {
    uVar1 = FUN_00432176(param_1,local_14,0x20006,0,0,&local_c,&local_18);
    if (-1 < (int)uVar1) {
      uVar1 = FUN_00433cea((int *)&local_10,L"%ls\\%ls");
      if (-1 < (int)uVar1) {
        uVar1 = FUN_00432176(local_c,local_10,0x20006,0,0,&local_8,&local_18);
        if (-1 < (int)uVar1) {
          uVar1 = FUN_00432a16(local_8,PTR_u_MinVersion_00456f10,param_4);
          if (-1 < (int)uVar1) {
            uVar1 = FUN_00432a16(local_8,PTR_u_MaxVersion_00456f14,param_5);
            if ((-1 < (int)uVar1) && (param_6 != 0)) {
              uVar1 = FUN_004329c8(local_8,PTR_u_Attributes_00456f18);
            }
          }
        }
      }
    }
  }
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_10 != (LPVOID)0x0) {
    FUN_004380ab(local_10);
  }
  if (local_c != (HKEY)0x0) {
    RegCloseKey(local_c);
    local_c = (HKEY)0x0;
  }
  if (local_14 != (LPVOID)0x0) {
    FUN_004380ab(local_14);
  }
  return uVar1;
}



/* Function: FUN_00439211 */

uint FUN_00439211(undefined4 param_1,short *param_2)

{
  uint uVar1;
  LPCWSTR local_8;
  
  local_8 = (LPCWSTR)0x0;
  uVar1 = FUN_00438bd5(param_2,(int *)&local_8);
  if (-1 < (int)uVar1) {
    uVar1 = FUN_004321e8(param_1,local_8,0,1);
  }
  if (local_8 != (LPCWSTR)0x0) {
    FUN_004380ab(local_8);
  }
  return uVar1;
}



/* Function: FUN_00439252 */

uint FUN_00439252(undefined4 param_1,LPCWSTR param_2,LPCWSTR param_3)

{
  uint uVar1;
  int local_18;
  int local_14;
  HKEY local_10;
  HKEY local_c;
  HKEY local_8;
  
  local_10 = (HKEY)0x0;
  local_8 = (HKEY)0x0;
  local_c = (HKEY)0x0;
  local_14 = 0;
  local_18 = 0;
  uVar1 = FUN_004324d5(param_1,PTR_u_Software_Classes_Installer_Depen_00456f1c,0x20019,&local_10);
  if ((uVar1 != 0x80070002) && (-1 < (int)uVar1)) {
    uVar1 = FUN_004324d5(local_10,param_2,0x20019,&local_8);
    if ((uVar1 != 0x80070002) && (-1 < (int)uVar1)) {
      uVar1 = FUN_004324d5(local_8,PTR_u_Dependents_00456f20,0x20019,&local_c);
      if ((uVar1 != 0x80070002) && (-1 < (int)uVar1)) {
        uVar1 = FUN_004321e8(local_c,param_3,0,1);
        if (-1 < (int)uVar1) {
          uVar1 = FUN_00432531(local_c,&local_14,0);
          if ((-1 < (int)uVar1) && (local_14 == 0)) {
            if (local_c != (HKEY)0x0) {
              RegCloseKey(local_c);
              local_c = (HKEY)0x0;
            }
            uVar1 = FUN_004321e8(local_8,(LPCWSTR)PTR_u_Dependents_00456f20,0,0);
            if (-1 < (int)uVar1) {
              uVar1 = FUN_00432531(local_8,0,&local_18);
              if ((-1 < (int)uVar1) && (local_18 == 0)) {
                if (local_8 != (HKEY)0x0) {
                  RegCloseKey(local_8);
                  local_8 = (HKEY)0x0;
                }
                uVar1 = FUN_004321e8(local_10,param_2,0,0);
              }
            }
          }
        }
      }
    }
  }
  if (local_c != (HKEY)0x0) {
    RegCloseKey(local_c);
    local_c = (HKEY)0x0;
  }
  if (local_8 != (HKEY)0x0) {
    RegCloseKey(local_8);
    local_8 = (HKEY)0x0;
  }
  if (local_10 != (HKEY)0x0) {
    RegCloseKey(local_10);
  }
  return uVar1;
}



/* Function: GetFileVersionInfoSizeW */

DWORD GetFileVersionInfoSizeW(LPCWSTR lptstrFilename,LPDWORD lpdwHandle)

{
  DWORD DVar1;
  
                    /* WARNING: Could not recover jumptable at 0x004393a6. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  DVar1 = GetFileVersionInfoSizeW(lptstrFilename,lpdwHandle);
  return DVar1;
}



/* Function: GetFileVersionInfoW */

BOOL GetFileVersionInfoW(LPCWSTR lptstrFilename,DWORD dwHandle,DWORD dwLen,LPVOID lpData)

{
  BOOL BVar1;
  
                    /* WARNING: Could not recover jumptable at 0x004393ac. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  BVar1 = GetFileVersionInfoW(lptstrFilename,dwHandle,dwLen,lpData);
  return BVar1;
}



/* Function: VerQueryValueW */

BOOL VerQueryValueW(LPCVOID pBlock,LPCWSTR lpSubBlock,LPVOID *lplpBuffer,PUINT puLen)

{
  BOOL BVar1;
  
                    /* WARNING: Could not recover jumptable at 0x004393b2. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  BVar1 = VerQueryValueW(pBlock,lpSubBlock,lplpBuffer,puLen);
  return BVar1;
}



/* Function: IsProcessorFeaturePresent */

BOOL IsProcessorFeaturePresent(DWORD ProcessorFeature)

{
  BOOL BVar1;
  
                    /* WARNING: Could not recover jumptable at 0x004393b8. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  BVar1 = IsProcessorFeaturePresent(ProcessorFeature);
  return BVar1;
}



/* Function: RtlUnwind */

void RtlUnwind(PVOID TargetFrame,PVOID TargetIp,PEXCEPTION_RECORD ExceptionRecord,PVOID ReturnValue)

{
                    /* WARNING: Could not recover jumptable at 0x004393be. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  RtlUnwind(TargetFrame,TargetIp,ExceptionRecord,ReturnValue);
  return;
}



/* Function: __vsnwprintf */

/* Library Function - Single Match
    __vsnwprintf
   
   Library: Visual Studio 2012 Release */

int __cdecl __vsnwprintf(wchar_t *_Dest,size_t _Count,wchar_t *_Format,va_list _Args)

{
  int iVar1;
  
  iVar1 = __vsnwprintf_l(_Dest,_Count,_Format,(_locale_t)0x0,_Args);
  return iVar1;
}



/* Function: __vsnwprintf_l */

/* Library Function - Single Match
    __vsnwprintf_l
   
   Library: Visual Studio 2012 Release */

int __cdecl
__vsnwprintf_l(wchar_t *_DstBuf,size_t _MaxCount,wchar_t *_Format,_locale_t _Locale,va_list _ArgList
              )

{
  int *piVar1;
  int iVar2;
  char **ppcVar3;
  FILE local_24;
  
  local_24._ptr = (char *)0x0;
  ppcVar3 = (char **)&local_24._cnt;
  for (iVar2 = 7; iVar2 != 0; iVar2 = iVar2 + -1) {
    *ppcVar3 = (char *)0x0;
    ppcVar3 = ppcVar3 + 1;
  }
  if (_Format == (wchar_t *)0x0) {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
    iVar2 = -1;
  }
  else if ((_MaxCount == 0) || (_DstBuf != (wchar_t *)0x0)) {
    local_24._flag = 0x42;
    local_24._base = (char *)_DstBuf;
    local_24._ptr = (char *)_DstBuf;
    if (_MaxCount < 0x40000000) {
      local_24._cnt = _MaxCount * 2;
    }
    else {
      local_24._cnt = 0x7fffffff;
    }
    iVar2 = FUN_0043951f(&local_24,(ushort *)_Format,_Locale,(wchar_t *)_ArgList);
    if (_DstBuf != (wchar_t *)0x0) {
      local_24._cnt = local_24._cnt + -1;
      if (local_24._cnt < 0) {
        FUN_0042ad9a(0,&local_24);
      }
      else {
        *local_24._ptr = 0;
        local_24._ptr = (char *)((int)local_24._ptr + 1);
      }
      local_24._cnt = local_24._cnt + -1;
      if (local_24._cnt < 0) {
        FUN_0042ad9a(0,&local_24);
      }
      else {
        *local_24._ptr = 0;
      }
    }
  }
  else {
    piVar1 = __errno();
    *piVar1 = 0x16;
    FUN_0042acd7();
    iVar2 = -1;
  }
  return iVar2;
}



/* Function: _memmove_s */

/* Library Function - Single Match
    _memmove_s
   
   Libraries: Visual Studio 2012 Release, Visual Studio 2015 Release, Visual Studio 2017 Release,
   Visual Studio 2019 Release */

errno_t __cdecl _memmove_s(void *_Dst,rsize_t _DstSize,void *_Src,rsize_t _MaxCount)

{
  int *piVar1;
  errno_t eVar2;
  
  if (_MaxCount == 0) {
LAB_004394f9:
    eVar2 = 0;
  }
  else {
    if ((_Dst == (void *)0x0) || (_Src == (void *)0x0)) {
      piVar1 = __errno();
      eVar2 = 0x16;
    }
    else {
      if (_MaxCount <= _DstSize) {
        FUN_00426850((undefined8 *)_Dst,(undefined8 *)_Src,_MaxCount);
        goto LAB_004394f9;
      }
      piVar1 = __errno();
      eVar2 = 0x22;
    }
    *piVar1 = eVar2;
    FUN_0042acd7();
  }
  return eVar2;
}



/* Function: __allshl */

/* Library Function - Single Match
    __allshl
   
   Library: Visual Studio */

longlong __fastcall __allshl(byte param_1,int param_2)

{
  uint in_EAX;
  
  if (0x3f < param_1) {
    return 0;
  }
  if (param_1 < 0x20) {
    return CONCAT44(param_2 << (param_1 & 0x1f) | in_EAX >> 0x20 - (param_1 & 0x1f),
                    in_EAX << (param_1 & 0x1f));
  }
  return (ulonglong)(in_EAX << (param_1 & 0x1f)) << 0x20;
}



/* Function: FUN_0043951f */
